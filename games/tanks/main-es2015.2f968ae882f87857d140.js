(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+1EK":function(t,e,n){t.exports=o;var r=n("JtD1"),i=n("Wk7T");function o(t,e,n,r){this.minForce=void 0===n?-Number.MAX_VALUE:n,this.maxForce=void 0===r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new i.ARRAY_TYPE(6);for(var s=0;s<6;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}n("RZpa"),o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,n=this.timeStep;this.a=4/(n*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(n*n*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,n,r,i){return t[0]*e[0]+t[1]*e[1]+t[2]*n+t[3]*r[0]+t[4]*r[1]+t[5]*i},o.prototype.computeB=function(t,e,n){var r=this.computeGW();return-this.computeGq()*t-r*e-this.computeGiMf()*n};var s=r.create(),a=r.create();o.prototype.computeGq=function(){return this.gmult(this.G,s,this.bodyA.angle,a,this.bodyB.angle)+this.offset},o.prototype.computeGW=function(){var t=this.bodyA,e=this.bodyB;return this.gmult(this.G,t.velocity,t.angularVelocity,e.velocity,e.angularVelocity)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.bodyA,e=this.bodyB;return this.gmult(this.G,t.vlambda,t.wlambda,e.vlambda,e.wlambda)};var u=r.create(),c=r.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,n=t.angularForce,i=e.force,o=e.angularForce,s=e.invMassSolve,a=t.invInertiaSolve,h=e.invInertiaSolve,l=this.G;return r.scale(u,t.force,t.invMassSolve),r.multiply(u,t.massMultiplier,u),r.scale(c,i,s),r.multiply(c,e.massMultiplier,c),this.gmult(l,u,n*a,c,o*h)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,n=t.invMassSolve,r=e.invMassSolve,i=this.G;return i[0]*i[0]*n*t.massMultiplier[0]+i[1]*i[1]*n*t.massMultiplier[1]+i[2]*i[2]*t.invInertiaSolve+i[3]*i[3]*r*e.massMultiplier[0]+i[4]*i[4]*r*e.massMultiplier[1]+i[5]*i[5]*e.invInertiaSolve};var h=r.create(),l=r.create(),d=r.create();r.create(),r.create(),r.create(),o.prototype.addToWlambda=function(t){var e=this.bodyA,n=this.bodyB,i=h,o=l,s=d,a=e.invMassSolve,u=n.invMassSolve,c=e.invInertiaSolve,f=n.invInertiaSolve,p=this.G;o[0]=p[0],o[1]=p[1],s[0]=p[3],s[1]=p[4],r.scale(i,o,a*t),r.multiply(i,i,e.massMultiplier),r.add(e.vlambda,e.vlambda,i),e.wlambda+=c*p[2]*t,r.scale(i,s,u*t),r.multiply(i,i,n.massMultiplier),r.add(n.vlambda,n.vlambda,i),n.wlambda+=f*p[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},"+nTh":function(t,e){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}t.exports=n,n.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},"+v3u":function(t,e,n){n("q94Q")("match")},"//qW":function(t,e,n){"use strict";var r=n("Gp07"),i=n("LX9C"),o=n("stQs"),s=i.set,a=i.getterFor("String Iterator");o(String,"String",function(t){s(this,{type:"String Iterator",string:String(t),index:0})},function(){var t,e=a(this),n=e.string,i=e.index;return i>=n.length?{value:void 0,done:!0}:(t=r(n,i,!0),e.index+=t.length,{value:t,done:!1})})},"/bTq":function(t){t.exports={_args:[["p2@0.7.1","/home/pawellaski/workspace/tanks"]],_from:"p2@0.7.1",_id:"p2@0.7.1",_inBundle:!1,_integrity:"sha1-JfJHTZvDptMUCh2iamfJ4RislUM=",_location:"/p2",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"p2@0.7.1",name:"p2",escapedName:"p2",rawSpec:"0.7.1",saveSpec:null,fetchSpec:"0.7.1"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/p2/-/p2-0.7.1.tgz",_spec:"0.7.1",_where:"/home/pawellaski/workspace/tanks",author:{name:"Stefan Hedman",email:"schteppe@gmail.com",url:"http://steffe.se"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},dependencies:{"poly-decomp":"0.1.1"},description:"A JavaScript 2D physics engine.",devDependencies:{grunt:"^0.4.5","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0"},engines:{node:"*"},homepage:"https://github.com/schteppe/p2.js#readme",keywords:["p2.js","p2","physics","engine","2d"],licenses:[{type:"MIT"}],main:"./src/p2.js",name:"p2",repository:{type:"git",url:"git+https://github.com/schteppe/p2.js.git"},version:"0.7.1"}},0:function(t,e,n){t.exports=n("zUnb")},"0Bu/":function(t,e,n){var r=n("kpns"),i=n("bcPd");t.exports=function(t,e){if(i(t),!r(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}},"0DzJ":function(t,e,n){var r=n("+1EK"),i=n("JtD1");function o(t,e,n){n=n||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0;var i=this.G;i[2]=1,i[5]=-1}t.exports=o,(o.prototype=new r).constructor=o;var s=i.create(),a=i.create(),u=i.fromValues(1,0),c=i.fromValues(0,1);o.prototype.computeGq=function(){return i.rotate(s,u,this.bodyA.angle+this.angle),i.rotate(a,c,this.bodyB.angle),i.dot(s,a)}},"0HDe":function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},"0i0S":function(t,e){t.exports={}},"0idE":function(t,e,n){var r=n("57wU"),i=n("SAp2"),o=n("qBi7")("IE_PROTO"),s=n("S5sp"),a=Object.prototype;t.exports=s?Object.getPrototypeOf:function(t){return t=i(t),r(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},"0pMi":function(t,e,n){t.exports=i;var r=n("Wk7T");function i(t,e,n,i){this.type=n,i=r.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(t){for(var e=this.equations,n=0;n!==e.length;n++){var r=e[n];r.stiffness=t,r.needsUpdate=!0}},i.prototype.setRelaxation=function(t){for(var e=this.equations,n=0;n!==e.length;n++){var r=e[n];r.relaxation=t,r.needsUpdate=!0}}},"1VRj":function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},"1eSL":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,n,r){void 0===n&&(n=!1),i(this,t),this._fn=e,this._once=n,this._thisArg=r,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function s(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var a=function(){function t(){i(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var n=[];e;)n.push(e),e=e._next;return n}},{key:"has",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return s(this,new o(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return s(this,new o(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();a.MiniSignalBinding=o,e.default=a,t.exports=e.default},"1f/i":function(t,e,n){var r=n("ysHE"),i=n("wBs/"),o=n("57wU"),s=n("nX7E"),a=n("5eG6"),u=n("LX9C"),c=u.get,h=u.enforce,l=String(a).split("toString");n("MfhB")("inspectSource",function(t){return a.call(t)}),(t.exports=function(t,e,n,a){var u=!!a&&!!a.unsafe,c=!!a&&!!a.enumerable,d=!!a&&!!a.noTargetGet;"function"==typeof n&&("string"!=typeof e||o(n,"name")||i(n,"name",e),h(n).source=l.join("string"==typeof e?e:"")),t!==r?(u?!d&&t[e]&&(c=!0):delete t[e],c?t[e]=n:i(t,e,n)):c?t[e]=n:s(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&c(this).source||a.call(this)})},"1vck":function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),this.radius=(t=t||{}).radius||1,t.type=r.CIRCLE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e,n){var r=this.radius;i.set(t.upperBound,r,r),i.set(t.lowerBound,-r,-r),e&&(i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e))};var s=i.create(),a=i.create();o.prototype.raycast=function(t,e,n,r){var o=e.from,u=e.to,c=this.radius,h=Math.pow(u[0]-o[0],2)+Math.pow(u[1]-o[1],2),l=2*((u[0]-o[0])*(o[0]-n[0])+(u[1]-o[1])*(o[1]-n[1])),d=Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2)-Math.pow(c,2),f=Math.pow(l,2)-4*h*d,p=s,m=a;if(!(f<0))if(0===f)i.lerp(p,o,u,f),i.sub(m,p,n),i.normalize(m,m),e.reportIntersection(t,f,m,-1);else{var g=Math.sqrt(f),y=1/(2*h),v=(-l-g)*y,b=(-l+g)*y;if(v>=0&&v<=1&&(i.lerp(p,o,u,v),i.sub(m,p,n),i.normalize(m,m),e.reportIntersection(t,v,m,-1),t.shouldStop(e)))return;b>=0&&b<=1&&(i.lerp(p,o,u,b),i.sub(m,p,n),i.normalize(m,m),e.reportIntersection(t,b,m,-1))}}},"22PD":function(t,e,n){var r=n("0pMi"),i=n("+1EK"),o=n("JtD1"),s=n("Wk7T");function a(t,e,n){n=s.defaults(n,{localAnchorA:[0,0],localAnchorB:[0,0]}),r.call(this,t,e,r.DISTANCE,n),this.localAnchorA=o.fromValues(n.localAnchorA[0],n.localAnchorA[1]),this.localAnchorB=o.fromValues(n.localAnchorB[0],n.localAnchorB[1]);var a,u=this.localAnchorA,c=this.localAnchorB;if(this.distance=0,"number"==typeof n.distance)this.distance=n.distance;else{var h=o.create(),l=o.create(),d=o.create();o.rotate(h,u,t.angle),o.rotate(l,c,e.angle),o.add(d,e.position,l),o.sub(d,d,h),o.sub(d,d,t.position),this.distance=o.length(d)}a=void 0===n.maxForce?Number.MAX_VALUE:n.maxForce;var f=new i(t,e,-a,a);this.equations=[f],this.maxForce=a,d=o.create();var p=o.create(),m=o.create(),g=this;f.computeGq=function(){var t=this.bodyA,e=this.bodyB,n=t.position,r=e.position;return o.rotate(p,u,t.angle),o.rotate(m,c,e.angle),o.add(d,r,m),o.sub(d,d,p),o.sub(d,d,n),o.length(d)-g.distance},this.setMaxForce(a),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}t.exports=a,(a.prototype=new r).constructor=a;var u=o.create(),c=o.create(),h=o.create();a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=t.position,r=e.position,i=this.equations[0],s=this.equations[0].G;o.rotate(c,this.localAnchorA,t.angle),o.rotate(h,this.localAnchorB,e.angle),o.add(u,r,h),o.sub(u,u,c),o.sub(u,u,n),this.position=o.length(u);var a=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(i.maxForce=0,i.minForce=-this.maxForce,this.distance=this.upperLimit,a=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(i.maxForce=this.maxForce,i.minForce=0,this.distance=this.lowerLimit,a=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||a){i.enabled=!0,o.normalize(u,u);var l=o.crossLength(c,u),d=o.crossLength(h,u);s[0]=-u[0],s[1]=-u[1],s[2]=-l,s[3]=u[0],s[4]=u[1],s[5]=d}else i.enabled=!1},a.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},a.prototype.getMaxForce=function(){return this.equations[0].maxForce}},"2F3y":function(t,e,n){n("q94Q")("asyncIterator")},"2Hee":function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"2Vfd":function(t,e,n){var r=n("fq9q"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},"2w5C":function(t,e,n){var r=n("57wU"),i=n("IutQ"),o=n("55jA")(!1),s=n("vcTx");t.exports=function(t,e){var n,a=i(t),u=0,c=[];for(n in a)!r(s,n)&&r(a,n)&&c.push(n);for(;e.length>u;)r(a,n=e[u++])&&(~o(c,n)||c.push(n));return c}},"3Gxb":function(t,e,n){var r=n("2w5C"),i=n("o9j8").concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,i)}},"3Jud":function(t,e,n){var r=n("RZpa");function i(){this.equations=[],this.bodies=[]}t.exports=i,i.prototype.reset=function(){this.equations.length=this.bodies.length=0};var o=[];i.prototype.getBodies=function(t){var e=t||[],n=this.equations;o.length=0;for(var r=0;r!==n.length;r++){var i=n[r];-1===o.indexOf(i.bodyA.id)&&(e.push(i.bodyA),o.push(i.bodyA.id)),-1===o.indexOf(i.bodyB.id)&&(e.push(i.bodyB),o.push(i.bodyB.id))}return e},i.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},i.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},"3UD+":function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},"44fV":function(t,e,n){"use strict";var r=n("ysHE"),i=n("57wU"),o=n("lb/b"),s=n("U5J1"),a=n("pSMy"),u=n("1f/i"),c=n("vcTx"),h=n("0HDe"),l=n("MfhB"),d=n("S4gH"),f=n("ptKZ"),p=n("aXXJ"),m=n("ahhG"),g=n("q94Q"),y=n("SIcJ"),v=n("k2qa"),b=n("bcPd"),w=n("kpns"),_=n("IutQ"),E=n("ehg7"),T=n("2Hee"),x=n("tzov"),S=n("zkF/"),C=n("pYsU"),A=n("TIpl"),I=n("iCuu"),O=n("wBs/"),D=n("Q2Kg"),k=n("qBi7")("hidden"),P=n("LX9C"),N=P.set,M=P.getterFor("Symbol"),R=C.f,L=A.f,F=S.f,B=r.Symbol,U=r.JSON,V=U&&U.stringify,j=p("toPrimitive"),q=I.f,G=l("symbol-registry"),H=l("symbols"),z=l("op-symbols"),W=l("wks"),K=Object.prototype,X=r.QObject,Q=n("mk1t"),Y=!X||!X.prototype||!X.prototype.findChild,J=o&&h(function(){return 7!=x(L({},"a",{get:function(){return L(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=R(K,e);r&&delete K[e],L(t,e,n),r&&t!==K&&L(K,e,r)}:L,$=function(t,e){var n=H[t]=x(B.prototype);return N(n,{type:"Symbol",tag:t,description:e}),o||(n.description=e),n},Z=Q&&"symbol"==typeof B.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof B},tt=function(t,e,n){return t===K&&tt(z,e,n),b(t),e=E(e,!0),b(n),i(H,e)?(n.enumerable?(i(t,k)&&t[k][e]&&(t[k][e]=!1),n=x(n,{enumerable:T(0,!1)})):(i(t,k)||L(t,k,T(1,{})),t[k][e]=!0),J(t,e,n)):L(t,e,n)},et=function(t,e){b(t);for(var n,r=y(e=_(e)),i=0,o=r.length;o>i;)tt(t,n=r[i++],e[n]);return t},nt=function(t){var e=q.call(this,t=E(t,!0));return!(this===K&&i(H,t)&&!i(z,t))&&(!(e||!i(this,t)||!i(H,t)||i(this,k)&&this[k][t])||e)},rt=function(t,e){if(t=_(t),e=E(e,!0),t!==K||!i(H,e)||i(z,e)){var n=R(t,e);return!n||!i(H,e)||i(t,k)&&t[k][e]||(n.enumerable=!0),n}},it=function(t){for(var e,n=F(_(t)),r=[],o=0;n.length>o;)i(H,e=n[o++])||i(c,e)||r.push(e);return r},ot=function(t){for(var e,n=t===K,r=F(n?z:_(t)),o=[],s=0;r.length>s;)!i(H,e=r[s++])||n&&!i(K,e)||o.push(H[e]);return o};Q||(u((B=function(){if(this instanceof B)throw TypeError("Symbol is not a constructor");var t=void 0===arguments[0]?void 0:String(arguments[0]),e=f(t),n=function(t){this===K&&n.call(z,t),i(this,k)&&i(this[k],e)&&(this[k][e]=!1),J(this,e,T(1,t))};return o&&Y&&J(K,e,{configurable:!0,set:n}),$(e,t)}).prototype,"toString",function(){return M(this).tag}),I.f=nt,A.f=tt,C.f=rt,n("3Gxb").f=S.f=it,n("fw2a").f=ot,o&&(L(B.prototype,"description",{configurable:!0,get:function(){return M(this).description}}),s||u(K,"propertyIsEnumerable",nt,{unsafe:!0})),m.f=function(t){return $(p(t),t)}),a({global:!0,wrap:!0,forced:!Q,sham:!Q},{Symbol:B});for(var st=D(W),at=0;st.length>at;)g(st[at++]);a({target:"Symbol",stat:!0,forced:!Q},{for:function(t){return i(G,t+="")?G[t]:G[t]=B(t)},keyFor:function(t){if(!Z(t))throw TypeError(t+" is not a symbol");for(var e in G)if(G[e]===t)return e},useSetter:function(){Y=!0},useSimple:function(){Y=!1}}),a({target:"Object",stat:!0,forced:!Q,sham:!o},{create:function(t,e){return void 0===e?x(t):et(x(t),e)},defineProperty:tt,defineProperties:et,getOwnPropertyDescriptor:rt}),a({target:"Object",stat:!0,forced:!Q},{getOwnPropertyNames:it,getOwnPropertySymbols:ot}),U&&a({target:"JSON",stat:!0,forced:!Q||h(function(){var t=B();return"[null]"!=V([t])||"{}"!=V({a:t})||"{}"!=V(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(w(e)||void 0!==t)&&!Z(t))return v(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!Z(e))return e}),r[1]=e,V.apply(U,r)}}),B.prototype[j]||O(B.prototype,j,B.prototype.valueOf),d(B,"Symbol"),c[k]=!0},"4Ea8":function(t,e,n){t.exports=n("ysHE")},"4fRq":function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},"4mOR":function(t,e,n){"use strict";var r=n("vQkR")(6),i=!0;"findIndex"in[]&&Array(1).findIndex(function(){i=!1}),n("pSMy")({target:"Array",proto:!0,forced:i},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("gJLK")("findIndex")},"55jA":function(t,e,n){var r=n("IutQ"),i=n("H6ty"),o=n("GJzV");t.exports=function(t){return function(e,n,s){var a,u=r(e),c=i(u.length),h=o(s,c);if(t&&n!=n){for(;c>h;)if((a=u[h++])!=a)return!0}else for(;c>h;h++)if((t||h in u)&&u[h]===n)return t||h||0;return!t&&-1}}},"57wU":function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},"5HXA":function(t,e,n){"use strict";var r=n("ANjH").compose;e.__esModule=!0,e.composeWithDevTools="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?r:r.apply(null,arguments)},e.devToolsEnhancer="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__:function(){return function(t){return t}}},"5eG6":function(t,e,n){t.exports=n("MfhB")("native-function-to-string",Function.toString)},"5xXB":function(t,e,n){n("JtD1"),n("3Jud"),n("+nTh");var r=n("vgT8"),i=n("RJ5M"),o=n("RZpa");function s(t){this.nodePool=new r({size:16}),this.islandPool=new i({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}t.exports=s,s.getUnvisitedNode=function(t){for(var e=t.length,n=0;n!==e;n++){var r=t[n];if(!r.visited&&r.body.type===o.DYNAMIC)return r}return!1},s.prototype.visit=function(t,e,n){e.push(t.body);for(var r=t.equations.length,i=0;i!==r;i++){var o=t.equations[i];-1===n.indexOf(o)&&n.push(o)}},s.prototype.bfs=function(t,e,n){var r=this.queue;for(r.length=0,r.push(t),t.visited=!0,this.visit(t,e,n);r.length;)for(var i,a=r.pop();i=s.getUnvisitedNode(a.neighbors);)i.visited=!0,this.visit(i,e,n),i.body.type===o.DYNAMIC&&r.push(i)},s.prototype.split=function(t){for(var e=t.bodies,n=this.nodes,r=this.equations;n.length;)this.nodePool.release(n.pop());for(var i=0;i!==e.length;i++){var o=this.nodePool.get();o.body=e[i],n.push(o)}for(var a=0;a!==r.length;a++){var u=r[a],c=(i=e.indexOf(u.bodyA),e.indexOf(u.bodyB)),h=n[i],l=n[c];h.neighbors.push(l),l.neighbors.push(h),h.equations.push(u),l.equations.push(u)}var d,f=this.islands;for(i=0;i<f.length;i++)this.islandPool.release(f[i]);for(f.length=0;d=s.getUnvisitedNode(n);){var p=this.islandPool.get();this.bfs(d,p.bodies,p.equations),f.push(p)}return f}},"6Joi":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=(r=n("wj3C"))&&"object"==typeof r&&"default"in r?r.default:r,o=n("q/0M"),s=n("mrSG"),a=n("x7I3"),u=n("zVF4"),c=i.SDK_VERSION,h=new o.Logger("@firebase/firestore"),l=function(t){return t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT",t}({});function d(){return h.logLevel===o.LogLevel.DEBUG?l.DEBUG:h.logLevel===o.LogLevel.SILENT?l.SILENT:l.ERROR}function f(t){switch(t){case l.DEBUG:h.logLevel=o.LogLevel.DEBUG;break;case l.ERROR:h.logLevel=o.LogLevel.ERROR;break;case l.SILENT:h.logLevel=o.LogLevel.SILENT;break;default:h.error("Firestore ("+c+"): Invalid value passed to `setLogLevel`")}}function p(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(h.logLevel<=o.LogLevel.DEBUG){var i=n.map(g);h.debug.apply(h,["Firestore ("+c+") ["+t+"]: "+e].concat(i))}}function m(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=o.LogLevel.ERROR){var r=e.map(g);h.error.apply(h,["Firestore ("+c+"): "+t].concat(r))}}function g(t){if("string"==typeof t)return t;var e=b.getPlatform();try{return e.formatJSON(t)}catch(n){return t}}function y(t){var e="FIRESTORE ("+c+") INTERNAL ASSERTION FAILED: "+t;throw m(e),new Error(e)}function v(t,e){t||y(e)}var b=function(){function t(){}return t.setPlatform=function(e){t.platform&&y("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||y("Platform not set"),t.platform},t}();function w(){return b.getPlatform().emptyByteString}var _={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},E=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return s.__extends(e,t),e}(Error);function T(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new E(_.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function x(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function S(t,e){return void 0!==t?t:e}function C(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function A(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function I(t){for(var e in v(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function O(t,e){if(0!==e.length)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+W(e.length,"argument")+".")}function D(t,e,n){if(e.length!==n)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires "+W(n,"argument")+", but was called with "+W(e.length,"argument")+".")}function k(t,e,n){if(e.length<n)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires at least "+W(n,"argument")+", but was called with "+W(e.length,"argument")+".")}function P(t,e,n,r){if(e.length<n||e.length>r)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+W(e.length,"argument")+".")}function N(t,e,n,r){U(t,e,z(n)+" argument",r)}function M(t,e,n,r){void 0!==r&&N(t,e,n,r)}function R(t,e,n,r){U(t,e,n+" option",r)}function L(t,e,n,r){void 0!==r&&R(t,e,n,r)}function F(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,a=i;s<a.length;s++){var u=a[s];if(u===r)return;o.push(j(u))}var c=j(r);throw new E(_.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function B(t,e,n,r){if(!e.some(function(t){return t===r}))throw new E(_.INVALID_ARGUMENT,"Invalid value "+j(r)+" provided to function "+t+"() for its "+z(n)+" argument. Acceptable values: "+e.join(", "))}function U(t,e,n,r){if(!("object"===e?V(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=j(r);throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function V(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function j(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":y("Unknown wrong type: "+typeof t)}function q(t,e,n){if(void 0===n)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+z(e)+" argument, but it was undefined.")}function G(t,e,n){A(e,function(e,r){if(n.indexOf(e)<0)throw new E(_.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function H(t,e,n,r){var i=j(r);return new E(_.INVALID_ARGUMENT,"Function "+t+"() requires its "+z(n)+" argument to be a "+e+", but it was: "+i)}function z(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function W(t,e){return t+" "+e+(1===t?"":"s")}var K=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return v(20===e.length,"Invalid auto ID: "+e),e},t}();function X(t,e){return t<e?-1:t>e?1:0}function Q(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Y(t){return t+"\0"}function J(){if("undefined"==typeof Uint8Array)throw new E(_.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function $(){if(!b.getPlatform().base64Available)throw new E(_.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Z=function(){function t(t){$(),this._binaryString=t}return t.fromBase64String=function(e){D("Blob.fromBase64String",arguments,1),N("Blob.fromBase64String","string",1,e),$();try{var n=b.getPlatform().atob(e);return new t(n)}catch(r){throw new E(_.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+r)}},t.fromUint8Array=function(e){if(D("Blob.fromUint8Array",arguments,1),J(),!(e instanceof Uint8Array))throw H("Blob.fromUint8Array","Uint8Array",1,e);var n=Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join("");return new t(n)},t.prototype.toBase64=function(){return D("Blob.toBase64",arguments,0),$(),b.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){D("Blob.toUint8Array",arguments,0),J();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return X(this._binaryString,t._binaryString)},t}(),tt=T(Z,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),et=function(){function t(t,e){if(D("GeoPoint",arguments,2),N("GeoPoint","number",1,t),N("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new E(_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new E(_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return X(this._lat,t._lat)||X(this._long,t._long)},t}(),nt=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new E(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new E(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new E(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new E(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?X(this.nanoseconds,t.nanoseconds):X(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),rt=function(){return function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}(),it="(default)",ot=function(){function t(t,e){this.projectId=t,this.database=e||it}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===it},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return X(this.projectId,t.projectId)||X(this.database,t.database)},t}(),st=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&y("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&y("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},t.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):"string"==typeof e?n.push(e):y("Unknown parameter type for Path.child(): "+e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return v(this.length>=(t=void 0===t?1:t),"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return v(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return v(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return v(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),at=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s.__extends(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new E(_.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(st),ut=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s.__extends(e,t),e.isValidIdentifier=function(t){return ut.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new E(_.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new E(_.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new E(_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new E(_.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(st),ht=function(){function t(e){this.path=e,v(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===at.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return at.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new at(e.slice()))},t.fromPathString=function(e){return new t(at.fromString(e))},t.EMPTY=new t(new at([])),t}(),lt=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return ht.comparator(t.key,e.key)},t}(),dt=function(t){function e(e,n,r,i,o){var s=t.call(this,e,n)||this;return s.data=r,s.proto=o,s.hasLocalMutations=!!i.hasLocalMutations,s.hasCommittedMutations=!!i.hasCommittedMutations,s}return s.__extends(e,t),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return void 0!==r&&void 0!==i?r.compareTo(i):y("Trying to compare documents on fields that don't exist")},e}(lt),ft=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return s.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(lt),pt=function(t){function e(e,n){return t.call(this,e,n)||this}return s.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(lt),mt=function(){function t(t,e){this.comparator=t,this.root=e||yt.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,yt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yt.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new gt(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new gt(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new gt(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new gt(this.root,t,this.comparator,!0)},t}(),gt=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){v(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),yt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw y("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw y("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw y("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),vt=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new yt(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();yt.EMPTY=new vt;var bt=function(t){return t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue",t}({}),wt=function(t){return t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous",t}({}),_t=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(wt.Estimate,n);case"previous":return new t(wt.Previous,n);case"none":case void 0:return new t(wt.Default,n);default:return y("fromSnapshotOptions() called with invalid options.")}},t}(),Et=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return v(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),X(this.typeOrder,t.typeOrder)},t}(),Tt=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=bt.NullValue,e.internalValue=null,e}return s.__extends(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(Et),xt=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.BooleanValue,n}return s.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?X(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Et),St=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.NumberValue,n}return s.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue)<(r=t.internalValue)?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1:this.defaultCompareTo(t);var n,r},e}(Et);function Ct(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var At=function(t){function e(e){return t.call(this,e)||this}return s.__extends(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ct(this.internalValue,t.internalValue)},e}(St),It=function(t){function e(e){var n=t.call(this,e)||this;return n.internalValue=e,n}return s.__extends(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Ct(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(St),Ot=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.StringValue,n}return s.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?X(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Et),Dt=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.TimestampValue,n}return s.__extends(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof kt?-1:this.defaultCompareTo(t)},e}(Et),kt=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=bt.TimestampValue,r}return s.__extends(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===wt.Estimate?new Dt(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===wt.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Dt?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Et),Pt=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.BlobValue,n}return s.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Et),Nt=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=bt.RefValue,r}return s.__extends(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:ht.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(Et),Mt=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.GeoPointValue,n}return s.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Et),Rt=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.ObjectValue,n}return s.__extends(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),s=X(i.key,o.key)||i.value.compareTo(o.value);if(s)return s}return X(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(v(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(v(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return void 0!==this.field(t)},e.prototype.field=function(t){v(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e&&n.internalValue.get(t)||void 0}),n},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new mt(X)),e}(Et),Lt=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=bt.ArrayValue,n}return s.__extends(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return X(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},e}(Et),Ft=Number,Bt=Ft.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Ut=Ft.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Vt=Ft.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function jt(t){return null==t}function qt(t){return Vt(t)&&t<=Ut&&t>=Bt}var Gt=function(){function t(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)this.memoizedOrderBy=t.isKeyField()?[$t]:[new Jt(t),$t];else{v(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}n||this.memoizedOrderBy.push((this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Qt.ASCENDING)===Qt.ASCENDING?$t:Zt)}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){v(null==this.getInequalityFilterField()||!(e instanceof Wt)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),v(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){v(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";jt(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),jt(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return v(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!jt(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Wt&&n.isInequality())return n.field}return null},t.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(t){return t instanceof Wt&&t.op===zt.ARRAY_CONTAINS})},t.prototype.isDocumentQuery=function(){return ht.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):ht.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&void 0===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){v(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Ht=function(){function t(){}return t.create=function(t,e,n){if(n.isEqual(Tt.INSTANCE)){if(e!==zt.EQUAL)throw new E(_.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new Kt(t)}if(n.isEqual(It.NAN)){if(e!==zt.EQUAL)throw new E(_.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new Xt(t)}return new Wt(t,e,n)},t}(),zt=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;default:return y("Unknown relation: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t}(),Wt=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return s.__extends(e,t),e.prototype.matches=function(t){if(this.field.isKeyField()){v(this.value instanceof Nt,"Comparing on key, but filter value not a RefValue"),v(this.op!==zt.ARRAY_CONTAINS,"array-contains queries don't make sense on document keys.");var e=ht.comparator(t.key,this.value.key);return this.matchesComparison(e)}var n=t.field(this.field);return void 0!==n&&this.matchesValue(n)},e.prototype.matchesValue=function(t){var e=this;return this.op===zt.ARRAY_CONTAINS?t instanceof Lt&&void 0!==t.internalValue.find(function(t){return t.isEqual(e.value)}):this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case zt.LESS_THAN:return t<0;case zt.LESS_THAN_OR_EQUAL:return t<=0;case zt.EQUAL:return 0===t;case zt.GREATER_THAN:return t>0;case zt.GREATER_THAN_OR_EQUAL:return t>=0;default:return y("Unknown relation op"+this.op)}},e.prototype.isInequality=function(){return this.op!==zt.EQUAL&&this.op!==zt.ARRAY_CONTAINS},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(Ht),Kt=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return s.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return void 0!==e&&null===e.value()},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},e.prototype.toString=function(){return this.field.canonicalString()+" IS null"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(Ht),Xt=function(t){function e(e){var n=t.call(this)||this;return n.field=e,n}return s.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field),n=e&&e.value();return"number"==typeof n&&isNaN(n)},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(Ht),Qt=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Yt=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},t.prototype.sortsBeforeDocument=function(t,e){v(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())v(o instanceof Nt,"Bound has a non-key value where the key path is being used."),n=ht.comparator(o.key,e.key);else{var s=e.field(i.field);v(void 0!==s,"Field should exist since document matched the orderBy already."),n=o.compareTo(s)}if(i.dir===Qt.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)return this.position[e].isEqual(t.position[e]);return!0},t}(),Jt=function(){function t(t,e){this.field=t,void 0===e&&(e=Qt.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?dt.compareByKey(t,e):dt.compareByField(this.field,t,e);switch(this.dir){case Qt.ASCENDING:return n;case Qt.DESCENDING:return-1*n;default:return y("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),$t=new Jt(ct.keyField(),Qt.ASCENDING),Zt=new Jt(ct.keyField(),Qt.DESCENDING),te=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new nt(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new nt(0,0)),t}(),ee=function(t){return t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution",t}({}),ne=function(){function t(t,e,n,r,i,o){void 0===i&&(i=te.MIN),void 0===o&&(o=w()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),re=function(){function t(t){this.comparator=t,this.data=new mt(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ie(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ie(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ie=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),oe=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new re(ct.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.applyTo=function(t){var e=Rt.EMPTY;return this.fields.forEach(function(n){if(n.isEmpty())return t;var r=t.field(n);void 0!==r&&(e=e.set(n,r))}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),se=function(){function t(t,e){this.field=t,this.transform=e}return Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return this.transform.isIdempotent},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),ae=function(){return function(t,e){this.version=t,this.transformResults=e}}(),ue=function(t){return t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete",t}({}),ce=function(){function t(t,e){this.updateTime=t,this.exists=e,v(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof dt&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof dt:(v(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return n=t.updateTime,(null!=(e=this.updateTime)?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),he=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&v(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof dt?t.version:te.MIN},t}(),le=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=ue.Set,i}return s.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),v(null==e.transformResults,"Transform results received by SetMutation."),new dt(this.key,e.version,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=he.getPostMutationVersion(t);return new dt(this.key,r,this.value,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(he),de=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=ue.Patch,o}return s.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),v(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new pt(this.key,e.version);var n=this.patchDocument(t);return new dt(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=he.getPostMutationVersion(t),i=this.patchDocument(t);return new dt(this.key,r,i,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){return this.patchObject(t instanceof dt?t.data:Rt.EMPTY)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=void 0!==r?t.set(n,r):t.delete(n)}}),t},e}(he),fe=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=ue.Transform,r.precondition=ce.exists(!0),r}return s.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),v(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new pt(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new dt(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,e),o=this.transformObject(r.data,i);return new dt(this.key,r.version,o,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){for(var t=0,e=this.fieldTransforms;t<e.length;t++)if(!e[t].isIdempotent)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){var t=new re(ct.comparator);return this.fieldTransforms.forEach(function(e){return t=t.add(e.field)}),new oe(t)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&Q(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){v(t instanceof dt,"Unknown MaybeDocument type "+t);var e=t;return v(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];v(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof dt&&(s=t.field(i.field)||null),n.push(o.applyToRemoteDocument(s,e[r]))}return n},e.prototype.localTransformResults=function(t,e){for(var n=[],r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r],s=o.transform,a=null;e instanceof dt&&(a=e.field(o.field)||null),n.push(s.applyToLocalView(a,t))}return n},e.prototype.transformObject=function(t,e){v(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++)t=t.set(this.fieldTransforms[n].field,e[n]);return t},e}(he),pe=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=ue.Delete,r}return s.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),v(null==e.transformResults,"Transform results received by DeleteMutation."),new ft(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&v(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new ft(this.key,te.forDeletedDoc())):t},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e}(he),me=function(){function t(){this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return new kt(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),ge=function(){function t(t){this.elements=t,this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=be(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Lt(e)},t.prototype.isEqual=function(e){return e instanceof t&&Q(e.elements,this.elements)},t}(),ye=function(){function t(t){this.elements=t,this.isIdempotent=!0}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=be(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new Lt(e)},t.prototype.isEqual=function(e){return e instanceof t&&Q(e.elements,this.elements)},t}(),ve=function(){function t(t){this.operand=t,this.isIdempotent=!1}return t.prototype.applyToLocalView=function(t,e){return t instanceof At&&this.operand instanceof At?new At(t.internalValue+this.operand.internalValue):t instanceof St?new It(t.internalValue+this.operand.internalValue):this.operand},t.prototype.applyToRemoteDocument=function(t,e){return v(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function be(t){return t instanceof Lt?t.internalValue.slice():[]}var we=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),_e=function(t){return t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS",t}({});function Ee(t){switch(t){case _.OK:return y("Treated status OK as error");case _.CANCELLED:case _.UNKNOWN:case _.DEADLINE_EXCEEDED:case _.RESOURCE_EXHAUSTED:case _.INTERNAL:case _.UNAVAILABLE:case _.UNAUTHENTICATED:return!1;case _.INVALID_ARGUMENT:case _.NOT_FOUND:case _.ALREADY_EXISTS:case _.PERMISSION_DENIED:case _.FAILED_PRECONDITION:case _.ABORTED:case _.OUT_OF_RANGE:case _.UNIMPLEMENTED:case _.DATA_LOSS:return!0;default:return y("Unknown status code: "+t)}}function Te(t){if(void 0===t)return m("GRPC error has no .code"),_.UNKNOWN;switch(t){case _e.OK:return _.OK;case _e.CANCELLED:return _.CANCELLED;case _e.UNKNOWN:return _.UNKNOWN;case _e.DEADLINE_EXCEEDED:return _.DEADLINE_EXCEEDED;case _e.RESOURCE_EXHAUSTED:return _.RESOURCE_EXHAUSTED;case _e.INTERNAL:return _.INTERNAL;case _e.UNAVAILABLE:return _.UNAVAILABLE;case _e.UNAUTHENTICATED:return _.UNAUTHENTICATED;case _e.INVALID_ARGUMENT:return _.INVALID_ARGUMENT;case _e.NOT_FOUND:return _.NOT_FOUND;case _e.ALREADY_EXISTS:return _.ALREADY_EXISTS;case _e.PERMISSION_DENIED:return _.PERMISSION_DENIED;case _e.FAILED_PRECONDITION:return _.FAILED_PRECONDITION;case _e.ABORTED:return _.ABORTED;case _e.OUT_OF_RANGE:return _.OUT_OF_RANGE;case _e.UNIMPLEMENTED:return _.UNIMPLEMENTED;case _e.DATA_LOSS:return _.DATA_LOSS;default:return y("Unknown status code: "+t)}}function xe(t){if(void 0===t)return _e.OK;switch(t){case _.OK:return _e.OK;case _.CANCELLED:return _e.CANCELLED;case _.UNKNOWN:return _e.UNKNOWN;case _.DEADLINE_EXCEEDED:return _e.DEADLINE_EXCEEDED;case _.RESOURCE_EXHAUSTED:return _e.RESOURCE_EXHAUSTED;case _.INTERNAL:return _e.INTERNAL;case _.UNAVAILABLE:return _e.UNAVAILABLE;case _.UNAUTHENTICATED:return _e.UNAUTHENTICATED;case _.INVALID_ARGUMENT:return _e.INVALID_ARGUMENT;case _.NOT_FOUND:return _e.NOT_FOUND;case _.ALREADY_EXISTS:return _e.ALREADY_EXISTS;case _.PERMISSION_DENIED:return _e.PERMISSION_DENIED;case _.FAILED_PRECONDITION:return _e.FAILED_PRECONDITION;case _.ABORTED:return _e.ABORTED;case _.OUT_OF_RANGE:return _e.OUT_OF_RANGE;case _.UNIMPLEMENTED:return _e.UNIMPLEMENTED;case _.DATA_LOSS:return _e.DATA_LOSS;default:return y("Unknown status code: "+t)}}var Se=new mt(ht.comparator);function Ce(){return Se}function Ae(){return Ce()}var Ie=new mt(ht.comparator);function Oe(){return Ie}var De=new mt(ht.comparator);function ke(){return De}var Pe=new re(ht.comparator);function Ne(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Pe,r=0,i=t;r<i.length;r++)n=n.add(i[r]);return n}var Me=new re(X);function Re(){return Me}var Le=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ht.comparator(e.key,n.key)}:function(t,e){return ht.comparator(t.key,e.key)},this.keyedMap=Oe(),this.sortedSet=new mt(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Fe=function(t){return t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata",t}({}),Be=function(t){return t[t.Local=0]="Local",t[t.Synced=1]="Synced",t}({}),Ue=function(){function t(){this.changeMap=new mt(ht.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Fe.Added&&n.type===Fe.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Fe.Metadata&&n.type!==Fe.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Fe.Modified&&n.type===Fe.Modified?this.changeMap=this.changeMap.insert(e,{type:Fe.Modified,doc:t.doc}):t.type===Fe.Modified&&n.type===Fe.Added?this.changeMap=this.changeMap.insert(e,{type:Fe.Added,doc:t.doc}):t.type===Fe.Removed&&n.type===Fe.Added?this.changeMap=this.changeMap.remove(e):t.type===Fe.Removed&&n.type===Fe.Modified?this.changeMap=this.changeMap.insert(e,{type:Fe.Removed,doc:n.doc}):t.type===Fe.Added&&n.type===Fe.Removed?this.changeMap=this.changeMap.insert(e,{type:Fe.Modified,doc:t.doc}):y("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Ve=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:Fe.Added,doc:t})}),new t(e,n,Le.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),je=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=qe.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(te.MIN,i,Re(),Ce(),Ne())},t}(),qe=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(w(),n,Ne(),Ne(),Ne())},t}(),Ge=function(){return function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r}}(),He=function(){return function(t,e){this.targetId=t,this.existenceFilter=e}}(),ze=function(t){return t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset",t}({}),We=function(){return function(t,e,n,r){void 0===n&&(n=w()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}(),Ke=function(){function t(){this.pendingResponses=0,this.documentChanges=Ye(),this._resumeToken=w(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=Ne(),e=Ne(),n=Ne();return this.documentChanges.forEach(function(r,i){switch(i){case Fe.Added:t=t.add(r);break;case Fe.Modified:e=e.add(r);break;case Fe.Removed:n=n.add(r);break;default:y("Encountered invalid change type: "+i)}}),new qe(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=Ye()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),Xe=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Ce(),this.pendingDocumentTargetMapping=Qe(),this.pendingTargetResets=new re(X)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof dt?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof ft&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.removeDocumentFromTarget(r=o[i],t.key,t.newDoc)},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case ze.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case ze.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case ze.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),v(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case ze.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case ze.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:y("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):C(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new ht(i.path);this.removeDocumentFromTarget(e,o,new ft(o,te.forDeletedDoc()))}else v(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};C(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var s=new ht(o.query.path);null!==e.pendingDocumentUpdates.get(s)||e.targetContainsDocument(r,s)||e.removeDocumentFromTarget(r,s,new ft(s,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=Ne();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===ee.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new je(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Ce(),this.pendingDocumentTargetMapping=Qe(),this.pendingTargetResets=new re(X),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Fe.Modified:Fe.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Fe.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new Ke),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new re(X),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;v(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new Ke,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function Qe(){return new mt(ht.comparator)}function Ye(){return new mt(ht.comparator)}var Je,$e,Ze=((Je={})[Qt.ASCENDING.name]="ASCENDING",Je[Qt.DESCENDING.name]="DESCENDING",Je),tn=(($e={})[zt.LESS_THAN.name]="LESS_THAN",$e[zt.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",$e[zt.GREATER_THAN.name]="GREATER_THAN",$e[zt.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",$e[zt.EQUAL.name]="EQUAL",$e[zt.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",$e),en=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nn(t,e){v(!jt(t),e+" is missing")}function rn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):y("can't parse "+t)}var on=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?_.UNKNOWN:Te(t.code);return new E(e,t.message||"")},t.prototype.toInt32Value=function(t){return jt(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return jt(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);v(!!t,"Cannot deserialize null or undefined timestamp.");var e=rn(t.seconds||"0");return new nt(e,t.nanos||0)},t.prototype.fromIso8601String=function(t){var e=0,n=en.exec(t);if(v(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new nt(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(v(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Z.fromBase64String(t)):(v(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),Z.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return v(!!t,"Trying to deserialize version that isn't set"),te.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=at.fromString(t);return v(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return v(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),v(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new ht(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?at.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new at(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new at(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return v(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Tt)return{nullValue:"NULL_VALUE"};if(t instanceof xt)return{booleanValue:t.value()};if(t instanceof At)return{integerValue:""+t.value()};if(t instanceof It){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Ot?{stringValue:t.value()}:t instanceof Rt?{mapValue:this.toMapValue(t)}:t instanceof Lt?{arrayValue:this.toArrayValue(t)}:t instanceof Dt?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Mt?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Pt?{bytesValue:this.toBytes(t.value())}:t instanceof Nt?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:y("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this,n=t.value_type;if(sn(t,n,"nullValue"))return Tt.INSTANCE;if(sn(t,n,"booleanValue"))return xt.of(t.booleanValue);if(sn(t,n,"integerValue"))return new At(rn(t.integerValue));if(sn(t,n,"doubleValue")){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return It.NAN;if("Infinity"===t.doubleValue)return It.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return It.NEGATIVE_INFINITY}return new It(t.doubleValue)}if(sn(t,n,"stringValue"))return new Ot(t.stringValue);if(sn(t,n,"mapValue"))return this.fromFields(t.mapValue.fields||{});if(sn(t,n,"arrayValue"))return nn(t.arrayValue,"arrayValue"),new Lt((t.arrayValue.values||[]).map(function(t){return e.fromValue(t)}));if(sn(t,n,"timestampValue"))return nn(t.timestampValue,"timestampValue"),new Dt(this.fromTimestamp(t.timestampValue));if(sn(t,n,"geoPointValue"))return nn(t.geoPointValue,"geoPointValue"),new Mt(new et(t.geoPointValue.latitude||0,t.geoPointValue.longitude||0));if(sn(t,n,"bytesValue")){nn(t.bytesValue,"bytesValue");var r=this.fromBlob(t.bytesValue);return new Pt(r)}if(sn(t,n,"referenceValue")){nn(t.referenceValue,"referenceValue");var i=this.fromResourceName(t.referenceValue),o=new ot(i.get(1),i.get(3)),s=new ht(this.extractLocalPathFromResourceName(i));return new Nt(o,s)}return y("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return v(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new dt(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=Rt.EMPTY;return A(t,function(t,r){n=n.set(new ct([t]),e.fromValue(r))}),n},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){v(!!t.found,"Tried to deserialize a found document from a missing document."),nn(t.found.name,"doc.found.name"),nn(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new dt(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){v(!!t.missing,"Tried to deserialize a missing document from a found document."),v(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new ft(e,n)},t.prototype.fromMaybeDocument=function(t){var e=t.result;return sn(t,e,"found")?this.fromFound(t):sn(t,e,"missing")?this.fromMissing(t):y("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case ze.Added:return"ADD";case ze.Current:return"CURRENT";case ze.NoChange:return"NO_CHANGE";case ze.Removed:return"REMOVE";case ze.Reset:return"RESET";default:return y("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof He)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Ge){var e;if(t.newDoc instanceof dt)return{documentChange:{document:{name:this.toName((e=t.newDoc).key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}};if(t.newDoc instanceof ft)return{documentDelete:{document:this.toName((e=t.newDoc).key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof We){var n=void 0;return t.cause&&(n={code:xe(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return y("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=t.response_type;if(sn(t,n,"targetChange")){nn(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),s=t.targetChange.cause,a=s&&this.fromRpcStatus(s);e=new We(r,i,o,a||null)}else if(sn(t,n,"documentChange")){nn(t.documentChange,"documentChange"),nn(t.documentChange.document,"documentChange.name"),nn(t.documentChange.document.name,"documentChange.document.name"),nn(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=this.fromFields(u.document.fields||{}),d=new dt(c,h,l,{},u.document);e=new Ge(u.targetIds||[],u.removedTargetIds||[],d.key,d)}else if(sn(t,n,"documentDelete")){nn(t.documentDelete,"documentDelete"),nn(t.documentDelete.document,"documentDelete.document");var f=t.documentDelete;c=this.fromName(f.document),h=f.readTime?this.fromVersion(f.readTime):te.forDeletedDoc(),d=new ft(c,h),e=new Ge([],f.removedTargetIds||[],d.key,d)}else if(sn(t,n,"documentRemove")){nn(t.documentRemove,"documentRemove"),nn(t.documentRemove.document,"documentRemove");var p=t.documentRemove;c=this.fromName(p.document),e=new Ge([],p.removedTargetIds||[],c,null)}else{if(!sn(t,n,"filter"))return y("Unknown change type "+JSON.stringify(t));nn(t.filter,"filter"),nn(t.filter.targetId,"filter.targetId");var m=t.filter,g=new we(m.count||0);e=new He(m.targetId,g)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?ze.NoChange:"ADD"===t?ze.Added:"REMOVE"===t?ze.Removed:"CURRENT"===t?ze.Current:"RESET"===t?ze.Reset:y("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!sn(t,t.response_type,"targetChange"))return te.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?te.MIN:e.readTime?this.fromVersion(e.readTime):te.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof le)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof pe)e={delete:this.toName(t.key)};else if(t instanceof de)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof fe))return y("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):ce.NONE;if(t.update){nn(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new de(r,i,o,n)}return new le(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new pe(r,n);if(t.transform){r=this.fromName(t.transform.document);var s=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return v(!0===n.exists,'Transforms only support precondition "exists == true"'),new fe(r,s)}return y("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return v(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:y("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?ce.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ce.exists(t.exists):ce.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=this.fromVersion(t.updateTime?t.updateTime:e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new ae(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(v(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof me)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ge)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof ye)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof ve)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw y("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=t.transform_type,r=null;if(sn(t,n,"setToServerValue"))v("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),r=me.instance;else if(sn(t,n,"appendMissingElements"))r=new ge((t.appendMissingElements.values||[]).map(function(t){return e.fromValue(t)}));else if(sn(t,n,"removeAllFromArray"))r=new ye((t.removeAllFromArray.values||[]).map(function(t){return e.fromValue(t)}));else if(sn(t,n,"increment")){var i=this.fromValue(t.increment);v(i instanceof St,"NUMERIC_ADD transform requires a NumberValue"),r=new ve(i)}else y("Unknown transform proto: "+JSON.stringify(t));var o=ct.fromServerFormat(t.fieldPath);return new se(o,r)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;return v(1===e,"DocumentsTarget contained other than 1 document: "+e),Gt.atPath(this.fromQueryPath(t.documents[0]))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(v(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(v(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){v(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.fromFilter(n.where));var a=[];n.orderBy&&(a=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Gt(e,i,a,s,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case ee.Listen:return null;case ee.ExistenceFilterMismatch:return"existence-filter-mismatch";case ee.LimboResolution:return"limbo-document";default:return y("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Wt?e.toRelationFilter(t):e.toUnaryFilter(t)});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromRelationFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):y("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Yt(r,n)},t.prototype.toDirection=function(t){return Ze[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Qt.ASCENDING;case"DESCENDING":return Qt.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return tn[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return zt.EQUAL;case"GREATER_THAN":return zt.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return zt.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return zt.LESS_THAN;case"LESS_THAN_OR_EQUAL":return zt.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return zt.ARRAY_CONTAINS;case"OPERATOR_UNSPECIFIED":return y("Unspecified relation");default:return y("Unknown relation")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return ct.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new Jt(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.toRelationFilter=function(t){return t instanceof Wt?{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}:y("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromRelationFilter=function(t){return new Wt(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryFilter=function(t){return t instanceof Xt?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}}:t instanceof Kt?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}:y("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return new Xt(e);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return new Kt(n);case"OPERATOR_UNSPECIFIED":return y("Unspecified filter");default:return y("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return ct.fromServerFormat(t)});return oe.fromArray(e)},t}();function sn(t,e,n){return e===n||!e&&n in t}var an=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){v(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){v(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){v(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){v(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){v(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){v(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),un="Connection",cn={BatchGetDocuments:"batchGet",Commit:"commit"},hn="gl-js/ fire/"+c,ln=function(){function t(t){this.databaseId=t.databaseId,this.baseUrl=(t.ssl?"https":"http")+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=hn},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,s){var u=new a.XhrIo;u.listenOnce(a.EventType.COMPLETE,function(){try{switch(u.getLastErrorCode()){case a.ErrorCode.NO_ERROR:var e=u.getResponseJson();p(un,"XHR received:",JSON.stringify(e)),o(e);break;case a.ErrorCode.TIMEOUT:p(un,'RPC "'+t+'" timed out'),s(new E(_.DEADLINE_EXCEEDED,"Request time out"));break;case a.ErrorCode.HTTP_ERROR:var n=u.getStatus();p(un,'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0?s(new E(function(t){switch(t){case 200:return _.OK;case 400:return _.INVALID_ARGUMENT;case 401:return _.UNAUTHENTICATED;case 403:return _.PERMISSION_DENIED;case 404:return _.NOT_FOUND;case 409:return _.ABORTED;case 416:return _.OUT_OF_RANGE;case 429:return _.RESOURCE_EXHAUSTED;case 499:return _.CANCELLED;case 500:return _.UNKNOWN;case 501:return _.UNIMPLEMENTED;case 503:return _.UNAVAILABLE;case 504:return _.DEADLINE_EXCEEDED;default:return t>=200&&t<300?_.OK:t>=400&&t<500?_.FAILED_PRECONDITION:t>=500&&t<600?_.INTERNAL:_.UNKNOWN}}(n),"Server responded with status "+u.getStatusText())):(p(un,'RPC "'+t+'" failed'),s(new E(_.UNAVAILABLE,"Connection failed.")));break;default:y('RPC "'+t+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{p(un,'RPC "'+t+'" completed.')}});var c=JSON.stringify(e);p(un,"XHR sending: ",i+" "+c);var h={"Content-Type":"text/plain"};r.modifyHeadersForRequest(h,n),u.send(i,"POST",c,h,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=a.createWebChannelTransport(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),u.isReactNative()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");p(un,"Creating WebChannel: "+o+" "+i);var s=r.createWebChannel(o,i),c=!1,h=!1,l=new an({sendFn:function(t){h?p(un,"Not sending because WebChannel is closed:",t):(c||(p(un,"Opening WebChannel transport."),s.open(),c=!0),p(un,"WebChannel sending:",t),s.send(t))},closeFn:function(){return s.close()}}),d=function(t,e){s.listen(t,function(t){try{e(t)}catch(n){setTimeout(function(){throw n},0)}})};return d(a.WebChannel.EventType.OPEN,function(){h||p(un,"WebChannel transport opened.")}),d(a.WebChannel.EventType.CLOSE,function(){h||(h=!0,p(un,"WebChannel transport closed"),l.callOnClose())}),d(a.WebChannel.EventType.ERROR,function(t){h||(h=!0,p(un,"WebChannel transport errored:",t),l.callOnClose(new E(_.UNAVAILABLE,"The operation could not be completed")))}),d(a.WebChannel.EventType.MESSAGE,function(t){if(!h){var e=t.data[0];v(!!e,"Got a webchannel message without data.");var n=e.error||e[0]&&e[0].error;if(n){p(un,"WebChannel received error:",n);var r=n.status,i=function(t){var e=_e[r];if(void 0!==e)return Te(e)}(),o=n.message;void 0===i&&(i=_.INTERNAL,o="Unknown error status: "+r+" with message "+n.message),h=!0,l.callOnClose(new E(i,o)),s.close()}else p(un,"WebChannel received:",e),l.callOnMessage(e)}}),setTimeout(function(){l.callOnOpen()},0),l},t.prototype.makeUrl=function(t){var e=cn[t];v(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}();b.setPlatform(new(function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new ln(t))},t.prototype.newSerializer=function(t){return new on(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}()));var dn=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),fn=function(){return function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}}(),pn=function(t){return t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection",t}({}),mn=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new fn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new E(_.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),gn=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var e=this;this.verifyNotFailed();var n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw m("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),v(e>=0,"Attempted to schedule an operation with a negative delay of "+e),v(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=mn.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&y("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){v(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){v(t===pn.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==pn.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);v(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),yn="\x01",vn="\x01",bn="\x10",wn="\x11";function _n(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Tn(e)),e=En(t.get(n),e);return Tn(e)}function En(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=yn+bn;break;case yn:n+=yn+wn;break;default:n+=o}}return n}function Tn(t){return t+yn+vn}function xn(t){var e=t.length;if(v(e>=2,"Invalid path "+t),2===e)return v(t.charAt(0)===yn&&t.charAt(1)===vn,"Non-empty path "+t+" had length 2"),at.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf(yn,o);switch((s<0||s>n)&&y('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case vn:var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case bn:i+=t.substring(o,s),i+="\0";break;case wn:i+=t.substring(o,s+1);break;default:y('Invalid encoded resource path: "'+t+'"')}o=s+2}return new at(r)}var Sn=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,v(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&v(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;v(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=o.applyToRemoteDocument(e,r[i]))}return e},t.prototype.applyToLocalView=function(t,e){e&&v(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ne())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Q(this.mutations,t.mutations)&&Q(this.baseMutations,t.baseMutations)},t}(),Cn=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){v(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=ke(),s=e.mutations,a=0;a<s.length;a++)o=o.insert(s[a].key,r[a].version);return new t(e,n,r,i,o)},t}(),An=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&y("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),In=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return v(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pn(t).iterate({index:lr.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=kn(n),Mn(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=kn(e),Mn(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Nn(t),s=Pn(t);return s.add({}).next(function(a){v("number"==typeof a,"Auto-generated key is not a number");var u=new Sn(a,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[a]=u.keys();for(var h=[],l=0,d=r;l<d.length;l++){var f=d[l],p=dr.key(i.userId,f.key.path,a);h.push(s.put(c)),h.push(o.put(p,dr.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,f.key.path.popLast()))}return An.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Pn(t).get(e).next(function(t){return t?(v(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?An.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this;return this.getMutationQueueMetadata(t).next(function(r){var i=e+1,o=IDBKeyRange.lowerBound([n.userId,i]),s=null;return Pn(t).iterate({index:lr.userMutationsIndex,range:o},function(t,e,r){e.userId===n.userId&&(v(e.batchId>=i,"Should have found mutation after "+i),s=n.serializer.fromDbMutationBatch(e)),r.done()}).next(function(){return s})})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Pn(t).loadAll(lr.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=dr.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Nn(t).iterate({range:i},function(r,i,s){var a=r[0],u=r[2],c=xn(r[1]);if(a===n.userId&&e.path.isEqual(c))return Pn(t).get(u).next(function(t){if(!t)throw y("Dangling document-mutation reference found: "+r+" which points to "+u);v(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+u),o.push(n.serializer.fromDbMutationBatch(t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new re(X),i=[];return e.forEach(function(e){var o=dr.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Nn(t).iterate({range:s},function(t,i,o){var s=t[0],a=t[2],u=xn(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),An.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;v(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),v(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=dr.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new re(X);return Nn(t).iterate({range:s},function(t,e,o){var s=t[0],u=t[2],c=xn(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.lookupMutationBatches(t,a)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Pn(t).get(e).next(function(t){if(null===t)throw y("Dangling document-mutation reference found, which points to "+e);v(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),An.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Dn(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),An.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return An.resolve();var r=IDBKeyRange.lowerBound(dr.prefixForUser(e.userId)),i=[];return Nn(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=xn(t[1]);i.push(o)}else r.done()}).next(function(){v(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return On(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return Mn(t).get(this.userId).next(function(t){return t||new hr(e.userId,-1,"")})},t}();function On(t,e,n){var r=dr.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Nn(t).iterate({range:o,keysOnly:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function Dn(t,e,n){var r=t.store(lr.store),i=t.store(dr.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.iterate({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){v(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var d=l[h],f=dr.key(e,d.key.path,n.batchId);o.push(i.delete(f)),c.push(d.key)}return An.waitFor(o).next(function(){return c})}function kn(t){return t instanceof Uint8Array?(v("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Pn(t){return Ur.getStore(t,lr.store)}function Nn(t){return Ur.getStore(t,dr.store)}function Mn(t){return Ur.getStore(t,hr.store)}var Rn=1,Ln=function(t){return t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine",t}({}),Fn=function(){function t(t,e){this.generatorId=t,v((t&Rn)===t,"Generator ID "+t+" contains more than "+Rn+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<Rn,t},t.prototype.after=function(t){return this.seek(t+(1<<Rn)),this.next()},t.prototype.seek=function(t){v((t&Rn)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(Ln.QueryCache,2)},t.forSyncEngine=function(){return new t(Ln.SyncEngine)},t}(),Bn=function(){function t(t){this.db=t}return t.openOrCreate=function(e,n,r){return v(t.isAvailable(),"IndexedDB not supported in current environment."),p("SimpleDb","Opening database:",e),new An(function(i,o){var s=window.indexedDB.open(e,n);s.onsuccess=function(e){i(new t(e.target.result))},s.onblocked=function(){o(new E(_.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=function(t){var e=t.target.error;o("VersionError"===e.name?new E(_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):e)},s.onupgradeneeded=function(t){p("SimpleDb",'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new Vn(s.transaction);r.createOrUpgrade(n,i,t.oldVersion,sr).next(function(){p("SimpleDb","Database upgrade to version "+sr+" complete")})}}).toPromise()},t.delete=function(t){return p("SimpleDb","Removing database:",t),qn(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var e=window.navigator.userAgent,n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_")[0]:"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.runTransaction=function(t,e,n){var r=Vn.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),An.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),Un=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return qn(this.dbCursor.delete())},t}(),Vn=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new fn,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){e.completionDeferred.reject(t.target.error)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(p("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return v(!!e,"Object store not part of transaction: "+t),new jn(e)},t}(),jn=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(p("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(p("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),qn(n)},t.prototype.add=function(t){return p("SimpleDb","ADD",this.store.name,t,t),qn(this.store.add(t))},t.prototype.get=function(t){var e=this;return qn(this.store.get(t)).next(function(n){return void 0===n&&(n=null),p("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return p("SimpleDb","DELETE",this.store.name,t),qn(this.store.delete(t))},t.prototype.count=function(){return p("SimpleDb","COUNT",this.store.name),qn(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){p("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new An(function(n,r){e.onerror=function(t){r(t.target.error)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new An(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Un(i),s=e(i.primaryKey,i.value,o);if(s instanceof An){var a=s.catch(function(t){return o.done(),An.reject(t)});n.push(a)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return An.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(v(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function qn(t){return new An(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){n(t.target.error)}})}var Gn=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Fn.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return te.fromTimestamp(new nt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return Wn(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Hn(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return v(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Hn(t).iterate(function(s,a){var u=r.serializer.fromDbTarget(a);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return An.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return Hn(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return zn(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,Ur.getStore(n,br.store)).put(br.key,e);var n},t.prototype.saveQueryData=function(t,e){return Hn(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Hn(t).iterate({range:i,index:yr.queryTargetsIndexName},function(t,r,i){var s=n.serializer.fromDbTarget(r);e.isEqual(s.query)&&(o=s,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Kn(t);return e.forEach(function(e){var s=_n(e.path);i.push(o.put(new vr(n,s))),i.push(r.referenceDelegate.addReference(t,e))}),An.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Kn(t);return An.forEach(e,function(e){var o=_n(e.path);return An.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Kn(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Kn(t),i=Ne();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=xn(t[1]),o=new ht(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=_n(e.path),r=IDBKeyRange.bound([n],[Y(n)],!1,!0),i=0;return Kn(t).iterate({index:vr.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return Hn(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function Hn(t){return Ur.getStore(t,yr.store)}function zn(t){return Bn.getStore(t,br.store).get(br.key).next(function(t){return v(null!==t,"Missing metadata row."),t})}function Wn(t){return zn(t).next(function(t){return t.highestListenSequenceNumber})}function Kn(t){return Ur.getStore(t,vr.store)}var Xn=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(o[0].isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){A(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return I(this.inner)},t}(),Qn=function(){function t(){this.changes=Ce(),this.documentSizes=new Xn(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?An.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return v(null!==this.changes,"Changes have already been applied."),this.changes},t}(),Yn="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Jn=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=Bn.getStore(t,Er.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(e.length>0){for(var i=tr(t),o=Ne(),s=0,a=e;s<a.length;s++){var u=a[s],c=u.key,h=u.doc;r.push(i.put(nr(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(er(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return An.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=tr(t),r=nr(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return rr(t)}):An.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return tr(t).get(nr(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return tr(t).get(nr(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:rr(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Ae();return this.forEachDbEntry(t,e,function(t,e){r=r.insert(t,e?n.serializer.fromDbRemoteDocument(e):null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ae(),i=new mt(ht.comparator);return this.forEachDbEntry(t,e,function(t,e){e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i=i.insert(t,rr(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return An.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return tr(t).iterate({range:r},function(t,e,r){for(var s=ht.fromSegments(t);o&&ht.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;v(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Oe(),i=e.path.length+1,o=e.path.toArray(),s=IDBKeyRange.lowerBound(o);return tr(t).iterate({range:s},function(t,o,s){if(t.length===i){var a=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(a.key.path)?a instanceof dt&&e.matches(a)&&(r=r.insert(a.key,a)):s.done()}}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;v(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Ne(),r=Ce(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,s=er(t);return s.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(s).next(function(){return An.reject(new E(_.DATA_LOSS,Yn))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new ft(n,te.forDeletedDoc());r=r.insert(n,e)}))}),An.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return er(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new Zn(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return $n(t).get(gr.key).next(function(t){return v(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return $n(t).put(gr.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function $n(t){return Ur.getStore(t,gr.store)}var Zn=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return s.__extends(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentCache.serializer.toDbRemoteDocument(n),s=e.documentSizes.get(t);v(void 0!==s,"Attempting to change document "+t.toString()+" without having read it first");var a=rr(o);r+=a-s,i.push({key:t,doc:o})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(Qn);function tr(t){return Ur.getStore(t,mr.store)}function er(t){return Ur.getStore(t,Er.store)}function nr(t){return t.path.toArray()}function rr(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw y("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var ir=function(){function t(){this.collectionParentIndex=new or}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),An.resolve()},t.prototype.getCollectionParents=function(t,e){return An.resolve(this.collectionParentIndex.getEntries(e))},t}(),or=function(){function t(){this.index={}}return t.prototype.add=function(t){v(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new re(at.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new re(at.comparator)).toArray()},t}(),sr=8,ar=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;v(n<r&&n>=0&&r<=sr,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(cr.store)}(t),function(t){t.createObjectStore(hr.store,{keyPath:hr.keyPath}),t.createObjectStore(lr.store,{keyPath:lr.keyPath,autoIncrement:!0}).createIndex(lr.userMutationsIndex,lr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(dr.store)}(t),_r(t),function(t){t.createObjectStore(mr.store)}(t));var o=An.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(vr.store),t.deleteObjectStore(yr.store),t.deleteObjectStore(br.store)}(t),_r(t)),o=o.next(function(){return function(t){var e=t.store(br.store),n=new br(0,0,te.MIN.toTimestamp(),0);return e.put(br.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(lr.store).loadAll().next(function(n){t.deleteObjectStore(lr.store),t.createObjectStore(lr.store,{keyPath:lr.keyPath,autoIncrement:!0}).createIndex(lr.userMutationsIndex,lr.userMutationsKeyPath,{unique:!0});var r=e.store(lr.store),i=n.map(function(t){return r.put(t)});return An.waitFor(i)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(Tr.store,{keyPath:Tr.keyPath})}(t),function(t){t.createObjectStore(Er.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(gr.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&r>=8&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(mr.store).iterate(function(t,n){e+=rr(n)}).next(function(){var n=new gr(e);return t.store(gr.store).put(gr.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(hr.store),r=t.store(lr.store);return n.loadAll().next(function(n){return An.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(lr.userMutationsIndex,i).next(function(r){return An.forEach(r,function(r){v(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Dn(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(vr.store),n=t.store(mr.store);return Wn(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new at(n),s=function(t){return[0,_n(t)]}(o);r.push(e.get(s).next(function(n){return n?An.resolve():function(n){return e.put(new vr(0,_n(n),t))}(o)}))}).next(function(){return An.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(wr.store,{keyPath:wr.keyPath});var n=e.store(wr.store),r=new or,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:_n(i)})}};return e.store(mr.store).iterate({keysOnly:!0},function(t,e){var n=new at(t);return i(n.popLast())}).next(function(){return e.store(dr.store).iterate({keysOnly:!0},function(t,e){var n=xn(t[1]);return i(n.popLast())})})},t}(),ur=function(){return function(t,e){this.seconds=t,this.nanoseconds=e}}(),cr=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}(),hr=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),lr=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}(),dr=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,_n(e)]},t.key=function(t,e,n){return[t,_n(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}(),fr=function(){return function(t,e){this.path=t,this.readTime=e}}(),pr=function(){return function(t,e){this.path=t,this.version=e}}(),mr=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),gr=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}(),yr=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),vr=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,v(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),br=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),wr=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function _r(t){t.createObjectStore(vr.store,{keyPath:vr.keyPath}).createIndex(vr.documentTargetsIndex,vr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(yr.store,{keyPath:yr.keyPath}).createIndex(yr.queryTargetsIndexName,yr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(br.store)}var Er=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}(),Tr=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}(),xr=[hr.store,lr.store,dr.store,mr.store,yr.store,cr.store,br.store,vr.store].concat([Tr.store,Er.store]).concat([gr.store]).concat([wr.store]),Sr=function(){function t(){this.collectionParentsCache=new or}return t.prototype.addToCollectionParentIndex=function(t,e){if(v(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){v(e.length>=1,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Cr(t).put({collectionId:n,parent:_n(r)})}return An.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Y(e),""],!1,!0);return Cr(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(xn(o.parent))}return n})},t}();function Cr(t){return Ur.getStore(t,wr.store)}var Ar=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=ht.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new ft(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=ht.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new pt(e,n)):y("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof dt){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t);return new mr(null,null,e,i=t.hasCommittedMutations)}if(t instanceof ft){var n=t.key.path.toArray(),r=this.toDbTimestamp(t.version),i=t.hasCommittedMutations;return new mr(null,new fr(n,r),null,i)}return t instanceof pt?(n=t.key.path.toArray(),r=this.toDbTimestamp(t.version),new mr(new pr(n,r),null,null,!0)):y("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new ur(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new nt(t.seconds,t.nanoseconds);return te.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new lr(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=nt.fromMillis(t.localWriteTimeMs);return new Sn(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(_n(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=Ne(),n=0,r=t;n<r.length;n++)e=e.add(new ht(xn(r[n])));return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new ne(e,t.targetId,ee.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){v(ee.Listen===t.purpose,"Only queries with purpose "+ee.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(v("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new yr(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Ir(t,e){var n=t[1],r=e[1],i=X(t[0],e[0]);return 0===i?X(n,r):i}var Or=function(){function t(t){this.maxElements=t,this.buffer=new re(Ir),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ir(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Dr={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},kr=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),Pr=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){v(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==kr.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;v(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;p("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(pn.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Vr)})},t}(),Nr=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return An.resolve(dn.INVALID);var r=new Or(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===kr.COLLECTION_DISABLED?(p("LruGarbageCollector","Garbage collection skipped; disabled"),An.resolve(Dr)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(p("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Dr):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,s,a,u,c,h=this;return o=Date.now(),this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>h.params.maximumSequenceNumbersToCollect?(p("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),d()<=l.DEBUG&&p("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-o)+"ms\n\tDetermined least recently used "+r+" in "+(a-s)+"ms\n\tRemoved "+i+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-o)+"ms"),An.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Mr="IndexedDbPersistence",Rr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Lr="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.",Fr="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",Br=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return s.__extends(e,t),e}(function(){return function(){}}()),Ur=function(){function t(e,n,r,i,o,s,a){if(this.persistenceKey=e,this.clientId=n,this.queue=i,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!t.isAvailable())throw new E(_.UNIMPLEMENTED,Fr);if(this.referenceDelegate=new Gr(this,s),this.dbName=e+t.MAIN_DATABASE,this.serializer=new Ar(o),this.document=r.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new Gn(this.referenceDelegate,this.serializer),this.indexManager=new Sr,this.remoteDocumentCache=new Jn(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new E(_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof Br)return Bn.getStore(t.simpleDbTransaction,e);throw y("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e,n,r,i,o,a){return s.__awaiter(this,void 0,void 0,function(){var u;return s.__generator(this,function(s){switch(s.label){case 0:return[4,(u=new t(e,n,r,i,o,a)).start()];case 1:return s.sent(),[2,u]}})})},t.createMultiClientIndexedDbPersistence=function(e,n,r,i,o,a,u){return s.__awaiter(this,void 0,void 0,function(){var c;return s.__generator(this,function(s){switch(s.label){case 0:return[4,(c=new t(e,n,r,i,o,a,u)).start()];case 1:return s.sent(),[2,c]}})})},t.prototype.start=function(){var t=this;return v(!this.started,"IndexedDbPersistence double-started!"),v(null!==this.window,"Expected 'window' to be defined"),Bn.openOrCreate(this.dbName,sr,new ar(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[br.store],function(e){return Wn(e).next(function(e){t.listenSequence=new dn(e,t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",xr,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return s.__awaiter(e,void 0,void 0,function(){return s.__generator(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return s.__awaiter(e,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",xr,function(e){return qr(e).put(new Tr(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return jr(t).get(cr.key).next(function(t){return An.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return qr(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return s.__awaiter(this,void 0,void 0,function(){var e,n,r=this;return s.__generator(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,Tr.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return An.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(pn.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return jr(t).get(cr.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new E(_.FAILED_PRECONDITION,Lr);return!1}}return!(!e.networkEnabled||!e.inForeground)||qr(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&p(Mr,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return s.__awaiter(this,void 0,void 0,function(){var t=this;return s.__generator(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[cr.store,Tr.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[Tr.store],function(e){return qr(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},t.clearPersistence=function(e){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(n){switch(n.label){case 0:return t.isAvailable()?[4,Bn.delete(e+t.MAIN_DATABASE)]:[2,Promise.resolve()];case 1:return n.sent(),[2]}})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return v(this.started,"Cannot initialize MutationQueue before persistence is started."),In.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getQueryCache=function(){return v(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return v(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return v(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;return p(Mr,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",xr,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw m("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new E(_.FAILED_PRECONDITION,Rr);return n(new Br(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new Br(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return jr(t).get(cr.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new E(_.FAILED_PRECONDITION,Lr)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new cr(this.clientId,this.allowTabSynchronization,Date.now());return jr(t).put(cr.key,e)},t.isAvailable=function(){return Bn.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=jr(t);return n.get(cr.key).next(function(t){return e.isLocalClient(t)?(p(Mr,"Releasing primary lease."),n.delete(cr.key)):An.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(m("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(v(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(v("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return p(Mr,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(n){return m(Mr,"Failed to get zombied client id.",n),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){m("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Vr(t){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){if(!function(t){return t.code===_.FAILED_PRECONDITION&&t.message===Rr}(t))throw t;return p(Mr,"Unexpectedly lost primary lease"),[2]})})}function jr(t){return t.store(cr.store)}function qr(t){return t.store(Tr.store)}var Gr=function(){function t(t,e){this.db=t,this.garbageCollector=new Nr(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Hr(t,e)},t.prototype.removeReference=function(t,e){return Hr(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Hr(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?An.resolve(!0):function(t,e){var n=!1;return Mn(t).iterateSerial(function(r){return On(t,r,e).next(function(t){return t&&(n=!0),An.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(s,a){if(a<=e){var u=n.isPinned(t,s).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,s).next(function(t){i+=t})});o.push(u)}}).next(function(){return An.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return An.waitFor([Kn(t).delete((n=e,[0,_n(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Hr(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=Kn(t),i=dn.INVALID;return r.iterate({index:vr.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==dn.INVALID&&e(new ht(xn(n)),i),i=s,n=o):i=dn.INVALID}).next(function(){i!==dn.INVALID&&e(new ht(xn(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Hr(t,e){return Kn(t).put(function(t,e){return new vr(0,_n(t.path),e)}(e,t.currentSequenceNumber))}var zr=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Ae();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Ce();return i.forEach(function(t,e){e||(e=new ft(t,te.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new ht(e)).next(function(t){var e=Oe();return t instanceof dt&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;v(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=Oe();return this.indexManager.getCollectionParents(t,r).next(function(o){return An.forEach(o,function(o){var s=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,s).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(i){return n=i,r.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(t){for(var r=0,i=t;r<i.length;r++)for(var o=i[r],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key;if(e.path.isImmediateParentOf(c.path)){var h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof dt?n.insert(c,l):n.remove(c)}}}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t}(),Wr=function(){function t(){this.refsByKey=new re(Kr.compareByKey),this.refsByTarget=new re(Kr.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new Kr(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new Kr(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=ht.EMPTY,r=new Kr(n,t),i=new Kr(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=ht.EMPTY,n=new Kr(e,t),r=new Kr(e,t+1),i=Ne();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Kr(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Kr=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return ht.comparator(t.key,e.key)||X(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return X(t.targetOrBatchId,e.targetOrBatchId)||ht.comparator(t.key,e.key)},t}(),Xr=function(){function t(t,e){this.persistence=t,this.localViewReferences=new Wr,this.queryDataByTarget={},v(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new zr(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new zr(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],s=Ne(),a=0,u=r;a<u.length;a++){i.push((f=u[a]).batchId);for(var c=0,h=f.mutations;c<h.length;c++)s=s.add(h[c].key)}for(var l=0,d=t;l<d.length;l++){var f;o.push((f=d[l]).batchId);for(var p=0,m=f.mutations;p<m.length;p++)s=s.add(m[p].key)}return e.localDocuments.getDocuments(n,s).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this,n=nt.now(),r=t.reduce(function(t,e){return t.add(e.key)},Ne());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],s=0,a=t;s<a.length;s++){var u=a[s],c=r.get(u.key);if(!u.isIdempotent){var h=u.fieldMask;if(h){var l=c instanceof dt?h.applyTo(c.data):Rt.EMPTY;o.push(new de(u.key,l,h,ce.exists(!0)))}}}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):An.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return v(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],s=Ne();C(e.targetChanges,function(r,a){var u=n.queryDataByTarget[r];if(u){a.addedDocuments.forEach(function(t){s=s.add(t)}),a.modifiedDocuments.forEach(function(t){s=s.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,a.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,a.addedDocuments,r)}));var c=a.resumeToken;if(c.length>0){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,a)&&o.push(n.queryCache.updateQueryData(i,u))}}});var a=Ce(),u=Ne();e.documentUpdates.forEach(function(t,e){u=u.add(t)}),o.push(r.getEntries(i,u).next(function(t){e.documentUpdates.forEach(function(u,c){var h=t.get(u);null==h||c.version.isEqual(te.MIN)||s.has(c.key)&&!h.hasPendingWrites||c.version.compareTo(h.version)>=0?(r.addEntry(c),a=a.insert(u,c)):p("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(u)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))})}));var c=e.snapshotVersion;if(!c.isEqual(te.MIN)){var h=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return v(c.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+c+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,c)});o.push(h)}return An.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,a)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return An.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),An.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,An.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new ne(t,i,ee.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return v(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this;return this.persistence.runTransaction("Release query",e?"readwrite":"readwrite-primary",function(r){return n.queryCache.getQueryData(r,t).next(function(i){v(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,s=n.queryDataByTarget[o],a=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?An.resolve():An.forEach(a,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,s)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=An.resolve();return o.forEach(function(r){s=s.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,s=e.docVersions.get(r);v(null!==s,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(s)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):v(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),s.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),Qr=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=w(),this.batchesByDocumentKey=new re(Kr.compareByKey)}return t.prototype.checkEmpty=function(t){return An.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");v(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return v(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,An.resolve()},t.prototype.getLastStreamToken=function(t){return An.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,An.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){v(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&v(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Sn(i,e,n,r);this.mutationQueue.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Kr(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return An.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return An.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return v(null!=n,"Failed to find local mutation batch."),An.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.indexOfBatchId(e+1),r=n<0?0:n;return An.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)},t.prototype.getAllMutationBatches=function(t){return An.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Kr(e,0),i=new Kr(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){v(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);v(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),An.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new re(X);return e.forEach(function(t){var e=new Kr(t,0),i=new Kr(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){v(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),An.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){v(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;ht.isDocumentKey(i)||(i=i.child(""));var o=new Kr(new ht(i),0),s=new re(X);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.targetOrBatchId)),!0)},o),An.resolve(this.findMutationBatches(s))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;v(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return An.forEach(e.mutations,function(i){var o=new Kr(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new Kr(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return An.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&v(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),An.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return v(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return v(n.batchId===t,"If found batch must match"),n},t}(),Yr=function(){function t(t){this.persistence=t,this.queries=new Xn(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=te.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Wr,this.targetCount=0,this.targetIdGenerator=Fn.forQueryCache()}return t.prototype.getTargetCount=function(t){return An.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),An.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return An.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return An.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,An.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),An.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return v(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,An.resolve()},t.prototype.updateQueryData=function(t,e){return v(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),An.resolve()},t.prototype.removeQueryData=function(t,e){return v(this.targetCount>0,"Removing a target from an empty cache"),v(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,An.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(s,a){a.sequenceNumber<=e&&!n[a.targetId]&&(r.queries.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),An.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return An.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return An.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return y("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),An.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),An.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),An.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return An.resolve(n)},t.prototype.containsKey=function(t,e){return An.resolve(this.references.containsKey(e))},t}(),Jr=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new mt(ht.comparator),this.newDocumentChanges=Ne(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var s=o[i],a=s.maybeDocument.key;this.docs=this.docs.insert(a,s),this.newDocumentChanges=this.newDocumentChanges.add(a),r.push(this.indexManager.addToCollectionParentIndex(t,a.path.popLast()))}return this.size+=n,An.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,An.resolve(n.size)):An.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return An.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return An.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ae();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),An.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ae(),i=new mt(ht.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),An.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){v(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Oe(),r=new ht(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),s=o.value.maybeDocument;if(!e.path.isPrefixOf(o.key.path))break;s instanceof dt&&e.matches(s)&&(n=n.insert(s.key,s))}return An.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return An.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=Ce();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new ft(t,te.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=Ne(),An.resolve(n)},t.prototype.newChangeBuffer=function(){return new $r(this.sizer,this)},t.prototype.getSize=function(t){return An.resolve(this.size)},t}(),$r=function(t){function e(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return s.__extends(e,t),e.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentSizes.get(t);v(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var s=e.sizer(n);r+=s-o,i.push({maybeDocument:n,size:s})}),this.documentCache.addEntries(t,i,r)},e.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},e}(Qn),Zr=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new dn(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new Yr(this),this.indexManager=new ir,this.remoteDocumentCache=new Jr(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new ni(t,new Ar(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new ei(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new Qr(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;p("MemoryPersistence","Starting transaction:",t);var i=new ti(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return An.or((n=this.mutationQueues,r=[],A(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),ti=function(){return function(t){this.currentSequenceNumber=t}}(),ei=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),An.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),An.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),An.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return An.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?An.resolve():n.removeEntry(t,r).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return An.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return An.resolve(n.inMemoryPins.containsKey(e))}])},t}(),ni=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new Xn(function(t){return _n(t.path)}),this.garbageCollector=new Nr(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return An.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return An.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?An.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?An.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),An.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),An.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),An.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),An.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw y("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return An.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return An.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return An.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),ri=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&p("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}(),ii=function(t){return t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff",t}({}),oi=1e3,si=6e4,ai=1.5,ui=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=ii.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new ri(t,e,oi,ai,si)}return t.prototype.isStarted=function(){return this.state===ii.Starting||this.state===ii.Open||this.state===ii.Backoff},t.prototype.isOpen=function(){return this.state===ii.Open},t.prototype.start=function(){this.state!==ii.Error?(v(this.state===ii.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(ii.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){v(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=ii.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){return this.isOpen()?[2,this.close(ii.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(n){switch(n.label){case 0:return v(this.isStarted(),"Only started streams should be closed."),v(t===ii.Error||jt(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==ii.Error?this.backoff.reset():e&&e.code===_.RESOURCE_EXHAUSTED?(m(e.toString()),m("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===_.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;v(this.state===ii.Initial,"Must be in initial state to auth"),this.state=ii.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new E(_.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;v(this.state===ii.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return v(e.state===ii.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=ii.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;v(this.state===ii.Error,"Should only perform backoff when in Error state"),this.state=ii.Backoff,this.backoff.backoffAndRun(function(){return s.__awaiter(t,void 0,void 0,function(){return s.__generator(this,function(t){return v(this.state===ii.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=ii.Initial,this.start(),v(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return v(this.isStarted(),"Can't handle server close on non-started stream"),p("PersistentStream","close with error: "+t),this.stream=null,this.close(ii.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(p("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),ci=function(t){function e(e,n,r,i,o){var s=t.call(this,e,pn.ListenStreamConnectionBackoff,pn.ListenStreamIdle,n,r,o)||this;return s.serializer=i,s}return s.__extends(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(ui),hi=function(t){function e(e,n,r,i,o){var s=t.call(this,e,pn.WriteStreamConnectionBackoff,pn.WriteStreamIdle,n,r,o)||this;return s.serializer=i,s.handshakeComplete_=!1,s}return s.__extends(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(v(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return v(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){v(this.isOpen(),"Writing handshake requires an opened stream"),v(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;v(this.isOpen(),"Writing mutations requires an opened stream"),v(this.handshakeComplete_,"Handshake must be complete before writing mutations"),v(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(ui),li=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new hi(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new ci(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=Ce();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);v(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===_.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===_.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),di=function(){function t(t){this.datastore=t,this.readVersions=ke(),this.mutations=[],this.committed=!1}return t.prototype.recordVersion=function(t){var e;if(t instanceof dt)e=t.version;else{if(!(t instanceof ft))throw y("Document in a transaction was a "+t.constructor.name);e=te.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new E(_.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.lookup=function(t){var e=this;return this.committed?Promise.reject("Transaction has already completed."):this.mutations.length>0?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof ft||t instanceof dt?e.recordVersion(t):y("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.write=function(t){if(this.committed)throw new E(_.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(t)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return e?ce.updateTime(e):ce.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(e&&e.isEqual(te.forDeletedDoc()))throw new E(_.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return e?ce.updateTime(e):ce.exists(!0)},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t)))},t.prototype.update=function(t,e){this.write(e.toMutations(t,this.preconditionForUpdate(t)))},t.prototype.delete=function(t){this.write([new pe(t,this.precondition(t))]),this.readVersions=this.readVersions.insert(t,te.forDeletedDoc())},t.prototype.commit=function(){var t=this,e=this.readVersions;return this.mutations.forEach(function(t){e=e.remove(t.key)}),e.isEmpty()?this.datastore.commit(this.mutations).then(function(){t.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},t}(),fi=function(t){return t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline",t}({}),pi=function(t){return t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState",t}({}),mi=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=fi.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(fi.Unknown),v(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(pn.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,v(t.state===fi.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(fi.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===fi.Online?(this.setAndBroadcast(fi.Unknown),v(0===this.watchStreamFailures,"watchStreamFailures must be 0"),v(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(fi.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===fi.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(m(e),this.shouldWarnClientIsOffline=!1):p("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),gi=function(){function t(t,e,n,r){this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new mi(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return s.__awaiter(this,void 0,void 0,function(){var t;return s.__generator(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(fi.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(fi.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(p("RemoteStore","Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return p("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(fi.Unknown),[2]}})})},t.prototype.listen=function(t){v(!x(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){v(x(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),I(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(fi.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){v(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new Xe(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!I(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return s.__awaiter(this,void 0,void 0,function(){var t=this;return s.__generator(this,function(e){return C(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){return void 0===t&&v(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(fi.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return s.__awaiter(this,void 0,void 0,function(){var n;return s.__generator(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(fi.Online),t instanceof We&&t.state===ze.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof Ge?this.watchChangeAggregator.handleDocumentChange(t):t instanceof He?this.watchChangeAggregator.handleExistenceFilter(t):(v(t instanceof We,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(te.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;v(!t.isEqual(te.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return C(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:w()}),e.sendUnwatchRequest(t);var r=new ne(n.query,t,ee.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;v(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return s.__awaiter(e,void 0,void 0,function(){return s.__generator(this,function(e){return x(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return s.__awaiter(this,void 0,void 0,function(){var t;return s.__generator(this,function(e){switch(e.label){case 0:return this.canAddToWritePipeline()?[4,this.localStore.nextMutationBatch(this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1)]:[3,4];case 1:return null!==(t=e.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(t),[4,this.fillWritePipeline()];case 3:e.sent(),e.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){v(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){v(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++)t.writeStream.writeMutations(n[e].mutations)}).catch(Vr)},t.prototype.onMutationResult=function(t,e){var n=this;v(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Cn.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return s.__awaiter(this,void 0,void 0,function(){var e=this;return s.__generator(this,function(n){return void 0===t&&v(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},t.prototype.handleHandshakeError=function(t){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){return Ee(t.code)?(p("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=w(),[2,this.localStore.setLastStreamToken(w()).catch(Vr)]):[2]})})},t.prototype.handleWriteError=function(t){return s.__awaiter(this,void 0,void 0,function(){var e,n=this;return s.__generator(this,function(r){return Ee(i=t.code)&&i!==_.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new di(this.datastore)},t.prototype.handleCredentialChange=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(p("RemoteStore","RemoteStore restarting streams for new credential"),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return t.sent(),this.onlineStateTracker.set(fi.Unknown),[4,this.enableNetwork()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.applyPrimaryState=function(t){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(fi.Unknown),e.label=4;case 4:return[2]}})})},t}(),yi=function(){return function(){this.listeners=[]}}(),vi=function(){function t(t){this.syncEngine=t,this.queries=new Xn(function(t){return t.canonicalId()}),this.onlineState=fi.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new yi,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return s.__awaiter(this,void 0,void 0,function(){var e,n,r,i;return s.__generator(this,function(o){return n=!1,(r=this.queries.get(e=t.query))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=this.queries.get(r.query);if(i){for(var o=0,s=i.listeners;o<s.length;o++)s[o].onViewSnapshot(r);i.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++)i[r].applyOnlineStateChange(t)})},t}(),bi=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=fi.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(v(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Fe.Metadata&&e.push(i)}t=new Ve(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){return v(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache||(this.options.waitForSyncWhenOnline&&e!==fi.Offline?(v(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===fi.Offline)},t.prototype.shouldRaiseEvent=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){v(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Ve.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),wi=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=Ne(),i=Ne(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case Fe.Added:r=r.add(a.doc.key);break;case Fe.Removed:i=i.add(a.doc.key)}}return new t(e,r,i)},t}(),_i=function(){return function(t){this.key=t}}(),Ei=function(){return function(t){this.key=t}}(),Ti=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Ne(),this.mutatedKeys=Ne(),this.documentSet=new Le(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new Ue,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof dt?e:null;h&&(v(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;c&&h?c.data.isEqual(h.data)?l!==d&&(r.track({type:Fe.Metadata,doc:h}),f=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:Fe.Modified,doc:h}),f=!0,u&&n.query.docComparator(h,u)>0&&(a=!0)):!c&&h?(r.track({type:Fe.Added,doc:h}),f=!0):c&&!h&&(r.track({type:Fe.Removed,doc:c}),f=!0,u&&(a=!0)),f&&(h?(s=s.add(h),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;s.size>this.query.limit;){var c=s.last();s=s.delete(c.key),o=o.delete(c.key),r.track({type:Fe.Removed,doc:c})}return v(!a||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;v(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case Fe.Added:return 1;case Fe.Modified:case Fe.Metadata:return 2;case Fe.Removed:return 0;default:return y("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var s=e?this.updateLimboDocuments():[],a=0===this.limboDocuments.size&&this.current?Be.Synced:Be.Local,u=a!==this.syncState;return this.syncState=a,0!==o.length||u?{snapshot:new Ve(this.query,t.documentSet,i,o,t.mutatedKeys,a===Be.Local,u,!1),limboChanges:s}:{limboChanges:s}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===fi.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Ue,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return v(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Ne(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new Ei(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new _i(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Ne();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return Ve.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Be.Local)},t}(),xi=function(){return function(t,e,n){this.query=t,this.targetId=e,this.view=n}}(),Si=function(){return function(t){this.key=t}}(),Ci=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Xn(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new mt(ht.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new Wr,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Fn.forSyncEngine(),this.isPrimary=void 0,this.onlineState=fi.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){v(null!==t,"SyncEngine listener cannot be null"),v(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return s.__awaiter(this,void 0,void 0,function(){var e,n,r,i,o;return s.__generator(this,function(s){switch(s.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(this.sharedClientState.addLocalQueryTarget(e=r.targetId),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=s.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=s.sent(),this.isPrimary&&this.remoteStore.listen(i),s.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){var n=this,r=t.query;return this.localStore.executeQuery(r).then(function(i){return n.localStore.remoteDocumentKeys(t.targetId).then(function(o){var s=new Ti(r,o),a=s.computeDocChanges(i),u=qe.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&n.onlineState!==fi.Offline),c=s.applyChanges(a,!0===n.isPrimary,u);v(0===c.limboChanges.length,"View returned limbo docs before target ack from the server."),v(!!c.snapshot,"applyChanges for new view should always return a snapshot");var h=new xi(r,t.targetId,s);return n.queryViewsByQuery.set(r,h),n.queryViewsByTarget[t.targetId]=h,c.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){var e=this;return this.localStore.executeQuery(t.query).then(function(n){return e.localStore.remoteDocumentKeys(t.targetId).then(function(r){return s.__awaiter(e,void 0,void 0,function(){var e;return s.__generator(this,function(i){return e=t.view.synchronizeWithPersistedState(n,r),this.isPrimary&&this.updateTrackedLimbos(t.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(t){return s.__awaiter(this,void 0,void 0,function(){var e,n=this;return s.__generator(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),v(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Vr)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(t,e){var n=this;void 0===e&&(e=5),v(e>=0,"Got negative number of retries for transaction.");var r=this.remoteStore.createTransaction();return function(){try{var e=t(r);return!jt(e)&&e.catch&&e.then?e.catch(function(t){return Promise.reject(n.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(i){return Promise.reject(n.wrapUpdateFunctionError(i))}}().then(function(i){return r.commit().then(function(){return i}).catch(function(r){return 0===e?Promise.reject(r):n.runTransaction(t,e-1)})})},t.prototype.applyRemoteEvent=function(t){var e=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(t).then(function(n){return A(t.targetChanges,function(t,n){var r=e.limboResolutionsByTarget[t];r&&(v(n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),n.addedDocuments.size>0?r.receivedDocument=!0:n.modifiedDocuments.size>0?v(r.receivedDocument,"Received change for limbo target document without add."):n.removedDocuments.size>0&&(v(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),e.emitNewSnapsAndNotifyLocalStore(n,t)}).catch(Vr)},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===pi.RemoteStore||!this.isPrimary&&e===pi.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);v(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return s.__awaiter(this,void 0,void 0,function(){var n,r,i,o,a,u,c=this;return s.__generator(this,function(s){switch(s.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),(r=(n=this.limboResolutionsByTarget[t])&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new mt(ht.comparator)).insert(r,new ft(r,te.forDeletedDoc())),o=Ne().add(r),a=new je(te.MIN,{},new re(X),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return v(!!(u=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(u.query,!1).then(function(){return c.removeAndCleanupQuery(u)}).catch(Vr)];case 2:s.sent(),this.syncEngineListener.onWatchError(u.query,e),s.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return s.__awaiter(this,void 0,void 0,function(){var r;return s.__generator(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(p("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):y("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(Vr)},t.prototype.rejectFailedWrite=function(t,e){var n=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.localStore.rejectBatch(t).then(function(r){return n.sharedClientState.updateMutationState(t,"rejected",e),n.emitNewSnapsAndNotifyLocalStore(r)}).catch(Vr)},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new mt(X)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(v(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof _i?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof Ei?(p("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):y("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){p("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Gt.atPath(e.path);this.limboResolutionsByTarget[n]=new Si(e),this.remoteStore.listen(new ne(r,n,ee.LimboResolution,dn.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return s.__awaiter(this,void 0,void 0,function(){var n,r,i,o=this;return s.__generator(this,function(s){switch(s.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(s,a){i.push(Promise.resolve().then(function(){var e=a.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(a.query).then(function(t){return a.view.computeDocChanges(t,e)}):e}).then(function(t){var i=a.view.applyChanges(t,!0===o.isPrimary,e&&e.targetChanges[a.targetId]);if(o.updateTrackedLimbos(a.targetId,i.limboChanges),i.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(a.targetId,i.snapshot.fromCache?"not-current":"current"),n.push(i.snapshot);var s=wi.fromSnapshot(a.targetId,i.snapshot);r.push(s)}}))}),[4,Promise.all(i)];case 1:return s.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return s.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){v(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return s.__awaiter(this,void 0,void 0,function(){var e,n;return s.__generator(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return s.__awaiter(this,void 0,void 0,function(){var e,n,r,i,o,a,u=this;return s.__generator(this,function(s){switch(s.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return s.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=s.sent(),r=0,i=n;r<i.length;r++)this.remoteStore.listen(i[r]);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],a=Promise.resolve(),C(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?o.push(t):a=a.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,a]);case 4:return s.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(o)];case 5:return s.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:s.sent(),s.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;C(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new mt(ht.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){for(var e=this,n=Promise.resolve(),r=[],i=[],o=function(t){n=n.then(function(){return s.__awaiter(e,void 0,void 0,function(){var e,n,o,a;return s.__generator(this,function(s){switch(s.label){case 0:return(n=this.queryViewsByTarget[t])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return s.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=s.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(o=s.sent()).snapshot&&i.push(o.snapshot),[3,8];case 4:return v(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(t)];case 5:return v(!!(a=s.sent()),"Query data for target "+t+" not found"),[4,this.localStore.allocateQuery(a)];case 6:return e=s.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:s.sent(),s.label=8;case 8:return r.push(e),[2]}})})})},a=0,u=t;a<u.length;a++)o(u[a]);return n.then(function(){return e.syncEngineListener.onWatchChange(i),r})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return s.__awaiter(this,void 0,void 0,function(){var r,i=this;return s.__generator(this,function(o){switch(o.label){case 0:if(this.isPrimary)return p("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,5];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return s.__awaiter(i,void 0,void 0,function(){var r;return s.__generator(this,function(i){switch(i.label){case 0:return r=je.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(n,r)];case 1:return i.sent(),[2]}})})},function(t){return s.__awaiter(i,void 0,void 0,function(){var e;return s.__generator(this,function(n){switch(n.label){case 0:return function(t){return t.code===_.DATA_LOSS&&t.message===Yn}(t)?(e=[],C(this.queryViewsByTarget,function(t){return e.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e)]):[3,2];case 1:return n.sent(),[3,3];case 2:throw t;case 3:return[2]}})})})];case 2:return this.removeAndCleanupQuery(r=this.queryViewsByTarget[t]),[4,this.localStore.releaseQuery(r.query,!0)];case 3:return o.sent(),this.syncEngineListener.onWatchError(r.query,n),[3,5];case 4:y("Unexpected target state: "+e),o.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(t,e){return s.__awaiter(this,void 0,void 0,function(){var n,r,i,o,a,u,c,h,l,d=this;return s.__generator(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(v(!this.queryViewsByTarget[l=r[n]],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(l)]):[3,6];case 2:return v(!!(i=f.sent()),"Query data for active target "+l+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return s.__generator(this,function(n){switch(n.label){case 0:return(e=u.queryViewsByTarget[t])?[4,u.localStore.releaseQuery(e.query,!1).then(function(){d.remoteStore.unlisten(t),d.removeAndCleanupQuery(e)}).catch(Vr)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},u=this,c=0,h=e,f.label=7;case 7:return c<h.length?[5,a(l=h[c])]:[3,10];case 8:f.sent(),f.label=9;case 9:return c++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Ne().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Ne()},t}(),Ai=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Ii="SharedClientState",Oi="firestore_clients",Di="firestore_mutations",ki="firestore_targets",Pi="firestore_online_state",Ni="firestore_sequence_number",Mi=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,v(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new E(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(m(Ii,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ri=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,v(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new E(r.error.code,r.error.message)),i?new t(e,r.state,o):(m(Ii,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Li=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Re(),s=0;i&&s<r.activeTargetIds.length;++s)i=qt(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(m(Ii,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Fi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&void 0!==fi[n.onlineState]&&"string"==typeof n.clientId?new t(n.clientId,fi[n.onlineState]):(m(Ii,"Failed to parse online state: "+e),null)},t}(),Bi=function(){function t(){this.activeTargetIds=Re()}return t.prototype.addQueryTarget=function(t){v(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ui=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new E(_.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=Ni+"_"+r,this.activeClients[this.localClientId]=new Bi,this.clientStateKeyRe=new RegExp("^"+Oi+"_"+s+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Di+"_"+s+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+ki+"_"+s+"_(\\d+)$"),this.onlineStateKey=Pi+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return s.__awaiter(this,void 0,void 0,function(){var t,e,n,r,i,o,a,u,c,h,l=this;return s.__generator(this,function(s){switch(s.label){case 0:return v(!this.started,"WebStorageSharedClientState already started"),v(null!==this.syncEngine,"syncEngine property must be set before calling start()"),v(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=s.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=Li.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)this.handleWebStorageEvent(h[c]);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Re();return A(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=Ri.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return p(Ii,"READ",t,e),e},t.prototype.setItem=function(t,e){p(Ii,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){p(Ii,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(p(Ii,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void m("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return s.__awaiter(e,void 0,void 0,function(){var e,n,r,i,o,a;return s.__generator(this,function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(v(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=dn.INVALID;if(null!=t)try{var n=JSON.parse(t);v("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(r){m(Ii,"Failed to read sequence number from WebStorage",r)}return e}(t.newValue))!==dn.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new Mi(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){this.storage.setItem(this.onlineStateKey,JSON.stringify({clientId:this.localClientId,onlineState:fi[t]}))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new Ri(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return v(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Oi+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return ki+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=Di+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return v(null!==n,"Cannot parse client state key '"+t+"'"),Li.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);v(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]);return Mi.fromWebStorageEntry(new Ai(void 0!==n[2]?n[2]:null),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);v(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Ri.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return Fi.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(e){return t.user.uid!==this.currentUser.uid?(p(Ii,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(e){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}(),Vi=function(){function t(){this.localState=new Bi,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new Bi,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),ji=function(){function t(t,e){this.cacheSizeBytes=t,this.experimentalTabSynchronization=e}return t.prototype.lruParams=function(){return kr.withCacheSize(this.cacheSizeBytes)},t}(),qi=function(){return function(){}}(),Gi=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=K.newId(),this.isShutdown=!1}return t.prototype.start=function(t){var e=this;this.verifyNotShutdown();var n=new fn,r=new fn,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof ji?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline storage. Falling back to storage disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof E?t.code===_.FAILED_PRECONDITION||t.code===_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code},t.prototype.verifyNotShutdown=function(){if(this.isShutdown)throw new E(_.FAILED_PRECONDITION,"The client has already been shutdown.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=Ur.buildStoragePrefix(this.databaseInfo),i=new on(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return s.__awaiter(n,void 0,void 0,function(){var n,o;return s.__generator(this,function(s){switch(s.label){case 0:if(e.experimentalTabSynchronization&&!Ui.isAvailable(this.platform))throw new E(_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return o=e.lruParams(),e.experimentalTabSynchronization?(this.sharedClientState=new Ui(this.asyncQueue,this.platform,r,this.clientId,t),[4,Ur.createMultiClientIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=s.sent(),[3,4];case 2:return this.sharedClientState=new Vi,[4,Ur.createIndexedDbPersistence(r,this.clientId,this.platform,this.asyncQueue,i,o)];case 3:n=s.sent(),s.label=4;case 4:return this.persistence=n,[2,n.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=Zr.createEagerPersistence(this.clientId),this.sharedClientState=new Vi,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return p("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return s.__awaiter(n,void 0,void 0,function(){var n,i,o,a=this;return s.__generator(this,function(u){switch(u.label){case 0:return this.localStore=new Xr(this.persistence,t),e&&(this.lruScheduler=new Pr(e,this.asyncQueue,this.localStore)),n=this.platform.newSerializer(this.databaseInfo.databaseId),i=new li(this.asyncQueue,r,this.credentials,n),o=function(t){return a.syncEngine.applyOnlineStateChange(t,pi.SharedClientState)},this.remoteStore=new gi(this.localStore,i,this.asyncQueue,function(t){return a.syncEngine.applyOnlineStateChange(t,pi.RemoteStore)}),this.syncEngine=new Ci(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=o,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new vi(this.syncEngine),[4,this.sharedClientState.start()];case 1:return u.sent(),[4,this.remoteStore.start()];case 2:return u.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return s.__awaiter(a,void 0,void 0,function(){return s.__generator(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return u.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),p("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(){var t=this;return!0===this.isShutdown?Promise.resolve():this.asyncQueue.enqueue(function(){return s.__awaiter(t,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),this.isShutdown=!0,[2]}})})})},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new bi(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof dt)return t;if(t instanceof ft)return null;throw new E(_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=Ne(),r=new Ti(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new fn;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return s.__awaiter(e,void 0,void 0,function(){return s.__generator(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),Hi=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),zi=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(e,n,r,i){if(!(t instanceof Array)||t.length<1)throw new E(_.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+W(1,"element")+".")}();for(var n=0;n<t.length;++n)if(N("FieldPath","string",n,t[n]),0===t[n].length)throw new E(_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ct(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(ct.keyField().canonicalString()),t}(),Wi=new RegExp("[~\\*/\\[\\]]"),Ki=function(){return function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}}}(),Xi=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){v(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(Ai.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){v(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Qi=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;v(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new E(_.ABORTED,"getToken aborted due to token change.");return n?(v("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new Ki(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){v(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){v(null!=this.tokenListener,"removeChangeListener() called twice"),v(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return v(null===t||"string"==typeof t,"Received invalid UID: "+t),new Ai(t)},t}(),Yi=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Ai.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),Ji=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new Yi(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(Ai.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function $i(t){if(!t)return new Xi;switch(t.type){case"gapi":var e=t.client;return v(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Ji(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new E(_.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}function Zi(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var to=function(){function t(t){this._methodName=t}return t.delete=function(){return O("FieldValue.delete",arguments),eo.instance},t.serverTimestamp=function(){return O("FieldValue.serverTimestamp",arguments),no.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return k("FieldValue.arrayUnion",arguments,1),new ro(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return k("FieldValue.arrayRemove",arguments,1),new io(t)},t.increment=function(t){return N("FieldValue.increment","number",1,t),D("FieldValue.increment",arguments,1),new oo(t)},t.prototype.isEqual=function(t){return this===t},t}(),eo=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return s.__extends(e,t),e.instance=new e,e}(to),no=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return s.__extends(e,t),e.instance=new e,e}(to),ro=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return s.__extends(e,t),e}(to),io=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return s.__extends(e,t),e}(to),oo=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return s.__extends(e,t),e}(to),so=T(to,"Use FieldValue.<field>() instead."),ao=/^__.*__$/,uo=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return n.push(null!==this.fieldMask?new de(t,this.data,this.fieldMask,e):new le(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new fe(t,this.fieldTransforms)),n},t}(),co=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new de(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new fe(t,this.fieldTransforms)),n},t}(),ho=function(t){return t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument",t}({});function lo(t){switch(t){case ho.Set:case ho.MergeSet:case ho.Update:return!0;case ho.Argument:return!1;default:throw y("Unexpected case for UserDataSource: "+t)}}var fo=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new E(_.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(lo(this.dataSource)&&ao.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),po=function(){return function(t,e){this.databaseId=t,this.key=e}}(),mo=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new fo(ho.Set,t,ct.EMPTY_PATH);yo("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new uo(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new fo(ho.MergeSet,t,ct.EMPTY_PATH);yo("Data must be an object, but it was:",r,e);var i,o,s=this.parseData(e,r);if(n){for(var a=new re(ct.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof zi)l=h._internalPath;else{if("string"!=typeof h)throw y("Expected stringOrFieldPath to be a string or a FieldPath");l=bo(t,h)}if(!r.contains(l))throw new E(_.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");a=a.add(l)}i=oe.fromSet(a),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=oe.fromArray(r.fieldMask),o=r.fieldTransforms;return new uo(s,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new fo(ho.Update,t,ct.EMPTY_PATH);yo("Data must be an object, but it was:",r,e);var i=new re(ct.comparator),o=Rt.EMPTY;A(e,function(e,s){var a=bo(t,e),u=r.childContextForFieldPath(a);if((s=n.runPreConverter(s,u))instanceof eo)i=i.add(a);else{var c=n.parseData(s,u);null!=c&&(i=i.add(a),o=o.set(a,c))}});var s=oe.fromSet(i);return new co(o,s,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new fo(ho.Update,t,ct.EMPTY_PATH),o=[vo(t,e)],s=[n];if(r.length%2!=0)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var a=0;a<r.length;a+=2)o.push(vo(t,r[a])),s.push(r[a+1]);var u=new re(ct.comparator),c=Rt.EMPTY;for(a=0;a<o.length;++a){var h=o[a],l=i.childContextForFieldPath(h),d=this.runPreConverter(s[a],l);if(d instanceof eo)u=u.add(h);else{var f=this.parseData(d,l);null!=f&&(u=u.add(h),c=c.set(h,f))}}var p=oe.fromSet(u);return new co(c,p,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new fo(ho.Argument,t,ct.EMPTY_PATH),r=this.parseData(e,n);return v(null!=r,"Parsed data should not be null."),v(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(r){var n=wo(r);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(go(t=this.runPreConverter(t,e)))return yo("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof to)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new mt(X);return I(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):A(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Rt(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=this.parseData(o[i],e.childContextForArray(r));null==s&&(s=Tt.INSTANCE),n.push(s),r++}return new Lt(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!lo(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof eo){if(e.dataSource!==ho.MergeSet)throw e.dataSource===ho.Update?(v(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof no)e.fieldTransforms.push(new se(e.path,me.instance));else if(t instanceof ro){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new ge(n);e.fieldTransforms.push(new se(e.path,r))}else if(t instanceof io){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new ye(n);e.fieldTransforms.push(new se(e.path,i))}else if(t instanceof oo){var o=this.parseQueryValue("FieldValue.increment",t._operand),s=new ve(o);e.fieldTransforms.push(new se(e.path,s))}else y("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Tt.INSTANCE;if("number"==typeof t)return qt(t)?new At(t):new It(t);if("boolean"==typeof t)return xt.of(t);if("string"==typeof t)return new Ot(t);if(t instanceof Date)return new Dt(nt.fromDate(t));if(t instanceof nt)return new Dt(new nt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof et)return new Mt(t);if(t instanceof Z)return new Pt(t);if(t instanceof po)return new Nt(t.databaseId,t.key);throw e.createError("Unsupported field value: "+j(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new fo(ho.Argument,t,ct.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function go(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof nt||t instanceof et||t instanceof Z||t instanceof po||t instanceof to)}function yo(t,e,n){if(!go(n)||!V(n)){var r=j(n);throw e.createError("an object"===r?t+" a custom object":t+" "+r)}}function vo(t,e){if(e instanceof zi)return e._internalPath;if("string"==typeof e)return bo(t,e);throw new E(_.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function bo(t,e){try{return function(t){if(t.search(Wi)>=0)throw new E(_.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(zi.bind.apply(zi,[void 0].concat(t.split("."))))}catch(e){throw new E(_.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(r){var n=wo(r);throw new E(_.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function wo(t){return t instanceof Error?t.message:t.toString()}var _o="firestore.googleapis.com",Eo=!0,To=!0,xo=!1,So=kr.COLLECTION_DISABLED,Co=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new E(_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_o,this.ssl=Eo}else R("settings","non-empty string","host",t.host),this.host=t.host,L("settings","boolean","ssl",t.ssl),this.ssl=S(t.ssl,Eo);if(G("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),L("settings","object","credentials",t.credentials),this.credentials=t.credentials,L("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?m("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&m("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=S(t.timestampsInSnapshots,To),L("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=kr.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==So&&t.cacheSizeBytes<kr.MINIMUM_CACHE_SIZE_BYTES)throw new E(_.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+kr.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}L("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?xo:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),Ao=function(){return function(){}}(),Io=function(){function t(e){var n=this;this._queue=new gn,this.INTERNAL={delete:function(){return s.__awaiter(n,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),this.clientRunning=!1,[2]}})})}},this.clientRunning=!1;var r=new Ao;if("object"==typeof e.options){var i=e;r.firebaseApp=i,r.databaseId=t.databaseIdFromApp(i),r.persistenceKey=r.firebaseApp.name,r.credentials=new Qi(i)}else{var o=e;if(!o.projectId)throw new E(_.INVALID_ARGUMENT,"Must provide projectId");r.databaseId=new ot(o.projectId,o.database),r.persistenceKey="[DEFAULT]",r.credentials=new Xi}r.settings=new Co({}),this._config=r,this._databaseId=r.databaseId}return t.prototype.settings=function(t){if(D("Firestore.settings",arguments,1),N("Firestore.settings","object",1,t),x(t,"persistence"))throw new E(_.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Co(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new E(_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=e,void 0!==e.credentials&&(this._config.credentials=$i(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new E(_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(new ji(this._config.settings.cacheSizeBytes,void 0!==t&&S(t.experimentalTabSynchronization,!1)))},t.prototype._clearPersistence=function(){if(this.clientRunning)throw new E(_.FAILED_PRECONDITION,"Persistence cannot be cleared while the client is running");var t=Ur.buildStoragePrefix(this.makeDatabaseInfo());return Ur.clearPersistence(t)},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new qi),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new rt(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)},t.prototype.configureClient=function(t){var e=this;v(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),v(!this._firestoreClient,"configureClient() called multiple times"),this.clientRunning=!0;var n=this.makeDatabaseInfo();return this._dataConverter=new mo(function(t){if(t instanceof ko){var n=e._config.databaseId,r=t.firestore._config.databaseId;if(!r.isEqual(n))throw new E(_.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new po(e._config.databaseId,t._key)}return t}),this._firestoreClient=new Gi(b.getPlatform(),n,this._config.credentials,this._queue),this._firestoreClient.start(t)},t.databaseIdFromApp=function(t){var e=t.options;if(!x(e,"projectId"))throw new E(_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new E(_.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new ot(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new E(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return D("Firestore.collection",arguments,1),N("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Fo(at.fromString(t),this)},t.prototype.doc=function(t){return D("Firestore.doc",arguments,1),N("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),ko.forPath(at.fromString(t),this)},t.prototype._collectionGroup=function(t){if(D("Firestore.collectionGroup",arguments,1),N("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new E(_.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Ro(new Gt(at.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return D("Firestore.runTransaction",arguments,1),N("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new Oo(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Do(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(d()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";default:return y("Unknown log level: "+d())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(D("Firestore.setLogLevel",arguments,1),N("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":f(l.DEBUG);break;case"error":f(l.ERROR);break;case"silent":f(l.SILENT);break;default:throw new E(_.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},t}(),Oo=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;D("Transaction.get",arguments,1);var n=jo("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return y("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof ft)return new No(e._firestore,n._key,null,!1,!1);if(r instanceof dt)return new No(e._firestore,n._key,r,!1,!1);throw y("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){P("Transaction.set",arguments,2,3);var r=jo("Transaction.set",t,this._firestore),i=(n=Bo("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof zi?(k("Transaction.update",arguments,3),r=jo("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(D("Transaction.update",arguments,2),r=jo("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){D("Transaction.delete",arguments,1);var e=jo("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Do=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){P("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=jo("WriteBatch.set",t,this._firestore),i=(n=Bo("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,ce.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.verifyNotCommitted(),"string"==typeof e||e instanceof zi?(k("WriteBatch.update",arguments,3),r=jo("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(D("WriteBatch.update",arguments,2),r=jo("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,ce.exists(!0))),this},t.prototype.delete=function(t){D("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=jo("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new pe(e._key,ce.NONE)),this},t.prototype.commit=function(){return s.__awaiter(this,void 0,void 0,function(){return s.__generator(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new E(_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),ko=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new E(_.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new ht(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Fo(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(D("DocumentReference.collection",arguments,1),N("DocumentReference.collection","non-empty string",1,t),!t)throw new E(_.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=at.fromString(t);return new Fo(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){P("DocumentReference.set",arguments,1,2);var n=(e=Bo("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,ce.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof zi?(k("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(D("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,ce.exists(!0)))},t.prototype.delete=function(){return D("DocumentReference.delete",arguments,0),this._firestoreClient.write([new pe(this._key,ce.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];P("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Zi(t[i])||(G("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),L("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return Zi(t[i])?n=t[i]:(N("DocumentReference.onSnapshot","function",i,t[i]),M("DocumentReference.onSnapshot","function",i+1,t[i+1]),M("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Hi({next:function(t){if(e.next){v(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new No(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Gt.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return P("DocumentReference.get",arguments,0,1),Vo("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new No(e.firestore,e._key,t,!0,t instanceof dt&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new E(_.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new E(_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),Po=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),No=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return P("DocumentSnapshot.data",arguments,0,1),t=Uo("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,_t.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(P("DocumentSnapshot.get",arguments,1,2),e=Uo("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(vo("DocumentSnapshot.get",t));if(void 0!==n)return this.convertValue(n,_t.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new ko(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Po(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof Rt)return this.convertObject(t,e);if(t instanceof Lt)return this.convertArray(t,e);if(t instanceof Nt){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||m("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new ko(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),Mo=function(t){function e(e,n,r,i,o){return t.call(this,e,n,r,i,o)||this}return s.__extends(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return v("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},e}(No),Ro=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){D("Query.where",arguments,3),q("Query.where",3,r);var i,o=["<","<=","==",">=",">","array-contains"];B("Query.where",o,2,n);var s=vo("Query.where",e),a=zt.fromString(n);if(s.isKeyField()){if(a===zt.ARRAY_CONTAINS)throw new E(_.INVALID_ARGUMENT,"Invalid Query. You can't perform array-contains queries on FieldPath.documentId() since document IDs are not arrays.");if("string"==typeof r){if(""===r)throw new E(_.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==r.indexOf("/"))throw new E(_.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection by FieldPath.documentId(), the value provided must be a plain document ID, but '"+r+"' contains a slash.");var u=this._query.path.child(at.fromString(r));if(!ht.isDocumentKey(u))throw new E(_.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+u+"' is not because it has an odd number of segments ("+u.length+").");i=new Nt(this.firestore._databaseId,new ht(u))}else{if(!(r instanceof ko))throw new E(_.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+j(r)+".");var c=r;i=new Nt(this.firestore._databaseId,c._key)}}else i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var h=Ht.create(s,a,i);return this.validateNewFilter(h),new t(this._query.addFilter(h),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(P("Query.orderBy",arguments,1,2),M("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=Qt.ASCENDING;else{if("desc"!==n)throw new E(_.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=Qt.DESCENDING}if(null!==this._query.startAt)throw new E(_.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new E(_.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=vo("Query.orderBy",e),o=new Jt(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(D("Query.limit",arguments,1),N("Query.limit","number",1,e),e<=0)throw new E(_.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];k("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(q(t,1,e),e instanceof No){if(n.length>0)throw new E(_.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new E(_.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var s=o[i];if(s.field.isKeyField())r.push(new Nt(this.firestore._databaseId,e.key));else{var a=e.field(s.field);if(a instanceof kt)throw new E(_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(void 0===a){var u=s.field.canonicalString();throw new E(_.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(a)}}return new Yt(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new E(_.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.isKeyField()){if("string"!=typeof s)throw new E(_.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this._query.isCollectionGroupQuery()&&-1!==s.indexOf("/"))throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var a=this._query.path.child(at.fromString(s));if(!ht.isDocumentKey(a))throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+a+"' is not because it contains an odd number of segments.");var u=new ht(a);i.push(new Nt(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,s);i.push(c)}}return new Yt(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];P("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Zi(t[i])||(G("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),L("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),Zi(t[i])?n=t[i]:(N("Query.onSnapshot","function",i,t[i]),M("Query.onSnapshot","function",i+1,t[i+1]),M("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Hi({next:function(t){e.next&&e.next(new Lo(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),s=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(s)}},t.prototype.get=function(t){var e=this;return P("Query.get",arguments,0,1),Vo("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new Lo(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new E(_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.validateNewFilter=function(t){if(t instanceof Wt)if(t.isInequality()){var e=this._query.getInequalityFilterField();if(null!==e&&!e.isEqual(t.field))throw new E(_.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+e.toString()+"' and '"+t.field.toString()+"'");var n=this._query.getFirstOrderByField();null!==n&&this.validateOrderByAndInequalityMatch(t.field,n)}else if(t.op===zt.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new E(_.INVALID_ARGUMENT,"Invalid query. Queries only support a single array-contains filter.")},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new E(_.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),Lo=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Po(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;P("QuerySnapshot.forEach",arguments,1,2),N("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Ro(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(G("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),L("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new E(_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new Mo(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return v(e.type===Fe.Added,"Invalid event type for first snapshot"),v(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==Fe.Metadata}).map(function(e){var r=new Mo(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,s=-1;return e.type!==Fe.Added&&(v((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==Fe.Removed&&(s=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:qo(e.type),doc:r,oldIndex:i,newIndex:s}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new Mo(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(Lo.prototype.docChanges,t,{get:function(){return function(){throw new E(_.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(e){}});var Fo=function(t){function e(e,n){var r=t.call(this,Gt.atPath(e),n)||this;if(e.length%2!=1)throw new E(_.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return s.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new ko(new ht(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(P("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=K.newId()),N("CollectionReference.doc","non-empty string",1,t),""===t)throw new E(_.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=at.fromString(t);return ko.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){D("CollectionReference.add",arguments,1),N("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(Ro);function Bo(t,e){if(void 0===e)return{merge:!1};if(G(t,e,["merge","mergeFields"]),L(t,"boolean","merge",e.merge),"mergeFields","a string or a FieldPath",void 0!==(n=e.mergeFields)&&function(t,e,n,r,i){if(!(r instanceof Array))throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires its mergeFields option to be an array, but it was: "+j(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires all mergeFields elements to be a string or a FieldPath, but the value at index "+o+" was: "+j(r[o]))}(t,0,0,n,function(t){return"string"==typeof t||t instanceof zi}),void 0!==e.mergeFields&&void 0!==e.merge)throw new E(_.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Uo(t,e){return void 0===e?{}:(G(t,e,["serverTimestamps"]),F(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Vo(t,e){M(t,"object",1,e),e&&(G(t,e,["source"]),F(t,0,"source",e.source,["default","server","cache"]))}function jo(t,e,n){if(e instanceof ko){if(e.firestore!==n)throw new E(_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw H(t,"DocumentReference",1,e)}function qo(t){switch(t){case Fe.Added:return"added";case Fe.Modified:case Fe.Metadata:return"modified";case Fe.Removed:return"removed";default:return y("Unknown change type: "+t)}}var Go=T(Io,"Use firebase.firestore() instead."),Ho=T(Oo,"Use firebase.firestore().runTransaction() instead."),zo=T(Do,"Use firebase.firestore().batch() instead."),Wo=T(ko,"Use firebase.firestore().doc() instead."),Ko=T(No),Xo=T(Mo),Qo=T(Ro),Yo=T(Lo),Jo=T(Fo,"Use firebase.firestore().collection() instead."),$o={Firestore:Go,GeoPoint:et,Timestamp:nt,Blob:tt,Transaction:Ho,WriteBatch:zo,DocumentReference:Wo,DocumentSnapshot:Ko,Query:Qo,QueryDocumentSnapshot:Xo,QuerySnapshot:Yo,CollectionReference:Jo,FieldPath:zi,FieldValue:so,setLogLevel:Io.setLogLevel,CACHE_SIZE_UNLIMITED:So};function Zo(t){t.INTERNAL.registerService("firestore",function(t){return new Io(t)},function(t){v(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}($o))}Zo(i),e.registerFirestore=Zo},"6MUB":function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,i){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map(function(i){var o=encodeURIComponent(r(i))+n;return Array.isArray(t[i])?t[i].map(function(t){return o+encodeURIComponent(r(t))}).join(e):o+encodeURIComponent(r(t[i]))}).join(e):i?encodeURIComponent(r(i))+n+encodeURIComponent(r(t)):""}},"6Pil":function(t,e,n){n("JtD1");var r=n("Wk7T");function i(t,e,n){n=r.defaults(n,{stiffness:100,damping:1}),this.stiffness=n.stiffness,this.damping=n.damping,this.bodyA=t,this.bodyB=e}t.exports=i,i.prototype.applyForce=function(){}},"73IE":function(t,e,n){"use strict";var r=n("H6ty"),i=n("hEy5"),o=n("z5ME")("startsWith"),s="".startsWith;n("pSMy")({target:"String",proto:!0,forced:!o},{startsWith:function(t){var e=i(this,t,"startsWith"),n=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),o=String(t);return s?s.call(e,o,n):e.slice(n,n+o.length)===o}})},"7xuS":function(t,e,n){t.exports=n("T3Qk")},"9Nts":function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},"9UdO":function(t,e,n){n("q94Q")("dispose")},"9r11":function(t,e,n){t.exports=n("ArVK")},A9d8:function(t,e,n){"use strict";var r=n("YxH6").IteratorPrototype,i=n("tzov"),o=n("2Hee"),s=n("S4gH"),a=n("0i0S"),u=function(){return this};t.exports=function(t,e,n){var c=e+" Iterator";return t.prototype=i(r,{next:o(1,n)}),s(t,c,!1,!0),a[c]=u,t}},ANjH:function(t,e,n){"use strict";n.r(e),n.d(e,"__DO_NOT_USE__ActionTypes",function(){return o}),n.d(e,"applyMiddleware",function(){return m}),n.d(e,"bindActionCreators",function(){return h}),n.d(e,"combineReducers",function(){return u}),n.d(e,"compose",function(){return p}),n.d(e,"createStore",function(){return s});var r=n("bCCX"),i=function(){return Math.random().toString(36).substring(7).split("").join(".")},o={INIT:"@@redux/INIT"+i(),REPLACE:"@@redux/REPLACE"+i(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+i()}};function s(t,e,n){var i;if("function"==typeof e&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(s)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var a=t,u=e,c=[],h=c,l=!1;function d(){h===c&&(h=c.slice())}function f(){if(l)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return u}function p(t){if("function"!=typeof t)throw new Error("Expected the listener to be a function.");if(l)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");var e=!0;return d(),h.push(t),function(){if(e){if(l)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribe(listener) for more details.");e=!1,d();var n=h.indexOf(t);h.splice(n,1)}}}function m(t){if(!function(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(l)throw new Error("Reducers may not dispatch actions.");try{l=!0,u=a(u,t)}finally{l=!1}for(var e=c=h,n=0;n<e.length;n++)(0,e[n])();return t}return m({type:o.INIT}),(i={dispatch:m,subscribe:p,getState:f,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");a=t,m({type:o.REPLACE})}})[r.a]=function(){var t,e=p;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");function n(){t.next&&t.next(f())}return n(),{unsubscribe:e(n)}}})[r.a]=function(){return this},t},i}function a(t,e){var n=e&&e.type;return"Given "+(n&&'action "'+String(n)+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function u(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var i=e[r];"function"==typeof t[i]&&(n[i]=t[i])}var s,u=Object.keys(n);try{!function(t){Object.keys(t).forEach(function(e){var n=t[e];if(void 0===n(void 0,{type:o.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:o.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+o.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')})}(n)}catch(c){s=c}return function(t,e){if(void 0===t&&(t={}),s)throw s;for(var r=!1,i={},o=0;o<u.length;o++){var c=u[o],h=t[c],l=(0,n[c])(h,e);if(void 0===l){var d=a(c,e);throw new Error(d)}i[c]=l,r=r||l!==h}return r?i:t}}function c(t,e){return function(){return e(t.apply(this,arguments))}}function h(t,e){if("function"==typeof t)return c(t,e);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');var n={};for(var r in t){var i=t[r];"function"==typeof i&&(n[r]=c(i,e))}return n}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(n,!0).forEach(function(e){l(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function p(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce(function(t,e){return function(){return t(e.apply(void 0,arguments))}})}function m(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(){var n=t.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},i={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},o=e.map(function(t){return t(i)});return f({},n,{dispatch:r=p.apply(void 0,o)(n.dispatch)})}}}},AeTl:function(t,e){function n(t,e,n,r){this.shapeA=e,this.shapeB=r,this.bodyA=t,this.bodyB=n}t.exports=n,n.prototype.set=function(t,e,r,i){n.call(this,t,e,r,i)}},ArVK:function(t,e,n){n("d8cw"),t.exports=n("vLVD")("Array","find")},AzFY:function(t,e,n){t.exports=n("tuBy")},B9yW:function(t,e,n){var r=n("+1EK");function i(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}n("JtD1"),t.exports=i,(i.prototype=new r).constructor=i,i.prototype.computeB=function(t,e,n){var r=this.G;r[2]=-1,r[5]=this.ratio;var i=this.computeGiMf();return-this.computeGW()*e-n*i}},BcWo:function(t,e,n){var r=n("JtD1");function i(t){this.lowerBound=r.create(),t&&t.lowerBound&&r.copy(this.lowerBound,t.lowerBound),this.upperBound=r.create(),t&&t.upperBound&&r.copy(this.upperBound,t.upperBound)}n("Wk7T"),t.exports=i;var o=r.create();i.prototype.setFromPoints=function(t,e,n,i){var s=this.lowerBound,a=this.upperBound;"number"!=typeof n&&(n=0),0!==n?r.rotate(s,t[0],n):r.copy(s,t[0]),r.copy(a,s);for(var u=Math.cos(n),c=Math.sin(n),h=1;h<t.length;h++){var l=t[h];if(0!==n){var d=l[0],f=l[1];o[0]=u*d-c*f,o[1]=c*d+u*f,l=o}for(var p=0;p<2;p++)l[p]>a[p]&&(a[p]=l[p]),l[p]<s[p]&&(s[p]=l[p])}e&&(r.add(this.lowerBound,this.lowerBound,e),r.add(this.upperBound,this.upperBound,e)),i&&(this.lowerBound[0]-=i,this.lowerBound[1]-=i,this.upperBound[0]+=i,this.upperBound[1]+=i)},i.prototype.copy=function(t){r.copy(this.lowerBound,t.lowerBound),r.copy(this.upperBound,t.upperBound)},i.prototype.extend=function(t){for(var e=2;e--;){var n=t.lowerBound[e];this.lowerBound[e]>n&&(this.lowerBound[e]=n);var r=t.upperBound[e];this.upperBound[e]<r&&(this.upperBound[e]=r)}},i.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound;return(r[0]<=n[0]&&n[0]<=i[0]||e[0]<=i[0]&&i[0]<=n[0])&&(r[1]<=n[1]&&n[1]<=i[1]||e[1]<=i[1]&&i[1]<=n[1])},i.prototype.containsPoint=function(t){var e=this.lowerBound,n=this.upperBound;return e[0]<=t[0]&&t[0]<=n[0]&&e[1]<=t[1]&&t[1]<=n[1]},i.prototype.overlapsRay=function(t){var e=1/t.direction[0],n=1/t.direction[1],r=(this.lowerBound[0]-t.from[0])*e,i=(this.upperBound[0]-t.from[0])*e,o=(this.lowerBound[1]-t.from[1])*n,s=(this.upperBound[1]-t.from[1])*n,a=Math.max(Math.max(Math.min(r,i),Math.min(o,s))),u=Math.min(Math.min(Math.max(r,i),Math.max(o,s)));return u<0?-1:a>u?-1:a}},Bixm:function(t,e,n){var r=n("JtD1"),i=n("RZpa");function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}t.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(t){};var s=r.create();o.boundingRadiusCheck=function(t,e){r.sub(s,t.position,e.position);var n=r.squaredLength(s),i=t.boundingRadius+e.boundingRadius;return n<=i*i},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var n;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:n=o.boundingRadiusCheck(t,e);break;case o.AABB:n=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return n},o.canCollide=function(t,e){var n=i.KINEMATIC,r=i.STATIC;return!(t.type===r&&e.type===r||t.type===n&&e.type===r||t.type===r&&e.type===n||t.type===n&&e.type===n||t.sleepState===i.SLEEPING&&e.sleepState===i.SLEEPING||t.sleepState===i.SLEEPING&&e.type===r||e.sleepState===i.SLEEPING&&t.type===r)},o.NAIVE=1,o.SAP=2},BloW:function(t,e,n){var r=n("5eG6"),i=n("ysHE").WeakMap;t.exports="function"==typeof i&&/native code/.test(r.call(i))},C78X:function(t,e,n){var r=n("0pMi"),i=n("fq9q"),o=n("+1EK"),s=n("JtD1"),a=n("0DzJ");function u(t,e,n){r.call(this,t,e,r.PRISMATIC,n=n||{});var u=s.fromValues(0,0),c=s.fromValues(1,0),h=s.fromValues(0,0);n.localAnchorA&&s.copy(u,n.localAnchorA),n.localAxisA&&s.copy(c,n.localAxisA),n.localAnchorB&&s.copy(h,n.localAnchorB),this.localAnchorA=u,this.localAnchorB=h,this.localAxisA=c;var l=this.maxForce=void 0!==n.maxForce?n.maxForce:Number.MAX_VALUE,d=new o(t,e,-l,l),f=new s.create,p=new s.create,m=new s.create,g=new s.create;if(d.computeGq=function(){return s.dot(m,g)},d.updateJacobian=function(){var n=this.G,r=t.position,i=e.position;s.rotate(f,u,t.angle),s.rotate(p,h,e.angle),s.add(m,i,p),s.sub(m,m,r),s.sub(m,m,f),s.rotate(g,c,t.angle+Math.PI/2),n[0]=-g[0],n[1]=-g[1],n[2]=-s.crossLength(f,g)+s.crossLength(g,m),n[3]=g[0],n[4]=g[1],n[5]=s.crossLength(p,g)},this.equations.push(d),!n.disableRotationalLock){var y=new a(t,e,-l,l);this.equations.push(y)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==n.lowerLimit,this.upperLimitEnabled=void 0!==n.upperLimit,this.lowerLimit=void 0!==n.lowerLimit?n.lowerLimit:0,this.upperLimit=void 0!==n.upperLimit?n.upperLimit:1,this.upperLimitEquation=new i(t,e),this.lowerLimitEquation=new i(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=l,this.motorEquation=new o(t,e),this.motorEnabled=!1,this.motorSpeed=0;var v=this,b=this.motorEquation;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.bodyA,e=this.bodyB;return this.gmult(this.G,t.velocity,t.angularVelocity,e.velocity,e.angularVelocity)+v.motorSpeed}}t.exports=u,(u.prototype=new r).constructor=u;var c=s.create(),h=s.create(),l=s.create(),d=s.create(),f=s.create(),p=s.create();u.prototype.update=function(){var t=this.equations,e=this.upperLimit,n=this.lowerLimit,r=this.upperLimitEquation,i=this.lowerLimitEquation,o=this.bodyA,a=this.bodyB,u=this.localAxisA,m=this.localAnchorA,g=this.localAnchorB;t[0].updateJacobian(),s.rotate(c,u,o.angle),s.rotate(d,m,o.angle),s.add(h,d,o.position),s.rotate(f,g,a.angle),s.add(l,f,a.position);var y,v=this.position=s.dot(l,c)-s.dot(h,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=s.crossLength(c,f),b[3]=-c[0],b[4]=-c[1],b[5]=-s.crossLength(c,d)}this.upperLimitEnabled&&v>e?(s.scale(r.normalA,c,-1),s.sub(r.contactPointA,h,o.position),s.sub(r.contactPointB,l,a.position),s.scale(p,c,e),s.add(r.contactPointA,r.contactPointA,p),-1===t.indexOf(r)&&t.push(r)):-1!==(y=t.indexOf(r))&&t.splice(y,1),this.lowerLimitEnabled&&v<n?(s.scale(i.normalA,c,1),s.sub(i.contactPointA,h,o.position),s.sub(i.contactPointB,l,a.position),s.scale(p,c,n),s.sub(i.contactPointB,i.contactPointB,p),-1===t.indexOf(i)&&t.push(i)):-1!==(y=t.indexOf(i))&&t.splice(y,1)},u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},u.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},u.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},CPZc:function(t,e){function n(){}t.exports=n,n.area=function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])},n.left=function(t,e,r){return n.area(t,e,r)>0},n.leftOn=function(t,e,r){return n.area(t,e,r)>=0},n.right=function(t,e,r){return n.area(t,e,r)<0},n.rightOn=function(t,e,r){return n.area(t,e,r)<=0};var r=[],i=[];n.collinear=function(t,e,o,s){if(s){var a=r,u=i;a[0]=e[0]-t[0],a[1]=e[1]-t[1],u[0]=o[0]-e[0],u[1]=o[1]-e[1];var c=a[0]*u[0]+a[1]*u[1],h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),l=Math.sqrt(u[0]*u[0]+u[1]*u[1]);return Math.acos(c/(h*l))<s}return 0==n.area(t,e,o)},n.sqdist=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}},CxY0:function(t,e,n){"use strict";var r=n("rWzI"),i=n("Nehr");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=b,e.resolve=function(t,e){return b(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=b(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(c),l=["%","/","?",";","#"].concat(h),d=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=n("r8II");function b(t,e,n){if(t&&i.isObject(t)&&t instanceof o)return t;var r=new o;return r.parse(t,e,n),r}o.prototype.parse=function(t,e,n){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),a=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(a);c[0]=c[0].replace(/\\/g,"/");var b=t=c.join(a);if(b=b.trim(),!n&&1===t.split("#").length){var w=u.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var _=s.exec(b);if(_){var E=(_=_[0]).toLowerCase();this.protocol=E,b=b.substr(_.length)}if(n||_||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===b.substr(0,2);!T||_&&g[_]||(b=b.substr(2),this.slashes=!0)}if(!g[_]&&(T||_&&!y[_])){for(var x,S,C=-1,A=0;A<d.length;A++)-1!==(I=b.indexOf(d[A]))&&(-1===C||I<C)&&(C=I);for(-1!==(S=-1===C?b.lastIndexOf("@"):b.lastIndexOf("@",C))&&(x=b.slice(0,S),b=b.slice(S+1),this.auth=decodeURIComponent(x)),C=-1,A=0;A<l.length;A++){var I;-1!==(I=b.indexOf(l[A]))&&(-1===C||I<C)&&(C=I)}-1===C&&(C=b.length),this.host=b.slice(0,C),b=b.slice(C),this.parseHost(),this.hostname=this.hostname||"";var O="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!O)for(var D=this.hostname.split(/\./),k=(A=0,D.length);A<k;A++){var P=D[A];if(P&&!P.match(f)){for(var N="",M=0,R=P.length;M<R;M++)P.charCodeAt(M)>127?N+="x":N+=P[M];if(!N.match(f)){var L=D.slice(0,A),F=D.slice(A+1),B=P.match(p);B&&(L.push(B[1]),F.unshift(B[2])),F.length&&(b="/"+F.join(".")+b),this.hostname=L.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),O||(this.hostname=r.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[E])for(A=0,k=h.length;A<k;A++){var U=h[A];if(-1!==b.indexOf(U)){var V=encodeURIComponent(U);V===U&&(V=escape(U)),b=b.split(U).join(V)}}var j=b.indexOf("#");-1!==j&&(this.hash=b.substr(j),b=b.slice(0,j));var q=b.indexOf("?");return-1!==q?(this.search=b.substr(q),this.query=b.substr(q+1),e&&(this.query=v.parse(this.query)),b=b.slice(0,q)):e&&(this.search="",this.query={}),b&&(this.pathname=b),y[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=v.stringify(this.query));var a=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),e+o+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace("#","%23"))+r},o.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var n=new o,r=Object.keys(this),s=0;s<r.length;s++){var a=r[s];n[a]=this[a]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var u=Object.keys(t),c=0;c<u.length;c++){var h=u[c];"protocol"!==h&&(n[h]=t[h])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!y[t.protocol]){for(var l=Object.keys(t),d=0;d<l.length;d++){var f=l[d];n[f]=t[f]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||g[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}return n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,(n.pathname||n.search)&&(n.path=(n.pathname||"")+(n.search||"")),n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),v=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=v||m||n.host&&t.pathname,w=b,_=n.pathname&&n.pathname.split("/")||[],E=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(E&&(n.hostname="",n.port=null,n.host&&(""===_[0]?_[0]=n.host:_.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),b=b&&(""===p[0]||""===_[0])),v)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,_=p;else if(p.length)_||(_=[]),_.pop(),_=_.concat(p),n.search=t.search,n.query=t.query;else if(!i.isNullOrUndefined(t.search))return E&&(n.hostname=n.host=_.shift(),(A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=A.shift(),n.host=n.hostname=A.shift())),n.search=t.search,n.query=t.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!_.length)return n.pathname=null,n.path=n.search?"/"+n.search:null,n.href=n.format(),n;for(var T=_.slice(-1)[0],x=(n.host||t.host||_.length>1)&&("."===T||".."===T)||""===T,S=0,C=_.length;C>=0;C--)"."===(T=_[C])?_.splice(C,1):".."===T?(_.splice(C,1),S++):S&&(_.splice(C,1),S--);if(!b&&!w)for(;S--;S)_.unshift("..");!b||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),x&&"/"!==_.join("/").substr(-1)&&_.push("");var A,I=""===_[0]||_[0]&&"/"===_[0].charAt(0);return E&&(n.hostname=n.host=I?"":_.length?_.shift():"",(A=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=A.shift(),n.host=n.hostname=A.shift())),(b=b||n.host&&_.length)&&!I&&_.unshift(""),_.length?n.pathname=_.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},"Dd/+":function(t,e,n){n("q94Q")("unscopables")},Dded:function(t,e,n){t.exports={Polygon:n("KEt/"),Point:n("CPZc")}},Dp7I:function(t,e,n){var r=n("JtD1"),i=n("yBzR");function o(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}t.exports=o,o.prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return r.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(t,e){r.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===i.ANY},o.prototype.set=function(t,e,n,i,o){r.copy(this.normal,t),this.shape=e,this.body=n,this.fraction=i,this.faceIndex=o}},Fmjy:function(t,e,n){var r=n("ucEh"),i=n("+1EK");function o(t,e,n){if(n=n||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==n.friction?Number(n.friction):.3,this.restitution=void 0!==n.restitution?Number(n.restitution):0,this.stiffness=void 0!==n.stiffness?Number(n.stiffness):i.DEFAULT_STIFFNESS,this.relaxation=void 0!==n.relaxation?Number(n.relaxation):i.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==n.frictionStiffness?Number(n.frictionStiffness):i.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==n.frictionRelaxation?Number(n.frictionRelaxation):i.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==n.surfaceVelocity?Number(n.surfaceVelocity):0,this.contactSkinSize=.005}t.exports=o,o.idCounter=0},FnXw:function(t,e,n){var r=n("kpns"),i=n("hdqJ"),o=n("aXXJ")("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==i(t))}},FoKB:function(t,e,n){n("q94Q")("observable")},GJzV:function(t,e,n){var r=n("JKJi"),i=Math.max,o=Math.min;t.exports=function(t,e){var n=r(t);return n<0?i(n+e,0):o(n,e)}},Gp07:function(t,e,n){var r=n("JKJi"),i=n("9Nts");t.exports=function(t,e,n){var o,s,a=String(i(t)),u=r(e),c=a.length;return u<0||u>=c?n?"":void 0:(o=a.charCodeAt(u))<55296||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?n?a.charAt(u):o:n?a.slice(u,u+2):s-56320+(o-55296<<10)+65536}},GrVo:function(t,e,n){"use strict";var r=n("Q2Kg"),i=n("fw2a"),o=n("iCuu"),s=n("SAp2"),a=n("t5mC"),u=Object.assign;t.exports=!u||n("0HDe")(function(){var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(t){e[t]=t}),7!=u({},t)[n]||"abcdefghijklmnopqrst"!=r(u({},e)).join("")})?function(t,e){for(var n=s(t),u=arguments.length,c=1,h=i.f,l=o.f;u>c;)for(var d,f=a(arguments[c++]),p=h?r(f).concat(h(f)):r(f),m=p.length,g=0;m>g;)l.call(f,d=p[g++])&&(n[d]=f[d]);return n}:u},H6ty:function(t,e,n){var r=n("JKJi"),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},HefZ:function(t,e,n){n("rZEa"),n("QvOV"),n("44fV"),n("2F3y"),n("qjh4"),n("b2LF"),n("uiB+"),n("q0E7"),n("+v3u"),n("dstF"),n("dYkh"),n("gIEr"),n("luCB"),n("MuAL"),n("uLJa"),n("Dd/+"),n("vb+c"),n("ZPxF"),t.exports=n("4Ea8").Symbol},"I+AN":function(t,e,n){var r=n("JtD1"),i=n("rCTz"),o=n("sbLb");function s(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })"));var e=this.width=(t=t||{}).width||1,n=this.height=t.height||1,s=[r.fromValues(-e/2,-n/2),r.fromValues(e/2,-n/2),r.fromValues(e/2,n/2),r.fromValues(-e/2,n/2)],a=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=s,t.axes=a,t.type=i.BOX,o.call(this,t)}t.exports=s,(s.prototype=new o).constructor=s,s.prototype.computeMomentOfInertia=function(t){var e=this.width,n=this.height;return t*(n*n+e*e)/12},s.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},r.create(),r.create(),r.create(),r.create(),s.prototype.computeAABB=function(t,e,n){t.setFromPoints(this.vertices,e,n,0)},s.prototype.updateArea=function(){this.area=this.width*this.height}},I2ZF:function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}},IutQ:function(t,e,n){var r=n("t5mC"),i=n("9Nts");t.exports=function(t){return r(i(t))}},JIMt:function(t,e,n){var r=n("kpns"),i=n("ysHE").document,o=r(i)&&r(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},JKJi:function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},JpPu:function(t,e,n){var r=n("nJQW");t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}},JtD1:function(t,e,n){var r=t.exports={},i=n("Wk7T");r.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},r.crossVZ=function(t,e,n){return r.rotate(t,e,-Math.PI/2),r.scale(t,t,n),t},r.crossZV=function(t,e,n){return r.rotate(t,n,Math.PI/2),r.scale(t,t,e),t},r.rotate=function(t,e,n){if(0!==n){var r=Math.cos(n),i=Math.sin(n),o=e[0],s=e[1];t[0]=r*o-i*s,t[1]=i*o+r*s}else t[0]=e[0],t[1]=e[1]},r.rotate90cw=function(t,e){var n=e[0];t[0]=e[1],t[1]=-n},r.toLocalFrame=function(t,e,n,i){r.copy(t,e),r.sub(t,t,n),r.rotate(t,t,-i)},r.toGlobalFrame=function(t,e,n,i){r.copy(t,e),r.rotate(t,t,i),r.add(t,t,n)},r.vectorToLocalFrame=function(t,e,n){r.rotate(t,e,-n)},r.vectorToGlobalFrame=function(t,e,n){r.rotate(t,e,n)},r.centroid=function(t,e,n,i){return r.add(t,e,n),r.add(t,t,i),r.scale(t,t,1/3),t},r.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var n=new i.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,n){return t[0]=e,t[1]=n,t},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},r.div=r.divide,r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},r.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.normalize=function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.lerp=function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},r.reflect=function(t,e,n){var r=e[0]*n[0]+e[1]*n[1];t[0]=e[0]-2*n[0]*r,t[1]=e[1]-2*n[1]*r},r.getLineSegmentsIntersection=function(t,e,n,i,o){var s=r.getLineSegmentsIntersectionFraction(e,n,i,o);return!(s<0||(t[0]=e[0]+s*(n[0]-e[0]),t[1]=e[1]+s*(n[1]-e[1]),0))},r.getLineSegmentsIntersectionFraction=function(t,e,n,r){var i,o,s=e[0]-t[0],a=e[1]-t[1],u=r[0]-n[0],c=r[1]-n[1];return o=(u*(t[1]-n[1])-c*(t[0]-n[0]))/(-u*a+s*c),(i=(-a*(t[0]-n[0])+s*(t[1]-n[1]))/(-u*a+s*c))>=0&&i<=1&&o>=0&&o<=1?o:-1}},JzIs:function(t,e,n){var r=n("lb/b"),i=n("TIpl"),o=n("bcPd"),s=n("Q2Kg");t.exports=r?Object.defineProperties:function(t,e){o(t);for(var n,r=s(e),a=r.length,u=0;a>u;)i.f(t,n=r[u++],e[n]);return t}},K8G7:function(t,e,n){"use strict";var r=n("IutQ"),i=n("gJLK"),o=n("0i0S"),s=n("LX9C"),a=n("stQs"),u=s.set,c=s.getterFor("Array Iterator");t.exports=a(Array,"Array",function(t,e){u(this,{type:"Array Iterator",target:r(t),index:0,kind:e})},function(){var t=c(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},"KEt/":function(t,e,n){var r=n("gJmg"),i=n("CPZc"),o=n("zqkD");function s(){this.vertices=[]}t.exports=s,s.prototype.at=function(t){var e=this.vertices,n=e.length;return e[t<0?t%n+n:t%n]},s.prototype.first=function(){return this.vertices[0]},s.prototype.last=function(){return this.vertices[this.vertices.length-1]},s.prototype.clear=function(){this.vertices.length=0},s.prototype.append=function(t,e,n){if(void 0===e)throw new Error("From is not given!");if(void 0===n)throw new Error("To is not given!");if(n-1<e)throw new Error("lol1");if(n>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var r=e;r<n;r++)this.vertices.push(t.vertices[r])},s.prototype.makeCCW=function(){for(var t=0,e=this.vertices,n=1;n<this.vertices.length;++n)(e[n][1]<e[t][1]||e[n][1]==e[t][1]&&e[n][0]>e[t][0])&&(t=n);i.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},s.prototype.reverse=function(){for(var t=[],e=0,n=this.vertices.length;e!==n;e++)t.push(this.vertices.pop());this.vertices=t},s.prototype.isReflex=function(t){return i.right(this.at(t-1),this.at(t),this.at(t+1))};var a=[],u=[];function c(t,e,n,r,i){var s=e[1]-t[1],a=t[0]-e[0],u=s*t[0]+a*t[1],c=r[1]-n[1],h=n[0]-r[0],l=c*n[0]+h*n[1],d=s*h-c*a;return o.eq(d,0,i=i||0)?[0,0]:[(h*u-a*l)/d,(s*l-c*u)/d]}s.prototype.canSee=function(t,e){var n,o,s=a,c=u;if(i.leftOn(this.at(t+1),this.at(t),this.at(e))&&i.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=i.sqdist(this.at(t),this.at(e));for(var h=0;h!==this.vertices.length;++h)if((h+1)%this.vertices.length!==t&&h!==t&&i.leftOn(this.at(t),this.at(e),this.at(h+1))&&i.rightOn(this.at(t),this.at(e),this.at(h))&&(s[0]=this.at(t),s[1]=this.at(e),c[0]=this.at(h),c[1]=this.at(h+1),n=r.lineInt(s,c),i.sqdist(this.at(t),n)<o))return!1;return!0},s.prototype.copy=function(t,e,n){var r=n||new s;if(r.clear(),t<e)for(var i=t;i<=e;i++)r.vertices.push(this.vertices[i]);else{for(i=0;i<=e;i++)r.vertices.push(this.vertices[i]);for(i=t;i<this.vertices.length;i++)r.vertices.push(this.vertices[i])}return r},s.prototype.getCutEdges=function(){for(var t=[],e=[],n=[],r=new s,i=Number.MAX_VALUE,o=0;o<this.vertices.length;++o)if(this.isReflex(o))for(var a=0;a<this.vertices.length;++a)if(this.canSee(o,a)){e=this.copy(o,a,r).getCutEdges(),n=this.copy(a,o,r).getCutEdges();for(var u=0;u<n.length;u++)e.push(n[u]);e.length<i&&(i=e.length,(t=e).push([this.at(o),this.at(a)]))}return t},s.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},s.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],n=0;n<t.length;n++)for(var r=t[n],i=0;i<e.length;i++){var o=e[i].slice(r);if(o){e.splice(i,1),e.push(o[0],o[1]);break}}return e}return n=this.vertices.indexOf((r=t)[0]),i=this.vertices.indexOf(r[1]),-1!=n&&-1!=i&&[this.copy(n,i),this.copy(i,n)]},s.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var n=0;n<e-1;n++)if(r.segmentsIntersect(t[e],t[e+1],t[n],t[n+1]))return!1;for(e=1;e<t.length-2;e++)if(r.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},s.prototype.quickDecomp=function(t,e,n,r,o,a){o=o||100,a=a||0,r=r||25,t=void 0!==t?t:[],e=e||[],n=n||[];var u=[0,0],h=[0,0],l=[0,0],d=0,f=0,p=0,m=0,g=0,y=0,v=0,b=new s,w=new s,_=this.vertices;if(_.length<3)return t;if(++a>o)return console.warn("quickDecomp: max level ("+o+") reached."),t;for(var E=0;E<this.vertices.length;++E)if(this.isReflex(E)){e.push(this.vertices[E]),d=f=Number.MAX_VALUE;for(var T=0;T<this.vertices.length;++T)i.left(this.at(E-1),this.at(E),this.at(T))&&i.rightOn(this.at(E-1),this.at(E),this.at(T-1))&&(l=c(this.at(E-1),this.at(E),this.at(T),this.at(T-1)),i.right(this.at(E+1),this.at(E),l)&&(p=i.sqdist(this.vertices[E],l))<f&&(f=p,h=l,y=T)),i.left(this.at(E+1),this.at(E),this.at(T+1))&&i.rightOn(this.at(E+1),this.at(E),this.at(T))&&(l=c(this.at(E+1),this.at(E),this.at(T),this.at(T+1)),i.left(this.at(E-1),this.at(E),l)&&(p=i.sqdist(this.vertices[E],l))<d&&(d=p,u=l,g=T));if(y==(g+1)%this.vertices.length)l[0]=(h[0]+u[0])/2,l[1]=(h[1]+u[1])/2,n.push(l),E<g?(b.append(this,E,g+1),b.vertices.push(l),w.vertices.push(l),0!=y&&w.append(this,y,this.vertices.length),w.append(this,0,E+1)):(0!=E&&b.append(this,E,this.vertices.length),b.append(this,0,g+1),b.vertices.push(l),w.vertices.push(l),w.append(this,y,E+1));else{if(y>g&&(g+=this.vertices.length),m=Number.MAX_VALUE,g<y)return t;for(T=y;T<=g;++T)i.leftOn(this.at(E-1),this.at(E),this.at(T))&&i.rightOn(this.at(E+1),this.at(E),this.at(T))&&(p=i.sqdist(this.at(E),this.at(T)))<m&&(m=p,v=T%this.vertices.length);E<v?(b.append(this,E,v+1),0!=v&&w.append(this,v,_.length),w.append(this,0,E+1)):(0!=E&&b.append(this,E,_.length),b.append(this,0,v+1),w.append(this,v,E+1))}return b.vertices.length<w.vertices.length?(b.quickDecomp(t,e,n,r,o,a),w.quickDecomp(t,e,n,r,o,a)):(w.quickDecomp(t,e,n,r,o,a),b.quickDecomp(t,e,n,r,o,a)),t}return t.push(this),t},s.prototype.removeCollinearPoints=function(t){for(var e=0,n=this.vertices.length-1;this.vertices.length>3&&n>=0;--n)i.collinear(this.at(n-1),this.at(n),this.at(n+1),t)&&(this.vertices.splice(n%this.vertices.length,1),n--,e++);return e}},KXN6:function(t,e){var n={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,n=0,r=0;r<e;r+=2)n+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return.5*-(n+=(t[0]-t[e])*(t[e+1]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var r=[],i=[],o=0;o<e;o++)i.push(o);o=0;for(var s=e;s>3;){var a=i[(o+0)%s],u=i[(o+1)%s],c=i[(o+2)%s],h=t[2*a],l=t[2*a+1],d=t[2*u],f=t[2*u+1],p=t[2*c],m=t[2*c+1],g=!1;if(n._convex(h,l,d,f,p,m)){g=!0;for(var y=0;y<s;y++){var v=i[y];if(v!=a&&v!=u&&v!=c&&n._PointInTriangle(t[2*v],t[2*v+1],h,l,d,f,p,m)){g=!1;break}}}if(g)r.push(a,u,c),i.splice((o+1)%s,1),s--,o=0;else if(o++>3*s)break}return r.push(i[0],i[1],i[2]),r},_PointInTriangle:function(t,e,n,r,i,o,s,a){var u=s-n,c=a-r,h=i-n,l=o-r,d=t-n,f=e-r,p=u*u+c*c,m=u*h+c*l,g=u*d+c*f,y=h*h+l*l,v=h*d+l*f,b=1/(p*y-m*m),w=(y*g-m*v)*b,_=(p*v-m*g)*b;return w>=0&&_>=0&&w+_<1},_convex:function(t,e,n,r,i,o){return(e-r)*(i-n)+(n-t)*(o-r)>=0}};t.exports=n},KaSA:function(t,e,n){t.exports=n("uzDk")},Ksdp:function(t,e,n){var r=n("GrVo");n("pSMy")({target:"Object",stat:!0,forced:Object.assign!==r},{assign:r})},LX9C:function(t,e,n){var r,i,o,s=n("BloW"),a=n("kpns"),u=n("wBs/"),c=n("57wU"),h=n("qBi7"),l=n("vcTx"),d=n("ysHE").WeakMap;if(s){var f=new d,p=f.get,m=f.has,g=f.set;r=function(t,e){return g.call(f,t,e),e},i=function(t){return p.call(f,t)||{}},o=function(t){return m.call(f,t)}}else{var y=h("state");l[y]=!0,r=function(t,e){return u(t,y,e),e},i=function(t){return c(t,y)?t[y]:{}},o=function(t){return c(t,y)}}t.exports={set:r,get:i,has:o,enforce:function(t){return o(t)?i(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!a(e)||(n=i(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}}},MKEH:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){(t=t||{}).type=r.PARTICLE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e,n){i.copy(t.lowerBound,e),i.copy(t.upperBound,e)}},"MVd/":function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){(t=t||{}).type=r.PLANE,r.call(this,t)}n("Wk7T"),t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,n){var r=n%(2*Math.PI),o=i.set,s=t.lowerBound,a=t.upperBound;o(s,-1e7,-1e7),o(a,1e7,1e7),0===r?a[1]=0:r===Math.PI/2?s[0]=0:r===Math.PI?s[1]=0:r===3*Math.PI/2&&(a[0]=0)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var s=i.create(),a=(i.create(),i.create(),i.create()),u=i.create();o.prototype.raycast=function(t,e,n,r){var o=e.from,c=e.to,h=e.direction,l=s,d=a,f=u;i.set(d,0,1),i.rotate(d,d,r),i.sub(f,o,n);var p=i.dot(f,d);if(i.sub(f,c,n),!(p*i.dot(f,d)>0||i.squaredDistance(o,c)<p*p)){var m=i.dot(d,h);i.sub(l,o,n);var g=-i.dot(d,l)/m/e.length;e.reportIntersection(t,g,d,-1)}}},MfhB:function(t,e,n){var r=n("ysHE"),i=n("nX7E"),o=r["__core-js_shared__"]||i("__core-js_shared__",{});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.0.1",mode:n("U5J1")?"pure":"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})},MgzW:function(t,e,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(t,e){for(var n,a,u=s(t),c=1;c<arguments.length;c++){for(var h in n=Object(arguments[c]))i.call(n,h)&&(u[h]=n[h]);if(r){a=r(n);for(var l=0;l<a.length;l++)o.call(n,a[l])&&(u[a[l]]=n[a[l]])}}return u}},MuAL:function(t,e,n){n("q94Q")("toPrimitive")},Nehr:function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},OQdp:function(t,e,n){var r;!function(i){var o=i.Promise,s=o&&"resolve"in o&&"reject"in o&&"all"in o&&"race"in o&&function(){var t;return new o(function(e){t=e}),"function"==typeof t}();e?(e.Promise=s?o:C,e.Polyfill=C):void 0===(r=(function(){return s?o:C}).call(e,n,e,t))||(t.exports=r);var a="pending",u="sealed",c="fulfilled",h="rejected",l=function(){};function d(t){return"[object Array]"===Object.prototype.toString.call(t)}var f,p="undefined"!=typeof setImmediate?setImmediate:setTimeout,m=[];function g(){for(var t=0;t<m.length;t++)m[t][0](m[t][1]);m=[],f=!1}function y(t,e){m.push([t,e]),f||(f=!0,p(g,0))}function v(t){var e=t.owner,n=e.state_,r=e.data_,i=t[n],o=t.then;if("function"==typeof i){n=c;try{r=i(r)}catch(s){E(o,s)}}b(o,r)||(n===c&&w(o,r),n===h&&E(o,r))}function b(t,e){var n;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,function(r){n||(n=!0,e!==r?w(t,r):_(t,r))},function(e){n||(n=!0,E(t,e))}),!0}}catch(i){return n||E(t,i),!0}return!1}function w(t,e){t!==e&&b(t,e)||_(t,e)}function _(t,e){t.state_===a&&(t.state_=u,t.data_=e,y(x,t))}function E(t,e){t.state_===a&&(t.state_=u,t.data_=e,y(S,t))}function T(t){var e=t.then_;t.then_=void 0;for(var n=0;n<e.length;n++)v(e[n])}function x(t){t.state_=c,T(t)}function S(t){t.state_=h,T(t)}function C(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof C==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function n(t){E(e,t)}try{t(function(t){w(e,t)},n)}catch(r){n(r)}}(t,this)}C.prototype={constructor:C,state_:a,then_:null,data_:void 0,then:function(t,e){var n={owner:this,then:new this.constructor(l),fulfilled:t,rejected:e};return this.state_===c||this.state_===h?y(v,n):this.then_.push(n),n.then},catch:function(t){return this.then(null,t)}},C.all=function(t){if(!d(t))throw new TypeError("You must pass an array to Promise.all().");return new this(function(e,n){var r=[],i=0;function o(t){return i++,function(n){r[t]=n,--i||e(r)}}for(var s,a=0;a<t.length;a++)(s=t[a])&&"function"==typeof s.then?s.then(o(a),n):r[a]=s;i||e(r)})},C.race=function(t){if(!d(t))throw new TypeError("You must pass an array to Promise.race().");return new this(function(e,n){for(var r,i=0;i<t.length;i++)(r=t[i])&&"function"==typeof r.then?r.then(e,n):e(r)})},C.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this(function(e){e(t)})},C.reject=function(t){return new this(function(e,n){n(t)})}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)},Q2Kg:function(t,e,n){var r=n("2w5C"),i=n("o9j8");t.exports=Object.keys||function(t){return r(t,i)}},Q2Wg:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}this.heights=(t=t||{}).heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}n("Wk7T"),t.exports=o,(o.prototype=new r).constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],n=t[0],r=0;r!==t.length;r++){var i=t[r];i>e&&(e=i),i<n&&(n=i)}this.maxValue=e,this.minValue=n},o.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,n=0;n<t.length-1;n++)e+=(t[n]+t[n+1])/2*this.elementWidth;this.area=e};var s=[i.create(),i.create(),i.create(),i.create()];o.prototype.computeAABB=function(t,e,n){i.set(s[0],0,this.maxValue),i.set(s[1],this.elementWidth*this.heights.length,this.maxValue),i.set(s[2],this.elementWidth*this.heights.length,this.minValue),i.set(s[3],0,this.minValue),t.setFromPoints(s,e,n)},o.prototype.getLineSegment=function(t,e,n){var r=this.heights,o=this.elementWidth;i.set(t,n*o,r[n]),i.set(e,(n+1)*o,r[n+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return Math.min(this.heights.length,Math.max(e,0))},i.create();var a=i.create(),u=i.create(),c=i.create(),h=i.create(),l=i.create();i.fromValues(0,1),o.prototype.raycast=function(t,e,n,r){var o=e.to,s=a,d=u,f=c,p=h,m=l;i.toLocalFrame(p,e.from,n,r),i.toLocalFrame(m,o,n,r);var g=this.getClampedSegmentIndex(p),y=this.getClampedSegmentIndex(m);if(g>y){var v=g;g=y,y=v}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(d,f,b);var w=i.getLineSegmentsIntersectionFraction(p,m,d,f);if(w>=0&&(i.sub(s,f,d),i.rotate(s,s,r+Math.PI/2),i.normalize(s,s),e.reportIntersection(t,w,s,-1),t.shouldStop(e)))return}}},QURa:function(t,e,n){n("q94Q")("patternMatch")},QvOV:function(t,e,n){var r=n("YCU0"),i=Object.prototype;r!==i.toString&&n("1f/i")(i,"toString",r,{unsafe:!0})},RJ5M:function(t,e,n){var r=n("3Jud"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.reset(),this}},RZpa:function(t,e,n){var r=n("JtD1"),i=n("Dded"),o=n("sbLb"),s=n("Dp7I"),a=n("yBzR"),u=n("BcWo"),c=n("i+N5");function h(t){t=t||{},c.call(this),this.id=t.id||++h._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=r.create(),this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),t.velocity&&r.copy(this.velocity,t.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=r.create(),t.force&&r.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=h.STATIC,this.type=void 0!==t.type?t.type:t.mass?h.DYNAMIC:h.STATIC,this.boundingRadius=0,this.aabb=new u,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=h.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}t.exports=h,(h.prototype=new c).constructor=h,h._idCounter=0,h.prototype.updateSolveMassProperties=function(){this.sleepState===h.SLEEPING||this.type===h.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},h.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},h.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},h.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new u,d=r.create();h.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,n=d,i=this.angle,o=0;o!==e;o++){var s=t[o],a=s.angle+i;r.rotate(n,s.position,i),r.add(n,n,this.position),s.computeAABB(l,n,a),0===o?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},h.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,n=0,i=0;i!==e;i++){var o=t[i],s=r.length(o.position),a=o.boundingRadius;s+a>n&&(n=s+a)}this.boundingRadius=n},h.prototype.addShape=function(t,e,n){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?r.copy(t.position,e):r.set(t.position,0,0),t.angle=n||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},h.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},h.prototype.updateMassProperties=function(){if(this.type===h.STATIC||this.type===h.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,n=this.mass/e,i=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var o=0;o<e;o++){var s=t[o],a=r.squaredLength(s.position);i+=s.computeMomentOfInertia(n)+n*a}this.inertia=i,this.invInertia=i>0?1/i:0}this.invMass=1/this.mass,r.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},r.create(),h.prototype.applyForce=function(t,e){if(r.add(this.force,this.force,t),e){var n=r.crossLength(e,t);this.angularForce+=n}};var f=r.create(),p=r.create(),m=r.create();h.prototype.applyForceLocal=function(t,e){e=e||m;var n=f,r=p;this.vectorToWorldFrame(n,t),this.vectorToWorldFrame(r,e),this.applyForce(n,r)};var g=r.create();h.prototype.applyImpulse=function(t,e){if(this.type===h.DYNAMIC){var n=g;if(r.scale(n,t,this.invMass),r.multiply(n,this.massMultiplier,n),r.add(this.velocity,n,this.velocity),e){var i=r.crossLength(e,t);this.angularVelocity+=i*=this.invInertia}}};var y=r.create(),v=r.create(),b=r.create();h.prototype.applyImpulseLocal=function(t,e){e=e||b;var n=y,r=v;this.vectorToWorldFrame(n,t),this.vectorToWorldFrame(r,e),this.applyImpulse(n,r)},h.prototype.toLocalFrame=function(t,e){r.toLocalFrame(t,e,this.position,this.angle)},h.prototype.toWorldFrame=function(t,e){r.toGlobalFrame(t,e,this.position,this.angle)},h.prototype.vectorToLocalFrame=function(t,e){r.vectorToLocalFrame(t,e,this.angle)},h.prototype.vectorToWorldFrame=function(t,e){r.vectorToGlobalFrame(t,e,this.angle)},h.prototype.fromPolygon=function(t,e){e=e||{};for(var n=this.shapes.length;n>=0;--n)this.removeShape(this.shapes[n]);var s,a=new i.Polygon;if(a.vertices=t,a.makeCCW(),"number"==typeof e.removeCollinearPoints&&a.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!a.isSimple())return!1;for(this.concavePath=a.vertices.slice(0),n=0;n<this.concavePath.length;n++)r.copy(l=[0,0],this.concavePath[n]),this.concavePath[n]=l;s=e.optimalDecomp?a.decomp():a.quickDecomp();var u=r.create();for(n=0;n!==s.length;n++){for(var c=new o({vertices:s[n].vertices}),h=0;h!==c.vertices.length;h++){var l;r.sub(l=c.vertices[h],l,c.centerOfMass)}r.scale(u,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,u)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0},r.fromValues(0,0);var w=r.fromValues(0,0),_=r.fromValues(0,0),E=r.fromValues(0,0);h.prototype.adjustCenterOfMass=function(){var t=w,e=_,n=E,i=0;r.set(e,0,0);for(var o=0;o!==this.shapes.length;o++)r.scale(t,(s=this.shapes[o]).position,s.area),r.add(e,e,t),i+=s.area;for(r.scale(n,e,1/i),o=0;o!==this.shapes.length;o++){var s;r.sub((s=this.shapes[o]).position,s.position,n)}for(r.add(this.position,this.position,n),o=0;this.concavePath&&o<this.concavePath.length;o++)r.sub(this.concavePath[o],this.concavePath[o],n);this.updateMassProperties(),this.updateBoundingRadius()},h.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},h.prototype.resetConstraintVelocity=function(){r.set(this.vlambda,0,0),this.wlambda=0},h.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},h.prototype.applyDamping=function(t){if(this.type===h.DYNAMIC){var e=this.velocity;r.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},h.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=h.AWAKE,this.idleTime=0,t!==h.AWAKE&&this.emit(h.wakeUpEvent)},h.prototype.sleep=function(){this.sleepState=h.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(h.sleepEvent)},h.prototype.sleepTick=function(t,e,n){this.allowSleep&&this.type!==h.SLEEPING&&(this.wantsToSleep=!1,r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=h.AWAKE):(this.idleTime+=n,this.sleepState=h.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},h.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var T=r.create(),x=r.create();h.prototype.integrate=function(t){var e=this.invMass,n=this.force,i=this.position,o=this.velocity;r.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),r.scale(T,n,t*e),r.multiply(T,this.massMultiplier,T),r.add(o,T,o),this.integrateToTimeOfImpact(t)||(r.scale(x,o,t),r.add(i,i,x),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var S=new s,C=new a({mode:a.ALL}),A=r.create(),I=r.create(),O=r.create(),D=r.create();h.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||r.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;r.normalize(A,this.velocity),r.scale(I,this.velocity,t),r.add(I,I,this.position),r.sub(O,I,this.position);var e,n=this.angularVelocity*t,i=r.length(O),o=1,s=this;if(S.reset(),C.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(I,C),r.sub(O,I,s.position),o=r.length(O)/i,t.stop())},r.copy(C.from,this.position),r.copy(C.to,I),C.update(),this.world.raycast(S,C),!e)return!1;var a=this.angle;r.copy(D,this.position);for(var u=0,c=0,h=0,l=o;l>=c&&u<this.ccdIterations;)u++,h=(l-c)/2,r.scale(x,O,o),r.add(this.position,D,x),this.angle=a+n*o,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?c=h:l=h;return o=h,r.copy(this.position,D),this.angle=a,r.scale(x,O,o),r.add(this.position,this.position,x),this.fixedRotation||(this.angle+=n*o),!0},h.prototype.getVelocityAtPoint=function(t,e){return r.crossVZ(t,e,this.angularVelocity),r.subtract(t,this.velocity,t),t},h.sleepyEvent={type:"sleepy"},h.sleepEvent={type:"sleep"},h.wakeUpEvent={type:"wakeup"},h.DYNAMIC=1,h.STATIC=2,h.KINEMATIC=4,h.AWAKE=0,h.SLEEPY=1,h.SLEEPING=2},S4gH:function(t,e,n){var r=n("TIpl").f,i=n("57wU"),o=n("aXXJ")("toStringTag");t.exports=function(t,e,n){t&&!i(t=n?t:t.prototype,o)&&r(t,o,{configurable:!0,value:e})}},S5sp:function(t,e,n){t.exports=!n("0HDe")(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},SAp2:function(t,e,n){var r=n("9Nts");t.exports=function(t){return Object(r(t))}},SIcJ:function(t,e,n){var r=n("Q2Kg"),i=n("fw2a"),o=n("iCuu");t.exports=function(t){var e=r(t),n=i.f;if(n)for(var s,a=n(t),u=o.f,c=0;a.length>c;)u.call(t,s=a[c++])&&e.push(s);return e}},SLVX:function(t,e,n){"use strict";function r(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}n.d(e,"a",function(){return r})},SN9G:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),this.length=(t=t||{}).length||1,this.radius=t.radius||1,t.type=r.CAPSULE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,n=this.length+e,r=2*e;return t*(r*r+n*n)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=i.create();o.prototype.computeAABB=function(t,e,n){var r=this.radius;i.set(s,this.length/2,0),0!==n&&i.rotate(s,s,n),i.set(t.upperBound,Math.max(s[0]+r,-s[0]+r),Math.max(s[1]+r,-s[1]+r)),i.set(t.lowerBound,Math.min(s[0]-r,-s[0]-r),Math.min(s[1]-r,-s[1]-r)),i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e)};var a=i.create(),u=i.create(),c=i.create(),h=i.create(),l=i.fromValues(0,1);o.prototype.raycast=function(t,e,n,r){for(var o=e.from,s=e.to,d=a,f=u,p=c,m=h,g=this.length/2,y=0;y<2;y++){var v=this.radius*(2*y-1);if(i.set(p,-g,v),i.set(m,g,v),i.toGlobalFrame(p,p,n,r),i.toGlobalFrame(m,m,n,r),(w=i.getLineSegmentsIntersectionFraction(o,s,p,m))>=0&&(i.rotate(f,l,r),i.scale(f,f,2*y-1),e.reportIntersection(t,w,f,-1),t.shouldStop(e)))return}var b=Math.pow(this.radius,2)+Math.pow(g,2);for(y=0;y<2;y++){i.set(p,g*(2*y-1),0),i.toGlobalFrame(p,p,n,r);var w,_=Math.pow(s[0]-o[0],2)+Math.pow(s[1]-o[1],2),E=2*((s[0]-o[0])*(o[0]-p[0])+(s[1]-o[1])*(o[1]-p[1])),T=Math.pow(o[0]-p[0],2)+Math.pow(o[1]-p[1],2)-Math.pow(this.radius,2);if(!((w=Math.pow(E,2)-4*_*T)<0))if(0===w){if(i.lerp(d,o,s,w),i.squaredDistance(d,n)>b&&(i.sub(f,d,p),i.normalize(f,f),e.reportIntersection(t,w,f,-1),t.shouldStop(e)))return}else{var x=Math.sqrt(w),S=1/(2*_),C=(-E-x)*S,A=(-E+x)*S;if(C>=0&&C<=1&&(i.lerp(d,o,s,C),i.squaredDistance(d,n)>b&&(i.sub(f,d,p),i.normalize(f,f),e.reportIntersection(t,C,f,-1),t.shouldStop(e))))return;if(A>=0&&A<=1&&(i.lerp(d,o,s,A),i.squaredDistance(d,n)>b&&(i.sub(f,d,p),i.normalize(f,f),e.reportIntersection(t,A,f,-1),t.shouldStop(e))))return}}}},SeMp:function(t,e){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}t.exports=n,n.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},T3Qk:function(t,e,n){n("q0E7"),n("//qW"),n("spD4"),t.exports=n("ahhG").f("iterator")},TIpl:function(t,e,n){var r=n("lb/b"),i=n("a0i3"),o=n("bcPd"),s=n("ehg7"),a=Object.defineProperty;e.f=r?a:function(t,e,n){if(o(t),e=s(e,!0),o(n),i)try{return a(t,e,n)}catch(r){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},U4hp:function(t,e,n){"use strict";var r=n("ehg7"),i=n("TIpl"),o=n("2Hee");t.exports=function(t,e,n){var s=r(e);s in t?i.f(t,s,o(0,n)):t[s]=n}},U5J1:function(t,e){t.exports=!1},Uv6z:function(t,e){!function(t){"use strict";if(!t.fetch){var e={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(e.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(t){return t&&DataView.prototype.isPrototypeOf(t)},i=ArrayBuffer.isView||function(t){return t&&n.indexOf(Object.prototype.toString.call(t))>-1};h.prototype.append=function(t,e){t=a(t),e=u(e);var n=this.map[t];this.map[t]=n?n+","+e:e},h.prototype.delete=function(t){delete this.map[a(t)]},h.prototype.get=function(t){return t=a(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(a(t))},h.prototype.set=function(t,e){this.map[a(t)]=u(e)},h.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},h.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),c(t)},h.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),c(t)},h.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),c(t)},e.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];g.prototype.clone=function(){return new g(this,{body:this._bodyInit})},m.call(g.prototype),m.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var s=[301,302,303,307,308];v.redirect=function(t,e){if(-1===s.indexOf(e))throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},t.Headers=h,t.Request=g,t.Response=v,t.fetch=function(t,n){return new Promise(function(r,i){var o=new g(t,n),s=new XMLHttpRequest;s.onload=function(){var t,e,n={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();e.append(r,i)}}),e)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL"),r(new v("response"in s?s.response:s.responseText,n))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&e.blob&&(s.responseType="blob"),o.headers.forEach(function(t,e){s.setRequestHeader(e,t)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}function a(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function u(t){return"string"!=typeof t&&(t=String(t)),t}function c(t){var n={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return e.iterable&&(n[Symbol.iterator]=function(){return n}),n}function h(t){this.map={},t instanceof h?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function f(t){var e=new FileReader,n=d(e);return e.readAsArrayBuffer(t),n}function p(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(e.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(e.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(e.arrayBuffer&&e.blob&&r(t))this._bodyArrayBuffer=p(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!e.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!i(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=p(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},e.blob&&(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?l(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var t,e,n,r=l(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,n=d(e=new FileReader),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},e.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function g(t,e){var n,r,i=(e=e||{}).body;if(t instanceof g){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(r=(n=e.method||this.method||"GET").toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function y(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(i))}}),e}function v(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:this)},VmRL:function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,a,u,c,h,f,m,g=e&&e.length,y=g?e[0]*n:t.length,v=i(t,0,y,n,!0),b=[];if(!v||v.next===v.prev)return b;if(g&&(v=function(t,e,n,r){var s,a,u,c=[];for(s=0,a=e.length;s<a;s++)(u=i(t,e[s]*r,s<a-1?e[s+1]*r:t.length,r,!1))===u.next&&(u.steiner=!0),c.push(p(u));for(c.sort(l),s=0;s<c.length;s++)d(c[s],n),n=o(n,n.next);return n}(t,e,v,n)),t.length>80*n){r=u=t[0],a=c=t[1];for(var w=n;w<y;w+=n)(h=t[w])<r&&(r=h),(f=t[w+1])<a&&(a=f),h>u&&(u=h),f>c&&(c=f);m=0!==(m=Math.max(u-r,c-a))?1/m:0}return s(v,b,n,r,a,m),b}function i(t,e,n,r,i){var o,s;if(i===S(t,e,n,r)>0)for(o=e;o<n;o+=r)s=E(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=E(o,t[o],t[o+1],s);return s&&v(s,s.next)&&(T(s),s=s.next),s}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!v(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{if(T(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function s(t,e,n,r,i,l,d){if(t){!d&&l&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=f(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,s,a,u,c=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(u=c;a>0||u>0&&r;)0!==a&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(s>1)}(i)}(t,r,i,l);for(var p,m,g=t;t.prev!==t.next;)if(p=t.prev,m=t.next,l?u(t,r,i,l):a(t))e.push(p.i/n),e.push(t.i/n),e.push(m.i/n),T(t),t=m.next,g=m.next;else if((t=m)===g){d?1===d?s(t=c(t,e,n),e,n,r,i,l,2):2===d&&h(t,e,n,r,i,l):s(o(t),e,n,r,i,l,1);break}}}function a(t){var e=t.prev,n=t,r=t.next;if(y(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(m(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,s=t.next;if(y(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,u=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,c=f(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,e,n,r),h=f(a,u,e,n,r),l=t.prevZ,d=t.nextZ;l&&l.z>=c&&d&&d.z<=h;){if(l!==t.prev&&l!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,l.x,l.y)&&y(l.prev,l,l.next)>=0)return!1;if(l=l.prevZ,d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&y(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;l&&l.z>=c;){if(l!==t.prev&&l!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,l.x,l.y)&&y(l.prev,l,l.next)>=0)return!1;l=l.prevZ}for(;d&&d.z<=h;){if(d!==t.prev&&d!==t.next&&m(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&y(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!v(i,o)&&b(i,r,r.next,o)&&w(i,o)&&w(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),T(r),T(r.next),r=t=o),r=r.next}while(r!==t);return r}function h(t,e,n,r,i,a){var u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&g(u,c)){var h=_(u,c);return u=o(u,u.next),h=o(h,h.next),s(u,e,n,r,i,a),void s(h,e,n,r,i,a)}c=c.next}u=u.next}while(u!==t)}function l(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===s)return n.prev;var u,c=n,h=n.x,l=n.y,d=1/0;for(r=n.next;r!==c;)i>=r.x&&r.x>=h&&i!==r.x&&m(o<l?i:s,o,h,l,o<l?s:i,o,r.x,r.y)&&((u=Math.abs(o-r.y)/(i-r.x))<d||u===d&&r.x>n.x)&&w(r,t)&&(n=r,d=u),r=r.next;return n}(t,e)){var n=_(e,t);o(n,n.next)}}function f(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function m(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&w(t,e)&&w(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function y(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){return!!(v(t,e)&&v(n,r)||v(t,r)&&v(n,e))||y(t,e,n)>0!=y(t,e,r)>0&&y(n,r,t)>0!=y(n,r,e)>0}function w(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function _(t,e){var n=new x(t.i,t.x,t.y),r=new x(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function E(t,e,n,r){var i=new x(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function T(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function x(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function S(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(S(t,0,i?e[0]*n:t.length,n));if(i)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(S(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n));var u=0;for(s=0;s<r.length;s+=3){var c=r[s]*n,h=r[s+1]*n,l=r[s+2]*n;u+=Math.abs((t[c]-t[l])*(t[h+1]-t[c+1])-(t[c]-t[h])*(t[l+1]-t[c+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&n.holes.push(r+=t[i-1].length)}return n}},WBJg:function(t,e,n){n("pSMy")({target:"String",proto:!0},{repeat:n("nsc/")})},Wcq6:function(t,e,n){"use strict";n("lcbw");var r,i=(r=n("wj3C"))&&"object"==typeof r&&"default"in r?r.default:r;t.exports=i},Wk7T:function(t,e){function n(){}t.exports=n,n.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var n=0,r=e.length;n!==r;++n)t.push(e[n])},n.splice=function(t,e,n){for(var r=e,i=t.length-(n=n||1);r<i;r++)t[r]=t[r+n];t.length=i},n.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,n.extend=function(t,e){for(var n in e)t[n]=e[n]},n.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},XCog:function(t,e,n){var r=n("0Bu/");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(i){}return function(n,i){return r(n,i),e?t.call(n,i):n.__proto__=i,n}}():void 0)},XZ30:function(t,e,n){var r=n("AeTl"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},YCU0:function(t,e,n){"use strict";var r=n("ZrEc"),i={};i[n("aXXJ")("toStringTag")]="z",t.exports="[object z]"!==String(i)?function(){return"[object "+r(this)+"]"}:i.toString},YcCt:function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,i){n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e=e||"&");var a=1e3;i&&"number"==typeof i.maxKeys&&(a=i.maxKeys);var u=t.length;a>0&&u>a&&(u=a);for(var c=0;c<u;++c){var h,l,d,f,p=t[c].replace(s,"%20"),m=p.indexOf(n);m>=0?(h=p.substr(0,m),l=p.substr(m+1)):(h=p,l=""),d=decodeURIComponent(h),f=decodeURIComponent(l),r(o,d)?Array.isArray(o[d])?o[d].push(f):o[d]=[o[d],f]:o[d]=f}return o}},YuTi:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},YxH6:function(t,e,n){"use strict";var r,i,o,s=n("0idE"),a=n("wBs/"),u=n("57wU"),c=n("U5J1"),h=n("aXXJ")("iterator"),l=!1;[].keys&&("next"in(o=[].keys())?(i=s(s(o)))!==Object.prototype&&(r=i):l=!0),null==r&&(r={}),c||u(r,h)||a(r,h,function(){return this}),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:l}},ZPxF:function(t,e,n){n("S4gH")(n("ysHE").JSON,"JSON",!0)},ZrEc:function(t,e,n){var r=n("hdqJ"),i=n("aXXJ")("toStringTag"),o="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(n){}}(e=Object(t),i))?n:o?r(e):"Object"==(s=r(e))&&"function"==typeof e.callee?"Arguments":s}},"a+hM":function(t,e,n){var r=n("57wU"),i=n("ySdl"),o=n("pYsU"),s=n("TIpl");t.exports=function(t,e){for(var n=i(e),a=s.f,u=o.f,c=0;c<n.length;c++){var h=n[c];r(t,h)||a(t,h,u(e,h))}}},a0i3:function(t,e,n){t.exports=!n("lb/b")&&!n("0HDe")(function(){return 7!=Object.defineProperty(n("JIMt")("div"),"a",{get:function(){return 7}}).a})},aXXJ:function(t,e,n){var r=n("MfhB")("wks"),i=n("ptKZ"),o=n("ysHE").Symbol,s=n("mk1t");t.exports=function(t){return r[t]||(r[t]=s&&o[t]||(s?o:i)("Symbol."+t))}},ahhG:function(t,e,n){e.f=n("aXXJ")},b2LF:function(t,e,n){n("q94Q")("hasInstance")},bCCX:function(t,e,n){"use strict";(function(t){var r,i=n("SLVX");r="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:t;var o=Object(i.a)(r);e.a=o}).call(this,n("3UD+")(t))},bcDB:function(t,e,n){var r=n("0pMi"),i=(n("+1EK"),n("kR7G"));function o(t,e,n){r.call(this,t,e,r.GEAR,n=n||{}),this.ratio=void 0!==n.ratio?n.ratio:1,this.angle=void 0!==n.angle?n.angle:e.angle-this.ratio*t.angle,n.angle=this.angle,n.ratio=this.ratio,this.equations=[new i(t,e,n)],void 0!==n.maxTorque&&this.setMaxTorque(n.maxTorque)}n("JtD1"),t.exports=o,(o.prototype=new r).constructor=o,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},bcPd:function(t,e,n){var r=n("kpns");t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},crnd:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="crnd"},d8cw:function(t,e,n){"use strict";var r=n("vQkR")(5),i=!0;"find"in[]&&Array(1).find(function(){i=!1}),n("pSMy")({target:"Array",proto:!0,forced:i},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("gJLK")("find")},dOQH:function(t,e,n){var r=n("0pMi"),i=n("JtD1"),o=n("+1EK");function s(t,e,n){r.call(this,t,e,r.LOCK,n=n||{});var s=void 0===n.maxForce?Number.MAX_VALUE:n.maxForce,a=new o(t,e,-s,s),u=new o(t,e,-s,s),c=new o(t,e,-s,s),h=i.create(),l=i.create(),d=this;a.computeGq=function(){return i.rotate(h,d.localOffsetB,t.angle),i.sub(l,e.position,t.position),i.sub(l,l,h),l[0]},u.computeGq=function(){return i.rotate(h,d.localOffsetB,t.angle),i.sub(l,e.position,t.position),i.sub(l,l,h),l[1]};var f=i.create(),p=i.create();c.computeGq=function(){return i.rotate(f,d.localOffsetB,e.angle-d.localAngleB),i.scale(f,f,-1),i.sub(l,t.position,e.position),i.add(l,l,f),i.rotate(p,f,-Math.PI/2),i.normalize(p,p),i.dot(l,p)},this.localOffsetB=i.create(),n.localOffsetB?i.copy(this.localOffsetB,n.localOffsetB):(i.sub(this.localOffsetB,e.position,t.position),i.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,this.localAngleB="number"==typeof n.localAngleB?n.localAngleB:e.angle-t.angle,this.equations.push(a,u,c),this.setMaxForce(s)}t.exports=s,(s.prototype=new r).constructor=s,s.prototype.setMaxForce=function(t){for(var e=this.equations,n=0;n<this.equations.length;n++)e[n].maxForce=t,e[n].minForce=-t},s.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=i.create(),u=i.create(),c=i.create(),h=i.fromValues(1,0),l=i.fromValues(0,1);s.prototype.update=function(){var t=this.equations[0],e=this.equations[1],n=this.equations[2],r=this.bodyB;i.rotate(a,this.localOffsetB,this.bodyA.angle),i.rotate(u,this.localOffsetB,r.angle-this.localAngleB),i.scale(u,u,-1),i.rotate(c,u,Math.PI/2),i.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-i.crossLength(a,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-i.crossLength(a,l),e.G[4]=1,n.G[0]=-c[0],n.G[1]=-c[1],n.G[3]=c[0],n.G[4]=c[1],n.G[5]=i.crossLength(u,c)}},dYkh:function(t,e,n){n("q94Q")("search")},dstF:function(t,e,n){n("q94Q")("replace")},ehBJ:function(t,e,n){n("73IE"),t.exports=n("vLVD")("String","startsWith")},ehg7:function(t,e,n){var r=n("kpns");t.exports=function(t,e){if(!r(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!r(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},fq9q:function(t,e,n){var r=n("+1EK"),i=n("JtD1");function o(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=i.create(),this.penetrationVec=i.create(),this.contactPointB=i.create(),this.normalA=i.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeB=function(t,e,n){var r,o,s=this.contactPointA,a=this.contactPointB,u=this.bodyA.position,c=this.bodyB.position,h=this.penetrationVec,l=this.normalA,d=this.G,f=i.crossLength(s,l),p=i.crossLength(a,l);return d[0]=-l[0],d[1]=-l[1],d[2]=-f,d[3]=l[0],d[4]=l[1],d[5]=p,i.add(h,c,a),i.sub(h,h,u),i.sub(h,h,s),this.firstImpact&&0!==this.restitution?(o=0,r=1/e*(1+this.restitution)*this.computeGW()):(o=i.dot(l,h)+this.offset,r=this.computeGW()),-o*t-r*e-n*this.computeGiMf()};var s=i.create(),a=i.create(),u=i.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(s,this.contactPointA),this.bodyB.getVelocityAtPoint(a,this.contactPointB),i.subtract(u,s,a),i.dot(this.normalA,u)}},fw2a:function(t,e){e.f=Object.getOwnPropertySymbols},g7Su:function(t,e,n){var r=n("0HDe"),i=n("aXXJ")("species");t.exports=function(t){return!r(function(){var e=[];return(e.constructor={})[i]=function(){return{foo:1}},1!==e[t](Boolean).foo})}},gB0W:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),this.length=(t=t||{}).length||1,t.type=r.LINE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[i.create(),i.create()];o.prototype.computeAABB=function(t,e,n){var r=this.length/2;i.set(s[0],-r,0),i.set(s[1],r,0),t.setFromPoints(s,e,n,0)},i.create();var a=i.create(),u=i.create(),c=i.create(),h=i.fromValues(0,1);o.prototype.raycast=function(t,e,n,r){var o=e.from,s=e.to,l=u,d=c,f=this.length/2;i.set(l,-f,0),i.set(d,f,0),i.toGlobalFrame(l,l,n,r),i.toGlobalFrame(d,d,n,r);var p=i.getLineSegmentsIntersectionFraction(l,d,o,s);if(p>=0){var m=a;i.rotate(m,h,r),e.reportIntersection(t,p,m,-1)}}},"gC/R":function(t,e,n){n("JtD1");var r=n("6Pil");function i(t,e,n){r.call(this,t,e,n=n||{}),this.restAngle="number"==typeof n.restAngle?n.restAngle:e.angle-t.angle}t.exports=i,(i.prototype=new r).constructor=i,i.prototype.applyForce=function(){var t=this.bodyA,e=this.bodyB,n=-this.stiffness*(e.angle-t.angle-this.restAngle)-this.damping*(e.angularVelocity-t.angularVelocity)*0;t.angularForce-=n,e.angularForce+=n}},gIEr:function(t,e,n){n("q94Q")("species")},gJLK:function(t,e,n){var r=n("aXXJ")("unscopables"),i=n("tzov"),o=n("wBs/"),s=Array.prototype;null==s[r]&&o(s,r,i(null)),t.exports=function(t){s[r][t]=!0}},gJmg:function(t,e,n){var r=n("zqkD");function i(){}t.exports=i,i.lineInt=function(t,e,n){var i,o,s,a,u,c,h,l=[0,0];return s=(i=t[1][1]-t[0][1])*t[0][0]+(o=t[0][0]-t[1][0])*t[0][1],c=(a=e[1][1]-e[0][1])*e[0][0]+(u=e[0][0]-e[1][0])*e[0][1],r.eq(h=i*u-a*o,0,n=n||0)||(l[0]=(u*s-o*c)/h,l[1]=(i*c-a*s)/h),l},i.segmentsIntersect=function(t,e,n,r){var i=e[0]-t[0],o=e[1]-t[1],s=r[0]-n[0],a=r[1]-n[1];if(s*o-a*i==0)return!1;var u=(i*(n[1]-t[1])+o*(t[0]-n[0]))/(s*o-a*i),c=(s*(t[1]-n[1])+a*(n[0]-t[0]))/(a*i-s*o);return u>=0&&u<=1&&c>=0&&c<=1}},gRQh:function(t,e,n){var r,i,o;!function(n){var s=/iPhone/i,a=/iPod/i,u=/iPad/i,c=/\bAndroid(?:.+)Mobile\b/i,h=/Android/i,l=/\bAndroid(?:.+)SD4930UR\b/i,d=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,f=/Windows Phone/i,p=/\bWindows(?:.+)ARM\b/i,m=/BlackBerry/i,g=/BB10/i,y=/Opera Mini/i,v=/\b(CriOS|Chrome)(?:.+)Mobile/i,b=/Mobile(?:.+)Firefox\b/i;function w(t,e){return t.test(e)}function _(t){var e=t||("undefined"!=typeof navigator?navigator.userAgent:""),n=e.split("[FBAN");void 0!==n[1]&&(e=n[0]),void 0!==(n=e.split("Twitter"))[1]&&(e=n[0]);var r={apple:{phone:w(s,e)&&!w(f,e),ipod:w(a,e),tablet:!w(s,e)&&w(u,e)&&!w(f,e),device:(w(s,e)||w(a,e)||w(u,e))&&!w(f,e)},amazon:{phone:w(l,e),tablet:!w(l,e)&&w(d,e),device:w(l,e)||w(d,e)},android:{phone:!w(f,e)&&w(l,e)||!w(f,e)&&w(c,e),tablet:!w(f,e)&&!w(l,e)&&!w(c,e)&&(w(d,e)||w(h,e)),device:!w(f,e)&&(w(l,e)||w(d,e)||w(c,e)||w(h,e))||w(/\bokhttp\b/i,e)},windows:{phone:w(f,e),tablet:w(p,e),device:w(f,e)||w(p,e)},other:{blackberry:w(m,e),blackberry10:w(g,e),opera:w(y,e),firefox:w(b,e),chrome:w(v,e),device:w(m,e)||w(g,e)||w(y,e)||w(b,e)||w(v,e)}};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}t.exports&&"undefined"==typeof window?t.exports=_:t.exports&&"undefined"!=typeof window?(t.exports=_(),t.exports.isMobile=_):(i=[],r=n.isMobile=_(),void 0===(o="function"==typeof r?r.apply(e,i):r)||(t.exports=o))}(this)},goqo:function(t,e,n){var r=n("0pMi"),i=n("+1EK"),o=n("B9yW"),s=n("0DzJ"),a=n("JtD1");t.exports=f;var u=a.create(),c=a.create(),h=a.fromValues(1,0),l=a.fromValues(0,1),d=a.create();function f(t,e,n){r.call(this,t,e,r.REVOLUTE,n=n||{});var f=this.maxForce=void 0!==n.maxForce?n.maxForce:Number.MAX_VALUE;this.pivotA=a.create(),this.pivotB=a.create(),n.worldPivot?(a.sub(this.pivotA,n.worldPivot,t.position),a.sub(this.pivotB,n.worldPivot,e.position),a.rotate(this.pivotA,this.pivotA,-t.angle),a.rotate(this.pivotB,this.pivotB,-e.angle)):(a.copy(this.pivotA,n.localPivotA),a.copy(this.pivotB,n.localPivotB));var p=this.equations=[new i(t,e,-f,f),new i(t,e,-f,f)],m=p[0],g=p[1],y=this;m.computeGq=function(){return a.rotate(u,y.pivotA,t.angle),a.rotate(c,y.pivotB,e.angle),a.add(d,e.position,c),a.sub(d,d,t.position),a.sub(d,d,u),a.dot(d,h)},g.computeGq=function(){return a.rotate(u,y.pivotA,t.angle),a.rotate(c,y.pivotB,e.angle),a.add(d,e.position,c),a.sub(d,d,t.position),a.sub(d,d,u),a.dot(d,l)},g.minForce=m.minForce=-f,g.maxForce=m.maxForce=f,this.motorEquation=new o(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new s(t,e),this.lowerLimitEquation=new s(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}(f.prototype=new r).constructor=f,f.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},f.prototype.update=function(){var t,e=this.bodyA,n=this.bodyB,r=this.pivotA,i=this.pivotB,o=this.equations,s=o[0],d=o[1],f=this.upperLimit,p=this.lowerLimit,m=this.upperLimitEquation,g=this.lowerLimitEquation,y=this.angle=n.angle-e.angle;this.upperLimitEnabled&&y>f?(m.angle=f,-1===o.indexOf(m)&&o.push(m)):-1!==(t=o.indexOf(m))&&o.splice(t,1),this.lowerLimitEnabled&&y<p?(g.angle=p,-1===o.indexOf(g)&&o.push(g)):-1!==(t=o.indexOf(g))&&o.splice(t,1),a.rotate(u,r,e.angle),a.rotate(c,i,n.angle),s.G[0]=-1,s.G[1]=0,s.G[2]=-a.crossLength(u,h),s.G[3]=1,s.G[4]=0,s.G[5]=a.crossLength(c,h),d.G[0]=0,d.G[1]=-1,d.G[2]=-a.crossLength(u,l),d.G[3]=0,d.G[4]=1,d.G[5]=a.crossLength(c,l)},f.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},f.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},f.prototype.motorIsEnabled=function(){return!!this.motorEnabled},f.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},f.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},hEy5:function(t,e,n){var r=n("FnXw"),i=n("9Nts");t.exports=function(t,e,n){if(r(e))throw TypeError("String.prototype."+n+" doesn't accept regex");return String(i(t))}},hdqJ:function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},"i+N5":function(t,e){var n=function(){};t.exports=n,n.prototype={constructor:n,on:function(t,e,n){e.context=n||this,void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;if(e){if(void 0!==n[t]&&-1!==n[t].indexOf(e))return!0}else if(void 0!==n[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners,r=n[t].indexOf(e);return-1!==r&&n[t].splice(r,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=0,r=e.length;n<r;n++){var i=e[n];i.call(i.context,t)}}return this}}},iCuu:function(t,e,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);e.f=o?function(t){var e=i(this,t);return!!e&&e.enumerable}:r},iFPw:function(t,e,n){var r=n("JtD1"),i=r.sub,o=r.add,s=r.dot,a=(n("Wk7T"),n("2Vfd")),u=n("iZbu"),c=n("vMUY"),h=n("+1EK"),l=(n("fq9q"),n("yqpj"),n("1vck")),d=n("sbLb"),f=n("rCTz"),p=(n("RZpa"),n("I+AN"));t.exports=R;var m=r.fromValues(0,1),g=r.fromValues(0,0),y=r.fromValues(0,0),v=r.fromValues(0,0),b=r.fromValues(0,0),w=r.fromValues(0,0),_=r.fromValues(0,0),E=r.fromValues(0,0),T=r.fromValues(0,0),x=r.fromValues(0,0),S=r.fromValues(0,0),C=r.fromValues(0,0),A=r.fromValues(0,0),I=r.fromValues(0,0),O=r.fromValues(0,0),D=r.fromValues(0,0),k=r.fromValues(0,0),P=r.fromValues(0,0),N=r.fromValues(0,0),M=[];function R(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new a({size:32}),this.frictionEquationPool=new u({size:64}),this.restitution=0,this.stiffness=h.DEFAULT_STIFFNESS,this.relaxation=h.DEFAULT_RELAXATION,this.frictionStiffness=h.DEFAULT_STIFFNESS,this.frictionRelaxation=h.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new c,this.contactSkinSize=.01}var L=r.create(),F=r.create();function B(t,e){r.set(t.vertices[0],.5*-e.length,-e.radius),r.set(t.vertices[1],.5*e.length,-e.radius),r.set(t.vertices[2],.5*e.length,e.radius),r.set(t.vertices[3],.5*-e.length,e.radius)}R.prototype.bodiesOverlap=function(t,e){for(var n=L,r=F,i=0,o=t.shapes.length;i!==o;i++){var s=t.shapes[i];t.toWorldFrame(n,s.position);for(var a=0,u=e.shapes.length;a!==u;a++){var c=e.shapes[a];if(e.toWorldFrame(r,c.position),this[s.type|c.type](t,s,n,s.angle+t.angle,e,c,r,c.angle+e.angle,!0))return!0}}return!1},R.prototype.collidedLastStep=function(t,e){return!!this.collidingBodiesLastStep.get(0|t.id,0|e.id)},R.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var n=t[e];this.collidingBodiesLastStep.set(n.bodyA.id,n.bodyB.id,!0)}for(var r=this.contactEquations,i=this.frictionEquations,o=0;o<r.length;o++)this.contactEquationPool.release(r[o]);for(o=0;o<i.length;o++)this.frictionEquationPool.release(i[o]);this.contactEquations.length=this.frictionEquations.length=0},R.prototype.createContactEquation=function(t,e,n,r){var i=this.contactEquationPool.get();return i.bodyA=t,i.bodyB=e,i.shapeA=n,i.shapeB=r,i.restitution=this.restitution,i.firstImpact=!this.collidedLastStep(t,e),i.stiffness=this.stiffness,i.relaxation=this.relaxation,i.needsUpdate=!0,i.enabled=this.enabledEquations,i.offset=this.contactSkinSize,i},R.prototype.createFrictionEquation=function(t,e,n,r){var i=this.frictionEquationPool.get();return i.bodyA=t,i.bodyB=e,i.shapeA=n,i.shapeB=r,i.setSlipForce(this.slipForce),i.frictionCoefficient=this.frictionCoefficient,i.relativeVelocity=this.surfaceVelocity,i.enabled=this.enabledEquations,i.needsUpdate=!0,i.stiffness=this.frictionStiffness,i.relaxation=this.frictionRelaxation,i.contactEquations.length=0,i},R.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return r.copy(e.contactPointA,t.contactPointA),r.copy(e.contactPointB,t.contactPointB),r.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},R.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],n=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;r.set(n.contactPointA,0,0),r.set(n.contactPointB,0,0),r.set(n.t,0,0);for(var o=0;o!==t;o++)(e=this.contactEquations[this.contactEquations.length-1-o]).bodyA===i?(r.add(n.t,n.t,e.normalA),r.add(n.contactPointA,n.contactPointA,e.contactPointA),r.add(n.contactPointB,n.contactPointB,e.contactPointB)):(r.sub(n.t,n.t,e.normalA),r.add(n.contactPointA,n.contactPointA,e.contactPointB),r.add(n.contactPointB,n.contactPointB,e.contactPointA)),n.contactEquations.push(e);var s=1/t;return r.scale(n.contactPointA,n.contactPointA,s),r.scale(n.contactPointB,n.contactPointB,s),r.normalize(n.t,n.t),r.rotate90cw(n.t,n.t),n},R.prototype[f.LINE|f.CONVEX]=R.prototype.convexLine=function(t,e,n,r,i,o,s,a,u){return!u&&0},R.prototype[f.LINE|f.BOX]=R.prototype.lineBox=function(t,e,n,r,i,o,s,a,u){return!u&&0};var U=new p({width:1,height:1}),V=r.create();R.prototype[f.CAPSULE|f.CONVEX]=R.prototype[f.CAPSULE|f.BOX]=R.prototype.convexCapsule=function(t,e,n,i,o,s,a,u,c){var h=V;r.set(h,s.length/2,0),r.rotate(h,h,u),r.add(h,h,a);var l=this.circleConvex(o,s,h,u,t,e,n,i,c,s.radius);r.set(h,-s.length/2,0),r.rotate(h,h,u),r.add(h,h,a);var d=this.circleConvex(o,s,h,u,t,e,n,i,c,s.radius);if(c&&(l||d))return!0;var f=U;return B(f,s),this.convexConvex(t,e,n,i,o,f,a,u,c)+l+d},R.prototype[f.CAPSULE|f.LINE]=R.prototype.lineCapsule=function(t,e,n,r,i,o,s,a,u){return!u&&0};var j=r.create(),q=r.create(),G=new p({width:1,height:1});R.prototype[f.CAPSULE|f.CAPSULE]=R.prototype.capsuleCapsule=function(t,e,n,i,o,s,a,u,c){for(var h=j,l=q,d=0,f=0;f<2;f++){r.set(h,(0===f?-1:1)*e.length/2,0),r.rotate(h,h,i),r.add(h,h,n);for(var p=0;p<2;p++){r.set(l,(0===p?-1:1)*s.length/2,0),r.rotate(l,l,u),r.add(l,l,a),this.enableFrictionReduction&&(v=this.enableFriction,this.enableFriction=!1);var m=this.circleCircle(t,e,h,i,o,s,l,u,c,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=v),c&&m)return!0;d+=m}}this.enableFrictionReduction&&(v=this.enableFriction,this.enableFriction=!1);var g=G;B(g,e);var y=this.convexCapsule(t,g,n,i,o,s,a,u,c);if(this.enableFrictionReduction&&(this.enableFriction=v),c&&y)return!0;if(d+=y,this.enableFrictionReduction){var v=this.enableFriction;this.enableFriction=!1}B(g,s);var b=this.convexCapsule(o,g,a,u,t,e,n,i,c);return this.enableFrictionReduction&&(this.enableFriction=v),!(!c||!b)||(d+=b,this.enableFrictionReduction&&d&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(d)),d)},R.prototype[f.LINE|f.LINE]=R.prototype.lineLine=function(t,e,n,r,i,o,s,a,u){return!u&&0},R.prototype[f.PLANE|f.LINE]=R.prototype.planeLine=function(t,e,n,a,u,c,h,l,d){var f=g,p=y,S=v,C=b,A=w,I=_,O=E,D=T,k=x,P=M,N=0;r.set(f,-c.length/2,0),r.set(p,c.length/2,0),r.rotate(S,f,l),r.rotate(C,p,l),o(S,S,h),o(C,C,h),r.copy(f,S),r.copy(p,C),i(A,p,f),r.normalize(I,A),r.rotate90cw(k,I),r.rotate(D,m,a),P[0]=f,P[1]=p;for(var R=0;R<P.length;R++){var L=P[R];i(O,L,n);var F=s(O,D);if(F<0){if(d)return!0;var B=this.createContactEquation(t,u,e,c);N++,r.copy(B.normalA,D),r.normalize(B.normalA,B.normalA),r.scale(O,D,F),i(B.contactPointA,L,O),i(B.contactPointA,B.contactPointA,t.position),i(B.contactPointB,L,h),o(B.contactPointB,B.contactPointB,h),i(B.contactPointB,B.contactPointB,u.position),this.contactEquations.push(B),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B))}}return!d&&(this.enableFrictionReduction||N&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(N)),N)},R.prototype[f.PARTICLE|f.CAPSULE]=R.prototype.particleCapsule=function(t,e,n,r,i,o,s,a,u){return this.circleLine(t,e,n,r,i,o,s,a,u,o.radius,0)},R.prototype[f.CIRCLE|f.LINE]=R.prototype.circleLine=function(t,e,n,a,u,c,h,l,d,f,p){f=f||0,p=void 0!==p?p:e.radius;var m=g,D=y,k=v,P=b,N=w,R=_,L=E,F=T,B=x,U=S,V=C,j=A,q=I,G=O,H=M;r.set(F,-c.length/2,0),r.set(B,c.length/2,0),r.rotate(U,F,l),r.rotate(V,B,l),o(U,U,h),o(V,V,h),r.copy(F,U),r.copy(B,V),i(R,B,F),r.normalize(L,R),r.rotate90cw(N,L),i(j,n,F);var z=s(j,N);i(P,F,h),i(q,n,h);var W=p+f;if(Math.abs(z)<W){r.scale(m,N,z),i(k,n,m),r.scale(D,N,s(N,q)),r.normalize(D,D),r.scale(D,D,f),o(k,k,D);var K=s(L,k),X=s(L,F),Q=s(L,B);if(K>X&&K<Q){if(d)return!0;var Y=this.createContactEquation(t,u,e,c);return r.scale(Y.normalA,m,-1),r.normalize(Y.normalA,Y.normalA),r.scale(Y.contactPointA,Y.normalA,p),o(Y.contactPointA,Y.contactPointA,n),i(Y.contactPointA,Y.contactPointA,t.position),i(Y.contactPointB,k,h),o(Y.contactPointB,Y.contactPointB,h),i(Y.contactPointB,Y.contactPointB,u.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}}H[0]=F,H[1]=B;for(var J=0;J<H.length;J++){var $=H[J];if(i(j,$,n),r.squaredLength(j)<Math.pow(W,2))return!!d||(Y=this.createContactEquation(t,u,e,c),r.copy(Y.normalA,j),r.normalize(Y.normalA,Y.normalA),r.scale(Y.contactPointA,Y.normalA,p),o(Y.contactPointA,Y.contactPointA,n),i(Y.contactPointA,Y.contactPointA,t.position),i(Y.contactPointB,$,h),r.scale(G,Y.normalA,-f),o(Y.contactPointB,Y.contactPointB,G),o(Y.contactPointB,Y.contactPointB,h),i(Y.contactPointB,Y.contactPointB,u.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1)}return 0},R.prototype[f.CIRCLE|f.CAPSULE]=R.prototype.circleCapsule=function(t,e,n,r,i,o,s,a,u){return this.circleLine(t,e,n,r,i,o,s,a,u,o.radius)},R.prototype[f.CIRCLE|f.CONVEX]=R.prototype[f.CIRCLE|f.BOX]=R.prototype.circleConvex=function(t,e,n,s,a,u,c,h,l,d){d="number"==typeof d?d:e.radius;for(var f=g,p=y,m=v,_=b,E=w,T=S,x=C,A=I,P=O,N=D,M=k,R=!1,L=Number.MAX_VALUE,F=u.vertices,B=0;B!==F.length+1;B++){var U=F[(B+1)%F.length];if(r.rotate(f,F[B%F.length],h),r.rotate(p,U,h),o(f,f,c),o(p,p,c),i(m,p,f),r.normalize(_,m),r.rotate90cw(E,_),r.scale(P,E,-e.radius),o(P,P,n),X(P,u,c,h)){r.sub(N,f,P);var V=Math.abs(r.dot(N,E));V<L&&(r.copy(M,P),L=V,r.scale(A,E,V),r.add(A,A,P),R=!0)}}if(R){if(l)return!0;var j=this.createContactEquation(t,a,e,u);return r.sub(j.normalA,M,n),r.normalize(j.normalA,j.normalA),r.scale(j.contactPointA,j.normalA,d),o(j.contactPointA,j.contactPointA,n),i(j.contactPointA,j.contactPointA,t.position),i(j.contactPointB,A,c),o(j.contactPointB,j.contactPointB,c),i(j.contactPointB,j.contactPointB,a.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}if(d>0)for(B=0;B<F.length;B++)if(r.rotate(x,F[B],h),o(x,x,c),i(T,x,n),r.squaredLength(T)<Math.pow(d,2))return!!l||(j=this.createContactEquation(t,a,e,u),r.copy(j.normalA,T),r.normalize(j.normalA,j.normalA),r.scale(j.contactPointA,j.normalA,d),o(j.contactPointA,j.contactPointA,n),i(j.contactPointA,j.contactPointA,t.position),i(j.contactPointB,x,c),o(j.contactPointB,j.contactPointB,c),i(j.contactPointB,j.contactPointB,a.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1);return 0};var H=r.create(),z=r.create(),W=r.create(),K=r.create();function X(t,e,n,s){for(var a=H,u=z,c=W,h=K,l=t,d=e.vertices,f=null,p=0;p!==d.length+1;p++){var m=d[(p+1)%d.length];r.rotate(a,d[p%d.length],s),r.rotate(u,m,s),o(a,a,n),o(u,u,n),i(c,a,l),i(h,u,l);var g=r.crossLength(c,h);if(null===f&&(f=g),g*f<=0)return!1;f=g}return!0}R.prototype[f.PARTICLE|f.CONVEX]=R.prototype[f.PARTICLE|f.BOX]=R.prototype.particleConvex=function(t,e,n,a,u,c,h,l,d){var f=g,p=y,m=v,T=b,x=w,C=_,A=E,O=S,D=I,k=P,M=N,R=Number.MAX_VALUE,L=!1,F=c.vertices;if(!X(n,c,h,l))return 0;if(d)return!0;for(var B=0;B!==F.length+1;B++){var U=F[(B+1)%F.length];r.rotate(f,F[B%F.length],l),r.rotate(p,U,l),o(f,f,h),o(p,p,h),i(m,p,f),r.normalize(T,m),r.rotate90cw(x,T),i(O,n,f),s(O,x),i(C,f,h),i(A,n,h),r.sub(k,f,n);var V=Math.abs(r.dot(k,x));V<R&&(R=V,r.scale(D,x,V),r.add(D,D,n),r.copy(M,x),L=!0)}if(L){var j=this.createContactEquation(t,u,e,c);return r.scale(j.normalA,M,-1),r.normalize(j.normalA,j.normalA),r.set(j.contactPointA,0,0),o(j.contactPointA,j.contactPointA,n),i(j.contactPointA,j.contactPointA,t.position),i(j.contactPointB,D,h),o(j.contactPointB,j.contactPointB,h),i(j.contactPointB,j.contactPointB,u.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}return 0},R.prototype[f.CIRCLE]=R.prototype.circleCircle=function(t,e,n,s,a,u,c,h,l,d,f){var p=g;d=d||e.radius,f=f||u.radius,i(p,n,c);var m=d+f;if(r.squaredLength(p)>Math.pow(m,2))return 0;if(l)return!0;var y=this.createContactEquation(t,a,e,u);return i(y.normalA,c,n),r.normalize(y.normalA,y.normalA),r.scale(y.contactPointA,y.normalA,d),r.scale(y.contactPointB,y.normalA,-f),o(y.contactPointA,y.contactPointA,n),i(y.contactPointA,y.contactPointA,t.position),o(y.contactPointB,y.contactPointB,c),i(y.contactPointB,y.contactPointB,a.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},R.prototype[f.PLANE|f.CONVEX]=R.prototype[f.PLANE|f.BOX]=R.prototype.planeConvex=function(t,e,n,a,u,c,h,l,d){var f=g,p=y,b=v,w=0;r.rotate(p,m,a);for(var _=0;_!==c.vertices.length;_++)if(r.rotate(f,c.vertices[_],l),o(f,f,h),i(b,f,n),s(b,p)<=0){if(d)return!0;w++;var E=this.createContactEquation(t,u,e,c);i(b,f,n),r.copy(E.normalA,p);var T=s(b,E.normalA);r.scale(b,E.normalA,T),i(E.contactPointB,f,u.position),i(E.contactPointA,f,b),i(E.contactPointA,E.contactPointA,t.position),this.contactEquations.push(E),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(E))}return this.enableFrictionReduction&&this.enableFriction&&w&&this.frictionEquations.push(this.createFrictionFromAverage(w)),w},R.prototype[f.PARTICLE|f.PLANE]=R.prototype.particlePlane=function(t,e,n,o,a,u,c,h,l){var d=g,f=y;h=h||0,i(d,n,c),r.rotate(f,m,h);var p=s(d,f);if(p>0)return 0;if(l)return!0;var v=this.createContactEquation(a,t,u,e);return r.copy(v.normalA,f),r.scale(d,v.normalA,p),i(v.contactPointA,n,d),i(v.contactPointA,v.contactPointA,a.position),i(v.contactPointB,n,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},R.prototype[f.CIRCLE|f.PARTICLE]=R.prototype.circleParticle=function(t,e,n,s,a,u,c,h,l){var d=g;if(i(d,c,n),r.squaredLength(d)>Math.pow(e.radius,2))return 0;if(l)return!0;var f=this.createContactEquation(t,a,e,u);return r.copy(f.normalA,d),r.normalize(f.normalA,f.normalA),r.scale(f.contactPointA,f.normalA,e.radius),o(f.contactPointA,f.contactPointA,n),i(f.contactPointA,f.contactPointA,t.position),i(f.contactPointB,c,a.position),this.contactEquations.push(f),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(f)),1};var Q=new l({radius:1}),Y=r.create(),J=r.create();r.create(),R.prototype[f.PLANE|f.CAPSULE]=R.prototype.planeCapsule=function(t,e,n,i,s,a,u,c,h){var l,d=Y,f=J,p=Q;r.set(d,-a.length/2,0),r.rotate(d,d,c),o(d,d,u),r.set(f,a.length/2,0),r.rotate(f,f,c),o(f,f,u),p.radius=a.radius,this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var m=this.circlePlane(s,p,d,0,t,e,n,i,h),g=this.circlePlane(s,p,f,0,t,e,n,i,h);if(this.enableFrictionReduction&&(this.enableFriction=l),h)return m||g;var y=m+g;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},R.prototype[f.CIRCLE|f.PLANE]=R.prototype.circlePlane=function(t,e,n,a,u,c,h,l,d){var f=t,p=e,b=n,w=u,_=h,E=l;E=E||0;var T=g,x=y,S=v;i(T,b,_),r.rotate(x,m,E);var C=s(x,T);if(C>p.radius)return 0;if(d)return!0;var A=this.createContactEquation(w,f,c,e);return r.copy(A.normalA,x),r.scale(A.contactPointB,A.normalA,-p.radius),o(A.contactPointB,A.contactPointB,b),i(A.contactPointB,A.contactPointB,f.position),r.scale(S,A.normalA,C),i(A.contactPointA,T,S),o(A.contactPointA,A.contactPointA,_),i(A.contactPointA,A.contactPointA,w.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A)),1},R.prototype[f.CONVEX]=R.prototype[f.CONVEX|f.BOX]=R.prototype[f.BOX]=R.prototype.convexConvex=function(t,e,n,a,u,c,h,l,d,f){var p=g,m=y,_=v,S=b,C=w,A=E,I=T,O=x,D=0;if(f="number"==typeof f?f:0,!R.findSeparatingAxis(e,n,a,c,h,l,p))return 0;i(I,h,n),s(p,I)>0&&r.scale(p,p,-1);var k=R.getClosestEdge(e,a,p,!0),P=R.getClosestEdge(c,l,p);if(-1===k||-1===P)return 0;for(var N=0;N<2;N++){var M,L=k,F=P,B=e,U=c,V=n,j=h,q=a,G=l,H=t,z=u;0===N&&(M=L,L=F,F=M,M=B,B=U,U=M,M=V,V=j,j=M,M=q,q=G,G=M,M=H,H=z,z=M);for(var W=F;W<F+2;W++){r.rotate(m,U.vertices[(W+U.vertices.length)%U.vertices.length],G),o(m,m,j);for(var K=0,X=L-1;X<L+2;X++){var Q=B.vertices[(X+1+B.vertices.length)%B.vertices.length];r.rotate(_,B.vertices[(X+B.vertices.length)%B.vertices.length],q),r.rotate(S,Q,q),o(_,_,V),o(S,S,V),i(C,S,_),r.rotate90cw(O,C),r.normalize(O,O),i(I,m,_);var Y=s(O,I);(X===L&&Y<=f||X!==L&&Y<=0)&&K++}if(K>=3){if(d)return!0;var J=this.createContactEquation(H,z,B,U);D++,Q=B.vertices[(L+1)%B.vertices.length],r.rotate(_,B.vertices[L%B.vertices.length],q),r.rotate(S,Q,q),o(_,_,V),o(S,S,V),i(C,S,_),r.rotate90cw(J.normalA,C),r.normalize(J.normalA,J.normalA),i(I,m,_),Y=s(J.normalA,I),r.scale(A,J.normalA,Y),i(J.contactPointA,m,V),i(J.contactPointA,J.contactPointA,A),o(J.contactPointA,J.contactPointA,V),i(J.contactPointA,J.contactPointA,H.position),i(J.contactPointB,m,j),o(J.contactPointB,J.contactPointB,j),i(J.contactPointB,J.contactPointB,z.position),this.contactEquations.push(J),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J))}}}return this.enableFrictionReduction&&this.enableFriction&&D&&this.frictionEquations.push(this.createFrictionFromAverage(D)),D};var $=r.fromValues(0,0);R.projectConvexOntoAxis=function(t,e,n,i,o){var a,u=null,c=null,h=$;r.rotate(h,i,-n);for(var l=0;l<t.vertices.length;l++)a=s(t.vertices[l],h),(null===u||a>u)&&(u=a),(null===c||a<c)&&(c=a);if(c>u){var d=c;c=u,u=d}var f=s(e,i);r.set(o,c+f,u+f)};var Z=r.fromValues(0,0),tt=r.fromValues(0,0),et=r.fromValues(0,0),nt=r.fromValues(0,0),rt=r.fromValues(0,0),it=r.fromValues(0,0);R.findSeparatingAxis=function(t,e,n,o,s,a,u){var c=null,h=!1,l=!1,d=Z,f=tt,m=et,g=nt,y=rt,v=it;if(t instanceof p&&o instanceof p)for(var b=0;2!==b;b++){var w=t,_=n;1===b&&(w=o,_=a);for(var E=0;2!==E;E++){0===E?r.set(g,0,1):1===E&&r.set(g,1,0),0!==_&&r.rotate(g,g,_),R.projectConvexOntoAxis(t,e,n,g,y),R.projectConvexOntoAxis(o,s,a,g,v);var T=y,x=v;y[0]>v[0]&&(x=y,T=v),h=(S=x[0]-T[1])<=0,(null===c||S>c)&&(r.copy(u,g),c=S,l=h)}}else for(b=0;2!==b;b++)for(w=t,_=n,1===b&&(w=o,_=a),E=0;E!==w.vertices.length;E++){var S;r.rotate(f,w.vertices[E],_),r.rotate(m,w.vertices[(E+1)%w.vertices.length],_),i(d,m,f),r.rotate90cw(g,d),r.normalize(g,g),R.projectConvexOntoAxis(t,e,n,g,y),R.projectConvexOntoAxis(o,s,a,g,v),T=y,x=v,y[0]>v[0]&&(x=y,T=v),h=(S=x[0]-T[1])<=0,(null===c||S>c)&&(r.copy(u,g),c=S,l=h)}return l};var ot=r.fromValues(0,0),st=r.fromValues(0,0),at=r.fromValues(0,0);R.getClosestEdge=function(t,e,n,o){var a=ot,u=st,c=at;r.rotate(a,n,-e),o&&r.scale(a,a,-1);for(var h=-1,l=t.vertices.length,d=-1,f=0;f!==l;f++){i(u,t.vertices[(f+1)%l],t.vertices[f%l]),r.rotate90cw(c,u),r.normalize(c,c);var p=s(c,a);(-1===h||p>d)&&(h=f%l,d=p)}return h};var ut=r.create(),ct=r.create(),ht=r.create(),lt=r.create(),dt=r.create(),ft=r.create(),pt=r.create();R.prototype[f.CIRCLE|f.HEIGHTFIELD]=R.prototype.circleHeightfield=function(t,e,n,s,a,u,c,h,l,d){var f=u.heights,p=(d=d||e.radius,u.elementWidth),m=ct,g=ut,y=dt,v=pt,b=ft,w=ht,_=lt,E=Math.floor((n[0]-d-c[0])/p),T=Math.ceil((n[0]+d-c[0])/p);E<0&&(E=0),T>=f.length&&(T=f.length-1);for(var x=f[E],S=f[T],C=E;C<T;C++)f[C]<S&&(S=f[C]),f[C]>x&&(x=f[C]);if(n[1]-d>x)return!l&&0;var A=!1;for(C=E;C<T;C++){r.set(w,C*p,f[C]),r.set(_,(C+1)*p,f[C+1]),r.add(w,w,c),r.add(_,_,c),r.sub(b,_,w),r.rotate(b,b,Math.PI/2),r.normalize(b,b),r.scale(g,b,-d),r.add(g,g,n),r.sub(m,g,w);var I=r.dot(m,b);if(g[0]>=w[0]&&g[0]<_[0]&&I<=0){if(l)return!0;A=!0,r.scale(m,b,-I),r.add(y,g,m),r.copy(v,b);var O=this.createContactEquation(a,t,u,e);r.copy(O.normalA,v),r.scale(O.contactPointB,O.normalA,-d),o(O.contactPointB,O.contactPointB,n),i(O.contactPointB,O.contactPointB,t.position),r.copy(O.contactPointA,y),r.sub(O.contactPointA,O.contactPointA,a.position),this.contactEquations.push(O),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}}if(A=!1,d>0)for(C=E;C<=T;C++)if(r.set(w,C*p,f[C]),r.add(w,w,c),r.sub(m,n,w),r.squaredLength(m)<Math.pow(d,2)){if(l)return!0;A=!0,O=this.createContactEquation(a,t,u,e),r.copy(O.normalA,m),r.normalize(O.normalA,O.normalA),r.scale(O.contactPointB,O.normalA,-d),o(O.contactPointB,O.contactPointB,n),i(O.contactPointB,O.contactPointB,t.position),i(O.contactPointA,w,c),o(O.contactPointA,O.contactPointA,c),i(O.contactPointA,O.contactPointA,a.position),this.contactEquations.push(O),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(O))}return A?1:0};var mt=r.create(),gt=r.create(),yt=r.create(),vt=new d({vertices:[r.create(),r.create(),r.create(),r.create()]});R.prototype[f.BOX|f.HEIGHTFIELD]=R.prototype[f.CONVEX|f.HEIGHTFIELD]=R.prototype.convexHeightfield=function(t,e,n,i,o,s,a,u,c){var h=s.heights,l=s.elementWidth,d=mt,f=gt,p=yt,m=vt,g=Math.floor((t.aabb.lowerBound[0]-a[0])/l),y=Math.ceil((t.aabb.upperBound[0]-a[0])/l);g<0&&(g=0),y>=h.length&&(y=h.length-1);for(var v=h[g],b=h[y],w=g;w<y;w++)h[w]<b&&(b=h[w]),h[w]>v&&(v=h[w]);if(t.aabb.lowerBound[1]>v)return!c&&0;var _=0;for(w=g;w<y;w++)r.set(d,w*l,h[w]),r.set(f,(w+1)*l,h[w+1]),r.add(d,d,a),r.add(f,f,a),r.set(p,.5*(f[0]+d[0]),.5*(f[1]+d[1]-100)),r.sub(m.vertices[0],f,p),r.sub(m.vertices[1],d,p),r.copy(m.vertices[2],m.vertices[1]),r.copy(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=100,m.vertices[3][1]-=100,_+=this.convexConvex(t,e,n,i,o,m,p,0,c);return _}},iZbu:function(t,e,n){var r=n("yqpj"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},jB7R:function(t,e,n){var r=n("JtD1"),i=n("6Pil");function o(t,e,n){i.call(this,t,e,n=n||{}),this.localAnchorA=r.fromValues(0,0),this.localAnchorB=r.fromValues(0,0),n.localAnchorA&&r.copy(this.localAnchorA,n.localAnchorA),n.localAnchorB&&r.copy(this.localAnchorB,n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB);var o=r.create(),s=r.create();this.getWorldAnchorA(o),this.getWorldAnchorB(s);var a=r.distance(o,s);this.restLength="number"==typeof n.restLength?n.restLength:a}n("Wk7T"),t.exports=o,(o.prototype=new i).constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=r.create(),a=r.create(),u=r.create(),c=r.create(),h=r.create(),l=r.create(),d=r.create(),f=r.create(),p=r.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,o=this.bodyB,m=s,g=a,y=u,v=c,b=p,w=h,_=l,E=d,T=f;this.getWorldAnchorA(w),this.getWorldAnchorB(_),r.sub(E,w,i.position),r.sub(T,_,o.position),r.sub(m,_,w);var x=r.len(m);r.normalize(g,m),r.sub(y,o.velocity,i.velocity),r.crossZV(b,o.angularVelocity,T),r.add(y,y,b),r.crossZV(b,i.angularVelocity,E),r.sub(y,y,b),r.scale(v,g,-t*(x-n)-e*r.dot(y,g)),r.sub(i.force,i.force,v),r.add(o.force,o.force,v);var S=r.crossLength(E,v),C=r.crossLength(T,v);i.angularForce-=S,o.angularForce+=C}},k2qa:function(t,e,n){var r=n("hdqJ");t.exports=Array.isArray||function(t){return"Array"==r(t)}},kR7G:function(t,e,n){var r=n("+1EK");function i(t,e,n){n=n||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0,this.ratio="number"==typeof n.ratio?n.ratio:1,this.setRatio(this.ratio)}n("JtD1"),t.exports=i,(i.prototype=new r).constructor=i,i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},i.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},i.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},kpns:function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},l2mZ:function(t,e,n){var r=n("tOqy"),i=(n("wUIi"),n("yBzR"),n("JtD1")),o=n("1vck"),s=n("sbLb"),a=(n("gB0W"),n("MVd/")),u=n("SN9G"),c=n("MKEH"),h=n("i+N5"),l=n("RZpa"),d=(n("rCTz"),n("jB7R"),n("ucEh")),f=n("Fmjy"),p=(n("22PD"),n("0pMi"),n("dOQH"),n("goqo"),n("C78X"),n("bcDB"),n("/bTq"),n("Bixm"),n("BcWo")),m=n("oYfg"),g=n("iFPw"),y=n("Wk7T"),v=n("wVJv"),b=n("5xXB");function w(t){h.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new r,this.narrowphase=new g(this),this.islandManager=new b,this.gravity=i.fromValues(0,-9.78),t.gravity&&i.copy(this.gravity,t.gravity),this.frictionGravity=i.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new m,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=w.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new v}n("gC/R"),t.exports=w,(w.prototype=new Object(h.prototype)).constructor=w,w.NO_SLEEPING=1,w.BODY_SLEEPING=2,w.ISLAND_SLEEPING=4,w.prototype.addConstraint=function(t){this.constraints.push(t)},w.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},w.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&y.splice(this.contactMaterials,e,1)},w.prototype.getContactMaterial=function(t,e){for(var n=this.contactMaterials,r=0,i=n.length;r!==i;r++){var o=n[r];if(o.materialA.id===t.id&&o.materialB.id===e.id||o.materialA.id===e.id&&o.materialB.id===t.id)return o}return!1},w.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&y.splice(this.constraints,e,1)},i.create(),i.create(),i.create(),i.create(),i.create(),i.create();var _=i.create(),E=i.fromValues(0,0),T=i.fromValues(0,0);i.fromValues(0,0),i.fromValues(0,0),w.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var r=0;this.accumulator>=t&&r<n;)this.internalStep(t),this.time+=t,this.accumulator-=t,r++;for(var o=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var a=this.bodies[s];i.lerp(a.interpolatedPosition,a.previousPosition,a.position,o),a.interpolatedAngle=a.previousAngle+o*(a.angle-a.previousAngle)}}};var x=[];w.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,n=this.springs,r=this.bodies,o=this.gravity,s=this.solver,a=this.bodies.length,u=this.broadphase,c=this.narrowphase,h=this.constraints,d=_,f=i.add,p=this.islandManager;if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var m=i.length(this.gravity);0===m&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=m)}if(this.applyGravity)for(var g=0;g!==a;g++){var v=(b=r[g]).force;b.type===l.DYNAMIC&&b.sleepState!==l.SLEEPING&&(i.scale(d,o,b.mass*b.gravityScale),f(v,v,d))}if(this.applySpringForces)for(g=0;g!==e;g++)n[g].applyForce();if(this.applyDamping)for(g=0;g!==a;g++){var b;(b=r[g]).type===l.DYNAMIC&&b.applyDamping(t)}var E=u.getCollisionPairs(this),T=this.disabledBodyCollisionPairs;for(g=T.length-2;g>=0;g-=2)for(var S=E.length-2;S>=0;S-=2)(T[g]===E[S]&&T[g+1]===E[S+1]||T[g+1]===E[S]&&T[g]===E[S+1])&&E.splice(S,2);var C=h.length;for(g=0;g!==C;g++){var A=h[g];if(!A.collideConnected)for(S=E.length-2;S>=0;S-=2)(A.bodyA===E[S]&&A.bodyB===E[S+1]||A.bodyB===E[S]&&A.bodyA===E[S+1])&&E.splice(S,2)}this.postBroadphaseEvent.pairs=E,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,c.reset(this),g=0;for(var I=E.length;g!==I;g+=2)for(var O=E[g],D=E[g+1],k=0,P=O.shapes.length;k!==P;k++)for(var N=O.shapes[k],M=N.position,R=N.angle,L=0,F=D.shapes.length;L!==F;L++){var B=D.shapes[L],U=B.position,V=B.angle,j=this.defaultContactMaterial;if(N.material&&B.material){var q=this.getContactMaterial(N.material,B.material);q&&(j=q)}this.runNarrowphase(c,O,N,M,R,D,B,U,V,j,this.frictionGravity)}for(g=0;g!==a;g++)(W=r[g])._wakeUpAfterNarrowphase&&(W.wakeUp(),W._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(x);var G=this.endContactEvent;for(L=x.length;L--;){var H=x[L];G.shapeA=H.shapeA,G.shapeB=H.shapeB,G.bodyA=H.bodyA,G.bodyB=H.bodyB,this.emit(G)}x.length=0}var z=this.preSolveEvent;for(z.contactEquations=c.contactEquations,z.frictionEquations=c.frictionEquations,this.emit(z),z.contactEquations=z.frictionEquations=null,C=h.length,g=0;g!==C;g++)h[g].update();if(c.contactEquations.length||c.frictionEquations.length||C)if(this.islandSplit){for(p.equations.length=0,y.appendArray(p.equations,c.contactEquations),y.appendArray(p.equations,c.frictionEquations),g=0;g!==C;g++)y.appendArray(p.equations,h[g].equations);for(p.split(this),g=0;g!==p.islands.length;g++)(Q=p.islands[g]).equations.length&&s.solveIsland(t,Q)}else{for(s.addEquations(c.contactEquations),s.addEquations(c.frictionEquations),g=0;g!==C;g++)s.addEquations(h[g].equations);this.solveConstraints&&s.solve(t,this),s.removeAllEquations()}for(g=0;g!==a;g++){var W;(W=r[g]).integrate(t)}for(g=0;g!==a;g++)r[g].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var K=this.impactEvent;for(g=0;g!==c.contactEquations.length;g++){var X=c.contactEquations[g];X.firstImpact&&(K.bodyA=X.bodyA,K.bodyB=X.bodyB,K.shapeA=X.shapeA,K.shapeB=X.shapeB,K.contactEquation=X,this.emit(K))}}if(this.sleepMode===w.BODY_SLEEPING)for(g=0;g!==a;g++)r[g].sleepTick(this.time,!1,t);else if(this.sleepMode===w.ISLAND_SLEEPING&&this.islandSplit){for(g=0;g!==a;g++)r[g].sleepTick(this.time,!0,t);for(g=0;g<this.islandManager.islands.length;g++){var Q;(Q=this.islandManager.islands[g]).wantsToSleep()&&Q.sleep()}}this.stepping=!1;var Y=this.bodiesToBeRemoved;for(g=0;g!==Y.length;g++)this.removeBody(Y[g]);Y.length=0,this.emit(this.postStepEvent)},w.prototype.runNarrowphase=function(t,e,n,r,o,s,a,u,c,h,d){if(0!=(n.collisionGroup&a.collisionMask)&&0!=(a.collisionGroup&n.collisionMask)){i.rotate(E,r,e.angle),i.rotate(T,u,s.angle),i.add(E,E,e.position),i.add(T,T,s.position);var f=o+e.angle,p=c+s.angle;t.enableFriction=h.friction>0,t.frictionCoefficient=h.friction,t.slipForce=h.friction*d*(e.type===l.STATIC||e.type===l.KINEMATIC?s.mass:s.type===l.STATIC||s.type===l.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass)),t.restitution=h.restitution,t.surfaceVelocity=h.surfaceVelocity,t.frictionStiffness=h.frictionStiffness,t.frictionRelaxation=h.frictionRelaxation,t.stiffness=h.stiffness,t.relaxation=h.relaxation,t.contactSkinSize=h.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&n.collisionResponse&&a.collisionResponse;var m=t[n.type|a.type],g=0;if(m){var y=n.sensor||a.sensor,v=t.frictionEquations.length;g=n.type<a.type?m.call(t,e,n,E,f,s,a,T,p,y):m.call(t,s,a,T,p,e,n,E,f,y);var b=t.frictionEquations.length-v;if(g){if(e.allowSleep&&e.type===l.DYNAMIC&&e.sleepState===l.SLEEPING&&s.sleepState===l.AWAKE&&s.type!==l.STATIC&&i.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2)>=2*Math.pow(s.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0),s.allowSleep&&s.type===l.DYNAMIC&&s.sleepState===l.SLEEPING&&e.sleepState===l.AWAKE&&e.type!==l.STATIC&&i.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(s._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(e,n,s,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(n,a)){var w=this.beginContactEvent;if(w.shapeA=n,w.shapeB=a,w.bodyA=e,w.bodyB=s,w.contactEquations.length=0,"number"==typeof g)for(var _=t.contactEquations.length-g;_<t.contactEquations.length;_++)w.contactEquations.push(t.contactEquations[_]);this.emit(w)}if("number"==typeof g&&b>1)for(_=t.frictionEquations.length-b;_<t.frictionEquations.length;_++){var x=t.frictionEquations[_];x.setSlipForce(x.getSlipForce()/b)}}}}},w.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},w.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&y.splice(this.springs,e,1)},w.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},w.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(y.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},w.prototype.getBodyById=function(t){for(var e=this.bodies,n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}return!1},w.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},w.prototype.enableBodyCollision=function(t,e){for(var n=this.disabledBodyCollisionPairs,r=0;r<n.length;r+=2)if(n[r]===t&&n[r+1]===e||n[r+1]===t&&n[r]===e)return void n.splice(r,2)},w.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);var n=this.bodies;for(e=n.length-1;e>=0;e--)this.removeBody(n[e]);var r=this.springs;for(e=r.length-1;e>=0;e--)this.removeSpring(r[e]);var i=this.contactMaterials;for(e=i.length-1;e>=0;e--)this.removeContactMaterial(i[e]);w.apply(this)};var S=i.create(),C=(i.fromValues(0,0),i.fromValues(0,0));w.prototype.hitTest=function(t,e,n){n=n||0;var r=new l({position:t}),h=new c,d=t,f=S,p=C;r.addShape(h);for(var m=this.narrowphase,g=[],y=0,v=e.length;y!==v;y++)for(var b=e[y],w=0,_=b.shapes.length;w!==_;w++){var E=b.shapes[w];i.rotate(f,E.position,b.angle),i.add(f,f,b.position);var T=E.angle+b.angle;(E instanceof o&&m.circleParticle(b,E,f,T,r,h,d,0,!0)||E instanceof s&&m.particleConvex(r,h,d,0,b,E,f,T,!0)||E instanceof a&&m.particlePlane(r,h,d,0,b,E,f,T,!0)||E instanceof u&&m.particleCapsule(r,h,d,0,b,E,f,T,!0)||E instanceof c&&i.squaredLength(i.sub(p,f,t))<n*n)&&g.push(b)}return g},w.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,n=0;n!==e.length;n++)for(var r=e[n],i=0;i!==r.equations.length;i++){var o=r.equations[i];o.stiffness=t,o.needsUpdate=!0}var s=this.contactMaterials;for(n=0;n!==s.length;n++)(r=s[n]).stiffness=r.frictionStiffness=t;(r=this.defaultContactMaterial).stiffness=r.frictionStiffness=t},w.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var n=this.constraints[e],r=0;r!==n.equations.length;r++){var i=n.equations[r];i.relaxation=t,i.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++)(n=this.contactMaterials[e]).relaxation=n.frictionRelaxation=t;(n=this.defaultContactMaterial).relaxation=n.frictionRelaxation=t};var A=new p,I=[];w.prototype.raycast=function(t,e){return e.getAABB(A),this.broadphase.aabbQuery(this,A,I),e.intersectBodies(t,I),I.length=0,t.hasHit()}},"lb/b":function(t,e,n){t.exports=!n("0HDe")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},lcbw:function(t,e,n){"use strict";n.r(e),n("Uv6z"),n("pZxE"),n("9r11"),n("KaSA"),n("z5Af"),n("o/0F"),n("AzFY"),n("y2cN"),n("7xuS")},luCB:function(t,e,n){n("q94Q")("split")},mKQw:function(t,e,n){var r=n("0HDe"),i=/#|\.prototype\./,o=function(t,e){var n=a[s(t)];return n==c||n!=u&&("function"==typeof e?r(e):!!e)},s=o.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=o.data={},u=o.NATIVE="N",c=o.POLYFILL="P";t.exports=o},mk1t:function(t,e,n){t.exports=!n("0HDe")(function(){return!String(Symbol())})},mrSG:function(t,e,n){"use strict";n.r(e),n.d(e,"__extends",function(){return i}),n.d(e,"__assign",function(){return o}),n.d(e,"__rest",function(){return s}),n.d(e,"__decorate",function(){return a}),n.d(e,"__param",function(){return u}),n.d(e,"__metadata",function(){return c}),n.d(e,"__awaiter",function(){return h}),n.d(e,"__generator",function(){return l}),n.d(e,"__exportStar",function(){return d}),n.d(e,"__values",function(){return f}),n.d(e,"__read",function(){return p}),n.d(e,"__spread",function(){return m}),n.d(e,"__await",function(){return g}),n.d(e,"__asyncGenerator",function(){return y}),n.d(e,"__asyncDelegator",function(){return v}),n.d(e,"__asyncValues",function(){return b}),n.d(e,"__makeTemplateObject",function(){return w}),n.d(e,"__importStar",function(){return _}),n.d(e,"__importDefault",function(){return E});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]])}return n}function a(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function u(t,e){return function(n,r){e(n,r,t)}}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function h(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(e){o(e)}}function a(t){try{u(r.throw(t))}catch(e){o(e)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}u((r=r.apply(t,e||[])).next())})}function l(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(a){o=[6,a],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function d(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function f(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function m(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function g(t){return this instanceof g?(this.v=t,this):new g(t)}function y(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise(function(n,r){o.push([t,e,n,r])>1||a(t,e)})})}function a(t,e){try{(n=i[t](e)).value instanceof g?Promise.resolve(n.value.v).then(u,c):h(o[0][2],n)}catch(r){h(o[0][3],r)}var n}function u(t){a("next",t)}function c(t){a("throw",t)}function h(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function v(t){var e,n;return e={},r("next"),r("throw",function(t){throw t}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:g(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=f(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,i){!function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}(r,i,(e=t[n](e)).done,e.value)})}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function _(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function E(t){return t&&t.__esModule?t:{default:t}}},nJQW:function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},nX7E:function(t,e,n){var r=n("ysHE"),i=n("wBs/");t.exports=function(t,e){try{i(r,t,e)}catch(n){r[t]=e}return e}},"nsc/":function(t,e,n){"use strict";var r=n("JKJi"),i=n("9Nts");t.exports="".repeat||function(t){var e=String(i(this)),n="",o=r(t);if(o<0||o==1/0)throw RangeError("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(e+=e))1&o&&(n+=e);return n}},"o/0F":function(t,e,n){t.exports=n("ehBJ")},o9j8:function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},oYfg:function(t,e,n){var r=n("Wk7T"),i=n("Bixm");function o(){i.call(this,i.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var n=t.axisList.indexOf(e.body);-1!==n&&t.axisList.splice(n,1)}}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e|=0;for(var n=1,r=t.length;n<r;n++){for(var i=t[n],o=n-1;o>=0&&!(t[o].aabb.lowerBound[e]<=i.aabb.lowerBound[e]);o--)t[o+1]=t[o];t[o+1]=i}return t},o.prototype.sortList=function(){o.sortAxisList(this.axisList,this.axisIndex)},o.prototype.getCollisionPairs=function(t){var e=this.axisList,n=this.result,r=this.axisIndex;n.length=0;for(var o=e.length;o--;){var s=e[o];s.aabbNeedsUpdate&&s.updateAABB()}this.sortList();for(var a=0,u=0|e.length;a!==u;a++)for(var c=e[a],h=a+1;h<u;h++){var l=e[h];if(!(l.aabb.lowerBound[r]<=c.aabb.upperBound[r]))break;i.canCollide(c,l)&&this.boundingVolumeCheck(c,l)&&n.push(c,l)}return n},o.prototype.aabbQuery=function(t,e,n){n=n||[],this.sortList();for(var r=this.axisList,i=0;i<r.length;i++){var o=r[i];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&n.push(o)}return n}},pSMy:function(t,e,n){var r=n("ysHE"),i=n("pYsU").f,o=n("wBs/"),s=n("1f/i"),a=n("nX7E"),u=n("a+hM"),c=n("mKQw");t.exports=function(t,e){var n,h,l,d,f,p=t.target,m=t.global,g=t.stat;if(n=m?r:g?r[p]||a(p,{}):(r[p]||{}).prototype)for(h in e){if(d=e[h],l=t.noTargetGet?(f=i(n,h))&&f.value:n[h],!c(m?h:p+(g?".":"#")+h,t.forced)&&void 0!==l){if(typeof d==typeof l)continue;u(d,l)}(t.sham||l&&l.sham)&&o(d,"sham",!0),s(n,h,d,t)}}},pYsU:function(t,e,n){var r=n("lb/b"),i=n("iCuu"),o=n("2Hee"),s=n("IutQ"),a=n("ehg7"),u=n("57wU"),c=n("a0i3"),h=Object.getOwnPropertyDescriptor;e.f=r?h:function(t,e){if(t=s(t),e=a(e,!0),c)try{return h(t,e)}catch(n){}if(u(t,e))return o(!i.f.call(t,e),t[e])}},pZxE:function(t,e,n){"use strict";function r(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})}var i=setTimeout;function o(){}function s(t){if(!(this instanceof s))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],d(t,this)}function a(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,s._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(i){return void c(e.promise,i)}u(e.promise,r)}else(1===t._state?u:c)(e.promise,t._value)})):t._deferreds.push(e)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof s)return t._state=3,t._value=e,void h(t);if("function"==typeof n)return void d((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,h(t)}catch(o){c(t,o)}var r,i}function c(t,e){t._state=2,t._value=e,h(t)}function h(t){2===t._state&&0===t._deferreds.length&&s._immediateFn(function(){t._handled||s._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function l(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function d(t,e){var n=!1;try{t(function(t){n||(n=!0,u(e,t))},function(t){n||(n=!0,c(e,t))})}catch(r){if(n)return;n=!0,c(e,r)}}s.prototype.catch=function(t){return this.then(null,t)},s.prototype.then=function(t,e){var n=new this.constructor(o);return a(this,new l(t,e,n)),n},s.prototype.finally=r,s.all=function(t){return new s(function(e,n){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var i=r.length;function o(t,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){o(t,e)},n)}r[t]=s,0==--i&&e(r)}catch(u){n(u)}}for(var s=0;s<r.length;s++)o(s,r[s])})},s.resolve=function(t){return t&&"object"==typeof t&&t.constructor===s?t:new s(function(e){e(t)})},s.reject=function(t){return new s(function(e,n){n(t)})},s.race=function(t){return new s(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},s._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){i(t,0)},s._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in f?f.Promise.prototype.finally||(f.Promise.prototype.finally=r):f.Promise=s},ptKZ:function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},"q/0M":function(t,e,n){"use strict";n.r(e),n.d(e,"LogLevel",function(){return i}),n.d(e,"Logger",function(){return a}),n.d(e,"setLogLevel",function(){return u});var r=[],i=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}({}),o=i.INFO,s=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var o=(new Date).toISOString();switch(e){case i.DEBUG:case i.VERBOSE:console.log.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;case i.INFO:console.info.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;case i.WARN:console.warn.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;case i.ERROR:console.error.apply(console,["["+o+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},a=function(){function t(t){this.name=t,this._logLevel=o,this._logHandler=s,r.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in i))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,i.ERROR].concat(t))},t}();function u(t){r.forEach(function(e){e.logLevel=t})}},q0E7:function(t,e,n){n("q94Q")("iterator")},q94Q:function(t,e,n){var r=n("4Ea8"),i=n("57wU"),o=n("ahhG"),s=n("TIpl").f;t.exports=function(t){var e=r.Symbol||(r.Symbol={});i(e,t)||s(e,t,{value:o.f(t)})}},qBi7:function(t,e,n){var r=n("MfhB")("keys"),i=n("ptKZ");t.exports=function(t){return r[t]||(r[t]=i(t))}},qjh4:function(t,e,n){"use strict";var r=n("lb/b"),i=n("57wU"),o=n("kpns"),s=n("TIpl").f,a=n("a+hM"),u=n("ysHE").Symbol;if(r&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var c={},h=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof h?new u(t):void 0===t?u():u(t);return""===t&&(c[e]=!0),e};a(h,u);var l=h.prototype=u.prototype;l.constructor=h;var d=l.toString,f="Symbol(test)"==String(u("test")),p=/^Symbol\((.*)\)[^)]+$/;s(l,"description",{configurable:!0,get:function(){var t=o(this)?this.valueOf():this,e=d.call(t);if(i(c,t))return"";var n=f?e.slice(7,-1):e.replace(p,"$1");return""===n?void 0:n}}),n("pSMy")({global:!0,forced:!0},{Symbol:h})}},r8II:function(t,e,n){"use strict";e.decode=e.parse=n("YcCt"),e.encode=e.stringify=n("6MUB")},rCTz:function(t,e,n){t.exports=i;var r=n("JtD1");function i(t){t=t||{},this.body=null,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.BOX=32,Object.defineProperty(i,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),i.BOX}}),i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype.computeMomentOfInertia=function(t){},i.prototype.updateBoundingRadius=function(){},i.prototype.updateArea=function(){},i.prototype.computeAABB=function(t,e,n){},i.prototype.raycast=function(t,e,n,r){}},rWzI:function(t,e,n){(function(t){var r;!function(i){"object"==typeof global&&global;var o,s=2147483647,a=36,u=1,c=26,h=38,l=700,d=72,f=128,p="-",m=/^xn--/,g=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,v={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=a-u,w=Math.floor,_=String.fromCharCode;function E(t){throw RangeError(v[t])}function T(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function x(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+T((t=t.replace(y,".")).split("."),e).join(".")}function S(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function C(t){return T(t,function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+_(t)}).join("")}function A(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function I(t,e,n){var r=0;for(t=n?w(t/l):t>>1,t+=w(t/e);t>b*c>>1;r+=a)t=w(t/b);return w(r+(b+1)*t/(t+h))}function O(t){var e,n,r,i,o,h,l,m,g,y,v,b=[],_=t.length,T=0,x=f,S=d;for((n=t.lastIndexOf(p))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&E("not-basic"),b.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<_;){for(o=T,h=1,l=a;i>=_&&E("invalid-input"),((m=(v=t.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:a)>=a||m>w((s-T)/h))&&E("overflow"),T+=m*h,!(m<(g=l<=S?u:l>=S+c?c:l-S));l+=a)h>w(s/(y=a-g))&&E("overflow"),h*=y;S=I(T-o,e=b.length+1,0==o),w(T/e)>s-x&&E("overflow"),x+=w(T/e),T%=e,b.splice(T++,0,x)}return C(b)}function D(t){var e,n,r,i,o,h,l,m,g,y,v,b,T,x,C,O=[];for(b=(t=S(t)).length,e=f,n=0,o=d,h=0;h<b;++h)(v=t[h])<128&&O.push(_(v));for(r=i=O.length,i&&O.push(p);r<b;){for(l=s,h=0;h<b;++h)(v=t[h])>=e&&v<l&&(l=v);for(l-e>w((s-n)/(T=r+1))&&E("overflow"),n+=(l-e)*T,e=l,h=0;h<b;++h)if((v=t[h])<e&&++n>s&&E("overflow"),v==e){for(m=n,g=a;!(m<(y=g<=o?u:g>=o+c?c:g-o));g+=a)O.push(_(A(y+(C=m-y)%(x=a-y),0))),m=w(C/x);O.push(_(A(m,0))),o=I(n,T,r==i),n=0,++r}++n,++e}return O.join("")}o={version:"1.3.2",ucs2:{decode:S,encode:C},decode:O,encode:D,toASCII:function(t){return x(t,function(t){return g.test(t)?"xn--"+D(t):t})},toUnicode:function(t){return x(t,function(t){return m.test(t)?O(t.slice(4).toLowerCase()):t})}},void 0===(r=(function(){return o}).call(e,n,e,t))||(t.exports=r)}()}).call(this,n("YuTi")(t))},rZEa:function(t,e,n){"use strict";var r=n("k2qa"),i=n("kpns"),o=n("SAp2"),s=n("H6ty"),a=n("U4hp"),u=n("rhCS"),c=n("aXXJ")("isConcatSpreadable"),h=!n("0HDe")(function(){var t=[];return t[c]=!1,t.concat()[0]!==t}),l=n("g7Su")("concat"),d=function(t){if(!i(t))return!1;var e=t[c];return void 0!==e?!!e:r(t)},f=!h||!l;n("pSMy")({target:"Array",proto:!0,forced:f},{concat:function(t){var e,n,r,i,c,h=o(this),l=u(h,0),f=0;for(e=-1,r=arguments.length;e<r;e++)if(d(c=-1===e?h:arguments[e])){if(f+(i=s(c.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<i;n++,f++)n in c&&a(l,f,c[n])}else{if(f>=9007199254740991)throw TypeError("Maximum allowed index exceeded");a(l,f++,c)}return l.length=f,l}})},rhCS:function(t,e,n){var r=n("kpns"),i=n("k2qa"),o=n("aXXJ")("species");t.exports=function(t,e){var n;return i(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!i(n.prototype)?r(n)&&null===(n=n[o])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}},rs5h:function(t,e,n){var r=n("ysHE").document;t.exports=r&&r.documentElement},sQJA:function(t,e,n){var r=n("JtD1"),i=(n("Wk7T"),n("0pMi")),o=n("yqpj"),s=n("RZpa");function a(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new s({mass:0}),this.world=null;var n=this;this.preStepCallback=function(){n.update()}}function u(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new o(t.chassisBody,t.groundBody),this.sideEquation=new o(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=r.fromValues(0,1),e.localForwardVector&&r.copy(this.localForwardVector,e.localForwardVector),this.localPosition=r.fromValues(0,0),e.localPosition&&r.copy(this.localPosition,e.localPosition),i.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}t.exports=a,a.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++)t.addConstraint(this.wheels[e])},a.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++)t.removeConstraint(this.wheels[e]);this.world=null},a.prototype.addWheel=function(t){var e=new u(this,t);return this.wheels.push(e),e},a.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(u.prototype=new i).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},u.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=r.create(),h=r.create();u.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(h,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,h),r.dot(c,h)};var l=r.create();u.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),r.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),r.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),r.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),r.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),r.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),r.normalize(l,this.forwardEquation.t),r.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},sbLb:function(t,e,n){var r=n("rCTz"),i=n("JtD1"),o=n("KXN6");function s(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],n=0;n<e.length;n++){var o=i.create();i.copy(o,e[n]),this.vertices.push(o)}if(this.axes=[],t.axes)for(n=0;n<t.axes.length;n++){var s=i.create();i.copy(s,t.axes[n]),this.axes.push(s)}else for(n=0;n<this.vertices.length;n++){var a=this.vertices[n],u=this.vertices[(n+1)%this.vertices.length],c=i.create();i.sub(c,u,a),i.rotate90cw(c,c),i.normalize(c,c),this.axes.push(c)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=r.CONVEX,r.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}n("Dded"),t.exports=s,(s.prototype=new r).constructor=s;var a=i.create(),u=i.create();s.prototype.projectOntoLocalAxis=function(t,e){for(var n,r=null,o=null,s=(t=a,0);s<this.vertices.length;s++)n=i.dot(this.vertices[s],t),(null===r||n>r)&&(r=n),(null===o||n<o)&&(o=n);if(o>r){var u=o;o=r,r=u}i.set(e,o,r)},s.prototype.projectOntoWorldAxis=function(t,e,n,r){var o=u;this.projectOntoLocalAxis(t,r),0!==n?i.rotate(o,t,n):o=t;var s=i.dot(e,o);i.set(r,r[0]+s,r[1]+s)},s.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var n=this.vertices[e];t.push(n[0],n[1])}var r=o.Triangulate(t);for(e=0;e<r.length;e+=3)this.triangles.push([r[e],r[e+1],r[e+2]])};var c=i.create(),h=i.create(),l=i.create(),d=i.create(),f=i.create();i.create(),i.create(),i.create(),i.create(),s.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,n=this.centerOfMass,r=c,o=l,a=d,u=f,p=h;i.set(n,0,0);for(var m=0,g=0;g!==t.length;g++){var y=t[g];i.centroid(r,o=e[y[0]],a=e[y[1]],u=e[y[2]]);var v=s.triangleArea(o,a,u);m+=v,i.scale(p,r,v),i.add(n,n,p)}i.scale(n,n,1/m)},s.prototype.computeMomentOfInertia=function(t){for(var e=0,n=0,r=this.vertices.length,o=r-1,s=0;s<r;o=s,s++){var a=this.vertices[o],u=this.vertices[s],c=Math.abs(i.crossLength(a,u));e+=c*(i.dot(u,u)+i.dot(u,a)+i.dot(a,a)),n+=c}return t/6*(e/n)},s.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,n=0;n!==t.length;n++){var r=i.squaredLength(t[n]);r>e&&(e=r)}this.boundingRadius=Math.sqrt(e)},s.triangleArea=function(t,e,n){return.5*((e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1]))},s.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,n=0;n!==t.length;n++){var r=t[n],i=s.triangleArea(e[r[0]],e[r[1]],e[r[2]]);this.area+=i}},s.prototype.computeAABB=function(t,e,n){t.setFromPoints(this.vertices,e,n,0)};var p=i.create(),m=i.create(),g=i.create();s.prototype.raycast=function(t,e,n,r){var o=p,s=m,a=g,u=this.vertices;i.toLocalFrame(o,e.from,n,r),i.toLocalFrame(s,e.to,n,r);for(var c=u.length,h=0;h<c&&!t.shouldStop(e);h++){var l=u[h],d=u[(h+1)%c],f=i.getLineSegmentsIntersectionFraction(o,s,l,d);f>=0&&(i.sub(a,d,l),i.rotate(a,a,-Math.PI/2+r),i.normalize(a,a),e.reportIntersection(t,f,a,h))}}},spD4:function(t,e,n){var r=n("1VRj"),i=n("K8G7"),o=n("ysHE"),s=n("wBs/"),a=n("aXXJ"),u=a("iterator"),c=a("toStringTag"),h=i.values;for(var l in r){var d=o[l],f=d&&d.prototype;if(f){if(f[u]!==h)try{s(f,u,h)}catch(m){f[u]=h}if(f[c]||s(f,c,l),r[l])for(var p in i)if(f[p]!==i[p])try{s(f,p,i[p])}catch(m){f[p]=i[p]}}}},stQs:function(t,e,n){"use strict";var r=n("pSMy"),i=n("A9d8"),o=n("0idE"),s=n("XCog"),a=n("S4gH"),u=n("wBs/"),c=n("1f/i"),h=n("U5J1"),l=n("aXXJ")("iterator"),d=n("0i0S"),f=n("YxH6"),p=f.IteratorPrototype,m=f.BUGGY_SAFARI_ITERATORS,g=function(){return this};t.exports=function(t,e,n,f,y,v,b){i(n,e,f);var w,_,E,T=function(t){if(t===y&&I)return I;if(!m&&t in C)return C[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},x=e+" Iterator",S=!1,C=t.prototype,A=C[l]||C["@@iterator"]||y&&C[y],I=!m&&A||T(y),O="Array"==e&&C.entries||A;if(O&&(w=o(O.call(new t)),p!==Object.prototype&&w.next&&(h||o(w)===p||(s?s(w,p):"function"!=typeof w[l]&&u(w,l,g)),a(w,x,!0,!0),h&&(d[x]=g))),"values"==y&&A&&"values"!==A.name&&(S=!0,I=function(){return A.call(this)}),h&&!b||C[l]===I||u(C,l,I),d[e]=I,y)if(_={values:T("values"),keys:v?I:T("keys"),entries:T("entries")},b)for(E in _)!m&&!S&&E in C||c(C,E,_[E]);else r({target:e,proto:!0,forced:m||S},_);return _}},t5mC:function(t,e,n){var r=n("0HDe"),i=n("hdqJ"),o="".split;t.exports=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==i(t)?o.call(t,""):Object(t)}:Object},tOqy:function(t,e,n){n("JtD1");var r=n("wUIi"),i=n("Wk7T"),o=n("yqpj");function s(t){r.call(this,t,r.GS),this.iterations=(t=t||{}).iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new i.ARRAY_TYPE(this.arrayStep),this.Bs=new i.ARRAY_TYPE(this.arrayStep),this.invCs=new i.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}t.exports=s,(s.prototype=new r).constructor=s,s.prototype.solve=function(t,e){this.sortEquations();var n=0,r=this.iterations,a=this.frictionIterations,u=this.equations,c=u.length,h=Math.pow(this.tolerance*c,2),l=e.bodies,d=e.bodies.length,f=this.useZeroRHS,p=this.lambda;if(this.usedIterations=0,c)for(var m=0;m!==d;m++)l[m].updateSolveMassProperties();p.length<c&&(p=this.lambda=new i.ARRAY_TYPE(c+this.arrayStep),this.Bs=new i.ARRAY_TYPE(c+this.arrayStep),this.invCs=new i.ARRAY_TYPE(c+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(p);var g,y,v=this.invCs,b=this.Bs;for(p=this.lambda,m=0;m!==u.length;m++){var w;((w=u[m]).timeStep!==t||w.needsUpdate)&&(w.timeStep=t,w.update()),b[m]=w.computeB(w.a,w.b,t),v[m]=w.computeInvC(w.epsilon)}if(0!==c){for(m=0;m!==d;m++)l[m].resetConstraintVelocity();if(a){for(n=0;n!==a;n++){for(g=0,y=0;y!==c;y++){var _=s.iterateEquation(y,w=u[y],w.epsilon,b,v,p,f,t,n);g+=Math.abs(_)}if(this.usedIterations++,g*g<=h)break}for(s.updateMultipliers(u,p,1/t),y=0;y!==c;y++){var E=u[y];if(E instanceof o){for(var T=0,x=0;x!==E.contactEquations.length;x++)T+=E.contactEquations[x].multiplier;E.maxForce=T*=E.frictionCoefficient/E.contactEquations.length,E.minForce=-T}}}for(n=0;n!==r;n++){for(g=0,y=0;y!==c;y++)_=s.iterateEquation(y,w=u[y],w.epsilon,b,v,p,f,t,n),g+=Math.abs(_);if(this.usedIterations++,g*g<=h)break}for(m=0;m!==d;m++)l[m].addConstraintVelocity();s.updateMultipliers(u,p,1/t)}},s.updateMultipliers=function(t,e,n){for(var r=t.length;r--;)t[r].multiplier=e[r]*n},s.iterateEquation=function(t,e,n,r,i,o,s,a,u){var c=r[t],h=i[t],l=o[t],d=e.computeGWlambda(),f=e.maxForce,p=e.minForce;s&&(c=0);var m=h*(c-d-n*l),g=l+m;return g<p*a?m=p*a-l:g>f*a&&(m=f*a-l),o[t]+=m,e.addToWlambda(m),m}},tuBy:function(t,e,n){n("WBJg"),t.exports=n("vLVD")("String","repeat")},tzov:function(t,e,n){var r=n("bcPd"),i=n("JzIs"),o=n("o9j8"),s=n("rs5h"),a=n("JIMt"),u=n("qBi7")("IE_PROTO"),c=function(){},h=function(){var t,e=a("iframe"),n=o.length;for(e.style.display="none",s.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),h=t.F;n--;)delete h.prototype[o[n]];return h()};t.exports=Object.create||function(t,e){var n;return null!==t?(c.prototype=r(t),n=new c,c.prototype=null,n[u]=t):n=h(),void 0===e?n:i(n,e)},n("vcTx")[u]=!0},u62O:function(t,e,n){"use strict";t.exports=function(t,e){for(var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser[(e=e||{}).strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[n.key[o]]=r[o]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,function(t,e,r){e&&(i[n.q.name][e]=r)}),i}},uLJa:function(t,e,n){n("q94Q")("toStringTag")},ucEh:function(t,e){function n(t){this.id=t||n.idCounter++}t.exports=n,n.idCounter=0},uhBA:function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function s(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function a(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||t,o),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],a]:t._events[u].push(a):(t._events[u]=a,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=this._events[i?i+t:t];if(!e)return[];if(e.fn)return[e.fn];for(var n=0,r=e.length,o=new Array(r);n<r;n++)o[n]=e[n].fn;return o},c.prototype.listenerCount=function(t){var e=this._events[i?i+t:t];return e?e.fn?1:e.length:0},c.prototype.emit=function(t,e,n,r,o,s){var a=i?i+t:t;if(!this._events[a])return!1;var u,c,h=this._events[a],l=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,o),!0;case 6:return h.fn.call(h.context,e,n,r,o,s),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];h.fn.apply(h.context,u)}else{var d,f=h.length;for(c=0;c<f;c++)switch(h[c].once&&this.removeListener(t,h[c].fn,void 0,!0),l){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,e);break;case 3:h[c].fn.call(h[c].context,e,n);break;case 4:h[c].fn.call(h[c].context,e,n,r);break;default:if(!u)for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];h[c].fn.apply(h[c].context,u)}}return!0},c.prototype.on=function(t,e,n){return a(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return a(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||r&&!s.once||n&&s.context!==n||u(this,o);else{for(var a=0,c=[],h=s.length;a<h;a++)(s[a].fn!==e||r&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?this._events[e=i?i+t:t]&&u(this,e):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},"uiB+":function(t,e,n){n("q94Q")("isConcatSpreadable")},uzDk:function(t,e,n){n("4mOR"),t.exports=n("vLVD")("Array","findIndex")},vLVD:function(t,e,n){var r=n("ysHE"),i=n("JpPu"),o=Function.call;t.exports=function(t,e,n){return i(o,r[t].prototype[e],n)}},vMUY:function(t,e,n){var r=n("Wk7T");function i(){this.data={},this.keys=[]}t.exports=i,i.prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.prototype.getByKey=function(t){return this.data[t|=0]},i.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},i.prototype.set=function(t,e,n){if(!n)throw new Error("No data!");var r=this.getKey(t,e);return this.data[r]||this.keys.push(r),this.data[r]=n,r},i.prototype.reset=function(){for(var t=this.data,e=this.keys,n=e.length;n--;)delete t[e[n]];e.length=0},i.prototype.copy=function(t){this.reset(),r.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var n=t.keys[e];this.data[n]=t.data[n]}}},vQkR:function(t,e,n){var r=n("JpPu"),i=n("t5mC"),o=n("SAp2"),s=n("H6ty"),a=n("rhCS");t.exports=function(t,e){var n=1==t,u=2==t,c=3==t,h=4==t,l=6==t,d=5==t||l,f=e||a;return function(e,a,p){for(var m,g,y=o(e),v=i(y),b=r(a,p,3),w=s(v.length),_=0,E=n?f(e,w):u?f(e,0):void 0;w>_;_++)if((d||_ in v)&&(g=b(m=v[_],_,y),t))if(n)E[_]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return _;case 2:E.push(m)}else if(h)return!1;return l?-1:c||h?h:E}}},"vb+c":function(t,e,n){n("S4gH")(Math,"Math",!0)},vcTx:function(t,e){t.exports={}},vgT8:function(t,e,n){var r=n("+nTh"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.reset(),this}},"wBs/":function(t,e,n){var r=n("TIpl"),i=n("2Hee");t.exports=n("lb/b")?function(t,e,n){return r.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},wUIi:function(t,e,n){n("Wk7T");var r=n("i+N5");function i(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}t.exports=i,(i.prototype=new r).constructor=i,i.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};i.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),o.bodies.length=0,e.getBodies(o.bodies),o.bodies.length&&this.solve(t,o))},i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.addEquations=function(t){for(var e=0,n=t.length;e!==n;e++){var r=t[e];r.enabled&&this.equations.push(r)}},i.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0},i.GS=1,i.ISLAND=2},wVJv:function(t,e,n){var r=n("vMUY"),i=(n("AeTl"),n("XZ30"));function o(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new i({size:16}),this.tmpDict=new r,this.tmpArray1=[]}n("Wk7T"),t.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,n=t.keys.length;n--;){var r=t.keys[n],i=t.getByKey(r);e.getByKey(r),i&&this.recordPool.release(i)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,n,r){var i=this.overlappingShapesCurrentState;if(!i.get(e.id,r.id)){var o=this.recordPool.get();o.set(t,e,n,r),i.set(e.id,r.id,o)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var n=this.overlappingShapesCurrentState,r=n.keys.length;r--;){var i=n.data[n.keys[r]];if(i.bodyA===t&&i.bodyB===e||i.bodyA===e&&i.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,n){var r=t,i=e;(n=n||[]).length=0;for(var o=i.keys.length;o--;){var s=i.keys[o],a=i.data[s];if(!a)throw new Error("Key "+s+" had no data!");r.data[s]||n.push(a)}return n},o.prototype.isNewOverlap=function(t,e){var n=0|t.id,r=0|e.id,i=this.overlappingShapesCurrentState;return!this.overlappingShapesLastState.get(n,r)&&!!i.get(n,r)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var n=this.tmpDict,r=t.length;r--;)n.set(0|(i=t[r]).bodyA.id,0|i.bodyB.id,i);for(r=n.keys.length;r--;){var i;(i=n.getByKey(n.keys[r]))&&e.push(i.bodyA,i.bodyB)}return n.reset(),e}},wYbb:function(t,e,n){var r=t.exports={AABB:n("BcWo"),AngleLockEquation:n("kR7G"),Body:n("RZpa"),Broadphase:n("Bixm"),Capsule:n("SN9G"),Circle:n("1vck"),Constraint:n("0pMi"),ContactEquation:n("fq9q"),ContactEquationPool:n("2Vfd"),ContactMaterial:n("Fmjy"),Convex:n("sbLb"),DistanceConstraint:n("22PD"),Equation:n("+1EK"),EventEmitter:n("i+N5"),FrictionEquation:n("yqpj"),FrictionEquationPool:n("iZbu"),GearConstraint:n("bcDB"),GSSolver:n("tOqy"),Heightfield:n("Q2Wg"),Line:n("gB0W"),LockConstraint:n("dOQH"),Material:n("ucEh"),Narrowphase:n("iFPw"),NaiveBroadphase:n("wt/p"),Particle:n("MKEH"),Plane:n("MVd/"),Pool:n("SeMp"),RevoluteConstraint:n("goqo"),PrismaticConstraint:n("C78X"),Ray:n("yBzR"),RaycastResult:n("Dp7I"),Box:n("I+AN"),RotationalVelocityEquation:n("B9yW"),SAPBroadphase:n("oYfg"),Shape:n("rCTz"),Solver:n("wUIi"),Spring:n("6Pil"),TopDownVehicle:n("sQJA"),LinearSpring:n("jB7R"),RotationalSpring:n("gC/R"),Utils:n("Wk7T"),World:n("l2mZ"),vec2:n("JtD1"),version:n("/bTq").version};Object.defineProperty(r,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},wj3C:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=n("mrSG"),o=n("zVF4"),s=((r={})["no-app"]="No Firebase App '{$name}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$name}",r["duplicate-app"]="Firebase App named '{$name}' already exists",r["app-deleted"]="Firebase App named '{$name}' already deleted",r["duplicate-service"]="Firebase service named '{$name}' already registered",r["invalid-app-argument"]="firebase.{$name}() takes either no argument or a Firebase App instance.",r),a=new o.ErrorFactory("app","Firebase",s);function u(t,e){throw a.create(t,e)}var c="[DEFAULT]",h=[],l=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=o.deepCopy(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){h.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){h=h.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,s=Object.keys(t.services_[i]);o<s.length;o++)e.push(t.services_[i][s[o]]);return Promise.all(e.map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=c),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==c?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;o.deepExtend(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(h.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),h=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&u("app-deleted",{name:this.name_})},t}();function d(t,e){return Object.prototype.hasOwnProperty.call(t,e)}l.prototype.name&&l.prototype.options||l.prototype.delete||console.log("dc");var f=!1;try{f="[object process]"===Object.prototype.toString.call(global.process)}catch(g){}if(f&&console.warn('\nWarning: This is a browser-targeted Firebase bundle but it appears it is being\nrun in a Node environment.  If running in a Node environment, make sure you\nare using the bundle specified by the "main" field in package.json.\n\nIf you are using Webpack, you can specify "main" as the first item in\n"resolve.mainFields":\nhttps://webpack.js.org/configuration/resolve/#resolvemainfields\n\nIf using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\nto false and "main" to true:\nhttps://github.com/rollup/rollup-plugin-node-resolve\n'),self&&"firebase"in self){console.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var p=self.firebase.SDK_VERSION;p&&p.indexOf("LITE")>=0&&console.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var m=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={}),("object"!=typeof r||null===r)&&(r={name:r});var o=r;void 0===o.name&&(o.name=c);var s=o.name;"string"==typeof s&&s||u("bad-app-name",{name:String(s)}),d(e,s)&&u("duplicate-app",{name:s});var a=new t(n,o,i);return e[s]=a,h(a,"create"),a},app:s,apps:null,Promise,SDK_VERSION:"5.11.0",INTERNAL:{registerService:function(e,c,h,l,d){function f(t){return void 0===t&&(t=s()),"function"!=typeof t[e]&&u("invalid-app-argument",{name:e}),t[e]()}return void 0===d&&(d=!1),n[e]&&u("duplicate-service",{name:e}),n[e]=c,l&&(r[e]=l,a().forEach(function(t){l("create",t)})),void 0!==h&&o.deepExtend(f,h),i[e]=f,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this._getService.bind(this,e);return r.apply(this,d?t:[])},f},removeApp:function(t){h(e[t],"delete"),delete e[t]},factories:n,useAsService:l}};function s(t){return d(e,t=t||c)||u("no-app",{name:t}),e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function h(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var s=l(0,o[i]);if(null===s)return;r[s]&&r[s](e,t)}}function l(t,e){return"serverAuth"===e?null:e}return o.patchProperty(i,"default",i),Object.defineProperty(i,"apps",{get:a}),o.patchProperty(s,"App",t),i}(l);return e.INTERNAL=i.__assign({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){o.deepExtend(e,t)},createSubscribe:o.createSubscribe,ErrorFactory:o.ErrorFactory,deepExtend:o.deepExtend}),e}();e.default=m,e.firebase=m},"wt/p":function(t,e,n){n("1vck"),n("MVd/"),n("rCTz"),n("MKEH");var r=n("Bixm");function i(){r.call(this,r.NAIVE)}n("JtD1"),t.exports=i,(i.prototype=new r).constructor=i,i.prototype.getCollisionPairs=function(t){var e=t.bodies,n=this.result;n.length=0;for(var i=0,o=e.length;i!==o;i++)for(var s=e[i],a=0;a<i;a++){var u=e[a];r.canCollide(s,u)&&this.boundingVolumeCheck(s,u)&&n.push(s,u)}return n},i.prototype.aabbQuery=function(t,e,n){n=n||[];for(var r=t.bodies,i=0;i<r.length;i++){var o=r[i];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&n.push(o)}return n}},x7I3:function(t,e,n){"use strict";n.r(e),n.d(e,"ErrorCode",function(){return ar}),n.d(e,"EventType",function(){return ur}),n.d(e,"WebChannel",function(){return cr}),n.d(e,"XhrIo",function(){return hr}),n.d(e,"createWebChannelTransport",function(){return sr});var r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=o||{},s=i;function a(t){return"string"==typeof t}function u(t){return"number"==typeof t}function c(t,e){t=t.split("."),e=e||s;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function h(){}function l(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function d(t){return"array"==l(t)}function f(t){var e=l(t);return"array"==e||"object"==e&&"number"==typeof t.length}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var m="closure_uid_"+(1e9*Math.random()>>>0),g=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function v(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var _=Date.now||function(){return+new Date};function E(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function T(){this.j=this.j,this.i=this.i}T.prototype.j=!1,T.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[m]||(this[m]=++g))},T.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var x=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(a(t))return a(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},S=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=a(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function C(t){return Array.prototype.concat.apply([],arguments)}function A(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function I(t){return/^[\s\xa0]*$/.test(t)}var O,D=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function k(t,e){return-1!=t.indexOf(e)}function P(t,e){return t<e?-1:t>e?1:0}t:{var N=s.navigator;if(N){var M=N.userAgent;if(M){O=M;break t}}O=""}function R(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function L(t){var e,n={};for(e in t)n[e]=t[e];return n}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function B(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<F.length;o++)n=F[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function U(t){return U[" "](t),t}U[" "]=h;var V,j,q=k(O,"Opera"),G=k(O,"Trident")||k(O,"MSIE"),H=k(O,"Edge"),z=H||G,W=k(O,"Gecko")&&!(k(O.toLowerCase(),"webkit")&&!k(O,"Edge"))&&!(k(O,"Trident")||k(O,"MSIE"))&&!k(O,"Edge"),K=k(O.toLowerCase(),"webkit")&&!k(O,"Edge");function X(){var t=s.document;return t?t.documentMode:void 0}t:{var Q="",Y=(j=O,W?/rv:([^\);]+)(\)|;)/.exec(j):H?/Edge\/([\d\.]+)/.exec(j):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(j):K?/WebKit\/(\S+)/.exec(j):q?/(?:Version)[ \/]?(\S+)/.exec(j):void 0);if(Y&&(Q=Y?Y[1]:""),G){var J=X();if(null!=J&&J>parseFloat(Q)){V=String(J);break t}}V=Q}var $,Z={};function tt(t){return function(t,e){var n=Z;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=D(String(V)).split("."),r=D(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=P(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||P(0==s[2].length,0==a[2].length)||P(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var et=s.document;$=et&&G?X()||("CSS1Compat"==et.compatMode?parseInt(V,10):5):void 0;var nt=!G||9<=Number($),rt=G&&!tt("9"),it=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{s.addEventListener("test",h,e),s.removeEventListener("test",h,e)}catch(n){}return t}();function ot(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function st(t,e){if(ot.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(W){t:{try{U(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=a(t.pointerType)?t.pointerType:at[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ot.prototype.b=function(){this.Ja=!1},E(st,ot);var at={2:"touch",3:"pen",4:"mouse"};st.prototype.b=function(){st.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var ut="closure_listenable_"+(1e6*Math.random()|0),ct=0;function ht(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++ct,this.X=this.Z=!1}function lt(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function dt(t){this.src=t,this.a={},this.b=0}function ft(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=x(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(lt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=pt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new ht(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var mt="closure_lm_"+(1e6*Math.random()|0),gt={};function yt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(d(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=xt(r),e&&e[ut]?e.Ba(n,r,p(i)?!!i.capture:!!i,o):vt(e,n,r,!0,i,o)}(t,e,n,r,i);if(d(e)){for(var o=0;o<e.length;o++)yt(t,e[o],n,r,i);return null}return n=xt(n),t&&t[ut]?t.Aa(e,n,p(r)?!!r.capture:!!r,i):vt(t,e,n,!1,r,i)}function vt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=p(i)?!!i.capture:!!i;if(s&&!nt)return null;var a=Et(t);if(a||(t[mt]=a=new dt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=_t,e=nt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)it||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(wt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function bt(t){if(!u(t)&&t&&!t.X){var e=t.src;if(e&&e[ut])ft(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(wt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Et(e))?(ft(n,t),0==n.b&&(n.src=null,e[mt]=null)):lt(t)}}}function wt(t){return t in gt?gt[t]:gt[t]="on"+t}function _t(t,e){return!!t.X||function(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&bt(t),n.call(r,e)}(t,nt?new st(e,this):e=new st(e||c("window.event"),this))}function Et(t){return(t=t[mt])instanceof dt?t:null}var Tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function xt(t){return"function"==l(t)?t:(t[Tt]||(t[Tt]=function(e){return t.handleEvent(e)}),t[Tt])}function St(){T.call(this),this.c=new dt(this),this.J=this,this.B=null}function Ct(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&ft(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ja}E(St,T),St.prototype[ut]=!0,(r=St.prototype).addEventListener=function(t,e,n,r){yt(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(d(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=p(i)?!!i.capture:!!i,r=xt(r),e&&e[ut]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=pt(s=e.a[n],r,i,o))&&(lt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):e&&(e=Et(e))&&(n=e.a[n.toString()],e=-1,n&&(e=pt(n,r,i,o)),(r=-1<e?n[e]:null)&&bt(r))}(this,t,e,n,r)},r.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(a(t))t=new ot(t,n);else if(t instanceof ot)t.target=t.target||n;else{var i=t;B(t=new ot(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Ct(s,r,!0,t)&&i}if(i=Ct(s=t.a=n,r,!0,t)&&i,i=Ct(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Ct(s=t.a=e[o],r,!1,t)&&i;return i},r.G=function(){if(St.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)lt(n[r]);delete e.a[t],e.b--}}this.B=null},r.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},r.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var At=s.JSON.stringify;function It(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Ot(){this.b=this.a=null}It.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Dt,kt=new It(function(){return new Nt},function(t){t.reset()});function Pt(){var t=Ft,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Nt(){this.next=this.b=this.a=null}function Mt(t){s.setTimeout(function(){throw t},0)}function Rt(t,e){Dt||function(){var t=s.Promise.resolve(void 0);Dt=function(){t.then(Bt)}}(),Lt||(Dt(),Lt=!0),Ft.add(t,e)}Ot.prototype.add=function(t,e){var n=kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Nt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Nt.prototype.reset=function(){this.next=this.b=this.a=null};var Lt=!1,Ft=new Ot;function Bt(){for(var t;t=Pt();){try{t.a.call(t.b)}catch(n){Mt(n)}var e=kt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Lt=!1}function Ut(t,e){St.call(this),this.b=t||1,this.a=e||s,this.f=b(this.gb,this),this.g=_()}function Vt(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function jt(t,e,n){if("function"==l(t))n&&(t=b(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=b(t.handleEvent,t)}return 2147483647<Number(e)?-1:s.setTimeout(t,e||0)}function qt(t,e,n){T.call(this),this.f=null!=n?b(t,n):t,this.c=e,this.b=b(this.ab,this),this.a=[]}function Gt(t){t.U=jt(t.b,t.c),t.f.apply(null,t.a)}function Ht(t){T.call(this),this.b=t,this.a={}}E(Ut,St),(r=Ut.prototype).ba=!1,r.L=null,r.gb=function(){if(this.ba){var t=_()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Vt(this),this.start()))}},r.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=_())},r.G=function(){Ut.N.G.call(this),Vt(this),delete this.a},E(qt,T),(r=qt.prototype).ea=!1,r.U=null,r.Ua=function(t){this.a=arguments,this.U?this.ea=!0:Gt(this)},r.G=function(){qt.N.G.call(this),this.U&&(s.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},r.ab=function(){this.U=null,this.ea&&(this.ea=!1,Gt(this))},E(Ht,T);var zt=[];function Wt(t,e,n,r){d(n)||(n&&(zt[0]=n.toString()),n=zt);for(var i=0;i<n.length;i++){var o=yt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Kt(t){R(t.a,function(t,e){this.a.hasOwnProperty(e)&&bt(t)},t),t.a={}}function Xt(){}Ht.prototype.G=function(){Ht.N.G.call(this),Kt(this)},Ht.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Qt=new St;function Yt(t){ot.call(this,"serverreachability",t)}function Jt(t){Qt.dispatchEvent(new Yt(Qt,t))}function $t(t){ot.call(this,"statevent",t)}function Zt(t){Qt.dispatchEvent(new $t(Qt,t))}function te(t){ot.call(this,"timingevent",t)}function ee(t,e){if("function"!=l(t))throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){t()},e)}E(Yt,ot),E($t,ot),E(te,ot);var ne={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},re={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function ie(){}function oe(){}ie.prototype.a=null;var se,ae={OPEN:"a",ib:"b",Na:"c",rb:"d"};function ue(){ot.call(this,"d")}function ce(){ot.call(this,"c")}function he(){}function le(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Ht(this),this.O=de,this.P=new Ut(t=z?125:void 0),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}E(ue,ot),E(ce,ot),E(he,ie),se=new he;var de=45e3,fe={},pe={};function me(t,e,n){t.F=1,t.f=Ve(Ne(e)),t.l=n,t.H=!0,ye(t,null)}function ge(t,e,n,r){t.F=1,t.f=Ve(Ne(e)),t.l=null,t.H=n,ye(t,r)}function ye(t,e){t.v=_(),we(t),t.D=Ne(t.f),Ue(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new qt(b(t.Ka,t,t.a),t.J)),Wt(t.I,t.a,"readystatechange",t.eb),e=t.h?L(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),Jt(1)}function ve(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=be(t,n);if(i==pe){4==e&&(t.c=4,Zt(14),r=!1);break}if(i==fe){t.c=4,Zt(15),r=!1;break}Se(t,i)}4==e&&0==n.length&&(t.c=1,Zt(16),r=!1),t.b=t.b&&r,r||(xe(t),Te(t))}function be(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?pe:(n=Number(e.substring(n,r)),isNaN(n)?fe:(r+=1)+n>e.length?pe:(e=e.substr(r,n),t.A=r+n,e))}function we(t){t.R=_()+t.O,_e(t,t.O)}function _e(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=ee(b(t.bb,t),e)}function Ee(t){t.i&&(s.clearTimeout(t.i),t.i=null)}function Te(t){t.g.Da()||t.m||t.g.na(t)}function xe(t){Ee(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Vt(t.P),Kt(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Se(t,e){try{t.g.Ga(t,e),Jt(4)}catch(n){}}function Ce(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||a(t))S(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(f(t)||a(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(a(t))return t.split("");if(f(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ae(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ae)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ie(t,e){De(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Oe(t))}function Oe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];De(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)De(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function De(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(r=le.prototype).setTimeout=function(t){this.O=t},r.eb=function(t){t=t.target;var e=this.B;e&&3==Nn(t)?e.Ua():this.Ka(t)},r.Ka=function(t){try{if(t==this.a)t:{var e=Nn(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!z&&!this.a.aa())){this.m||4!=e||7==n||Jt(8==n||0>=r?3:2),Ee(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=Mn(this.a,"X-HTTP-Initial-Response");if(s&&!I(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,Zt(12),xe(this),Te(this);break t}this.s=!0,Se(this,a)}this.H?(ve(this,e,o),z&&this.b&&3==e&&(Wt(this.I,this.P,"tick",this.cb),this.P.start())):Se(this,o),4==e&&xe(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,we(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,Zt(12)):(this.c=0,Zt(13)),xe(this),Te(this)}}}catch(u){}},r.cb=function(){if(this.a){var t=Nn(this.a),e=this.a.aa();this.A<e.length&&(Ee(this),ve(this,t,e),this.b&&4!=t&&we(this))}},r.cancel=function(){this.m=!0,xe(this)},r.bb=function(){this.i=null;var t=_();0<=t-this.R?(2!=this.F&&(Jt(3),Zt(17)),xe(this),this.c=2,Te(this)):_e(this,this.R-t)},(r=Ae.prototype).C=function(){Oe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},r.K=function(){return Oe(this),this.a.concat()},r.get=function(t,e){return De(this.b,t)?this.b[t]:e},r.set=function(t,e){De(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},r.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ke=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Pe(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Pe?(this.h=void 0!==e?e:t.h,Me(this,t.f),this.j=t.j,Re(this,t.b),Le(this,t.i),this.a=t.a,Fe(this,tn(t.c)),this.g=t.g):t&&(n=String(t).match(ke))?(this.h=!!e,Me(this,n[1]||"",!0),this.j=je(n[2]||""),Re(this,n[3]||"",!0),Le(this,n[4]),this.a=je(n[5]||"",!0),Fe(this,n[6]||"",!0),this.g=je(n[7]||"")):(this.h=!!e,this.c=new Qe(null,this.h))}function Ne(t){return new Pe(t)}function Me(t,e,n){t.f=n?je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Re(t,e,n){t.b=n?je(e,!0):e}function Le(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Fe(t,e,n){e instanceof Qe?(t.c=e,function(t,e){e&&!t.f&&(Ye(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Je(this,e),Ze(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=qe(e,Ke)),t.c=new Qe(e,t.h))}function Be(t,e,n){t.c.set(e,n)}function Ue(t,e,n){d(n)||(n=[String(n)]),Ze(t.c,e,n)}function Ve(t){return Be(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^_()).toString(36)),t}function je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qe(t,e,n){return a(t)?(t=encodeURI(t).replace(e,Ge),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ge(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Pe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(qe(e,He,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(qe(e,He,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(qe(n,"/"==n.charAt(0)?We:ze,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",qe(n,Xe)),t.join("")},Pe.prototype.resolve=function(t){var e=Ne(this),n=!!t.f;n?Me(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Re(e,t.b):n=null!=t.i;var r=t.a;if(n)Le(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(k(i,"./")||k(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Fe(e,tn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var He=/[#\/\?@]/g,ze=/[#\?:]/g,We=/[#\?]/g,Ke=/[#\?@]/g,Xe=/#/g;function Qe(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Ye(t){t.a||(t.a=new Ae,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Je(t,e){Ye(t),e=en(t,e),De(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ie(t.a,e))}function $e(t,e){return Ye(t),e=en(t,e),De(t.a.b,e)}function Ze(t,e,n){Je(t,e),0<n.length&&(t.c=null,t.a.set(en(t,e),A(n)),t.b+=n.length)}function tn(t){var e=new Qe;return e.c=t.c,t.a&&(e.a=new Ae(t.a),e.b=t.b),e}function en(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function nn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function rn(t){var e=t.a.F.a;if(null!=e)Zt(4),e?(Zt(10),Wn(t.a,t,!1)):(Zt(11),Wn(t.a,t,!0));else{t.b=new le(t,void 0,void 0),t.b.h=t.h,e=Jn(e=t.a,e.Y()?t.f:null,t.i),Zt(4),Ue(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Be(e,n,r),ge(t.b,e,!1,t.f)}}function on(){this.a=this.b=null}function sn(){this.a=new Ae}function an(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[m]||(t[m]=++g)):e.charAt(0)+t}function un(t,e){this.b=t,this.a=e}function cn(t){this.g=t||hn,t=s.PerformanceNavigationTiming?0<(t=s.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(s.ka&&s.ka.Ea&&s.ka.Ea()&&s.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new sn),this.b=null,this.c=[]}(r=Qe.prototype).add=function(t,e){Ye(this),this.c=null,t=en(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},r.forEach=function(t,e){Ye(this),this.a.forEach(function(n,r){S(n,function(n){t.call(e,n,r,this)},this)},this)},r.K=function(){Ye(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},r.C=function(t){Ye(this);var e=[];if(a(t))$e(this,t)&&(e=C(e,this.a.get(en(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=C(e,t[n])}return e},r.set=function(t,e){return Ye(this),this.c=null,$e(this,t=en(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},r.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},r.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},E(function(){},function(){}),(r=nn.prototype).M=null,r.$=function(t){return this.a.$(t)},r.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},r.Da=function(){return!1},r.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Mn(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Mn(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(i){return(e=this.a).m=this.c,void Qn(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Qn(e,2)}else 1==this.M&&(this.g?Zt(6):"11111"==e?(Zt(5),this.g=!0,(!G||10<=Number($))&&(this.c=200,this.b.cancel(),Zt(11),Wn(this.a,this,!0))):(Zt(7),this.g=!1))},r.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,rn(this)):1==this.M&&(this.g?(Zt(11),Wn(this.a,this,!0)):(Zt(10),Wn(this.a,this,!1)));else{0==this.M?Zt(8):1==this.M&&Zt(9);var t=this.a;t.m=this.c,Qn(t,2)}},r.Y=function(){return this.a.Y()},r.ma=function(){return this.a.ma()},sn.prototype.add=function(t){this.a.set(an(t),t)},sn.prototype.C=function(){return this.a.C()};var hn=10;function ln(t,e){!t.a&&(k(e,"spdy")||k(e,"quic")||k(e,"h2"))&&(t.f=t.g,t.a=new sn,t.b&&(mn(t,t.b),t.b=null))}function dn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function fn(t){return t.b?1:t.a?t.a.a.c:0}function pn(t,e){return t.b?t=t.b==e:t.a?(e=an(e),t=De(t.a.a.b,e)):t=!1,t}function mn(t,e){t.a?t.a.add(e):t.b=e}function gn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=an(e),n=De(t.a.a.b,n)),n&&Ie(t.a.a,an(e)))}function yn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return S(t.a.C(),function(t){e=e.concat(t.j)}),e}return A(t.c)}function vn(){}function bn(){this.a=new vn}function wn(t,e,n){var r=n||"";try{Ce(t,function(t,n){var i=t;p(t)&&(i=At(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function _n(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}cn.prototype.cancel=function(){this.c=yn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(S(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},vn.prototype.stringify=function(t){return s.JSON.stringify(t,void 0)},vn.prototype.parse=function(t){return s.JSON.parse(t,void 0)};var En=s.JSON.parse;function Tn(t){St.call(this),this.headers=new Ae,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=xn,this.D=this.F=!1}E(Tn,St);var xn="",Sn=/^https?$/i,Cn=["POST","PUT"];function An(t){return"content-type"==t.toLowerCase()}function In(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,On(t),kn(t)}function On(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Dn(t){if(t.b&&void 0!==o&&(!t.s[1]||4!=Nn(t)||2!=t.T()))if(t.l&&4==Nn(t))jt(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Nn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var a=String(t.A).match(ke)[1]||null;if(!a&&s.self&&s.self.location){var u=s.self.location.protocol;a=u.substr(0,u.length-1)}i=!Sn.test(a?a.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",On(t))}finally{kn(t)}}}function kn(t,e){if(t.a){Pn(t);var n=t.a,r=t.s[0]?h:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(i){}}}function Pn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(s.clearTimeout(t.m),t.m=null)}function Nn(t){return t.a?t.a.readyState:0}function Mn(t,e){return t.a?t.a.getResponseHeader(e):null}function Rn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return R(n,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(),a(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Be(t,e,n),t}function Ln(t){this.f=[],this.F=new on,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!c("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=c("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=c("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=c("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=c("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new cn(t&&t.concurrentRequestLimit),this.ja=new bn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Fn(t){if(Bn(t),3==t.u){var e=t.P++,n=Ne(t.B);Be(n,"SID",t.H),Be(n,"RID",e),Be(n,"TYPE","terminate"),qn(t,n),(e=new le(t,e,void 0)).F=2,e.f=Ve(Ne(n)),n=!1,s.navigator&&s.navigator.sendBeacon&&(n=s.navigator.sendBeacon(e.f.toString(),"")),!n&&s.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=_(),we(e)}Yn(t)}function Bn(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(s.clearTimeout(t.l),t.l=null),Kn(t),t.b.cancel(),t.h&&(u(t.h)&&s.clearTimeout(t.h),t.h=null)}function Un(t,e){t.f.push(new un(t.Ra++,e)),3==t.u&&Vn(t)}function Vn(t){dn(t.b)||t.h||(t.h=!0,Rt(t.Ia,t),t.A=0)}function jn(t,e){var n;n=e?e.W:t.P++;var r=Ne(t.B);Be(r,"SID",t.H),Be(r,"RID",n),Be(r,"AID",t.O),qn(t,r),t.g&&t.i&&Rn(r,t.g,t.i),n=new le(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Gn(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),mn(t.b,n),me(n,r,e)}function qn(t,e){t.c&&Ce({},function(t,n){Be(e,n,t)})}function Gn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?b(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{wn(h,s,"req"+c+"_")}catch(l){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Hn(t){t.a||t.l||(t.S=1,Rt(t.Ha,t),t.v=0)}function zn(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=ee(b(t.Ha,t),Xn(t,t.v)),t.v++,0))}function Wn(t,e,n){var r=e.l;r&&ln(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Jn(t,null,t.ha),Vn(t)}function Kn(t){null!=t.s&&(s.clearTimeout(t.s),t.s=null)}function Xn(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function Qn(t,e){if(2==e){var n=null;t.c&&(n=null);var r=b(t.fb,t);n||(n=new Pe("//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||Me(n,"https"),Ve(n)),function(t,e){var n=new Xt;if(s.Image){var r=new Image;r.onload=w(_n,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(_n,n,r,"TestLoadImage: error",!1,e),r.onabort=w(_n,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(_n,n,r,"TestLoadImage: timeout",!1,e),s.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Zt(2);t.u=0,t.c&&t.c.ta(e),Yn(t),Bn(t)}function Yn(t){t.u=0,t.m=-1,t.c&&(0==yn(t.b).length&&0==t.f.length||(t.b.c.length=0,A(t.f),t.f.length=0),t.c.sa())}function Jn(t,e,n){var r=function(t){return t instanceof Pe?Ne(t):new Pe(t,void 0)}(n);if(""!=r.b)e&&Re(r,e+"."+r.b),Le(r,r.i);else{var i=s.location;r=function(t,e,n,r){var i=new Pe(null,void 0);return t&&Me(i,t),e&&Re(i,e),n&&Le(i,n),r&&(i.a=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&R(t.V,function(t,e){Be(r,e,t)}),n=t.I,(e=t.j)&&n&&Be(r,e,n),Be(r,"VER",t.wa),qn(t,r),r}function $n(){}function Zn(){if(G&&!(10<=Number($)))throw Error("Environmental error: no available transport.")}function tr(t,e){St.call(this),this.a=new Ln(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!I(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!I(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new rr(this)}function er(t){ue.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function nr(){ce.call(this),this.status=1}function rr(t){this.a=t}(r=Tn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:se),this.a.onreadystatechange=b(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(o){return void In(this,o)}t=n||"";var i=new Ae(this.headers);r&&Ce(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=An,n=t.length,r=a(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:a(t)?t.charAt(e):t[e]}(i.K()),n=s.FormData&&t instanceof s.FormData,!(0<=x(Cn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Pn(this),0<this.o&&((this.D=function(t){return G&&tt(9)&&u(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=b(this.Ca,this)):this.m=jt(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){In(this,o)}},r.Ca=function(){void 0!==o&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},r.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),kn(this))},r.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),kn(this,!0)),Tn.N.G.call(this)},r.Fa=function(){this.j||(this.w||this.l||this.g?Dn(this):this.$a())},r.$a=function(){Dn(this)},r.T=function(){try{return 2<Nn(this)?this.a.status:-1}catch(j){return-1}},r.za=function(){try{return 2<Nn(this)?this.a.statusText:""}catch(j){return""}},r.aa=function(){try{return this.a?this.a.responseText:""}catch(j){return""}},r.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),En(e)}},r.ya=function(){return this.h},r.Ya=function(){return a(this.f)?this.f:String(this.f)},(r=Ln.prototype).wa=8,r.u=1,r.Da=function(){return 0==this.u},r.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new le(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?B(r=L(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&a(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Gn(this,n,e),Be(i=Ne(this.B),"RID",t),Be(i,"CVER",22),this.o&&this.j&&Be(i,"X-HTTP-Session-Id",this.j),qn(this,i),this.g&&r&&Rn(i,this.g,r),mn(this.b,n),this.W?(Be(i,"$req",e),Be(i,"SID","null"),n.S=!0,me(n,i,null)):me(n,i,e),this.u=2}}else 3==this.u&&(t?jn(this,t):0==this.f.length||dn(this.b)||jn(this))},r.Ha=function(){this.l=null,this.a=new le(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ne(this.pa);Be(t,"RID","rpc"),Be(t,"SID",this.H),Be(t,"CI",this.ia?"0":"1"),Be(t,"AID",this.O),qn(this,t),Be(t,"TYPE","xmlhttp"),this.g&&this.i&&Rn(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),ge(this.a,t,!0,this.ga)},r.Ga=function(t,e){if(0!=this.u&&(this.a==t||pn(this.b,t)))if(this.m=t.o,!t.s&&pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(o){n=null}if(d(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Kn(this),this.a.cancel(),this.a=null}zn(this),Zt(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=ee(b(this.Za,this),6e3));if(1>=fn(this.b)&&this.fa){try{this.fa()}catch(o){}this.fa=void 0}}else Qn(this,11)}else if((t.s||this.a==t)&&Kn(this),!I(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&u(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Mn(r,"X-Client-Wire-Protocol"))&&ln(this.b,i),this.j&&(r=Mn(r,"X-HTTP-Session-Id")))&&(this.I=r,Be(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Jn(this,this.Y()?this.ga:null,this.ha),r.s?(gn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ee(r),we(r)),this.a=r):Hn(this),0<this.f.length&&Vn(this)}else"stop"!=r[0]&&"close"!=r[0]||Qn(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Qn(this,7):Fn(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},r.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,zn(this),Zt(19))},r.na=function(t){var e=null;if(this.a==t){Kn(this),this.a=null;var n=2}else{if(!pn(this.b,t))return;e=t.j,gn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=_()-t.v,Qt.dispatchEvent(new te(Qt,t.l?t.l.length:0,e,this.A)),Vn(this)):Hn(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(fn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=ee(b(t.Ia,t,e),Xn(t,t.A)),t.A++,0)))}(this,t)||2==n&&zn(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Qn(this,5);break;case 4:Qn(this,10);break;case 3:Qn(this,6);break;default:Qn(this,2)}}},r.fb=function(t){Zt(t?2:1)},r.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Tn(this.La)).F=this.R,t},r.ma=function(){return!!this.c&&!0},r.Y=function(){return this.R},(r=$n.prototype).va=function(){},r.ua=function(){},r.ta=function(){},r.sa=function(){},r.Ta=function(){},Zn.prototype.a=function(t,e){return new tr(t,e)},E(tr,St),(r=tr.prototype).addEventListener=function(t,e,n,r){tr.N.addEventListener.call(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){tr.N.removeEventListener.call(this,t,e,n,r)},r.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;Zt(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new nn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Rn(e,t.g,t.i)),(t=t.w).i=n,e=Jn(t.a,null,t.i),Zt(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,rn(t)):(Ue(e,"MODE","init"),!t.a.o&&t.a.j&&Ue(e,"X-HTTP-Session-Id",t.a.j),t.b=new le(t,void 0,void 0),t.b.h=t.h,ge(t.b,e,!1,null),t.M=0)},r.close=function(){Fn(this.a)},r.Xa=function(t){if(a(t)){var e={};e.__data__=t,Un(this.a,e)}else this.h?((e={}).__data__=At(t),Un(this.a,e)):Un(this.a,t)},r.G=function(){this.a.c=null,delete this.f,Fn(this.a),delete this.a,tr.N.G.call(this)},E(er,ue),E(nr,ce),E(rr,$n),rr.prototype.va=function(){this.a.dispatchEvent("a")},rr.prototype.ua=function(t){this.a.dispatchEvent(new er(t))},rr.prototype.ta=function(t){this.a.dispatchEvent(new nr(t))},rr.prototype.sa=function(){this.a.dispatchEvent("b")};var ir=w(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},Zn);Zn.prototype.createWebChannel=Zn.prototype.a,tr.prototype.send=tr.prototype.Xa,tr.prototype.open=tr.prototype.Wa,tr.prototype.close=tr.prototype.close,ne.NO_ERROR=0,ne.TIMEOUT=8,ne.HTTP_ERROR=6,re.COMPLETE="complete",oe.EventType=ae,ae.OPEN="a",ae.CLOSE="b",ae.ERROR="c",ae.MESSAGE="d",St.prototype.listen=St.prototype.Aa,Tn.prototype.listenOnce=Tn.prototype.Ba,Tn.prototype.getLastError=Tn.prototype.Ya,Tn.prototype.getLastErrorCode=Tn.prototype.ya,Tn.prototype.getStatus=Tn.prototype.T,Tn.prototype.getStatusText=Tn.prototype.za,Tn.prototype.getResponseJson=Tn.prototype.Va,Tn.prototype.getResponseText=Tn.prototype.aa,Tn.prototype.send=Tn.prototype.ca;var or={createWebChannelTransport:ir,ErrorCode:ne,EventType:re,WebChannel:oe,XhrIo:Tn},sr=or.createWebChannelTransport,ar=or.ErrorCode,ur=or.EventType,cr=or.WebChannel,hr=or.XhrIo;e.default=or},xk4V:function(t,e,n){var r=n("4fRq"),i=n("I2ZF");t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var s=(t=t||{}).random||(t.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e)for(var a=0;a<16;++a)e[o+a]=s[a];return e||i(s)}},y2cN:function(t,e,n){t.exports=n("HefZ"),n("9UdO"),n("FoKB"),n("QURa")},yBzR:function(t,e,n){t.exports=i;var r=n("JtD1");function i(t){this.from=(t=t||{}).from?r.fromValues(t.from[0],t.from[1]):r.create(),this.to=t.to?r.fromValues(t.to[0],t.to[1]):r.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:i.ANY,this.callback=t.callback||function(t){},this.direction=r.create(),this.length=1,this.update()}n("Dp7I"),n("rCTz"),n("BcWo"),i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4,i.prototype.update=function(){var t=this.direction;r.sub(t,this.to,this.from),this.length=r.length(t),r.normalize(t,t)},i.prototype.intersectBodies=function(t,e){for(var n=0,r=e.length;!t.shouldStop(this)&&n<r;n++){var i=e[n],o=i.getAABB();(o.overlapsRay(this)>=0||o.containsPoint(this.from))&&this.intersectBody(t,i)}};var o=r.create();i.prototype.intersectBody=function(t,e){var n=this.checkCollisionResponse;if(!n||e.collisionResponse)for(var i=o,s=0,a=e.shapes.length;s<a;s++){var u=e.shapes[s];if((!n||u.collisionResponse)&&0!=(this.collisionGroup&u.collisionMask)&&0!=(u.collisionGroup&this.collisionMask)&&(r.rotate(i,u.position,e.angle),r.add(i,i,e.position),this.intersectShape(t,u,u.angle+e.angle,i,e),t.shouldStop(this)))break}},i.prototype.intersectShape=function(t,e,n,i,o){(function(t,e,n){r.sub(s,n,t);var i=r.dot(s,e);return r.scale(a,e,i),r.add(a,a,t),r.squaredDistance(n,a)})(this.from,this.direction,i)>e.boundingRadius*e.boundingRadius||(this._currentBody=o,this._currentShape=e,e.raycast(t,this,i,n),this._currentBody=this._currentShape=null)},i.prototype.getAABB=function(t){var e=this.to,n=this.from;r.set(t.lowerBound,Math.min(e[0],n[0]),Math.min(e[1],n[1])),r.set(t.upperBound,Math.max(e[0],n[0]),Math.max(e[1],n[1]))},r.create(),i.prototype.reportIntersection=function(t,e,n,o){var s=this._currentShape,a=this._currentBody;if(!(this.skipBackfaces&&r.dot(n,this.direction)>0))switch(this.mode){case i.ALL:t.set(n,s,a,e,o),this.callback(t);break;case i.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(n,s,a,e,o);break;case i.ANY:t.set(n,s,a,e,o)}};var s=r.create(),a=r.create()},yC6l:function(t,e,n){n("Ksdp"),t.exports=n("4Ea8").Object.assign},ySdl:function(t,e,n){var r=n("3Gxb"),i=n("fw2a"),o=n("bcPd"),s=n("ysHE").Reflect;t.exports=s&&s.ownKeys||function(t){var e=r.f(o(t)),n=i.f;return n?e.concat(n(t)):e}},yqpj:function(t,e,n){var r=n("JtD1"),i=n("+1EK");function o(t,e,n){i.call(this,t,e,-n,n),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}n("Wk7T"),t.exports=o,(o.prototype=new i).constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,n){var i=this.contactPointA,o=this.contactPointB,s=this.t,a=this.G;return a[0]=-s[0],a[1]=-s[1],a[2]=-r.crossLength(i,s),a[3]=s[0],a[4]=s[1],a[5]=r.crossLength(o,s),-this.computeGW()*e-n*this.computeGiMf()}},ysHE:function(t,e){t.exports="object"==typeof window&&window&&window.Math==Math?window:"object"==typeof self&&self&&self.Math==Math?self:Function("return this")()},z5Af:function(t,e,n){t.exports=n("yC6l")},z5ME:function(t,e,n){var r=n("aXXJ")("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[r]=!1,"/./"[t](e)}catch(i){}}return!1}},zUnb:function(t,e,n){"use strict";function r(t){return"function"==typeof t}n.r(e);let i=!1;const o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){i=t},get useDeprecatedSynchronousErrorHandling(){return i}};function s(t){setTimeout(()=>{throw t},0)}const a={closed:!0,next(t){},error(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;s(t)},complete(){}},u=Array.isArray||(t=>t&&"number"==typeof t.length);function c(t){return null!==t&&"object"==typeof t}function h(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}h.prototype=Object.create(Error.prototype);const l=h;let d=(()=>{class t{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_unsubscribe:i,_subscriptions:o}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(let t=0;t<n.length;++t)n[t].remove(this);if(r(i))try{i.call(this)}catch(s){e=s instanceof l?f(s.errors):[s]}if(u(o)){let t=-1,n=o.length;for(;++t<n;){const n=o[t];if(c(n))try{n.unsubscribe()}catch(s){e=e||[],s instanceof l?e=e.concat(f(s.errors)):e.push(s)}}}if(e)throw new l(e)}add(e){let n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){const e=n;(n=new t)._subscriptions=[e]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof t){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}remove(t){const e=this._subscriptions;if(e){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}return t.EMPTY=function(t){return t.closed=!0,t}(new t),t})();function f(t){return t.reduce((t,e)=>t.concat(e instanceof l?e.errors:e),[])}const p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class m extends d{constructor(t,e,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=a;break;case 1:if(!t){this.destination=a;break}if("object"==typeof t){t instanceof m?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new g(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new g(this,t,e,n)}}[p](){return this}static create(t,e,n){const r=new m(t,e,n);return r.syncErrorThrowable=!1,r}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class g extends m{constructor(t,e,n,i){let o;super(),this._parentSubscriber=t;let s=this;r(e)?o=e:e&&(o=e.next,n=e.error,i=e.complete,e!==a&&(r((s=Object.create(e)).unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=o,this._error=n,this._complete=i}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:n}=o;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):s(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;s(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);o.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw n;s(n)}}__tryOrSetError(t,e,n){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(s(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}const y="function"==typeof Symbol&&Symbol.observable||"@@observable";let v=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const n=new t;return n.source=this,n.operator=e,n}subscribe(t,e,n){const{operator:r}=this,i=function(t,e,n){if(t){if(t instanceof m)return t;if(t[p])return t[p]()}return t||e||n?new m(t,e,n):new m(a)}(t,e,n);if(i.add(r?r.call(i,this.source):this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}_trySubscribe(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:n,isStopped:r}=t;if(e||r)return!1;t=n&&n instanceof m?n:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=b(e))((e,n)=>{let r;r=this.subscribe(e=>{try{t(e)}catch(i){n(i),r&&r.unsubscribe()}},n,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[y](){return this}pipe(...t){return 0===t.length?this:((e=t)?1===e.length?e[0]:function(t){return e.reduce((t,e)=>e(t),t)}:function(){})(this);var e}toPromise(t){return new(t=b(t))((t,e)=>{let n;this.subscribe(t=>n=t,t=>e(t),()=>t(n))})}}return t.create=e=>new t(e),t})();function b(t){if(t||(t=o.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function w(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}w.prototype=Object.create(Error.prototype);const _=w;class E extends d{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}class T extends m{constructor(t){super(t),this.destination=t}}let x=(()=>{class t extends v{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[p](){return new T(this)}lift(t){const e=new S(this,this);return e.operator=t,e}next(t){if(this.closed)throw new _;if(!this.isStopped){const{observers:e}=this,n=e.length,r=e.slice();for(let i=0;i<n;i++)r[i].next(t)}}error(t){if(this.closed)throw new _;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,n=e.length,r=e.slice();for(let i=0;i<n;i++)r[i].error(t);this.observers.length=0}complete(){if(this.closed)throw new _;this.isStopped=!0;const{observers:t}=this,e=t.length,n=t.slice();for(let r=0;r<e;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new _;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new _;return this.hasError?(t.error(this.thrownError),d.EMPTY):this.isStopped?(t.complete(),d.EMPTY):(this.observers.push(t),new E(this,t))}asObservable(){const t=new v;return t.source=this,t}}return t.create=(t,e)=>new S(t,e),t})();class S extends x{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):d.EMPTY}}function C(t){return t&&"function"==typeof t.schedule}class A extends m{constructor(t,e,n){super(),this.parent=t,this.outerValue=e,this.outerIndex=n,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}const I=t=>e=>{for(let n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()};function O(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}const D=O(),k=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function P(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const N=t=>{if(t&&"function"==typeof t[y])return(t=>e=>{const n=t[y]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(k(t))return I(t);if(P(t))return(t=>e=>(t.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,s),e))(t);if(t&&"function"==typeof t[D])return(t=>e=>{const n=t[D]();for(;;){const t=n.next();if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const e=c(t)?"an invalid object":`'${t}'`;throw new TypeError(`You provided ${e} where a stream was expected.`+" You can provide an Observable, Promise, Array, or Iterable.")}};function M(t,e,n,r,i=new A(t,n,r)){if(!i.closed)return e instanceof v?e.subscribe(i):N(e)(i)}class R extends m{notifyNext(t,e,n,r,i){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}function L(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new F(t,e))}}class F{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new B(t,this.project,this.thisArg))}}class B extends m{constructor(t,e,n){super(t),this.project=e,this.count=0,this.thisArg=n||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}function U(t,e){return new v(n=>{const r=new d;let i=0;return r.add(e.schedule(function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function V(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[y]}(t))return function(t,e){return new v(n=>{const r=new d;return r.add(e.schedule(()=>{const i=t[y]();r.add(i.subscribe({next(t){r.add(e.schedule(()=>n.next(t)))},error(t){r.add(e.schedule(()=>n.error(t)))},complete(){r.add(e.schedule(()=>n.complete()))}}))})),r})}(t,e);if(P(t))return function(t,e){return new v(n=>{const r=new d;return r.add(e.schedule(()=>t.then(t=>{r.add(e.schedule(()=>{n.next(t),r.add(e.schedule(()=>n.complete()))}))},t=>{r.add(e.schedule(()=>n.error(t)))}))),r})}(t,e);if(k(t))return U(t,e);if(function(t){return t&&"function"==typeof t[D]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new v(n=>{const r=new d;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(e.schedule(()=>{i=t[D](),r.add(e.schedule(function(){if(n.closed)return;let t,e;try{const o=i.next();t=o.value,e=o.done}catch(r){return void n.error(r)}e?n.complete():(n.next(t),this.schedule())}))})),r})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof v?t:new v(N(t))}function j(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(j((n,r)=>V(t(n,r)).pipe(L((t,i)=>e(n,t,r,i))),n)):("number"==typeof e&&(n=e),e=>e.lift(new q(t,n)))}class q{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new G(t,this.project,this.concurrent))}}class G extends R{constructor(t,e,n=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,n)}_innerSub(t,e,n){const r=new A(this,void 0,void 0);this.destination.add(r),M(this,t,e,n,r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t,e,n,r,i){this.destination.next(e)}notifyComplete(t){const e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function H(t){return t}function z(t,e){return e?U(t,e):new v(I(t))}function W(){return function(t){return t.lift(new K(t))}}class K{constructor(t){this.connectable=t}call(t,e){const{connectable:n}=this;n._refCount++;const r=new X(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class X extends m{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:n}=this,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}const Q=class extends v{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new d).add(this.source.subscribe(new J(this.getSubject(),this))),t.closed&&(this._connection=null,t=d.EMPTY)),t}refCount(){return W()(this)}}.prototype,Y={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:Q._subscribe},_isComplete:{value:Q._isComplete,writable:!0},getSubject:{value:Q.getSubject},connect:{value:Q.connect},refCount:{value:Q.refCount}};class J extends T{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}function $(){return new x}const Z="__parameters__";function tt(t,e,n){const r=function(t){return function(...e){if(t){const n=t(...e);for(const t in n)this[t]=n[t]}}}(e);function i(...t){if(this instanceof i)return r.apply(this,t),this;const e=new i(...t);return n.annotation=e,n;function n(t,n,r){const i=t.hasOwnProperty(Z)?t[Z]:Object.defineProperty(t,Z,{value:[]})[Z];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(e),t}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}const et=tt("Inject",t=>({token:t})),nt=tt("Optional"),rt=tt("Self"),it=tt("SkipSelf");var ot=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});function st(t){for(let e in t)if(t[e]===st)return e;throw Error("Could not find renamed property on target object.")}function at(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function ut(t){const e=t[ct];return e&&e.token===t?e:null}const ct=st({ngInjectableDef:st});function ht(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(ht).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}const lt=st({__forward_ref__:st});function dt(t){return t.__forward_ref__=dt,t.toString=function(){return ht(this())},t}function ft(t){const e=t;return"function"==typeof e&&e.hasOwnProperty(lt)&&e.__forward_ref__===dt?e():t}const pt="undefined"!=typeof globalThis&&globalThis,mt="undefined"!=typeof window&&window,gt="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,yt="undefined"!=typeof global&&global,vt=pt||yt||mt||gt;class bt{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.ngInjectableDef=at({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const wt=new bt("INJECTOR",-1),_t=new Object,Et="ngTempTokenPath",Tt="ngTokenPath",xt=/\n/gm,St="\u0275",Ct="__source",At=st({provide:String,useValue:st});let It,Ot=void 0;function Dt(t){const e=Ot;return Ot=t,e}class kt{get(t,e=_t){if(e===_t){const e=new Error(`NullInjectorError: No provider for ${ht(t)}!`);throw e.name="NullInjectorError",e}return e}}function Pt(t,e,n,r=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==St?t.substr(2):t;let i=ht(e);if(e instanceof Array)i=e.map(ht).join(" -> ");else if("object"==typeof e){let t=[];for(let n in e)if(e.hasOwnProperty(n)){let r=e[n];t.push(n+":"+("string"==typeof r?JSON.stringify(r):ht(r)))}i=`{${t.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${t.replace(xt,"\n  ")}`}const Nt=new bt("The presence of this token marks an injector as being the root injector."),Mt=function(t,e,n){return new jt(t,e,n)};let Rt=(()=>{class t{static create(t,e){return Array.isArray(t)?Mt(t,e,""):Mt(t.providers,t.parent,t.name||"")}}return t.THROW_IF_NOT_FOUND=_t,t.NULL=new kt,t.ngInjectableDef=at({token:t,providedIn:"any",factory:()=>(function(t,e=ot.Default){return(It||function(t,e=ot.Default){if(void 0===Ot)throw new Error("inject() must be called from an injection context");return null===Ot?function(t,e,n){const r=ut(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&ot.Optional)return null;throw new Error(`Injector: NOT_FOUND [${ht(t)}]`)}(t,0,e):Ot.get(t,e&ot.Optional?null:void 0,e)})(t,e)})(wt)}),t.__NG_ELEMENT_ID__=-1,t})();const Lt=function(t){return t},Ft=[],Bt=Lt,Ut=function(){return Array.prototype.slice.call(arguments)},Vt="\u0275";class jt{constructor(t,e=Rt.NULL,n=null){this.parent=e,this.source=n;const r=this._records=new Map;r.set(Rt,{token:Rt,fn:Lt,deps:Ft,value:this,useNew:!1}),r.set(wt,{token:wt,fn:Lt,deps:Ft,value:this,useNew:!1}),function t(e,n){if(n)if((n=ft(n))instanceof Array)for(let r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw Gt("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw Gt("Unexpected provider",n);{let t=ft(n.provide);const r=function(t){const e=function(t){let e=Ft;const n=t.deps;if(n&&n.length){e=[];for(let t=0;t<n.length;t++){let r=6,i=ft(n[t]);if(i instanceof Array)for(let t=0,e=i;t<e.length;t++){const n=e[t];n instanceof nt||n==nt?r|=1:n instanceof it||n==it?r&=-3:n instanceof rt||n==rt?r&=-5:i=n instanceof et?n.token:ft(n)}e.push({token:i,options:r})}}else if(t.useExisting)e=[{token:ft(t.useExisting),options:6}];else if(!(n||At in t))throw Gt("'deps' required",t);return e}(t);let n=Lt,r=Ft,i=!1,o=ft(t.provide);if(At in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)i=!0,n=ft(t.useClass);else{if("function"!=typeof o)throw Gt("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);i=!0,n=o}return{deps:e,fn:n,useNew:i,value:r}}(n);if(!0===n.multi){let r=e.get(t);if(r){if(r.fn!==Ut)throw qt(t)}else e.set(t,r={token:n.provide,deps:[],useNew:!1,fn:Ut,value:Ft});r.deps.push({token:t=n,options:6})}const i=e.get(t);if(i&&i.fn==Ut)throw qt(t);e.set(t,r)}}}(r,t)}get(t,e,n=ot.Default){const r=this._records.get(t);try{return function t(e,n,r,i,o,s){try{return function(e,n,r,i,o,s){let a;if(!n||s&ot.SkipSelf)s&ot.Self||(a=i.get(e,o,ot.Default));else{if((a=n.value)==Bt)throw Error(Vt+"Circular dependency");if(a===Ft){n.value=Bt;let e=void 0,o=n.useNew,s=n.fn,u=n.deps,c=Ft;if(u.length){c=[];for(let e=0;e<u.length;e++){const n=u[e],o=n.options,s=2&o?r.get(n.token):void 0;c.push(t(n.token,s,r,s||4&o?i:Rt.NULL,1&o?null:Rt.THROW_IF_NOT_FOUND,ot.Default))}}n.value=a=o?new s(...c):s.apply(e,c)}}return a}(e,n,r,i,o,s)}catch(a){throw a instanceof Error||(a=new Error(a)),(a[Et]=a[Et]||[]).unshift(e),n&&n.value==Bt&&(n.value=Ft),a}}(t,r,this._records,this.parent,e,n)}catch(i){return function(t,e,n,r){const i=t[Et];throw e[Ct]&&i.unshift(e[Ct]),t.message=Pt("\n"+t.message,i,"StaticInjectorError",r),t[Tt]=i,t[Et]=null,t}(i,t,0,this.source)}}toString(){const t=[];return this._records.forEach((e,n)=>t.push(ht(n))),`StaticInjector[${t.join(", ")}]`}}function qt(t){return Gt("Cannot mix multi providers and regular providers",t)}function Gt(t,e){return new Error(Pt(t,e,"StaticInjectorError"))}const Ht="ngDebugContext",zt="ngOriginalError",Wt="ngErrorLogger",Kt=function(){var t={Emulated:0,Native:1,None:2,ShadowDom:3};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t[t.ShadowDom]="ShadowDom",t}(),Xt=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(vt))();let Qt=!0,Yt=!1;function Jt(){return Yt=!0,Qt}class $t{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t),this.inertBodyElement=this.inertDocument.createElement("body"),t.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}getInertBodyElement_XHR(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(r){return null}const e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);const n=e.response.body;return n.removeChild(n.firstChild),n}getInertBodyElement_DOMParser(t){t="<body><remove></remove>"+t+"</body>";try{const n=(new window.DOMParser).parseFromString(t,"text/html").body;return n.removeChild(n.firstChild),n}catch(e){return null}}getInertBodyElement_InertDocument(t){const e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const n=e.item(r).name;"xmlns:ns1"!==n&&0!==n.indexOf("ns1:")||t.removeAttribute(n)}let n=t.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Zt=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:\/?#]*(?:[\/?#]|$))/gi,te=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function ee(t){return(t=String(t)).match(Zt)||t.match(te)?t:(Jt()&&console.warn(`WARNING: sanitizing unsafe URL value ${t} (see http://g.co/ng/security#xss)`),"unsafe:"+t)}function ne(t){const e={};for(const n of t.split(","))e[n]=!0;return e}function re(...t){const e={};for(const n of t)for(const t in n)n.hasOwnProperty(t)&&(e[t]=!0);return e}const ie=ne("area,br,col,hr,img,wbr"),oe=ne("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),se=ne("rp,rt"),ae=re(se,oe),ue=re(ie,re(oe,ne("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),re(se,ne("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ae),ce=ne("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),he=ne("srcset"),le=re(ce,he,ne("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),ne("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),de=ne("script,style,template");class fe{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,n=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!ue.hasOwnProperty(e))return this.sanitizedSomething=!0,!de.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const n=t.attributes;for(let i=0;i<n.length;i++){const t=n.item(i),e=t.name,o=e.toLowerCase();if(!le.hasOwnProperty(o)){this.sanitizedSomething=!0;continue}let s=t.value;ce[o]&&(s=ee(s)),he[o]&&(r=s,s=(r=String(r)).split(",").map(t=>ee(t.trim())).join(", ")),this.buf.push(" ",e,'="',ge(s),'"')}var r;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();ue.hasOwnProperty(e)&&!ie.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(ge(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const pe=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,me=/([^\#-~ |!])/g;function ge(t){return t.replace(/&/g,"&amp;").replace(pe,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(me,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let ye;function ve(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}const be=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}();class we{}const _e=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),Ee=/^url\(([^)]+)\)$/;function Te(t){return t[Ht]}function xe(t){return t[zt]}function Se(t,...e){t.error(...e)}class Ce{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t[Wt]||Se}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(t){return t?Te(t)?Te(t):this._findContext(xe(t)):null}_findOriginalError(t){let e=xe(t);for(;e&&xe(e);)e=xe(e);return e}}const Ae=/([A-Z])/g;function Ie(t){try{return null!=t?t.toString().slice(0,30):t}catch(e){return"[ERROR] Exception while trying to serialize the value"}}let Oe=null;function De(){if(!Oe){const t=vt.Symbol;if(t&&t.iterator)Oe=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const n=t[e];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Oe=n)}}}return Oe}function ke(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function Pe(t,e){const n=Me(t),r=Me(e);if(n&&r)return function(t,e,n){const r=t[De()](),i=e[De()]();for(;;){const t=r.next(),e=i.next();if(t.done&&e.done)return!0;if(t.done||e.done)return!1;if(!n(t.value,e.value))return!1}}(t,e,Pe);{const i=t&&("object"==typeof t||"function"==typeof t),o=e&&("object"==typeof e||"function"==typeof e);return!(n||!i||r||!o)||ke(t,e)}}class Ne{constructor(t){this.wrapped=t}static wrap(t){return new Ne(t)}static unwrap(t){return Ne.isWrapped(t)?t.wrapped:t}static isWrapped(t){return t instanceof Ne}}function Me(t){return!!Re(t)&&(Array.isArray(t)||!(t instanceof Map)&&De()in t)}function Re(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Le(t){return!!t&&"function"==typeof t.then}function Fe(t){return!!t&&"function"==typeof t.subscribe}class Be{constructor(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}isFirstChange(){return this.firstChange}}class Ue{}class Ve{}function je(t){const e=Error(`No component factory found for ${ht(t)}. Did you add it to @NgModule.entryComponents?`);return e[qe]=t,e}const qe="ngComponent";class Ge{resolveComponentFactory(t){throw je(t)}}let He=(()=>{class t{}return t.NULL=new Ge,t})();class ze{constructor(t,e,n){this._parent=e,this._ngModule=n,this._factories=new Map;for(let r=0;r<t.length;r++){const e=t[r];this._factories.set(e.componentType,e)}}resolveComponentFactory(t){let e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw je(t);return new We(e,this._ngModule)}}class We extends Ve{constructor(t,e){super(),this.factory=t,this.ngModule=e,this.selector=t.selector,this.componentType=t.componentType,this.ngContentSelectors=t.ngContentSelectors,this.inputs=t.inputs,this.outputs=t.outputs}create(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)}}class Ke{}class Xe{}function Qe(...t){}let Ye=(()=>{class t{constructor(t){this.nativeElement=t}}return t.__NG_ELEMENT_ID__=()=>Je(t),t})();const Je=Qe;class $e{}class Ze{}const tn=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}();let en=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>nn(),t})();const nn=Qe;class rn{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const on=new rn("8.1.3");class sn{constructor(){}supports(t){return Me(t)}create(t){return new un(t)}}const an=(t,e)=>e;class un{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||an}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,n=this._removalsHead,r=0,i=null;for(;e||n;){const o=!n||e&&e.currentIndex<dn(n,r,i)?e:n,s=dn(o,r,i),a=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(e=e._next,null==o.previousIndex)r++;else{i||(i=[]);const t=s-r,e=a-r;if(t!=e){for(let n=0;n<t;n++){const r=n<i.length?i[n]:i[n]=0,o=r+n;e<=o&&o<t&&(i[n]=r+1)}i[o.previousIndex]=e-t}}s!==a&&t(o,s,a)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Me(t))throw new Error(`Error trying to diff '${ht(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,n,r,i=this._itHead,o=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)r=this._trackByFn(e,n=t[e]),null!==i&&ke(i.trackById,r)?(o&&(i=this._verifyReinsertion(i,n,r,e)),ke(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,e),o=!0),i=i._next}else e=0,function(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{const n=t[De()]();let r;for(;!(r=n.next()).done;)e(r.value)}}(t,t=>{r=this._trackByFn(e,t),null!==i&&ke(i.trackById,r)?(o&&(i=this._verifyReinsertion(i,t,r,e)),ke(i.item,t)||this._addIdentityChange(i,t)):(i=this._mismatch(i,t,r,e),o=!0),i=i._next,e++}),this.length=e;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t,e;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,n,r){let i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(ke(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(ke(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,r)):t=this._addAfter(new cn(e,n),i,r),t}_verifyReinsertion(t,e,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?t=this._reinsertAfter(i,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,i=t._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t}_moveAfter(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t}_addAfter(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,n){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new ln),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t}_addToMoves(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new ln),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class cn{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class hn{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&ke(n.trackById,t))return n;return null}remove(t){const e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}class ln{constructor(){this.map=new Map}put(t){const e=t.trackById;let n=this.map.get(e);n||(n=new hn,this.map.set(e,n)),n.add(t)}get(t,e){const n=this.map.get(t);return n?n.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function dn(t,e,n){const r=t.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+e+i}class fn{constructor(){}supports(t){return t instanceof Map||Re(t)}create(){return new pn}}class pn{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Re(t)))throw new Error(`Error trying to diff '${ht(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,n)=>{if(e&&e.key===n)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const r=this._getOrCreateRecordForKey(n,t);e=this._insertBeforeOrAppend(e,r)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const n=this._records.get(t);this._maybeAddToChanges(n,e);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new mn(t);return this._records.set(t,n),n.currentValue=e,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){ke(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(n=>e(t[n],n))}}class mn{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}let gn=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(null!=n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>{if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new it,new nt]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${n=t,n.name||typeof n}'`);var n}}return t.ngInjectableDef=at({token:t,providedIn:"root",factory:()=>new t([new sn])}),t})(),yn=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>{if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new it,new nt]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return t.ngInjectableDef=at({token:t,providedIn:"root",factory:()=>new t([new fn])}),t})(),vn=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>bn(),t})();const bn=(...t)=>{},wn=[new fn],_n=new gn([new sn]),En=new yn(wn);let Tn=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>xn(t,Ye),t})();const xn=Qe;let Sn=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>Cn(t,Ye),t})();const Cn=Qe;function An(t,e,n,r){let i=`ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '${e}'. Current value: '${n}'.`;return r&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){const n=new Error(t);return In(n,e),n}(i,t)}function In(t,e){t[Ht]=e,t[Wt]=e.logError.bind(e)}function On(t){return new Error(`ViewDestroyedError: Attempt to use a destroyed view: ${t}`)}function Dn(t,e,n){const r=t.state,i=1792&r;return i===e?(t.state=-1793&r|n,t.initIndex=-1,!0):i===n}function kn(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function Pn(t,e){return t.nodes[e]}function Nn(t,e){return t.nodes[e]}function Mn(t,e){return t.nodes[e]}function Rn(t,e){return t.nodes[e]}function Ln(t,e){return t.nodes[e]}const Fn={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},Bn=()=>{},Un=new Map;function Vn(t){let e=Un.get(t);return e||(e=ht(t)+"_"+Un.size,Un.set(t,e)),e}function jn(t,e,n,r){if(Ne.isWrapped(r)){r=Ne.unwrap(r);const i=t.def.nodes[e].bindingIndex+n,o=Ne.unwrap(t.oldValues[i]);t.oldValues[i]=new Ne(o)}return r}const qn="$$undefined",Gn="$$empty";function Hn(t){return{id:qn,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}let zn=0;function Wn(t,e,n,r){return!(!(2&t.state)&&ke(t.oldValues[e.bindingIndex+n],r))}function Kn(t,e,n,r){return!!Wn(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function Xn(t,e,n,r){const i=t.oldValues[e.bindingIndex+n];if(1&t.state||!Pe(i,r)){const o=e.bindings[n].name;throw An(Fn.createDebugContext(t,e.nodeIndex),`${o}: ${i}`,`${o}: ${r}`,0!=(1&t.state))}}function Qn(t){let e=t;for(;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function Yn(t,e){let n=t;for(;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function Jn(t,e,n,r){try{return Qn(33554432&t.def.nodes[e].flags?Nn(t,e).componentView:t),Fn.handleEvent(t,e,n,r)}catch(i){t.root.errorHandler.handleError(i)}}function $n(t){return t.parent?Nn(t.parent,t.parentNodeDef.nodeIndex):null}function Zn(t){return t.parent?t.parentNodeDef.parent:null}function tr(t,e){switch(201347067&e.flags){case 1:return Nn(t,e.nodeIndex).renderElement;case 2:return Pn(t,e.nodeIndex).renderText}}function er(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function nr(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function rr(t){return 1<<t%32}function ir(t){const e={};let n=0;const r={};return t&&t.forEach(([t,i])=>{"number"==typeof t?(e[t]=i,n|=rr(t)):r[t]=i}),{matchedQueries:e,references:r,matchedQueryIds:n}}function or(t,e){return t.map(t=>{let n,r;return Array.isArray(t)?[r,n]=t:(r=0,n=t),n&&("function"==typeof n||"object"==typeof n)&&e&&Object.defineProperty(n,Ct,{value:e,configurable:!0}),{flags:r,token:n,tokenKey:Vn(n)}})}function sr(t,e,n){let r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===Kt.Native?Nn(t,n.renderParent.nodeIndex).renderElement:void 0:e}const ar=new WeakMap;function ur(t){let e=ar.get(t);return e||((e=t(()=>Bn)).factory=t,ar.set(t,e)),e}function cr(t,e,n,r,i){3===e&&(n=t.renderer.parentNode(tr(t,t.def.lastRenderRootNode))),hr(t,e,0,t.def.nodes.length-1,n,r,i)}function hr(t,e,n,r,i,o,s){for(let a=n;a<=r;a++){const n=t.def.nodes[a];11&n.flags&&dr(t,n,e,i,o,s),a+=n.childCount}}function lr(t,e,n,r,i,o){let s=t;for(;s&&!er(s);)s=s.parent;const a=s.parent,u=Zn(s),c=u.nodeIndex+u.childCount;for(let h=u.nodeIndex+1;h<=c;h++){const t=a.def.nodes[h];t.ngContentIndex===e&&dr(a,t,n,r,i,o),h+=t.childCount}if(!a.parent){const s=t.root.projectableNodes[e];if(s)for(let e=0;e<s.length;e++)fr(t,s[e],n,r,i,o)}}function dr(t,e,n,r,i,o){if(8&e.flags)lr(t,e.ngContent.index,n,r,i,o);else{const s=tr(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&fr(t,s,n,r,i,o),32&e.bindingFlags&&fr(Nn(t,e.nodeIndex).componentView,s,n,r,i,o)):fr(t,s,n,r,i,o),16777216&e.flags){const s=Nn(t,e.nodeIndex).viewContainer._embeddedViews;for(let t=0;t<s.length;t++)cr(s[t],n,r,i,o)}1&e.flags&&!e.element.name&&hr(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,i,o)}}function fr(t,e,n,r,i,o){const s=t.renderer;switch(n){case 1:s.appendChild(r,e);break;case 2:s.insertBefore(r,e,i);break;case 3:s.removeChild(r,e);break;case 0:o.push(e)}}const pr=/^:([^:]+):(.+)$/;function mr(t){if(":"===t[0]){const e=t.match(pr);return[e[1],e[2]]}return["",t]}function gr(t){let e=0;for(let n=0;n<t.length;n++)e|=t[n].flags;return e}function yr(t,e,n,r,i,o,s,a,u,c,h,l,d,f,p,m,g,y,v,b){switch(t){case 1:return e+vr(n)+r;case 2:return e+vr(n)+r+vr(i)+o;case 3:return e+vr(n)+r+vr(i)+o+vr(s)+a;case 4:return e+vr(n)+r+vr(i)+o+vr(s)+a+vr(u)+c;case 5:return e+vr(n)+r+vr(i)+o+vr(s)+a+vr(u)+c+vr(h)+l;case 6:return e+vr(n)+r+vr(i)+o+vr(s)+a+vr(u)+c+vr(h)+l+vr(d)+f;case 7:return e+vr(n)+r+vr(i)+o+vr(s)+a+vr(u)+c+vr(h)+l+vr(d)+f+vr(p)+m;case 8:return e+vr(n)+r+vr(i)+o+vr(s)+a+vr(u)+c+vr(h)+l+vr(d)+f+vr(p)+m+vr(g)+y;case 9:return e+vr(n)+r+vr(i)+o+vr(s)+a+vr(u)+c+vr(h)+l+vr(d)+f+vr(p)+m+vr(g)+y+vr(v)+b;default:throw new Error("Does not support more than 9 expressions")}}function vr(t){return null!=t?t.toString():""}const br=new Object,wr=Vn(Rt),_r=Vn(wt),Er=Vn(Ke);function Tr(t,e,n,r){return n=ft(n),{index:-1,deps:or(r,ht(e)),flags:t,token:e,value:n}}function xr(t,e,n=Rt.THROW_IF_NOT_FOUND){const r=Dt(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(n=null),1&e.flags)return t._parent.get(e.token,n);const s=e.tokenKey;switch(s){case wr:case _r:case Er:return t}const a=t._def.providersByKey[s];let u;if(a){let e=t._providers[a.index];return void 0===e&&(e=t._providers[a.index]=Sr(t,a)),e===br?void 0:e}if((u=ut(e.token))&&(i=t,null!=(o=u).providedIn&&(function(t,e){return t._def.modules.indexOf(o.providedIn)>-1}(i)||"root"===o.providedIn&&i._def.isRoot))){const n=t._providers.length;return t._def.providers[n]=t._def.providersByKey[e.tokenKey]={flags:5120,value:u.factory,deps:[],index:n,token:e.token},t._providers[n]=br,t._providers[n]=Sr(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?n:t._parent.get(e.token,n)}finally{Dt(r)}var i,o}function Sr(t,e){let n;switch(201347067&e.flags){case 512:n=function(t,e,n){const r=n.length;switch(r){case 0:return new e;case 1:return new e(xr(t,n[0]));case 2:return new e(xr(t,n[0]),xr(t,n[1]));case 3:return new e(xr(t,n[0]),xr(t,n[1]),xr(t,n[2]));default:const i=new Array(r);for(let e=0;e<r;e++)i[e]=xr(t,n[e]);return new e(...i)}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){const r=n.length;switch(r){case 0:return e();case 1:return e(xr(t,n[0]));case 2:return e(xr(t,n[0]),xr(t,n[1]));case 3:return e(xr(t,n[0]),xr(t,n[1]),xr(t,n[2]));default:const i=Array(r);for(let e=0;e<r;e++)i[e]=xr(t,n[e]);return e(...i)}}(t,e.value,e.deps);break;case 2048:n=xr(t,e.deps[0]);break;case 256:n=e.value}return n===br||null===n||"object"!=typeof n||131072&e.flags||"function"!=typeof n.ngOnDestroy||(e.flags|=131072),void 0===n?br:n}function Cr(t,e){const n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;const r=n[e];return r.viewContainerParent=null,Dr(n,e),Fn.dirtyParentQueries(r),Ir(r),r}function Ar(t,e,n){const r=e?tr(e,e.def.lastRenderRootNode):t.renderElement,i=n.renderer.parentNode(r),o=n.renderer.nextSibling(r);cr(n,2,i,o,void 0)}function Ir(t){cr(t,3,null,null,void 0)}function Or(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Dr(t,e){e>=t.length-1?t.pop():t.splice(e,1)}const kr=new Object;function Pr(t,e,n,r,i,o){return new Nr(t,e,n,r,i,o)}class Nr extends Ve{constructor(t,e,n,r,i,o){super(),this.selector=t,this.componentType=e,this._inputs=r,this._outputs=i,this.ngContentSelectors=o,this.viewDefFactory=n}get inputs(){const t=[],e=this._inputs;for(let n in e)t.push({propName:n,templateName:e[n]});return t}get outputs(){const t=[];for(let e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t}create(t,e,n,r){if(!r)throw new Error("ngModule should be provided");const i=ur(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,s=Fn.createRootView(t,e||[],n,i,r,kr),a=Mn(s,o).instance;return n&&s.renderer.setAttribute(Nn(s,0).renderElement,"ng-version",on.full),new Mr(s,new Br(s),a)}}class Mr extends Ue{constructor(t,e,n){super(),this._view=t,this._viewRef=e,this._component=n,this._elDef=this._view.def.nodes[0],this.hostView=e,this.changeDetectorRef=e,this.instance=n}get location(){return new Ye(Nn(this._view,this._elDef.nodeIndex).renderElement)}get injector(){return new qr(this._view,this._elDef)}get componentType(){return this._component.constructor}destroy(){this._viewRef.destroy()}onDestroy(t){this._viewRef.onDestroy(t)}}function Rr(t,e,n){return new Lr(t,e,n)}class Lr{constructor(t,e,n){this._view=t,this._elDef=e,this._data=n,this._embeddedViews=[]}get element(){return new Ye(this._data.renderElement)}get injector(){return new qr(this._view,this._elDef)}get parentInjector(){let t=this._view,e=this._elDef.parent;for(;!e&&t;)e=Zn(t),t=t.parent;return t?new qr(t,e):new qr(this._view,null)}clear(){for(let t=this._embeddedViews.length-1;t>=0;t--){const e=Cr(this._data,t);Fn.destroyView(e)}}get(t){const e=this._embeddedViews[t];if(e){const t=new Br(e);return t.attachToViewContainerRef(this),t}return null}get length(){return this._embeddedViews.length}createEmbeddedView(t,e,n){const r=t.createEmbeddedView(e||{});return this.insert(r,n),r}createComponent(t,e,n,r,i){const o=n||this.parentInjector;i||t instanceof We||(i=o.get(Ke));const s=t.create(o,r,void 0,i);return this.insert(s.hostView,e),s}insert(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");const n=t;return function(t,e,n,r){let i=e.viewContainer._embeddedViews;null==n&&(n=i.length),r.viewContainerParent=t,Or(i,n,r),function(t,e){const n=$n(e);if(!n||n===t||16&e.state)return;e.state|=16;let r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,n){if(4&n.flags)return;e.parent.def.nodeFlags|=4,n.flags|=4;let r=n.parent;for(;r;)r.childFlags|=4,r=r.parent}(0,e.parentNodeDef)}(e,r),Fn.dirtyParentQueries(r),Ar(e,n>0?i[n-1]:null,r)}(this._view,this._data,e,n._view),n.attachToViewContainerRef(this),t}move(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");const n=this._embeddedViews.indexOf(t._view);return function(t,e,r){const i=t.viewContainer._embeddedViews,o=i[n];Dr(i,n),null==r&&(r=i.length),Or(i,r,o),Fn.dirtyParentQueries(o),Ir(o),Ar(t,r>0?i[r-1]:null,o)}(this._data,0,e),t}indexOf(t){return this._embeddedViews.indexOf(t._view)}remove(t){const e=Cr(this._data,t);e&&Fn.destroyView(e)}detach(t){const e=Cr(this._data,t);return e?new Br(e):null}}function Fr(t){return new Br(t)}class Br{constructor(t){this._view=t,this._viewContainerRef=null,this._appRef=null}get rootNodes(){return function(t){const e=[];return cr(t,0,void 0,void 0,e),e}(this._view)}get context(){return this._view.context}get destroyed(){return 0!=(128&this._view.state)}markForCheck(){Qn(this._view)}detach(){this._view.state&=-5}detectChanges(){const t=this._view.root.rendererFactory;t.begin&&t.begin();try{Fn.checkAndUpdateView(this._view)}finally{t.end&&t.end()}}checkNoChanges(){Fn.checkNoChangesView(this._view)}reattach(){this._view.state|=4}onDestroy(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)}destroy(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Fn.destroyView(this._view)}detachFromAppRef(){this._appRef=null,Ir(this._view),Fn.dirtyParentQueries(this._view)}attachToAppRef(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}attachToViewContainerRef(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t}}function Ur(t,e){return new Vr(t,e)}class Vr extends Tn{constructor(t,e){super(),this._parentView=t,this._def=e}createEmbeddedView(t){return new Br(Fn.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))}get elementRef(){return new Ye(Nn(this._parentView,this._def.nodeIndex).renderElement)}}function jr(t,e){return new qr(t,e)}class qr{constructor(t,e){this.view=t,this.elDef=e}get(t,e=Rt.THROW_IF_NOT_FOUND){return Fn.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:Vn(t)},e)}}function Gr(t,e){const n=t.def.nodes[e];if(1&n.flags){const e=Nn(t,n.nodeIndex);return n.element.template?e.template:e.renderElement}if(2&n.flags)return Pn(t,n.nodeIndex).renderText;if(20240&n.flags)return Mn(t,n.nodeIndex).instance;throw new Error(`Illegal state: read nodeValue for node index ${e}`)}function Hr(t){return new zr(t.renderer)}class zr{constructor(t){this.delegate=t}selectRootElement(t){return this.delegate.selectRootElement(t)}createElement(t,e){const[n,r]=mr(e),i=this.delegate.createElement(r,n);return t&&this.delegate.appendChild(t,i),i}createViewRoot(t){return t}createTemplateAnchor(t){const e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e}createText(t,e){const n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n}projectNodes(t,e){for(let n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])}attachViewAfter(t,e){const n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t);for(let i=0;i<e.length;i++)this.delegate.insertBefore(n,e[i],r)}detachView(t){for(let e=0;e<t.length;e++){const n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}}destroyView(t,e){for(let n=0;n<e.length;n++)this.delegate.destroyNode(e[n])}listen(t,e,n){return this.delegate.listen(t,e,n)}listenGlobal(t,e,n){return this.delegate.listen(t,e,n)}setElementProperty(t,e,n){this.delegate.setProperty(t,e,n)}setElementAttribute(t,e,n){const[r,i]=mr(e);null!=n?this.delegate.setAttribute(t,i,n,r):this.delegate.removeAttribute(t,i,r)}setBindingDebugInfo(t,e,n){}setElementClass(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)}setElementStyle(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)}invokeElementMethod(t,e,n){t[e].apply(t,n)}setText(t,e){this.delegate.setValue(t,e)}animate(){throw new Error("Renderer.animate is no longer supported!")}}function Wr(t,e,n,r){return new Kr(t,e,n,r)}class Kr{constructor(t,e,n,r){this._moduleType=t,this._parent=e,this._bootstrapComponents=n,this._def=r,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){const e=t._def,n=t._providers=new Array(e.providers.length);for(let r=0;r<e.providers.length;r++){const i=e.providers[r];4096&i.flags||void 0===n[r]&&(n[r]=Sr(t,i))}}(this)}get(t,e=Rt.THROW_IF_NOT_FOUND,n=ot.Default){let r=0;return n&ot.SkipSelf?r|=1:n&ot.Self&&(r|=4),xr(this,{token:t,tokenKey:Vn(t),flags:r},e)}get instance(){return this.get(this._moduleType)}get componentFactoryResolver(){return this.get(He)}destroy(){if(this._destroyed)throw new Error(`The ng module ${ht(this.instance.constructor)} has already been destroyed.`);this._destroyed=!0,function(t,e){const n=t._def,r=new Set;for(let i=0;i<n.providers.length;i++)if(131072&n.providers[i].flags){const e=t._providers[i];if(e&&e!==br){const t=e.ngOnDestroy;"function"!=typeof t||r.has(e)||(t.apply(e),r.add(e))}}}(this),this._destroyListeners.forEach(t=>t())}onDestroy(t){this._destroyListeners.push(t)}}const Xr=Vn($e),Qr=Vn(en),Yr=Vn(Ye),Jr=Vn(Sn),$r=Vn(Tn),Zr=Vn(vn),ti=Vn(Rt),ei=Vn(wt);function ni(t,e,n,r,i,o,s,a){const u=[];if(s)for(let h in s){const[t,e]=s[h];u[t]={flags:8,name:h,nonMinifiedName:e,ns:null,securityContext:null,suffix:null}}const c=[];if(a)for(let h in a)c.push({type:1,propName:h,target:null,eventName:a[h]});return oi(t,e|=16384,n,r,i,i,o,u,c)}function ri(t,e,n){return oi(-1,t|=16,null,0,e,e,n)}function ii(t,e,n,r,i){return oi(-1,t,e,0,n,r,i)}function oi(t,e,n,r,i,o,s,a,u){const{matchedQueries:c,references:h,matchedQueryIds:l}=ir(n);u||(u=[]),a||(a=[]),o=ft(o);const d=or(s,ht(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:c,matchedQueryIds:l,references:h,ngContentIndex:-1,childCount:r,bindings:a,bindingFlags:gr(a),outputs:u,element:null,provider:{token:i,value:o,deps:d},text:null,query:null,ngContent:null}}function si(t,e){return hi(t,e)}function ai(t,e){let n=t;for(;n.parent&&!er(n);)n=n.parent;return li(n.parent,Zn(n),!0,e.provider.value,e.provider.deps)}function ui(t,e){const n=li(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(let r=0;r<e.outputs.length;r++){const i=e.outputs[r],o=n[i.propName];if(!Fe(o))throw new Error(`@Output ${i.propName} not initialized in '${n.constructor.name}'.`);{const n=o.subscribe(ci(t,e.parent.nodeIndex,i.eventName));t.disposables[e.outputIndex+r]=n.unsubscribe.bind(n)}}return n}function ci(t,e,n){return r=>Jn(t,e,n,r)}function hi(t,e){const n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return li(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,i){const o=i.length;switch(o){case 0:return r();case 1:return r(fi(t,e,n,i[0]));case 2:return r(fi(t,e,n,i[0]),fi(t,e,n,i[1]));case 3:return r(fi(t,e,n,i[0]),fi(t,e,n,i[1]),fi(t,e,n,i[2]));default:const s=Array(o);for(let r=0;r<o;r++)s[r]=fi(t,e,n,i[r]);return r(...s)}}(t,e.parent,n,r.value,r.deps);case 2048:return fi(t,e.parent,n,r.deps[0]);case 256:return r.value}}function li(t,e,n,r,i){const o=i.length;switch(o){case 0:return new r;case 1:return new r(fi(t,e,n,i[0]));case 2:return new r(fi(t,e,n,i[0]),fi(t,e,n,i[1]));case 3:return new r(fi(t,e,n,i[0]),fi(t,e,n,i[1]),fi(t,e,n,i[2]));default:const s=new Array(o);for(let r=0;r<o;r++)s[r]=fi(t,e,n,i[r]);return new r(...s)}}const di={};function fi(t,e,n,r,i=Rt.THROW_IF_NOT_FOUND){if(8&r.flags)return r.token;const o=t;2&r.flags&&(i=null);const s=r.tokenKey;s===Zr&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);let a=t;for(;a;){if(e)switch(s){case Xr:return Hr(pi(a,e,n));case Qr:return pi(a,e,n).renderer;case Yr:return new Ye(Nn(a,e.nodeIndex).renderElement);case Jr:return Nn(a,e.nodeIndex).viewContainer;case $r:if(e.element.template)return Nn(a,e.nodeIndex).template;break;case Zr:return Fr(pi(a,e,n));case ti:case ei:return jr(a,e);default:const t=(n?e.element.allProviders:e.element.publicProviders)[s];if(t){let e=Mn(a,t.nodeIndex);return e||(e={instance:hi(a,t)},a.nodes[t.nodeIndex]=e),e.instance}}n=er(a),e=Zn(a),a=a.parent,4&r.flags&&(a=null)}const u=o.root.injector.get(r.token,di);return u!==di||i===di?u:o.root.ngModule.injector.get(r.token,i)}function pi(t,e,n){let r;if(n)r=Nn(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!er(r);)r=r.parent;return r}function mi(t,e,n,r,i,o){if(32768&n.flags){const e=Nn(t,n.parent.nodeIndex).componentView;2&e.def.flags&&(e.state|=8)}if(e.instance[n.bindings[r].name]=i,524288&n.flags){o=o||{};const e=Ne.unwrap(t.oldValues[n.bindingIndex+r]);o[n.bindings[r].nonMinifiedName]=new Be(e,i,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=i,o}function gi(t,e){if(!(t.def.nodeFlags&e))return;const n=t.def.nodes;let r=0;for(let i=0;i<n.length;i++){const o=n[i];let s=o.parent;for(!s&&o.flags&e&&vi(t,i,o.flags&e,r++),0==(o.childFlags&e)&&(i+=o.childCount);s&&1&s.flags&&i===s.nodeIndex+s.childCount;)s.directChildFlags&e&&(r=yi(t,s,e,r)),s=s.parent}}function yi(t,e,n,r){for(let i=e.nodeIndex+1;i<=e.nodeIndex+e.childCount;i++){const e=t.def.nodes[i];e.flags&n&&vi(t,i,e.flags&n,r++),i+=e.childCount}return r}function vi(t,e,n,r){const i=Mn(t,e);if(!i)return;const o=i.instance;o&&(Fn.setCurrentNode(t,e),1048576&n&&kn(t,512,r)&&o.ngAfterContentInit(),2097152&n&&o.ngAfterContentChecked(),4194304&n&&kn(t,768,r)&&o.ngAfterViewInit(),8388608&n&&o.ngAfterViewChecked(),131072&n&&o.ngOnDestroy())}const bi=new bt("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Xt}),wi={},_i=function(){var t={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencySymbol:15,CurrencyName:16,Currencies:17,PluralCase:18,ExtraData:19};return t[t.LocaleId]="LocaleId",t[t.DayPeriodsFormat]="DayPeriodsFormat",t[t.DayPeriodsStandalone]="DayPeriodsStandalone",t[t.DaysFormat]="DaysFormat",t[t.DaysStandalone]="DaysStandalone",t[t.MonthsFormat]="MonthsFormat",t[t.MonthsStandalone]="MonthsStandalone",t[t.Eras]="Eras",t[t.FirstDayOfWeek]="FirstDayOfWeek",t[t.WeekendRange]="WeekendRange",t[t.DateFormat]="DateFormat",t[t.TimeFormat]="TimeFormat",t[t.DateTimeFormat]="DateTimeFormat",t[t.NumberSymbols]="NumberSymbols",t[t.NumberFormats]="NumberFormats",t[t.CurrencySymbol]="CurrencySymbol",t[t.CurrencyName]="CurrencyName",t[t.Currencies]="Currencies",t[t.PluralCase]="PluralCase",t[t.ExtraData]="ExtraData",t}();var Ei=["en",[["a","p"],["AM","PM"],void 0],[["AM","PM"],void 0,void 0],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],void 0,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",void 0,"{1} 'at' {0}",void 0],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){let e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];let Ti="en-US";class xi extends x{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,n){let r,i=t=>null,o=()=>null;t&&"object"==typeof t?(r=this.__isAsync?e=>{setTimeout(()=>t.next(e))}:e=>{t.next(e)},t.error&&(i=this.__isAsync?e=>{setTimeout(()=>t.error(e))}:e=>{t.error(e)}),t.complete&&(o=this.__isAsync?()=>{setTimeout(()=>t.complete())}:()=>{t.complete()})):(r=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)},e&&(i=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)}),n&&(o=this.__isAsync?()=>{setTimeout(()=>n())}:()=>{n()}));const s=super.subscribe(r,i,o);return t instanceof d&&t.add(s),s}}function Si(){return this._results[De()]()}class Ci{constructor(){this.dirty=!0,this._results=[],this.changes=new xi,this.length=0;const t=De(),e=Ci.prototype;e[t]||(e[t]=Si)}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t){this._results=function t(e,n){void 0===n&&(n=e);for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?(n===e&&(n=e.slice(0,r)),t(i,n)):n!==e&&n.push(i)}return n}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}notifyOnChanges(){this.changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}const Ai=new bt("Application Initializer");let Ii=(()=>(class{constructor(t){this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const e=this.appInits[n]();Le(e)&&t.push(e)}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}))();const Oi=new bt("AppId");function Di(){return`${ki()}${ki()}${ki()}`}function ki(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Pi=new bt("Platform Initializer"),Ni=new bt("Platform ID"),Mi=new bt("appBootstrapListener");let Ri=(()=>(class{log(t){console.log(t)}warn(t){console.warn(t)}}))();const Li=new bt("LocaleId");function Fi(){throw new Error("Runtime compiler is not loaded")}const Bi=Fi,Ui=Fi,Vi=Fi,ji=Fi;let qi,Gi,Hi=(()=>(class{constructor(){this.compileModuleSync=Bi,this.compileModuleAsync=Ui,this.compileModuleAndAllComponentsSync=Vi,this.compileModuleAndAllComponentsAsync=ji}clearCache(){}clearCacheFor(t){}getModuleId(t){}}))();class zi{}function Wi(){const t=vt.wtf;return!(!t||!(qi=t.trace)||(Gi=qi.events,0))}const Ki=Wi(),Xi=Ki?function(t,e=null){return Gi.createScope(t,e)}:(t,e)=>(function(t,e){return null}),Qi=Ki?function(t,e){return qi.leaveScope(t,e),e}:(t,e)=>e,Yi=(()=>Promise.resolve(0))();function Ji(t){"undefined"==typeof Zone?Yi.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class $i{constructor({enableLongStackTrace:t=!1}){if(this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new xi(!1),this.onMicrotaskEmpty=new xi(!1),this.onStable=new xi(!1),this.onError=new xi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");var e;Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(e=this)._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,n,r,i,o,s)=>{try{return no(e),t.invokeTask(r,i,o,s)}finally{ro(e)}},onInvoke:(t,n,r,i,o,s,a)=>{try{return no(e),t.invoke(r,i,o,s,a)}finally{ro(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e.hasPendingMicrotasks=i.microTask,eo(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!$i.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if($i.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,n){return this._inner.run(t,e,n)}runTask(t,e,n,r){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+r,t,to,Zi,Zi);try{return i.runTask(o,e,n)}finally{i.cancelTask(o)}}runGuarded(t,e,n){return this._inner.runGuarded(t,e,n)}runOutsideAngular(t){return this._outer.run(t)}}function Zi(){}const to={};function eo(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function no(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function ro(t){t._nesting--,eo(t)}class io{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new xi,this.onMicrotaskEmpty=new xi,this.onStable=new xi,this.onError=new xi}run(t){return t()}runGuarded(t){return t()}runOutsideAngular(t){return t()}runTask(t){return t()}}let oo=(()=>(class{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{$i.assertNotInAngularZone(),Ji(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ji(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,e,n){let r=-1;e&&e>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==r),t(this._didWork,this.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:r,updateCb:n})}whenStable(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,n){return[]}}))(),so=(()=>{class t{constructor(){this._applications=new Map,co.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return co.findTestabilityInTree(this,t,e)}}return t.ctorParameters=()=>[],t})();class ao{addToWindow(t){}findTestabilityInTree(t,e,n){return null}}let uo,co=new ao,ho=function(t){return t instanceof We};const lo=new bt("AllowMultipleToken");class fo{constructor(t,e){this.name=t,this.token=e}}function po(t,e,n=[]){const r=`Platform: ${e}`,i=new bt(r);return(e=[])=>{let o=mo();if(!o||o.injector.get(lo,!1))if(t)t(n.concat(e).concat({provide:i,useValue:!0}));else{const t=n.concat(e).concat({provide:i,useValue:!0});!function(t){if(uo&&!uo.destroyed&&!uo.injector.get(lo,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");uo=t.get(go);const e=t.get(Pi,null);e&&e.forEach(t=>t())}(Rt.create({providers:t,name:r}))}return function(t){const e=mo();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function mo(){return uo&&!uo.destroyed?uo:null}let go=(()=>(class{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const n="noop"===(i=e?e.ngZone:void 0)?new io:("zone.js"===i?void 0:i)||new $i({enableLongStackTrace:Jt()}),r=[{provide:$i,useValue:n}];var i;return n.run(()=>{const e=Rt.create({providers:r,parent:this.injector,name:t.moduleType.name}),i=t.create(e),o=i.injector.get(Ce,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return function(t){Ti=t.toLowerCase().replace(/_/g,"-")}(i.injector.get(Li,"en-US")),i.onDestroy(()=>bo(this._modules,i)),n.runOutsideAngular(()=>n.onError.subscribe({next:t=>{o.handleError(t)}})),function(t,e,n){try{const i=n();return Le(i)?i.catch(n=>{throw e.runOutsideAngular(()=>t.handleError(n)),n}):i}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(o,n,()=>{const t=i.injector.get(Ii);return t.runInitializers(),t.donePromise.then(()=>(this._moduleDoBootstrap(i),i))})})}bootstrapModule(t,e=[]){const n=yo({},e);return function(t,e,n){return t.get(zi).createCompiler([e]).compileModuleAsync(n)}(this.injector,n,t).then(t=>this.bootstrapModuleFactory(t,n))}_moduleDoBootstrap(t){const e=t.injector.get(vo);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${ht(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. `+"Please define one of these.");t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}))();function yo(t,e){return Array.isArray(e)?e.reduce(yo,t):Object.assign({},t,e)}let vo=(()=>{class t{constructor(t,e,n,r,i,o){this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Jt(),this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new v(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),a=new v(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{$i.assertNotInAngularZone(),Ji(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,t.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{$i.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),n.unsubscribe()}});this.isStable=function(...t){let e=Number.POSITIVE_INFINITY,n=null,r=t[t.length-1];return C(r)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof r&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof v?t[0]:function(t=Number.POSITIVE_INFINITY){return j(H,t)}(e)(z(t,n))}(s,a.pipe(t=>W()(function(t,e){return function(e){let n;n="function"==typeof t?t:function(){return t};const r=Object.create(e,Y);return r.source=e,r.subjectFactory=n,r}}($)(t))))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=t instanceof Ve?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);const r=ho(n)?null:this._injector.get(Ke),i=n.create(Rt.NULL,[],e||n.selector,r);i.onDestroy(()=>{this._unloadComponent(i)});const o=i.injector.get(oo,null);return o&&i.injector.get(so).registerApplication(i.location.nativeElement,o),this._loadComponent(i),Jt()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");const e=t._tickScope();try{this._runningTick=!0;for(let t of this._views)t.detectChanges();if(this._enforceNoNewChanges)for(let t of this._views)t.checkNoChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1,Qi(e)}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;bo(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Mi,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}_unloadComponent(t){this.detachView(t.hostView),bo(this.components,t)}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy())}get viewCount(){return this._views.length}}return t._tickScope=Xi("ApplicationRef#tick()"),t})();function bo(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class wo{constructor(t,e){this.name=t,this.callback=e}}class _o{constructor(t,e,n){this.listeners=[],this.parent=null,this._debugContext=n,this.nativeNode=t,e&&e instanceof Eo&&e.addChild(this)}get injector(){return this._debugContext.injector}get componentInstance(){return this._debugContext.component}get context(){return this._debugContext.context}get references(){return this._debugContext.references}get providerTokens(){return this._debugContext.providerTokens}}class Eo extends _o{constructor(t,e,n){super(t,e,n),this.properties={},this.attributes={},this.classes={},this.styles={},this.childNodes=[],this.nativeElement=t}addChild(t){t&&(this.childNodes.push(t),t.parent=this)}removeChild(t){const e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))}insertChildrenAfter(t,e){const n=this.childNodes.indexOf(t);-1!==n&&(this.childNodes.splice(n+1,0,...e),e.forEach(e=>{e.parent&&e.parent.removeChild(e),t.parent=this}))}insertBefore(t,e){const n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))}query(t){return this.queryAll(t)[0]||null}queryAll(t){const e=[];return function t(e,n,r){e.childNodes.forEach(e=>{e instanceof Eo&&(n(e)&&r.push(e),t(e,n,r))})}(this,t,e),e}queryAllNodes(t){const e=[];return function t(e,n,r){e instanceof Eo&&e.childNodes.forEach(e=>{n(e)&&r.push(e),e instanceof Eo&&t(e,n,r)})}(this,t,e),e}get children(){return this.childNodes.filter(t=>t instanceof Eo)}triggerEventHandler(t,e){this.listeners.forEach(n=>{n.name==t&&n.callback(e)})}}const To=new Map,xo=function(t){return To.get(t)||null};function So(t){To.set(t.nativeNode,t)}const Co=po(null,"core",[{provide:Ni,useValue:"unknown"},{provide:go,deps:[Rt]},{provide:so,deps:[]},{provide:Ri,deps:[]}]);function Ao(){return _n}function Io(){return En}function Oo(t){return t||"en-US"}function Do(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}let ko=(()=>(class{constructor(t){}}))();function Po(t,e,n,r,i,o){t|=1;const{matchedQueries:s,references:a,matchedQueryIds:u}=ir(e);return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:u,references:a,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?ur(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||Bn},provider:null,text:null,query:null,ngContent:null}}function No(t,e,n,r,i,o,s=[],a,u,c,h,l){c||(c=Bn);const{matchedQueries:d,references:f,matchedQueryIds:p}=ir(n);let m=null,g=null;o&&([m,g]=mr(o)),a=a||[];const y=new Array(a.length);for(let w=0;w<a.length;w++){const[t,e,n]=a[w],[r,i]=mr(e);let o=void 0,s=void 0;switch(15&t){case 4:s=n;break;case 1:case 8:o=n}y[w]={flags:t,ns:r,name:i,nonMinifiedName:i,securityContext:o,suffix:s}}u=u||[];const v=new Array(u.length);for(let w=0;w<u.length;w++){const[t,e]=u[w];v[w]={type:0,target:t,eventName:e,propName:null}}const b=(s=s||[]).map(([t,e])=>{const[n,r]=mr(t);return[n,r,e]});return l=function(t){if(t&&t.id===qn){const e=null!=t.encapsulation&&t.encapsulation!==Kt.None||t.styles.length||Object.keys(t.data).length;t.id=e?`c${zn++}`:Gn}return t&&t.id===Gn&&(t=null),t||null}(l),h&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:d,matchedQueryIds:p,references:f,ngContentIndex:r,childCount:i,bindings:y,bindingFlags:gr(y),outputs:v,element:{ns:m,name:g,attrs:b,template:null,componentProvider:null,componentView:h||null,componentRendererType:l,publicProviders:null,allProviders:null,handleEvent:c||Bn},provider:null,text:null,query:null,ngContent:null}}function Mo(t,e,n){const r=n.element,i=t.root.selectorOrNode,o=t.renderer;let s;if(t.parent||!i){s=r.name?o.createElement(r.name,r.ns):o.createComment("");const i=sr(t,e,n);i&&o.appendChild(i,s)}else s=o.selectRootElement(i,!!r.componentRendererType&&r.componentRendererType.encapsulation===Kt.ShadowDom);if(r.attrs)for(let a=0;a<r.attrs.length;a++){const[t,e,n]=r.attrs[a];o.setAttribute(s,e,n,t)}return s}function Ro(t,e,n,r){for(let s=0;s<n.outputs.length;s++){const a=n.outputs[s],u=Lo(t,n.nodeIndex,(o=a.eventName,(i=a.target)?`${i}:${o}`:o));let c=a.target,h=t;"component"===a.target&&(c=null,h=e);const l=h.renderer.listen(c||r,a.eventName,u);t.disposables[n.outputIndex+s]=l}var i,o}function Lo(t,e,n){return r=>Jn(t,e,n,r)}function Fo(t,e,n,r){if(!Kn(t,e,n,r))return!1;const i=e.bindings[n],o=Nn(t,e.nodeIndex),s=o.renderElement,a=i.name;switch(15&i.flags){case 1:!function(t,e,n,r,i,o){const s=e.securityContext;let a=s?t.root.sanitizer.sanitize(s,o):o;a=null!=a?a.toString():null;const u=t.renderer;null!=o?u.setAttribute(n,i,a,r):u.removeAttribute(n,i,r)}(t,i,s,i.ns,a,r);break;case 2:!function(t,e,n,r){const i=t.renderer;r?i.addClass(e,n):i.removeClass(e,n)}(t,s,a,r);break;case 4:!function(t,e,n,r,i){let o=t.root.sanitizer.sanitize(be.STYLE,i);if(null!=o){o=o.toString();const t=e.suffix;null!=t&&(o+=t)}else o=null;const s=t.renderer;null!=o?s.setStyle(n,r,o):s.removeStyle(n,r)}(t,i,s,a,r);break;case 8:!function(t,e,n,r,i){const o=e.securityContext;let s=o?t.root.sanitizer.sanitize(o,i):i;t.renderer.setProperty(n,r,s)}(33554432&e.flags&&32&i.flags?o.componentView:t,i,s,a,r)}return!0}function Bo(t,e,n){let r=[];for(let i in n)r.push({propName:i,bindingType:n[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:rr(e),bindings:r},ngContent:null}}function Uo(t){const e=t.def.nodeMatchedQueries;for(;t.parent&&nr(t);){let n=t.parentNodeDef;t=t.parent;const r=n.nodeIndex+n.childCount;for(let i=0;i<=r;i++){const r=t.def.nodes[i];67108864&r.flags&&536870912&r.flags&&(r.query.filterId&e)===r.query.filterId&&Ln(t,i).setDirty(),!(1&r.flags&&i+r.childCount<n.nodeIndex)&&67108864&r.childFlags&&536870912&r.childFlags||(i+=r.childCount)}}if(134217728&t.def.nodeFlags)for(let n=0;n<t.def.nodes.length;n++){const e=t.def.nodes[n];134217728&e.flags&&536870912&e.flags&&Ln(t,n).setDirty(),n+=e.childCount}}function Vo(t,e){const n=Ln(t,e.nodeIndex);if(!n.dirty)return;let r,i=void 0;if(67108864&e.flags){const n=e.parent.parent;i=jo(t,n.nodeIndex,n.nodeIndex+n.childCount,e.query,[]),r=Mn(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(i=jo(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(i);const o=e.query.bindings;let s=!1;for(let a=0;a<o.length;a++){const t=o[a];let e;switch(t.bindingType){case 0:e=n.first;break;case 1:e=n,s=!0}r[t.propName]=e}s&&n.notifyOnChanges()}function jo(t,e,n,r,i){for(let o=e;o<=n;o++){const e=t.def.nodes[o],n=e.matchedQueries[r.id];if(null!=n&&i.push(qo(t,e,n)),1&e.flags&&e.element.template&&(e.element.template.nodeMatchedQueries&r.filterId)===r.filterId){const n=Nn(t,o);if((e.childMatchedQueries&r.filterId)===r.filterId&&(jo(t,o+1,o+e.childCount,r,i),o+=e.childCount),16777216&e.flags){const t=n.viewContainer._embeddedViews;for(let e=0;e<t.length;e++){const o=t[e],s=$n(o);s&&s===n&&jo(o,0,o.def.nodes.length-1,r,i)}}const s=n.template._projectedViews;if(s)for(let t=0;t<s.length;t++){const e=s[t];jo(e,0,e.def.nodes.length-1,r,i)}}(e.childMatchedQueries&r.filterId)!==r.filterId&&(o+=e.childCount)}return i}function qo(t,e,n){if(null!=n)switch(n){case 1:return Nn(t,e.nodeIndex).renderElement;case 0:return new Ye(Nn(t,e.nodeIndex).renderElement);case 2:return Nn(t,e.nodeIndex).template;case 3:return Nn(t,e.nodeIndex).viewContainer;case 4:return Mn(t,e.nodeIndex).instance}}function Go(t,e,n){const r=sr(t,e,n);r&&lr(t,n.ngContent.index,1,r,null,void 0)}function Ho(t,e){const n=Object.keys(e),r=n.length,i=new Array(r);for(let o=0;o<r;o++){const t=n[o];i[e[t]]=t}return function(t,e,n){const r=new Array(n.length);for(let i=0;i<n.length;i++){const t=n[i];r[i]={flags:8,name:t,ns:null,nonMinifiedName:t,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:64,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:r,bindingFlags:gr(r),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,t,i)}function zo(t,e,n){const r=new Array(n.length-1);for(let i=1;i<n.length;i++)r[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Wo(t,e,n){let r;const i=t.renderer;r=i.createText(n.text.prefix);const o=sr(t,e,n);return o&&i.appendChild(o,r),{renderText:r}}function Ko(t,e){return(null!=t?t.toString():"")+e.suffix}function Xo(t,e,n,r){let i=0,o=0,s=0,a=0,u=0,c=null,h=null,l=!1,d=!1,f=null;for(let p=0;p<e.length;p++){const t=e[p];if(t.nodeIndex=p,t.parent=c,t.bindingIndex=i,t.outputIndex=o,t.renderParent=h,s|=t.flags,u|=t.matchedQueryIds,t.element){const e=t.element;e.publicProviders=c?c.element.publicProviders:Object.create(null),e.allProviders=e.publicProviders,l=!1,d=!1,t.element.template&&(u|=t.element.template.nodeMatchedQueries)}if(Yo(c,t,e.length),i+=t.bindings.length,o+=t.outputs.length,!h&&3&t.flags&&(f=t),20224&t.flags){l||(l=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);const e=0!=(32768&t.flags);0==(8192&t.flags)||e?c.element.publicProviders[Vn(t.provider.token)]=t:(d||(d=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[Vn(t.provider.token)]=t),e&&(c.element.componentProvider=t)}if(c?(c.childFlags|=t.flags,c.directChildFlags|=t.flags,c.childMatchedQueries|=t.matchedQueryIds,t.element&&t.element.template&&(c.childMatchedQueries|=t.element.template.nodeMatchedQueries)):a|=t.flags,t.childCount>0)c=t,Qo(t)||(h=t);else for(;c&&p===c.nodeIndex+c.childCount;){const t=c.parent;t&&(t.childFlags|=c.childFlags,t.childMatchedQueries|=c.childMatchedQueries),h=(c=t)&&Qo(c)?c.renderParent:c}}return{factory:null,nodeFlags:s,rootNodeFlags:a,nodeMatchedQueries:u,flags:t,nodes:e,updateDirectives:n||Bn,updateRenderer:r||Bn,handleEvent:(t,n,r,i)=>e[n].element.handleEvent(t,r,i),bindingCount:i,outputCount:o,lastRenderRootNode:f}}function Qo(t){return 0!=(1&t.flags)&&null===t.element.name}function Yo(t,e,n){const r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error(`Illegal State: Last root node of a template can't have embedded views, at index ${e.nodeIndex}!`)}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error(`Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ${e.nodeIndex}!`);if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error(`Illegal State: Content Query nodes need to be children of directives, at index ${e.nodeIndex}!`);if(134217728&e.flags&&t)throw new Error(`Illegal State: View Query nodes have to be top level nodes, at index ${e.nodeIndex}!`)}if(e.childCount){const r=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=r&&e.nodeIndex+e.childCount>r)throw new Error(`Illegal State: childCount of node leads outside of parent, at index ${e.nodeIndex}!`)}}function Jo(t,e,n,r){const i=ts(t.root,t.renderer,t,e,n);return es(i,t.component,r),ns(i),i}function $o(t,e,n){const r=ts(t,t.renderer,null,null,e);return es(r,n,n),ns(r),r}function Zo(t,e,n,r){const i=e.element.componentRendererType;let o;return o=i?t.root.rendererFactory.createRenderer(r,i):t.root.renderer,ts(t.root,o,t,e.element.componentProvider,n)}function ts(t,e,n,r,i){const o=new Array(i.nodes.length),s=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:o,state:13,root:t,renderer:e,oldValues:new Array(i.bindingCount),disposables:s,initIndex:-1}}function es(t,e,n){t.component=e,t.context=n}function ns(t){let e;er(t)&&(e=Nn(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);const n=t.def,r=t.nodes;for(let i=0;i<n.nodes.length;i++){const o=n.nodes[i];let s;switch(Fn.setCurrentNode(t,i),201347067&o.flags){case 1:const n=Mo(t,e,o);let a=void 0;if(33554432&o.flags){const e=ur(o.element.componentView);a=Fn.createComponentView(t,o,e,n)}Ro(t,a,o,n),s={renderElement:n,componentView:a,viewContainer:null,template:o.element.template?Ur(t,o):void 0},16777216&o.flags&&(s.viewContainer=Rr(t,o,s));break;case 2:s=Wo(t,e,o);break;case 512:case 1024:case 2048:case 256:(s=r[i])||4096&o.flags||(s={instance:si(t,o)});break;case 16:s={instance:ai(t,o)};break;case 16384:(s=r[i])||(s={instance:ui(t,o)}),32768&o.flags&&es(Nn(t,o.parent.nodeIndex).componentView,s.instance,s.instance);break;case 32:case 64:case 128:s={value:void 0};break;case 67108864:case 134217728:s=new Ci;break;case 8:Go(t,e,o),s=void 0}r[i]=s}ls(t,hs.CreateViewNodes),ms(t,201326592,268435456,0)}function rs(t){ss(t),Fn.updateDirectives(t,1),ds(t,hs.CheckNoChanges),Fn.updateRenderer(t,1),ls(t,hs.CheckNoChanges),t.state&=-97}function is(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Dn(t,0,256),ss(t),Fn.updateDirectives(t,0),ds(t,hs.CheckAndUpdate),ms(t,67108864,536870912,0);let e=Dn(t,256,512);gi(t,2097152|(e?1048576:0)),Fn.updateRenderer(t,0),ls(t,hs.CheckAndUpdate),ms(t,134217728,536870912,0),gi(t,8388608|((e=Dn(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,Dn(t,768,1024)}function os(t,e,n,r,i,o,s,a,u,c,h,l,d){return 0===n?function(t,e,n,r,i,o,s,a,u,c,h,l){switch(201347067&e.flags){case 1:return function(t,e,n,r,i,o,s,a,u,c,h,l){const d=e.bindings.length;let f=!1;return d>0&&Fo(t,e,0,n)&&(f=!0),d>1&&Fo(t,e,1,r)&&(f=!0),d>2&&Fo(t,e,2,i)&&(f=!0),d>3&&Fo(t,e,3,o)&&(f=!0),d>4&&Fo(t,e,4,s)&&(f=!0),d>5&&Fo(t,e,5,a)&&(f=!0),d>6&&Fo(t,e,6,u)&&(f=!0),d>7&&Fo(t,e,7,c)&&(f=!0),d>8&&Fo(t,e,8,h)&&(f=!0),d>9&&Fo(t,e,9,l)&&(f=!0),f}(t,e,n,r,i,o,s,a,u,c,h,l);case 2:return function(t,e,n,r,i,o,s,a,u,c,h,l){let d=!1;const f=e.bindings,p=f.length;if(p>0&&Kn(t,e,0,n)&&(d=!0),p>1&&Kn(t,e,1,r)&&(d=!0),p>2&&Kn(t,e,2,i)&&(d=!0),p>3&&Kn(t,e,3,o)&&(d=!0),p>4&&Kn(t,e,4,s)&&(d=!0),p>5&&Kn(t,e,5,a)&&(d=!0),p>6&&Kn(t,e,6,u)&&(d=!0),p>7&&Kn(t,e,7,c)&&(d=!0),p>8&&Kn(t,e,8,h)&&(d=!0),p>9&&Kn(t,e,9,l)&&(d=!0),d){let d=e.text.prefix;p>0&&(d+=Ko(n,f[0])),p>1&&(d+=Ko(r,f[1])),p>2&&(d+=Ko(i,f[2])),p>3&&(d+=Ko(o,f[3])),p>4&&(d+=Ko(s,f[4])),p>5&&(d+=Ko(a,f[5])),p>6&&(d+=Ko(u,f[6])),p>7&&(d+=Ko(c,f[7])),p>8&&(d+=Ko(h,f[8])),p>9&&(d+=Ko(l,f[9]));const m=Pn(t,e.nodeIndex).renderText;t.renderer.setValue(m,d)}return d}(t,e,n,r,i,o,s,a,u,c,h,l);case 16384:return function(t,e,n,r,i,o,s,a,u,c,h,l){const d=Mn(t,e.nodeIndex),f=d.instance;let p=!1,m=void 0;const g=e.bindings.length;return g>0&&Wn(t,e,0,n)&&(p=!0,m=mi(t,d,e,0,n,m)),g>1&&Wn(t,e,1,r)&&(p=!0,m=mi(t,d,e,1,r,m)),g>2&&Wn(t,e,2,i)&&(p=!0,m=mi(t,d,e,2,i,m)),g>3&&Wn(t,e,3,o)&&(p=!0,m=mi(t,d,e,3,o,m)),g>4&&Wn(t,e,4,s)&&(p=!0,m=mi(t,d,e,4,s,m)),g>5&&Wn(t,e,5,a)&&(p=!0,m=mi(t,d,e,5,a,m)),g>6&&Wn(t,e,6,u)&&(p=!0,m=mi(t,d,e,6,u,m)),g>7&&Wn(t,e,7,c)&&(p=!0,m=mi(t,d,e,7,c,m)),g>8&&Wn(t,e,8,h)&&(p=!0,m=mi(t,d,e,8,h,m)),g>9&&Wn(t,e,9,l)&&(p=!0,m=mi(t,d,e,9,l,m)),m&&f.ngOnChanges(m),65536&e.flags&&kn(t,256,e.nodeIndex)&&f.ngOnInit(),262144&e.flags&&f.ngDoCheck(),p}(t,e,n,r,i,o,s,a,u,c,h,l);case 32:case 64:case 128:return function(t,e,n,r,i,o,s,a,u,c,h,l){const d=e.bindings;let f=!1;const p=d.length;if(p>0&&Kn(t,e,0,n)&&(f=!0),p>1&&Kn(t,e,1,r)&&(f=!0),p>2&&Kn(t,e,2,i)&&(f=!0),p>3&&Kn(t,e,3,o)&&(f=!0),p>4&&Kn(t,e,4,s)&&(f=!0),p>5&&Kn(t,e,5,a)&&(f=!0),p>6&&Kn(t,e,6,u)&&(f=!0),p>7&&Kn(t,e,7,c)&&(f=!0),p>8&&Kn(t,e,8,h)&&(f=!0),p>9&&Kn(t,e,9,l)&&(f=!0),f){const f=Rn(t,e.nodeIndex);let m;switch(201347067&e.flags){case 32:m=new Array(d.length),p>0&&(m[0]=n),p>1&&(m[1]=r),p>2&&(m[2]=i),p>3&&(m[3]=o),p>4&&(m[4]=s),p>5&&(m[5]=a),p>6&&(m[6]=u),p>7&&(m[7]=c),p>8&&(m[8]=h),p>9&&(m[9]=l);break;case 64:m={},p>0&&(m[d[0].name]=n),p>1&&(m[d[1].name]=r),p>2&&(m[d[2].name]=i),p>3&&(m[d[3].name]=o),p>4&&(m[d[4].name]=s),p>5&&(m[d[5].name]=a),p>6&&(m[d[6].name]=u),p>7&&(m[d[7].name]=c),p>8&&(m[d[8].name]=h),p>9&&(m[d[9].name]=l);break;case 128:const t=n;switch(p){case 1:m=t.transform(n);break;case 2:m=t.transform(r);break;case 3:m=t.transform(r,i);break;case 4:m=t.transform(r,i,o);break;case 5:m=t.transform(r,i,o,s);break;case 6:m=t.transform(r,i,o,s,a);break;case 7:m=t.transform(r,i,o,s,a,u);break;case 8:m=t.transform(r,i,o,s,a,u,c);break;case 9:m=t.transform(r,i,o,s,a,u,c,h);break;case 10:m=t.transform(r,i,o,s,a,u,c,h,l)}}f.value=m}return f}(t,e,n,r,i,o,s,a,u,c,h,l);default:throw"unreachable"}}(t,e,r,i,o,s,a,u,c,h,l,d):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){let r=!1;for(let i=0;i<n.length;i++)Fo(t,e,i,n[i])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){const r=e.bindings;let i=!1;for(let o=0;o<n.length;o++)Kn(t,e,o,n[o])&&(i=!0);if(i){let i="";for(let t=0;t<n.length;t++)i+=Ko(n[t],r[t]);i=e.text.prefix+i;const o=Pn(t,e.nodeIndex).renderText;t.renderer.setValue(o,i)}return i}(t,e,n);case 16384:return function(t,e,n){const r=Mn(t,e.nodeIndex),i=r.instance;let o=!1,s=void 0;for(let a=0;a<n.length;a++)Wn(t,e,a,n[a])&&(o=!0,s=mi(t,r,e,a,n[a],s));return s&&i.ngOnChanges(s),65536&e.flags&&kn(t,256,e.nodeIndex)&&i.ngOnInit(),262144&e.flags&&i.ngDoCheck(),o}(t,e,n);case 32:case 64:case 128:return function(t,e,n){const r=e.bindings;let i=!1;for(let o=0;o<n.length;o++)Kn(t,e,o,n[o])&&(i=!0);if(i){const i=Rn(t,e.nodeIndex);let o;switch(201347067&e.flags){case 32:o=n;break;case 64:o={};for(let e=0;e<n.length;e++)o[r[e].name]=n[e];break;case 128:const t=n[0],i=n.slice(1);o=t.transform(...i)}i.value=o}return i}(t,e,n);default:throw"unreachable"}}(t,e,r)}function ss(t){const e=t.def;if(4&e.nodeFlags)for(let n=0;n<e.nodes.length;n++){const r=e.nodes[n];if(4&r.flags){const e=Nn(t,n).template._projectedViews;if(e)for(let n=0;n<e.length;n++){const r=e[n];r.state|=32,Yn(r,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function as(t,e,n,r,i,o,s,a,u,c,h,l,d){return 0===n?function(t,e,n,r,i,o,s,a,u,c,h,l){const d=e.bindings.length;d>0&&Xn(t,e,0,n),d>1&&Xn(t,e,1,r),d>2&&Xn(t,e,2,i),d>3&&Xn(t,e,3,o),d>4&&Xn(t,e,4,s),d>5&&Xn(t,e,5,a),d>6&&Xn(t,e,6,u),d>7&&Xn(t,e,7,c),d>8&&Xn(t,e,8,h),d>9&&Xn(t,e,9,l)}(t,e,r,i,o,s,a,u,c,h,l,d):function(t,e,n){for(let r=0;r<n.length;r++)Xn(t,e,r,n[r])}(t,e,r),!1}function us(t,e){if(Ln(t,e.nodeIndex).dirty)throw An(Fn.createDebugContext(t,e.nodeIndex),`Query ${e.query.id} not dirty`,`Query ${e.query.id} dirty`,0!=(1&t.state))}function cs(t){if(!(128&t.state)){if(ds(t,hs.Destroy),ls(t,hs.Destroy),gi(t,131072),t.disposables)for(let e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(!(16&t.state))return;const e=$n(t);if(e){const n=e.template._projectedViews;n&&(Dr(n,n.indexOf(t)),Fn.dirtyParentQueries(t))}}(t),t.renderer.destroyNode&&function(t){const e=t.def.nodes.length;for(let n=0;n<e;n++){const e=t.def.nodes[n];1&e.flags?t.renderer.destroyNode(Nn(t,n).renderElement):2&e.flags?t.renderer.destroyNode(Pn(t,n).renderText):(67108864&e.flags||134217728&e.flags)&&Ln(t,n).destroy()}}(t),er(t)&&t.renderer.destroy(),t.state|=128}}const hs=function(){var t={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return t[t.CreateViewNodes]="CreateViewNodes",t[t.CheckNoChanges]="CheckNoChanges",t[t.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",t[t.Destroy]="Destroy",t}();function ls(t,e){const n=t.def;if(33554432&n.nodeFlags)for(let r=0;r<n.nodes.length;r++){const i=n.nodes[r];33554432&i.flags?fs(Nn(t,r).componentView,e):0==(33554432&i.childFlags)&&(r+=i.childCount)}}function ds(t,e){const n=t.def;if(16777216&n.nodeFlags)for(let r=0;r<n.nodes.length;r++){const i=n.nodes[r];if(16777216&i.flags){const n=Nn(t,r).viewContainer._embeddedViews;for(let t=0;t<n.length;t++)fs(n[t],e)}else 0==(16777216&i.childFlags)&&(r+=i.childCount)}}function fs(t,e){const n=t.state;switch(e){case hs.CheckNoChanges:0==(128&n)&&(12==(12&n)?rs(t):64&n&&ps(t,hs.CheckNoChangesProjectedViews));break;case hs.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?rs(t):64&n&&ps(t,e));break;case hs.CheckAndUpdate:0==(128&n)&&(12==(12&n)?is(t):64&n&&ps(t,hs.CheckAndUpdateProjectedViews));break;case hs.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?is(t):64&n&&ps(t,e));break;case hs.Destroy:cs(t);break;case hs.CreateViewNodes:ns(t)}}function ps(t,e){ds(t,e),ls(t,e)}function ms(t,e,n,r){if(!(t.def.nodeFlags&e&&t.def.nodeFlags&n))return;const i=t.def.nodes.length;for(let o=0;o<i;o++){const i=t.def.nodes[o];if(i.flags&e&&i.flags&n)switch(Fn.setCurrentNode(t,i.nodeIndex),r){case 0:Vo(t,i);break;case 1:us(t,i)}i.childFlags&e&&i.childFlags&n||(o+=i.childCount)}}let gs=!1;function ys(t,e,n,r,i,o){const s=i.injector.get(Ze);return $o(bs(t,i,s,e,n),r,o)}function vs(t,e,n,r,i,o){const s=i.injector.get(Ze),a=bs(t,i,new Js(s),e,n),u=Os(r);return Qs(Rs.create,$o,null,[a,u,o])}function bs(t,e,n,r,i){const o=e.injector.get(we),s=e.injector.get(Ce),a=n.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:i,sanitizer:o,rendererFactory:n,renderer:a,errorHandler:s}}function ws(t,e,n,r){const i=Os(n);return Qs(Rs.create,Jo,null,[t,e,i,r])}function _s(t,e,n,r){return n=Ss.get(e.element.componentProvider.provider.token)||Os(n),Qs(Rs.create,Zo,null,[t,e,n,r])}function Es(t,e,n,r){return Wr(t,e,n,function(t){const{hasOverrides:e,hasDeprecatedOverrides:n}=function(t){let e=!1,n=!1;return 0===Ts.size?{hasOverrides:e,hasDeprecatedOverrides:n}:(t.providers.forEach(t=>{const r=Ts.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)}),t.modules.forEach(t=>{xs.forEach((r,i)=>{ut(i).providedIn===t&&(e=!0,n=n||r.deprecatedBehavior)})}),{hasOverrides:e,hasDeprecatedOverrides:n})}(t);return e?(function(t){for(let e=0;e<t.providers.length;e++){const r=t.providers[e];n&&(r.flags|=4096);const i=Ts.get(r.token);i&&(r.flags=-3841&r.flags|i.flags,r.deps=or(i.deps),r.value=i.value)}if(xs.size>0){let e=new Set(t.modules);xs.forEach((r,i)=>{if(e.has(ut(i).providedIn)){let e={token:i,flags:r.flags|(n?4096:0),deps:or(r.deps),value:r.value,index:t.providers.length};t.providers.push(e),t.providersByKey[Vn(i)]=e}})}}(t=t.factory(()=>Bn)),t):t}(r))}const Ts=new Map,xs=new Map,Ss=new Map;function Cs(t){let e;Ts.set(t.token,t),"function"==typeof t.token&&(e=ut(t.token))&&"function"==typeof e.providedIn&&xs.set(t.token,t)}function As(t,e){const n=ur(e.viewDefFactory),r=ur(n.nodes[0].element.componentView);Ss.set(t,r)}function Is(){Ts.clear(),xs.clear(),Ss.clear()}function Os(t){if(0===Ts.size)return t;const e=function(t){const e=[];let n=null;for(let r=0;r<t.nodes.length;r++){const i=t.nodes[r];1&i.flags&&(n=i),n&&3840&i.flags&&Ts.has(i.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory(()=>Bn);for(let r=0;r<e.length;r++)n(t,e[r]);return t;function n(t,e){for(let n=e+1;n<t.nodes.length;n++){const e=t.nodes[n];if(1&e.flags)return;if(3840&e.flags){const t=e.provider,n=Ts.get(t.token);n&&(e.flags=-3841&e.flags|n.flags,t.deps=or(n.deps),t.value=n.value)}}}}function Ds(t,e,n,r,i,o,s,a,u,c,h,l,d){const f=t.def.nodes[e];return os(t,f,n,r,i,o,s,a,u,c,h,l,d),224&f.flags?Rn(t,e).value:void 0}function ks(t,e,n,r,i,o,s,a,u,c,h,l,d){const f=t.def.nodes[e];return as(t,f,n,r,i,o,s,a,u,c,h,l,d),224&f.flags?Rn(t,e).value:void 0}function Ps(t){return Qs(Rs.detectChanges,is,null,[t])}function Ns(t){return Qs(Rs.checkNoChanges,rs,null,[t])}function Ms(t){return Qs(Rs.destroy,cs,null,[t])}const Rs=function(){var t={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return t[t.create]="create",t[t.detectChanges]="detectChanges",t[t.checkNoChanges]="checkNoChanges",t[t.destroy]="destroy",t[t.handleEvent]="handleEvent",t}();let Ls,Fs,Bs;function Us(t,e){Fs=t,Bs=e}function Vs(t,e,n,r){return Us(t,e),Qs(Rs.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function js(t,e){if(128&t.state)throw On(Rs[Ls]);return Us(t,zs(t,0)),t.def.updateDirectives(function(t,n,r,...i){const o=t.def.nodes[n];return 0===e?Gs(t,o,r,i):Hs(t,o,r,i),16384&o.flags&&Us(t,zs(t,n)),224&o.flags?Rn(t,o.nodeIndex).value:void 0},t)}function qs(t,e){if(128&t.state)throw On(Rs[Ls]);return Us(t,Ws(t,0)),t.def.updateRenderer(function(t,n,r,...i){const o=t.def.nodes[n];return 0===e?Gs(t,o,r,i):Hs(t,o,r,i),3&o.flags&&Us(t,Ws(t,n)),224&o.flags?Rn(t,o.nodeIndex).value:void 0},t)}function Gs(t,e,n,r){if(os(t,e,n,...r)){const s=1===n?r[0]:r;if(16384&e.flags){const n={};for(let t=0;t<e.bindings.length;t++){const r=e.bindings[t],a=s[t];8&r.flags&&(n[(i=r.nonMinifiedName,o=void 0,o=i.replace(/[$@]/g,"_"),`ng-reflect-${i=o.replace(Ae,(...t)=>"-"+t[1].toLowerCase())}`)]=Ie(a))}const r=e.parent,a=Nn(t,r.nodeIndex).renderElement;if(r.element.name)for(let e in n){const r=n[e];null!=r?t.renderer.setAttribute(a,e,r):t.renderer.removeAttribute(a,e)}else t.renderer.setValue(a,`bindings=${JSON.stringify(n,null,2)}`)}}var i,o}function Hs(t,e,n,r){as(t,e,n,...r)}function zs(t,e){for(let n=e;n<t.def.nodes.length;n++){const e=t.def.nodes[n];if(16384&e.flags&&e.bindings&&e.bindings.length)return n}return null}function Ws(t,e){for(let n=e;n<t.def.nodes.length;n++){const e=t.def.nodes[n];if(3&e.flags&&e.bindings&&e.bindings.length)return n}return null}class Ks{constructor(t,e){this.view=t,this.nodeIndex=e,null==e&&(this.nodeIndex=e=0),this.nodeDef=t.def.nodes[e];let n=this.nodeDef,r=t;for(;n&&0==(1&n.flags);)n=n.parent;if(!n)for(;!n&&r;)n=Zn(r),r=r.parent;this.elDef=n,this.elView=r}get elOrCompView(){return Nn(this.elView,this.elDef.nodeIndex).componentView||this.view}get injector(){return jr(this.elView,this.elDef)}get component(){return this.elOrCompView.component}get context(){return this.elOrCompView.context}get providerTokens(){const t=[];if(this.elDef)for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t}get references(){const t={};if(this.elDef){Xs(this.elView,this.elDef,t);for(let e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){const n=this.elView.def.nodes[e];20224&n.flags&&Xs(this.elView,n,t),e+=n.childCount}}return t}get componentRenderElement(){const t=function(t){for(;t&&!er(t);)t=t.parent;return t.parent?Nn(t.parent,Zn(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0}get renderNode(){return 2&this.nodeDef.flags?tr(this.view,this.nodeDef):tr(this.elView,this.elDef)}logError(t,...e){let n,r;2&this.nodeDef.flags?(n=this.view.def,r=this.nodeDef.nodeIndex):(n=this.elView.def,r=this.elDef.nodeIndex);const i=function(t,e){let n=-1;for(let r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(n,r);let o=-1;n.factory(()=>++o===i?t.error.bind(t,...e):Bn),o<i&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error(...e))}}function Xs(t,e,n){for(let r in e.references)n[r]=qo(t,e,e.references[r])}function Qs(t,e,n,r){const i=Ls,o=Fs,s=Bs;try{Ls=t;const u=e.apply(n,r);return Fs=o,Bs=s,Ls=i,u}catch(a){if(Te(a)||!Fs)throw a;throw function(t,e){return t instanceof Error||(t=new Error(t.toString())),In(t,e),t}(a,Ys())}}function Ys(){return Fs?new Ks(Fs,Bs):null}class Js{constructor(t){this.delegate=t}createRenderer(t,e){return new $s(this.delegate.createRenderer(t,e))}begin(){this.delegate.begin&&this.delegate.begin()}end(){this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}class $s{constructor(t){this.delegate=t,this.debugContextFactory=Ys,this.data=this.delegate.data}createDebugContext(t){return this.debugContextFactory(t)}destroyNode(t){!function(t){To.delete(t.nativeNode)}(xo(t)),this.delegate.destroyNode&&this.delegate.destroyNode(t)}destroy(){this.delegate.destroy()}createElement(t,e){const n=this.delegate.createElement(t,e),r=this.createDebugContext(n);if(r){const e=new Eo(n,null,r);e.name=t,So(e)}return n}createComment(t){const e=this.delegate.createComment(t),n=this.createDebugContext(e);return n&&So(new _o(e,null,n)),e}createText(t){const e=this.delegate.createText(t),n=this.createDebugContext(e);return n&&So(new _o(e,null,n)),e}appendChild(t,e){const n=xo(t),r=xo(e);n&&r&&n instanceof Eo&&n.addChild(r),this.delegate.appendChild(t,e)}insertBefore(t,e,n){const r=xo(t),i=xo(e),o=xo(n);r&&i&&r instanceof Eo&&r.insertBefore(o,i),this.delegate.insertBefore(t,e,n)}removeChild(t,e){const n=xo(t),r=xo(e);n&&r&&n instanceof Eo&&n.removeChild(r),this.delegate.removeChild(t,e)}selectRootElement(t,e){const n=this.delegate.selectRootElement(t,e),r=Ys();return r&&So(new Eo(n,null,r)),n}setAttribute(t,e,n,r){const i=xo(t);i&&i instanceof Eo&&(i.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)}removeAttribute(t,e,n){const r=xo(t);r&&r instanceof Eo&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)}addClass(t,e){const n=xo(t);n&&n instanceof Eo&&(n.classes[e]=!0),this.delegate.addClass(t,e)}removeClass(t,e){const n=xo(t);n&&n instanceof Eo&&(n.classes[e]=!1),this.delegate.removeClass(t,e)}setStyle(t,e,n,r){const i=xo(t);i&&i instanceof Eo&&(i.styles[e]=n),this.delegate.setStyle(t,e,n,r)}removeStyle(t,e,n){const r=xo(t);r&&r instanceof Eo&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)}setProperty(t,e,n){const r=xo(t);r&&r instanceof Eo&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)}listen(t,e,n){if("string"!=typeof t){const r=xo(t);r&&r.listeners.push(new wo(e,n))}return this.delegate.listen(t,e,n)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setValue(t,e){return this.delegate.setValue(t,e)}}function Zs(t,e,n){return new ta(t,e,n)}class ta extends Xe{constructor(t,e,n){super(),this.moduleType=t,this._bootstrapComponents=e,this._ngModuleDefFactory=n}create(t){!function(){if(gs)return;gs=!0;const t=Jt()?{setCurrentNode:Us,createRootView:vs,createEmbeddedView:ws,createComponentView:_s,createNgModuleRef:Es,overrideProvider:Cs,overrideComponentView:As,clearOverrides:Is,checkAndUpdateView:Ps,checkNoChangesView:Ns,destroyView:Ms,createDebugContext:(t,e)=>new Ks(t,e),handleEvent:Vs,updateDirectives:js,updateRenderer:qs}:{setCurrentNode:()=>{},createRootView:ys,createEmbeddedView:Jo,createComponentView:Zo,createNgModuleRef:Wr,overrideProvider:Bn,overrideComponentView:Bn,clearOverrides:Bn,checkAndUpdateView:is,checkNoChangesView:rs,destroyView:cs,createDebugContext:(t,e)=>new Ks(t,e),handleEvent:(t,e,n,r)=>t.def.handleEvent(t,e,n,r),updateDirectives:(t,e)=>t.def.updateDirectives(0===e?Ds:ks,t),updateRenderer:(t,e)=>t.def.updateRenderer(0===e?Ds:ks,t)};Fn.setCurrentNode=t.setCurrentNode,Fn.createRootView=t.createRootView,Fn.createEmbeddedView=t.createEmbeddedView,Fn.createComponentView=t.createComponentView,Fn.createNgModuleRef=t.createNgModuleRef,Fn.overrideProvider=t.overrideProvider,Fn.overrideComponentView=t.overrideComponentView,Fn.clearOverrides=t.clearOverrides,Fn.checkAndUpdateView=t.checkAndUpdateView,Fn.checkNoChangesView=t.checkNoChangesView,Fn.destroyView=t.destroyView,Fn.resolveDep=fi,Fn.createDebugContext=t.createDebugContext,Fn.handleEvent=t.handleEvent,Fn.updateDirectives=t.updateDirectives,Fn.updateRenderer=t.updateRenderer,Fn.dirtyParentQueries=Uo}();const e=function(t){const e=Array.from(t.providers),n=Array.from(t.modules),r={};for(const i in t.providersByKey)r[i]=t.providersByKey[i];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:n,providersByKey:r}}(ur(this._ngModuleDefFactory));return Fn.createNgModuleRef(this.moduleType,t||Rt.NULL,this._bootstrapComponents,e)}}const ea={production:!0,rewardVideoId:"ca-app-pub-7811559275890870/3956102909"};class na{}var ra=n("mrSG"),ia=function(t){return t[t.MAP_EDITOR=0]="MAP_EDITOR",t[t.GAME=1]="GAME",t[t.START_MENU=2]="START_MENU",t[t.AI_TRANSFER=3]="AI_TRANSFER",t}({});class oa{initConfig(t,e){if(window.admob)return window.admob[e].load(t)}interstitial(t=this.interstitialConfig){return ra.__awaiter(this,void 0,void 0,function*(){return yield this.initConfig(t,"interstitial"),this._interstitial()})}_interstitial(){return new Promise((t,e)=>{document.addEventListener("admob.interstitial.close",()=>{t()},!1),document.addEventListener("admob.interstitial.load_fail",()=>{e(new Error("Interstitial load fail."))},!1),window.admob.interstitial.show()})}rewardVideo(t=this.rewardVideoConfig){return ra.__awaiter(this,void 0,void 0,function*(){return yield this.initConfig(t,"rewardVideo"),this._rewardVideo()})}_rewardVideo(){return new Promise((t,e)=>{let n=!1;document.addEventListener("admob.reward_video.close",()=>{t(n)},!1),document.addEventListener("admob.reward_video.load_fail",()=>{e(new Error("Reward video load failed."))},!1),document.addEventListener("admob.reward_video.reward",()=>{n=!0},!1),window.admob.rewardVideo.show()})}}class sa{constructor(){this.AppRate=window.AppRate,this.AppRate&&(this.AppRate.preferences.storeAppURL={android:"https://play.google.com/store/apps/details?id=com.laCosaNostra.tanks"})}prompt(){this.AppRate&&this.AppRate.promptForRating()}}class aa{constructor(t,e,n){this.elRef=n,this.View=ia,this.opened=ia.START_MENU,t.rewardVideoConfig={id:{android:ea.rewardVideoId}},e.prompt()}ngOnInit(){const t=Number(window.sessionStorage.getItem("opened"));!ea.production&&t&&this.open(t)}open(t){return ra.__awaiter(this,void 0,void 0,function*(){window.sessionStorage.setItem("opened",String(t)),t===ia.GAME&&(yield function(t,e=window.document){return ra.__awaiter(this,void 0,void 0,function*(){yield t.requestFullscreen(),yield window.screen.orientation.lock("landscape")})}(this.elRef.nativeElement).catch(t=>(console.error(t),Promise.resolve()))),this.opened===ia.GAME&&(yield function(t){return ra.__awaiter(this,void 0,void 0,function*(){yield t.exitFullscreen()})}(document).catch(t=>(console.error(t),Promise.resolve()))),this.opened=t})}}class ua{}const ca=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),ha=new bt("UseV4Plurals");class la{}let da=(()=>(class extends la{constructor(t,e){super(),this.locale=t,this.deprecatedPluralFn=e}getPluralCategory(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){const e=t.toLowerCase().replace(/_/g,"-");let n=wi[e];if(n)return n;const r=e.split("-")[0];if(n=wi[r])return n;if("en"===r)return Ei;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[_i.PluralCase]}(e||this.locale)(t)){case ca.Zero:return"zero";case ca.One:return"one";case ca.Two:return"two";case ca.Few:return"few";case ca.Many:return"many";default:return"other"}}}))();function fa(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const t=n.indexOf("="),[r,i]=-1==t?[n,""]:[n.slice(0,t),n.slice(t+1)];if(r.trim()===e)return decodeURIComponent(i)}return null}class pa{}let ma=(()=>(class{constructor(t,e,n,r){this._iterableDiffers=t,this._keyValueDiffers=e,this._ngEl=n,this._renderer=r,this._initialClasses=[]}getValue(){return null}setClass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}setNgClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Me(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}applyChanges(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachChangedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachRemovedItem(t=>{t.previousValue&&this._toggleClass(t.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(t=>{if("string"!=typeof t.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${ht(t.item)}`);this._toggleClass(t.item,!0)}),t.forEachRemovedItem(t=>this._toggleClass(t.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!0)):Object.keys(t).forEach(e=>this._toggleClass(e,!!t[e])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!1)):Object.keys(t).forEach(t=>this._toggleClass(t,!1)))}_toggleClass(t,e){(t=t.trim())&&t.split(/\s+/g).forEach(t=>{e?this._renderer.addClass(this._ngEl.nativeElement,t):this._renderer.removeClass(this._ngEl.nativeElement,t)})}}))(),ga=(()=>{class t{constructor(t){this._delegate=t}getValue(){return this._delegate.getValue()}}return t.ngDirectiveDef=void 0,t})(),ya=(()=>(class extends ga{constructor(t){super(t)}set klass(t){this._delegate.setClass(t)}set ngClass(t){this._delegate.setNgClass(t)}ngDoCheck(){this._delegate.applyChanges()}}))();class va{constructor(t,e,n,r){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let ba=(()=>(class{constructor(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){Jt()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn(`trackBy must be a function, but received ${JSON.stringify(t)}. `+"See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;if(!this._differ&&n)try{this._differ=this._differs.find(n).create(this.ngForTrackBy)}catch(e){throw new Error(`Cannot find a differ supporting object '${n}' of type '${t=n,t.name||typeof t}'. NgFor only supports binding to Iterables such as Arrays.`)}}var t;if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,n,r)=>{if(null==t.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new va(null,this._ngForOf,-1,-1),r),i=new wa(t,n);e.push(i)}else if(null==r)this._viewContainer.remove(n);else{const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const o=new wa(t,i);e.push(o)}});for(let n=0;n<e.length;n++)this._perViewChange(e[n].view,e[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const t=this._viewContainer.get(n);t.context.index=n,t.context.count=r,t.context.ngForOf=this._ngForOf}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}static ngTemplateContextGuard(t,e){return!0}}))();class wa{constructor(t,e){this.record=t,this.view=e}}let _a=(()=>(class{constructor(t,e){this._viewContainer=t,this._context=new Ea,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Ta("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Ta("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}}))();class Ea{constructor(){this.$implicit=null,this.ngIf=null}}function Ta(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${ht(e)}'.`)}class xa{}let Sa=(()=>(class{constructor(t,e,n){this._ngEl=t,this._differs=e,this._renderer=n}getValue(){return null}setNgStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}applyChanges(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_applyChanges(t){t.forEachRemovedItem(t=>this._setStyle(t.key,null)),t.forEachAddedItem(t=>this._setStyle(t.key,t.currentValue)),t.forEachChangedItem(t=>this._setStyle(t.key,t.currentValue))}_setStyle(t,e){const[n,r]=t.split(".");null!=(e=null!=e&&r?`${e}${r}`:e)?this._renderer.setStyle(this._ngEl.nativeElement,n,e):this._renderer.removeStyle(this._ngEl.nativeElement,n)}}))(),Ca=(()=>{class t{constructor(t){this._delegate=t}getValue(){return this._delegate.getValue()}}return t.ngDirectiveDef=void 0,t})(),Aa=(()=>(class extends Ca{constructor(t){super(t)}set ngStyle(t){this._delegate.setNgStyle(t)}ngDoCheck(){this._delegate.applyChanges()}}))(),Ia=(()=>(class{transform(t){return JSON.stringify(t,null,2)}}))(),Oa=(()=>(class{constructor(t){this.differs=t,this.keyValues=[]}transform(t,e=function(t,e){const n=t.key,r=e.key;if(n===r)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(null===n)return 1;if(null===r)return-1;if("string"==typeof n&&"string"==typeof r)return n<r?-1:1;if("number"==typeof n&&"number"==typeof r)return n-r;if("boolean"==typeof n&&"boolean"==typeof r)return n<r?-1:1;const i=String(n),o=String(r);return i==o?0:i<o?-1:1}){if(!t||!(t instanceof Map)&&"object"!=typeof t)return null;this.differ||(this.differ=this.differs.find(t).create());const n=this.differ.diff(t);return n&&(this.keyValues=[],n.forEachItem(t=>{this.keyValues.push(function(e,n){return{key:t.key,value:t.currentValue}}())}),this.keyValues.sort(e)),this.keyValues}}))(),Da=(()=>(class{}))();const ka=new bt("DocumentToken");class Pa{constructor(){this.View=ia,this.production=ea.production,this.open=new xi}}var Na=Hn({encapsulation:0,styles:[['@import url(https://fonts.googleapis.com/css?family=VT323);.menu[_ngcontent-%COMP%]{background:#000;width:100vw;height:100vh}.menu[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block;font-family:VT323,monospace;background:0 0;border:none;color:red;font-size:54px;cursor:pointer;outline:0}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]::before{content:"- "}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover::before{content:"> "}']],data:{}});function Ma(t){return Xo(0,[(t()(),No(0,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.MAP_EDITOR)&&r),r},null,null)),(t()(),zo(-1,null,["Level editor"]))],null,null)}function Ra(t){return Xo(0,[(t()(),No(0,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.AI_TRANSFER)&&r),r},null,null)),(t()(),zo(-1,null,["AI Transfer"]))],null,null)}function La(t){return Xo(0,[(t()(),No(0,0,null,null,7,"div",[["class","menu"]],null,null,null,null,null)),(t()(),No(1,0,null,null,6,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),No(2,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.GAME)&&r),r},null,null)),(t()(),zo(-1,null,["Play!"])),(t()(),Po(16777216,null,null,1,null,Ma)),ni(5,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null),(t()(),Po(16777216,null,null,1,null,Ra)),ni(7,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null)],function(t,e){var n=e.component;t(e,5,0,!n.production),t(e,7,0,!n.production)},null)}let Fa=null;function Ba(){return Fa}class Ua{constructor(){this.resourceLoaderType=null}get attrToPropMap(){return this._attrToPropMap}set attrToPropMap(t){this._attrToPropMap=t}}class Va extends Ua{constructor(){super(),this._animationPrefix=null,this._transitionEnd=null;try{const e=this.createElement("div",document);if(null!=this.getStyle(e,"animationName"))this._animationPrefix="";else{const t=["Webkit","Moz","O","ms"];for(let n=0;n<t.length;n++)if(null!=this.getStyle(e,t[n]+"AnimationName")){this._animationPrefix="-"+t[n].toLowerCase()+"-";break}}const n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(n).forEach(t=>{null!=this.getStyle(e,t)&&(this._transitionEnd=n[t])})}catch(t){this._animationPrefix=null,this._transitionEnd=null}}getDistributedNodes(t){return t.getDistributedNodes()}resolveAndSetHref(t,e,n){t.href=null==n?e:e+"/../"+n}supportsDOMEvents(){return!0}supportsNativeShadowDOM(){return"function"==typeof document.body.createShadowRoot}getAnimationPrefix(){return this._animationPrefix?this._animationPrefix:""}getTransitionEnd(){return this._transitionEnd?this._transitionEnd:""}supportsAnimation(){return null!=this._animationPrefix&&null!=this._transitionEnd}}const ja={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},qa=3,Ga={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ha={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},za=(()=>{if(vt.Node)return vt.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))}})();class Wa extends Va{parse(t){throw new Error("parse not implemented")}static makeCurrent(){var t;t=new Wa,Fa||(Fa=t)}hasProperty(t,e){return e in t}setProperty(t,e,n){t[e]=n}getProperty(t,e){return t[e]}invoke(t,e,n){t[e](...n)}logError(t){window.console&&(console.error?console.error(t):console.log(t))}log(t){window.console&&window.console.log&&window.console.log(t)}logGroup(t){window.console&&window.console.group&&window.console.group(t)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}get attrToPropMap(){return ja}contains(t,e){return za.call(t,e)}querySelector(t,e){return t.querySelector(e)}querySelectorAll(t,e){return t.querySelectorAll(e)}on(t,e,n){t.addEventListener(e,n,!1)}onAndCancel(t,e,n){return t.addEventListener(e,n,!1),()=>{t.removeEventListener(e,n,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}createMouseEvent(t){const e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e}createEvent(t){const e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e}preventDefault(t){t.preventDefault(),t.returnValue=!1}isPrevented(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue}getInnerHTML(t){return t.innerHTML}getTemplateContent(t){return"content"in t&&this.isTemplateElement(t)?t.content:null}getOuterHTML(t){return t.outerHTML}nodeName(t){return t.nodeName}nodeValue(t){return t.nodeValue}type(t){return t.type}content(t){return this.hasProperty(t,"content")?t.content:t}firstChild(t){return t.firstChild}nextSibling(t){return t.nextSibling}parentElement(t){return t.parentNode}childNodes(t){return t.childNodes}childNodesAsList(t){const e=t.childNodes,n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r];return n}clearNodes(t){for(;t.firstChild;)t.removeChild(t.firstChild)}appendChild(t,e){t.appendChild(e)}removeChild(t,e){t.removeChild(e)}replaceChild(t,e,n){t.replaceChild(e,n)}remove(t){return t.parentNode&&t.parentNode.removeChild(t),t}insertBefore(t,e,n){t.insertBefore(n,e)}insertAllBefore(t,e,n){n.forEach(n=>t.insertBefore(n,e))}insertAfter(t,e,n){t.insertBefore(n,e.nextSibling)}setInnerHTML(t,e){t.innerHTML=e}getText(t){return t.textContent}setText(t,e){t.textContent=e}getValue(t){return t.value}setValue(t,e){t.value=e}getChecked(t){return t.checked}setChecked(t,e){t.checked=e}createComment(t){return this.getDefaultDocument().createComment(t)}createTemplate(t){const e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createElementNS(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)}createTextNode(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)}createScriptTag(t,e,n){const r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r}createStyleElement(t,e){const n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n}createShadowRoot(t){return t.createShadowRoot()}getShadowRoot(t){return t.shadowRoot}getHost(t){return t.host}clone(t){return t.cloneNode(!0)}getElementsByClassName(t,e){return t.getElementsByClassName(e)}getElementsByTagName(t,e){return t.getElementsByTagName(e)}classList(t){return Array.prototype.slice.call(t.classList,0)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}hasClass(t,e){return t.classList.contains(e)}setStyle(t,e,n){t.style[e]=n}removeStyle(t,e){t.style[e]=""}getStyle(t,e){return t.style[e]}hasStyle(t,e,n){const r=this.getStyle(t,e)||"";return n?r==n:r.length>0}tagName(t){return t.tagName}attributeMap(t){const e=new Map,n=t.attributes;for(let r=0;r<n.length;r++){const t=n.item(r);e.set(t.name,t.value)}return e}hasAttribute(t,e){return t.hasAttribute(e)}hasAttributeNS(t,e,n){return t.hasAttributeNS(e,n)}getAttribute(t,e){return t.getAttribute(e)}getAttributeNS(t,e,n){return t.getAttributeNS(e,n)}setAttribute(t,e,n){t.setAttribute(e,n)}setAttributeNS(t,e,n,r){t.setAttributeNS(e,n,r)}removeAttribute(t,e){t.removeAttribute(e)}removeAttributeNS(t,e,n){t.removeAttributeNS(e,n)}templateAwareRoot(t){return this.isTemplateElement(t)?this.content(t):t}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}getBoundingClientRect(t){try{return t.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}getTitle(t){return t.title}setTitle(t,e){t.title=e||""}elementMatches(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))}isTemplateElement(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName}isTextNode(t){return t.nodeType===Node.TEXT_NODE}isCommentNode(t){return t.nodeType===Node.COMMENT_NODE}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}hasShadowRoot(t){return null!=t.shadowRoot&&t instanceof HTMLElement}isShadowRoot(t){return t instanceof DocumentFragment}importIntoDoc(t){return document.importNode(this.templateAwareRoot(t),!0)}adoptNode(t){return document.adoptNode(t)}getHref(t){return t.getAttribute("href")}getEventKey(t){let e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),t.location===qa&&Ha.hasOwnProperty(e)&&(e=Ha[e]))}return Ga[e]||e}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=Xa||(Xa=document.querySelector("base"))?Xa.getAttribute("href"):null;return null==e?null:(n=e,Ka||(Ka=document.createElement("a")),Ka.setAttribute("href",n),"/"===Ka.pathname.charAt(0)?Ka.pathname:"/"+Ka.pathname);var n}resetBaseElement(){Xa=null}getUserAgent(){return window.navigator.userAgent}setData(t,e,n){this.setAttribute(t,"data-"+e,n)}getData(t,e){return this.getAttribute(t,"data-"+e)}getComputedStyle(t){return getComputedStyle(t)}supportsWebAnimation(){return"function"==typeof Element.prototype.animate}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return fa(document.cookie,t)}setCookie(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)}}let Ka,Xa=null;function Qa(){return!!window.history.pushState}let Ya=(()=>{class t extends ua{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=Ba().getLocation(),this._history=Ba().getHistory()}getBaseHrefFromDOM(){return Ba().getBaseHref(this._doc)}onPopState(t){Ba().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}onHashChange(t){Ba().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,n){Qa()?this._history.pushState(t,e,n):this.location.hash=n}replaceState(t,e,n){Qa()?this._history.replaceState(t,e,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return t.ctorParameters=()=>[{type:void 0,decorators:[{type:et,args:[ka]}]}],t})();const Ja=new bt("TRANSITION_ID"),$a=[{provide:Ai,useFactory:function(t,e,n){return()=>{n.get(Ii).donePromise.then(()=>{const n=Ba();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter(e=>n.getAttribute(e,"ng-transition")===t).forEach(t=>n.remove(t))})}},deps:[Ja,ka,Rt],multi:!0}];class Za{static init(){var t;t=new Za,co=t}addToWindow(t){vt.getAngularTestability=(e,n=!0)=>{const r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},vt.getAllAngularTestabilities=()=>t.getAllTestabilities(),vt.getAllAngularRootElements=()=>t.getAllRootElements(),vt.frameworkStabilizers||(vt.frameworkStabilizers=[]),vt.frameworkStabilizers.push(t=>{const e=vt.getAllAngularTestabilities();let n=e.length,r=!1;const i=function(e){r=r||e,0==--n&&t(r)};e.forEach(function(t){t.whenStable(i)})})}findTestabilityInTree(t,e,n){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:n?Ba().isShadowRoot(e)?this.findTestabilityInTree(t,Ba().getHost(e),!0):this.findTestabilityInTree(t,Ba().parentElement(e),!0):null}}function tu(t,e){"undefined"!=typeof COMPILED&&COMPILED||((vt.ng=vt.ng||{})[t]=e)}const eu=(()=>({ApplicationRef:vo,NgZone:$i}))();function nu(t){return xo(t)}const ru=new bt("EventManagerPlugins");let iu=(()=>(class{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)}addGlobalEventListener(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const n=this._plugins;for(let r=0;r<n.length;r++){const e=n[r];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error(`No event manager plugin found for event ${t}`)}}))();class ou{constructor(t){this._doc=t}addGlobalEventListener(t,e,n){const r=Ba().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,n)}}let su=(()=>(class{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}))(),au=(()=>(class extends su{constructor(t){super(),this._doc=t,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(t.head)}_addStylesToHost(t,e){t.forEach(t=>{const n=this._doc.createElement("style");n.textContent=t,this._styleNodes.add(e.appendChild(n))})}addHost(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)}removeHost(t){this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach(e=>this._addStylesToHost(t,e))}ngOnDestroy(){this._styleNodes.forEach(t=>Ba().remove(t))}}))();const uu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},cu=/%COMP%/g,hu="_nghost-%COMP%",lu="_ngcontent-%COMP%";function du(t,e,n){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?du(t,i,n):(i=i.replace(cu,t),n.push(i))}return n}function fu(t){return e=>{!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let pu=(()=>(class{constructor(t,e,n){this.eventManager=t,this.sharedStylesHost=e,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new mu(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case Kt.Emulated:{let n=this.rendererByCompId.get(e.id);return n||(n=new vu(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n}case Kt.Native:case Kt.ShadowDom:return new bu(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=du(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}))();class mu{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(uu[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,n){t&&t.insertBefore(e,n)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`The selector "${t}" did not match any elements`);return e||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,n,r){if(r){e=r+":"+e;const i=uu[r];i?t.setAttributeNS(i,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}removeAttribute(t,e,n){if(n){const r=uu[n];r?t.removeAttributeNS(r,e):t.removeAttribute(`${n}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,n,r){r&tn.DashCase?t.style.setProperty(e,n,r&tn.Important?"important":""):t.style[e]=n}removeStyle(t,e,n){n&tn.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,n){yu(e,"property"),t[e]=n}setValue(t,e){t.nodeValue=e}listen(t,e,n){return yu(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,fu(n)):this.eventManager.addEventListener(t,e,fu(n))}}const gu=(()=>"@".charCodeAt(0))();function yu(t,e){if(t.charCodeAt(0)===gu)throw new Error(`Found the synthetic ${e} ${t}. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.`)}class vu extends mu{constructor(t,e,n,r){super(t),this.component=n;const i=du(r+"-"+n.id,n.styles,[]);e.addStyles(i),this.contentAttr=lu.replace(cu,r+"-"+n.id),this.hostAttr=hu.replace(cu,r+"-"+n.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const n=super.createElement(t,e);return super.setAttribute(n,this.contentAttr,""),n}}class bu extends mu{constructor(t,e,n,r){super(t),this.sharedStylesHost=e,this.hostEl=n,this.component=r,this.shadowRoot=r.encapsulation===Kt.ShadowDom?n.attachShadow({mode:"open"}):n.createShadowRoot(),this.sharedStylesHost.addHost(this.shadowRoot);const i=du(r.id,r.styles,[]);for(let o=0;o<i.length;o++){const t=document.createElement("style");t.textContent=i[o],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,n){return super.insertBefore(this.nodeOrShadowRoot(t),e,n)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}const wu=(()=>"undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t})(),_u=wu("addEventListener"),Eu=wu("removeEventListener"),Tu={},xu="__zone_symbol__propagationStopped",Su=(()=>{const t="undefined"!=typeof Zone&&Zone[wu("BLACK_LISTED_EVENTS")];if(t){const e={};return t.forEach(t=>{e[t]=t}),e}})(),Cu=function(t){return!!Su&&Su.hasOwnProperty(t)},Au=function(t){const e=Tu[t.type];if(!e)return;const n=this[e];if(!n)return;const r=[t];if(1===n.length){const t=n[0];return t.zone!==Zone.current?t.zone.run(t.handler,this,r):t.handler.apply(this,r)}{const e=n.slice();for(let n=0;n<e.length&&!0!==t[xu];n++){const t=e[n];t.zone!==Zone.current?t.zone.run(t.handler,this,r):t.handler.apply(this,r)}}};let Iu=(()=>(class extends ou{constructor(t,e,n){super(t),this.ngZone=e,n&&function(t){return"server"===t}(n)||this.patchEvent()}patchEvent(){if("undefined"==typeof Event||!Event||!Event.prototype)return;if(Event.prototype.__zone_symbol__stopImmediatePropagation)return;const t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[xu]=!0),t&&t.apply(this,arguments)}}supports(t){return!0}addEventListener(t,e,n){let r=n;if(!t[_u]||$i.isInAngularZone()&&!Cu(e))t.addEventListener(e,r,!1);else{let n=Tu[e];n||(n=Tu[e]=wu("ANGULAR"+e+"FALSE"));let i=t[n];const o=i&&i.length>0;i||(i=t[n]=[]);const s=Cu(e)?Zone.root:Zone.current;if(0===i.length)i.push({zone:s,handler:r});else{let t=!1;for(let e=0;e<i.length;e++)if(i[e].handler===r){t=!0;break}t||i.push({zone:s,handler:r})}o||t[_u](e,Au,!1)}return()=>this.removeEventListener(t,e,r)}removeEventListener(t,e,n){let r=t[Eu];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);let i=Tu[e],o=i&&t[i];if(!o)return t.removeEventListener.apply(t,[e,n,!1]);let s=!1;for(let a=0;a<o.length;a++)if(o[a].handler===n){s=!0,o.splice(a,1);break}s?0===o.length&&r.apply(t,[e,Au,!1]):t.removeEventListener.apply(t,[e,n,!1])}}))();const Ou={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Du=new bt("HammerGestureConfig"),ku=new bt("HammerLoader");let Pu=(()=>(class{constructor(){this.events=[],this.overrides={}}buildHammer(t){const e=new Hammer(t,this.options);e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0});for(const n in this.overrides)e.get(n).set(this.overrides[n]);return e}}))(),Nu=(()=>(class extends ou{constructor(t,e,n,r){super(t),this._config=e,this.console=n,this.loader=r}supports(t){return!(!Ou.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn(`The "${t}" event cannot be bound because Hammer.JS is not `+"loaded and no custom loader has been specified."),1))}addEventListener(t,e,n){const r=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){let r=!1,i=()=>{r=!0};return this.loader().then(()=>{if(!window.Hammer)return this.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(i=()=>{});r||(i=this.addEventListener(t,e,n))}).catch(()=>{this.console.warn(`The "${e}" event cannot be bound because the custom `+"Hammer.JS loader failed."),i=()=>{}}),()=>{i()}}return r.runOutsideAngular(()=>{const i=this._config.buildHammer(t),o=function(t){r.runGuarded(function(){n(t)})};return i.on(e,o),()=>{i.off(e,o),"function"==typeof i.destroy&&i.destroy()}})}isCustomEvent(t){return this._config.events.indexOf(t)>-1}}))();const Mu=["alt","control","meta","shift"],Ru={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let Lu=(()=>{class t extends ou{constructor(t){super(t)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,n,r){const i=t.parseEventName(n),o=t.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ba().onAndCancel(e,i.domEventName,o))}static parseEventName(e){const n=e.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=t._normalizeKey(n.pop());let o="";if(Mu.forEach(t=>{const e=n.indexOf(t);e>-1&&(n.splice(e,1),o+=t+".")}),o+=i,0!=n.length||0===i.length)return null;const s={};return s.domEventName=r,s.fullKey=o,s}static getEventFullKey(t){let e="",n=Ba().getEventKey(t);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Mu.forEach(r=>{r!=n&&(0,Ru[r])(t)&&(e+=r+".")}),e+=n}static eventCallback(e,n,r){return i=>{t.getEventFullKey(i)===e&&r.runGuarded(()=>n(i))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return t})();class Fu{}let Bu=(()=>(class extends Fu{constructor(t){super(),this._doc=t}sanitize(t,e){if(null==e)return null;switch(t){case be.NONE:return e;case be.HTML:return e instanceof Vu?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){let n=null;try{ye=ye||new $t(t);let r=e?String(e):"";n=ye.getInertBodyElement(r);let i=5,o=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=o,o=n.innerHTML,n=ye.getInertBodyElement(r)}while(r!==o);const s=new fe,a=s.sanitizeChildren(ve(n)||n);return Jt()&&s.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),a}finally{if(n){const t=ve(n)||n;for(;t.firstChild;)t.removeChild(t.firstChild)}}}(this._doc,String(e)));case be.STYLE:return e instanceof ju?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";const e=t.match(Ee);return e&&ee(e[1])===e[1]||t.match(_e)&&function(t){let e=!0,n=!0;for(let r=0;r<t.length;r++){const i=t.charAt(r);"'"===i&&n?e=!e:'"'===i&&e&&(n=!n)}return e&&n}(t)?t:(Jt()&&console.warn(`WARNING: sanitizing unsafe style value ${t} (see http://g.co/ng/security#xss).`),"unsafe")}(e));case be.SCRIPT:if(e instanceof qu)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case be.URL:return e instanceof Hu||e instanceof Gu?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),ee(String(e)));case be.RESOURCE_URL:if(e instanceof Hu)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${t} (see http://g.co/ng/security#xss)`)}}checkNotSafeValue(t,e){if(t instanceof Uu)throw new Error(`Required a safe ${e}, got a ${t.getTypeName()} `+"(see http://g.co/ng/security#xss)")}bypassSecurityTrustHtml(t){return new Vu(t)}bypassSecurityTrustStyle(t){return new ju(t)}bypassSecurityTrustScript(t){return new qu(t)}bypassSecurityTrustUrl(t){return new Gu(t)}bypassSecurityTrustResourceUrl(t){return new Hu(t)}}))();class Uu{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity}`+" (see http://g.co/ng/security#xss)"}}class Vu extends Uu{getTypeName(){return"HTML"}}class ju extends Uu{getTypeName(){return"Style"}}class qu extends Uu{getTypeName(){return"Script"}}class Gu extends Uu{getTypeName(){return"URL"}}class Hu extends Uu{getTypeName(){return"ResourceURL"}}const zu=po(Co,"browser",[{provide:Ni,useValue:"browser"},{provide:Pi,useValue:function(){Wa.makeCurrent(),Za.init()},multi:!0},{provide:ua,useClass:Ya,deps:[ka]},{provide:ka,useFactory:function(){return document},deps:[]}]);function Wu(){return new Ce}let Ku=(()=>{class t{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:Oi,useValue:e.appId},{provide:Ja,useExisting:Oi},$a]}}}return t})();function Xu(t,e){return new v(n=>{const r=t.length;if(0===r)return void n.complete();const i=new Array(r);let o=0,s=0;for(let a=0;a<r;a++){const u=V(t[a]);let c=!1;n.add(u.subscribe({next:t=>{c||(c=!0,s++),i[a]=t},error:t=>n.error(t),complete:()=>{++o!==r&&c||(s===r&&n.next(e?e.reduce((t,e,n)=>(t[e]=i[n],t),{}):i),n.complete())}}))}})}"undefined"!=typeof window&&window;const Qu=new bt("NgValueAccessor");let Yu=(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"checked",t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}))();const Ju=new bt("CompositionEventMode");let $u=(()=>(class{constructor(t,e,n){this._renderer=t,this._elementRef=e,this._compositionMode=n,this.onChange=t=>{},this.onTouched=()=>{},this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=Ba()?Ba().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}))();class Zu{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}class tc extends Zu{get formDirective(){return null}get path(){return null}}function ec(){throw new Error("unimplemented")}class nc extends Zu{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null,this._rawValidators=[],this._rawAsyncValidators=[]}get validator(){return ec()}get asyncValidator(){return ec()}}let rc=(()=>(class extends class{constructor(t){this._cd=t}get ngClassUntouched(){return!!this._cd.control&&this._cd.control.untouched}get ngClassTouched(){return!!this._cd.control&&this._cd.control.touched}get ngClassPristine(){return!!this._cd.control&&this._cd.control.pristine}get ngClassDirty(){return!!this._cd.control&&this._cd.control.dirty}get ngClassValid(){return!!this._cd.control&&this._cd.control.valid}get ngClassInvalid(){return!!this._cd.control&&this._cd.control.invalid}get ngClassPending(){return!!this._cd.control&&this._cd.control.pending}}{constructor(t){super(t)}}))();function ic(t){return null==t||0===t.length}const oc=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+\/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/;class sc{static min(t){return e=>{if(ic(e.value)||ic(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null}}static max(t){return e=>{if(ic(e.value)||ic(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null}}static required(t){return ic(t.value)?{required:!0}:null}static requiredTrue(t){return!0===t.value?null:{required:!0}}static email(t){return ic(t.value)?null:oc.test(t.value)?null:{email:!0}}static minLength(t){return e=>{if(ic(e.value))return null;const n=e.value?e.value.length:0;return n<t?{minlength:{requiredLength:t,actualLength:n}}:null}}static maxLength(t){return e=>{const n=e.value?e.value.length:0;return n>t?{maxlength:{requiredLength:t,actualLength:n}}:null}}static pattern(t){if(!t)return sc.nullValidator;let e,n;return"string"==typeof t?(n="","^"!==t.charAt(0)&&(n+="^"),n+=t,"$"!==t.charAt(t.length-1)&&(n+="$"),e=new RegExp(n)):(n=t.toString(),e=t),t=>{if(ic(t.value))return null;const r=t.value;return e.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}static nullValidator(t){return null}static compose(t){if(!t)return null;const e=t.filter(ac);return 0==e.length?null:function(t){return cc(function(t,n){return e.map(e=>e(t))}(t))}}static composeAsync(t){if(!t)return null;const e=t.filter(ac);return 0==e.length?null:function(t){return function(...t){if(1===t.length){const e=t[0];if(u(e))return Xu(e,null);if(c(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return Xu(t.map(t=>e[t]),t)}}if("function"==typeof t[t.length-1]){const e=t.pop();return Xu(t=1===t.length&&u(t[0])?t[0]:t,null).pipe(L(t=>e(...t)))}return Xu(t,null)}(function(t,n){return e.map(e=>e(t))}(t).map(uc)).pipe(L(cc))}}}function ac(t){return null!=t}function uc(t){const e=Le(t)?V(t):t;if(!Fe(e))throw new Error("Expected validator to return Promise or Observable.");return e}function cc(t){const e=t.reduce((t,e)=>null!=e?Object.assign({},t,e):t,{});return 0===Object.keys(e).length?null:e}function hc(t){return t.validate?e=>t.validate(e):t}function lc(t){return t.validate?e=>t.validate(e):t}let dc=(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}))(),fc=(()=>(class{constructor(){this._accessors=[]}add(t,e){this._accessors.push([t,e])}remove(t){for(let e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)}select(t){this._accessors.forEach(e=>{this._isSameGroup(e,t)&&e[1]!==t&&e[1].fireUncheck(t.value)})}_isSameGroup(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}))(),pc=(()=>(class{constructor(t,e,n,r){this._renderer=t,this._elementRef=e,this._registry=n,this._injector=r,this.onChange=()=>{},this.onTouched=()=>{}}ngOnInit(){this._control=this._injector.get(nc),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}fireUncheck(t){this.writeValue(t)}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_checkName(){this.name&&this.formControlName&&this.name!==this.formControlName&&this._throwNameError(),!this.name&&this.formControlName&&(this.name=this.formControlName)}_throwNameError(){throw new Error('\n      If you define both a name and a formControlName attribute on your radio button, their values\n      must match. Ex: <input type="radio" formControlName="food" name="food">\n    ')}}))();const mc={formControlName:'\n    <div [formGroup]="myGroup">\n      <input formControlName="firstName">\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       firstName: new FormControl()\n    });',formGroupName:'\n    <div [formGroup]="myGroup">\n       <div formGroupName="person">\n          <input formControlName="firstName">\n       </div>\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       person: new FormGroup({ firstName: new FormControl() })\n    });',formArrayName:'\n    <div [formGroup]="myGroup">\n      <div formArrayName="cities">\n        <div *ngFor="let city of cityArray.controls; index as i">\n          <input [formControlName]="i">\n        </div>\n      </div>\n    </div>\n\n    In your class:\n\n    this.cityArray = new FormArray([new FormControl(\'SF\')]);\n    this.myGroup = new FormGroup({\n      cities: this.cityArray\n    });',ngModelGroup:'\n    <form>\n       <div ngModelGroup="person">\n          <input [(ngModel)]="person.name" name="firstName">\n       </div>\n    </form>',ngModelWithFormGroup:'\n    <div [formGroup]="myGroup">\n       <input formControlName="firstName">\n       <input [(ngModel)]="showMoreControls" [ngModelOptions]="{standalone: true}">\n    </div>\n  '};function gc(t,e){return[...e.path,t]}function yc(t,e){t||bc(e,"Cannot find control with"),e.valueAccessor||bc(e,"No value accessor for form control with"),t.validator=sc.compose([t.validator,e.validator]),t.asyncValidator=sc.composeAsync([t.asyncValidator,e.asyncValidator]),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&vc(t,e)})}(t,e),function(t,e){t.registerOnChange((t,n)=>{e.valueAccessor.writeValue(t),n&&e.viewToModelUpdate(t)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&vc(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),e.valueAccessor.setDisabledState&&t.registerOnDisabledChange(t=>{e.valueAccessor.setDisabledState(t)}),e._rawValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())}),e._rawAsyncValidators.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(()=>t.updateValueAndValidity())})}function vc(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function bc(t,e){let n;throw n=t.path.length>1?`path: '${t.path.join(" -> ")}'`:t.path[0]?`name: '${t.path}'`:"unspecified name attribute",new Error(`${e} ${n}`)}function wc(t){return null!=t?sc.compose(t.map(hc)):null}function _c(t){return null!=t?sc.composeAsync(t.map(lc)):null}const Ec=[Yu,(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(t))}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}))(),dc,(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=ke}set compareWith(t){if("function"!=typeof t)throw new Error(`compareWith must be a function, but received ${JSON.stringify(t)}`);this._compareWith=t}writeValue(t){this.value=t;const e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const n=function(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",n)}registerOnChange(t){this.onChange=e=>{this.value=this._getOptionValue(e),t(this.value)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e),t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}}))(),(()=>(class{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=ke}set compareWith(t){if("function"!=typeof t)throw new Error(`compareWith must be a function, but received ${JSON.stringify(t)}`);this._compareWith=t}writeValue(t){let e;if(this.value=t,Array.isArray(t)){const n=t.map(t=>this._getOptionId(t));e=(t,e)=>{t._setSelected(n.indexOf(e.toString())>-1)}}else e=(t,e)=>{t._setSelected(!1)};this._optionMap.forEach(e)}registerOnChange(t){this.onChange=e=>{const n=[];if(e.hasOwnProperty("selectedOptions")){const t=e.selectedOptions;for(let e=0;e<t.length;e++){const r=t.item(e),i=this._getOptionValue(r.value);n.push(i)}}else{const t=e.options;for(let e=0;e<t.length;e++){const r=t.item(e);if(r.selected){const t=this._getOptionValue(r.value);n.push(t)}}}this.value=n,t(n)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(t){const e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e)._value,t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}}))(),pc],Tc="VALID",xc="INVALID",Sc="PENDING",Cc="DISABLED";function Ac(t){const e=Oc(t)?t.validators:t;return Array.isArray(e)?wc(e):e||null}function Ic(t,e){const n=Oc(e)?e.asyncValidators:t;return Array.isArray(n)?_c(n):n||null}function Oc(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class Dc{constructor(t,e){this.validator=t,this.asyncValidator=e,this._onCollectionChange=()=>{},this.pristine=!0,this.touched=!1,this._onDisabledChange=[]}get parent(){return this._parent}get valid(){return this.status===Tc}get invalid(){return this.status===xc}get pending(){return this.status==Sc}get disabled(){return this.status===Cc}get enabled(){return this.status!==Cc}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this.validator=Ac(t)}setAsyncValidators(t){this.asyncValidator=Ic(t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=Sc,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Cc,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign({},t,{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign({},t,{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=Tc,this._forEachChild(e=>{e.enable(Object.assign({},t,{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign({},t,{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==Tc&&this.status!==Sc||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Cc:Tc}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=Sc;const e=uc(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>this.setErrors(e,{emitEvent:t}))}}_cancelExistingSubscription(){this._asyncValidationSubscription&&this._asyncValidationSubscription.unsubscribe()}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,n){return null==e?null:(e instanceof Array||(e=e.split(".")),e instanceof Array&&0===e.length?null:e.reduce((t,e)=>t instanceof Pc?t.controls.hasOwnProperty(e)?t.controls[e]:null:t instanceof Nc&&t.at(e)||null,t))}(this,t)}getError(t,e){const n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new xi,this.statusChanges=new xi}_calculateStatus(){return this._allControlsDisabled()?Cc:this.errors?xc:this._anyControlsHaveStatus(Sc)?Sc:this._anyControlsHaveStatus(xc)?xc:Tc}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Oc(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&this._parent&&this._parent.dirty&&!this._parent._anyControlsDirty()}}class kc extends Dc{constructor(t=null,e,n){super(Ac(e),Ic(n,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),this._initObservables()}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_clearChangeFns(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=()=>{}}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class Pc extends Dc{constructor(t,e,n){super(Ac(e),Ic(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){Object.keys(t).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t={},e={}){this._forEachChild((n,r)=>{n.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,n)=>(t[n]=e instanceof kc?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>t(this.controls[e],e))}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){let e=!1;return this._forEachChild((n,r)=>{e=e||this.contains(r)&&t(n)}),e}_reduceValue(){return this._reduceChildren({},(t,e,n)=>((e.enabled||this.disabled)&&(t[n]=e.value),t))}_reduceChildren(t,e){let n=t;return this._forEachChild((t,r)=>{n=e(n,t,r)}),n}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class Nc extends Dc{constructor(t,e,n){super(Ac(e),Ic(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!1})}at(t){return this.controls[t]}push(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}insert(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}removeAt(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t.forEach((t,n)=>{this.at(n)&&this.at(n).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}reset(t=[],e={}){this._forEachChild((n,r)=>{n.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t instanceof kc?t.value:t.getRawValue())}clear(){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity())}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error(`Cannot find form control at index ${t}`)}_forEachChild(t){this.controls.forEach((e,n)=>{t(e,n)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const Mc=(()=>Promise.resolve(null))();let Rc=(()=>(class extends tc{constructor(t,e){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new xi,this.form=new Pc({},wc(t),_c(e))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Mc.then(()=>{const e=this._findContainer(t.path);t.control=e.registerControl(t.name,t.control),yc(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Mc.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name),function(e,n){const r=e.indexOf(t);r>-1&&e.splice(r,1)}(this._directives)})}addFormGroup(t){Mc.then(()=>{const e=this._findContainer(t.path),n=new Pc({});(function(t,e){null==t&&bc(e,"Cannot find control with"),t.validator=sc.compose([t.validator,e.validator]),t.asyncValidator=sc.composeAsync([t.asyncValidator,e.asyncValidator])})(n,t),e.registerControl(t.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Mc.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,e){Mc.then(()=>{this.form.get(t.path).setValue(e)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,e=this._directives,this.form._syncPendingControls(),e.forEach(t=>{const e=t.control;"submit"===e.updateOn&&e._pendingChange&&(t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1)}),this.ngSubmit.emit(t),!1;var e}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}))();class Lc{static modelParentException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroup directive.  Try using\n      formGroup's partner directive "formControlName" instead.  Example:\n\n      ${mc.formControlName}\n\n      Or, if you'd like to avoid registering this form control, indicate that it's standalone in ngModelOptions:\n\n      Example:\n\n      ${mc.ngModelWithFormGroup}`)}static formGroupNameException(){throw new Error(`\n      ngModel cannot be used to register form controls with a parent formGroupName or formArrayName directive.\n\n      Option 1: Use formControlName instead of ngModel (reactive strategy):\n\n      ${mc.formGroupName}\n\n      Option 2:  Update ngModel's parent be ngModelGroup (template-driven strategy):\n\n      ${mc.ngModelGroup}`)}static missingNameException(){throw new Error('If ngModel is used within a form tag, either the name attribute must be set or the form\n      control must be defined as \'standalone\' in ngModelOptions.\n\n      Example 1: <input [(ngModel)]="person.firstName" name="first">\n      Example 2: <input [(ngModel)]="person.firstName" [ngModelOptions]="{standalone: true}">')}static modelGroupParentException(){throw new Error(`\n      ngModelGroup cannot be used with a parent formGroup directive.\n\n      Option 1: Use formGroupName instead of ngModelGroup (reactive strategy):\n\n      ${mc.formGroupName}\n\n      Option 2:  Use a regular form tag instead of the formGroup directive (template-driven strategy):\n\n      ${mc.ngModelGroup}`)}static ngFormWarning(){console.warn("\n    It looks like you're using 'ngForm'.\n\n    Support for using the 'ngForm' element selector has been deprecated in Angular v6 and will be removed\n    in Angular v9.\n\n    Use 'ng-form' instead.\n\n    Before:\n    <ngForm #myForm=\"ngForm\">\n\n    After:\n    <ng-form #myForm=\"ngForm\">\n    ")}}const Fc=new bt("NgFormSelectorWarning");class Bc extends tc{ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return gc(this.name,this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return wc(this._validators)}get asyncValidator(){return _c(this._asyncValidators)}_checkParentType(){}}let Uc=(()=>{class t extends Bc{constructor(t,e,n){super(),this._parent=t,this._validators=e,this._asyncValidators=n}_checkParentType(){this._parent instanceof t||this._parent instanceof Rc||Lc.modelGroupParentException()}}return t})();const Vc=(()=>Promise.resolve(null))();let jc=(()=>(class extends nc{constructor(t,e,n,r){super(),this.control=new kc,this._registered=!1,this.update=new xi,this._parent=t,this._rawValidators=e||[],this._rawAsyncValidators=n||[],this.valueAccessor=function(t,e){if(!e)return null;Array.isArray(e)||bc(t,"Value accessor was not provided as an array for form control with");let n=void 0,r=void 0,i=void 0;return e.forEach(e=>{e.constructor===$u?n=e:function(t){return Ec.some(e=>t.constructor===e)}(e)?(r&&bc(t,"More than one built-in value accessor matches form control with"),r=e):(i&&bc(t,"More than one custom value accessor matches form control with"),i=e)}),i||r||n||(bc(t,"No valid value accessor for form control with"),null)}(this,r)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!ke(e,n.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?gc(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}get validator(){return wc(this._rawValidators)}get asyncValidator(){return _c(this._rawAsyncValidators)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){yc(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){!(this._parent instanceof Uc)&&this._parent instanceof Bc?Lc.formGroupNameException():this._parent instanceof Uc||this._parent instanceof Rc||Lc.modelParentException()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()||this.name||Lc.missingNameException()}_updateValue(t){Vc.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const e=t.isDisabled.currentValue,n=""===e||e&&"false"!==e;Vc.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}))(),qc=(()=>(class{}))(),Gc=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Fc,useValue:e.warnOnDeprecatedNgFormSelector}]}}}return t})();var Hc=function(t){return t.Delete="delete",t.Brick1="brick1",t.Brick2="brick2",t.Steel="steel",t.Tree="tree",t.Water="water",t.Blockade="blockade",t.Eagle="eagle",t.PlayerSpawn="player-spawn",t.EnemySpawn="enemy-spawn",t.Tank="tank",t.Tank3="tank3",t.Bullet="bullet",t.Explosion="explosion",t.EmptySpace="empty-space",t}({});function zc(t){return{width:t.clientWidth,height:t.clientHeight}}class Wc{constructor(t){this.elementRef=t,this.Block=Hc,this.blockTypes=Object.values(Hc),this.current=Hc.Brick1,this.selected=new xi,this.object=new xi}ngAfterViewInit(){this.blockTypes.forEach(t=>{const e=this.elementRef.nativeElement.querySelector(`.${t}`),{width:n,height:r}=zc(e);console.log(t,n,r),this.object.emit({type:t,width:n,height:r})});const t=this.elementRef.nativeElement.querySelector(".selected"),{width:e,height:n}=zc(t);this.selected.emit({type:this.current,width:e,height:n})}select(t,e){this.current=e;const{width:n,height:r}=zc(t.target);this.selected.emit({type:e,width:n,height:r})}}var Kc=Hn({encapsulation:0,styles:[[".objects[_ngcontent-%COMP%]{display:block}.objects[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;position:relative;margin:5px}.objects[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{border:3px solid brown;margin:2px}.objects[_ngcontent-%COMP%]   .bullet[_ngcontent-%COMP%], .objects[_ngcontent-%COMP%]   .explosion[_ngcontent-%COMP%], .objects[_ngcontent-%COMP%]   .tank[_ngcontent-%COMP%], .objects[_ngcontent-%COMP%]   .tank3[_ngcontent-%COMP%]{visibility:hidden}"]],data:{}});function Xc(t){return Xo(0,[(t()(),No(0,0,null,null,0,"div",[],[[8,"className",0],[2,"selected",null]],[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.select(n,t.context.$implicit)&&r),r},null,null))],null,function(t,e){var n=e.component;t(e,0,0,yr(1,"block ",e.context.$implicit,""),n.current===e.context.$implicit)})}function Qc(t){return Xo(0,[(t()(),No(0,0,null,null,2,"div",[["class","objects"]],null,null,null,null,null)),(t()(),Po(16777216,null,null,1,null,Xc)),ni(2,278528,null,0,ba,[Sn,Tn,gn],{ngForOf:[0,"ngForOf"]},null)],function(t,e){t(e,2,0,e.component.blockTypes)},null)}n("6Joi");var Yc=n("wj3C"),Jc=n.n(Yc);(function(){var t,e=e||{},n=this;function r(t){return"string"==typeof t}function i(t){return"boolean"==typeof t}var o=/^[\w+\/_-]+[=]{0,2}$/,s=null;function a(){}function u(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function c(t){return null===t}function h(t){return"array"==u(t)}function l(t){var e=u(t);return"array"==e||"object"==e&&"number"==typeof t.length}function d(t){return"function"==u(t)}function f(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var p="closure_uid_"+(1e9*Math.random()>>>0),m=0;function g(t,e,n){return t.call.apply(t.bind,arguments)}function y(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:y).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var w=Date.now||function(){return+new Date};function _(t,e){function n(){}n.prototype=e.prototype,t.pb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function E(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(e){return!1}}function T(t){if(Error.captureStackTrace)Error.captureStackTrace(this,T);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function x(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");T.call(this,n+t[r])}function S(t,e){throw new x("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function C(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function A(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function I(){this.b=this.a=null}_(T,Error),T.prototype.name="CustomError",_(x,T),x.prototype.name="AssertionError",C.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new C(function(){return new k},function(t){t.reset()});function D(){var t=ft,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function k(){this.next=this.b=this.a=null}I.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},k.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},k.prototype.reset=function(){this.next=this.b=this.a=null};var P=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(r(t))return r(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},N=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var i=t.length,o=r(t)?t.split(""):t,s=0;s<i;s++)s in o&&e.call(n,o[s],s,t)},M=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),o=r(t)?t.split(""):t,s=0;s<n;s++)s in o&&(i[s]=e.call(void 0,o[s],s,t));return i},R=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t))return!0;return!1};function L(t,e){return 0<=P(t,e)}function F(t,e){var n;return(n=0<=(e=P(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(t,e){!function(t,e){for(var n=r(t)?t.split(""):t,i=t.length-1;0<=i;--i)i in n&&e.call(void 0,n[i],i,t)}(t,function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1)})}function U(t){return Array.prototype.concat.apply([],arguments)}function V(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}var j,q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},G=/&/g,H=/</g,z=/>/g,W=/"/g,K=/'/g,X=/\x00/g,Q=/[\x00&<>"']/;function Y(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:t>e?1:0}t:{var $=n.navigator;if($){var Z=$.userAgent;if(Z){j=Z;break t}}j=""}function tt(t){return Y(j,t)}function et(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function nt(t){for(var e in t)return!1;return!0}function rt(t){var e,n={};for(e in t)n[e]=t[e];return n}var it,ot,st="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<st.length;o++)n=st[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ut(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function ct(t){return Q.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(G,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(H,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(z,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(W,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(K,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(X,"&#0;"))),t}function ht(t){n.setTimeout(function(){throw t},0)}function lt(t,e){ot||function(){if(n.Promise&&n.Promise.resolve){var t=n.Promise.resolve(void 0);ot=function(){t.then(pt)}}else ot=function(){var t=pt;!d(n.setImmediate)||n.Window&&n.Window.prototype&&!tt("Edge")&&n.Window.prototype.setImmediate==n.setImmediate?(it||(it=function(){var t=n.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!tt("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=v(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!tt("Trident")&&!tt("MSIE")){var e=new t,r={},i=r;return e.port1.onmessage=function(){if(void 0!==r.next){var t=(r=r.next).xb;r.xb=null,t()}},function(t){i.next={xb:t},i=i.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){n.setTimeout(t,0)}}()),it(t)):n.setImmediate(t)}}(),dt||(ot(),dt=!0),ft.add(t,e)}var dt=!1,ft=new I;function pt(){for(var t;t=D();){try{t.a.call(t.b)}catch(e){ht(e)}A(O,t)}dt=!1}function mt(t,e){if(this.a=gt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=a)try{var n=this;t.call(e,function(t){It(n,yt,t)},function(t){if(!(t instanceof Rt))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(e){}It(n,vt,t)})}catch(r){It(this,vt,r)}}var gt=0,yt=2,vt=3;function bt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}bt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var wt=new C(function(){return new bt},function(t){t.reset()});function _t(t,e,n){var r=wt.get();return r.g=t,r.b=e,r.f=n,r}function Et(t){if(t instanceof mt)return t;var e=new mt(a);return It(e,yt,t),e}function Tt(t){return new mt(function(e,n){n(t)})}function xt(t,e,n){Ot(t,e,n,null)||lt(b(e,t))}function St(t){return new mt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Eb:!0,value:o}:{Eb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)xt(t[o],b(i,o,!0),b(i,o,!1));else e(r)})}function Ct(t,e){t.b||t.a!=yt&&t.a!=vt||Dt(t),t.f?t.f.next=e:t.b=e,t.f=e}function At(t,e,n,r){var i=_t(null,null,null);return i.a=new mt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(s){o(s)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof Rt?o(e):t(i)}catch(s){o(s)}}:o}),i.a.c=t,Ct(t,i),i.a}function It(t,e,n){t.a==gt&&(t===n&&(e=vt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,Ot(n,t.Pc,t.Qc,t)||(t.i=n,t.a=e,t.c=null,Dt(t),e!=vt||n instanceof Rt||function(t,e){t.g=!0,lt(function(){t.g&&Mt.call(null,e)})}(t,n)))}function Ot(t,e,n,r){if(t instanceof mt)return Ct(t,_t(e||a,n||null,r)),!0;if(E(t))return t.then(e,n,r),!0;if(f(t))try{var i=t.then;if(d(i))return function(t,e,n,r,i){function o(t){s||(s=!0,r.call(i,t))}var s=!1;try{e.call(t,function(t){s||(s=!0,n.call(i,t))},o)}catch(a){o(a)}}(t,i,e,n,r),!0}catch(o){return n.call(r,o),!0}return!1}function Dt(t){t.h||(t.h=!0,lt(t.Yb,t))}function kt(t){var e=null;return t.b&&(t.b=(e=t.b).next,e.next=null),t.b||(t.f=null),e}function Pt(t,e,n,r){if(n==vt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Nt(e,n,r);else try{e.c?e.g.call(e.f):Nt(e,n,r)}catch(i){Mt.call(null,i)}A(wt,e)}function Nt(t,e,n){e==yt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}mt.prototype.then=function(t,e,n){return At(this,d(t)?t:null,d(e)?e:null,n)},mt.prototype.$goog_Thenable=!0,(t=mt.prototype).ia=function(t,e){return(t=_t(t,t,e)).c=!0,Ct(this,t),this},t.s=function(t,e){return At(this,null,t,e)},t.cancel=function(t){this.a==gt&&lt(function(){!function t(e,n){if(e.a==gt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,s=null,a=r.b;a&&(a.c||(i++,a.a==e&&(o=a),!(o&&1<i)));a=a.next)o||(s=a);o&&(r.a==gt&&1==i?t(r,n):(s?((i=s).next==r.f&&(r.f=i),i.next=i.next.next):kt(r),Pt(r,o,vt,n)))}e.c=null}else It(e,vt,n)}(this,new Rt(t))},this)},t.Pc=function(t){this.a=gt,It(this,yt,t)},t.Qc=function(t){this.a=gt,It(this,vt,t)},t.Yb=function(){for(var t;t=kt(this);)Pt(this,t,this.a,this.i);this.h=!1};var Mt=ht;function Rt(t){T.call(this,t)}function Lt(){0!=Ft&&(Bt[this[p]||(this[p]=++m)]=this),this.qa=this.qa,this.ja=this.ja}_(Rt,T),Rt.prototype.name="cancel";var Ft=0,Bt={};function Ut(t){if(!t.qa&&(t.qa=!0,t.va(),0!=Ft)){var e=t[p]||(t[p]=++m);if(0!=Ft&&t.ja&&0<t.ja.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Bt[e]}}function Vt(t){return Vt[" "](t),t}Lt.prototype.qa=!1,Lt.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},Vt[" "]=a;var jt,qt,Gt=tt("Opera"),Ht=tt("Trident")||tt("MSIE"),zt=tt("Edge"),Wt=zt||Ht,Kt=tt("Gecko")&&!(Y(j.toLowerCase(),"webkit")&&!tt("Edge"))&&!(tt("Trident")||tt("MSIE"))&&!tt("Edge"),Xt=Y(j.toLowerCase(),"webkit")&&!tt("Edge");function Qt(){var t=n.document;return t?t.documentMode:void 0}t:{var Yt="",Jt=(qt=j,Kt?/rv:([^\);]+)(\)|;)/.exec(qt):zt?/Edge\/([\d\.]+)/.exec(qt):Ht?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(qt):Xt?/WebKit\/(\S+)/.exec(qt):Gt?/(?:Version)[ \/]?(\S+)/.exec(qt):void 0);if(Jt&&(Yt=Jt?Jt[1]:""),Ht){var $t=Qt();if(null!=$t&&$t>parseFloat(Yt)){jt=String($t);break t}}jt=Yt}var Zt,te={};function ee(t){return function(t,e){var n=te;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=q(String(jt)).split("."),r=q(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=J(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||J(0==s[2].length,0==a[2].length)||J(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var ne=n.document;Zt=ne&&Ht?Qt()||("CSS1Compat"==ne.compatMode?parseInt(jt,10):5):void 0;var re=Object.freeze||function(t){return t},ie=!Ht||9<=Number(Zt),oe=Ht&&!ee("9"),se=function(){if(!n.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{n.addEventListener("test",a,e),n.removeEventListener("test",a,e)}catch(r){}return t}();function ae(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function ue(t,e){if(ae.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Kt){t:{try{Vt(e.nodeName);var o=!0;break t}catch(s){}o=!1}o||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=r(t.pointerType)?t.pointerType:ce[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}ae.prototype.preventDefault=function(){this.Kb=!1},_(ue,ae);var ce=re({2:"touch",3:"pen",4:"mouse"});ue.prototype.preventDefault=function(){ue.pb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,oe)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}},ue.prototype.f=function(){return this.a};var he="closure_listenable_"+(1e6*Math.random()|0),le=0;function de(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ma=i,this.key=++le,this.oa=this.Ia=!1}function fe(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Ma=null}function pe(t){this.src=t,this.a={},this.b=0}function me(t,e){var n=e.type;n in t.a&&F(t.a[n],e)&&(fe(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function ge(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Ma==r)return i}return-1}pe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=ge(t,e,r,i);return-1<s?(e=t[s],n||(e.Ia=!1)):((e=new de(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var ye="closure_lm_"+(1e6*Math.random()|0),ve={};function be(t,e,n,r,i){if(r&&r.once)_e(t,e,n,r,i);else if(h(e))for(var o=0;o<e.length;o++)be(t,e[o],n,r,i);else n=De(n),t&&t[he]?Pe(t,e,n,f(r)?!!r.capture:!!r,i):we(t,e,n,!1,r,i)}function we(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=f(i)?!!i.capture:!!i,a=Ie(t);if(a||(t[ye]=a=new pe(t)),!(n=a.add(e,n,r,s,o)).proxy)if(r=function(){var t=Ae,e=ie?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)se||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(xe(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function _e(t,e,n,r,i){if(h(e))for(var o=0;o<e.length;o++)_e(t,e[o],n,r,i);else n=De(n),t&&t[he]?Ne(t,e,n,f(r)?!!r.capture:!!r,i):we(t,e,n,!0,r,i)}function Ee(t,e,n,r,i){if(h(e))for(var o=0;o<e.length;o++)Ee(t,e[o],n,r,i);else r=f(r)?!!r.capture:!!r,n=De(n),t&&t[he]?(t=t.o,(e=String(e).toString())in t.a&&-1<(n=ge(o=t.a[e],n,r,i))&&(fe(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Ie(t))&&(e=t.a[e.toString()],t=-1,e&&(t=ge(e,n,r,i)),(n=-1<t?e[t]:null)&&Te(n))}function Te(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[he])me(e.o,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(xe(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ie(e))?(me(n,t),0==n.b&&(n.src=null,e[ye]=null)):fe(t)}}}function xe(t){return t in ve?ve[t]:ve[t]="on"+t}function Se(t,e,n,r){var i=!0;if((t=Ie(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Ce(o,r),i=i&&!1!==o)}return i}function Ce(t,e){var n=t.listener,r=t.Ma||t.src;return t.Ia&&Te(t),n.call(r,e)}function Ae(t,e){if(t.oa)return!0;if(!ie){if(!e)t:{e=["window","event"];for(var r=n,i=0;i<e.length;i++)if(null==(r=r[e[i]])){e=null;break t}e=r}if(e=new ue(i=e,this),r=!0,!(0>i.keyCode||null!=i.returnValue)){t:{var o=!1;if(0==i.keyCode)try{i.keyCode=-1;break t}catch(a){o=!0}(o||null==i.returnValue)&&(i.returnValue=!0)}for(i=[],o=e.b;o;o=o.parentNode)i.push(o);for(t=t.type,o=i.length-1;0<=o;o--){e.b=i[o];var s=Se(i[o],t,!0,e);r=r&&s}for(o=0;o<i.length;o++)e.b=i[o],s=Se(i[o],t,!1,e),r=r&&s}return r}return Ce(t,new ue(e,this))}function Ie(t){return(t=t[ye])instanceof pe?t:null}var Oe="__closure_events_fn_"+(1e9*Math.random()>>>0);function De(t){return d(t)?t:(t[Oe]||(t[Oe]=function(e){return t.handleEvent(e)}),t[Oe])}function ke(){Lt.call(this),this.o=new pe(this),this.Rb=this,this.Wa=null}function Pe(t,e,n,r,i){t.o.add(String(e),n,!1,r,i)}function Ne(t,e,n,r,i){t.o.add(String(e),n,!0,r,i)}function Me(t,e,n,r){if(!(e=t.o.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.oa&&s.capture==n){var a=s.listener,u=s.Ma||s.src;s.Ia&&me(t.o,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Kb}function Re(t,e,r){if(d(t))r&&(t=v(t,r));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:n.setTimeout(t,e||0)}function Le(t){var e=null;return new mt(function(n,r){-1==(e=Re(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw n.clearTimeout(e),t})}function Fe(t){if(t.S&&"function"==typeof t.S)return t.S();if(r(t))return t.split("");if(l(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}function Be(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(l(t)||r(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var i in e=[],n=0,t)e[n++]=i;return e}}function Ue(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ue)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ve(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];je(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)je(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}_(ke,Lt),ke.prototype[he]=!0,ke.prototype.addEventListener=function(t,e,n,r){be(this,t,e,n,r)},ke.prototype.removeEventListener=function(t,e,n,r){Ee(this,t,e,n,r)},ke.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Rb;var i=t.type||t;if(r(t))t=new ae(t,n);else if(t instanceof ae)t.target=t.target||n;else{var o=t;at(t=new ae(i,n),o)}if(o=!0,e)for(var s=e.length-1;0<=s;s--){var a=t.b=e[s];o=Me(a,i,!0,t)&&o}if(o=Me(a=t.b=n,i,!0,t)&&o,o=Me(a,i,!1,t)&&o,e)for(s=0;s<e.length;s++)o=Me(a=t.b=e[s],i,!1,t)&&o;return o},ke.prototype.va=function(){if(ke.pb.va.call(this),this.o){var t,e=this.o;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)fe(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=Ue.prototype).S=function(){Ve(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return Ve(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return je(this.b,t)?this.b[t]:e},t.set=function(t,e){je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var qe=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){if(this.b=this.o=this.c="",this.i=null,this.h=this.g="",this.f=!1,t instanceof Ge){this.f=void 0!==e?e:t.f,He(this,t.c),this.o=t.o,this.b=t.b,ze(this,t.i),this.g=t.g,e=t.a;var n=new sn;n.c=e.c,e.a&&(n.a=new Ue(e.a),n.b=e.b),We(this,n),this.h=t.h}else t&&(n=String(t).match(qe))?(this.f=!!e,He(this,n[1]||"",!0),this.o=Je(n[2]||""),this.b=Je(n[3]||"",!0),ze(this,n[4]),this.g=Je(n[5]||"",!0),We(this,n[6]||"",!0),this.h=Je(n[7]||"")):(this.f=!!e,this.a=new sn(null,this.f))}function He(t,e,n){t.c=n?Je(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function ze(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function We(t,e,n){e instanceof sn?(t.a=e,function(t,e){e&&!t.f&&(an(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),ln(this,n,t))},t)),t.f=e}(t.a,t.f)):(n||(e=$e(e,rn)),t.a=new sn(e,t.f))}function Ke(t,e,n){t.a.set(e,n)}function Xe(t,e){return t.a.get(e)}function Qe(t){return t instanceof Ge?new Ge(t):new Ge(t,void 0)}function Ye(t,e){var n=new Ge(null,void 0);return He(n,"https"),t&&(n.b=t),e&&(n.g=e),n}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $e(t,e,n){return r(t)?(t=encodeURI(t).replace(e,Ze),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ze(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.c;e&&t.push($e(e,tn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push($e(e,tn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.g)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push($e(n,"/"==n.charAt(0)?nn:en,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.h)&&t.push("#",$e(n,on)),t.join("")};var tn=/[#\/\?@]/g,en=/[#\?:]/g,nn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function sn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function an(t){t.a||(t.a=new Ue,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function un(t){var e=Be(t);if(void 0===e)throw Error("Keys are undefined");var n=new sn(null,void 0);t=Fe(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];h(o)?ln(n,i,o):n.add(i,o)}return n}function cn(t,e){an(t),e=dn(t,e),je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,je((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ve(t)))}function hn(t,e){return an(t),e=dn(t,e),je(t.a.b,e)}function ln(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),V(n)),t.b+=n.length)}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=sn.prototype).add=function(t,e){an(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){an(this),this.a.forEach(function(n,r){N(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){an(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){an(this);var e=[];if(r(t))hn(this,t)&&(e=U(e,this.a.get(dn(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},t.set=function(t,e){return an(this),this.c=null,hn(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var fn=!Ht||9<=Number(Zt);function pn(t,e){this.a=t===yn&&e||"",this.b=gn}function mn(t){return t instanceof pn&&t.constructor===pn&&t.b===gn?t.a:(S("expected object of type Const, got '"+t+"'"),"type_error:Const")}pn.prototype.na=!0,pn.prototype.ma=function(){return this.a},pn.prototype.toString=function(){return"Const{"+this.a+"}"};var gn={},yn={};function vn(){this.a="",this.b=Tn}function bn(t){return t instanceof vn&&t.constructor===vn&&t.b===Tn?t.a:(S("expected object of type TrustedResourceUrl, got '"+t+"' of type "+u(t)),"type_error:TrustedResourceUrl")}function wn(t,e){var n=mn(t);if(!En.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return function(t){var e=new vn;return e.a=t,e}(t=n.replace(_n,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof pn?mn(t):encodeURIComponent(String(t))}))}vn.prototype.na=!0,vn.prototype.ma=function(){return this.a.toString()},vn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var _n=/%{(\w+)}/g,En=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,Tn={};function xn(){this.a="",this.b=In}function Sn(t){return t instanceof xn&&t.constructor===xn&&t.b===In?t.a:(S("expected object of type SafeUrl, got '"+t+"' of type "+u(t)),"type_error:SafeUrl")}xn.prototype.na=!0,xn.prototype.ma=function(){return this.a.toString()},xn.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Cn=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function An(t){return t instanceof xn?t:(t="object"==typeof t&&t.na?t.ma():String(t),Cn.test(t)||(t="about:invalid#zClosurez"),On(t))}var In={};function On(t){var e=new xn;return e.a=t,e}function Dn(){this.a="",this.b=kn}On("about:blank"),Dn.prototype.na=!0,Dn.prototype.ma=function(){return this.a.toString()},Dn.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kn={};function Pn(t){var e=new Dn;return e.a=t,e}function Nn(t){var e=document;return r(t)?e.getElementById(t):t}function Mn(t,e){et(e,function(e,n){e&&"object"==typeof e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Rn.hasOwnProperty(n)?t.setAttribute(Rn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}Pn("<!DOCTYPE html>"),Pn(""),Pn("<br>");var Rn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Ln(t){if(t&&"number"==typeof t.length){if(f(t))return"function"==typeof t.item||"string"==typeof t.item;if(d(t))return"function"==typeof t.item}return!1}function Fn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(h(n)){var i=n;n=i.length,r.push("[");for(var o="",s=0;s<n;s++)r.push(o),t(e,i[s],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(s=n[i])&&(r.push(o),jn(i,r),r.push(":"),t(e,s,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":jn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Bn,t,e),e.join("")}function Bn(){}var Un={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Vn=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function jn(t,e){e.push('"',t.replace(Vn,function(t){var e=Un[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Un[t]=e),e}),'"')}function qn(){var t=ar();return Ht&&!!Zt&&11==Zt||/Edge\/\d+/.test(t)}function Gn(){return n.window&&n.window.location.href||self&&self.location&&self.location.href||""}function Hn(t,e){e=e||n.window;var r="about:blank";t&&(r=Sn(An(t)).toString()),e.location.href=r}function zn(t){return!!((t=(t||ar()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Wn(t){t=t||n.window;try{t.close()}catch(e){}}function Kn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(s in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=ar().toLowerCase(),r&&(e.target=r,Y(n,"crios/")&&(e.target="_blank")),ir(ar())==nr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof xn?n:An(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(s){case"width":case"height":case"top":case"left":i.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(s+"="+(t[s]?1:0))}var s=i.join(",");if((tt("iPhone")&&!tt("iPod")&&!tt("iPad")||tt("iPad")||tt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(s=r.document.createElement("A"),e instanceof xn||e instanceof xn||(e="object"==typeof e&&e.na?e.ma():String(e),Cn.test(e)||(e="about:invalid#zClosurez"),e=On(e)),s.href=Sn(e),s.setAttribute("target",n),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),s.dispatchEvent(t),s={}):t.noreferrer?(s=r.open("",n,s),t=Sn(e).toString(),s&&(Wt&&Y(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),s.opener=null,t=Pn('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+ct(t)+'">'),s.document.write(function(t){return t instanceof Dn&&t.constructor===Dn&&t.b===kn?t.a:(S("expected object of type SafeHtml, got '"+t+"' of type "+u(t)),"type_error:SafeHtml")}(t)),s.document.close())):(s=r.open(Sn(e).toString(),n,s))&&t.noopener&&(s.opener=null),s)try{s.focus()}catch(a){}return s}var Xn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Qn=/^[^@]+@[^@]+$/;function Yn(){var t=null;return new mt(function(e){"complete"==n.document.readyState?e():(t=function(){e()},_e(window,"load",t))}).s(function(e){throw Ee(window,"load",t),e})}function Jn(t){return t=t||ar(),!("file:"!==dr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function $n(){var t=n.window;try{return!(!t||t==t.top)}catch(e){return!1}}function Zn(){return void 0!==n.WorkerGlobalScope&&"function"==typeof n.importScripts}function tr(){return Jc.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Jc.a.INTERNAL.hasOwnProperty("node")?"Node":Zn()?"Worker":"Browser"}function er(){var t=tr();return"ReactNative"===t||"Node"===t}var nr="Firefox",rr="Chrome";function ir(t){var e=t.toLowerCase();return Y(e,"opera/")||Y(e,"opr/")||Y(e,"opios/")?"Opera":Y(e,"iemobile")?"IEMobile":Y(e,"msie")||Y(e,"trident/")?"IE":Y(e,"edge/")?"Edge":Y(e,"firefox/")?nr:Y(e,"silk/")?"Silk":Y(e,"blackberry")?"Blackberry":Y(e,"webos")?"Webos":!Y(e,"safari/")||Y(e,"chrome/")||Y(e,"crios/")||Y(e,"android")?!Y(e,"chrome/")&&!Y(e,"crios/")||Y(e,"edge/")?Y(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":rr:"Safari"}var or={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function sr(t,e){e=e||[];var n,r=[],i={};for(n in or)i[or[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=tr())?r=ir(i=ar()):"Worker"===r&&(r=ir(i=ar())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function ar(){return n.navigator&&n.navigator.userAgent||""}function ur(t,e){t=t.split("."),e=e||n;for(var r=0;r<t.length&&"object"==typeof e&&null!=e;r++)e=e[t[r]];return r!=t.length&&(e=void 0),e}function cr(){try{var t=n.localStorage,e=yr();if(t)return t.setItem(e,"1"),t.removeItem(e),!qn()||!!n.indexedDB}catch(r){return Zn()&&!!n.indexedDB}return!1}function hr(){return(lr()||"chrome-extension:"===dr()||Jn())&&!er()&&cr()&&!Zn()}function lr(){return"http:"===dr()||"https:"===dr()}function dr(){return n.location&&n.location.protocol||null}function fr(t){return!zn(t=t||ar())&&ir(t)!=nr}function pr(t){return void 0===t?null:Fn(t)}function mr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!=t[e]&&(n[e]=t[e]);return n}function gr(t){if(null!==t)return JSON.parse(t)}function yr(t){return t||Math.floor(1e9*Math.random()).toString()}function vr(t){return"Safari"!=ir(t=t||ar())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function br(){var t=n.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var r=0;r<t.CP.length;r++)t.CP[r]=null}function wr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=ar(),e=tr(),this.b=zn(t)||"ReactNative"===e}function _r(){var t=n.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Er(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(n){}return null}function Tr(){return!(!ur("fireauth.oauthhelper",n)&&!ur("fireauth.iframe",n))}wr.prototype.get=function(){var t=n.navigator;return!t||"boolean"!=typeof t.onLine||!lr()&&"chrome-extension:"!==dr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var xr,Sr={};function Cr(t){Sr[t]||(Sr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Ar={};Object.defineProperty(Ar,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Ar,"abcd",{configurable:!0,enumerable:!0,value:2}),xr=2==Ar.abcd}catch(qt){xr=!1}function Ir(t,e,n){xr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Or(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Ir(t,n,e[n])}function Dr(t){var e={};return Or(e,t),e}function kr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Ir(e,n,kr(t[n]));return e}function Pr(t){var e={},n=t[Mr],r=t[Rr];if(!(t=t[Lr])||t!=Nr&&!n)throw Error("Invalid provider user info!");e[Br]=r||null,e[Fr]=n||null,Ir(this,Vr,t),Ir(this,Ur,kr(e))}var Nr="EMAIL_SIGNIN",Mr="email",Rr="newEmail",Lr="requestType",Fr="email",Br="fromEmail",Ur="data",Vr="operation";function jr(t,e){this.code=Gr+t,this.message=e||Hr[t]||""}function qr(t){var e=t&&t.code;return e?new jr(e.substring(Gr.length),t.message):null}_(jr,Error),jr.prototype.w=function(){return{code:this.code,message:this.message}},jr.prototype.toJSON=function(){return this.w()};var Gr="auth/",Hr={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function zr(t){var e=t[Yr];if(void 0===e)throw new jr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new jr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Wr];if(n&&"object"==typeof n){e=n[Zr];var r=n[Jr];if(n=n[$r],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new jr("argument-error",Jr+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new jr("argument-error",$r+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new jr("argument-error",Zr+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new jr("missing-android-pkg-name")}}else if(void 0!==n)throw new jr("argument-error",Wr+" property must be a non null object when specified.");if(this.f=null,(e=t[Qr])&&"object"==typeof e){if("string"==typeof(e=e[ti])&&e.length)this.f=e;else if(void 0!==e)throw new jr("argument-error",ti+" property must be a non empty string when specified.")}else if(void 0!==e)throw new jr("argument-error",Qr+" property must be a non null object when specified.");if(void 0!==(e=t[Xr])&&"boolean"!=typeof e)throw new jr("argument-error",Xr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Kr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new jr("argument-error",Kr+" property must be a non empty string when specified.");this.i=t||null}var Wr="android",Kr="dynamicLinkDomain",Xr="handleCodeInApp",Qr="iOS",Yr="url",Jr="installApp",$r="minimumVersion",Zr="packageName",ti="bundleId";function ei(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ni=null,ri=null;function ii(t){this.c=t.sub,w(),this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function oi(t){return(t=si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new ii(t):null}function si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=ri[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!ni){ni={},ri={};for(var t=0;65>t;t++)ni[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),ri[ni[t]]=t,62<=t&&(ri["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),s=n(64),a=n(64);if(64===a&&-1===i)break;e(i<<2|o>>4),64!=s&&(e(o<<4&240|s>>2),64!=a&&e(s<<6&192|a))}}(t,function(t){e+=String.fromCharCode(t)}),e}(t))}catch(r){}return null}ii.prototype.f=function(){return this.b};var ai,ui={bd:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function ci(t){for(var e in ui)if(ui[e].id===t)return{firebaseEndpoint:(t=ui[e]).bb,secureTokenEndpoint:t.jb};return null}ai=ci("__EID__")?"__EID__":void 0;var hi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),li=["client_id","response_type","scope","redirect_uri","state"],di={Xc:{Na:"locale",Ba:500,Aa:600,Oa:"facebook.com",ib:li},Zc:{Na:null,Ba:500,Aa:620,Oa:"github.com",ib:li},$c:{Na:"hl",Ba:515,Aa:680,Oa:"google.com",ib:li},fd:{Na:"lang",Ba:485,Aa:705,Oa:"twitter.com",ib:hi}};function fi(t){for(var e in di)if(di[e].Oa==t)return di[e];return null}function pi(t){var e={};e["facebook.com"]=bi,e["google.com"]=_i,e["github.com"]=wi,e["twitter.com"]=Ei;var n=t&&t[gi];try{if(n)return e[n]?new e[n](t):new vi(t);if(void 0!==t[mi])return new yi(t)}catch(r){}return null}var mi="idToken",gi="providerId";function yi(t){var e=t[gi];if(!e&&t[mi]){var n=oi(t[mi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Ir(this,"providerId",e),Ir(this,"isNewUser",n)}function vi(t){yi.call(this,t),Ir(this,"profile",kr((t=gr(t.rawUserInfo||"{}"))||{}))}function bi(t){if(vi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function wi(t){if(vi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Ir(this,"username",this.profile&&this.profile.login||null)}function _i(t){if(vi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ei(t){if(vi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Ir(this,"username",t.screenName||null)}function Ti(t){this.a=Qe(t)}function xi(t){var e=Qe(t),n=Xe(e,"link"),r=Xe(Qe(n),"link");return e=Xe(e,"deep_link_id"),Xe(Qe(e),"link")||e||r||n||t}function Si(){}function Ci(t,e){return t.then(function(t){if(t[ds]){var n=oi(t[ds]);if(!n||e!=n.c)throw new jr("user-mismatch");return t}throw new jr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Gr+"user-not-found"?new jr("user-mismatch"):t})}function Ai(t,e){if(!e)throw new jr("internal-error","failed to construct a credential");this.a=e,Ir(this,"providerId",t),Ir(this,"signInMethod",t)}function Ii(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Oi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Ai(t.providerId,t.pendingToken)}catch(e){}return null}function Di(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Ir(this,"idToken",e.idToken),e.accessToken&&Ir(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Ir(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new jr("internal-error","failed to construct a credential");Ir(this,"accessToken",e.oauthToken),Ir(this,"secret",e.oauthTokenSecret)}Ir(this,"providerId",t),Ir(this,"signInMethod",n)}function ki(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:un(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Pi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Di(t.providerId,e,t.signInMethod)}catch(n){}}return null}function Ni(t,e){this.Fc=e||[],Or(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(fi(t)||{}).Na||null,this.ab=null}function Mi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new jr("argument-error",'SAML provider IDs must be prefixed with "saml."');Ni.call(this,t,[])}function Ri(t){Ni.call(this,t,li),this.a=[]}function Li(){Ri.call(this,"facebook.com")}function Fi(t){if(!t)throw new jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return f(t)&&(e=t.accessToken),(new Li).credential({accessToken:e})}function Bi(){Ri.call(this,"github.com")}function Ui(t){if(!t)throw new jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return f(t)&&(e=t.accessToken),(new Bi).credential({accessToken:e})}function Vi(){Ri.call(this,"google.com"),this.ua("profile")}function ji(t,e){var n=t;return f(t)&&(n=t.idToken,e=t.accessToken),(new Vi).credential({idToken:n,accessToken:e})}function qi(){Ni.call(this,"twitter.com",hi)}function Gi(t,e){var n=t;if(f(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new jr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Di("twitter.com",n,"twitter.com")}function Hi(t,e,n){this.a=t,this.c=e,Ir(this,"providerId","password"),Ir(this,"signInMethod",n===Wi.EMAIL_LINK_SIGN_IN_METHOD?Wi.EMAIL_LINK_SIGN_IN_METHOD:Wi.EMAIL_PASSWORD_SIGN_IN_METHOD)}function zi(t){return t&&t.email&&t.password?new Hi(t.email,t.password,t.signInMethod):null}function Wi(){Or(this,{providerId:"password",isOAuthProvider:!1})}function Ki(t,e){if(!(e=Xi(e)))throw new jr("argument-error","Invalid email link!");return new Hi(t,e,Wi.EMAIL_LINK_SIGN_IN_METHOD)}function Xi(t){var e=Xe((t=new Ti(t=xi(t))).a,"oobCode")||null;return"signIn"===(Xe(t.a,"mode")||null)&&e?e:null}function Qi(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new jr("internal-error");this.a=t,Ir(this,"providerId","phone"),Ir(this,"signInMethod","phone")}function Yi(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return N(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new Qi(e)}return null}function Ji(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function $i(t){try{this.a=t||Jc.a.auth()}catch(e){throw new jr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Or(this,{providerId:"phone",isOAuthProvider:!1})}function Zi(t,e){if(!t)throw new jr("missing-verification-id");if(!e)throw new jr("missing-verification-code");return new Qi({Ua:t,Ta:e})}function to(t){if(t.temporaryProof&&t.phoneNumber)return new Qi({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,s=t&&t.pendingToken;try{switch(e){case"google.com":return ji(o,n);case"facebook.com":return Fi(n);case"github.com":return Ui(n);case"twitter.com":return Gi(n,r);default:return n||r||o||s?s?0==e.indexOf("saml.")?new Ai(e,s):new Di(e,{pendingToken:s,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Ri(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(a){return null}}function eo(t){if(!t.isOAuthProvider)throw new jr("invalid-oauth-provider")}function no(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new jr("invalid-auth-event");if(this.g&&this.a)throw new jr("invalid-auth-event");if(this.g&&!this.f)throw new jr("invalid-auth-event")}function ro(t){return(t=t||{}).type?new no(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&qr(t.error),t.postBody):null}function io(){this.b=null,this.a=[]}_(vi,yi),_(bi,vi),_(wi,vi),_(_i,vi),_(Ei,vi),Ai.prototype.la=function(t){return Ds(t,Ii(this))},Ai.prototype.b=function(t,e){var n=Ii(this);return n.idToken=e,ks(t,n)},Ai.prototype.f=function(t,e){return Ci(Ps(t,Ii(this)),e)},Ai.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Di.prototype.la=function(t){return Ds(t,ki(this))},Di.prototype.b=function(t,e){var n=ki(this);return n.idToken=e,ks(t,n)},Di.prototype.f=function(t,e){return Ci(Ps(t,ki(this)),e)},Di.prototype.w=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Ni.prototype.Da=function(t){return this.zb=rt(t),this},_(Mi,Ni),_(Ri,Ni),Ri.prototype.ua=function(t){return L(this.a,t)||this.a.push(t),this},Ri.prototype.Fb=function(){return V(this.a)},Ri.prototype.credential=function(t,e){var n;if(!(n=f(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new jr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Di(this.providerId,n,this.providerId)},_(Li,Ri),Ir(Li,"PROVIDER_ID","facebook.com"),Ir(Li,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),_(Bi,Ri),Ir(Bi,"PROVIDER_ID","github.com"),Ir(Bi,"GITHUB_SIGN_IN_METHOD","github.com"),_(Vi,Ri),Ir(Vi,"PROVIDER_ID","google.com"),Ir(Vi,"GOOGLE_SIGN_IN_METHOD","google.com"),_(qi,Ni),Ir(qi,"PROVIDER_ID","twitter.com"),Ir(qi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Hi.prototype.la=function(t){return this.signInMethod==Wi.EMAIL_LINK_SIGN_IN_METHOD?aa(t,Vs,{email:this.a,oobCode:this.c}):aa(t,ra,{email:this.a,password:this.c})},Hi.prototype.b=function(t,e){return this.signInMethod==Wi.EMAIL_LINK_SIGN_IN_METHOD?aa(t,js,{idToken:e,email:this.a,oobCode:this.c}):aa(t,Js,{idToken:e,email:this.a,password:this.c})},Hi.prototype.f=function(t,e){return Ci(this.la(t),e)},Hi.prototype.w=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Or(Wi,{PROVIDER_ID:"password"}),Or(Wi,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Or(Wi,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Qi.prototype.la=function(t){return t.Va(Ji(this))},Qi.prototype.b=function(t,e){var n=Ji(this);return n.idToken=e,aa(t,oa,n)},Qi.prototype.f=function(t,e){var n=Ji(this);return n.operation="REAUTH",Ci(t=aa(t,sa,n),e)},Qi.prototype.w=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},$i.prototype.Va=function(t,e){var n=this.a.b;return Et(e.verify()).then(function(i){if(!r(i))throw new jr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return aa(n,Qs,e)}(0,{phoneNumber:t,recaptchaToken:i}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new jr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Or($i,{PROVIDER_ID:"phone"}),Or($i,{PHONE_SIGN_IN_METHOD:"phone"}),no.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},no.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.w()}};var oo,so=null;function ao(t){var e="unauthorized-domain",n=void 0,r=Qe(t);t=r.b,"chrome-extension"==(r=r.c)?n=ut("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=ut("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",jr.call(this,e,n)}function uo(t,e,n){jr.call(this,t,n),(t=e||{}).Ab&&Ir(this,"email",t.Ab),t.$&&Ir(this,"phoneNumber",t.$),t.credential&&Ir(this,"credential",t.credential)}function co(t){if(t.code){var e=t.code||"";0==e.indexOf(Gr)&&(e=e.substring(Gr.length));var n={credential:to(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new jr(e,t.message||void 0);return new uo(e,n,t.message)}return null}function ho(){}function lo(){}function fo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(i){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function po(){}function mo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=v(this.fc,this),this.a.onerror=v(this.Gb,this),this.a.onprogress=v(this.gc,this),this.a.ontimeout=v(this.kc,this)}function go(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function yo(t,e,n){this.reset(t,e,n,void 0,void 0)}function vo(t){this.f=t,this.b=this.c=this.a=null}function bo(t,e){this.name=t,this.value=e}io.prototype.subscribe=function(t){var e=this;this.a.push(t),this.b||(this.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=ur("universalLinks.subscribe",n))&&t(null,this.b))},io.prototype.unsubscribe=function(t){B(this.a,function(e){return e==t})},_(ao,jr),_(uo,jr),uo.prototype.w=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.w();return e&&at(t,e),t},uo.prototype.toJSON=function(){return this.w()},ho.prototype.c=null,_(lo,ho),lo.prototype.a=function(){var t=fo(this);return t?new ActiveXObject(t):new XMLHttpRequest},lo.prototype.b=function(){var t={};return fo(this)&&(t[0]=!0,t[1]=!0),t},oo=new lo,_(po,ho),po.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new mo;throw Error("Unsupported browser")},po.prototype.b=function(){return{}},(t=mo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,go(this,4)},t.Gb=function(){this.status=500,this.response=this.responseText="",go(this,4)},t.kc=function(){this.Gb()},t.gc=function(){this.status=200,go(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},yo.prototype.a=null,yo.prototype.reset=function(t,e,n,r,i){r||w(),delete this.a},bo.prototype.toString=function(){return this.name};var wo=new bo("SEVERE",1e3),_o=new bo("WARNING",900),Eo=new bo("CONFIG",700),To=new bo("FINE",500);vo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(S("Root logger has no level set."),null)}(this).value)for(d(e)&&(e=e()),t=new yo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var xo={},So=null;function Co(t){var e;if(So||(So=new vo(""),xo[""]=So,So.c=Eo),!(e=xo[t])){e=new vo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Co(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,xo[t]=e}return e}function Ao(t,e){t&&t.log(To,e,void 0)}function Io(t){this.f=t}function Oo(t){ke.call(this),this.u=t,this.readyState=Do,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Co("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}_(Io,ho),Io.prototype.a=function(){return new Oo(this.f)},Io.prototype.b=function(t){return function(){return t}}({}),_(Oo,ke);var Do=0;function ko(t){t.c.read().then(t.ec.bind(t)).catch(t.La.bind(t))}function Po(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,No(t)}function No(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Mo(t){ke.call(this),this.headers=new Ue,this.D=t||null,this.c=!1,this.A=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.m=Ro,this.v=this.O=!1}(t=Oo.prototype).open=function(t,e){if(this.readyState!=Do)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,No(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.La.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Po(this,!1)),this.readyState=Do},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,No(this)),this.a&&(this.readyState=3,No(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.La.bind(this)):void 0!==n.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,ko(this)):t.text().then(this.ic.bind(this),this.La.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Po(this,!0):No(this),3==this.readyState&&ko(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Po(this,!0))},t.hc=function(t){this.a&&(this.response=t,Po(this,!0))},t.La=function(t){var e=this.h;e&&e.log(_o,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Po(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(_o,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(_o,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},_(Mo,ke);var Ro="";Mo.prototype.b=Co("goog.net.XhrIo");var Lo=/^https?$/i,Fo=["POST","PUT"];function Bo(t){return"content-type"==t.toLowerCase()}function Uo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Vo(t),qo(t)}function Vo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function jo(t){if(t.c&&void 0!==e)if(t.A[1]&&4==Ho(t)&&2==zo(t))Ao(t.b,Wo(t,"Local request error detected and ignored"));else if(t.i&&4==Ho(t))Re(t.Jb,0,t);else if(t.dispatchEvent("readystatechange"),4==Ho(t)){Ao(t.b,Wo(t,"Request complete")),t.c=!1;try{var r,i=zo(t);t:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break t;default:o=!1}if(!(r=o)){var s;if(s=0===i){var a=String(t.l).match(qe)[1]||null;if(!a&&n.self&&n.self.location){var u=n.self.location.protocol;a=u.substr(0,u.length-1)}s=!Lo.test(a?a.toLowerCase():"")}r=s}if(r)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<Ho(t)?t.a.statusText:""}catch(h){Ao(t.b,"Can not get status: "+h.message),c=""}t.h=c+" ["+zo(t)+"]",Vo(t)}}finally{qo(t)}}}function qo(t,e){if(t.a){Go(t);var n=t.a,r=t.A[0]?a:null;t.a=null,t.A=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(i){(t=t.b)&&t.log(wo,"Problem encountered resetting onreadystatechange: "+i.message,void 0)}}}function Go(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(n.clearTimeout(t.u),t.u=null)}function Ho(t){return t.a?t.a.readyState:0}function zo(t){try{return 2<Ho(t)?t.a.status:-1}catch(e){return-1}}function Wo(t,e){return e+" ["+t.N+" "+t.l+" "+zo(t)+"]"}function Ko(t){var e=is;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.A=this.i=!1,this.h=0,this.b=null,this.o=0}function Xo(t,e,n){t.a=!0,t.c=n,t.f=!e,$o(t)}function Qo(t){if(t.a){if(!t.l)throw new Zo(t);t.l=!1}}function Yo(t,e,n,r){t.g.push([e,n,r]),t.a&&$o(t)}function Jo(t){return R(t.g,function(t){return d(t[1])})}function $o(t){if(t.h&&t.a&&Jo(t)){var e=t.h,r=ns[e];r&&(n.clearTimeout(r.a),delete ns[e]),t.h=0}t.b&&(t.b.o--,delete t.b),e=t.c;for(var i=r=!1;t.g.length&&!t.i;){var o=t.g.shift(),s=o[0],a=o[1];if(o=o[2],s=t.f?a:s)try{var u=s.call(o||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(E(e)||"function"==typeof n.Promise&&e instanceof n.Promise)&&(i=!0,t.i=!0)}catch(c){e=c,t.f=!0,Jo(t)||(r=!0)}}t.c=e,i&&(u=v(t.m,t,!0),i=v(t.m,t,!1),e instanceof Ko?(Yo(e,u,i),e.A=!0):e.then(u,i)),r&&(e=new es(e),ns[e.a]=e,t.h=e.a)}function Zo(){T.call(this)}function ts(){T.call(this)}function es(t){this.a=n.setTimeout(v(this.c,this),0),this.b=t}(t=Mo.prototype).Ga=function(){void 0!==e&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ao(this.b,Wo(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ao(this.b,Wo(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),qo(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),qo(this,!0)),Mo.pb.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?jo(this):this.yc())},t.yc=function(){jo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Ro:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(wo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(e){return Ao(this.b,"Can not get response: "+e.message),null}},Ko.prototype.cancel=function(t){if(this.a)this.c instanceof Ko&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.o--,0>=e.o&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new ts(this),Qo(this),Xo(this,!1,t))}},Ko.prototype.m=function(t,e){this.i=!1,Xo(this,t,e)},Ko.prototype.then=function(t,e,n){var r,i,o=new mt(function(t,e){r=t,i=e});return Yo(this,r,function(t){t instanceof ts?o.cancel():i(t)}),o.then(t,e,n)},Ko.prototype.$goog_Thenable=!0,_(Zo,T),Zo.prototype.message="Deferred has already fired",Zo.prototype.name="AlreadyCalledError",_(ts,T),ts.prototype.message="Deferred was canceled",ts.prototype.name="CanceledError",es.prototype.c=function(){throw delete ns[this.a],this.b};var ns={};function rs(t){var e={},r=e.document||document,i=bn(t).toString(),a=document.createElement("SCRIPT"),u={Lb:a,Ga:void 0},c=new Ko(u),h=null,l=null!=e.timeout?e.timeout:5e3;return 0<l&&(h=window.setTimeout(function(){os(a,!0);var t=new us(as,"Timeout reached for loading script "+i);Qo(c),Xo(c,!1,t)},l),u.Ga=h),a.onload=a.onreadystatechange=function(){a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(os(a,e.hd||!1,h),Qo(c),Xo(c,!0,null))},a.onerror=function(){os(a,!0,h);var t=new us(ss,"Error while loading script "+i);Qo(c),Xo(c,!1,t)},at(u=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),Mn(a,u),function(t,e){t.src=bn(e),null===s&&(s=(e=(e=n.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&o.test(e)?e:""),(e=s)&&t.setAttribute("nonce",e)}(a,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(r).appendChild(a),c}function is(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&os(t,!0,this.Ga)}}function os(t,e,r){null!=r&&n.clearTimeout(r),t.onload=a,t.onerror=a,t.onreadystatechange=a,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var ss=0,as=1;function us(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),T.call(this,n),this.code=t}function cs(t){this.f=t}function hs(t,e,r){if(this.b=t,this.i=(t=e||{}).secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.o=t.secureTokenTimeout||fs,this.f=rt(t.secureTokenHeaders||ps),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||ms,this.a=rt(t.firebaseHeaders||gs),r&&(this.a["X-Client-Version"]=r,this.f["X-Client-Version"]=r),r="Node"==tr(),!(r=n.XMLHttpRequest||r&&Jc.a.INTERNAL.node&&Jc.a.INTERNAL.node.XMLHttpRequest)&&!Zn())throw new jr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,this.c=Zn()?new Io(self):er()?new cs(r):new po}_(us,T),_(cs,ho),cs.prototype.a=function(){return new this.f},cs.prototype.b=function(){return{}};var ls,ds="idToken",fs=new wr(3e4,6e4),ps={"Content-Type":"application/x-www-form-urlencoded"},ms=new wr(3e4,6e4),gs={"Content-Type":"application/json"};function ys(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function vs(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function bs(t,e,r,i,o,s,a){(function(){var t=ar();return!((t=ir(t)!=rr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||Ht&&Zt&&!(9<Zt))})()||Zn()?t=v(t.m,t):(ls||(ls=new mt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{n[_s]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var r=wn(ws,{onload:_s});!function(t,e){Yo(rs(r),null,e,void 0)}(0,function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=v(t.l,t)),t(e,r,i,o,s,a)}hs.prototype.m=function(t,e,i,o,s,a){if(Zn()&&(void 0===n.fetch||void 0===n.Headers||void 0===n.Request))throw new jr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var u=new Mo(this.c);if(a){u.g=Math.max(0,a);var c=setTimeout(function(){u.dispatchEvent("timeout")},a)}Pe(u,"complete",function(){c&&clearTimeout(c);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Ao(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(n){t=null}e&&e(t)}),Ne(u,"ready",function(){c&&clearTimeout(c),Ut(this)}),Ne(u,"timeout",function(){c&&clearTimeout(c),Ut(this),e&&e(null)}),function(t,e,i,o,s){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);i=i?i.toUpperCase():"GET",t.l=e,t.h="",t.N=i,t.G=!1,t.c=!0,t.a=t.D?t.D.a():oo.a(),t.A=function(t){return t.c||(t.c=t.b())}(t.D?t.D:oo),t.a.onreadystatechange=v(t.Jb,t);try{Ao(t.b,Wo(t,"Opening Xhr")),t.I=!0,t.a.open(i,String(e),!0),t.I=!1}catch(u){return Ao(t.b,Wo(t,"Error opening Xhr: "+u.message)),void Uo(t,u)}e=o||"";var a=new Ue(t.headers);s&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(l(t)||r(t))N(t,e,void 0);else for(var n=Be(t),i=Fe(t),o=i.length,s=0;s<o;s++)e.call(void 0,i[s],n&&n[s],t)}(s,function(t,e){a.set(e,t)}),s=function(t){t:{for(var e=Bo,n=t.length,i=r(t)?t.split(""):t,o=0;o<n;o++)if(o in i&&e.call(void 0,i[o],o,t)){e=o;break t}e=-1}return 0>e?null:r(t)?t.charAt(e):t[e]}(a.U()),o=n.FormData&&e instanceof n.FormData,!L(Fo,i)||s||o||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{Go(t),0<t.g&&(t.v=function(t){return Ht&&ee(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Ao(t.b,Wo(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=v(t.Ga,t)):t.u=Re(t.Ga,t.g,t)),Ao(t.b,Wo(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(u){Ao(t.b,Wo(t,"Send error: "+u.message)),Uo(t,u)}}(u,t,i,o,s)};var ws=new pn(yn,"https://apis.google.com/js/client.js?onload=%{onload}"),_s="__fcb"+Math.floor(1e6*Math.random()).toString();function Es(t){if(!r(t=t.email)||!Qn.test(t))throw new jr("invalid-email")}function Ts(t){"email"in t&&Es(t)}function xs(t){if(!t[ds])throw new jr("internal-error")}function Ss(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new jr("internal-error")}else{if(!t.sessionInfo)throw new jr("missing-verification-id");if(!t.code)throw new jr("missing-verification-code")}}hs.prototype.l=function(t,e,n,r,i){var o=this;ls.then(function(){window.gapi.client.setApiKey(o.b);var s=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(s),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},hs.prototype.Ra=function(){return aa(this,$s,{})},hs.prototype.qb=function(t,e){return aa(this,Ys,{idToken:t,email:e})},hs.prototype.rb=function(t,e){return aa(this,Js,{idToken:t,password:e})};var Cs={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function As(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new jr("internal-error")}function Is(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&hn(t=new sn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function Os(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=co(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=co(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=co(t)):t.errorMessage&&(e=ua(t.errorMessage)),e)throw e;if(!t[ds])throw new jr("internal-error")}function Ds(t,e){return e.returnIdpCredential=!0,aa(t,Zs,e)}function ks(t,e){return e.returnIdpCredential=!0,aa(t,ea,e)}function Ps(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,aa(t,ta,e)}function Ns(t){if(!t.oobCode)throw new jr("invalid-action-code")}(t=hs.prototype).sb=function(t,e){var n={idToken:t},r=[];return et(Cs,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),aa(this,Ys,n)},t.lb=function(t,e){return at(t={requestType:"PASSWORD_RESET",email:t},e),aa(this,zs,t)},t.mb=function(t,e){return at(t={requestType:"EMAIL_SIGNIN",email:t},e),aa(this,Gs,t)},t.kb=function(t,e){return at(t={requestType:"VERIFY_EMAIL",idToken:t},e),aa(this,Hs,t)},t.Va=function(t){return aa(this,ia,t)},t.$a=function(t,e){return aa(this,Xs,{oobCode:t,newPassword:e})},t.Ja=function(t){return aa(this,Rs,{oobCode:t})},t.Xa=function(t){return aa(this,Ms,{oobCode:t})};var Ms={endpoint:"setAccountInfo",C:Ns,da:"email"},Rs={endpoint:"resetPassword",C:Ns,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new jr("internal-error")}},Ls={endpoint:"signupNewUser",C:function(t){if(Es(t),!t.password)throw new jr("weak-password")},J:xs,R:!0},Fs={endpoint:"createAuthUri"},Bs={endpoint:"deleteAccount",T:["idToken"]},Us={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],C:function(t){if(!h(t.deleteProvider))throw new jr("internal-error")}},Vs={endpoint:"emailLinkSignin",T:["email","oobCode"],C:Es,J:xs,R:!0},js={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],C:Es,J:xs,R:!0},qs={endpoint:"getAccountInfo"},Gs={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new jr("internal-error");Es(t)},da:"email"},Hs={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],C:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new jr("internal-error")},da:"email"},zs={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("PASSWORD_RESET"!=t.requestType)throw new jr("internal-error");Es(t)},da:"email"},Ws={vb:!0,endpoint:"getProjectConfig",Ib:"GET"},Ks={vb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new jr("internal-error")}},Xs={endpoint:"resetPassword",C:Ns,da:"email"},Qs={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},Ys={endpoint:"setAccountInfo",T:["idToken"],C:Ts,R:!0},Js={endpoint:"setAccountInfo",T:["idToken"],C:function(t){if(Ts(t),!t.password)throw new jr("weak-password")},J:xs,R:!0},$s={endpoint:"signupNewUser",J:xs,R:!0},Zs={endpoint:"verifyAssertion",C:As,Pa:Is,J:Os,R:!0},ta={endpoint:"verifyAssertion",C:As,Pa:Is,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new jr("user-not-found");if(t.errorMessage)throw ua(t.errorMessage);if(!t[ds])throw new jr("internal-error")},R:!0},ea={endpoint:"verifyAssertion",C:function(t){if(As(t),!t.idToken)throw new jr("internal-error")},Pa:Is,J:Os,R:!0},na={endpoint:"verifyCustomToken",C:function(t){if(!t.token)throw new jr("invalid-custom-token")},J:xs,R:!0},ra={endpoint:"verifyPassword",C:function(t){if(Es(t),!t.password)throw new jr("wrong-password")},J:xs,R:!0},ia={endpoint:"verifyPhoneNumber",C:Ss,J:xs},oa={endpoint:"verifyPhoneNumber",C:function(t){if(!t.idToken)throw new jr("internal-error");Ss(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",co(t);xs(t)}},sa={Xb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",C:Ss,J:xs};function aa(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Tt(new jr("internal-error"));var r,i=e.Ib||"POST";return Et(n).then(e.C).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var s=Qe(t.g+e);Ke(s,"key",t.b),o&&Ke(s,"cb",w().toString());var a="GET"==n;if(a)for(var u in r)r.hasOwnProperty(u)&&Ke(s,u,r[u]);return new mt(function(e,o){bs(t,s.toString(),function(t){t?t.error?o(ca(t,i||{})):e(t):o(new jr("network-request-failed"))},n,a?void 0:Fn(mr(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Xb,e.vb||!1)}).then(function(t){return r=t,e.Pa?e.Pa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new jr("internal-error");return r[e.da]})}function ua(t){return ca({error:{errors:[{message:t}],code:400,message:t}})}function ca(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new jr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",at(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new jr(r[i],e);return!e&&t&&(e=pr(t)),new jr("internal-error",e)}function ha(t){this.b=t,this.a=null,this.gb=function(t){return(pa||(pa=new mt(function(t,e){function r(){br(),ur("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){br(),e(Error("Network Error"))},timeout:da.get()})}if(ur("gapi.iframes.Iframe"))t();else if(ur("gapi.load"))r();else{var i="__iframefcb"+Math.floor(1e6*Math.random()).toString();n[i]=function(){ur("gapi.load")?r():e(Error("Network Error"))},Et(rs(i=wn(la,{onload:i}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw pa=null,t}))).then(function(){return new mt(function(e,n){ur("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},fa.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var la=new pn(yn,"https://apis.google.com/js/api.js?onload=%{onload}"),da=new wr(3e4,6e4),fa=new wr(5e3,15e3),pa=null;function ma(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Ye(this.i,"/__/auth/iframe"),Ke(this.a,"apiKey",this.g),Ke(this.a,"appName",this.h),this.b=null,this.c=[]}function ga(t,e,n,r,i){this.m=t,this.l=e,this.c=n,this.o=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ya(t){try{return Jc.a.app(t).auth().ya()}catch(e){return[]}}function va(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.u=this.v=null,this.g=[],this.o=this.a=null}function ba(t){var e=Gn();return function(t){return aa(t,Ws,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=Qe(e),r=n.c;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],s=n,a=r;if(0==o.indexOf("chrome-extension://")?s=Qe(o).b==s&&"chrome-extension"==a:"http"!=a&&"https"!=a?s=!1:Xn.test(o)?s=s==o:(o=o.split(".").join("\\."),s=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(s)),s){t=!0;break t}}t=!1}if(!t)throw new ao(Gn())})}function wa(t){return t.o?t.o:(t.o=Yn().then(function(){if(!t.u){var e=t.c,n=t.h,r=ya(t.b),i=new ma(t.l,t.f,t.b);i.f=e,i.b=n,i.c=V(r||[]),t.u=i.toString()}t.i=new ha(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then(function(){t.a.register("authEvent",e,ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=ro(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Et(n)}return n.status="ERROR",Et(n)})}(t)}),t.o)}function _a(t){return t.m||(t.v=t.c?sr(t.c,ya(t.b)):null,t.m=new hs(t.f,ci(t.h),t.v)),t.m}function Ea(t,e,n,r,i,o,s,a,u,c){return(t=new ga(t,e,n,r,i)).i=o,t.g=s,t.h=a,t.b=rt(u||null),t.f=c,t.toString()}function Ta(t){if(this.a=t||Jc.a.INTERNAL.reactNative&&Jc.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new jr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function xa(t){this.b=t,this.a={},this.c=v(this.f,this)}ma.prototype.toString=function(){return this.f?Ke(this.a,"v",this.f):cn(this.a.a,"v"),this.b?Ke(this.a,"eid",this.b):cn(this.a.a,"eid"),this.c.length?Ke(this.a,"fw",this.c.join(",")):cn(this.a.a,"fw"),this.a.toString()},ga.prototype.toString=function(){var t=Ye(this.m,"/__/auth/handler");if(Ke(t,"apiKey",this.l),Ke(t,"appName",this.c),Ke(t,"authType",this.o),this.a.isOAuthProvider){var e=this.a;try{var n=Jc.a.app(this.c).auth().ea()}catch(a){n=null}for(var r in e.ab=n,Ke(t,"providerId",this.a.providerId),n=mr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=rt(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.ab&&!n[e.eb]&&(n[e.eb]=e.ab),nt(n)||Ke(t,"customParameters",pr(n))}if("function"==typeof this.a.Fb&&(e=this.a.Fb()).length&&Ke(t,"scopes",e.join(",")),this.i?Ke(t,"redirectUrl",this.i):cn(t.a,"redirectUrl"),this.g?Ke(t,"eventId",this.g):cn(t.a,"eventId"),this.h?Ke(t,"v",this.h):cn(t.a,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Xe(t,s)&&Ke(t,s,this.b[s]);return this.f?Ke(t,"eid",this.f):cn(t.a,"eid"),(s=ya(this.c)).length&&Ke(t,"fw",s.join(",")),t.toString()},(t=va.prototype).Ea=function(t,e,n){var r=new jr("popup-closed-by-user"),i=new jr("web-storage-unsupported"),o=this,s=!1;return this.ga().then(function(){(function(t){var e={type:"webStorageSupport"};return wa(t).then(function(){return function(t,e){return t.gb.then(function(){return new mt(function(n){t.a.send(e.type,e,n,ur("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&Wn(t),e(i),s=!0)})}).s(function(){}).then(function(){if(!s)return function(t){return new mt(function(e){return function n(){Le(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!s)return Le(n).then(function(){e(r)})})},t.Mb=function(){var t=ar();return!fr(t)&&!vr(t)},t.Hb=function(){return!1},t.Db=function(t,e,n,r,i,o,s){if(!t)return Tt(new jr("popup-blocked"));if(s&&!fr())return this.ga().s(function(e){Wn(t),i(e)}),r(),Et();this.a||(this.a=ba(_a(this)));var a=this;return this.a.then(function(){var e=a.ga().s(function(e){throw Wn(t),i(e),e});return r(),e}).then(function(){eo(n),s||Hn(Ea(a.l,a.f,a.b,e,n,null,o,a.c,void 0,a.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(a.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=ba(_a(this)));var r=this;return this.a.then(function(){eo(e),Hn(Ea(r.l,r.f,r.b,t,e,Gn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return wa(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new jr("network-request-failed")})},t.Qb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ka=function(t){B(this.g,function(e){return e==t})},(t=Ta.prototype).get=function(t){return Et(this.a.getItem(t)).then(function(t){return t&&gr(t)})},t.set=function(t,e){return Et(this.a.setItem(t,pr(e)))},t.P=function(t){return Et(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Sa,Ca=[];function Aa(t){this.a=t}function Ia(t){this.c=t,this.b=!1,this.a=[]}function Oa(t,e,n,r){var i,o,s,a,u=n||{},c=null;if(t.b)return Tt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new mt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),s=setTimeout(function(){r(Error("unsupported_event"))},h),t.a.push(c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(s),a=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(a),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(s),clearTimeout(a),r(Error("invalid_response"))))}}),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return Da(t,c),e}).s(function(e){throw Da(t,c),e})}function Da(t,e){if(e){var n=e.messageChannel;n&&(n.port1.removeEventListener("message",e.onMessage),n.port1.close()),B(t.a,function(t){return t==e})}}function ka(){if(!Na())throw new jr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=n.indexedDB,this.type="indexedDB",this.g=this.o=this.f=this.i=null,this.u=!1,this.h=null;var t=this;Zn()&&self?(this.o=function(){var t=Zn()?self:null;if(N(Ca,function(n){n.b==t&&(e=n)}),!e){var e=new xa(t);Ca.push(e)}return e}(),this.o.subscribe("keyChanged",function(e,n){return Ba(t).then(function(e){return 0<e.length&&N(t.a,function(t){t(e)}),{keyProcessed:L(e,n.key)}})}),this.o.subscribe("ping",function(){return Et(["keyChanged"])})):function(){var t=n.navigator;return t&&t.serviceWorker?Et().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Et(null)}().then(function(e){(t.h=e)&&(t.g=new Ia(new Aa(e)),Oa(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&L(e[0].value,"keyChanged")&&(t.u=!0)}).s(function(){}))})}function Pa(t){return t.m||(t.m=function t(e){return new mt(function(n,r){var i=e.l.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(e){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){r(e)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new mt(function(e,n){var r=t.l.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(e).then(function(){return t(e)}).then(function(t){n(t)}).s(function(t){r(t)})}})}(t)),t.m}function Na(){try{return!!n.indexedDB}catch(qt){return!1}}function Ma(t){return t.objectStore("firebaseLocalStorage")}function Ra(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function La(t){return new mt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Fa(t,e){return t.g&&t.h&&function(){var t=n.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Oa(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):Et()}function Ba(t){return Pa(t).then(function(t){var e=Ma(Ra(t,!1));return e.getAll?La(e.getAll()):new mt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function Ua(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function Va(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Et().then(function(){if(Na()){var t=yr(),r="__sak"+t;return Sa||(Sa=new ka),(n=Sa).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){N(e.a,function(e){e(t)})}),t})}function ja(){this.a={},this.type="inMemory"}function qa(){if(!function(){var t="Node"==tr();if(!(t=Ga()||t&&Jc.a.INTERNAL.node&&Jc.a.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==tr())throw new jr("internal-error","The LocalStorage compatibility library was not found.");throw new jr("web-storage-unsupported")}this.a=Ga()||Jc.a.INTERNAL.node.localStorage,this.type="localStorage"}function Ga(){try{var t=n.localStorage,e=yr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(r){return null}}function Ha(){this.type="nullStorage"}function za(){if(!function(){var t="Node"==tr();if(!(t=Wa()||t&&Jc.a.INTERNAL.node&&Jc.a.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==tr())throw new jr("internal-error","The SessionStorage compatibility library was not found.");throw new jr("web-storage-unsupported")}this.a=Wa()||Jc.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Wa(){try{var t=n.sessionStorage,e=yr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(r){return null}}function Ka(){var t={};t.Browser=Ya,t.Node=Ja,t.ReactNative=$a,t.Worker=Za,this.a=t[tr()]}xa.prototype.f=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];N(r,function(e){i.push(Et().then(function(){return e(t.origin,t.data.data)}))}),St(i).then(function(r){var i=[];N(r,function(t){i.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),N(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},xa.prototype.subscribe=function(t,e){nt(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},xa.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(B(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],nt(this.a)&&this.b.removeEventListener("message",this.c)},Aa.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ia.prototype.close=function(){for(;0<this.a.length;)Da(this,this.a[0]);this.b=!0},(t=ka.prototype).set=function(t,e){var n,r=!1,i=this;return Pa(this).then(function(e){return La((e=Ma(Ra(n=e,!0))).get(t))}).then(function(o){var s=Ma(Ra(n,!0));return o?(o.value=e,La(s.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,La(s.add(o)))}).then(function(){return i.c[t]=e,Fa(i,t)}).ia(function(){r&&i.b--})},t.get=function(t){return Pa(this).then(function(e){return La(Ma(Ra(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return Pa(this).then(function(r){return e=!0,n.b++,La(Ma(Ra(r,!0)).delete(t))}).then(function(){return delete n.c[t],Fa(n,t)}).ia(function(){e&&n.b--})},t.Y=function(t){0==this.a.length&&function(t){Ua(t),function e(){t.f=setTimeout(function(){t.i=Ba(t).then(function(e){0<e.length&&N(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(t){B(this.a,function(e){return e==t}),0==this.a.length&&Ua(this)},(t=Va.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){B(this.a,function(e){return e==t})},(t=ja.prototype).get=function(t){return Et(this.a[t])},t.set=function(t,e){return this.a[t]=e,Et()},t.P=function(t){return delete this.a[t],Et()},t.Y=function(){},t.ca=function(){},(t=qa.prototype).get=function(t){var e=this;return Et().then(function(){return gr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Et().then(function(){var r=pr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Et().then(function(){e.a.removeItem(t)})},t.Y=function(t){n.window&&be(n.window,"storage",t)},t.ca=function(t){n.window&&Ee(n.window,"storage",t)},(t=Ha.prototype).get=function(){return Et(null)},t.set=function(){return Et()},t.P=function(){return Et()},t.Y=function(){},t.ca=function(){},(t=za.prototype).get=function(t){var e=this;return Et().then(function(){return gr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Et().then(function(){var r=pr(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return Et().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var Xa,Qa,Ya={B:qa,Sa:za},Ja={B:qa,Sa:za},$a={B:Ta,Sa:Ha},Za={B:qa,Sa:Ha},tu={ad:"local",NONE:"none",cd:"session"};function eu(){var t=!(vr(ar())||!$n()),e=fr(),r=cr();this.m=t,this.h=e,this.o=r,this.a={},Xa||(Xa=new Ka),t=Xa;try{this.g=!qn()&&Tr()||!n.indexedDB?new t.a.B:new Va(Zn()?new ja:new t.a.B)}catch(i){this.g=new ja,this.h=!0}try{this.i=new t.a.Sa}catch(i){this.i=new ja}this.l=new ja,this.f=v(this.Pb,this),this.b={}}function nu(){return Qa||(Qa=new eu),Qa}function ru(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function iu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function ou(t,e,n){return n=iu(e,n),"local"==e.B&&(t.b[n]=null),ru(t,e.B).P(n)}function su(t){t.c&&(clearInterval(t.c),t.c=null)}function au(t){this.a=t,this.b=nu()}(t=eu.prototype).get=function(t,e){return ru(this,t.B).get(iu(t,e))},t.set=function(t,e,n){var r=iu(t,n),i=this,o=ru(this,t.B);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.B&&(i.b[r]=e)})},t.addListener=function(t,e,r){t=iu(t,e),this.o&&(this.b[t]=n.localStorage.getItem(t)),nt(this.a)&&(ru(this,"local").Y(this.f),this.h||(qn()||!Tr())&&n.indexedDB||!this.o||function(t){su(t),t.c=setInterval(function(){for(var e in t.a){var r=n.localStorage.getItem(e),i=t.b[e];r!=i&&(t.b[e]=r,r=new ue({type:"storage",key:e,target:window,oldValue:i,newValue:r,a:!0}),t.Pb(r))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(r)},t.removeListener=function(t,e,n){t=iu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),nt(this.a)&&(ru(this,"local").ca(this.f),su(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var r in this.a){var i=this.b[r];void 0===i&&(i=null);var o=n.localStorage.getItem(r);o!==i&&(this.b[r]=o,this.Ya(r))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?ru(this,"local").ca(this.f):su(this),this.m)if(r=n.localStorage.getItem(e),(i=t.a.newValue)!==r)null!==i?n.localStorage.setItem(e,i):n.localStorage.removeItem(e);else if(this.b[e]===i&&void 0===t.a.a)return;var s=this;r=function(){void 0===t.a.a&&s.b[e]===n.localStorage.getItem(e)||(s.b[e]=n.localStorage.getItem(e),s.Ya(e))},Ht&&Zt&&10==Zt&&n.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(r,10):r()}}else N(t,v(this.Ya,this))},t.Ya=function(t){this.a[t]&&N(this.a[t],function(t){t()})};var uu,cu={name:"authEvent",B:"local"};function hu(){this.a=nu()}function lu(t,e){this.b=du,this.f=n.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.o=n.Int32Array?new Int32Array(64):Array(64),void 0!==uu||(uu=n.Int32Array?new Int32Array(bu):bu),this.reset()}_(lu,function(){this.b=-1});for(var du=64,fu=du-1,pu=[],mu=0;mu<fu;mu++)pu[mu]=0;var gu=U(128,pu);function yu(t){for(var e=t.f,n=t.o,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){var o=(0|n[e-16])+(((i=0|n[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,s=(0|n[e-7])+(((r=0|n[e-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+s|0}r=0|t.a[0],i=0|t.a[1];var a=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var d=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&a^i&a)|0;s=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((s=(s=c&h^~c&l)+(0|uu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+s|0,u=a,a=i,i=r,r=s+d|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+a|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function vu(t,e,n){void 0===n&&(n=e.length);var i=0,o=t.c;if(r(e))for(;i<n;)t.f[o++]=e.charCodeAt(i++),o==t.b&&(yu(t),o=0);else{if(!l(e))throw Error("message must be string or array");for(;i<n;){var s=e[i++];if(!("number"==typeof s&&0<=s&&255>=s&&s==(0|s)))throw Error("message must be a byte array");t.f[o++]=s,o==t.b&&(yu(t),o=0)}}t.c=o,t.g+=n}lu.prototype.reset=function(){this.g=this.c=0,this.a=n.Int32Array?new Int32Array(this.h):V(this.h)};var bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function wu(){lu.call(this,8,_u)}_(wu,lu);var _u=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Eu(t,e,n,r,i){this.l=t,this.i=e,this.o=n,this.m=r||null,this.u=i||null,this.h=e+":"+n,this.v=new hu,this.g=new au(this.h),this.f=null,this.b=[],this.a=this.c=null}function Tu(t){return new jr("invalid-cordova-configuration",t)}function xu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(r){}}function Su(t){return t.f||(t.f=t.ga().then(function(){return new mt(function(e){t.wa(function n(r){return e(r),t.Ka(n),!1}),function(t){function e(e){i=!0,o&&o.cancel(),Cu(t).then(function(n){var i=r;if(n&&e&&e.url){var o=null;-1!=(i=xi(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=gr(Xe(o=Qe(i),"firebaseError")||null))?qr(o):null)?new no(n.c,n.b,null,null,o):new no(n.c,n.b,i,n.f)),i=o||r}xu(t,i)})}var r=new no("unknown",null,null,null,new jr("no-auth-event")),i=!1,o=Le(500).then(function(){return Cu(t).then(function(){i||xu(t,r)})}),s=n.handleOpenURL;n.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(ur("BuildInfo.packageName",n).toLowerCase()+"://")&&e({url:t}),"function"==typeof s)try{s(t)}catch(r){console.error(r)}},so||(so=new io),so.subscribe(e)}(t)})})),t.f}function Cu(t){var e=null;return function(t){return t.b.get(cu,t.a).then(function(t){return ro(t)})}(t.g).then(function(n){return e=n,ou((n=t.g).b,cu,n.a)}).then(function(){return e})}function Au(t){this.a=t,this.b=nu()}(t=Eu.prototype).ga=function(){return this.za?this.za:this.za=(Jn(void 0)?Yn().then(function(){return new mt(function(t,e){var r=n.document,i=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);r.addEventListener("deviceready",function(){clearTimeout(i),t()},!1)})}):Tt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof ur("universalLinks.subscribe",n))throw Tu("cordova-universal-links-plugin-fix is not installed");if(void 0===ur("BuildInfo.packageName",n))throw Tu("cordova-plugin-buildinfo is not installed");if("function"!=typeof ur("cordova.plugins.browsertab.openUrl",n))throw Tu("cordova-plugin-browsertab is not installed");if("function"!=typeof ur("cordova.InAppBrowser.open",n))throw Tu("cordova-plugin-inappbrowser is not installed")},function(){throw new jr("cordova-not-ready")})},t.Ea=function(t,e){return e(new jr("operation-not-supported-in-this-environment")),Et()},t.Db=function(){return Tt(new jr("operation-not-supported-in-this-environment"))},t.Qb=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,r){if(this.c)return Tt(new jr("redirect-operation-pending"));var i=this,o=n.document,s=null,a=null,u=null,c=null;return this.c=Et().then(function(){return eo(e),Su(i)}).then(function(){return function(t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new no(e,i,null,o,new jr("no-auth-event")),a=ur("BuildInfo.packageName",n);if("string"!=typeof a)throw new jr("invalid-cordova-configuration");var u=ur("BuildInfo.displayName",n),c={};if(ar().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=a;else{if(!ar().toLowerCase().match(/android/))return Tt(new jr("operation-not-supported-in-this-environment"));c.apn=a}u&&(c.appDisplayName=u),o=function(t){var e=new wu;vu(e,t),t=[];var n=8*e.g;vu(e,gu,56>e.c?56-e.c:e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(yu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return M(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}(o),c.sessionId=o;var h=Ea(t.l,t.i,t.o,e,r,null,i,t.m,c,t.u);return t.ga().then(function(){var e=t.h;return t.v.a.set(cu,s.w(),e)}).then(function(){var e=ur("cordova.plugins.browsertab.isAvailable",n);if("function"!=typeof e)throw new jr("invalid-cordova-configuration");var r=null;e(function(e){if(e){if("function"!=typeof(r=ur("cordova.plugins.browsertab.openUrl",n)))throw new jr("invalid-cordova-configuration");r(h)}else{if("function"!=typeof(r=ur("cordova.InAppBrowser.open",n)))throw new jr("invalid-cordova-configuration");e=ar(),t.a=r(h,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,r)}).then(function(){return new mt(function(t,e){a=function(){var e=ur("cordova.plugins.browsertab.close",n);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.wa(a),c=function(){_r()&&u()},o.addEventListener("resume",u=function(){s||(s=Le(2e3).then(function(){e(new jr("redirect-cancelled-by-user"))}))},!1),ar().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Cu(i).then(function(){throw t})})}).ia(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),s&&s.cancel(),a&&i.Ka(a),i.c=null})},t.wa=function(t){this.b.push(t),Su(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new no("unknown",null,null,null,new jr("no-auth-event")),t(e))})},t.Ka=function(t){B(this.b,function(e){return e==t})};var Iu={name:"pendingRedirect",B:"session"};function Ou(t){return ou(t.b,Iu,t.a)}function Du(t,e,n){this.i={},this.u=0,this.A=t,this.l=e,this.m=n,this.h=[],this.f=!1,this.o=v(this.cb,this),this.b=new Vu,this.v=new Hu,this.g=new Au(this.l+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.v,this.c.linkViaPopup=this.v,this.c.reauthViaPopup=this.v,this.a=ku(this.A,this.l,this.m,ai)}function ku(t,e,n,r){var i=Jc.a.SDK_VERSION||null;return Jn()?new Eu(t,e,n,i,r):new va(t,e,n,i,r)}function Pu(t){t.f||(t.f=!0,t.a.wa(t.o));var e=t.a;return t.a.ga().s(function(n){throw t.a==e&&t.reset(),n})}function Nu(t){t.a.Mb()&&Pu(t).s(function(e){var n=new no("unknown",null,null,null,new jr("operation-not-supported-in-this-environment"));Fu(e)&&t.cb(n)}),t.a.Hb()||ju(t.b)}(t=Du.prototype).reset=function(){this.f=!1,this.a.Ka(this.o),this.a=ku(this.A,this.l,this.m),this.i={}},t.Za=function(){this.b.Za()},t.subscribe=function(t){if(L(this.h,t)||this.h.push(t),!this.f){var e=this;(function(t){return t.b.get(Iu,t.a).then(function(t){return"pending"==t})})(this.g).then(function(t){t?Ou(e.g).then(function(){Pu(e).s(function(t){var n=new no("unknown",null,null,null,new jr("operation-not-supported-in-this-environment"));Fu(t)&&e.cb(n)})}):Nu(e)}).s(function(){Nu(e)})}},t.unsubscribe=function(t){B(this.h,function(e){return e==t})},t.cb=function(t){if(!t)throw new jr("invalid-auth-event");if(6e5<=w()-this.u&&(this.i={},this.u=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.wb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.u=w())),e=!0;break}}return ju(this.b),e};var Mu=new wr(2e3,1e4),Ru=new wr(3e4,6e4);function Lu(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.o))},function(){t.reset()},i,o)}function Fu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}Du.prototype.fa=function(){return this.b.fa()},Du.prototype.Ca=function(t,e,n){var r,i=this;return function(t){return t.b.set(Iu,"pending",t.a)}(this.g).then(function(){return i.a.Ca(t,e,n).s(function(t){if(Fu(t))throw new jr("operation-not-supported-in-this-environment");return r=t,Ou(i.g).then(function(){throw r})}).then(function(){return i.a.Qb()?new mt(function(){}):Ou(i.g).then(function(){return i.fa()}).then(function(){}).s(function(){})})})},Du.prototype.Ea=function(t,e,n,r){return this.a.Ea(n,function(n){t.ha(e,null,n,r)},Mu.get())};var Bu={};function Uu(t,e,n){var r=e+":"+n;return Bu[r]||(Bu[r]=new Du(t,e,n)),Bu[r]}function Vu(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function ju(t){t.g||(t.g=!0,Gu(t,!1,null,null))}function qu(t,e){if(t.b=function(){return Et(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Gu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Tt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):qu(t,n):qu(t,{user:null}),t.f=[],t.c=[]}function Hu(){}function zu(){this.tb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.tb},set:function(t){this.tb=t},enumerable:!1})}function Wu(t,e){this.a=e,Ir(this,"verificationId",t)}function Ku(t,e,n,r){return new $i(t).Va(e,n).then(function(t){return new Wu(t,r)})}function Xu(t){var e=si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new jr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Or(this,{token:t,expirationTime:Er(1e3*e.exp),authTime:Er(1e3*e.auth_time),issuedAtTime:Er(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Qu(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Yu(t){this.f=t,this.b=this.a=null,this.c=0}function Ju(t,e){var n=e[ds],r=e.refreshToken;e=$u(e.expiresIn),t.b=n,t.c=e,t.a=r}function $u(t){return w()+1e3*parseInt(t,10)}function Zu(t,e){this.a=t||null,this.b=e||null,Or(this,{lastSignInTime:Er(e||null),creationTime:Er(t||null)})}function tc(t,e,n,r,i,o){Or(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function ec(t,e){for(var n in ae.call(this,t),e)this[n]=e[n]}function nc(t,e,n){this.G=[],this.l=t.apiKey,this.m=t.appName,this.u=t.authDomain||null,t=Jc.a.SDK_VERSION?sr(Jc.a.SDK_VERSION):null,this.b=new hs(this.l,ci(ai),t),this.h=new Yu(this.b),cc(this,e[ds]),Ju(this.h,e),Ir(this,"refreshToken",this.h.a),dc(this,n||{}),ke.call(this),this.I=!1,this.u&&hr()&&(this.a=Uu(this.u,this.l,this.m)),this.N=[],this.i=null,this.A=function(t){return new Qu(function(){return t.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.h.c-w()-3e5;return 0<e?e:0})}(this),this.V=v(this.Ha,this);var r=this;this.ka=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){ic(r,t.c)},this.W=null}function rc(t,e){t.X&&Ee(t.X,"languageCodeChanged",t.ta),(t.X=e)&&be(e,"languageCodeChanged",t.ta)}function ic(t,e){t.O=e,vs(t.b,Jc.a.SDK_VERSION?sr(Jc.a.SDK_VERSION,t.O):null)}function oc(t,e){t.W&&Ee(t.W,"frameworkChanged",t.sa),(t.W=e)&&be(e,"frameworkChanged",t.sa)}function sc(t){try{return Jc.a.app(t.m).auth()}catch(e){throw new jr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function ac(t){t.D||t.A.b||(t.A.start(),Ee(t,"tokenChanged",t.V),be(t,"tokenChanged",t.V))}function uc(t){Ee(t,"tokenChanged",t.V),t.A.stop()}function cc(t,e){t.ra=e,Ir(t,"_lat",e)}function hc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return St(e).then(function(){return t})}function lc(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function dc(t,e){Or(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new Zu(e.createdAt,e.lastLoginAt),providerData:[]})}function fc(){}function pc(t){return Et().then(function(){if(t.D)throw new jr("app-deleted")})}function mc(t){return M(t.providerData,function(t){return t.providerId})}function gc(t,e){e&&(yc(t,e.providerId),t.providerData.push(e))}function yc(t,e){B(t.providerData,function(t){return t.providerId==e})}function vc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Ir(t,e,n)}function bc(t,e){t!=e&&(Or(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),Ir(t,"metadata",e.metadata?function(t){return new Zu(t.a,t.b)}(e.metadata):new Zu),N(e.providerData,function(e){gc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.h,e.h),Ir(t,"refreshToken",t.h.a))}function wc(t){return t.F().then(function(e){var n=t.isAnonymous;return function(t,e){return aa(t.b,qs,{idToken:e}).then(v(t.zc,t))}(t,e).then(function(){return n||vc(t,"isAnonymous",!1),e})})}function _c(t,e){e[ds]&&t.ra!=e[ds]&&(Ju(t.h,e),t.dispatchEvent(new ec("tokenChanged")),cc(t,e[ds]),vc(t,"refreshToken",t.h.a))}function Ec(t,e){return wc(t).then(function(){if(L(mc(t),e))return hc(t).then(function(){throw new jr("provider-already-linked")})})}function Tc(t,e,n){return Dr({user:t,credential:to(e),additionalUserInfo:e=pi(e),operationType:n})}function xc(t,e){return _c(t,e),t.reload().then(function(){return t})}function Sc(t,e,n,r,i){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Tt(t.i);var o=fi(n.providerId),s=yr(t.uid+":::"),a=null;(!fr()||$n())&&t.u&&n.isOAuthProvider&&(a=Ea(t.u,t.l,t.m,e,n,null,s,Jc.a.SDK_VERSION||null));var u=Kn(a,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(Ac(t),!i)return t.F().then(function(){})}).then(function(){return Lu(t.a,u,e,n,s,!!a)}).then(function(){return new mt(function(n,r){t.ha(e,null,new jr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=s,t.c=t.a.Ea(t,e,u,s)})}).then(function(t){return u&&Wn(u),t?Dr(t):null}).s(function(t){throw u&&Wn(u),t}),Ic(t,r,i)}function Cc(t,e,n,r,i){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));if(t.i&&!i)return Tt(t.i);var o=null,s=yr(t.uid+":::");return r=r().then(function(){if(Ac(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=s,hc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(kc,t.w(),e.a)),e}).then(function(){return t.a.Ca(e,n,s)}).s(function(e){if(o=e,t.ba)return Pc(t.ba);throw o}).then(function(){if(o)throw o}),Ic(t,r,i)}function Ac(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new jr("internal-error");throw new jr("auth-domain-config-required")}}function Ic(t,e,n){var r=function(t,e,n){return t.i&&!n?(e.cancel(),Tt(t.i)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.i||t.dispatchEvent(new ec("userInvalidated")),t.i=e),e})}(t,e,n);return t.G.push(r),r.ia(function(){F(t.G,r)}),r}function Oc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[ds]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-w())/1e3;var r=new nc(e,n,t);return t.providerData&&N(t.providerData,function(t){t&&gc(r,Dr(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Dc(t){this.a=t,this.b=nu()}Vu.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Vu.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Gu(this,!0,null,t.a),Et()):e.xa(n,r)?function(t,e,n){n=n.xa(e.c,e.b);var r=e.g,i=e.f,o=e.h,s=!!e.c.match(/Redirect$/);n(r,i,o).then(function(e){Gu(t,s,e,null)}).s(function(e){Gu(t,s,null,e)})}(this,t,e):Tt(new jr("invalid-auth-event")):(Gu(this,!1,null,null),Et())}else Tt(new jr("invalid-auth-event"))},Vu.prototype.Za=function(){this.g&&!this.i&&Gu(this,!1,null,null)},Vu.prototype.fa=function(){var t=this;return new mt(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new jr("timeout");t.a&&t.a.cancel(),t.a=Le(Ru.get()).then(function(){t.b||(t.g=!0,Gu(t,!0,null,e))})}(t))})},Hu.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ha(t.c,null,t.a,t.b),Et()):e.xa(n,r)?function(t,e){var n=t.b,r=t.c;e.xa(r,n)(t.g,t.f,t.h).then(function(t){e.ha(r,t,null,n)}).s(function(t){e.ha(r,null,t,n)})}(t,e):Tt(new jr("invalid-auth-event"))}else Tt(new jr("invalid-auth-event"))},Wu.prototype.confirm=function(t){return t=Zi(this.verificationId,t),this.a(t)},Qu.prototype.start=function(){this.a=this.c,function t(e,r){e.stop(),e.b=Le(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,r)).then(function(){return function(){var t=n.document,e=null;return _r()||!t?Et():new mt(function(n){e=function(){_r()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n})}()}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},Qu.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Yu.prototype.w=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Yu.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Tt(new jr("user-token-expired")):t||!this.b||w()>this.c-3e4?this.a?function(t,e){return function(t,e){return new mt(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?bs(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?r(ca(t)):t.access_token&&t.refresh_token?n(t):r(new jr("internal-error")):r(new jr("network-request-failed"))},"POST",un(e).toString(),t.f,t.o.get()):r(new jr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=$u(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}(this,{grant_type:"refresh_token",refresh_token:this.a}):Et(null):Et({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},Zu.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},_(ec,ae),_(nc,ke),nc.prototype.pa=function(t){this.ka=t,ys(this.b,t)},nc.prototype.ea=function(){return this.ka},nc.prototype.ya=function(){return V(this.O)},nc.prototype.Ha=function(){this.A.b&&(this.A.stop(),this.A.start())},Ir(nc.prototype,"providerId","firebase"),(t=nc.prototype).reload=function(){var t=this;return Ic(this,pc(this).then(function(){return wc(t).then(function(){return hc(t)}).then(fc)}))},t.dc=function(t){return this.F(t).then(function(t){return new Xu(t)})},t.F=function(t){var e=this;return Ic(this,pc(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new jr("internal-error");return t.accessToken!=e.ra&&(cc(e,t.accessToken),e.dispatchEvent(new ec("tokenChanged"))),vc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new jr("internal-error");dc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?M(t,function(t){return new tc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)gc(this,e[n]);vc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.hb=function(t){var e=this,n=null;return Ic(this,t.f(this.b,this.uid).then(function(t){return _c(e,t),n=Tc(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.Ac=function(t){return Cr("firebase.User.prototype.reauthenticateWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential instead."),this.hb(t).then(function(){})},t.fb=function(t){var e=this,n=null;return Ic(this,Ec(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.b,n)}).then(function(t){return n=Tc(e,t,"link"),xc(e,t)}).then(function(){return n}))},t.rc=function(t){return Cr("firebase.User.prototype.linkWithCredential is deprecated. Please use firebase.User.prototype.linkAndRetrieveDataWithCredential instead."),this.fb(t).then(function(t){return t.user})},t.sc=function(t,e){var n=this;return Ic(this,Ec(this,"phone").then(function(){return Ku(sc(n),t,e,v(n.fb,n))}))},t.Bc=function(t,e){var n=this;return Ic(this,Et().then(function(){return Ku(sc(n),t,e,v(n.hb,n))}),!0)},t.qb=function(t){var e=this;return Ic(this,this.F().then(function(n){return e.b.qb(n,t)}).then(function(t){return _c(e,t),e.reload()}))},t.Tc=function(t){var e=this;return Ic(this,this.F().then(function(n){return t.b(e.b,n)}).then(function(t){return _c(e,t),e.reload()}))},t.rb=function(t){var e=this;return Ic(this,this.F().then(function(n){return e.b.rb(n,t)}).then(function(t){return _c(e,t),e.reload()}))},t.sb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return pc(this);var e=this;return Ic(this,this.F().then(function(n){return e.b.sb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return _c(e,t),vc(e,"displayName",t.displayName||null),vc(e,"photoURL",t.photoUrl||null),N(e.providerData,function(t){"password"===t.providerId&&(Ir(t,"displayName",e.displayName),Ir(t,"photoURL",e.photoURL))}),hc(e)}).then(fc))},t.Rc=function(t){var e=this;return Ic(this,wc(this).then(function(n){return L(mc(e),t)?function(t,e,n){return aa(t,Us,{idToken:e,deleteProvider:n})}(e.b,n,[t]).then(function(t){var n={};return N(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),N(mc(e),function(t){n[t]||yc(e,t)}),n[$i.PROVIDER_ID]||Ir(e,"phoneNumber",null),hc(e)}):hc(e).then(function(){throw new jr("no-such-provider")})}))},t.delete=function(){var t=this;return Ic(this,this.F().then(function(e){return aa(t.b,Bs,{idToken:e})}).then(function(){t.dispatchEvent(new ec("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");rc(t,null),oc(t,null),t.G=[],t.D=!0,uc(t),Ir(t,"refreshToken",null),t.a&&t.a.unsubscribe(t)})},t.wb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?v(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?v(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?v(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?v(this.Cb,this):null},t.tc=function(t){var e=this;return Sc(this,"linkViaPopup",t,function(){return Ec(e,t.providerId).then(function(){return hc(e)})},!1)},t.Cc=function(t){return Sc(this,"reauthViaPopup",t,function(){return Et()},!0)},t.uc=function(t){var e=this;return Cc(this,"linkViaRedirect",t,function(){return Ec(e,t.providerId)},!1)},t.Dc=function(t){return Cc(this,"reauthViaRedirect",t,function(){return Et()},!0)},t.Bb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return Ic(this,this.F().then(function(i){return ks(r.b,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=Tc(r,t,"link"),xc(r,t)}).then(function(){return i}))},t.Cb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return Ic(this,Et().then(function(){return Ci(Ps(r.b,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Tc(r,t,"reauthenticate"),_c(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.kb=function(t){var e=this,n=null;return Ic(this,this.F().then(function(e){return n=e,void 0===t||nt(t)?{}:ei(new zr(t))}).then(function(t){return e.b.kb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.w()},t.w=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.u,stsTokenManager:this.h.w(),redirectEventId:this.aa||null};return this.metadata&&at(t,this.metadata.w()),N(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var kc={name:"redirectUser",B:"session"};function Pc(t){return ou(t.b,kc,t.a)}function Nc(t){this.a=t,this.b=nu(),this.c=null,this.f=function(t){var e=Lc("local"),r=Lc("session"),i=Lc("none");return function(t,e,r){var i=iu(e,r),o=ru(t,e.B);return t.get(e,r).then(function(s){var a=null;try{a=gr(n.localStorage.getItem(i))}catch(u){}if(a&&!s)return n.localStorage.removeItem(i),t.set(e,a,r);a&&s&&"localStorage"!=o.type&&n.localStorage.removeItem(i)})}(t.b,e,t.a).then(function(){return t.b.get(r,t.a)}).then(function(n){return n?r:t.b.get(i,t.a).then(function(n){return n?i:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(Rc,t.a).then(function(t){return t?Lc(t):e})})})}).then(function(e){return t.c=e,Mc(t,e.B)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener(Lc("local"),this.a,v(this.g,this))}function Mc(t,e){var n,r=[];for(n in tu)tu[n]!==e&&r.push(ou(t.b,Lc(tu[n]),t.a));return r.push(ou(t.b,Rc,t.a)),function(t){return new mt(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},s=function(t){n(t)},a=0;a<t.length;a++)xt(t[a],b(o,a),s);else e(i)})}(r)}Nc.prototype.g=function(){var t=this,e=Lc("local");Vc(this,function(){return Et().then(function(){return t.c&&"local"!=t.c.B?t.b.get(e,t.a):null}).then(function(n){if(n)return Mc(t,"local").then(function(){t.c=e})})})};var Rc={name:"persistence",B:"session"};function Lc(t){return{name:"authUser",B:t}}function Fc(t,e){return Vc(t,function(){return t.b.set(t.c,e.w(),t.a)})}function Bc(t){return Vc(t,function(){return ou(t.b,t.c,t.a)})}function Uc(t,e){return Vc(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Oc(t||{})})})}function Vc(t,e){return t.f=t.f.then(e,e),t.f}function jc(t){if(this.l=!1,Ir(this,"settings",new zu),Ir(this,"app",t),!Xc(this).options||!Xc(this).options.apiKey)throw new jr("invalid-api-key");t=Jc.a.SDK_VERSION?sr(Jc.a.SDK_VERSION):null,this.b=new hs(Xc(this).options&&Xc(this).options.apiKey,ci(ai),t),this.N=[],this.m=[],this.I=[],this.Tb=Jc.a.INTERNAL.createSubscribe(v(this.oc,this)),this.O=void 0,this.Ub=Jc.a.INTERNAL.createSubscribe(v(this.pc,this)),Wc(this,null),this.h=new Nc(Xc(this).options.apiKey+":"+Xc(this).name),this.A=new Dc(Xc(this).options.apiKey+":"+Xc(this).name),this.V=Zc(this,function(t){var e=Xc(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(kc,t.a).then(function(t){return t&&e&&(t.authDomain=e),Oc(t||{})})}(t.A,Xc(t).options.authDomain).then(function(e){return(t.D=e)&&(e.ba=t.A),Pc(t.A)});return Zc(t,e)}(t).then(function(){return Uc(t.h,e)}).then(function(e){return e?(e.ba=t.A,t.D&&(t.D.aa||null)==(e.aa||null)?e:e.reload().then(function(){return Fc(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:Bc(t.h)})):null}).then(function(e){Wc(t,e||null)});return Zc(t,n)}(this)),this.i=Zc(this,function(t){return t.V.then(function(){return t.fa()}).s(function(){}).then(function(){if(!t.l)return t.ka()}).s(function(){}).then(function(){if(!t.l){t.X=!0;var e=t.h;e.b.addListener(Lc("local"),e.a,t.ka)}})}(this)),this.X=!1,this.ka=v(this.Oc,this),this.Ha=v(this.Z,this),this.ra=v(this.bc,this),this.sa=v(this.mc,this),this.ta=v(this.nc,this),function(t){var e=Xc(t).options.authDomain,n=Xc(t).options.apiKey;e&&hr()&&(t.Sb=t.V.then(function(){if(!t.l){if(t.a=Uu(e,n,Xc(t).name),t.a.subscribe(t),Qc(t)&&lc(Qc(t)),t.D){lc(t.D);var r=t.D;r.pa(t.ea()),rc(r,t),ic(r=t.D,t.G),oc(r,t),t.D=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=v(this.delete,this),this.INTERNAL.logFramework=v(this.vc,this),this.u=0,ke.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function qc(t){ae.call(this,"languageCodeChanged"),this.g=t}function Gc(t){ae.call(this,"frameworkChanged"),this.c=t}function Hc(t){return t.Sb||Tt(new jr("auth-domain-config-required"))}function zc(t,e){var n={};return n.apiKey=Xc(t).options.apiKey,n.authDomain=Xc(t).options.authDomain,n.appName=Xc(t).name,t.V.then(function(){return function(t,e,n,r){var i=new nc(t,e);return n&&(i.ba=n),r&&ic(i,r),i.reload().then(function(){return i})}(n,e,t.A,t.ya())}).then(function(e){return Qc(t)&&e.uid==Qc(t).uid?(bc(Qc(t),e),t.Z(e)):(Wc(t,e),lc(e),t.Z(e))}).then(function(){$c(t)})}function Wc(t,e){Qc(t)&&(function(t,e){B(t.N,function(t){return t==e})}(Qc(t),t.Ha),Ee(Qc(t),"tokenChanged",t.ra),Ee(Qc(t),"userDeleted",t.sa),Ee(Qc(t),"userInvalidated",t.ta),uc(Qc(t))),e&&(e.N.push(t.Ha),be(e,"tokenChanged",t.ra),be(e,"userDeleted",t.sa),be(e,"userInvalidated",t.ta),0<t.u&&ac(e)),Ir(t,"currentUser",e),e&&(e.pa(t.ea()),rc(e,t),ic(e,t.G),oc(e,t))}function Kc(t,e){var n=null,r=null;return Zc(t,e.then(function(e){return n=to(e),r=pi(e),zc(t,e)}).then(function(){return Dr({user:Qc(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Xc(t){return t.app}function Qc(t){return t.currentUser}function Yc(t){return Qc(t)&&Qc(t)._lat||null}function $c(t){if(t.X){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Yc(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](Yc(t))}}function Zc(t,e){return t.N.push(e),e.ia(function(){F(t.N,e)}),e}function th(){}function eh(){this.a={},this.b=1e12}Nc.prototype.nb=function(t){var e=null,n=this;return function(t){var e=new jr("invalid-persistence-type"),n=new jr("unsupported-persistence-type");t:{for(r in tu)if(tu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(tr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!cr()&&"none"!==t)throw n}}(t),Vc(this,function(){return t!=n.c.B?n.b.get(n.c,n.a).then(function(r){return e=r,Mc(n,t)}).then(function(){if(n.c=Lc(t),e)return n.b.set(n.c,e,n.a)}):Et()})},_(jc,ke),_(qc,ae),_(Gc,ae),(t=jc.prototype).nb=function(t){return Zc(this,t=this.h.nb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,ys(this.b,this.W),this.dispatchEvent(new qc(this.ea())))},t.ea=function(){return this.W},t.Uc=function(){var t=n.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.G.push(t),vs(this.b,Jc.a.SDK_VERSION?sr(Jc.a.SDK_VERSION,this.G):null),this.dispatchEvent(new Gc(this.G))},t.ya=function(){return V(this.G)},t.toJSON=function(){return{apiKey:Xc(this).options.apiKey,authDomain:Xc(this).options.authDomain,appName:Xc(this).name,currentUser:Qc(this)&&Qc(this).w()}},t.wb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?v(this.ac,this):null},t.ac=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.c&&(this.c.cancel(),this.c=null);var i=null,o=null,s=Ds(r.b,t).then(function(t){return i=to(t),o=pi(t),t});return Zc(this,t=r.V.then(function(){return s}).then(function(t){return zc(r,t)}).then(function(){return Dr({user:Qc(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Mc=function(t){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));var e=this,n=fi(t.providerId),r=yr(),i=null;(!fr()||$n())&&Xc(this).options.authDomain&&t.isOAuthProvider&&(i=Ea(Xc(this).options.authDomain,Xc(this).options.apiKey,Xc(this).name,"signInViaPopup",t,null,r,Jc.a.SDK_VERSION||null));var o=Kn(i,n&&n.Ba,n&&n.Aa);return Zc(this,n=Hc(this).then(function(e){return Lu(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new mt(function(t,n){e.ha("signInViaPopup",null,new jr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=e.a.Ea(e,"signInViaPopup",o,r)})}).then(function(t){return o&&Wn(o),t?Dr(t):null}).s(function(t){throw o&&Wn(o),t}))},t.Nc=function(t){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));var e=this;return Zc(this,Hc(this).then(function(){return function(t){return Vc(t,function(){return t.b.set(Rc,t.c.B,t.a)})}(e.h)}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!hr())return Tt(new jr("operation-not-supported-in-this-environment"));var t=this;return Zc(this,Hc(this).then(function(){return t.a.fa()}).then(function(t){return t?Dr(t):null}))},t.Sc=function(t){if(!t)return Tt(new jr("null-user"));var e=this,n={};n.apiKey=Xc(this).options.apiKey,n.authDomain=Xc(this).options.authDomain,n.appName=Xc(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.m};var i=t.h,o={};return o[ds]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-w())/1e3,e=new nc(e,o),n&&(e.ba=n),r&&ic(e,r),bc(e,t),e}(t,n,e.A,e.ya());return Zc(this,this.i.then(function(){if(Xc(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Qc(e)&&t.uid==Qc(e).uid?(bc(Qc(e),t),e.Z(t)):(Wc(e,r),lc(r),e.Z(r))}).then(function(){$c(e)}))},t.ob=function(){var t=this;return Zc(this,this.i.then(function(){return Qc(t)?(Wc(t,null),Bc(t.h).then(function(){$c(t)})):Et()}))},t.Oc=function(){var t=this;return Uc(this.h,Xc(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=Qc(t)&&e){n=Qc(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return bc(Qc(t),e),Qc(t).F();(Qc(t)||e)&&(Wc(t,e),e&&(lc(e),e.ba=t.A),t.a&&t.a.subscribe(t),$c(t))}})},t.Z=function(t){return Fc(this.h,t)},t.bc=function(){$c(this),this.Z(Qc(this))},t.mc=function(){this.ob()},t.nc=function(){this.ob()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Qc(e))})},t.pc=function(t){var e=this;!function(t,e){t.I.push(e),Zc(t,t.i.then(function(){!t.l&&L(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(Yc(t)))}))}(this,function(){t.next(Qc(e))})},t.xc=function(t,e,n){var r=this;return this.X&&Jc.a.Promise.resolve().then(function(){d(t)?t(Qc(r)):d(t.next)&&t.next(Qc(r))}),this.Tb(t,e,n)},t.wc=function(t,e,n){var r=this;return this.X&&Jc.a.Promise.resolve().then(function(){r.O=r.getUid(),d(t)?t(Qc(r)):d(t.next)&&t.next(Qc(r))}),this.Ub(t,e,n)},t.cc=function(t){var e=this;return Zc(this,this.i.then(function(){return Qc(e)?Qc(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Nb=function(t){var e=this;return this.i.then(function(){return Kc(e,aa(e.b,na,{token:t}))}).then(function(t){var n=t.user;return vc(n,"isAnonymous",!1),e.Z(n),t})},t.Gc=function(t){return Cr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCustomToken is deprecated. Please use firebase.auth.Auth.prototype.signInWithCustomToken instead."),this.Nb(t)},t.Hc=function(t,e){return Cr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.signInWithEmailAndPassword instead."),this.Ob(t,e)},t.Ob=function(t,e){var n=this;return this.i.then(function(){return Kc(n,aa(n.b,ra,{email:t,password:e}))})},t.yb=function(t,e){var n=this;return this.i.then(function(){return Kc(n,aa(n.b,Ls,{email:t,password:e}))})},t.Wb=function(t,e){return Cr("firebase.auth.Auth.prototype.createUserAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.createUserWithEmailAndPassword instead."),this.yb(t,e)},t.Jc=function(t){return Cr("firebase.auth.Auth.prototype.signInWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential instead."),this.Qa(t).then(function(t){return t.user})},t.Qa=function(t){var e=this;return this.i.then(function(){return Kc(e,t.la(e.b))})},t.Ra=function(){var t=this;return this.i.then(function(){var e=Qc(t);if(e&&e.isAnonymous){var n=Dr({providerId:null,isNewUser:!1});return Dr({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return Kc(t,t.b.Ra()).then(function(e){var n=e.user;return vc(n,"isAnonymous",!0),t.Z(n),e})})},t.Ic=function(){return Cr("firebase.auth.Auth.prototype.signInAnonymouslyAndRetrieveData is deprecated. Please use firebase.auth.Auth.prototype.signInAnonymously instead."),this.Ra()},t.getUid=function(){return Qc(this)&&Qc(this).uid||null},t.Vb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&Qc(this)&&ac(Qc(this))},t.Ec=function(t){var e=this;N(this.m,function(n){n==t&&e.u--}),0>this.u&&(this.u=0),0==this.u&&Qc(this)&&uc(Qc(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),Zc(this,this.i.then(function(){e.l||L(e.m,t)&&t(Yc(e))}))},t.removeAuthTokenListener=function(t){B(this.m,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(Lc("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),Jc.a.Promise.resolve()},t.Zb=function(t){return Cr("firebase.auth.Auth.prototype.fetchProvidersForEmail is deprecated. Please use firebase.auth.Auth.prototype.fetchSignInMethodsForEmail instead."),Zc(this,function(t,e){return aa(t,Fs,{identifier:e,continueUri:lr()?Gn():"http://localhost"}).then(function(t){return t.allProviders||[]})}(this.b,t))},t.$b=function(t){return Zc(this,function(t,e){return aa(t,Fs,{identifier:e,continueUri:lr()?Gn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!Xi(t)},t.mb=function(t,e){var n=this;return Zc(this,Et().then(function(){var t=new zr(e);if(!t.c)throw new jr("argument-error",Xr+" must be true when sending sign in link to email");return ei(t)}).then(function(e){return n.b.mb(t,e)}).then(function(){}))},t.Vc=function(t){return this.Ja(t).then(function(t){return t.data.email})},t.$a=function(t,e){return Zc(this,this.b.$a(t,e).then(function(){}))},t.Ja=function(t){return Zc(this,this.b.Ja(t).then(function(t){return new Pr(t)}))},t.Xa=function(t){return Zc(this,this.b.Xa(t).then(function(){}))},t.lb=function(t,e){var n=this;return Zc(this,Et().then(function(){return void 0===e||nt(e)?{}:ei(new zr(e))}).then(function(e){return n.b.lb(t,e)}).then(function(){}))},t.Lc=function(t,e){return Zc(this,Ku(this,t,e,v(this.Qa,this)))},t.Kc=function(t,e){var n=this;return Zc(this,Et().then(function(){var r=Ki(t,e||Gn());return n.Qa(r)}))},th.prototype.render=function(){},th.prototype.reset=function(){},th.prototype.getResponse=function(){},th.prototype.execute=function(){};var nh=null;function rh(t,e){return(e=ih(e))&&t.a[e]||null}function ih(t){return(t=void 0===t?1e12:t)?t.toString():null}function oh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Nn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():be(this.f,"click",this.i)}function sh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function ah(){}eh.prototype.render=function(t,e){return this.a[this.b.toString()]=new oh(t,e),this.b++},eh.prototype.reset=function(t){var e=rh(this,t);t=ih(t),e&&t&&(e.delete(),delete this.a[t])},eh.prototype.getResponse=function(t){return(t=rh(this,t))?t.getResponse():null},eh.prototype.execute=function(t){(t=rh(this,t))&&t.execute()},oh.prototype.getResponse=function(){return sh(this),this.b},oh.prototype.execute=function(){sh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(r){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(r){}t.h&&t.execute()},6e4)},500))},oh.prototype.delete=function(){sh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ee(this.f,"click",this.i)},ah.prototype.g=function(){return nh||(nh=new eh),Et(nh)},ah.prototype.c=function(){};var uh=null;function ch(){this.b=n.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var hh=new pn(yn,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),lh=new wr(3e4,6e4);ch.prototype.g=function(t){var e=this;return new mt(function(r,i){var o=setTimeout(function(){i(new jr("network-request-failed"))},lh.get());!n.grecaptcha||t!==e.f&&!e.b?(n[e.a]=function(){if(n.grecaptcha){e.f=t;var s=n.grecaptcha.render;n.grecaptcha.render=function(t,n){return t=s(t,n),e.b++,t},clearTimeout(o),r(n.grecaptcha)}else clearTimeout(o),i(new jr("internal-error"));delete n[e.a]},Et(rs(wn(hh,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(o),i(new jr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(o),r(n.grecaptcha))})},ch.prototype.c=function(){this.b--};var dh=null;function fh(t,e,r,i,o,s,a){if(Ir(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,a?(uh||(uh=new ah),a=uh):(dh||(dh=new ch),a=dh),this.m=a,this.a=r||{theme:"light",type:"image"},this.h=[],this.a[gh])throw new jr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[yh],!n.document)throw new jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Nn(e)||!this.i&&Nn(e).hasChildNodes())throw new jr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new hs(t,s||null,o||null),this.v=i||function(){return null};var u=this;this.o=[];var c=this.a[ph];this.a[ph]=function(t){if(vh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=ur(c,n);"function"==typeof e&&e(t)}};var h=this.a[mh];this.a[mh]=function(){if(vh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=ur(h,n);"function"==typeof t&&t()}}}var ph="callback",mh="expired-callback",gh="sitekey",yh="size";function vh(t,e){for(var n=0;n<t.o.length;n++)try{t.o[n](e)}catch(r){}}function bh(t,e){return t.h.push(e),e.ia(function(){F(t.h,e)}),e}function wh(t){if(t.D)throw new jr("internal-error","RecaptchaVerifier instance has been destroyed.")}function _h(t,e,n){var r=!1;try{this.b=n||Jc.a.app()}catch(s){throw new jr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new jr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(s){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(s){}o=Jc.a.SDK_VERSION?sr(Jc.a.SDK_VERSION,o):null,fh.call(this,n,t,e,function(){try{var t=i.b.auth().ea()}catch(e){t=null}return t},o,ci(ai),r)}function Eh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,s=0;s<e.length;s++)if(e[s].optional)o=!0;else{if(o)throw new jr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],0>i||i>=Th.length)throw new jr("internal-error","Argument validator received an unsupported number of arguments.");n=Th[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new jr("argument-error",t+" failed: "+r)}(t=fh.prototype).za=function(){var t=this;return this.f?this.f:this.f=bh(this,Et().then(function(){if(lr()&&!Zn())return Yn();throw new jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.m.g(t.v())}).then(function(e){return t.g=e,aa(t.u,Ks,{})}).then(function(e){t.a[gh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){wh(this);var t=this;return bh(this,this.za().then(function(){if(null===t.c){var e=t.l;if(!t.i){var n=Nn(e);e=function(t,e,n){var i=arguments,o=document,s=String(i[0]),a=i[1];if(!fn&&a&&(a.name||a.type)){if(s=["<",s],a.name&&s.push(' name="',ct(a.name),'"'),a.type){s.push(' type="',ct(a.type),'"');var u={};at(u,a),delete u.type,a=u}s.push(">"),s=s.join("")}return s=o.createElement(s),a&&(r(a)?s.className=a:h(a)?s.className=a.join(" "):Mn(s,a)),2<i.length&&function(t,e,n){function i(n){n&&e.appendChild(r(n)?t.createTextNode(n):n)}for(var o=2;o<n.length;o++){var s=n[o];!l(s)||f(s)&&0<s.nodeType?i(s):N(Ln(s)?V(s):s,i)}}(o,s,i),s}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){wh(this);var t=this;return bh(this,this.render().then(function(e){return new mt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){B(t.o,function(t){return t==e})}(t,i),n(e))};t.o.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){wh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){wh(this),this.D=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Nn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},_(_h,fh);var Th="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function xh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:r}}function Sh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:i}}function Ch(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:f}}function Ah(t,e){return{name:t||"",K:"a function",optional:!!e,M:d}}function Ih(t,e){return{name:t||"",K:"null",optional:!!e,M:c}}function Oh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){return!!e&&!(!e.la||t&&e.providerId!==t)}}}function Dh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&r(t.type)&&d(t.verify))}}}function kh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function Ph(t,e){for(var n in e){var r=e[n].name;t[r]=Rh(r,t[n],e[n].j)}}function Nh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:b(function(t){return this[t]},n),set:b(function(t,e,n,r){Eh(t,[n],[r],!0),this[e]=r},r,n,e[n].ub),enumerable:!0})}}function Mh(t,e,n,r){t[e]=Rh(e,n,r)}function Rh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Eh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}Ph(jc.prototype,{Xa:{name:"applyActionCode",j:[xh("code")]},Ja:{name:"checkActionCode",j:[xh("code")]},$a:{name:"confirmPasswordReset",j:[xh("code"),xh("newPassword")]},yb:{name:"createUserWithEmailAndPassword",j:[xh("email"),xh("password")]},Wb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[xh("email"),xh("password")]},Zb:{name:"fetchProvidersForEmail",j:[xh("email")]},$b:{name:"fetchSignInMethodsForEmail",j:[xh("email")]},fa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[xh("emailLink")]},wc:{name:"onAuthStateChanged",j:[kh(Ch(),Ah(),"nextOrObserver"),Ah("opt_error",!0),Ah("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[kh(Ch(),Ah(),"nextOrObserver"),Ah("opt_error",!0),Ah("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[xh("email"),kh(Ch("opt_actionCodeSettings",!0),Ih(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[xh("email"),Ch("actionCodeSettings")]},nb:{name:"setPersistence",j:[xh("persistence")]},Qa:{name:"signInAndRetrieveDataWithCredential",j:[Oh()]},Ra:{name:"signInAnonymously",j:[]},Ic:{name:"signInAnonymouslyAndRetrieveData",j:[]},Jc:{name:"signInWithCredential",j:[Oh()]},Nb:{name:"signInWithCustomToken",j:[xh("token")]},Gc:{name:"signInAndRetrieveDataWithCustomToken",j:[xh("token")]},Ob:{name:"signInWithEmailAndPassword",j:[xh("email"),xh("password")]},Kc:{name:"signInWithEmailLink",j:[xh("email"),xh("emailLink",!0)]},Hc:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[xh("email"),xh("password")]},Lc:{name:"signInWithPhoneNumber",j:[xh("phoneNumber"),Dh()]},Mc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Sc:{name:"updateCurrentUser",j:[kh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof nc)}},Ih(),"user")]},ob:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[xh(null,!0)]},Uc:{name:"useDeviceLanguage",j:[]},Vc:{name:"verifyPasswordResetCode",j:[xh("code")]}}),Nh(jc.prototype,{lc:{name:"languageCode",ub:kh(xh(),Ih(),"languageCode")}}),(jc.Persistence=tu).LOCAL="local",jc.Persistence.SESSION="session",jc.Persistence.NONE="none",Ph(nc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[Sh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Sh("opt_forceRefresh",!0)]},fb:{name:"linkAndRetrieveDataWithCredential",j:[Oh()]},rc:{name:"linkWithCredential",j:[Oh()]},sc:{name:"linkWithPhoneNumber",j:[xh("phoneNumber"),Dh()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},hb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Oh()]},Ac:{name:"reauthenticateWithCredential",j:[Oh()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[xh("phoneNumber"),Dh()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[kh(Ch("opt_actionCodeSettings",!0),Ih(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[xh(null,!0)]},Rc:{name:"unlink",j:[xh("provider")]},qb:{name:"updateEmail",j:[xh("email")]},rb:{name:"updatePassword",j:[xh("password")]},Tc:{name:"updatePhoneNumber",j:[Oh("phone")]},sb:{name:"updateProfile",j:[Ch("profile")]}}),Ph(eh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Ph(th.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Ph(mt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Nh(zu.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",ub:Sh("appVerificationDisabledForTesting")}}),Ph(Wu.prototype,{confirm:{name:"confirm",j:[xh("verificationCode")]}}),Mh(Si,"fromJSON",function(t){t=r(t)?JSON.parse(t):t;for(var e,n=[Pi,zi,Yi,Oi],i=0;i<n.length;i++)if(e=n[i](t))return e;return null},[kh(xh(),Ch(),"json")]),Mh(Wi,"credential",function(t,e){return new Hi(t,e)},[xh("email"),xh("password")]),Ph(Hi.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),Ph(Li.prototype,{ua:{name:"addScope",j:[xh("scope")]},Da:{name:"setCustomParameters",j:[Ch("customOAuthParameters")]}}),Mh(Li,"credential",Fi,[kh(xh(),Ch(),"token")]),Mh(Wi,"credentialWithLink",Ki,[xh("email"),xh("emailLink")]),Ph(Bi.prototype,{ua:{name:"addScope",j:[xh("scope")]},Da:{name:"setCustomParameters",j:[Ch("customOAuthParameters")]}}),Mh(Bi,"credential",Ui,[kh(xh(),Ch(),"token")]),Ph(Vi.prototype,{ua:{name:"addScope",j:[xh("scope")]},Da:{name:"setCustomParameters",j:[Ch("customOAuthParameters")]}}),Mh(Vi,"credential",ji,[kh(xh(),kh(Ch(),Ih()),"idToken"),kh(xh(),Ih(),"accessToken",!0)]),Ph(qi.prototype,{Da:{name:"setCustomParameters",j:[Ch("customOAuthParameters")]}}),Mh(qi,"credential",Gi,[kh(xh(),Ch(),"token"),xh("secret",!0)]),Ph(Ri.prototype,{ua:{name:"addScope",j:[xh("scope")]},credential:{name:"credential",j:[kh(xh(),kh(Ch(),Ih()),"optionsOrIdToken"),kh(xh(),Ih(),"accessToken",!0)]},Da:{name:"setCustomParameters",j:[Ch("customOAuthParameters")]}}),Ph(Di.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),Ph(Ai.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),Mh($i,"credential",Zi,[xh("verificationId"),xh("verificationCode")]),Ph($i.prototype,{Va:{name:"verifyPhoneNumber",j:[xh("phoneNumber"),Dh()]}}),Ph(Qi.prototype,{w:{name:"toJSON",j:[xh(null,!0)]}}),Ph(jr.prototype,{toJSON:{name:"toJSON",j:[xh(null,!0)]}}),Ph(uo.prototype,{toJSON:{name:"toJSON",j:[xh(null,!0)]}}),Ph(ao.prototype,{toJSON:{name:"toJSON",j:[xh(null,!0)]}}),Ph(_h.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===Jc.a||!Jc.a.INTERNAL||!Jc.a.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:jc,AuthCredential:Si,Error:jr};Mh(t,"EmailAuthProvider",Wi,[]),Mh(t,"FacebookAuthProvider",Li,[]),Mh(t,"GithubAuthProvider",Bi,[]),Mh(t,"GoogleAuthProvider",Vi,[]),Mh(t,"TwitterAuthProvider",qi,[]),Mh(t,"OAuthProvider",Ri,[xh("providerId")]),Mh(t,"SAMLAuthProvider",Mi,[xh("providerId")]),Mh(t,"PhoneAuthProvider",$i,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof jc)}}]),Mh(t,"RecaptchaVerifier",_h,[kh(xh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Ch("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof Jc.a.app.App)}}]),Jc.a.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:v((t=new jc(t)).getUid,t),getToken:v(t.cc,t),addAuthTokenListener:v(t.Vb,t),removeAuthTokenListener:v(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(n){}}),Jc.a.INTERNAL.extendNamespace({User:nc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var $c="firebasestorage.googleapis.com",Zc=12e4,th=6e4,eh=-9007199254740991,nh=function(){function t(t,e){this.code_=ih(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return ih(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),rh={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function ih(t){return"storage/"+t}function oh(){return new nh(rh.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function sh(){return new nh(rh.CANCELED,"User canceled the upload/download.")}function ah(){return new nh(rh.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function uh(){return new nh(rh.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function ch(t,e,n){return new nh(rh.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function hh(){return new nh(rh.APP_DELETED,"The Firebase app was deleted.")}function lh(t,e){return new nh(rh.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function dh(t){throw new nh(rh.INTERNAL_ERROR,"Internal error: "+t)}var fh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function ph(t){switch(t){case fh.RAW:case fh.BASE64:case fh.BASE64URL:case fh.DATA_URL:return;default:throw"Expected one of the event types: ["+fh.RAW+", "+fh.BASE64+", "+fh.BASE64URL+", "+fh.DATA_URL+"]."}}var mh=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function gh(t,e){switch(t){case fh.RAW:return new mh(yh(e));case fh.BASE64:case fh.BASE64URL:return new mh(vh(t,e));case fh.DATA_URL:return new mh(function(t){var e=new bh(t);return e.base64?vh(fh.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(n){throw lh(fh.DATA_URL,"Malformed data URL.")}return yh(e)}(e.rest)}(e),function(t){return new bh(t).contentType}(e))}throw oh()}function yh(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){var i=r,o=t.charCodeAt(++n);e.push(240|(r=65536|(1023&i)<<10|1023&o)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function vh(t,e){switch(t){case fh.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw lh(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case fh.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw lh(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(c){throw lh(t,"Invalid character found")}for(var a=new Uint8Array(s.length),u=0;u<s.length;u++)a[u]=s.charCodeAt(u);return a}var bh=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw lh(fh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r=e[1]||null;null!=r&&(this.base64=(n=r).length>=";base64".length&&";base64"===n.substring(n.length-";base64".length),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=t.substring(t.indexOf(",")+1)}}(),wh={STATE_CHANGED:"state_changed"},_h={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},Eh={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Th(t){switch(t){case _h.RUNNING:case _h.PAUSING:case _h.CANCELING:return Eh.RUNNING;case _h.PAUSED:return Eh.PAUSED;case _h.SUCCESS:return Eh.SUCCESS;case _h.CANCELED:return Eh.CANCELED;case _h.ERROR:default:return Eh.ERROR}}function xh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Sh(t,e){for(var n in t)xh(t,n)&&e(n,t[n])}function Ch(t){if(null==t)return{};var e={};return Sh(t,function(t,n){e[t]=n}),e}function Ah(t){return new Promise(t)}function Ih(t){return Promise.resolve(t)}function Oh(t){return null!=t}function Dh(t){return void 0!==t}function kh(t){return"function"==typeof t}function Ph(t){return"object"==typeof t}function Nh(t){return Ph(t)&&null!==t}function Mh(t){return"string"==typeof t||t instanceof String}function Rh(t){return Lh()&&t instanceof Blob}function Lh(){return"undefined"!=typeof Blob}var Fh=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}({}),Bh=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=Fh.NO_ERROR,this.sendPromise_=Ah(function(e,n){t.xhr_.addEventListener("abort",function(n){t.errorCode_=Fh.ABORT,e(t)}),t.xhr_.addEventListener("error",function(n){t.errorCode_=Fh.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(n){e(t)})})}return t.prototype.send=function(t,e,n,r){var i=this;if(this.sent_)throw dh("cannot .send() more than once");return this.sent_=!0,this.xhr_.open(e,t,!0),Oh(r)&&Sh(r,function(t,e){i.xhr_.setRequestHeader(t,e.toString())}),Oh(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw dh("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw dh("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw dh("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){Oh(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){Oh(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),Uh=function(){function t(){}return t.prototype.createXhrIo=function(){return new Bh},t}();function Vh(t){var e,n;try{e=JSON.parse(t)}catch(r){return null}return Ph(n=e)&&!Array.isArray(n)?e:null}var jh=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n;try{n=t.makeFromUrl(e)}catch(r){return new t(e,"")}if(""===n.path)return n;throw new nh(rh.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e){for(var n=null,r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i"),i=$c.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],s=0;s<o.length;s++){var a=o[s],u=a.regex.exec(e);if(u){var c=u[a.indices.path];c||(c=""),n=new t(u[a.indices.bucket],c),a.postModify(n);break}}if(null==n)throw function(t){return new nh(rh.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();function qh(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}function Gh(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Hh(t){return"https://"+$c+"/v0"+t}function zh(t){var e=encodeURIComponent,n="?";return Sh(t,function(t,r){var i=e(t)+"="+e(r);n=n+i+"&"}),n=n.slice(0,-1)}function Wh(t,e){return e}var Kh=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Wh}}(),Xh=null;function Qh(t,e,n){var r=Vh(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new jh(t.bucket,t.fullPath);return e.makeStorageReference(n)}})}(r,t),r}(t,r,n)}function Yh(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function Jh(t){if(!t||!Ph(t))throw"Expected Metadata object.";for(var e in t){var n=t[e];if("customMetadata"===e){if(!Ph(n))throw"Expected object for 'customMetadata' mapping."}else if(Nh(n))throw"Mapping for '"+e+"' cannot be an object."}}function $h(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(e,o,s,a){var u,c;return r===i?(u=r,c=1===r?"argument":"arguments"):(u="between "+r+" and "+i,c="arguments"),new nh(rh.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+t+"`: Expected "+u+" "+c+", received "+n.length+".")}();for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(s){throw s instanceof Error?ch(o,t,s.message):ch(o,t,s)}}var Zh=function(){return function(t,e){var n=this;this.validator=function(e){n.optional&&!Dh(e)||t(e)},this.optional=!!e}}();function tl(t,e){function n(t){if(!Mh(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new Zh(r,e)}function el(){return new Zh(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Lh()&&t instanceof Blob))throw"Expected Blob or File."})}function nl(t){return new Zh(Jh,t)}function rl(){return new Zh(function(t){if(!(function(t){return"number"==typeof t||t instanceof Number}(t)&&t>=0))throw"Expected a number 0 or greater."})}function il(t,e){return new Zh(function(e){if(!(null===e||Oh(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function ol(t){return new Zh(function(t){if(null!==t&&!kh(t))throw"Expected a Function."},t)}function sl(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function al(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=sl();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Lh())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var ul=function(){function t(t,e){var n=0,r="";Rh(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(Rh(this.data_)){var r=(o=e,s=n,(i=this.data_).webkitSlice?i.webkitSlice(o,s):i.mozSlice?i.mozSlice(o,s):i.slice?i.slice(o,s):null);return null===r?null:new t(r)}var i,o,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Lh()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(al.apply(null,r))}var i=e.map(function(t){return Mh(t)?gh(fh.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var s=new Uint8Array(o),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]}),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}();function cl(t,e){return-1!==t.indexOf(e)}var hl=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function ll(t){if(!t)throw oh()}function dl(t,e){return function(n,r){var i=Qh(t,r,e);return ll(null!==i),i}}function fl(t){return function(e,n){var r;return(r=401===e.getStatus()?new nh(rh.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?new nh(rh.QUOTA_EXCEEDED,"Quota for bucket '"+t.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===e.getStatus()?new nh(rh.UNAUTHORIZED,"User does not have permission to access '"+t.path+"'."):n).setServerResponseProp(n.serverResponseProp()),r}}function pl(t){var e=fl(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=new nh(rh.OBJECT_NOT_FOUND,"Object '"+t.path+"' does not exist.")),i.setServerResponseProp(r.serverResponseProp()),i}}function ml(t,e,n){var r=Hh(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new hl(r,"GET",dl(t,n),i);return o.errorHandler=pl(e),o}function gl(t,e,n){var r=Hh(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new hl(r,"GET",function(t,e){return function(n,r){var i=Qh(t,r,e);return ll(null!==i),function(t,e){var n=Vh(r);if(null===n)return null;if(!Mh(n.downloadTokens))return null;var i=n.downloadTokens;if(0===i.length)return null;var o=encodeURIComponent;return i.split(",").map(function(e){var n=t.fullPath;return Hh("/b/"+o(t.bucket)+"/o/"+o(n))+zh({alt:"media",token:e})})[0]}(i)}}(t,n),i);return o.errorHandler=pl(e),o}function yl(t,e,n,r){var i=Hh(e.fullServerUrl()),o=Yh(n,r),s=t.maxOperationRetryTime(),a=new hl(i,"PATCH",dl(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=pl(e),a}function vl(t,e){var n=Hh(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new hl(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=pl(e),i}function bl(t,e,n){var r=Ch(n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var wl=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function _l(t,e){var n;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(r){ll(!1)}return ll(cl(e||["active"],n)),n}var El=function(){return function(t,e,n){if(kh(t)||Oh(e)||Oh(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}}}(),Tl=function(){return function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o}}();function xl(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Ih(!0).then(function(){t.apply(null,e)})}}var Sl=function(){function t(t,e,n,r,i,o){var s=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=_h.RUNNING,this.errorHandler_=function(t){s.request_=null,s.chunkMultiplier_=1,t.codeEquals(rh.CANCELED)?(s.needToFetchStatus_=!0,s.completeTransitions_()):(s.error_=t,s.transition_(_h.ERROR))},this.metadataErrorHandler_=function(t){s.request_=null,t.codeEquals(rh.CANCELED)?s.completeTransitions_():(s.error_=t,s.transition_(_h.ERROR))},this.promise_=Ah(function(t,e){s.resolve_=t,s.reject_=e,s.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n,r){t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===_h.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case _h.RUNNING:t(n);break;case _h.CANCELING:e.transition_(_h.CANCELED);break;case _h.PAUSING:e.transition_(_h.PAUSED)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=bl(e,r,i),a={name:s.fullPath},u=Hh(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},h=Yh(s,n),l=t.maxUploadRetryTime(),d=new hl(u,"POST",function(t,e){var n;_l(t);try{n=t.getResponseHeader("X-Goog-Upload-URL")}catch(r){ll(!1)}return ll(Mh(n)),n},l);return d.urlParams=a,d.headers=c,d.body=h,d.errorHandler=fl(e),d}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(e,n,r,i){var o=t.authWrapper_.maxUploadRetryTime(),s=new hl(r,"POST",function(t,e){var n,r=_l(t,["active","final"]);try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(s){ll(!1)}var o=parseInt(n,10);return ll(!isNaN(o)),new wl(o,i.size(),"final"===r)},o);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=fl(n),s}(0,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new wl(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=function(t,e,n,r,i,o,s,a){var u=new wl(0,0);if(s?(u.current=s.current,u.total=s.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new nh(rh.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,d={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},f=r.slice(l,l+h);if(null===f)throw ah();var p=e.maxUploadRetryTime(),m=new hl(n,"POST",function(t,n){var i,s=_l(t,["active","final"]),a=u.current+h,c=r.size();return i="final"===s?dl(e,o)(t,n):null,new wl(a,c,"final"===s,i)},p);return m.headers=d,m.body=f.uploadData(),m.progressCallback=a||null,m.errorHandler=fl(t),m}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(a){return t.error_=a,void t.transition_(_h.ERROR)}var s=t.authWrapper_.makeRequest(o,i);t.request_=s,s.getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(_h.SUCCESS)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=ml(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(_h.SUCCESS)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var u=bl(e,r,i),c=Yh(u,n),h=ul.getBlob("--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",r,"\r\n--"+a+"--");if(null===h)throw ah();var l={name:u.fullPath},d=Hh(o),f=t.maxUploadRetryTime(),p=new hl(d,"POST",dl(t,n),f);return p.urlParams=l,p.headers=s,p.body=h.uploadData(),p.errorHandler=fl(e),p}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(_h.SUCCESS)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case _h.CANCELING:case _h.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case _h.RUNNING:var e=this.state_===_h.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case _h.PAUSED:this.state_=t,this.notifyObservers_();break;case _h.CANCELED:this.error_=sh(),this.state_=t,this.notifyObservers_();break;case _h.ERROR:case _h.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case _h.PAUSING:this.transition_(_h.PAUSED);break;case _h.CANCELING:this.transition_(_h.CANCELED);break;case _h.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Th(this.state_);return new Tl(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){function i(e){if(t!==wh.STATE_CHANGED)throw"Expected one of the event types: ["+wh.STATE_CHANGED+"]."}void 0===e&&(e=void 0),void 0===n&&(n=void 0),void 0===r&&(r=void 0);var o="Expected a function or an Object with one of `next`, `error`, `complete` properties.",s=ol(!0).validator,a=il(null,!0).validator;function u(t){try{return void s(t)}catch(e){}try{if(a(t),!(Dh(t.next)||Dh(t.error)||Dh(t.complete)))throw"";return}catch(e){throw o}}var c=[tl(i),il(u,!0),ol(!0),ol(!0)];$h("on",c,arguments);var h=this;function l(t){return function(e,n,i){null!==t&&$h("on",t,arguments);var o=new El(e,n,r);return h.addObserver_(o),function(){h.removeObserver_(o)}}}function d(t){if(null===t)throw o;u(t)}var f=[il(d),ol(!0),ol(!0)],p=!(Dh(e)||Dh(n)||Dh(r));return p?l(f):l(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e,n;-1!==(n=(e=this.observers_).indexOf(t))&&e.splice(n,1)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),Array.prototype.slice.call(this.observers_).forEach(function(e){t.notifyObserver_(e)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Th(this.state_)){case Eh.SUCCESS:xl(this.resolve_.bind(null,this.snapshot))();break;case Eh.CANCELED:case Eh.ERROR:xl(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(Th(this.state_)){case Eh.RUNNING:case Eh.PAUSED:null!==t.next&&xl(t.next.bind(t,this.snapshot))();break;case Eh.SUCCESS:null!==t.complete&&xl(t.complete.bind(t))();break;case Eh.CANCELED:case Eh.ERROR:null!==t.error&&xl(t.error.bind(t,this.error_))();break;default:null!==t.error&&xl(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){$h("resume",[],arguments);var t=this.state_===_h.PAUSED||this.state_===_h.PAUSING;return t&&this.transition_(_h.RUNNING),t},t.prototype.pause=function(){$h("pause",[],arguments);var t=this.state_===_h.RUNNING;return t&&this.transition_(_h.PAUSING),t},t.prototype.cancel=function(){$h("cancel",[],arguments);var t=this.state_===_h.RUNNING||this.state_===_h.PAUSING;return t&&this.transition_(_h.CANCELING),t},t}(),Cl=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof jh?e:jh.makeFromUrl(e)}return t.prototype.toString=function(){return $h("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return function(){if(Xh)return Xh;var t=[];t.push(new Kh("bucket")),t.push(new Kh("generation")),t.push(new Kh("metageneration")),t.push(new Kh("name","fullPath",!0));var e=new Kh("name");e.xform=function(t,e){return function(t){return!Mh(t)||t.length<2?t:Gh(t=t)}(e)},t.push(e);var n=new Kh("size");return n.xform=function(t,e){return Oh(e)?+e:e},t.push(n),t.push(new Kh("timeCreated")),t.push(new Kh("updated")),t.push(new Kh("md5Hash",null,!0)),t.push(new Kh("cacheControl",null,!0)),t.push(new Kh("contentDisposition",null,!0)),t.push(new Kh("contentEncoding",null,!0)),t.push(new Kh("contentLanguage",null,!0)),t.push(new Kh("contentType",null,!0)),t.push(new Kh("metadata","customMetadata",!0)),Xh=t}()},t.prototype.child=function(t){$h("child",[tl()],arguments);var e=qh(this.location.path,t),n=new jh(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0==t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new jh(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new jh(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Gh(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),$h("put",[el(),nl(!0)],arguments),this.throwIfRoot_("put"),new Sl(this,this.authWrapper,this.location,this.mappings(),new ul(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=fh.RAW),$h("putString",[tl(),tl(ph,!0),nl(!0)],arguments),this.throwIfRoot_("putString");var r=gh(e,t),i=Ch(n);return!Oh(i.contentType)&&Oh(r.contentType)&&(i.contentType=r.contentType),new Sl(this,this.authWrapper,this.location,this.mappings(),new ul(r.data,!0),i)},t.prototype.delete=function(){$h("delete",[],arguments),this.throwIfRoot_("delete");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=vl(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.getMetadata=function(){$h("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=ml(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){$h("updateMetadata",[nl()],arguments),this.throwIfRoot_("updateMetadata");var e=this;return this.authWrapper.getAuthToken().then(function(n){var r=yl(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},t.prototype.getDownloadURL=function(){$h("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var t=this;return this.authWrapper.getAuthToken().then(function(e){var n=gl(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw uh();return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new nh(rh.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),Al=function(){function t(t){this.promise_=function(t){return Promise.reject(t)}(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){void 0===t&&(t=!1)},t}(),Il=function(){function t(){this.map_={},this.id_=eh}return t.prototype.addRequest=function(t){var e=this.id_;this.id_++,this.map_[e]=t;var n=this;function r(){delete n.map_[e]}t.getPromise().then(r,r)},t.prototype.clear=function(){Sh(this.map_,function(t,e){e&&e.cancel(!0)}),this.map_={}},t}(),Ol=function(){function t(e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var s=this.app_.options;Oh(s)&&(this.bucket_=t.extractBucket_(s))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=Zc,this.maxUploadRetryTime_=th,this.requestMap_=new Il}return t.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:jh.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){return null!==this.app_&&Oh(this.app_.INTERNAL)&&Oh(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(t){return null}):Ih(null)},t.prototype.bucket=function(){if(this.deleted_)throw hh();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new Al(hh());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}(),Dl=function(){function t(t,e,n,r,i,o,s,a,u,c,h){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=c,this.timeout_=u,this.pool_=h;var l=this;this.promise_=Ah(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.xhr;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());Dh(a)?i(a):i()}catch(u){o(u)}else null!==s?((r=oh()).setServerResponseProp(s.getResponseText()),o(t.errorCallback_?t.errorCallback_(s,r):r)):o(r=n.canceled?t.appDelete_?hh():sh():new nh(rh.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new kl(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,s=0;function a(){return 2===s}var u=!1;function c(){u||(u=!0,e.apply(null,arguments))}function h(e){i=setTimeout(function(){i=null,t(l,a())},e)}function l(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];u||(t?c.apply(null,arguments):a()||o?c.apply(null,arguments):(r<64&&(r*=2),1===s?(s=2,e=0):e=1e3*(r+Math.random()),h(e)))}var d=!1;function f(t){d||(d=!0,u||(null!==i?(t||(s=2),clearTimeout(i),h(0)):t||(s=1)))}return h(0),setTimeout(function(){o=!0,f(!0)},n),f}(function(e,n){if(n)e(!1,new kl(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===Fh.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var s=cl(t.successCodes_,o);e(!0,new kl(s,n))}else{var a=n.getErrorCode()===Fh.ABORT;e(!1,new kl(!1,null,a))}})}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=cl([408,429],t),r=cl(this.additionalRetryCodes_,t);return e||n||r},t}(),kl=function(){return function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n}}();function Pl(t,e,n){var r=zh(t.urlParams),i=t.url+r,o=Ch(t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,e),function(t){t["X-Firebase-Storage-Version"]="webjs/"+(void 0!==Jc.a?Jc.a.SDK_VERSION:"AppManager")}(o),new Dl(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var Nl=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new Ol(t,function(t,e){return new Cl(t,e)},Pl,this,e),this.app_=t,null!=n)this.bucket_=jh.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new jh(r,""))}this.internals_=new Ml(this)}return t.prototype.ref=function(t){function e(t){if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."}if($h("ref",[tl(e,!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var n=new Cl(this.authWrapper_,this.bucket_);return null!=t?n.child(t):n},t.prototype.refFromURL=function(t){function e(t){if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{jh.makeFromUrl(t)}catch(e){throw"Expected valid full URL but got an invalid one."}}return $h("refFromURL",[tl(e,!1)],arguments),new Cl(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){$h("setMaxUploadRetryTime",[rl()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){$h("setMaxOperationRetryTime",[rl()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Ml=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Ih(void 0)},t}();Jc.a.INTERNAL.registerService("storage",function(t,e,n){return new Nl(t,new Uh,n)},{TaskState:Eh,TaskEvent:wh,StringFormat:fh,Storage:Nl,Reference:Cl},void 0,!0);var Rl=n("Wcq6");function Ll(){return function(t,e,n){const r=n.value;return n.value=function(...n){return console.log(`Call ${t.constructor.name}.${e} method`),r.apply(this,n)},n}}let Fl=(()=>{class t{constructor(t){this.firebaseService=t,this.initDB()}initDB(){return ra.__awaiter(this,void 0,void 0,function*(){this.db=this.firebaseService.firebase.firestore(),this.storage=this.firebaseService.firebase.storage()})}levels(){return ra.__awaiter(this,void 0,void 0,function*(){return(yield this.db.collection("levels").get()).docs.map(t=>t.id)})}level(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=yield this.db.collection("levels").doc(t);return(yield e.get()).data()})}updateLevel(t,e){return ra.__awaiter(this,void 0,void 0,function*(){console.log("update level",t,e);const n=yield this.db.collection("levels").doc(t);try{return yield n.set(e)}catch(r){if("permission-denied"===r.code)return yield this.authorize(),this.updateLevel(t,e)}})}aiList(){return ra.__awaiter(this,void 0,void 0,function*(){return(yield this.db.collection("ais").get()).docs.map(t=>({name:t.id,info:t.data()}))})}updateAIInfo(t,e){return ra.__awaiter(this,void 0,void 0,function*(){console.log("update ai info",t,e);const n=yield this.db.collection("ais").doc(t);try{return yield n.set(e)}catch(r){if("permission-denied"===r.code)return yield this.authorize(),this.updateAIInfo(t,e)}})}loadAIInfo(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=yield this.db.collection("ais").doc(t);try{return(yield e.get()).data()}catch(n){if("permission-denied"===n.code)return yield this.authorize(),this.loadAIInfo(t)}})}updateAI(t,e){return ra.__awaiter(this,void 0,void 0,function*(){const n=JSON.stringify(e);return this.storage.ref().child("ais/"+t).putString(n)})}loadAI(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=this.storage.ref().child("ais/"+t),n=yield e.getDownloadURL(),r=yield fetch(n);return yield r.json()})}authorize(){return ra.__awaiter(this,void 0,void 0,function*(){const t=new Rl.auth.GoogleAuthProvider;return yield this.firebaseService.firebase.auth().signInWithPopup(t)})}}return ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[String,Object]),ra.__metadata("design:returntype",Promise)],t.prototype,"updateAIInfo",null),ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[Object]),ra.__metadata("design:returntype",Promise)],t.prototype,"loadAIInfo",null),ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[String,Object]),ra.__metadata("design:returntype",Promise)],t.prototype,"updateAI",null),ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[String]),ra.__metadata("design:returntype",Promise)],t.prototype,"loadAI",null),t})();class Bl extends d{constructor(t,e){super()}schedule(t,e=0){return this}}class Ul extends Bl{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let n=!1,r=void 0;try{this.work(t)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let Vl=(()=>{class t{constructor(e,n=t.now){this.SchedulerAction=e,this.now=n}schedule(t,e=0,n){return new this.SchedulerAction(this,t).schedule(n,e)}}return t.now=()=>Date.now(),t})();class jl extends Vl{constructor(t,e=Vl.now){super(t,()=>jl.delegate&&jl.delegate!==this?jl.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return jl.delegate&&jl.delegate!==this?jl.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}const ql=new jl(Ul);function Gl(t=0,e=ql){var n;return(u(n=t)||!(n-parseFloat(n)+1>=0)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=ql),new v(n=>(n.add(e.schedule(Hl,t,{subscriber:n,counter:0,period:t})),n))}function Hl(t){const{subscriber:e,counter:n,period:r}=t;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}function zl(t){return e=>e.lift(new Wl(t))}class Wl{constructor(t){this.notifier=t}call(t,e){const n=new Kl(t),r=M(n,this.notifier);return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n}}class Kl extends R{constructor(t){super(t),this.seenValue=!1}notifyNext(t,e,n,r,i){this.seenValue=!0,this.complete()}notifyComplete(){}}var Xl=function(t){return t.None="battlefield_map_none",t.Loading="battlefield_map_loading",t.Loaded="battlefield_map_loaded",t}({}),Ql=function(t){return t[t.Left=0]="Left",t[t.Right=2]="Right",t}({});function Yl(t,e){return!(e.position.x>=t.position.x+t.width||e.position.x+e.width<=t.position.x||e.position.y>=t.position.y+t.height||e.position.y+e.height<=t.position.y)}class Jl{constructor(t,e,n){this.cdr=t,this.httpClient=e,this.firestoreService=n,this.map=[],this.objects=[],this.leftMouseButtonPressed=!1,this.rightMouseButtonPressed=!1,this.minWidth=1,this.minHeight=1,this.movement={x:0,y:0},this.movementXAccumulator=0,this.movementYAccumulator=0,this.enemies={[Hc.Tank]:0,[Hc.Tank3]:0},this.onDestroySubject$=new x,this.exit=new xi}onResize(){return!1}ngOnInit(){this.loadLevelList(),Gl(15e3).pipe(zl(this.onDestroySubject$)).subscribe(()=>{this.levelNameSave&&this.saveFirebase()})}loadLevelList(){return ra.__awaiter(this,void 0,void 0,function*(){this.levelList=yield this.firestoreService.levels()})}selected(t){this.currentBlock=t,this.cdr.detectChanges()}onObject(t){const e=this.objects.findIndex(e=>e.type===t.type);-1===e?this.objects.push(t):this.objects[e]=t}mousemove(t){const{x:e,y:n}=function(t,e){const{clientX:n,clientY:r}=t,{x:i,y:o}=e.getBoundingClientRect();return{x:n-i,y:r-o}}(t,this.mapElement.nativeElement);this.currentBlock=Object.assign({},this.currentBlock,{position:{x:Math.floor(e/this.currentBlock.width)*this.currentBlock.width-this.movement.x,y:Math.floor(n/this.currentBlock.height)*this.currentBlock.height-this.movement.y}}),this.leftMouseButtonPressed&&this.addOrRemoveBlock(),this.rightMouseButtonPressed&&(this.movementXAccumulator+=t.movementX,this.movementYAccumulator+=t.movementY,this.movement.x=Math.floor(this.movementXAccumulator/this.currentBlock.width)*this.currentBlock.width,this.movement.y=Math.floor(this.movementYAccumulator/this.currentBlock.height)*this.currentBlock.height)}mousedown(t){t.button===Ql.Left&&(this.leftMouseButtonPressed=!0,this.addOrRemoveBlock()),t.button===Ql.Right&&(this.rightMouseButtonPressed=!0)}contextmenu(){return!1}mouseup(){this.leftMouseButtonPressed=!1,this.rightMouseButtonPressed=!1,this.lastAddedBlock=void 0}addOrRemoveBlock(){if(this.currentBlock.type===Hc.Delete){const t=this.map.findIndex(t=>Yl(t,this.currentBlock));return void(t>-1&&this.map.splice(t,1))}let t=!1;if(this.map.reduce((e,n,r)=>{const i=Yl(n,this.currentBlock);return i&&n===this.lastAddedBlock&&(t=!0),i&&n!==this.lastAddedBlock&&e.push(r),e},[]).reverse().forEach(t=>{this.map.splice(t,1)}),!t){const t=Object.assign({},this.currentBlock);this.lastAddedBlock=t,this.map.push(t)}}mouseleave(){this.leftMouseButtonPressed=!1}loadMap(t){const e=t.target,n=e.files[0],r=new FileReader;r.onload=()=>{const t=JSON.parse(r.result);e.value="",this.map=t.map},r.readAsText(n)}loadFirebase(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=yield this.firestoreService.level(t);this.levelNameSave=t,this.map=[...e.map],this.movementXAccumulator=e.movement.x,this.movementYAccumulator=e.movement.y,this.movement=e.movement,this.enemies=Object.assign({},this.enemies,e.enemies)})}save(){const t=new File([JSON.stringify({objects:this.objects.reduce($l,[]),map:this.map},null,2)],"map.json",{type:"text/plain"});!function(t,e){const n=document.createElement("a");n.href=t,n.download="map.json",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(URL.createObjectURL(t))}saveFirebase(){return ra.__awaiter(this,void 0,void 0,function*(){yield this.firestoreService.updateLevel(this.levelNameSave,{objects:this.objects.reduce($l,[]),map:this.map,movement:this.movement,enemies:this.enemies}),yield this.loadLevelList()})}menuButtonClick(){this.exit.emit()}}function $l(t,e){return t.find(t=>t.type===e.type)?t:[...t,e]}function Zl(t,e){return function(n){return n.lift(new td(t,e))}}class td{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new ed(t,this.predicate,this.thisArg))}}class ed extends m{constructor(t,e,n){super(t),this.predicate=e,this.thisArg=n,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}class nd{}class rd{}class id{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(t=>{const e=t.indexOf(":");if(e>0){const n=t.slice(0,e),r=n.toLowerCase(),i=t.slice(e+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(e=>{let n=t[e];const r=e.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(e,r))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof id?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){const e=new id;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof id?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){const e=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,e);const r=("a"===t.op?this.headers.get(e):void 0)||[];r.push(...n),this.headers.set(e,r);break;case"d":const i=t.value;if(i){let t=this.headers.get(e);if(!t)return;0===(t=t.filter(t=>-1===i.indexOf(t))).length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,t)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}}class od{encodeKey(t){return sd(t)}encodeValue(t){return sd(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}function sd(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}class ad{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new od,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const n=new Map;return t.length>0&&t.split("&").forEach(t=>{const r=t.indexOf("="),[i,o]=-1==r?[e.decodeKey(t),""]:[e.decodeKey(t.slice(0,r)),e.decodeValue(t.slice(r+1))],s=n.get(i)||[];s.push(o),n.set(i,s)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{const n=t.fromObject[e];this.map.set(e,Array.isArray(n)?n:[n])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const e=this.encoder.encodeKey(t);return this.map.get(t).map(t=>e+"="+this.encoder.encodeValue(t)).join("&")}).join("&")}clone(t){const e=new ad({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat([t]),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const e=("a"===t.op?this.map.get(t.param):void 0)||[];e.push(t.value),this.map.set(t.param,e);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let e=this.map.get(t.param)||[];const n=e.indexOf(t.value);-1!==n&&e.splice(n,1),e.length>0?this.map.set(t.param,e):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}function ud(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function cd(t){return"undefined"!=typeof Blob&&t instanceof Blob}function hd(t){return"undefined"!=typeof FormData&&t instanceof FormData}class ld{constructor(t,e,n,r){let i;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new id),this.params){const t=this.params.toString();if(0===t.length)this.urlWithParams=e;else{const n=e.indexOf("?");this.urlWithParams=e+(-1===n?"?":n<e.length-1?"&":"")+t}}else this.params=new ad,this.urlWithParams=e}serializeBody(){return null===this.body?null:ud(this.body)||cd(this.body)||hd(this.body)||"string"==typeof this.body?this.body:this.body instanceof ad?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body?null:hd(this.body)?null:cd(this.body)?this.body.type||null:ud(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ad?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}clone(t={}){const e=t.method||this.method,n=t.url||this.url,r=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,o=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,s=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let a=t.headers||this.headers,u=t.params||this.params;return void 0!==t.setHeaders&&(a=Object.keys(t.setHeaders).reduce((e,n)=>e.set(n,t.setHeaders[n]),a)),t.setParams&&(u=Object.keys(t.setParams).reduce((e,n)=>e.set(n,t.setParams[n]),u)),new ld(e,n,i,{params:u,headers:a,reportProgress:s,responseType:r,withCredentials:o})}}const dd=function(){var t={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return t[t.Sent]="Sent",t[t.UploadProgress]="UploadProgress",t[t.ResponseHeader]="ResponseHeader",t[t.DownloadProgress]="DownloadProgress",t[t.Response]="Response",t[t.User]="User",t}();class fd{constructor(t,e=200,n="OK"){this.headers=t.headers||new id,this.status=void 0!==t.status?t.status:e,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class pd extends fd{constructor(t={}){super(t),this.type=dd.ResponseHeader}clone(t={}){return new pd({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class md extends fd{constructor(t={}){super(t),this.type=dd.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new md({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class gd extends fd{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function yd(t,e){return{body:e,headers:t.headers,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let vd=(()=>(class{constructor(t){this.handler=t}request(t,e,n={}){let r;if(t instanceof ld)r=t;else{let i=void 0;i=n.headers instanceof id?n.headers:new id(n.headers);let o=void 0;n.params&&(o=n.params instanceof ad?n.params:new ad({fromObject:n.params})),r=new ld(t,e,void 0!==n.body?n.body:null,{headers:i,params:o,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=function(...t){let e=t[t.length-1];return C(e)?(t.pop(),U(t,e)):z(t)}(r).pipe(j(t=>this.handler.handle(t),void 0,1));if(t instanceof ld||"events"===n.observe)return i;const o=i.pipe(Zl(t=>t instanceof md));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return o.pipe(L(t=>{if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body}));case"blob":return o.pipe(L(t=>{if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body}));case"text":return o.pipe(L(t=>{if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body}));case"json":default:return o.pipe(L(t=>t.body))}case"response":return o;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(t,e={}){return this.request("DELETE",t,e)}get(t,e={}){return this.request("GET",t,e)}head(t,e={}){return this.request("HEAD",t,e)}jsonp(t,e){return this.request("JSONP",t,{params:(new ad).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,e={}){return this.request("OPTIONS",t,e)}patch(t,e,n={}){return this.request("PATCH",t,yd(n,e))}post(t,e,n={}){return this.request("POST",t,yd(n,e))}put(t,e,n={}){return this.request("PUT",t,yd(n,e))}}))();class bd{constructor(t,e){this.next=t,this.interceptor=e}handle(t){return this.interceptor.intercept(t,this.next)}}const wd=new bt("HTTP_INTERCEPTORS");let _d=(()=>(class{intercept(t,e){return e.handle(t)}}))();const Ed=/^\)\]\}',?\n/;class Td{}let xd=(()=>(class{constructor(){}build(){return new XMLHttpRequest}}))(),Sd=(()=>(class{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without JsonpClientModule installed.");return new v(e=>{const n=this.xhrFactory.build();if(n.open(t.method,t.urlWithParams),t.withCredentials&&(n.withCredentials=!0),t.headers.forEach((t,e)=>n.setRequestHeader(t,e.join(","))),t.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const e=t.detectContentTypeHeader();null!==e&&n.setRequestHeader("Content-Type",e)}if(t.responseType){const e=t.responseType.toLowerCase();n.responseType="json"!==e?e:"text"}const r=t.serializeBody();let i=null;const o=()=>{if(null!==i)return i;const e=1223===n.status?204:n.status,r=n.statusText||"OK",o=new id(n.getAllResponseHeaders()),s=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(n)||t.url;return i=new pd({headers:o,status:e,statusText:r,url:s})},s=()=>{let{headers:r,status:i,statusText:s,url:a}=o(),u=null;204!==i&&(u=void 0===n.response?n.responseText:n.response),0===i&&(i=u?200:0);let c=i>=200&&i<300;if("json"===t.responseType&&"string"==typeof u){const t=u;u=u.replace(Ed,"");try{u=""!==u?JSON.parse(u):null}catch(h){u=t,c&&(c=!1,u={error:h,text:u})}}c?(e.next(new md({body:u,headers:r,status:i,statusText:s,url:a||void 0})),e.complete()):e.error(new gd({error:u,headers:r,status:i,statusText:s,url:a||void 0}))},a=t=>{const{url:r}=o(),i=new gd({error:t,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});e.error(i)};let u=!1;const c=r=>{u||(e.next(o()),u=!0);let i={type:dd.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===t.responseType&&n.responseText&&(i.partialText=n.responseText),e.next(i)},h=t=>{let n={type:dd.UploadProgress,loaded:t.loaded};t.lengthComputable&&(n.total=t.total),e.next(n)};return n.addEventListener("load",s),n.addEventListener("error",a),t.reportProgress&&(n.addEventListener("progress",c),null!==r&&n.upload&&n.upload.addEventListener("progress",h)),n.send(r),e.next({type:dd.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("load",s),t.reportProgress&&(n.removeEventListener("progress",c),null!==r&&n.upload&&n.upload.removeEventListener("progress",h)),n.abort()}})}}))();const Cd=new bt("XSRF_COOKIE_NAME"),Ad=new bt("XSRF_HEADER_NAME");class Id{}let Od=(()=>(class{constructor(t,e,n){this.doc=t,this.platform=e,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=fa(t,this.cookieName),this.lastCookieString=t),this.lastToken}}))(),Dd=(()=>(class{constructor(t,e){this.tokenService=t,this.headerName=e}intercept(t,e){const n=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||n.startsWith("http://")||n.startsWith("https://"))return e.handle(t);const r=this.tokenService.getToken();return null===r||t.headers.has(this.headerName)||(t=t.clone({headers:t.headers.set(this.headerName,r)})),e.handle(t)}}))(),kd=(()=>(class{constructor(t,e){this.backend=t,this.injector=e,this.chain=null}handle(t){if(null===this.chain){const t=this.injector.get(wd,[]);this.chain=t.reduceRight((t,e)=>new bd(t,e),this.backend)}return this.chain.handle(t)}}))(),Pd=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:Dd,useClass:_d}]}}static withOptions(e={}){return{ngModule:t,providers:[e.cookieName?{provide:Cd,useValue:e.cookieName}:[],e.headerName?{provide:Ad,useValue:e.headerName}:[]]}}}return t})(),Nd=(()=>(class{}))();var Md=Hn({encapsulation:0,styles:[[".map[_ngcontent-%COMP%]{background-color:#000;cursor:none;position:absolute;width:100%;height:100%;overflow:hidden;left:0;top:0}.map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute}.map[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{z-index:3;border:1px dotted #00f}.objects[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:10px}.save-load-map[_ngcontent-%COMP%]{position:absolute;right:0;top:0;z-index:2;background-color:gray}"]],data:{}});function Rd(t){return Xo(0,[(t()(),No(0,0,null,null,2,"div",[["class","levels"]],null,null,null,null,null)),(t()(),No(1,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.loadFirebase(t.context.$implicit)&&r),r},null,null)),(t()(),zo(2,null,["",""]))],null,function(t,e){t(e,2,0,e.context.$implicit)})}function Ld(t){return Xo(0,[(t()(),No(0,0,null,null,9,"div",[],null,null,null,null,null)),(t()(),No(1,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),zo(2,null,["",""])),(t()(),No(3,0,null,null,6,"input",[["type","number"]],[[8,"value",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Gr(t,4)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Gr(t,4).onTouched()&&r),"compositionstart"===e&&(r=!1!==Gr(t,4)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Gr(t,4)._compositionEnd(n.target.value)&&r),"change"===e&&(r=!1!==Gr(t,5).onChange(n.target.value)&&r),"input"===e&&(r=!1!==Gr(t,5).onChange(n.target.value)&&r),"blur"===e&&(r=!1!==Gr(t,5).onTouched()&&r),"ngModelChange"===e&&(r=!1!==(i.enemies[t.context.$implicit.key]=n)&&r),r},null,null)),ni(4,16384,null,0,$u,[en,Ye,[2,Ju]],null,null),ni(5,16384,null,0,dc,[en,Ye],null,null),ii(1024,null,Qu,function(t,e){return[t,e]},[$u,dc]),ni(7,671744,null,0,jc,[[8,null],[8,null],[8,null],[6,Qu]],{model:[0,"model"]},{update:"ngModelChange"}),ii(2048,null,nc,null,[jc]),ni(9,16384,null,0,rc,[[4,nc]],null,null)],function(t,e){t(e,7,0,e.component.enemies[e.context.$implicit.key])},function(t,e){t(e,2,0,e.context.$implicit.key),t(e,3,0,yr(1,"",e.context.$implicit.value,""),Gr(e,9).ngClassUntouched,Gr(e,9).ngClassTouched,Gr(e,9).ngClassPristine,Gr(e,9).ngClassDirty,Gr(e,9).ngClassValid,Gr(e,9).ngClassInvalid,Gr(e,9).ngClassPending)})}function Fd(t){return Xo(0,[(t()(),No(0,0,null,null,5,"div",[["class","cursor"]],null,null,null,null,null)),ii(512,null,pa,ma,[gn,yn,Ye,en]),ni(2,278528,null,0,ya,[pa],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),ii(512,null,xa,Sa,[Ye,yn,en]),ni(4,278528,null,0,Aa,[xa],{ngStyle:[0,"ngStyle"]},null),Ho(5,{"top.px":0,"left.px":1})],function(t,e){var n=e.component;t(e,2,0,"cursor",n.currentBlock.type);var r=t(e,5,0,n.currentBlock.position.y+n.movement.y,n.currentBlock.position.x+n.movement.x);t(e,4,0,r)},null)}function Bd(t){return Xo(0,[(t()(),No(0,0,null,null,5,"div",[],null,null,null,null,null)),ii(512,null,pa,ma,[gn,yn,Ye,en]),ni(2,278528,null,0,ya,[pa],{ngClass:[0,"ngClass"]},null),ii(512,null,xa,Sa,[Ye,yn,en]),ni(4,278528,null,0,Aa,[xa],{ngStyle:[0,"ngStyle"]},null),Ho(5,{"top.px":0,"left.px":1})],function(t,e){var n=e.component;t(e,2,0,e.context.$implicit.type);var r=t(e,5,0,e.context.$implicit.position.y+n.movement.y,e.context.$implicit.position.x+n.movement.x);t(e,4,0,r)},null)}function Ud(t){return Xo(0,[Bo(402653184,1,{mapElement:0}),(t()(),No(1,0,null,null,1,"app-map-objects",[["class","objects"]],null,[[null,"selected"],[null,"object"]],function(t,e,n){var r=!0,i=t.component;return"selected"===e&&(r=!1!==i.selected(n)&&r),"object"===e&&(r=!1!==i.onObject(n)&&r),r},Qc,Kc)),ni(2,4243456,[["objects",4]],0,Wc,[Ye],null,{selected:"selected",object:"object"}),(t()(),No(3,0,null,null,24,"div",[["class","save-load-map"]],null,null,null,null,null)),(t()(),No(4,0,null,null,0,"input",[["accept","application/json"],["name","file"],["type","file"]],null,[[null,"change"]],function(t,e,n){var r=!0;return"change"===e&&(r=!1!==t.component.loadMap(n)&&r),r},null,null)),(t()(),No(5,0,null,null,1,"label",[["for","file"]],null,null,null,null,null)),(t()(),zo(-1,null,["Choose file"])),(t()(),No(7,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.save()&&r),r},null,null)),(t()(),zo(-1,null,["save"])),(t()(),No(9,0,null,null,12,"div",[],null,null,null,null,null)),(t()(),No(10,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),zo(-1,null,["Firebase"])),(t()(),No(12,0,null,null,5,"input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Gr(t,13)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Gr(t,13).onTouched()&&r),"compositionstart"===e&&(r=!1!==Gr(t,13)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Gr(t,13)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.levelNameSave=n)&&r),r},null,null)),ni(13,16384,null,0,$u,[en,Ye,[2,Ju]],null,null),ii(1024,null,Qu,function(t){return[t]},[$u]),ni(15,671744,null,0,jc,[[8,null],[8,null],[8,null],[6,Qu]],{model:[0,"model"]},{update:"ngModelChange"}),ii(2048,null,nc,null,[jc]),ni(17,16384,null,0,rc,[[4,nc]],null,null),(t()(),No(18,0,null,null,1,"button",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.saveFirebase()&&r),r},null,null)),(t()(),zo(-1,null,["save"])),(t()(),Po(16777216,null,null,1,null,Rd)),ni(21,278528,null,0,ba,[Sn,Tn,gn],{ngForOf:[0,"ngForOf"]},null),(t()(),No(22,0,null,null,0,"hr",[],null,null,null,null,null)),(t()(),No(23,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),zo(-1,null,["Enemies:"])),(t()(),Po(16777216,null,null,2,null,Ld)),ni(26,278528,null,0,ba,[Sn,Tn,gn],{ngForOf:[0,"ngForOf"]},null),ri(0,Oa,[yn]),(t()(),No(28,0,[[1,0],["mapElement",1]],null,4,"div",[["class","map"]],null,[[null,"mousemove"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],function(t,e,n){var r=!0,i=t.component;return"mousemove"===e&&(r=!1!==i.mousemove(n)&&r),"mousedown"===e&&(r=!1!==i.mousedown(n)&&r),"mouseup"===e&&(r=!1!==i.mouseup()&&r),"mouseleave"===e&&(r=!1!==i.mouseleave()&&r),r},null,null)),(t()(),Po(16777216,null,null,1,null,Fd)),ni(30,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null),(t()(),Po(16777216,null,null,1,null,Bd)),ni(32,278528,null,0,ba,[Sn,Tn,gn],{ngForOf:[0,"ngForOf"]},null),(t()(),No(33,0,null,null,0,"button",[["class","menu-icon menu-button"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.menuButtonClick()&&r),r},null,null))],function(t,e){var n=e.component;t(e,15,0,n.levelNameSave),t(e,21,0,n.levelList),t(e,26,0,jn(e,26,0,Gr(e,27).transform(n.enemies))),t(e,30,0,null==n.currentBlock?null:n.currentBlock.position),t(e,32,0,n.map)},function(t,e){t(e,12,0,Gr(e,17).ngClassUntouched,Gr(e,17).ngClassTouched,Gr(e,17).ngClassPristine,Gr(e,17).ngClassDirty,Gr(e,17).ngClassValid,Gr(e,17).ngClassInvalid,Gr(e,17).ngClassPending)})}class Vd{constructor(t){this.adsService=t,this.loading=!1,this.canWatchAds=!0,this.viewedRewardVideo=new xi,this.clickMenu=new xi}clickWatchAds(){return ra.__awaiter(this,void 0,void 0,function*(){if(this.canWatchAds)try{this.loading=!0,!0===(yield this.adsService.rewardVideo())&&this.viewedRewardVideo.emit()}finally{this.loading=!1}})}}var jd=Hn({encapsulation:0,styles:[["@import url(https://fonts.googleapis.com/css?family=VT323);.game-over[_ngcontent-%COMP%]{position:absolute;z-index:3;width:100vw;height:100vh;background-color:rgba(0,0,0,.7)}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]{position:relative;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:brown;width:70vw;height:70vh}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{height:100%}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .game-over-caption[_ngcontent-%COMP%]{height:10vh;font-size:10vh;text-align:center;font-family:VT323,monospace;line-height:10vh}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{display:-webkit-box;display:flex;width:100%;height:calc(100% - 10vh)}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:50%;height:100%;position:relative}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#000;font-family:VT323,monospace;font-size:54px}*[_ngcontent-%COMP%]{outline:0}.ads-button[_ngcontent-%COMP%]{position:absolute}.menu-btn[_ngcontent-%COMP%]{border:5px dotted brown;position:relative;height:120px;width:120px;background:#000;border-radius:5px}.menu-icon[_ngcontent-%COMP%]{position:absolute}.ads-icon[_ngcontent-%COMP%]{position:absolute;background-image:url(/games/tanks/ads-heart.951c2828e0c3d4ace247.png);width:128px;height:128px;-webkit-transform:scale(.5) translate(-50%,-50%)!important;transform:scale(.5) translate(-50%,-50%)!important;-webkit-transform-origin:0 0;transform-origin:0 0;cursor:pointer}.ads-icon.disabled[_ngcontent-%COMP%]{opacity:.5}.ads-button[_ngcontent-%COMP%], .ads-icon[_ngcontent-%COMP%], .center[_ngcontent-%COMP%], .menu-btn[_ngcontent-%COMP%], .menu-icon[_ngcontent-%COMP%]{top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}"]],data:{}});function qd(t){return Xo(0,[(t()(),No(0,0,null,null,14,"div",[["class","game-over"]],null,null,null,null,null)),(t()(),No(1,0,null,null,13,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),No(2,0,null,null,2,"div",[["class","loading"]],[[8,"hidden",0]],null,null,null,null)),(t()(),No(3,0,null,null,1,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),zo(-1,null,["Loading..."])),(t()(),No(5,0,null,null,9,"div",[["class","menu"]],[[8,"hidden",0]],null,null,null,null)),(t()(),No(6,0,null,null,1,"div",[["class","game-over-caption"]],null,null,null,null,null)),(t()(),zo(-1,null,["Game Over"])),(t()(),No(8,0,null,null,6,"div",[["class","flex"]],null,null,null,null,null)),(t()(),No(9,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),No(10,0,null,null,1,"button",[["class","menu-btn"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.clickWatchAds()&&r),r},null,null)),(t()(),No(11,0,null,null,0,"span",[["class","ads-icon"]],[[2,"disabled",null]],null,null,null,null)),(t()(),No(12,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),No(13,0,null,null,1,"button",[["class","menu-btn"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.clickMenu.emit()&&r),r},null,null)),(t()(),No(14,0,null,null,0,"span",[["class","menu-icon"]],null,null,null,null,null))],null,function(t,e){var n=e.component;t(e,2,0,!n.loading),t(e,5,0,n.loading),t(e,11,0,!n.canWatchAds)})}var Gd=n("OQdp"),Hd=n("MgzW"),zd=n.n(Hd);window.Promise||(window.Promise=Gd.Polyfill),Object.assign||(Object.assign=zd.a);var Wd="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!Wd.performance||!Wd.performance.now){var Kd=Date.now();Wd.performance||(Wd.performance={}),Wd.performance.now=function(){return Date.now()-Kd}}for(var Xd=Date.now(),Qd=["ms","moz","webkit","o"],Yd=0;Yd<Qd.length&&!Wd.requestAnimationFrame;++Yd){var Jd=Qd[Yd];Wd.requestAnimationFrame=Wd[Jd+"RequestAnimationFrame"],Wd.cancelAnimationFrame=Wd[Jd+"CancelAnimationFrame"]||Wd[Jd+"CancelRequestAnimationFrame"]}Wd.requestAnimationFrame||(Wd.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),n=16+Xd-e;return n<0&&(n=0),Xd=e,setTimeout(function(){Xd=Date.now(),t(performance.now())},n)}),Wd.cancelAnimationFrame||(Wd.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var $d=n("gRQh"),Zd=n.n($d),tf={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(Zd.a.tablet||Zd.a.phone){if(e=!1,Zd.a.apple.device){var n=navigator.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)>=11&&(e=!0)}if(Zd.a.android.device){var r=navigator.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)>=7&&(e=!0)}}return e?32:4}(),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:Zd.a.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!Zd.a.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},ef=n("uhBA"),nf=n.n(ef),rf=n("VmRL"),of=n.n(rf),sf=n("CxY0"),af=n.n(sf),uf={WEBGL_LEGACY:0,WEBGL:1,WEBGL2:2},cf={UNKNOWN:0,WEBGL:1,CANVAS:2},hf={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19,NONE:20,SRC_OVER:0,SRC_IN:21,SRC_OUT:22,SRC_ATOP:23,DST_OVER:24,DST_IN:25,DST_OUT:26,DST_ATOP:27,ERASE:26,SUBTRACT:28},lf={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},df={RGBA:6408,RGB:6407,ALPHA:6406,LUMINANCE:6409,LUMINANCE_ALPHA:6410,DEPTH_COMPONENT:6402,DEPTH_STENCIL:34041},ff={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067,TEXTURE_2D_ARRAY:35866,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074},pf={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,FLOAT:5126,HALF_FLOAT:36193},mf={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"};tf.RETINA_PREFIX=/@([0-9\.]+)x/,tf.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var gf,yf=!1,vf="5.1.0";function bf(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function wf(t){return t=t.toString(16),"#"+("000000".substr(0,6-t.length)+t)}var _f=function(){for(var t=[],e=[],n=0;n<32;n++)t[n]=n,e[n]=n;t[hf.NORMAL_NPM]=hf.NORMAL,t[hf.ADD_NPM]=hf.ADD,t[hf.SCREEN_NPM]=hf.SCREEN,e[hf.NORMAL]=hf.NORMAL_NPM,e[hf.ADD]=hf.ADD_NPM,e[hf.SCREEN]=hf.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}();function Ef(t,e){return _f[e?1:0][t]}function Tf(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var n=t>>16&255,r=t>>8&255;return(255*e<<24)+((n=n*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+((255&t)*e+.5|0)}function xf(t,e,n){var r,i=t.length;if(!(e>=i||0===n)){var o=i-(n=e+n>i?i-e:n);for(r=e;r<o;++r)t[r]=t[r+n];t.length=o}}var Sf=0;function Cf(){return++Sf}function Af(t){return 0===t?0:t<0?-1:1}function If(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)}function Of(t){return!(t&t-1||!t)}function Df(t){var e=(t>65535)<<4,n=((t>>>=e)>255)<<3;return e|=n,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}var kf,Pf={},Nf=Object.create(null),Mf=Object.create(null),Rf=function(t,e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||tf.RESOLUTION,this.resize(t,e)},Lf={width:{configurable:!0},height:{configurable:!0}};function Ff(t,e){var n=tf.RETINA_PREFIX.exec(t);return n?parseFloat(n[1]):void 0!==e?e:1}Rf.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},Rf.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},Rf.prototype.destroy=function(){this.context=null,this.canvas=null},Lf.width.get=function(){return this.canvas.width},Lf.width.set=function(t){this.canvas.width=t},Lf.height.get=function(){return this.canvas.height},Lf.height.set=function(t){this.canvas.height=t},Object.defineProperties(Rf.prototype,Lf);var Bf={},Uf=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e};Uf.prototype.clone=function(){return new Uf(this.x,this.y)},Uf.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},Uf.prototype.copyTo=function(t){return t.set(this.x,this.y),t},Uf.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Uf.prototype.set=function(t,e){this.x=t||0,this.y=e||(0!==e?this.x:0)};var Vf=function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),this._x=n,this._y=r,this.cb=t,this.scope=e},jf={x:{configurable:!0},y:{configurable:!0}};Vf.prototype.clone=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),new Vf(t||this.cb,e||this.scope,this._x,this._y)},Vf.prototype.set=function(t,e){var n=t||0,r=e||(0!==e?n:0);this._x===n&&this._y===r||(this._x=n,this._y=r,this.cb.call(this.scope))},Vf.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},Vf.prototype.copyTo=function(t){return t.set(this._x,this._y),t},Vf.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},jf.x.get=function(){return this._x},jf.x.set=function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},jf.y.get=function(){return this._y},jf.y.set=function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},Object.defineProperties(Vf.prototype,jf);var qf=2*Math.PI,Gf=180/Math.PI,Hf=Math.PI/180,zf={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},Wf=function(t,e,n,r,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o,this.array=null},Kf={IDENTITY:{configurable:!0},TEMP_MATRIX:{configurable:!0}};Wf.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},Wf.prototype.set=function(t,e,n,r,i,o){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o,this},Wf.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},Wf.prototype.apply=function(t,e){e=e||new Uf;var n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e},Wf.prototype.applyInverse=function(t,e){e=e||new Uf;var n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e},Wf.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},Wf.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},Wf.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,o=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=o*e-this.ty*n,this.ty=o*n+this.ty*e,this},Wf.prototype.append=function(t){var e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this},Wf.prototype.setTransform=function(t,e,n,r,i,o,s,a,u){return this.a=Math.cos(s+u)*i,this.b=Math.sin(s+u)*i,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this},Wf.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var n=this.a,r=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},Wf.prototype.decompose=function(t){var e=this.a,n=this.b,r=this.c,i=this.d,o=-Math.atan2(-r,i),s=Math.atan2(n,e),a=Math.abs(o+s);return a<1e-5||Math.abs(qf-a)<1e-5?(t.rotation=s,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=s),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx,t.position.y=this.ty,t},Wf.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,o=t*r-e*n;return this.a=r/o,this.b=-e/o,this.c=-n/o,this.d=t/o,this.tx=(n*this.ty-r*i)/o,this.ty=-(t*this.ty-e*i)/o,this},Wf.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Wf.prototype.clone=function(){var t=new Wf;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Wf.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Wf.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Kf.IDENTITY.get=function(){return new Wf},Kf.TEMP_MATRIX.get=function(){return new Wf},Object.defineProperties(Wf,Kf);var Xf=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Qf=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Yf=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Jf=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],$f=[],Zf=[],tp=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];$f.push(e);for(var n=0;n<16;n++)for(var r=tp(Xf[t]*Xf[n]+Yf[t]*Qf[n]),i=tp(Qf[t]*Xf[n]+Jf[t]*Qf[n]),o=tp(Xf[t]*Yf[n]+Yf[t]*Jf[n]),s=tp(Qf[t]*Yf[n]+Jf[t]*Jf[n]),a=0;a<16;a++)if(Xf[a]===r&&Qf[a]===i&&Yf[a]===o&&Jf[a]===s){e.push(a);break}}for(var u=0;u<16;u++){var c=new Wf;c.set(Xf[u],Qf[u],Yf[u],Jf[u],0,0),Zf.push(c)}}();var ep={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return Xf[t]},uY:function(t){return Qf[t]},vX:function(t){return Yf[t]},vY:function(t){return Jf[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return $f[t][e]},sub:function(t,e){return $f[t][ep.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?ep.S:ep.N:2*Math.abs(e)<=Math.abs(t)?t>0?ep.E:ep.W:e>0?t>0?ep.SE:ep.SW:t>0?ep.NE:ep.NW},matrixAppendRotationInv:function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=Zf[ep.inv(e)];i.tx=n,i.ty=r,t.append(i)}},np=function(){this.worldTransform=new Wf,this.localTransform=new Wf,this.position=new Vf(this.onChange,this,0,0),this.scale=new Vf(this.onChange,this,1,1),this.pivot=new Vf(this.onChange,this,0,0),this.skew=new Vf(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0},rp={rotation:{configurable:!0}};np.prototype.onChange=function(){this._localID++},np.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},np.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},np.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale._x,e.b=this._sx*this.scale._x,e.c=this._cy*this.scale._y,e.d=this._sy*this.scale._y,e.tx=this.position._x-(this.pivot._x*e.a+this.pivot._y*e.c),e.ty=this.position._y-(this.pivot._x*e.b+this.pivot._y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}},np.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},rp.rotation.get=function(){return this._rotation},rp.rotation.set=function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},Object.defineProperties(np.prototype,rp),np.IDENTITY=new np;var ip=function(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=zf.RECT},op={left:{configurable:!0},right:{configurable:!0},top:{configurable:!0},bottom:{configurable:!0}},sp={EMPTY:{configurable:!0}};op.left.get=function(){return this.x},op.right.get=function(){return this.x+this.width},op.top.get=function(){return this.y},op.bottom.get=function(){return this.y+this.height},sp.EMPTY.get=function(){return new ip(0,0,0,0)},ip.prototype.clone=function(){return new ip(this.x,this.y,this.width,this.height)},ip.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},ip.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},ip.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},ip.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},ip.prototype.fit=function(t){var e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(i-r,0)},ip.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y},ip.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.width=n-e,this.y=r,this.height=i-r},Object.defineProperties(ip.prototype,op),Object.defineProperties(ip,sp);var ap=function(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.radius=n,this.type=zf.CIRC};ap.prototype.clone=function(){return new ap(this.x,this.y,this.radius)},ap.prototype.contains=function(t,e){if(this.radius<=0)return!1;var n=this.x-t,r=this.y-e;return(n*=n)+(r*=r)<=this.radius*this.radius},ap.prototype.getBounds=function(){return new ip(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)};var up=function(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=n,this.height=r,this.type=zf.ELIP};up.prototype.clone=function(){return new up(this.x,this.y,this.width,this.height)},up.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=(t-this.x)/this.width,r=(e-this.y)/this.height;return(n*=n)+(r*=r)<=1},up.prototype.getBounds=function(){return new ip(this.x-this.width,this.y-this.height,this.width,this.height)};var cp=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];if(Array.isArray(t[0])&&(t=t[0]),t[0]instanceof Uf){for(var n=[],r=0,i=t.length;r<i;r++)n.push(t[r].x,t[r].y);t=n}this.points=t,this.type=zf.POLY,this.closeStroke=!0};cp.prototype.clone=function(){var t=new cp(this.points.slice());return t.closeStroke=this.closeStroke,t},cp.prototype.contains=function(t,e){for(var n=!1,r=this.points.length/2,i=0,o=r-1;i<r;o=i++){var s=this.points[2*i],a=this.points[2*i+1],u=this.points[2*o+1];a>e!=u>e&&t<(e-a)/(u-a)*(this.points[2*o]-s)+s&&(n=!n)}return n};var hp=function(t,e,n,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=20),this.x=t,this.y=e,this.width=n,this.height=r,this.radius=i,this.type=zf.RREC};hp.prototype.clone=function(){return new hp(this.x,this.y,this.width,this.height,this.radius)},hp.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var n=t-(this.x+this.radius),r=e-(this.y+this.radius),i=this.radius*this.radius;if(n*n+r*r<=i)return!0;if((n=t-(this.x+this.width-this.radius))*n+r*r<=i)return!0;if(n*n+(r=e-(this.y+this.height-this.radius))*r<=i)return!0;if((n=t-(this.x+this.radius))*n+r*r<=i)return!0}return!1},tf.SORTABLE_CHILDREN=!1;var lp=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null};lp.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},lp.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},lp.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?ip.EMPTY:((t=t||new ip(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},lp.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},lp.prototype.addQuad=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,o=t[0],s=t[1];e=o<e?o:e,n=s<n?s:n,r=o>r?o:r,i=s>i?s:i,e=(o=t[2])<e?o:e,n=(s=t[3])<n?s:n,r=o>r?o:r,i=s>i?s:i,e=(o=t[4])<e?o:e,n=(s=t[5])<n?s:n,r=o>r?o:r,i=s>i?s:i,n=(s=t[7])<n?s:n,r=(o=t[6])>r?o:r,i=s>i?s:i,this.minX=e=o<e?o:e,this.minY=n,this.maxX=r,this.maxY=i},lp.prototype.addFrame=function(t,e,n,r,i){var o=t.worldTransform,s=o.a,a=o.b,u=o.c,c=o.d,h=o.tx,l=o.ty,d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=s*e+u*n+h,y=a*e+c*n+l;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,d=(g=s*r+u*n+h)<d?g:d,f=(y=a*r+c*n+l)<f?y:f,p=g>p?g:p,m=y>m?y:m,d=(g=s*e+u*i+h)<d?g:d,f=(y=a*e+c*i+l)<f?y:f,p=g>p?g:p,m=y>m?y:m,f=(y=a*r+c*i+l)<f?y:f,p=(g=s*r+u*i+h)>p?g:p,m=y>m?y:m,this.minX=d=g<d?g:d,this.minY=f,this.maxX=p,this.maxY=m},lp.prototype.addVertexData=function(t,e,n){for(var r=this.minX,i=this.minY,o=this.maxX,s=this.maxY,a=e;a<n;a+=2){var u=t[a],c=t[a+1];r=u<r?u:r,i=c<i?c:i,o=u>o?u:o,s=c>s?c:s}this.minX=r,this.minY=i,this.maxX=o,this.maxY=s},lp.prototype.addVertices=function(t,e,n,r){for(var i=t.worldTransform,o=i.a,s=i.b,a=i.c,u=i.d,c=i.tx,h=i.ty,l=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=n;m<r;m+=2){var g=e[m],y=e[m+1],v=o*g+a*y+c,b=u*y+s*g+h;l=v<l?v:l,d=b<d?b:d,f=v>f?v:f,p=b>p?b:p}this.minX=l,this.minY=d,this.maxX=f,this.maxY=p},lp.prototype.addBounds=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i},lp.prototype.addBoundsMask=function(t,e){var n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=o){var s=this.minX,a=this.minY,u=this.maxX,c=this.maxY;this.minX=n<s?n:s,this.minY=r<a?r:a,this.maxX=i>u?i:u,this.maxY=o>c?o:c}},lp.prototype.addBoundsArea=function(t,e){var n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=o){var s=this.minX,a=this.minY,u=this.maxX,c=this.maxY;this.minX=n<s?n:s,this.minY=r<a?r:a,this.maxX=i>u?i:u,this.maxY=o>c?o:c}};var dp=function(t){function e(){t.call(this),this.tempDisplayObjectParent=null,this.transform=new np,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new lp,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._destroyed=!1,this.isSprite=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={_tempDisplayObjectParent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},worldTransform:{configurable:!0},localTransform:{configurable:!0},position:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0},skew:{configurable:!0},rotation:{configurable:!0},angle:{configurable:!0},zIndex:{configurable:!0},worldVisible:{configurable:!0},mask:{configurable:!0}};return e.mixin=function(t){for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(t,i))}},n._tempDisplayObjectParent.get=function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent},e.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&this.calculateBounds(),e||(this._boundsRect||(this._boundsRect=new ip),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new ip),t=this._localBoundsRect);var r=this.getBounds(!1,t);return this.parent=n,this.transform=e,r},e.prototype.toGlobal=function(t,e,n){return void 0===n&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.render=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,n,r,i,o,s,a,u){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===u&&(u=0),this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=u,this},e.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},n.x.get=function(){return this.position.x},n.x.set=function(t){this.transform.position.x=t},n.y.get=function(){return this.position.y},n.y.set=function(t){this.transform.position.y=t},n.worldTransform.get=function(){return this.transform.worldTransform},n.localTransform.get=function(){return this.transform.localTransform},n.position.get=function(){return this.transform.position},n.position.set=function(t){this.transform.position.copyFrom(t)},n.scale.get=function(){return this.transform.scale},n.scale.set=function(t){this.transform.scale.copyFrom(t)},n.pivot.get=function(){return this.transform.pivot},n.pivot.set=function(t){this.transform.pivot.copyFrom(t)},n.skew.get=function(){return this.transform.skew},n.skew.set=function(t){this.transform.skew.copyFrom(t)},n.rotation.get=function(){return this.transform.rotation},n.rotation.set=function(t){this.transform.rotation=t},n.angle.get=function(){return this.transform.rotation*Gf},n.angle.set=function(t){this.transform.rotation=t*Hf},n.zIndex.get=function(){return this._zIndex},n.zIndex.set=function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},n.worldVisible.get=function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},n.mask.get=function(){return this._mask},n.mask.set=function(t){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)},Object.defineProperties(e.prototype,n),e}(nf.a);function fp(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}dp.prototype.displayObjectUpdateTransform=dp.prototype.updateTransform;var pp=function(t){function e(){t.call(this),this.children=[],this.sortableChildren=tf.SORTABLE_CHILDREN,this.sortDirty=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={width:{configurable:!0},height:{configurable:!0}};return e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments,n=arguments.length;if(n>1)for(var r=0;r<n;r++)this.addChild(e[r]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);xf(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments,n=arguments.length;if(n>1)for(var r=0;r<n;r++)this.removeChild(e[r]);else{var i=this.children.indexOf(t);if(-1===i)return null;t.parent=null,t.transform._parentID=-1,xf(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,xf(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0);var n,r="number"==typeof e?e:this.children.length,i=r-t;if(i>0&&i<=r){n=this.children.splice(t,i);for(var o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var s=0;s<n.length;++s)n[s].emit("removed",this),this.emit("childRemoved",n[s],this,s);return n}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,n=this.children.length;e<n;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(fp),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];e.visible&&e.renderable&&(e.calculateBounds(),e._mask?(e._mask.calculateBounds(),this._bounds.addBoundsMask(e._bounds,e._mask._bounds)):e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds))}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters)this.renderAdvanced(t);else{this._render(t);for(var e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}n&&t.mask.push(this,this._mask),this._render(t);for(var i=0,o=this.children.length;i<o;i++)this.children[i].render(t);t.batch.flush(),n&&t.mask.pop(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var n="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(n)for(var i=0;i<r.length;++i)r[i].destroy(e)},n.width.get=function(){return this.scale.x*this.getLocalBounds().width},n.width.set=function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},n.height.get=function(){return this.scale.y*this.getLocalBounds().height},n.height.set=function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},Object.defineProperties(e.prototype,n),e}(dp);pp.prototype.containerUpdateTransform=pp.prototype.updateTransform,dp.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1});var mp=function(t){this._hookDiv=null,(Zd.a.tablet||Zd.a.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2,this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessibility=!1,window.addEventListener("keydown",this._onKeyDown,!1)};mp.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="HOOK DIV",e.addEventListener("focus",function(){t.isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e},mp.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},mp.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},mp.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessibility&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},mp.prototype.updateAccessibleObjects=function(t){if(t.visible){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}},mp.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,n=t.height/this.renderer.height,r=this.div;r.style.left=t.left+"px",r.style.top=t.top+"px",r.style.width=this.renderer.width+"px",r.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var o=this.children[i];if(o.renderId!==this.renderId)o._accessibleActive=!1,xf(this.children,i,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,i--,0===this.children.length&&this.deactivate();else{r=o._accessibleDiv;var s=o.hitArea,a=o.worldTransform;o.hitArea?(r.style.left=(a.tx+s.x*a.a)*e+"px",r.style.top=(a.ty+s.y*a.d)*n+"px",r.style.width=s.width*a.a*e+"px",r.style.height=s.height*a.d*n+"px"):(s=o.getBounds(),this.capHitArea(s),r.style.left=s.x*e+"px",r.style.top=s.y*n+"px",r.style.width=s.width*e+"px",r.style.height=s.height*n+"px",r.title!==o.accessibleTitle&&null!==o.accessibleTitle&&(r.title=o.accessibleTitle),r.getAttribute("aria-label")!==o.accessibleHint&&null!==o.accessibleHint&&r.setAttribute("aria-label",o.accessibleHint))}}this.renderId++}},mp.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},mp.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2,e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},mp.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},mp.prototype._onFocus=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},mp.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},mp.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},mp.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},mp.prototype.destroy=function(){this.destroyTouchHook(),this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null};var gp=function(t){this.items=[],this._name=t},yp={empty:{configurable:!0},name:{configurable:!0}};gp.prototype.emit=function(t,e,n,r,i,o,s,a){if(arguments.length>8)throw new Error("max arguments reached");for(var u=this,c=u.name,h=u.items,l=0,d=h.length;l<d;l++)h[l][c](t,e,n,r,i,o,s,a);return this},gp.prototype.add=function(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this},gp.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&this.items.splice(e,1),this},gp.prototype.contains=function(t){return-1!==this.items.indexOf(t)},gp.prototype.removeAll=function(){return this.items.length=0,this},gp.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},yp.empty.get=function(){return 0===this.items.length},yp.name.get=function(){return this._name},Object.defineProperties(gp.prototype,yp),gp.prototype.dispatch=gp.prototype.emit,gp.prototype.run=gp.prototype.emit,tf.TARGET_FPMS=.06;var vp=function(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=0),void 0===r&&(r=!1),this.fn=t,this.context=e,this.priority=n,this.once=r,this.next=null,this.previous=null,this._destroyed=!1};vp.prototype.match=function(t,e){return e=e||null,this.fn===t&&this.context===e},vp.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},vp.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},vp.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e};var bp=function(){var t=this;this._head=new vp(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/tf.TARGET_FPMS,this.elapsedMS=1/tf.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}},wp={FPS:{configurable:!0},minFPS:{configurable:!0},maxFPS:{configurable:!0}},_p={shared:{configurable:!0},system:{configurable:!0}};bp.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},bp.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},bp.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},bp.prototype.add=function(t,e,n){return void 0===n&&(n=0),this._addListener(new vp(t,e,n))},bp.prototype.addOnce=function(t,e,n){return void 0===n&&(n=0),this._addListener(new vp(t,e,n,!0))},bp.prototype._addListener=function(t){var e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this},bp.prototype.remove=function(t,e){for(var n=this._head.next;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this},bp.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},bp.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},bp.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},bp.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS&&e+.05*this._minElapsedMS<this._minElapsedMS)return;this.deltaMS=e,this.deltaTime=this.deltaMS*tf.TARGET_FPMS;for(var n=this._head,r=n.next;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},wp.FPS.get=function(){return 1e3/this.elapsedMS},wp.minFPS.get=function(){return 1e3/this._maxElapsedMS},wp.minFPS.set=function(t){var e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,tf.TARGET_FPMS);this._maxElapsedMS=1/n},wp.maxFPS.get=function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},wp.maxFPS.set=function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},_p.shared.get=function(){if(!bp._shared){var t=bp._shared=new bp;t.autoStart=!0,t._protected=!0}return bp._shared},_p.system.get=function(){if(!bp._system){var t=bp._system=new bp;t.autoStart=!0,t._protected=!0}return bp._system},Object.defineProperties(bp.prototype,wp),Object.defineProperties(bp,_p);var Ep=function(){};Ep.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,-25)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?bp.shared:new bp,t.autoStart&&this.start()},Ep.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}};var Tp=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new gp("setRealSize",2),this.onUpdate=new gp("update")},xp={valid:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};Tp.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),(this._width||this._height)&&this.onResize.run(this._width,this._height)},Tp.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t)},Tp.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.run(t,e))},xp.valid.get=function(){return!!this._width&&!!this._height},Tp.prototype.update=function(){this.destroyed||this.onUpdate.run()},Tp.prototype.load=function(){return Promise.resolve()},xp.width.get=function(){return this._width},xp.height.get=function(){return this._height},Tp.prototype.upload=function(t,e,n){return!1},Tp.prototype.style=function(t,e,n){return!1},Tp.prototype.dispose=function(){},Tp.prototype.destroy=function(){this.destroyed||(this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null,this.destroyed=!0,this.dispose())},Object.defineProperties(Tp.prototype,xp);var Sp=function(t){function e(e){t.call(this,e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.crossOrigin=function(t,e,n){void 0===n&&0!==e.indexOf("data:")?t.crossOrigin=function(t,e){return void 0===e&&(e=window.location),0===t.indexOf("data:")?"":(e=e||window.location,kf||(kf=document.createElement("a")),kf.href=t,(t=af.a.parse(kf.href)).hostname!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||t.protocol!==e.protocol?"anonymous":"")}(e):!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous")},e.prototype.upload=function(t,e,n,r){var i=t.gl,o=e.realWidth,s=e.realHeight;return r=r||this.source,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),e.target===i.TEXTURE_2D&&n.width===o&&n.height===s?i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,e.type,r):(n.width=o,n.height=s,i.texImage2D(e.target,0,e.format,e.format,e.type,r)),!0},e.prototype.update=function(){this.destroyed||(this.resize(this.source.naturalWidth||this.source.videoWidth||this.source.width,this.source.naturalHeight||this.source.videoHeight||this.source.height),t.prototype.update.call(this))},e.prototype.dispose=function(){this.source=null},e}(Tp),Cp=function(t){function e(e,n){if(n=n||{},!(e instanceof HTMLImageElement)){var r=new Image;t.crossOrigin(r,e,n.crossorigin),r.src=e,e=r}t.call(this,e),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(void 0!==n.createBitmap?n.createBitmap:tf.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,this.premultiplyAlpha=!1!==n.premultiplyAlpha,this.bitmap=null,this._load=null,!1!==n.autoLoad&&this.load()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.load=function(t){var e=this;return void 0!==t&&(this.createBitmap=t),this._load?this._load:(this._load=new Promise(function(t){e.url=e.source.src;var n=e.source,r=function(){e.destroyed||(n.onload=null,n.onerror=null,e.resize(n.width,n.height),e._load=null,t(e.createBitmap?e.process():e))};n.complete&&n.src?r():n.onload=r}),this._load)},e.prototype.process=function(){var t=this;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha?"premultiply":"none"}).then(function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))}),this._process):Promise.resolve(this)},e.prototype.upload=function(e,n,r){if(n.premultiplyAlpha=this.premultiplyAlpha,!this.createBitmap)return t.prototype.upload.call(this,e,n,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,n,r,this.bitmap),!this.preserveBitmap){var i=!0;for(var o in n._glTextures){var s=n._glTextures[o];if(s!==r&&s.dirtyId!==n.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e}(Sp),Ap=[];function Ip(t,e){if(!t)return null;var n="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(n=r[1].toLowerCase())}for(var i=Ap.length-1;i>=0;--i){var o=Ap[i];if(o.test&&o.test(t,n))return new o(t,e)}return new Cp(t,e)}var Op=function(t){function e(e,n){var r=n||{},i=r.width,o=r.height;if(!i||!o)throw new Error("BufferResource width or height invalid");t.call(this,i,o),this.data=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.upload=function(t,e,n){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.width===e.width&&n.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(n.width=e.width,n.height=e.height,r.texImage2D(e.target,0,n.internalFormat,e.width,e.height,0,e.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(Tp),Dp={scaleMode:0,format:df.RGBA,premultiplyAlpha:!1},kp=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null),t.call(this);var r=(n=n||{}).premultiplyAlpha,i=n.mipmap,o=n.anisotropicLevel,s=n.scaleMode,a=n.width,u=n.height,c=n.wrapMode,h=n.format,l=n.type,d=n.target,f=n.resolution;!e||e instanceof Tp||((e=Ip(e,n.resourceOptions)).internal=!0),this.width=a||0,this.height=u||0,this.resolution=f||tf.RESOLUTION,this.mipmap=void 0!==i?i:tf.MIPMAP_TEXTURES,this.anisotropicLevel=void 0!==o?o:tf.ANISOTROPIC_LEVEL,this.wrapMode=c||tf.WRAP_MODE,this.scaleMode=void 0!==s?s:tf.SCALE_MODE,this.format=h||df.RGBA,this.type=l||pf.UNSIGNED_BYTE,this.target=d||ff.TEXTURE_2D,this.premultiplyAlpha=!1!==r,this.uid=Cf(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this.setResource(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={realWidth:{configurable:!0},realHeight:{configurable:!0}};return n.realWidth.get=function(){return Math.ceil(this.width*this.resolution)},n.realHeight.get=function(){return Math.ceil(this.height*this.resolution)},e.prototype.setStyle=function(t,e){var n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=Math.ceil(t/this.resolution),this.height=Math.ceil(e/this.resolution),this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=Of(this.realWidth)&&Of(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.ceil(this.width*e/t),this.height=Math.ceil(this.height*e/t),this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Mf[this.cacheId],delete Nf[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.from=function(t,n){var r=null;"string"==typeof t?r=t:(t._pixiId||(t._pixiId="pixiid_"+Cf()),r=t._pixiId);var i=Mf[r];return i||((i=new e(t,n)).cacheId=r,e.addToCache(i,r)),i},e.fromBuffer=function(t,n,r,i){t=t||new Float32Array(n*r*4);var o=new Op(t,{width:n,height:r}),s=t instanceof Float32Array?pf.FLOAT:pf.UNSIGNED_BYTE;return new e(o,Object.assign(Dp,i||{width:n,height:r,type:s}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Mf[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Mf[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Mf[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Mf[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete Mf[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperties(e.prototype,n),e}(nf.a);kp._globalBatch=0;var Pp=function(t){function e(e,n){var r;n=n||{};var i=e;Array.isArray(e)&&(r=e,i=e.length),t.call(this,n.width,n.height),this.items=[],this.itemDirtyIds=[];for(var o=0;o<i;o++){var s=new kp;this.items.push(s),this.itemDirtyIds.push(-1)}if(this.length=i,this._load=null,r)for(var a=0;a<i;a++)this.addResourceAt(Ip(r[a],n),a)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=ff.TEXTURE_2D_ARRAY;for(var n=0;n<this.length;n++)this.items[n].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var n=0;n<this.length;n++)this.items[n].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map(function(t){return t.resource}),n=e.map(function(t){return t.load()});return this._load=Promise.all(n).then(function(){var n=e[0];return t.resize(n.width,n.height),Promise.resolve(t)}),this._load},e.prototype.upload=function(t,e,n){var r=this.length,i=this.itemDirtyIds,o=this.items,s=t.gl;n.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,r,0,e.format,e.type,null);for(var a=0;a<r;a++){var u=o[a];i[a]<u.dirtyId&&(i[a]=u.dirtyId,u.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,u.resource.width,u.resource.height,1,e.format,e.type,u.resource.source))}return!0},e}(Tp),Np=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(Sp),Mp=function(t){function e(n,r){if(t.call(this,n,r=r||{}),this.length!==e.SIDES)throw new Error("Invalid length. Got "+this.length+", expected 6");for(var i=0;i<e.SIDES;i++)this.items[i].target=ff.TEXTURE_CUBE_MAP_POSITIVE_X+i;!1!==r.autoLoad&&this.load()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=ff.TEXTURE_CUBE_MAP},e.prototype.upload=function(t,n,r){for(var i=this.itemDirtyIds,o=0;o<e.SIDES;o++){var s=this.items[o];i[o]<s.dirtyId&&(i[o]=s.dirtyId,s.valid&&s.resource.upload(t,s,r))}return!0},e}(Pp);Mp.SIDES=6;var Rp=function(t){function e(e,n){n=n||{},t.call(this,document.createElement("canvas")),this._width=0,this._height=0,this.svg=e,this.scale=n.scale||1,this._overrideWidth=n.width,this._overrideHeight=n.height,this._resolve=null,this._crossorigin=n.crossorigin,this._load=null,!1!==n.autoLoad&&this.load()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var e=this,n=new Image;t.crossOrigin(n,this.svg,this._crossorigin),n.src=this.svg,n.onload=function(){var t=n.width,r=n.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=t*e.scale,o=r*e.scale;(e._overrideWidth||e._overrideHeight)&&(i=e._overrideWidth||e._overrideHeight/r*t,o=e._overrideHeight||e._overrideWidth/t*r),i=Math.round(i),o=Math.round(o);var s=e.source;s.width=i,s.height=o,s._pixiId="canvas_"+Cf(),s.getContext("2d").drawImage(n,0,0,t,r,0,0,i,o),e._resolve(),e._resolve=null}},e.getSize=function(t){var n=e.SVG_SIZE.exec(t),r={};return n&&(r[n[1]]=Math.round(parseFloat(n[3])),r[n[5]]=Math.round(parseFloat(n[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&0===t.indexOf("data:image/svg+xml;base64")||"string"==typeof t&&0===t.indexOf("<svg")},e}(Sp);Rp.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Lp=function(t){function e(e,n){if(n=n||{},!(e instanceof HTMLVideoElement)){var r=document.createElement("video");r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),"string"==typeof e&&(e=[e]),t.crossOrigin(r,e[0].src||e[0],n.crossorigin);for(var i=0;i<e.length;++i){var o=document.createElement("source"),s=e[i],a=s.src,u=s.mime,c=(a=a||e[i]).split("?").shift().toLowerCase(),h=c.substr(c.lastIndexOf(".")+1);u=u||"video/"+h,o.src=a,o.type=u,r.appendChild(o)}e=r}t.call(this,e),this._autoUpdate=!0,this._isAutoUpdating=!1,this._updateFPS=n.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==n.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),!1!==n.autoLoad&&this.load()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={autoUpdate:{configurable:!0},updateFPS:{configurable:!0}};return e.prototype.update=function(e){void 0===e&&(e=0),this.destroyed||(this._msToNextUpdate=Math.floor(this._msToNextUpdate-bp.shared.elapsedMS*this.source.playbackRate),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this,e),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay)),this._load=new Promise(function(n){t.valid?n(t):(t._resolve=n,e.load())}),this._load},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(bp.shared.add(this.update,this),this._isAutoUpdating=!0)},e.prototype._onPlayStop=function(){this._isAutoUpdating&&(bp.shared.remove(this.update,this),this._isAutoUpdating=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isAutoUpdating&&bp.shared.remove(this.update,this),this.source&&(this.source.pause(),this.source.src="",this.source.load()),t.prototype.dispose.call(this)},n.autoUpdate.get=function(){return this._autoUpdate},n.autoUpdate.set=function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(bp.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(bp.shared.add(this.update,this),this._isAutoUpdating=!0))},n.updateFPS.get=function(){return this._updateFPS},n.updateFPS.set=function(t){t!==this._updateFPS&&(this._updateFPS=t)},e.test=function(t,n){return t instanceof HTMLVideoElement||e.TYPES.indexOf(n)>-1},Object.defineProperties(e.prototype,n),e}(Sp);Lp.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Ap.push(Cp,function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(Sp),Np,Lp,Rp,Op,Mp,Pp);var Fp=function(t){this.renderer=t};Fp.prototype.destroy=function(){this.renderer=null};var Bp=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.upload=function(t,e,n){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.width===e.width&&n.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(n.width=e.width,n.height=e.height,r.texImage2D(e.target,0,r.DEPTH_COMPONENT16,e.width,e.height,0,e.format,e.type,this.data)),!0},e}(Op),Up=function(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new gp("disposeFramebuffer",2)},Vp={colorTexture:{configurable:!0}};Vp.colorTexture.get=function(){return this.colorTextures[0]},Up.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new kp(null,{scaleMode:0,resolution:1,mipmap:!1,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Up.prototype.addDepthTexture=function(t){return this.depthTexture=t||new kp(new Bp(null,{width:this.width,height:this.height}),{scaleMode:0,resolution:1,width:this.width,height:this.height,mipmap:!1,format:df.DEPTH_COMPONENT,type:pf.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Up.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Up.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Up.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var n=0;n<this.colorTextures.length;n++){var r=this.colorTextures[n],i=r.resolution;r.setSize(t/i,e/i)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(t/o,e/o)}}},Up.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Object.defineProperties(Up.prototype,Vp);var jp=function(t){function e(e){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.call(this,null,e);var n=e||{},r=n.width,i=n.height;this.mipmap=!1,this.width=Math.ceil(r)||100,this.height=Math.ceil(i)||100,this.valid=!0,this._canvasRenderTarget=null,this.clearColor=[0,0,0,0],this.framebuffer=new Up(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this).enableStencil(),this.stencilMaskStack=[],this.filterStack=[{}]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.framebuffer=null},e}(kp),qp=function(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)};qp.prototype.set=function(t,e,n){var r=e.width,i=e.height;if(n){var o=t.width/2/r,s=t.height/2/i,a=t.x/r+o,u=t.y/i+s;n=ep.add(n,ep.NW),this.x0=a+o*ep.uX(n),this.y0=u+s*ep.uY(n),n=ep.add(n,2),this.x1=a+o*ep.uX(n),this.y1=u+s*ep.uY(n),n=ep.add(n,2),this.x2=a+o*ep.uX(n),this.y2=u+s*ep.uY(n),n=ep.add(n,2),this.x3=a+o*ep.uX(n),this.y3=u+s*ep.uY(n)}else this.x0=t.x/r,this.y0=t.y/i,this.x1=(t.x+t.width)/r,this.y1=t.y/i,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/i,this.x3=t.x/r,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3};var Gp=new qp,Hp=function(t){function e(n,r,i,o,s,a){if(t.call(this),this.noFrame=!1,r||(this.noFrame=!0,r=new ip(0,0,1,1)),n instanceof e&&(n=n.baseTexture),this.baseTexture=n,this._frame=r,this.trim=o,this.valid=!1,this.requiresUpdate=!1,this._uvs=Gp,this.uvMatrix=null,this.orig=i||r,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Uf(a.x,a.y):new Uf(0,0),this._updateID=0,this.textureCacheIds=[],n.valid?this.noFrame?n.valid&&this.onBaseTextureUpdated(n):this.frame=r:n.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&n.on("update",this.onBaseTextureUpdated,this)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={frame:{configurable:!0},rotate:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var n=this.baseTexture.resource;n&&Nf[n.url]&&e.removeFromCache(n.url),this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===Gp&&(this._uvs=new qp),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,n){void 0===n&&(n={});var r=null;"string"==typeof t?r=t:(t._pixiId||(t._pixiId="pixiid_"+Cf()),r=t._pixiId);var i=Nf[r];return i||(n.resolution||(n.resolution=Ff(t)),(i=new e(new kp(t,n))).baseTexture.cacheId=r,kp.addToCache(i.baseTexture,r),e.addToCache(i,r)),i},e.fromBuffer=function(t,n,r,i){return new e(kp.fromBuffer(t,n,r,i))},e.fromLoader=function(t,n,r){var i=new Cp(t);i.url=n;var o=new e(new kp(i,{scaleMode:tf.SCALE_MODE,resolution:Ff(n)}));return r||(r=n),kp.addToCache(o.baseTexture,r),e.addToCache(o,r),r!==n&&(kp.addToCache(o.baseTexture,n),e.addToCache(o,n)),o},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Nf[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),Nf[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Nf[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Nf[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)Nf[t.textureCacheIds[r]]===t&&delete Nf[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},n.frame.get=function(){return this._frame},n.frame.set=function(t){this._frame=t,this.noFrame=!1;var e=t.x,n=t.y,r=t.width,i=t.height,o=e+r>this.baseTexture.width,s=n+i>this.baseTexture.height;if(o||s)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width+" "+(o&&s?"and":"or")+" Y: "+n+" + "+i+" = "+(n+i)+" > "+this.baseTexture.height);this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},n.rotate.get=function(){return this._rotate},n.rotate.set=function(t){this._rotate=t,this.valid&&this.updateUvs()},n.width.get=function(){return this.orig.width},n.height.get=function(){return this.orig.height},Object.defineProperties(e.prototype,n),e}(nf.a);function zp(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Hp.EMPTY=new Hp(new kp),zp(Hp.EMPTY),zp(Hp.EMPTY.baseTexture),Hp.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Hp(new kp(new Np(t)))}(),zp(Hp.WHITE),zp(Hp.WHITE.baseTexture);var Wp=function(t){function e(e,n){var r=null;if(!(e instanceof jp)){var i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4];console.warn("Please use RenderTexture.create("+i+", "+o+") instead of the ctor directly."),r=arguments[0],n=null,e=new jp({width:i,height:o,scaleMode:s,resolution:a})}t.call(this,e,n),this.legacyRenderer=r,this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.resize=function(t,e,n){void 0===n&&(n=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,n&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new jp(t))},e}(Hp),Kp=function(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0};Kp.prototype.createTexture=function(t,e){var n=new jp(Object.assign({width:t,height:e},this.textureOptions));return new Wp(n)},Kp.prototype.getOptimalTexture=function(t,e,n){void 0===n&&(n=1);var r=Kp.SCREEN_KEY;t*=n,e*=n,this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight||(r=(65535&(t=If(t)))<<16|65535&(e=If(e))),this.texturePool[r]||(this.texturePool[r]=[]);var i=this.texturePool[r].pop();return i||(i=this.createTexture(t,e)),i.filterPoolKey=r,i.setResolution(n),i},Kp.prototype.getFilterTexture=function(t){var e=this.renderer.renderTexture.current,n=this.getOptimalTexture(e.width,e.height,t||e.baseTexture.resolution);return n.filterFrame=e.filterFrame,n},Kp.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},Kp.prototype.returnFilterTexture=function(t){this.returnTexture(t)},Kp.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var n=this.texturePool[e];if(n)for(var r=0;r<n.length;r++)n[r].destroy(!0)}this.texturePool={}},Kp.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){var e=Kp.SCREEN_KEY,n=this.texturePool[e];if(this.enableFullScreen=t.width>0&&t.height>0,n)for(var r=0;r<n.length;r++)n[r].destroy(!0);this.texturePool[e]=[],this._pixelsWidth=t.width,this._pixelsHeight=t.height}},Kp.SCREEN_KEY="screen";var Xp=function(t,e,n,r,i,o,s){void 0===n&&(n=!1),void 0===r&&(r=5126),this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=i,this.start=o,this.instance=s};Xp.prototype.destroy=function(){this.buffer=null},Xp.from=function(t,e,n,r,i){return new Xp(t,e,n,r,i)};var Qp=0,Yp=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=Qp++,this.disposeRunner=new gp("disposeBuffer",2)};function Jp(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}Yp.prototype.update=function(t){this.data=t||this.data,this._updateID++},Yp.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Yp.prototype.destroy=function(){this.dispose(),this.data=null},Yp.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new Yp(t)};var $p={Float32Array,Uint32Array,Int32Array,Uint8Array},Zp={5126:4,5123:2,5121:1},tm=0,em={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},nm=function(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=tm++,this.instanced=!1,this.instanceCount=1,this._size=null,this.disposeRunner=new gp("disposeGeometry",2),this.refCount=0};nm.prototype.addAttribute=function(t,e,n,r,i,o,s,a){if(void 0===r&&(r=!1),void 0===a&&(a=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e.data||(e instanceof Array&&(e=new Float32Array(e)),e=new Yp(e));var u=t.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],e,n,r,i);return this}var h=this.buffers.indexOf(e);return-1===h&&(this.buffers.push(e),h=this.buffers.length-1),this.attributes[t]=new Xp(h,n,r,i,o,s,a),this.instanced=this.instanced||a,this},nm.prototype.getAttribute=function(t){return this.attributes[t]},nm.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},nm.prototype.addIndex=function(t){return t.data||(t instanceof Array&&(t=new Uint16Array(t)),t=new Yp(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},nm.prototype.getIndex=function(){return this.indexBuffer},nm.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],n=[],r=new Yp;for(t in this.attributes){var i=this.attributes[t];e.push(this.buffers[i.buffer].data),n.push(i.size*Zp[i.type]/4),i.buffer=0}for(r.data=function(t,e){for(var n=0,r=0,i={},o=0;o<t.length;o++)r+=e[o],n+=t[o].length;for(var s=new ArrayBuffer(4*n),a=null,u=0,c=0;c<t.length;c++){var h=e[c],l=t[c],d=Jp(l);i[d]||(i[d]=new $p[d](s)),a=i[d];for(var f=0;f<l.length;f++)a[(f/h|0)*r+u+f%h]=l[f];u+=h}return new Float32Array(s)}(e,n),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},nm.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},nm.prototype.dispose=function(){this.disposeRunner.run(this,!1)},nm.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer.destroy(),this.attributes=null},nm.prototype.clone=function(){for(var t=new nm,e=0;e<this.buffers.length;e++)t.buffers[e]=new Yp(this.buffers[e].data.slice());for(var n in this.attributes){var r=this.attributes[n];t.attributes[n]=new Xp(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.index=!0),t},nm.merge=function(t){for(var e,n=new nm,r=[],i=[],o=[],s=0;s<t.length;s++){e=t[s];for(var a=0;a<e.buffers.length;a++)i[a]=i[a]||0,i[a]+=e.buffers[a].data.length,o[a]=0}for(var u=0;u<e.buffers.length;u++)r[u]=new(em[Jp(e.buffers[u].data)])(i[u]),n.buffers[u]=new Yp(r[u]);for(var c=0;c<t.length;c++){e=t[c];for(var h=0;h<e.buffers.length;h++)r[h].set(e.buffers[h].data,o[h]),o[h]+=e.buffers[h].data.length}if(n.attributes=e.attributes,e.indexBuffer){n.indexBuffer=n.buffers[e.buffers.indexOf(e.indexBuffer)],n.indexBuffer.index=!0;for(var l=0,d=0,f=0,p=0,m=0;m<e.buffers.length;m++)if(e.buffers[m]!==e.indexBuffer){p=m;break}for(var g in e.attributes){var y=e.attributes[g];(0|y.buffer)===p&&(d+=y.size*Zp[y.type]/4)}for(var v=0;v<t.length;v++){for(var b=t[v].indexBuffer.data,w=0;w<b.length;w++)n.indexBuffer.data[w+f]+=l;l+=e.buffers[p].data.length/d,f+=b.length}}return n};var rm=function(t){function e(){t.call(this),this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(nm),im=function(t){function e(){t.call(this),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Yp(this.vertices),this.uvBuffer=new Yp(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.map=function(t,e){var n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,r=e.y,this.vertices[0]=n=e.x,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(nm),om=0,sm=function(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=om++,this.static=!!e};sm.prototype.update=function(){this.dirtyId++},sm.prototype.add=function(t,e,n){this.uniforms[t]=new sm(e,n)},sm.from=function(t,e){return new sm(t,e)};var am=function(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new ip,this.destinationFrame=new ip,this.filters=[]};am.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null};var um=function(t){function e(e){t.call(this,e),this.defaultFilterStack=[{}],this.texturePool=new Kp,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new rm,this.quadUv=new im,this.tempRect=new ip,this.activeState={},this.globalUniforms=new sm({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this._pixelsWidth=e.view.width,this._pixelsHeight=e.view.height}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.push=function(t,e){for(var n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new am,o=e[0].resolution,s=e[0].padding,a=e[0].autoFit,u=e[0].legacy,c=1;c<e.length;c++){var h=e[c];o=Math.min(o,h.resolution),s=Math.max(s,h.padding),a=a||h.autoFit,u=u||h.legacy}1===r.length&&(this.defaultFilterStack[0].renderTexture=n.renderTexture.current),r.push(i),i.resolution=o,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(s),a&&i.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),i.sourceFrame.ceil(o),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height,i.renderTexture.filterFrame=i.sourceFrame,n.renderTexture.bind(i.renderTexture,i.sourceFrame),n.renderTexture.clear()},e.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var i=r.inputSize,o=r.inputPixel,s=r.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],o[0]=i[0]*e.resolution,o[1]=i[1]*e.resolution,o[2]=1/o[0],o[3]=1/o[1],s[0]=.5*o[2],s[1]=.5*o[3],s[2]=e.sourceFrame.width*i[2]-.5*o[2],s[3]=e.sourceFrame.height*i[3]-.5*o[3],e.legacy){var a=r.filterArea;a[0]=e.destinationFrame.width,a[1]=e.destinationFrame.height,a[2]=e.sourceFrame.x,a[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var u=t[t.length-1];if(1===n.length)n[0].apply(this,e.renderTexture,u.renderTexture,!1,e),this.returnFilterTexture(e.renderTexture);else{var c=e.renderTexture,h=this.getOptimalFilterTexture(c.width,c.height,e.resolution);h.filterFrame=c.filterFrame;var l=0;for(l=0;l<n.length-1;++l){n[l].apply(this,c,h,!0,e);var d=c;c=h,h=d}n[l].apply(this,c,u.renderTexture,!1,e),this.returnFilterTexture(c),this.returnFilterTexture(h)}e.clear(),this.statePool.push(e)},e.prototype.applyFilter=function(t,e,n,r){var i=this.renderer;i.renderTexture.bind(n,n?n.filterFrame:null),r&&i.renderTexture.clear(),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.state.set(t.state),i.shader.bind(t),t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(lf.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(lf.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var n=this.activeState,r=n.sourceFrame,i=n.destinationFrame,o=e._texture.orig,s=t.set(i.width,0,0,i.height,r.x,r.y),a=e.worldTransform.copyTo(Wf.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(e.anchor.x,e.anchor.y),s},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,e,n){return void 0===n&&(n=1),this.texturePool.getOptimalTexture(t,e,n)},e.prototype.getFilterTexture=function(t){var e=this.activeState.renderTexture,n=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution);return n.filterFrame=e.filterFrame,n},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e}(Fp),cm=function(t){this.renderer=t};cm.prototype.flush=function(){},cm.prototype.destroy=function(){this.renderer=null},cm.prototype.start=function(){},cm.prototype.stop=function(){this.flush()},cm.prototype.render=function(t){};var hm=function(t){function e(e){t.call(this,e),this.emptyRenderer=new cm(e),this.currentRenderer=this.emptyRenderer}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e}(Fp);tf.PREFER_ENV=Zd.a.any?uf.WEBGL:uf.WEBGL2;var lm=0,dm=function(t){function e(e){t.call(this,e),this.webGLVersion=1,this.extensions={},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={isLost:{configurable:!0}};return n.isLost.get=function(){return!this.gl||this.gl.isContextLost()},e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=lm++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=lm++,this.renderer.runners.contextChange.run(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(t,e){var n;if(tf.PREFER_ENV>=uf.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,!(n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),n},e.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBKIT_WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.run(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.gl.flush()},e.prototype.validateContext=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")},Object.defineProperties(e.prototype,n),e}(Fp),fm=function(t){function e(e){t.call(this,e),this.managedFramebuffers=[],this.unknownFramebuffer=new Up(10,10)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={size:{configurable:!0}};return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ip,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;tf.PREFER_ENV===uf.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}},e.prototype.bind=function(t,e){var n=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var i=0;i<t.colorTextures.length;i++)this.renderer.texture.unbind(t.colorTextures[i].texturePart?t.colorTextures[i].texture:t.colorTextures[i]);t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,n,r){var i=this.viewport;i.width===n&&i.height===r&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=n,i.height=r,this.gl.viewport(t,e,n,r))},n.size.get=function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},e.prototype.clear=function(t,e,n,r){var i=this.gl;i.clearColor(t,e,n,r),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},e.prototype.initFramebuffer=function(t){var e={framebuffer:this.gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};return t.glFramebuffers[this.CONTEXT_UID]=e,this.managedFramebuffers.push(t),t.disposeRunner.add(this),e},e.prototype.resizeFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var r=t.colorTextures,i=0;i<r.length;i++)this.renderer.texture.bind(r[i],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures.length;e.drawBuffers||(r=Math.min(r,1));for(var i=[],o=0;o<r;o++){var s=t.colorTextures[o];s.texturePart?(this.renderer.texture.bind(s.texture,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_CUBE_MAP_NEGATIVE_X+s.side,s.texture._glTextures[this.CONTEXT_UID].texture,0)):(this.renderer.texture.bind(s,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,0)),i.push(e.COLOR_ATTACHMENT0+o)}if(i.length>1&&e.drawBuffers(i),t.depthTexture&&this.writeDepthTexture){var a=t.depthTexture;this.renderer.texture.bind(a,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,0)}n.stencil||!t.stencil&&!t.depth||(n.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,n.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height))},e.prototype.disposeFramebuffer=function(t,e){var n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(n){delete t.glFramebuffers[this.CONTEXT_UID];var i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.stencil&&r.deleteRenderbuffer(n.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new ip},Object.defineProperties(e.prototype,n),e}(Fp),pm=function(t){this.buffer=t,this.updateID=-1,this.byteLength=-1,this.refCount=0},mm={5126:4,5123:2,5121:1},gm=function(t){function e(e){t.call(this,e),this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.boundBuffers={},this.managedGeometries={},this.managedBuffers={}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!t.createVertexArray){var n=this.renderer.context.extensions.vertexArrayObject;tf.PREFER_ENV===uf.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=function(){return n.createVertexArrayOES()},t.bindVertexArray=function(t){return n.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return n.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){},t.bindVertexArray=function(){},t.deleteVertexArray=function(){})}if(!t.vertexAttribDivisor){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,n,i,o){return r.drawElementsInstancedANGLE(t,e,n,i,o)},t.drawArraysInstanced=function(t,e,n,i){return r.drawArraysInstancedANGLE(t,e,n,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var n=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID];r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={});var i=r[e.program.id]||this.initGeometryVao(t,e.program);this._activeGeometry=t,this._activeVao!==i&&(this._activeVao=i,this.hasVao?n.bindVertexArray(i):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,n=0;n<t.buffers.length;n++){var r=t.buffers[n],i=r._glBuffers[this.CONTEXT_UID];if(r._updateID!==i.updateID){i.updateID=r._updateID;var o=r.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(o,i.buffer),this._boundBuffer=i,i.byteLength>=r.data.byteLength)e.bufferSubData(o,0,r.data);else{var s=r.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=r.data.byteLength,e.bufferData(o,r.data,s)}}}},e.prototype.checkCompatibility=function(t,e){var n=t.attributes,r=e.attributeData;for(var i in r)if(!n[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},e.prototype.getSignature=function(t,e){var n=t.attributes,r=e.attributeData,i=["g",t.id];for(var o in n)r[o]&&i.push(o);return i.join("-")},e.prototype.initGeometryVao=function(t,e){this.checkCompatibility(t,e);var n=this.gl,r=this.CONTEXT_UID,i=this.getSignature(t,e),o=t.glVertexArrayObjects[this.CONTEXT_UID],s=o[i];if(s)return o[e.id]=s,s;var a=t.buffers,u=t.attributes,c={},h={};for(var l in a)c[l]=0,h[l]=0;for(var d in u)!u[d].size&&e.attributeData[d]?u[d].size=e.attributeData[d].size:u[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),c[u[d].buffer]+=u[d].size*mm[u[d].type];for(var f in u){var p=u[f],m=p.size;void 0===p.stride&&(p.stride=c[p.buffer]===m*mm[p.type]?0:c[p.buffer]),void 0===p.start&&(p.start=h[p.buffer],h[p.buffer]+=m*mm[p.type])}s=n.createVertexArray(),n.bindVertexArray(s);for(var g=0;g<a.length;g++){var y=a[g];y._glBuffers[r]||(y._glBuffers[r]=new pm(n.createBuffer()),this.managedBuffers[y.id]=y,y.disposeRunner.add(this)),y._glBuffers[r].refCount++}return this.activateVao(t,e),this._activeVao=s,o[e.id]=s,o[i]=s,s},e.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,i=t.buffers;if(t.disposeRunner.remove(this),n){for(var o=0;o<i.length;o++){var s=i[o]._glBuffers[this.CONTEXT_UID];s.refCount--,0!==s.refCount||e||this.disposeBuffer(i[o],e)}if(!e)for(var a in n)if("g"===a[0]){var u=n[a];this._activeVao===u&&this.unbind(),r.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t);e=Object.keys(this.managedBuffers);for(var r=0;r<e.length;r++)this.disposeBuffer(this.managedBuffers[e[r]],t)},e.prototype.activateVao=function(t,e){var n=this.gl,r=this.CONTEXT_UID,i=t.buffers,o=t.attributes;t.indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[r].buffer);var s=null;for(var a in o){var u=o[a],c=i[u.buffer]._glBuffers[r];if(e.attributeData[a]){s!==c&&(n.bindBuffer(n.ARRAY_BUFFER,c.buffer),s=c);var h=e.attributeData[a].location;if(n.enableVertexAttribArray(h),n.vertexAttribPointer(h,u.size,u.type||n.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(h,1)}}}},e.prototype.draw=function(t,e,n,r){var i=this.gl,o=this._activeGeometry;if(o.indexBuffer){var s=o.indexBuffer.data.BYTES_PER_ELEMENT,a=2===s?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?o.instanced?i.drawElementsInstanced(t,e||o.indexBuffer.data.length,a,(n||0)*s,r||1):i.drawElements(t,e||o.indexBuffer.data.length,a,(n||0)*s):console.warn("unsupported index buffer type: uint32")}else o.instanced?i.drawArraysInstanced(t,n,e||o.getSize(),r||1):i.drawArrays(t,n,e||o.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e}(Fp);function ym(t,e,n,r){var i=vm(t,t.VERTEX_SHADER,e),o=vm(t,t.FRAGMENT_SHADER,n),s=t.createProgram();if(t.attachShader(s,i),t.attachShader(s,o),r)for(var a in r)t.bindAttribLocation(s,r[a],a);return t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(s,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(s)),t.deleteProgram(s),s=null),t.deleteShader(i),t.deleteShader(o),s}function vm(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.warn(n),console.error(t.getShaderInfoLog(r)),null)}function bm(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return wm(2*e);case"bvec3":return wm(3*e);case"bvec4":return wm(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function wm(t){for(var e=new Array(t),n=0;n<e.length;n++)e[n]=!1;return e}var _m,Em=null;function Tm(){if(!Em){var t,e=document.createElement("canvas");if(tf.PREFER_ENV>=uf.WEBGL2&&(t=e.getContext("webgl2",{})),!t){if(!(t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{})))throw new Error("This browser does not support WebGL. Try using the canvas renderer");t.getExtension("WEBGL_draw_buffers")}return Em=t,t}return Em}function xm(t,e,n){if("precision"!==t.substring(0,9)){var r=e;return e===mf.HIGH&&n!==mf.HIGH&&(r=mf.MEDIUM),"precision "+r+" float;\n"+t}return n!==mf.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var Sm={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Cm(t){return Sm[t]}var Am=null,Im={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function Om(t,e){if(!Am){var n=Object.keys(Im);Am={};for(var r=0;r<n.length;++r){var i=n[r];Am[t[i]]=Im[i]}}return Am[e]}var Dm,km={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Pm={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Nm=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Mm(t){for(var e="",n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+="if(test == "+n+".0){}");return e}var Rm=0,Lm={},Fm=function t(e,n,r){void 0===r&&(r="pixi-shader"),this.id=Rm++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=n||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Lm[r]?(Lm[r]++,r+="-"+Lm[r]):Lm[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=xm(this.vertexSrc,tf.PRECISION_VERTEX,mf.HIGH),this.fragmentSrc=xm(this.fragmentSrc,tf.PRECISION_FRAGMENT,function(){if(!_m){_m=mf.MEDIUM;var t=Tm();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);_m=e.precision?mf.HIGH:mf.MEDIUM}}return _m}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null},Bm={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};Fm.prototype.extractData=function(t,e){var n=Tm();if(n){var r=ym(n,t,e);this.attributeData=this.getAttributeData(r,n),this.uniformData=this.getUniformData(r,n),n.deleteProgram(r)}else this.uniformData={},this.attributeData={}},Fm.prototype.getAttributeData=function(t,e){for(var n={},r=[],i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<i;o++){var s=e.getActiveAttrib(t,o),a=Om(e,s.type),u={type:a,name:s.name,size:Cm(a),location:0};n[s.name]=u,r.push(u)}r.sort(function(t,e){return t.name>e.name?1:-1});for(var c=0;c<r.length;c++)r[c].location=c;return n},Fm.prototype.getUniformData=function(t,e){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;i++){var o=e.getActiveUniform(t,i),s=o.name.replace(/\[.*?\]/,""),a=o.name.match(/\[.*?\]/,""),u=Om(e,o.type);n[s]={type:u,size:o.size,isArray:a,value:bm(u,o.size)}}return n},Bm.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},Bm.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},Fm.from=function(t,e,n){var r=t+e,i=Pf[r];return i||(Pf[r]=i=new Fm(t,e,n)),i},Object.defineProperties(Fm,Bm);var Um=function(t,e){for(var n in this.program=t,this.uniformGroup=e?e instanceof sm?e:new sm(e):new sm({}),t.uniformData)this.uniformGroup.uniforms[n]instanceof Array&&(this.uniformGroup.uniforms[n]=new Float32Array(this.uniformGroup.uniforms[n]))},Vm={uniforms:{configurable:!0}};Um.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var n in e.uniforms){var r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},Um.prototype.destroy=function(){this.uniformGroup=null},Vm.uniforms.get=function(){return this.uniformGroup.uniforms},Um.from=function(t,e,n){var r=Fm.from(t,e);return new Um(r,n)},Object.defineProperties(Um.prototype,Vm);var jm=function(){this.data=0,this.blendMode=hf.NORMAL,this.polygonOffset=0,this.blend=!0},qm={blend:{configurable:!0},offsets:{configurable:!0},culling:{configurable:!0},depthTest:{configurable:!0},clockwiseFrontFace:{configurable:!0},blendMode:{configurable:!0},polygonOffset:{configurable:!0}};qm.blend.get=function(){return!!(1&this.data)},qm.blend.set=function(t){!!(1&this.data)!==t&&(this.data^=1)},qm.offsets.get=function(){return!!(2&this.data)},qm.offsets.set=function(t){!!(2&this.data)!==t&&(this.data^=2)},qm.culling.get=function(){return!!(4&this.data)},qm.culling.set=function(t){!!(4&this.data)!==t&&(this.data^=4)},qm.depthTest.get=function(){return!!(8&this.data)},qm.depthTest.set=function(t){!!(8&this.data)!==t&&(this.data^=8)},qm.clockwiseFrontFace.get=function(){return!!(16&this.data)},qm.clockwiseFrontFace.set=function(t){!!(16&this.data)!==t&&(this.data^=16)},qm.blendMode.get=function(){return this._blendMode},qm.blendMode.set=function(t){this.blend=t!==hf.NONE,this._blendMode=t},qm.polygonOffset.get=function(){return this._polygonOffset},qm.polygonOffset.set=function(t){this.offsets=!!t,this._polygonOffset=t},jm.for2d=function(){var t=new jm;return t.depthTest=!1,t.blend=!0,t},Object.defineProperties(jm.prototype,qm);var Gm=function(t){function e(n,r,i){var o=Fm.from(n||e.defaultVertexSrc,r||e.defaultFragmentSrc);t.call(this,o,i),this.padding=0,this.resolution=tf.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0,this.legacy=!!this.program.attributeData.aTextureCoord,this.state=new jm}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={blendMode:{configurable:!0}},r={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};return e.prototype.apply=function(t,e,n,r,i){t.applyFilter(this,e,n,r,i)},n.blendMode.get=function(){return this.state.blendMode},n.blendMode.set=function(t){this.state.blendMode=t},r.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},r.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},Object.defineProperties(e.prototype,n),Object.defineProperties(e,r),e}(Um);Gm.SOURCE_KEY_MAP={};var Hm="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",zm="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",Wm=new Wf,Km=function(t,e){this._texture=t,this.mapCoord=new Wf,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._updateID=-1,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1},Xm={texture:{configurable:!0}};Xm.texture.get=function(){return this._texture},Xm.texture.set=function(t){this._texture=t,this._updateID=-1},Km.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var n=this.mapCoord,r=0;r<t.length;r+=2){var i=t[r],o=t[r+1];e[r]=i*n.a+o*n.c+n.tx,e[r+1]=i*n.b+o*n.d+n.ty}return e},Km.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._updateID===e._updateID)return!1;this._updateID=e._updateID;var n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);var r=e.orig,i=e.trim;i&&(Wm.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Wm));var o=e.baseTexture,s=this.uClampFrame,a=this.clampMargin/o.resolution,u=this.clampOffset;return s[0]=(e._frame.x+a+u)/o.width,s[1]=(e._frame.y+a+u)/o.height,s[2]=(e._frame.x+e._frame.width-a+u)/o.width,s[3]=(e._frame.y+e._frame.height-a+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},Object.defineProperties(Km.prototype,Xm);var Qm=function(t){function e(e){var n=new Wf;t.call(this,Hm,zm),e.renderable=!1,this.maskSprite=e,this.maskMatrix=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.apply=function(t,e,n,r){var i=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.transform||(o.transform=new Km(o,0)),o.transform.update(),this.uniforms.npmAlpha=o.baseTexture.premultiplyAlpha?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(o.transform.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=o.transform.uClampFrame,t.applyFilter(this,e,n,r))},e}(Gm),Ym=function(t){function e(e){t.call(this,e),this.scissor=!1,this.scissorData=null,this.scissorRenderTarget=null,this.enableScissor=!1,this.alphaMaskPool=[],this.alphaMaskIndex=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.push=function(t,e){if(e.isSprite)this.pushSpriteMask(t,e);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencil.stencilMaskStack.length&&e.isFastRect()){var n=e.worldTransform,r=Math.atan2(n.b,n.a);(r=Math.round(r*(180/Math.PI)))%90?this.pushStencilMask(e):this.pushScissorMask(t,e)}else this.pushStencilMask(e)},e.prototype.pop=function(t,e){e.isSprite?this.popSpriteMask(t,e):this.enableScissor&&!this.renderer.stencil.stencilMaskStack.length?this.popScissorMask(t,e):this.popStencilMask(t,e)},e.prototype.pushSpriteMask=function(t,e){var n=this.alphaMaskPool[this.alphaMaskIndex];n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new Qm(e)]),n[0].resolution=this.renderer.resolution,n[0].maskSprite=e;var r=t.filterArea;t.filterArea=e.getBounds(!0),this.renderer.filter.push(t,n),t.filterArea=r,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e.prototype.pushStencilMask=function(t){this.renderer.batch.flush(),this.renderer.stencil.pushStencil(t)},e.prototype.popStencilMask=function(){this.renderer.stencil.popStencil()},e.prototype.pushScissorMask=function(t,e){e.renderable=!0;var n=this.renderer._activeRenderTarget,r=e.getBounds();r.fit(n.size),e.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(r.x*i,(n.root?n.size.height-r.y-r.height:r.y)*i,r.width*i,r.height*i),this.scissorRenderTarget=n,this.scissorData=e,this.scissor=!0},e.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var t=this.renderer.gl;t.disable(t.SCISSOR_TEST)},e}(Fp),Jm=function(t){function e(e){t.call(this,e),this.stencilMaskStack=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setMaskStack=function(t){var e=this.renderer.gl;t.length!==this.stencilMaskStack.length&&(0===t.length?e.disable(e.STENCIL_TEST):e.enable(e.STENCIL_TEST)),this.stencilMaskStack=t},e.prototype.pushStencil=function(t){var e=this.renderer.gl,n=this.stencilMaskStack.length;0===n&&e.enable(e.STENCIL_TEST),this.stencilMaskStack.push(t),e.colorMask(!1,!1,!1,!1),e.stencilFunc(e.EQUAL,n,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent()},e.prototype.popStencil=function(){var t=this.renderer.gl,e=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(0)):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},e.prototype.destroy=function(){t.prototype.destroy.call(this,this),this.stencilMaskStack=null},e}(Fp),$m=function(t){function e(e){t.call(this,e),this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Wf,this.transform=null}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.update=function(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);var i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,n,r){var i=this.projectionMatrix;r?(i.a=1/t.width*2*n,i.d=-1/t.height*2*n,i.tx=-1-e.x*i.a,i.ty=1-e.y*i.d):(i.a=1/t.width*2*n,i.d=1/t.height*2*n,i.tx=-1-e.x*i.a,i.ty=-1-e.y*i.d)},e.prototype.setTransform=function(){},e}(Fp),Zm=new ip,tg=function(t){function e(e){t.call(this,e),this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new ip,this.destinationFrame=new ip}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.bind=function(t,e,n){void 0===t&&(t=null),this.current=t;var r,i=this.renderer;if(t){var o=t.baseTexture;r=o.resolution,n||(Zm.width=o.realWidth,Zm.height=o.realHeight,n=Zm),e||(e=n),this.renderer.framebuffer.bind(o.framebuffer,n),this.renderer.projection.update(n,e,r,!1),this.renderer.stencil.setMaskStack(o.stencilMaskStack)}else r=this.renderer.resolution,n||(Zm.width=i.width,Zm.height=i.height,n=Zm),e||(e=n),i.framebuffer.bind(null,n),this.renderer.projection.update(n,e,r,!0),this.renderer.stencil.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(e),this.destinationFrame.x=n.x/r,this.destinationFrame.y=n.y/r,this.destinationFrame.width=n.width/r,this.destinationFrame.height=n.height/r,e===n&&this.sourceFrame.copyFrom(this.destinationFrame)},e.prototype.clear=function(t){this.renderer.framebuffer.clear((t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor)[0],t[1],t[2],t[3])},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(Fp),eg=function(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}};eg.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null};var ng=0,rg=function(t){function e(e){t.call(this,e),this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this.id=ng++}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof Dm)return Dm;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");Dm=!0===t({a:"b"},"a","b")}catch(e){Dm=!1}return Dm}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||this.syncUniformGroup(t.uniformGroup),r},e.prototype.setUniforms=function(t){var e=this.shader.program;e.syncUniforms(e.glPrograms[this.renderer.CONTEXT_UID].uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t){var e=this.getglProgram();t.static&&t.dirtyId===e.uniformGroups[t.id]||(e.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,e))},e.prototype.syncUniforms=function(t,e){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var n=0,r="var v = null;\n    var cv = null\n    var gl = renderer.gl";for(var i in t.uniforms){var o=e[i];o?"float"===o.type&&1===o.size?r+="\n            if(uv."+i+" !== ud."+i+".value)\n            {\n                ud."+i+".value = uv."+i+"\n                gl.uniform1f(ud."+i+".location, uv."+i+")\n            }\n":"sampler2D"!==o.type&&"samplerCube"!==o.type&&"sampler2DArray"!==o.type||1!==o.size||o.isArray?r+="mat3"===o.type&&1===o.size?void 0!==t.uniforms[i].a?"\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+".toArray(true));\n                \n":"\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+");\n                \n":"vec2"===o.type&&1===o.size?void 0!==t.uniforms[i].x?"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+i+".location, v.x, v.y);\n                }\n":"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+i+".location, v[0], v[1]);\n                }\n                \n":"vec4"===o.type&&1===o.size?void 0!==t.uniforms[i].width?"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+i+".location, v.x, v.y, v.width, v.height)\n                }\n":"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+i+".location, v[0], v[1], v[2], v[3])\n                }\n                \n":"\n            cv = ud."+i+".value;\n            v = uv."+i+";\n            "+(1===o.size?km:Pm)[o.type].replace("location","ud."+i+".location")+";\n":(r+="\n            renderer.texture.bind(uv."+i+", "+n+");\n\n            if(ud."+i+".value !== "+n+")\n            {\n                ud."+i+".value = "+n+";\n                gl.uniform1i(ud."+i+".location, "+n+");\n; // eslint-disable-line max-len\n            }\n",n++):t.uniforms[i].group&&(r+="\n                    renderer.shader.syncUniformGroup(uv."+i+");\n                ")}return new Function("ud","uv","renderer",r)}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var n=t.uniforms,r=[];for(var i in n)r.push(i),e[i]&&r.push(e[i].type);return r.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,n=t.program,r={};for(var i in n.attributeData)r[i]=n.attributeData[i].location;var o=ym(e,n.vertexSrc,n.fragmentSrc,r),s={};for(var a in n.uniformData){var u=n.uniformData[a];s[a]={location:e.getUniformLocation(o,a),value:bm(u.type,u.size)}}var c=new eg(o,s);return n.glPrograms[this.renderer.CONTEXT_UID]=c,c},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(Fp),ig=0,og=1,sg=2,ag=3,ug=4,cg=function(t){function e(e){t.call(this,e),this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=hf.NONE,this._blendEq=!1,this.map=[],this.map[ig]=this.setBlend,this.map[og]=this.setOffset,this.map[sg]=this.setCullFace,this.map[ag]=this.setDepthTest,this.map[ug]=this.setFrontFace,this.checks=[],this.defaultState=new jm,this.defaultState.blend=!0,this.defaultState.depth=!0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(t){this.gl=t,this.blendModes=function(t,e){return void 0===e&&(e=[]),e[hf.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.ADD]=[t.ONE,t.ONE],e[hf.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.NONE]=[0,0],e[hf.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[hf.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[hf.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[hf.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[hf.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[hf.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[hf.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[hf.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[hf.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[hf.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(this.stateId!==(t=t||this.defaultState).data){for(var e=this.stateId^t.data,n=0;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var n=0;n<this.checks.length;n++)this.checks[n](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(0),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(e.polygonOffset,0)},e}(Fp),hg=function(t){function e(e){t.call(this,e),this.count=0,this.checkCount=0,this.maxIdle=tf.GC_MAX_IDLE,this.checkCountMax=tf.GC_MAX_CHECK_COUNT,this.mode=tf.GC_MODE}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postrender=function(){this.count++,1!==this.mode&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,n=!1,r=0;r<e.length;r++){var i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){for(var o=0,s=0;s<e.length;s++)null!==e[s]&&(e[o++]=e[s]);e.length=o}},e.prototype.unload=function(t){t._texture&&t._texture._glRenderTargets&&this.renderer.textureSystem.destroyTexture(t._texture);for(var e=t.children.length-1;e>=0;e--)this.unload(t.children[e])},e}(Fp),lg=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},dg=function(t){function e(e){t.call(this,e),this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new kp}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};var r=new lg(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new lg(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var o=0;o<this.boundTextures.length;o++)this.bind(null,o)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var n=this.gl;if(t){if((t=t.baseTexture||t).valid){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.boundTextures[e]!==t&&n.bindTexture(t.target,r.texture),r.dirtyId!==t.dirtyId&&this.updateTexture(t),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,n=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<n.length;r++)n[r]===this.unknownTexture&&this.bind(null,r)}for(var i=0;i<n.length;i++)n[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[t.target].texture),n[i]=null)},e.prototype.initTexture=function(t){var e=new lg(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(t,e){if(e.internalFormat=t.format,e.type=t.type,2===this.webGLVersion){var n=this.renderer.gl;t.type===n.FLOAT&&t.format===n.RGBA&&(e.internalFormat=n.RGBA32F),t.type===pf.HALF_FLOAT&&(e.type=n.HALF_FLOAT),e.type===n.HALF_FLOAT&&t.format===n.RGBA&&(e.internalFormat=n.RGBA16F)}},e.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var n=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(n,t,e));else{var r=t.realWidth,i=t.realHeight,o=n.gl;(e.width!==r||e.height!==i||e.dirtyId<0)&&(e.width=r,e.height=i,o.texImage2D(t.target,0,e.internalFormat,r,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,e){var n=this.gl;if((t=t.baseTexture||t)._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&xf(this.managedTextures,r,1)}},e.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(1!==t.mipmap&&2===this.webGLVersion||t.isPowerOfTwo?(e.mipmap=t.mipmap>=1,e.wrapMode=t.wrapMode):(e.mipmap=0,e.wrapMode=33071),t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,e){var n=this.gl;if(e.mipmap&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&1===t.scaleMode){var i=Math.min(t.anisotropicLevel,n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode?n.LINEAR:n.NEAREST)},e}(Fp),fg=new Wf,pg=function(t){function e(n){var r;void 0===n&&(n={}),t.call(this,"WebGL",n),n=this.options,this.type=cf.WEBGL,this.gl=null,this.CONTEXT_UID=0,this.runners={destroy:new gp("destroy"),contextChange:new gp("contextChange",1),reset:new gp("reset"),update:new gp("update"),postrender:new gp("postrender"),prerender:new gp("prerender"),resize:new gp("resize",2)},this.globalUniforms=new sm({projectionMatrix:new Wf},!0),this.addSystem(Ym,"mask").addSystem(dm,"context").addSystem(cg,"state").addSystem(rg,"shader").addSystem(dg,"texture").addSystem(gm,"geometry").addSystem(fm,"framebuffer").addSystem(Jm,"stencil").addSystem($m,"projection").addSystem(hg,"textureGC").addSystem(um,"filter").addSystem(tg,"renderTexture").addSystem(hm,"batch"),this.initPlugins(e.__plugins),n.context?this.context.initFromContext(n.context):this.context.initFromOptions({alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,powerPreference:this.options.powerPreference}),this.renderingToScreen=!0,r=2===this.context.webGLVersion?"WebGL 2":"WebGL 1",yf||(navigator.userAgent.toLowerCase().indexOf("chrome")>-1?window.console.log.apply(console,["\n %c %c %c PixiJS "+vf+" - \u2730 "+r+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("PixiJS "+vf+" - "+r+" - http://www.pixijs.com/"),yf=!0),this.resize(this.options.width,this.options.height)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.create=function(t){if(void 0===gf&&(gf=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:tf.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!n||!n.getContextAttributes().stencil);if(n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}return n=null,r}catch(o){return!1}}()),gf)return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,e){e||(e=t.name);var n=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=n,this.runners)this.runners[r].add(n);return this},e.prototype.render=function(t,e,n,r,i){if(this.renderingToScreen=!e,this.runners.prerender.run(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(e||(this._lastObjectRendered=t),!i){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==n?n:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.run(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(e,n){t.prototype.resize.call(this,e,n),this.runners.resize.run(e,n)},e.prototype.reset=function(){return this.runners.reset.run(),this},e.prototype.clear=function(){this.framebuffer.bind(),this.framebuffer.clear()},e.prototype.destroy=function(e){for(var n in this.runners.destroy.run(),this.runners)this.runners[n].destroy();t.prototype.destroy.call(this,e),this.gl=null},e.registerPlugin=function(t,n){(e.__plugins=e.__plugins||{})[t]=n},e}(function(t){function e(e,n){t.call(this),(n=Object.assign({},tf.RENDER_OPTIONS,n)).roundPixels&&(tf.ROUND_PIXELS=n.roundPixels,function(t,e,n){if(void 0===n&&(n=3),!Bf[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v5.0.0"):(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v5.0.0"),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v5.0.0"),console.warn(r))),Bf[e]=!0}}(0,"Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),this.options=n,this.type=cf.UNKNOWN,this.screen=new ip(0,0,n.width,n.height),this.view=n.view||document.createElement("canvas"),this.resolution=n.resolution||tf.RESOLUTION,this.transparent=n.transparent,this.autoDensity=n.autoDensity||n.autoResize||!1,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=n.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new pp,this._lastObjectRendered=this._tempDisplayObjectParent,this.plugins={}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={width:{configurable:!0},height:{configurable:!0},backgroundColor:{configurable:!0}};return e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},n.width.get=function(){return this.view.width},n.height.get=function(){return this.view.height},e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},e.prototype.generateTexture=function(t,e,n,r){0===(r=r||t.getLocalBounds()).width&&(r.width=1),0===r.height&&(r.height=1);var i=Wp.create(0|r.width,0|r.height,e,n);return fg.tx=-r.x,fg.ty=-r.y,this.render(t,i,!1,fg,!!t.parent),i},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=cf.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoDensity=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},n.backgroundColor.get=function(){return this._backgroundColor},n.backgroundColor.set=function(t){this._backgroundColor=t,this._backgroundColorString=wf(t),bf(t,this._backgroundColorRgba)},Object.defineProperties(e.prototype,n),e}(nf.a)),mg="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",gg=function(){this.textures=[],this.ids=[],this.blend=0,this.textureCount=0,this.start=0,this.size=0,this.type=4},yg=function(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)},vg={int8View:{configurable:!0},uint8View:{configurable:!0},int16View:{configurable:!0},uint16View:{configurable:!0},int32View:{configurable:!0}};vg.int8View.get=function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},vg.uint8View.get=function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},vg.int16View.get=function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},vg.uint16View.get=function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},vg.int32View.get=function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},yg.prototype.view=function(t){return this[t+"View"]},yg.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},yg.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},Object.defineProperties(yg.prototype,vg);var bg=function(t){function e(e){t.call(this,e),this.shaderGenerator=null,this.geometryClass=null,this.vertexSize=null,this.state=jm.for2d(),this.size=8e3,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._drawCalls=[];for(var n=0;n<this.size/4;n++)this._drawCalls[n]=new gg;this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(){var t=this.renderer.gl;tf.PREFER_ENV===uf.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),tf.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var n=e.createShader(e.FRAGMENT_SHADER);;){var r=Nm.replace(/%forloop%/gi,Mm(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedElements[this._bufferSize++]=t)},e.prototype.flush=function(){if(0!==this._vertexCount){var t,e,n=this.getAttributeBuffer(this._vertexCount),r=this.getIndexBuffer(this._indexCount),i=this.renderer.gl,o=this._bufferedElements,s=this._drawCalls,a=this.MAX_TEXTURES,u=this._packedGeometries,c=this.vertexSize,h=this.renderer.textureGC.count,l=0,d=0,f=0,p=s[0],m=0,g=-1;p.textureCount=0,p.start=0,p.blend=g;var y,v=++kp._globalBatch;for(y=0;y<this._bufferSize;++y){var b=o[y];o[y]=null;var w=_f[(t=b._texture.baseTexture).premultiplyAlpha?1:0][b.blendMode];g!==w&&(g=w,e=null,f=a,v++),e!==t&&(e=t,t._batchEnabled!==v&&(f===a&&(v++,f=0,p.size=d-p.start,(p=s[m++]).textureCount=0,p.blend=g,p.start=d),t.touched=h,t._batchEnabled=v,t._id=f,p.textures[p.textureCount++]=t,f++)),this.packInterleavedGeometry(b,n,r,l,d),l+=b.vertexData.length/2*c,d+=b.indices.length}kp._globalBatch=v,p.size=d-p.start,tf.CAN_UPLOAD_SAME_BUFFER?(u[this._flushId]._buffer.update(n.rawBinaryData,0),u[this._flushId]._indexBuffer.update(r,0),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,u[this._flushId]=new this.geometryClass),u[this._flushId]._buffer.update(n.rawBinaryData,0),u[this._flushId]._indexBuffer.update(r,0),this.renderer.geometry.bind(u[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++);var _=this.renderer.texture,E=this.renderer.state;for(y=0;y<m;y++){for(var T=s[y],x=T.textureCount,S=0;S<x;S++)_.bind(T.textures[S],S),T.textures[S]=null;E.setBlendMode(T.blend),i.drawElements(T.type,T.size,i.UNSIGNED_SHORT,2*T.start)}this._bufferSize=0,this._vertexCount=0,this._indexCount=0}},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),tf.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._drawCalls=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=If(Math.ceil(t/8)),n=Df(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new yg(r*this.vertexSize*4)),i},e.prototype.getIndexBuffer=function(t){var e=If(Math.ceil(t/12)),n=Df(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i},e.prototype.packInterleavedGeometry=function(t,e,n,r,i){for(var o=e.uint32View,s=e.float32View,a=r/this.vertexSize,u=t.uvs,c=t.indices,h=t.vertexData,l=t._texture.baseTexture._id,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.premultiplyAlpha?Tf(t._tintRGB,d):t._tintRGB+(255*d<<24),p=0;p<h.length;p+=2)s[r++]=h[p],s[r++]=h[p+1],s[r++]=u[p],s[r++]=u[p+1],o[r++]=f,s[r++]=l;for(var m=0;m<c.length;m++)n[i++]=a+c[m]},e}(cm),wg=function(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')};wg.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=n;this.defaultGroupCache[t]=sm.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Fm(this.vertexSrc,r)}var i={tint:new Float32Array([1,1,1,1]),translationMatrix:new Wf,default:this.defaultGroupCache[t]};return new Um(this.programCache[t],i)},wg.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+="if(vTextureId < "+n+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+n+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"};var _g=function(t){function e(e){void 0===e&&(e=!1),t.call(this),this._buffer=new Yp(null,e,!1),this._indexBuffer=new Yp(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,pf.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,pf.FLOAT).addAttribute("aColor",this._buffer,4,!0,pf.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,pf.FLOAT).addIndex(this._indexBuffer)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(nm),Eg="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",Tg="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",xg=function(){},Sg={defaultVertexSrc:{configurable:!0},defaultFragmentTemplate:{configurable:!0}};xg.create=function(t){var e=Object.assign({vertex:Eg,fragment:Tg,geometryClass:_g,vertexSize:6},t),n=e.vertex,r=e.fragment,i=e.vertexSize,o=e.geometryClass;return function(t){function e(e){t.call(this,e),this.shaderGenerator=new wg(n,r),this.geometryClass=o,this.vertexSize=i}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(bg)},Sg.defaultVertexSrc.get=function(){return Eg},Sg.defaultFragmentTemplate.get=function(){return Tg},Object.defineProperties(xg,Sg);var Cg=xg.create(),Ag=new ip,Ig=function(t){this.renderer=t,t.extract=this};Ig.prototype.image=function(t,e,n){var r=new Image;return r.src=this.base64(t,e,n),r},Ig.prototype.base64=function(t,e,n){return this.canvas(t).toDataURL(e,n)},Ig.prototype.canvas=function(t){var e,n,r,i=this.renderer,o=!1,s=!1;t&&(t instanceof Wp?r=t:(r=this.renderer.generateTexture(t),s=!0)),r?(e=r.baseTexture.resolution,n=r.frame,o=!1,i.renderTexture.bind(r)):(e=this.renderer.resolution,o=!0,(n=Ag).width=this.renderer.width,n.height=this.renderer.height,i.renderTexture.bind(null));var a=Math.floor(n.width*e),u=Math.floor(n.height*e),c=new Rf(a,u,1),h=new Uint8Array(4*a*u),l=i.gl;l.readPixels(n.x*e,n.y*e,a,u,l.RGBA,l.UNSIGNED_BYTE,h);var d=c.context.getImageData(0,0,a,u);return Ig.arrayPostDivide(h,d.data),c.context.putImageData(d,0,0),o&&(c.context.scale(1,-1),c.context.drawImage(c.canvas,0,-u)),s&&r.destroy(!0),c.canvas},Ig.prototype.pixels=function(t){var e,n,r,i=this.renderer,o=!1;t&&(t instanceof Wp?r=t:(r=this.renderer.generateTexture(t),o=!0)),r?(e=r.baseTexture.resolution,n=r.frame,i.renderTexture.bind(r)):(e=i.resolution,(n=Ag).width=i.width,n.height=i.height,i.renderTexture.bind(null));var s=n.width*e,a=n.height*e,u=new Uint8Array(4*s*a),c=i.gl;return c.readPixels(n.x*e,n.y*e,s,a,c.RGBA,c.UNSIGNED_BYTE,u),o&&r.destroy(!0),Ig.arrayPostDivide(u,u),u},Ig.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},Ig.arrayPostDivide=function(t,e){for(var n=0;n<t.length;n+=4){var r=e[n+3]=t[n+3];0!==r?(e[n]=Math.round(Math.min(255*t[n]/r,255)),e[n+1]=Math.round(Math.min(255*t[n+1]/r,255)),e[n+2]=Math.round(Math.min(255*t[n+2]/r,255))):(e[n]=t[n],e[n+1]=t[n+1],e[n+2]=t[n+2])}};var Og=function(){this.global=new Uf,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0},Dg={pointerId:{configurable:!0}};Dg.pointerId.get=function(){return this.identifier},Og.prototype.getLocalPosition=function(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)},Og.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},Og.prototype.reset=function(){this.isPrimary=!1},Object.defineProperties(Og.prototype,Dg);var kg=function(){this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null};kg.prototype.stopPropagation=function(){this.stopped=!0},kg.prototype.reset=function(){this.stopped=!1,this.currentTarget=null,this.target=null};var Pg=function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE},Ng={pointerId:{configurable:!0},flags:{configurable:!0},none:{configurable:!0},over:{configurable:!0},rightDown:{configurable:!0},leftDown:{configurable:!0}};Pg.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},Ng.pointerId.get=function(){return this._pointerId},Ng.flags.get=function(){return this._flags},Ng.flags.set=function(t){this._flags=t},Ng.none.get=function(){return this._flags===this.constructor.FLAGS.NONE},Ng.over.get=function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},Ng.over.set=function(t){this._doSet(this.constructor.FLAGS.OVER,t)},Ng.rightDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},Ng.rightDown.set=function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)},Ng.leftDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},Ng.leftDown.set=function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)},Object.defineProperties(Pg.prototype,Ng),Pg.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),dp.mixin({interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0});var Mg=1,Rg={target:null,data:{global:null}},Lg=function(t){function e(e,n){t.call(this),n=n||{},this.renderer=e,this.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,this.interactionFrequency=n.interactionFrequency||10,this.mouse=new Og,this.mouse.identifier=Mg,this.mouse.global.set(-999999),this.activeInteractionData={},this.activeInteractionData[Mg]=this.mouse,this.interactionDataPool=[],this.eventData=new kg,this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.mouseOverRenderer=!1,this.supportsTouchEvents="ontouchstart"in window,this.supportsPointerEvents=!!window.PointerEvent,this.onPointerUp=this.onPointerUp.bind(this),this.processPointerUp=this.processPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.processPointerCancel=this.processPointerCancel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.processPointerDown=this.processPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.processPointerMove=this.processPointerMove.bind(this),this.onPointerOut=this.onPointerOut.bind(this),this.processPointerOverOut=this.processPointerOverOut.bind(this),this.onPointerOver=this.onPointerOver.bind(this),this.cursorStyles={default:"inherit",pointer:"pointer"},this.currentCursorMode=null,this.cursor=null,this._tempPoint=new Uf,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hitTest=function(t,e){return Rg.target=null,Rg.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(Rg,e,null,!0),Rg.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents()},e.prototype.addEvents=function(){this.interactionDOMElement&&(bp.system.add(this.update,this,50),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},e.prototype.removeEvents=function(){this.interactionDOMElement&&(bp.system.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},e.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var n=this.activeInteractionData[e];if(n.originalEvent&&"touch"!==n.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,n.originalEvent,n);this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(this.currentCursorMode!==(t=t||"default")){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,n){n.stopped||(n.currentTarget=t,n.type=e,t.emit(e,n),t[e]&&t[e](n))},e.prototype.mapPositionToPoint=function(t,e,n){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=1/this.resolution;t.x=this.interactionDOMElement.width/r.width*(e-r.left)*i,t.y=this.interactionDOMElement.height/r.height*(n-r.top)*i},e.prototype.processInteractive=function(t,e,n,r,i){if(!e||!e.visible)return!1;var o=t.data.global,s=!1,a=i=e.interactive||i,u=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:(r=!1,u=!1)),a=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(r=!1)),u&&e.interactiveChildren&&e.children)for(var c=e.children,h=c.length-1;h>=0;h--){var l=c[h],d=this.processInteractive(t,l,n,r,a);if(d){if(!l.parent)continue;a=!1,d&&(t.target&&(r=!1),s=!0)}}return i&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(s=!0),e.interactive&&(s&&!t.target&&(t.target=e),n&&n(t,e,!!s))),s},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===i.pointerType?this.emit("touchstart",s):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit(2===i.button?"rightdown":"mousedown",this.eventData)}}},e.prototype.processPointerDown=function(t,e,n){var r=t.data,i=t.data.identifier;if(n)if(e.trackedPointers[i]||(e.trackedPointers[i]=new Pg(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var o=2===r.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,n){for(var r=this.normalizeToPointerData(t),i=r.length,o=t.target!==this.interactionDOMElement?"outside":"",s=0;s<i;s++){var a=r[s],u=this.getInteractionDataForPointerId(a),c=this.configureInteractionEventForDOMEvent(this.eventData,a,u);c.data.originalEvent=t,this.processInteractive(c,this.renderer._lastObjectRendered,n,e||!o),this.emit(e?"pointercancel":"pointerup"+o,c),"mouse"===a.pointerType||"pen"===a.pointerType?this.emit(2===a.button?"rightup"+o:"mouseup"+o,c):"touch"===a.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(a.pointerId,u))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var n=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===n.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,n){var r=t.data,i=t.data.identifier,o=e.trackedPointers[i],s="touch"===r.pointerType,a="mouse"===r.pointerType||"pen"===r.pointerType,u=!1;if(a){var c=2===r.button,h=Pg.FLAGS,l=void 0!==o&&o.flags&(c?h.RIGHT_DOWN:h.LEFT_DOWN);n?(this.dispatchEvent(e,c?"rightup":"mouseup",t),l&&(this.dispatchEvent(e,c?"rightclick":"click",t),u=!0)):l&&this.dispatchEvent(e,c?"rightupoutside":"mouseupoutside",t),o&&(c?o.rightDown=!1:o.leftDown=!1)}n?(this.dispatchEvent(e,"pointerup",t),s&&this.dispatchEvent(e,"touchend",t),o&&(a&&!u||this.dispatchEvent(e,"pointertap",t),s&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),s&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);s.data.originalEvent=t,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",s),"touch"===i.pointerType&&this.emit("touchmove",s),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",s)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,n){var r=t.data,i="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType;o&&this.processPointerOverOut(t,e,n),this.moveWhenInside&&!n||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(n.identifier)}},e.prototype.processPointerOverOut=function(t,e,n){var r=t.data,i=t.data.identifier,o="mouse"===r.pointerType||"pen"===r.pointerType,s=e.trackedPointers[i];n&&!s&&(s=e.trackedPointers[i]=new Pg(i)),void 0!==s&&(n&&this.mouseOverRenderer?(s.over||(s.over=!0,this.dispatchEvent(e,"pointerover",t),o&&this.dispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):s.over&&(s.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),s.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e,n=t.pointerId;return n===Mg||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[n]?e=this.activeInteractionData[n]:((e=this.interactionDataPool.pop()||new Og).identifier=n,this.activeInteractionData[n]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,n){return t.data=n,this.mapPositionToPoint(n.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=n.global.x,e.globalY=n.global.y),n.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,r=t.changedTouches.length;n<r;n++){var i=t.changedTouches[n];void 0===i.button&&(i.button=t.touches.length?1:0),void 0===i.buttons&&(i.buttons=t.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=Mg),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0,e.push(t));return e},e.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},e}(nf.a),Fg={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive)return e;var n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}},Bg=function(){this.reset()};Bg.prototype.clone=function(){var t=new Bg;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},Bg.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Hp.WHITE,this.matrix=null,this.visible=!1},Bg.prototype.destroy=function(){this.texture=null,this.matrix=null};var Ug=function(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null),this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type,this.points=[],this.holes=[]};Ug.prototype.clone=function(){return new Ug(this.shape,this.fillStyle,this.lineStyle,this.matrix)},Ug.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null};var Vg={build:function(t){var e,n,r=t.shape,i=t.points,o=r.x,s=r.y;if(i.length=0,t.type===zf.CIRC?(e=r.radius,n=r.radius):(e=r.width,n=r.height),0!==e&&0!==n){var a=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(r.width+r.height));a/=2.3;for(var u=2*Math.PI/a,c=0;c<a;c++)i.push(o+Math.sin(-u*c)*e,s+Math.cos(-u*c)*n);i.push(i[0],i[1])}},triangulate:function(t,e){var n=t.points,r=e.points,i=e.indices,o=r.length/2,s=o;r.push(t.shape.x,t.shape.y);for(var a=0;a<n.length;a+=2)r.push(n[a],n[a+1]),i.push(o++,s,o)}};function jg(t,e){t.lineStyle.native?function(t,e){var n=0,r=t.shape,i=t.points||r.points,o=r.type!==zf.POLY||r.closeStroke;if(0!==i.length){var s=e.points,a=e.indices,u=i.length/2,c=s.length/2,h=c;for(s.push(i[0],i[1]),n=1;n<u;n++)s.push(i[2*n],i[2*n+1]),a.push(h,h+1),h++;o&&a.push(h,c)}}(t,e):function(t,e){var n=t.shape,r=t.points||n.points.slice();if(0!==r.length){var i=t.lineStyle,o=new Uf(r[0],r[1]),s=new Uf(r[r.length-2],r[r.length-1]),a=o.x===s.x&&o.y===s.y;if(n.type!==zf.POLY||n.closeStroke){r=r.slice(),a&&(r.pop(),r.pop(),s.set(r[r.length-2],r[r.length-1]));var u=s.x+.5*(o.x-s.x),c=s.y+.5*(o.y-s.y);r.unshift(u,c),r.push(u,c)}var h=e.points,l=r.length/2,d=r.length,f=h.length/2,p=i.width/2,m=r[0],g=r[1],y=r[2],v=r[3],b=0,w=0,_=-(g-v),E=m-y,T=0,x=0,S=0,C=0,A=Math.sqrt(_*_+E*E);_/=A,E/=A;var I=i.alignment,O=2*(1-I),D=2*I;h.push(m-(_*=p)*O,g-(E*=p)*O),h.push(m+_*D,g+E*D);for(var k=1;k<l-1;++k){b=r[2*(k+1)],w=r[2*(k+1)+1],_=-((g=r[2*(k-1)+1])-(v=r[2*k+1])),E=(m=r[2*(k-1)])-(y=r[2*k]),_/=A=Math.sqrt(_*_+E*E),E/=A,_*=p,E*=p,T=-(v-w),x=y-b,T/=A=Math.sqrt(T*T+x*x),x/=A;var P=-E+g-(-E+v),N=-_+y-(-_+m),M=(-_+m)*(-E+v)-(-_+y)*(-E+g),R=-(x*=p)+w-(-x+v),L=-(T*=p)+y-(-T+b),F=(-T+b)*(-x+v)-(-T+y)*(-x+w),B=P*L-R*N;if(Math.abs(B)<.1)B+=10.1,h.push(y-_*O,v-E*O),h.push(y+_*D,v+E*D);else{var U=(N*F-L*M)/B,V=(R*M-P*F)/B;(U-y)*(U-y)+(V-v)*(V-v)>196*p*p?(S=_-T,C=E-x,S/=A=Math.sqrt(S*S+C*C),C/=A,h.push(y-(S*=p)*O,v-(C*=p)*O),h.push(y+S*D,v+C*D),h.push(y-S*D*O,v-C*O),d++):(h.push(y+(U-y)*O,v+(V-v)*O),h.push(y-(U-y)*D,v-(V-v)*D))}}_=-((g=r[2*(l-2)+1])-(v=r[2*(l-1)+1])),E=(m=r[2*(l-2)])-(y=r[2*(l-1)]),_/=A=Math.sqrt(_*_+E*E),E/=A,h.push(y-(_*=p)*O,v-(E*=p)*O),h.push(y+_*D,v+E*D);for(var j=e.indices,q=0;q<d-2;++q)j.push(f,f+1,f+2),f++}}(t,e)}var qg={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var n=t.points,r=t.holes,i=e.points,o=e.indices;if(n.length>=6){for(var s=[],a=0;a<r.length;a++){var u=r[a];s.push(n.length/2),n=n.concat(u.points)}var c=of()(n,s,2);if(!c)return;for(var h=i.length/2,l=0;l<c.length;l+=3)o.push(c[l]+h),o.push(c[l+1]+h),o.push(c[l+2]+h);for(var d=0;d<n.length;d++)i.push(n[d])}}},Gg={build:function(t){var e=t.shape,n=t.points,r=e.x,i=e.y,o=e.width,s=e.height,a=e.radius;n.length=0,zg(r,i+a,r,i,r+a,i,n),zg(r+o-a,i,r+o,i,r+o,i+a,n),zg(r+o,i+s-a,r+o,i+s,r+o-a,i+s,n),zg(r+a,i+s,r,i+s,r,i+s-a,n)},triangulate:function(t,e){for(var n=t.points,r=e.points,i=e.indices,o=r.length/2,s=of()(n,null,2),a=0,u=s.length;a<u;a+=3)i.push(s[a]+o),i.push(s[a+1]+o),i.push(s[a+2]+o);for(var c=0,h=n.length;c<h;c++)r.push(n[c],n[++c])}};function Hg(t,e,n){return t+(e-t)*n}function zg(t,e,n,r,i,o,s){void 0===s&&(s=[]);for(var a=s,u=0,c=0,h=0,l=0,d=0,f=0,p=0,m=0;p<=20;++p)u=Hg(t,n,m=p/20),c=Hg(e,r,m),h=Hg(n,i,m),l=Hg(r,o,m),d=Hg(u,h,m),f=Hg(c,l,m),a.push(d,f);return a}var Wg=[],Kg=[],Xg={};Xg[zf.POLY]=qg,Xg[zf.CIRC]=Vg,Xg[zf.ELIP]=Vg,Xg[zf.RECT]={build:function(t){var e=t.shape,n=e.x,r=e.y,i=e.width,o=e.height,s=t.points;s.length=0,s.push(n,r,n+i,r,n+i,r+o,n,r+o)},triangulate:function(t,e){var n=t.points,r=e.points,i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},Xg[zf.RREC]=Gg;var Qg=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},Yg=function(t){function e(){t.call(this),this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeIndex=0,this._bounds=new lp,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.uvsFloat32=null}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={bounds:{configurable:!0}};return n.bounds.get=function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},e.prototype.clear=function(){if(this.graphicsData.length>0){this.boundsDirty=-1,this.dirty++,this.clearDirty++,this.batchDirty++,this.graphicsData.length=0,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].textures.length=0,Kg.push(this.drawCalls[t]);this.drawCalls.length=0;for(var e=0;e<this.batches.length;e++){var n=this.batches[e];n.start=0,n.attribStart=0,n.style=null,Wg.push(n)}this.batches.length=0}return this},e.prototype.drawShape=function(t,e,n,r){var i=new Ug(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this},e.prototype.drawHole=function(t,e){if(!this.graphicsData.length)return null;var n=new Ug(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,n},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var n=0;n<this.graphicsData.length;++n)this.graphicsData[n].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,n=0;n<e.length;++n){var r=e[n];if(r.fillStyle.visible&&r.shape&&r.shape.contains(t.x,t.y)){if(r.holes)for(var i=0;i<r.holes.length;i++)if(r.holes[i].shape.contains(t.x,t.y))return!1;return!0}}return!1},e.prototype.updateBatches=function(){if(this.dirty!==this.cacheDirty)if(0!==this.graphicsData.length){if(this.dirty!==this.cacheDirty)for(var t=0;t<this.graphicsData.length;t++){var e=this.graphicsData[t];if(e.fillStyle&&!e.fillStyle.texture.baseTexture.valid)return;if(e.lineStyle&&!e.lineStyle.texture.baseTexture.valid)return}this.cacheDirty=this.dirty;var n=this.uvs,r=null,i=null,o=0,s=!1;if(this.batches.length>0){var a=(r=this.batches[this.batches.length-1]).style;i=a.texture.baseTexture,o=a.color+a.alpha,s=a.native}for(var u=this.shapeIndex;u<this.graphicsData.length;u++){this.shapeIndex++;var c=this.graphicsData[u],h=Xg[c.type],l=c.fillStyle,d=c.lineStyle;h.build(c),c.matrix&&this.transformPoints(c.points,c.matrix);for(var f=0;f<2;f++){var p=0===f?l:d;if(p.visible){var m=p.texture.baseTexture,g=this.indices.length,y=this.points.length/2;!r||i===m&&o===p.color+p.alpha&&s===p.native||(r.size=g-r.start,r.attribSize=y-r.attribStart,r.size>0&&(r=null)),r||(r=Wg.pop()||new Qg,this.batches.push(r),m.wrapMode=10497,i=m,o=p.color+p.alpha,s=p.native,r.style=p,r.start=g,r.attribStart=y);var v=this.points.length/2;if(0===f)c.holes.length?(this.processHoles(c.holes),qg.triangulate(c,this)):h.triangulate(c,this);else{jg(c,this);for(var b=0;b<c.holes.length;b++)jg(c.holes[b],this)}this.addUvs(this.points,n,p.texture,v,this.points.length/2-v,p.matrix)}}}var w=this.points.length/2;if(r)if(r.size=this.indices.length-r.start,r.attribSize=w-r.attribStart,this.indicesUint16=new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var _=0;_<this.batches.length;_++)for(var E=this.batches[_],T=0;T<E.size;T++){var x=E.start+T;this.indicesUint16[x]=this.indicesUint16[x]-E.attribStart}}else this.buildDrawCalls();else this.batchable=!0}else this.batchable=!0},e.prototype.isBatchable=function(){for(var t=this.batches,n=0;n<t.length;n++)if(t[n].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++kp._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].textures.length=0,Kg.push(this.drawCalls[e]);this.drawCalls.length=0;var n=this.uvs,r=this.colors,i=this.textureIds,o=Kg.pop()||new gg;o.textureCount=0,o.start=0,o.size=0,o.type=lf.TRIANGLES;var s=0,a=null,u=0,c=!1,h=lf.TRIANGLES,l=0;this.drawCalls.push(o);for(var d=0;d<this.batches.length;d++){var f=this.batches[d],p=f.style,m=p.texture.baseTexture;c!==p.native&&(h=(c=p.native)?lf.LINES:lf.TRIANGLES,a=null,s=8,t++),a!==m&&(a=m,m._batchEnabled!==t&&(8===s&&(t++,s=0,o.size>0&&(o=Kg.pop()||new gg,this.drawCalls.push(o)),o.start=l,o.size=0,o.textureCount=0,o.type=h),m.touched=1,m._batchEnabled=t,m._id=s,m.wrapMode=10497,o.textures[o.textureCount++]=m,s++)),o.size+=f.size,l+=f.size,u=m._id,this.addColors(r,p.color,p.alpha,f.attribSize),this.addTextureIds(i,u,f.attribSize)}kp._globalBatch=t;for(var g=this.points,y=new ArrayBuffer(3*g.length*4),v=new Float32Array(y),b=new Uint32Array(y),w=0,_=0;_<g.length/2;_++)v[w++]=g[2*_],v[w++]=g[2*_+1],v[w++]=n[2*_],v[w++]=n[2*_+1],b[w++]=r[_],v[w++]=i[_];this._buffer.update(y),this._indexBuffer.update(this.indicesUint16)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var n=t[e];Xg[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var t=1/0,e=-1/0,n=1/0,r=-1/0;if(this.graphicsData.length)for(var i=null,o=0,s=0,a=0,u=0,c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],l=h.type,d=h.lineStyle?h.lineStyle.width:0;if(i=h.shape,l===zf.RECT||l===zf.RREC)t=(o=i.x-d/2)<t?o:t,e=o+(a=i.width+d)>e?o+a:e,n=(s=i.y-d/2)<n?s:n,r=s+(u=i.height+d)>r?s+u:r;else if(l===zf.CIRC)t=(o=i.x)-(a=i.radius+d/2)<t?o-a:t,e=o+a>e?o+a:e,n=(s=i.y)-(u=i.radius+d/2)<n?s-u:n,r=s+u>r?s+u:r;else if(l===zf.ELIP)t=(o=i.x)-(a=i.width+d/2)<t?o-a:t,e=o+a>e?o+a:e,n=(s=i.y)-(u=i.height+d/2)<n?s-u:n,r=s+u>r?s+u:r;else for(var f=i.points,p=0,m=0,g=0,y=0,v=0,b=0,w=0,_=0,E=0;E+2<f.length;E+=2)o=f[E],s=f[E+1],p=f[E+2],m=f[E+3],g=Math.abs(p-o),y=Math.abs(m-s),u=d,(a=Math.sqrt(g*g+y*y))<1e-9||(t=(w=(p+o)/2)-(v=(u/a*y+g)/2)<t?w-v:t,e=w+v>e?w+v:e,n=(_=(m+s)/2)-(b=(u/a*g+y)/2)<n?_-b:n,r=_+b>r?_+b:r)}else t=0,e=0,n=0,r=0;var T=this.boundsPadding;this._bounds.minX=t-T,this._bounds.maxX=e+T,this._bounds.minY=n-T,this._bounds.maxY=r+T},e.prototype.transformPoints=function(t,e){for(var n=0;n<t.length/2;n++){var r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}},e.prototype.addColors=function(t,e,n,r){for(var i=Tf((e>>16)+(65280&e)+((255&e)<<16),n);r-- >0;)t.push(i)},e.prototype.addTextureIds=function(t,e,n){for(;n-- >0;)t.push(e)},e.prototype.addUvs=function(t,e,n,r,i,o){for(var s=0,a=e.length,u=n.frame;s<i;){var c=t[2*(r+s)],h=t[2*(r+s)+1];if(o){var l=o.a*c+o.c*h+o.tx;h=o.b*c+o.d*h+o.ty,c=l}s++,e.push(c/u.width,h/u.height)}var d=n.baseTexture;(u.width<d.width||u.height<d.height)&&this.adjustUvs(e,n,a,i)},e.prototype.adjustUvs=function(t,e,n,r){for(var i=e.baseTexture,o=n+2*r,s=e.frame,a=s.width/i.width,u=s.height/i.height,c=s.x/s.width,h=s.y/s.height,l=Math.floor(t[n]+1e-6),d=Math.floor(t[n+1]+1e-6),f=n+2;f<o;f+=2)l=Math.min(l,Math.floor(t[f]+1e-6)),d=Math.min(d,Math.floor(t[f+1]+1e-6));c-=l,h-=d;for(var p=n;p<o;p+=2)t[p]=(t[p]+c)*a,t[p+1]=(t[p+1]+h)*u},Object.defineProperties(e.prototype,n),e}(_g);Yg.BATCHABLE_SIZE=100;var Jg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.width=0,this.alignment=.5,this.native=!1},e}(Bg),$g=function(){};$g.curveLength=function(t,e,n,r,i,o,s,a){for(var u=0,c=0,h=0,l=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,b=t,w=e,_=1;_<=10;++_)y=b-(m=(p=(f=(d=1-(c=_/10))*d)*d)*t+3*f*c*n+3*d*(h=c*c)*i+(l=h*c)*s),v=w-(g=p*e+3*f*c*r+3*d*h*o+l*a),b=m,w=g,u+=Math.sqrt(y*y+v*v);return u},$g.curveTo=function(t,e,n,r,i,o,s){var a=s[s.length-2],u=s[s.length-1];s.length-=2;var c=Fg._segmentsCount($g.curveLength(a,u,t,e,n,r,i,o)),h=0,l=0,d=0,f=0,p=0;s.push(a,u);for(var m=1,g=0;m<=c;++m)s.push((d=(l=(h=1-(g=m/c))*h)*h)*a+3*l*g*t+3*h*(f=g*g)*n+(p=f*g)*i,d*u+3*l*g*e+3*h*f*r+p*o)};var Zg=function(){};Zg.curveLength=function(t,e,n,r,i,o){var s=t-2*n+i,a=e-2*r+o,u=2*n-2*t,c=2*r-2*e,h=4*(s*s+a*a),l=4*(s*u+a*c),d=u*u+c*c,f=2*Math.sqrt(h+l+d),p=Math.sqrt(h),m=2*h*p,g=2*Math.sqrt(d),y=l/p;return(m*f+p*l*(f-g)+(4*d*h-l*l)*Math.log((2*p+y+f)/(y+g)))/(4*m)},Zg.curveTo=function(t,e,n,r,i){for(var o=i[i.length-2],s=i[i.length-1],a=Fg._segmentsCount(Zg.curveLength(o,s,t,e,n,r)),u=0,c=0,h=1;h<=a;++h){var l=h/a;i.push((u=o+(t-o)*l)+(t+(n-t)*l-u)*l,(c=s+(e-s)*l)+(e+(r-e)*l-c)*l)}};var ty=function(){};ty.curveTo=function(t,e,n,r,i,o){var s=o[o.length-1]-e,a=o[o.length-2]-t,u=r-e,c=n-t,h=Math.abs(s*c-a*u);if(h<1e-8||0===i)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var l=s*s+a*a,d=u*u+c*c,f=s*u+a*c,p=i*Math.sqrt(l)/h,m=i*Math.sqrt(d)/h,g=p*f/l,y=m*f/d,v=p*c+m*a,b=p*u+m*s,w=c*(p+y),_=u*(p+y);return{cx:v+t,cy:b+e,radius:i,startAngle:Math.atan2(s*(m+g)-b,a*(m+g)-v),endAngle:Math.atan2(_-b,w-v),anticlockwise:a*u>c*s}},ty.arc=function(t,e,n,r,i,o,s,a,u){for(var c=s-o,h=Fg._segmentsCount(Math.abs(c)*i,40*Math.ceil(Math.abs(c)/qf)),l=c/(2*h),d=2*l,f=Math.cos(l),p=Math.sin(l),m=h-1,g=m%1/m,y=0;y<=m;++y){var v=l+o+d*(y+g*y),b=Math.cos(v),w=-Math.sin(v);u.push((f*b+p*w)*i+n,(f*-w+p*b)*i+r)}};var ey=function(t){function e(e,n,r,i,o,s){o=o||i/2;for(var a=-1*Math.PI/2+s,u=2*r,c=qf/u,h=[],l=0;l<u;l++){var d=l%2?o:i,f=l*c+a;h.push(e+d*Math.cos(f),n+d*Math.sin(f))}t.call(this,h)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(cp),ny=new Float32Array(3),ry=null,iy=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.geometry=e||new Yg,this.geometry.refCount++,this.shader=null,this.state=jm.for2d(),this._fillStyle=new Bg,this._lineStyle=new Jg,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.vertexData=null,this._transformID=-1,this.batchDirty=-1,this.pluginName="batch",this.tint=16777215,this.blendMode=hf.NORMAL}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={blendMode:{configurable:!0},tint:{configurable:!0},fill:{configurable:!0},line:{configurable:!0}};return e.prototype.clone=function(){return this.finishPoly(),new e(this.geometry)},n.blendMode.set=function(t){this.state.blendMode=t},n.blendMode.get=function(){return this.state.blendMode},n.tint.get=function(){return this._tint},n.tint.set=function(t){this._tint=t},n.fill.get=function(){return this._fillStyle},n.line.get=function(){return this._lineStyle},e.prototype.lineStyle=function(t,e,n,r,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=.5),void 0===i&&(i=!1),this.lineTextureStyle(t,Hp.WHITE,e,n,null,r,i),this},e.prototype.lineTextureStyle=function(t,e,n,r,i,o,s){void 0===t&&(t=0),void 0===e&&(e=Hp.WHITE),void 0===n&&(n=16777215),void 0===r&&(r=1),void 0===i&&(i=null),void 0===o&&(o=.5),void 0===s&&(s=!1),this.currentPath&&this.startPoly();var a=t>0&&r>0;return a?(i&&(i=i.clone()).invert(),Object.assign(this._lineStyle,{color:n,width:t,alpha:r,matrix:i,texture:e,alignment:o,native:s,visible:a})):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new cp,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new cp,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points;return n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,n,r){this._initCurve();var i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),Zg.curveTo(t,e,n,r,i),this},e.prototype.bezierCurveTo=function(t,e,n,r,i,o){return this._initCurve(),$g.curveTo(t,e,n,r,i,o,this.currentPath.points),this},e.prototype.arcTo=function(t,e,n,r,i){this._initCurve(t,e);var o=ty.curveTo(t,e,n,r,i,this.currentPath.points);return o&&this.arc(o.cx,o.cy,o.radius,o.startAngle,o.endAngle,o.anticlockwise),this},e.prototype.arc=function(t,e,n,r,i,o){if(void 0===o&&(o=!1),r===i)return this;if(!o&&i<=r?i+=qf:o&&r<=i&&(r+=qf),0==i-r)return this;var s=t+Math.cos(r)*n,a=e+Math.sin(r)*n,u=this.currentPath?this.currentPath.points:null;if(u){var c=Math.abs(u[u.length-2]-s),h=Math.abs(u[u.length-1]-a);c<.001&&h<.001||u.push(s,a)}else this.moveTo(s,a),u=this.currentPath.points;return ty.arc(s,a,t,e,n,r,i,o,u),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill(Hp.WHITE,t,e)},e.prototype.beginTextureFill=function(t,e,n,r){void 0===t&&(t=Hp.WHITE),void 0===e&&(e=16777215),void 0===n&&(n=1),void 0===r&&(r=null),this.currentPath&&this.startPoly();var i=n>0;return i?(r&&(r=r.clone()).invert(),Object.assign(this._fillStyle,{color:e,alpha:n,texture:t,matrix:r,visible:i})):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,n,r){return this.drawShape(new ip(t,e,n,r))},e.prototype.drawRoundedRect=function(t,e,n,r,i){return this.drawShape(new hp(t,e,n,r,i))},e.prototype.drawCircle=function(t,e,n){return this.drawShape(new ap(t,e,n))},e.prototype.drawEllipse=function(t,e,n,r){return this.drawShape(new up(t,e,n,r))},e.prototype.drawPolygon=function(t){var e=arguments,n=t,r=!0;if(n.points&&(r=n.closeStroke,n=n.points),!Array.isArray(n)){n=new Array(arguments.length);for(var i=0;i<n.length;++i)n[i]=e[i]}var o=new cp(n);return o.closeStroke=r,this.drawShape(o),this},e.prototype.drawShape=function(t){return this._holeMode?this.geometry.drawHole(t,this._matrix):this.geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.drawStar=function(t,e,n,r,i,o){return void 0===o&&(o=0),this.drawPolygon(new ey(t,e,n,r,i,o))},e.prototype.clear=function(){return this.geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){return!1},e.prototype._render=function(t){this.finishPoly();var e=this.geometry;if(e.updateBatches(),e.batchable){if(this.batchDirty!==e.batchDirty){this.batches=[],this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.vertexData=new Float32Array(e.points);for(var n=this.blendMode,r=0;r<e.batches.length;r++){var i=e.batches[r],o=i.style.color,s=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),a=new Float32Array(e.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),u={vertexData:s,blendMode:n,indices:new Uint16Array(e.indicesUint16.buffer,2*i.start,i.size),uvs:a,_batchRGB:bf(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[r]=u}}if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var c=0;c<this.batches.length;c++){var h=this.batches[c];h.worldAlpha=this.worldAlpha*h.alpha,t.plugins[this.pluginName].render(h)}}}else{if(t.batch.flush(),!this.shader){if(!ry){for(var l=new Int32Array(16),d=0;d<16;d++)l[d]=d;var f={tint:new Float32Array([1,1,1,1]),translationMatrix:new Wf,default:sm.from({uSamplers:l},!0)};ry=new Um(t.plugins.batch._shader.program,f)}this.shader=ry}var p=this.shader.uniforms;p.translationMatrix=this.transform.worldTransform;var m=this.tint,g=this.worldAlpha;p.tint[0]=(m>>16&255)/255*g,p.tint[1]=(m>>8&255)/255*g,p.tint[2]=(255&m)/255*g,p.tint[3]=g,t.shader.bind(this.shader),t.geometry.bind(e,this.shader),t.state.set(this.state);for(var y=0;y<e.drawCalls.length;y++){for(var v=e.drawCalls[y],b=v.textureCount,w=0;w<b;w++)t.texture.bind(v.textures[w],w);t.geometry.draw(v.type,v.size,v.start)}}},e.prototype._calculateBounds=function(){this.finishPoly();var t=this.geometry.bounds;this._bounds.addFrame(this.transform,t.minX,t.minY,t.maxX,t.maxY)},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this.geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=bf(this.tint,ny),e=0;e<this.batches.length;e++){var n=this.batches[e],r=n._batchRGB,i=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);n._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}},e.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID;for(var t=this.transform.worldTransform,e=t.a,n=t.b,r=t.c,i=t.d,o=t.tx,s=t.ty,a=this.geometry.points,u=this.vertexData,c=0,h=0;h<a.length;h+=2){var l=a[h],d=a[h+1];u[c++]=e*l+r*d+o,u[c++]=i*d+n*l+s}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this.geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},Object.defineProperties(e.prototype,n),e}(pp);iy._TEMP_POINT=new Uf;var oy=new Uf,sy=new Uint16Array([0,1,2,0,2,3]),ay=function(t){function e(e){t.call(this),this._anchor=new Vf(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=hf.NORMAL,this.shader=null,this._cachedTint=16777215,this.uvs=null,this.texture=e||Hp.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=sy,this.size=4,this.start=0,this.pluginName="batch",this.isSprite=!0,this._roundPixels=tf.ROUND_PIXELS}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={roundPixels:{configurable:!0},width:{configurable:!0},height:{configurable:!0},anchor:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this._width&&(this.scale.x=Af(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Af(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,o=e.d,s=e.tx,a=e.ty,u=this.vertexData,c=t.trim,h=t.orig,l=this._anchor,d=0,f=0,p=0,m=0;if(c?(d=(f=c.x-l._x*h.width)+c.width,p=(m=c.y-l._y*h.height)+c.height):(d=(f=-l._x*h.width)+h.width,p=(m=-l._y*h.height)+h.height),u[0]=n*f+i*m+s,u[1]=o*m+r*f+a,u[2]=n*d+i*m+s,u[3]=o*m+r*d+a,u[4]=n*d+i*p+s,u[5]=o*p+r*d+a,u[6]=n*f+i*p+s,u[7]=o*p+r*f+a,this._roundPixels)for(var g=0;g<8;g++)u[g]=Math.round(u[g])}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this.vertexTrimmedData,e=this._texture.orig,n=this._anchor,r=this.transform.worldTransform,i=r.a,o=r.b,s=r.c,a=r.d,u=r.tx,c=r.ty,h=-n._x*e.width,l=h+e.width,d=-n._y*e.height,f=d+e.height;t[0]=i*h+s*d+u,t[1]=a*d+o*h+c,t[2]=i*l+s*d+u,t[3]=a*d+o*l+c,t[4]=i*l+s*f+u,t[5]=a*f+o*l+c,t[6]=i*h+s*f+u,t[7]=a*f+o*h+c},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ip),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,oy);var e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x,i=0;return oy.x>=r&&oy.x<r+e&&oy.y>=(i=-n*this.anchor.y)&&oy.y<i+n},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof e?e:e&&e.texture)&&this._texture.destroy(!!("boolean"==typeof e?e:e&&e.baseTexture)),this._texture=null,this.shader=null},e.from=function(t,n){return new e(t instanceof Hp?t:Hp.from(t,n))},n.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},n.roundPixels.get=function(){return this._roundPixels},n.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width},n.width.set=function(t){var e=Af(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},n.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height},n.height.set=function(t){var e=Af(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},n.anchor.get=function(){return this._anchor},n.anchor.set=function(t){this._anchor.copyFrom(t)},n.tint.get=function(){return this._tint},n.tint.set=function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},n.texture.get=function(){return this._texture},n.texture.set=function(t){this._texture!==t&&(this._texture=t||Hp.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},Object.defineProperties(e.prototype,n),e}(pp),uy={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:0,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},cy=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],hy=function(t){this.styleID=0,this.reset(),py(this,t,t)},ly={align:{configurable:!0},breakWords:{configurable:!0},dropShadow:{configurable:!0},dropShadowAlpha:{configurable:!0},dropShadowAngle:{configurable:!0},dropShadowBlur:{configurable:!0},dropShadowColor:{configurable:!0},dropShadowDistance:{configurable:!0},fill:{configurable:!0},fillGradientType:{configurable:!0},fillGradientStops:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontStyle:{configurable:!0},fontVariant:{configurable:!0},fontWeight:{configurable:!0},letterSpacing:{configurable:!0},lineHeight:{configurable:!0},leading:{configurable:!0},lineJoin:{configurable:!0},miterLimit:{configurable:!0},padding:{configurable:!0},stroke:{configurable:!0},strokeThickness:{configurable:!0},textBaseline:{configurable:!0},trim:{configurable:!0},whiteSpace:{configurable:!0},wordWrap:{configurable:!0},wordWrapWidth:{configurable:!0}};function dy(t){return"number"==typeof t?wf(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function fy(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=dy(t[e]);return t}return dy(t)}function py(t,e,n){for(var r in n)t[r]=Array.isArray(e[r])?e[r].slice():e[r]}hy.prototype.clone=function(){var t={};return py(t,this,uy),new hy(t)},hy.prototype.reset=function(){py(this,uy,uy)},ly.align.get=function(){return this._align},ly.align.set=function(t){this._align!==t&&(this._align=t,this.styleID++)},ly.breakWords.get=function(){return this._breakWords},ly.breakWords.set=function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},ly.dropShadow.get=function(){return this._dropShadow},ly.dropShadow.set=function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},ly.dropShadowAlpha.get=function(){return this._dropShadowAlpha},ly.dropShadowAlpha.set=function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},ly.dropShadowAngle.get=function(){return this._dropShadowAngle},ly.dropShadowAngle.set=function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},ly.dropShadowBlur.get=function(){return this._dropShadowBlur},ly.dropShadowBlur.set=function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},ly.dropShadowColor.get=function(){return this._dropShadowColor},ly.dropShadowColor.set=function(t){var e=fy(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},ly.dropShadowDistance.get=function(){return this._dropShadowDistance},ly.dropShadowDistance.set=function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},ly.fill.get=function(){return this._fill},ly.fill.set=function(t){var e=fy(t);this._fill!==e&&(this._fill=e,this.styleID++)},ly.fillGradientType.get=function(){return this._fillGradientType},ly.fillGradientType.set=function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},ly.fillGradientStops.get=function(){return this._fillGradientStops},ly.fillGradientStops.set=function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},ly.fontFamily.get=function(){return this._fontFamily},ly.fontFamily.set=function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},ly.fontSize.get=function(){return this._fontSize},ly.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},ly.fontStyle.get=function(){return this._fontStyle},ly.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},ly.fontVariant.get=function(){return this._fontVariant},ly.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},ly.fontWeight.get=function(){return this._fontWeight},ly.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},ly.letterSpacing.get=function(){return this._letterSpacing},ly.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},ly.lineHeight.get=function(){return this._lineHeight},ly.lineHeight.set=function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},ly.leading.get=function(){return this._leading},ly.leading.set=function(t){this._leading!==t&&(this._leading=t,this.styleID++)},ly.lineJoin.get=function(){return this._lineJoin},ly.lineJoin.set=function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},ly.miterLimit.get=function(){return this._miterLimit},ly.miterLimit.set=function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},ly.padding.get=function(){return this._padding},ly.padding.set=function(t){this._padding!==t&&(this._padding=t,this.styleID++)},ly.stroke.get=function(){return this._stroke},ly.stroke.set=function(t){var e=fy(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},ly.strokeThickness.get=function(){return this._strokeThickness},ly.strokeThickness.set=function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},ly.textBaseline.get=function(){return this._textBaseline},ly.textBaseline.set=function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},ly.trim.get=function(){return this._trim},ly.trim.set=function(t){this._trim!==t&&(this._trim=t,this.styleID++)},ly.whiteSpace.get=function(){return this._whiteSpace},ly.whiteSpace.set=function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},ly.wordWrap.get=function(){return this._wordWrap},ly.wordWrap.set=function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},ly.wordWrapWidth.get=function(){return this._wordWrapWidth},ly.wordWrapWidth.set=function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},hy.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var n=e.length-1;n>=0;n--){var r=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&cy.indexOf(r)<0&&(r='"'+r+'"'),e[n]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},Object.defineProperties(hy.prototype,ly);var my=function(t,e,n,r,i,o,s,a,u){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=u};my.measureText=function(t,e,n,r){void 0===r&&(r=my._canvas),n=null==n?e.wordWrap:n;var i=e.toFontString(),o=my.measureFont(i);0===o.fontSize&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);var s=r.getContext("2d");s.font=i;for(var a=(n?my.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),u=new Array(a.length),c=0,h=0;h<a.length;h++){var l=s.measureText(a[h]).width+(a[h].length-1)*e.letterSpacing;u[h]=l,c=Math.max(c,l)}var d=c+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);var f=e.lineHeight||o.fontSize+e.strokeThickness,p=Math.max(f,o.fontSize+e.strokeThickness)+(a.length-1)*(f+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new my(t,e,d,p,a,u,f+e.leading,c,o)},my.wordWrap=function(t,e,n){void 0===n&&(n=my._canvas);for(var r=n.getContext("2d"),i=0,o="",s="",a={},u=e.letterSpacing,c=e.whiteSpace,h=my.collapseSpaces(c),l=my.collapseNewlines(c),d=!h,f=e.wordWrapWidth+u,p=my.tokenize(t),m=0;m<p.length;m++){var g=p[m];if(my.isNewline(g)){if(!l){s+=my.addLine(o),d=!h,o="",i=0;continue}g=" "}if(h){var y=my.isBreakingSpace(g),v=my.isBreakingSpace(o[o.length-1]);if(y&&v)continue}var b=my.getFromCache(g,u,a,r);if(b>f)if(""!==o&&(s+=my.addLine(o),o="",i=0),my.canBreakWords(g,e.breakWords))for(var w=g.split(""),_=0;_<w.length;_++){for(var E=w[_],T=1;w[_+T];){var x=w[_+T];if(my.canBreakChars(E[E.length-1],x,g,_,e.breakWords))break;E+=x,T++}_+=E.length-1;var S=my.getFromCache(E,u,a,r);S+i>f&&(s+=my.addLine(o),d=!1,o="",i=0),o+=E,i+=S}else o.length>0&&(s+=my.addLine(o),o="",i=0),s+=my.addLine(g,!(m===p.length-1)),d=!1,o="",i=0;else b+i>f&&(d=!1,s+=my.addLine(o),o="",i=0),(o.length>0||!my.isBreakingSpace(g)||d)&&(o+=g,i+=b)}return s+my.addLine(o,!1)},my.addLine=function(t,e){return void 0===e&&(e=!0),t=my.trimRight(t),e?t+"\n":t},my.getFromCache=function(t,e,n,r){var i=n[t];if(void 0===i){var o=t.length*e;i=r.measureText(t).width+o,n[t]=i}return i},my.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},my.collapseNewlines=function(t){return"normal"===t},my.trimRight=function(t){if("string"!=typeof t)return"";for(var e=t.length-1;e>=0&&my.isBreakingSpace(t[e]);e--)t=t.slice(0,-1);return t},my.isNewline=function(t){return"string"==typeof t&&my._newlines.indexOf(t.charCodeAt(0))>=0},my.isBreakingSpace=function(t){return"string"==typeof t&&my._breakingSpaces.indexOf(t.charCodeAt(0))>=0},my.tokenize=function(t){var e=[],n="";if("string"!=typeof t)return e;for(var r=0;r<t.length;r++){var i=t[r];my.isBreakingSpace(i)||my.isNewline(i)?(""!==n&&(e.push(n),n=""),e.push(i)):n+=i}return""!==n&&e.push(n),e},my.canBreakWords=function(t,e){return e},my.canBreakChars=function(t,e,n,r,i){return!0},my.measureFont=function(t){if(my._fonts[t])return my._fonts[t];var e={},n=my._canvas,r=my._context;r.font=t;var i=my.METRICS_STRING+my.BASELINE_SYMBOL,o=Math.ceil(r.measureText(i).width),s=Math.ceil(r.measureText(my.BASELINE_SYMBOL).width),a=2*s;s=s*my.BASELINE_MULTIPLIER|0,n.width=o,n.height=a,r.fillStyle="#f00",r.fillRect(0,0,o,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,s);var u=r.getImageData(0,0,o,a).data,c=u.length,h=4*o,l=0,d=0,f=!1;for(l=0;l<s;++l){for(var p=0;p<h;p+=4)if(255!==u[d+p]){f=!0;break}if(f)break;d+=h}for(e.ascent=s-l,d=c-h,f=!1,l=a;l>s;--l){for(var m=0;m<h;m+=4)if(255!==u[d+m]){f=!0;break}if(f)break;d-=h}return e.descent=l-s,e.fontSize=e.ascent+e.descent,my._fonts[t]=e,e},my.clearMetrics=function(t){void 0===t&&(t=""),t?delete my._fonts[t]:my._fonts={}};var gy=function(){try{var t=new OffscreenCanvas(0,0);return t.getContext("2d"),t}catch(e){return document.createElement("canvas")}}();gy.width=gy.height=10,my._canvas=gy,my._context=gy.getContext("2d"),my._fonts={},my.METRICS_STRING="|\xc9q\xc5",my.BASELINE_SYMBOL="M",my.BASELINE_MULTIPLIER=1.4,my._newlines=[10,13],my._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var yy={texture:!0,children:!1,baseTexture:!0},vy=function(t){function e(e,n,r){(r=r||document.createElement("canvas")).width=3,r.height=3;var i=Hp.from(r);i.orig=new ip,i.trim=new ip,t.call(this,i),this.canvas=r,this.context=this.canvas.getContext("2d"),this._resolution=tf.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=n,this.localStyleID=-1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var n,r,i=this.context,o=my.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=o.height,a=o.lines,u=o.lineHeight,c=o.lineWidths,h=o.maxLineWidth,l=o.fontProperties;if(this.canvas.width=Math.ceil((Math.max(1,o.width)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,s)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.strokeStyle=e.stroke,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit,e.dropShadow){var d=e.dropShadowColor,f=bf("number"==typeof d?d:function(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}(d));i.shadowColor="rgba("+255*f[0]+","+255*f[1]+","+255*f[2]+","+e.dropShadowAlpha+")",i.shadowBlur=e.dropShadowBlur,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance}else i.shadowColor=0,i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;i.fillStyle=this._generateFillStyle(e,a);for(var p=0;p<a.length;p++)n=e.strokeThickness/2,r=e.strokeThickness/2+p*u+l.ascent,"right"===e.align?n+=h-c[p]:"center"===e.align&&(n+=(h-c[p])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[p],n+e.padding,r+e.padding,!0),e.fill&&this.drawLetterSpacing(a[p],n+e.padding,r+e.padding);this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,n,r){void 0===r&&(r=!1);var i=this._style.letterSpacing;if(0!==i)for(var o=e,s=Array.from?Array.from(t):t.split(""),a=0;a<s.length;++a){var u=s[a];r?this.context.strokeText(u,o,n):this.context.fillText(u,o,n),o+=this.context.measureText(u).width+i}else r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=function(t){var e,n,r,i=t.width,o=t.height,s=t.getContext("2d"),a=s.getImageData(0,0,i,o).data,u=a.length,c={top:null,left:null,right:null,bottom:null},h=null;for(e=0;e<u;e+=4)0!==a[e+3]&&(n=e/4%i,r=~~(e/4/i),null===c.top&&(c.top=r),null===c.left?c.left=n:n<c.left&&(c.left=n),null===c.right?c.right=n+1:c.right<n&&(c.right=n+1),null===c.bottom?c.bottom=r:c.bottom<r&&(c.bottom=r));return null!==c.top&&(h=s.getImageData(c.left,c.top,i=c.right-c.left,o=c.bottom-c.top+1)),{height:o,width:i,data:h}}(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var n=this._texture,r=this._style,i=r.trim?0:r.padding,o=n.baseTexture;n.trim.width=n._frame.width=Math.ceil(t.width/this._resolution),n.trim.height=n._frame.height=Math.ceil(t.height/this._resolution),n.trim.x=-i,n.trim.y=-i,n.orig.width=n._frame.width-2*i,n.orig.height=n._frame.height-2*i,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(1===t.fill.length)return t.fill[0];var n,r,i,o=Math.ceil(this.canvas.width/this._resolution),s=Math.ceil(this.canvas.height/this._resolution),a=t.fill.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var c=a.length+1,h=1;h<c;++h)u.push(h/c);if(a.unshift(t.fill[0]),u.unshift(0),a.push(t.fill[t.fill.length-1]),u.push(1),0===t.fillGradientType){n=this.context.createLinearGradient(o/2,0,o/2,s),r=(a.length+1)*e.length,i=0;for(var l=0;l<e.length;l++){i+=1;for(var d=0;d<a.length;d++)n.addColorStop("number"==typeof u[d]?u[d]/e.length+l/e.length:i/r,a[d]),i++}}else{n=this.context.createLinearGradient(0,s/2,o,s/2),r=a.length+1,i=1;for(var f=0;f<a.length;f++)n.addColorStop("number"==typeof u[f]?u[f]:i/r,a[f]),i++}return n},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},yy,e),t.prototype.destroy.call(this,e),this.context=null,this.canvas=null,this._style=null},n.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},n.width.set=function(t){this.updateText(!0);var e=Af(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},n.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},n.height.set=function(t){this.updateText(!0);var e=Af(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},n.style.get=function(){return this._style},n.style.set=function(t){this._style=(t=t||{})instanceof hy?t:new hy(t),this.localStyleID=-1,this.dirty=!0},n.text.get=function(){return this._text},n.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},n.resolution.get=function(){return this._resolution},n.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},Object.defineProperties(e.prototype,n),e}(ay);tf.UPLOADS_PER_FRAME=4;var by=function(t){this.maxItemsPerFrame=t,this.itemsLeft=0};by.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},by.prototype.allowedToUpload=function(){return this.itemsLeft-- >0};var wy=function(t){var e=this;this.limiter=new by(tf.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(Cy),this.registerFindHook(Ay),this.registerFindHook(_y),this.registerFindHook(Ey),this.registerFindHook(Ty),this.registerUploadHook(xy),this.registerUploadHook(Sy)};function _y(t,e){var n=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Hp){var i=t._textures[r].baseTexture;-1===e.indexOf(i)&&(e.push(i),n=!0)}return n}function Ey(t,e){return t instanceof kp&&(-1===e.indexOf(t)&&e.push(t),!0)}function Ty(t,e){if(t._texture&&t._texture instanceof Hp){var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function xy(t,e){return e instanceof vy&&(e.updateText(!0),!0)}function Sy(t,e){if(e instanceof hy){var n=e.toFontString();return my.measureFont(n),!0}return!1}function Cy(t,e){if(t instanceof vy){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function Ay(t,e){return t instanceof hy&&(-1===e.indexOf(t)&&e.push(t),!0)}wy.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,bp.system.addOnce(this.tick,this,-50))):e&&e()},wy.prototype.tick=function(){setTimeout(this.delayedTick,0)},wy.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)bp.system.addOnce(this.tick,this,-50);else{this.ticking=!1;var i=this.completes.slice(0);this.completes.length=0;for(var o=0,s=i.length;o<s;o++)i[o]()}},wy.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},wy.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},wy.prototype.add=function(t){for(var e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof pp)for(var r=t.children.length-1;r>=0;r--)this.add(t.children[r]);return this},wy.prototype.destroy=function(){this.ticking&&bp.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var Iy=function(t){function e(e){t.call(this,e),this.uploadHookHelper=this.renderer,this.registerFindHook(ky),this.registerUploadHook(Oy),this.registerUploadHook(Dy)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(wy);function Oy(t,e){return e instanceof kp&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Dy(t,e){return e instanceof iy&&((e.dirty||e.clearDirty||!e._webGL[t.plugins.graphics.CONTEXT_UID])&&t.plugins.graphics.updateGraphics(e),!0)}function ky(t,e){return t instanceof iy&&(e.push(t),!0)}var Py=function(t){this.maxMilliseconds=t,this.frameStart=0};Py.prototype.beginFrame=function(){this.frameStart=Date.now()},Py.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds};var Ny=function t(e){var n=this;e=Object.assign({forceCanvas:!1},e),this.renderer=function(t){return pg.create(t)}(e),this.stage=new pp,t._plugins.forEach(function(t){t.init.call(n,e)})},My={view:{configurable:!0},screen:{configurable:!0}};Ny.registerPlugin=function(t){Ny._plugins.push(t)},Ny.prototype.render=function(){this.renderer.render(this.stage)},My.view.get=function(){return this.renderer.view},My.screen.get=function(){return this.renderer.screen},Ny.prototype.destroy=function(t){var e=this,n=Ny._plugins.slice(0);n.reverse(),n.forEach(function(t){t.destroy.call(e)}),this.stage.destroy(),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},Object.defineProperties(Ny.prototype,My),Ny._plugins=[];var Ry=function(){};Ry.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.resize),this._resizeTo=t,t&&(window.addEventListener("resize",this.resize),this.resize())},get:function(){return this._resizeTo}}),this.resize=function(){e._resizeTo&&(e._resizeTo===window?e.renderer.resize(window.innerWidth,window.innerHeight):e.renderer.resize(e._resizeTo.clientWidth,e._resizeTo.clientHeight))},this._resizeTo=null,this.resizeTo=t.resizeTo||null},Ry.destroy=function(){this.resizeTo=null,this.resize=null},Ny.registerPlugin(Ry);var Ly=n("u62O"),Fy=n.n(Ly),By=n("1eSL"),Uy=n.n(By);function Vy(){}function jy(t,e,n,r){var i=0,o=t.length;!function s(a){a||i===o?n&&n(a):r?setTimeout(function(){e(t[i++],s)},1):e(t[i++],s)}()}function qy(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}var Gy={};function Hy(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zy(t,e,n){return e&&Hy(t.prototype,e),n&&Hy(t,n),t}var Wy=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),Ky=null;function Xy(){}var Qy=function(){function t(e,n,r){if("string"!=typeof e||"string"!=typeof n)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===n.indexOf("data:")),this.name=e,this.url=n,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Xy,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Uy.a,this.onProgress=new Uy.a,this.onComplete=new Uy.a,this.onAfterMiddleware=new Uy.a}t.setExtensionLoadType=function(e,n){Yy(t._loadTypeMap,e,n)},t.setExtensionXhrType=function(e,n){Yy(t._xhrTypeMap,e,n)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var n=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(n)},1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:Wy&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.data=this.metadata.loadElement?this.metadata.loadElement:"image"===t&&void 0!==window.Image?new Image:document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.data=this.metadata.loadElement?this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?new Audio:document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,n=0;n<this.url.length;++n)this.data.appendChild(this._createSource(t,this.url[n],Array.isArray(e)?e[n]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,e.responseType=this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?t.XHR_RESPONSE_TYPE.TEXT:this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout(function(){return t.send()},1)},e._createSource=function(t,e,n){n||(n=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=n,r},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(Jy(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){this.abort(Jy(this.xhr)+" Request timed out.")},e._xhrOnAbort=function(){this.abort(Jy(this.xhr)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,n="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(n=e.responseText),0===r&&(n.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2==(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=t.TYPE.JSON}catch(s){return void this.abort("Error trying to parse loaded json: "+s)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(n,"text/xml")}else{var o=document.createElement("div");o.innerHTML=n,this.data=o}this.type=t.TYPE.XML}catch(s){return void this.abort("Error trying to parse loaded xml: "+s)}else this.data=e.response||n;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){return 0===t.indexOf("data:")?"":window.origin!==window.location.origin?"anonymous":(e=e||window.location,Ky||(Ky=document.createElement("a")),Ky.href=t,(t=Fy()(Ky.href,{strictMode:!0})).host!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||(t.protocol?t.protocol+":":"")!==e.protocol?"anonymous":"")},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var n=t.indexOf("/");e=t.substring(n+1,t.indexOf(";",n))}else{var r=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(r>-1?r:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},zy(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function Yy(t,e,n){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=n)}function Jy(t){return t.toString().replace("object ","")}Qy.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Qy.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Qy.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Qy.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Qy._loadTypeMap={gif:Qy.LOAD_TYPE.IMAGE,png:Qy.LOAD_TYPE.IMAGE,bmp:Qy.LOAD_TYPE.IMAGE,jpg:Qy.LOAD_TYPE.IMAGE,jpeg:Qy.LOAD_TYPE.IMAGE,tif:Qy.LOAD_TYPE.IMAGE,tiff:Qy.LOAD_TYPE.IMAGE,webp:Qy.LOAD_TYPE.IMAGE,tga:Qy.LOAD_TYPE.IMAGE,svg:Qy.LOAD_TYPE.IMAGE,"svg+xml":Qy.LOAD_TYPE.IMAGE,mp3:Qy.LOAD_TYPE.AUDIO,ogg:Qy.LOAD_TYPE.AUDIO,wav:Qy.LOAD_TYPE.AUDIO,mp4:Qy.LOAD_TYPE.VIDEO,webm:Qy.LOAD_TYPE.VIDEO},Qy._xhrTypeMap={xhtml:Qy.XHR_RESPONSE_TYPE.DOCUMENT,html:Qy.XHR_RESPONSE_TYPE.DOCUMENT,htm:Qy.XHR_RESPONSE_TYPE.DOCUMENT,xml:Qy.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Qy.XHR_RESPONSE_TYPE.DOCUMENT,svg:Qy.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Qy.XHR_RESPONSE_TYPE.DOCUMENT,gif:Qy.XHR_RESPONSE_TYPE.BLOB,png:Qy.XHR_RESPONSE_TYPE.BLOB,bmp:Qy.XHR_RESPONSE_TYPE.BLOB,jpg:Qy.XHR_RESPONSE_TYPE.BLOB,jpeg:Qy.XHR_RESPONSE_TYPE.BLOB,tif:Qy.XHR_RESPONSE_TYPE.BLOB,tiff:Qy.XHR_RESPONSE_TYPE.BLOB,webp:Qy.XHR_RESPONSE_TYPE.BLOB,tga:Qy.XHR_RESPONSE_TYPE.BLOB,json:Qy.XHR_RESPONSE_TYPE.JSON,text:Qy.XHR_RESPONSE_TYPE.TEXT,txt:Qy.XHR_RESPONSE_TYPE.TEXT,ttf:Qy.XHR_RESPONSE_TYPE.BUFFER,otf:Qy.XHR_RESPONSE_TYPE.BUFFER},Qy.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var $y=window.URL||window.webkitURL,Zy={caching:function(t,e){var n=this;Gy[t.url]?(t.data=Gy[t.url],t.complete()):t.onComplete.once(function(){return Gy[n.url]=n.data}),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===Qy.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var n=$y.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=n,t.type=Qy.TYPE.IMAGE,void(t.data.onload=function(){$y.revokeObjectURL(n),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",n=0;n<t.length;){for(var r=[0,0,0],i=[0,0,0,0],o=0;o<r.length;++o)r[o]=n<t.length?255&t.charCodeAt(n++):0;switch(i[0]=r[0]>>2,i[1]=(3&r[0])<<4|r[1]>>4,i[2]=(15&r[1])<<2|r[2]>>6,i[3]=63&r[2],n-(t.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(var s=0;s<i.length;++s)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i[s])}return e}(t.xhr.responseText),t.type=Qy.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},tv=/(#[\w-]+)?$/,ev=function(){function t(e,n){var r=this;void 0===e&&(e=""),void 0===n&&(n=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var n=0,r={_tasks:[],concurrency:e,saturated:Vy,unsaturated:Vy,buffer:e/4,empty:Vy,drain:Vy,error:Vy,started:!1,paused:!1,push:function(t,e){i(t,!1,e)},kill:function(){n=0,r.drain=Vy,r.started=!1,r._tasks=[]},unshift:function(t,e){i(t,!0,e)},process:function(){for(;!r.paused&&n<r.concurrency&&r._tasks.length;){var e=r._tasks.shift();0===r._tasks.length&&r.empty(),(n+=1)===r.concurrency&&r.saturated(),t(e.data,qy(o(e)))}},length:function(){return r._tasks.length},running:function(){return n},idle:function(){return r._tasks.length+n===0},pause:function(){!0!==r.paused&&(r.paused=!0)},resume:function(){if(!1!==r.paused){r.paused=!1;for(var t=1;t<=r.concurrency;t++)r.process()}}};function i(t,e,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout(function(){return r.drain()},1);else{var i={data:t,callback:"function"==typeof n?n:Vy};e?r._tasks.unshift(i):r._tasks.push(i),setTimeout(function(){return r.process()},1)}}function o(t){return function(){n-=1,t.callback.apply(t,arguments),null!=arguments[0]&&r.error(arguments[0],t.data),n<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new Uy.a,this.onError=new Uy.a,this.onLoad=new Uy.a,this.onStart=new Uy.a,this.onComplete=new Uy.a;for(var i=0;i<t._defaultBeforeMiddleware.length;++i)this.pre(t._defaultBeforeMiddleware[i]);for(var o=0;o<t._defaultAfterMiddleware.length;++o)this.use(t._defaultAfterMiddleware[o])}var e=t.prototype;return e.add=function(t,e,n,r){if(Array.isArray(t)){for(var i=0;i<t.length;++i)this.add(t[i]);return this}if("object"==typeof t&&(r=e||t.callback||t.onComplete,n=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(r=n,n=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof n&&(r=n,n=null),this.loading&&(!n||!n.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new Qy(t,e,n),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var o=n.parentResource,s=[],a=0;a<o.children.length;++a)o.children[a].isComplete||s.push(o.children[a]);var u=o.progressChunk*(s.length+1)/(s.length+2);o.children.push(this.resources[t]),o.progressChunk=u;for(var c=0;c<s.length;++c)s[c].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,n=Fy()(t,{strictMode:!0});if(e=n.protocol||!n.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=tv.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},e._loadResource=function(t,e){var n=this;t._dequeue=e,jy(this._beforeMiddleware,function(e,r){e.call(n,t,function(){r(t.isComplete?{}:null)})},function(){t.isComplete?n._onLoad(t):(t._onLoadBinding=t.onComplete.once(n._onLoad,n),t.load())},!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),jy(this._afterMiddleware,function(n,r){n.call(e,t,r)},function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()},!0)},zy(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();ev._defaultBeforeMiddleware=[],ev._defaultAfterMiddleware=[],ev.pre=function(t){return ev._defaultBeforeMiddleware.push(t),ev},ev.use=function(t){return ev._defaultAfterMiddleware.push(t),ev};var nv=function(){};nv.use=function(t,e){t.data&&t.type===Qy.TYPE.IMAGE&&(t.texture=Hp.fromLoader(t.data,t.url,t.name)),e()};var rv=function(t){function e(n,r){var i=this;t.call(this,n,r),nf.a.call(this);for(var o=0;o<e._plugins.length;++o){var s=e._plugins[o],a=s.pre,u=s.use;a&&this.pre(a),u&&this.use(u)}this.onStart.add(function(t){return i.emit("start",t)}),this.onProgress.add(function(t,e){return i.emit("progress",t,e)}),this.onError.add(function(t,e,n){return i.emit("error",t,e,n)}),this.onLoad.add(function(t,e){return i.emit("load",t,e)}),this.onComplete.add(function(t,e){return i.emit("complete",t,e)}),this._protected=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={shared:{configurable:!0}};return e.prototype.destroy=function(){this._protected||(this.removeAllListeners(),this.reset())},n.shared.get=function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},Object.defineProperties(e,n),e}(ev);Object.assign(rv.prototype,nf.a.prototype),rv._plugins=[],rv.registerPlugin=function(t){return rv._plugins.push(t),t.add&&t.add(),rv},rv.registerPlugin({use:Zy.parsing}),rv.registerPlugin(nv);var iv=function(){};iv.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?rv.shared:new rv},iv.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)};var ov=Qy,sv=function(t,e,n){this.geometry=new nm,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;++r){var i=t[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||pf.FLOAT,offset:i.offset},e[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()};sv.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new Yp(function(t,e){void 0===e&&(e=null);var n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+n);for(var r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var n=0;n<this.dynamicProperties.length;++n){var r=this.dynamicProperties[n];r.offset=e,e+=r.size,this.dynamicStride+=r.size}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Yp(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(var s=0;s<this.staticProperties.length;++s){var a=this.staticProperties[s];a.offset=o,o+=a.size,this.staticStride+=a.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=new Yp(this.staticData,!0,!1);for(var c=0;c<this.dynamicProperties.length;++c){var h=this.dynamicProperties[c];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===pf.UNSIGNED_BYTE,h.type,4*this.dynamicStride,4*h.offset)}for(var l=0;l<this.staticProperties.length;++l){var d=this.staticProperties[l];t.addAttribute(d.attributeName,this.staticBuffer,0,d.type===pf.UNSIGNED_BYTE,d.type,4*this.staticStride,4*d.offset)}},sv.prototype.uploadDynamic=function(t,e,n){for(var r=0;r<this.dynamicProperties.length;r++){var i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.type===pf.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++},sv.prototype.uploadStatic=function(t,e,n){for(var r=0;r<this.staticProperties.length;r++){var i=this.staticProperties[r];i.uploadFunction(t,e,n,i.type===pf.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++},sv.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()};var av="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n",uv="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",cv=function(t){function e(e){t.call(this,e),this.shader=null,this.properties=null,this.tempMatrix=new Wf,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:pf.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Um.from(av,uv,{})}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(t){var e=t.children,n=t._maxSize,r=t._batchSize,i=this.renderer,o=e.length;if(0!==o){o>n&&!t.autoResize&&(o=n);var s=t._buffers;s||(s=t._buffers=this.generateBuffers(t));var a=e[0]._texture.baseTexture;this.renderer.state.setBlendMode(Ef(t.blendMode,a.premultiplyAlpha));var u,c,h,l,d=i.gl,f=t.worldTransform.copyTo(this.tempMatrix);f.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=f.toArray(!0),this.shader.uniforms.uColor=(u=t.tintRgb,c=t.worldAlpha,l=a.premultiplyAlpha,h=(h=this.shader.uniforms.uColor)||new Float32Array(4),l||void 0===l?(h[0]=u[0]*c,h[1]=u[1]*c,h[2]=u[2]*c):(h[0]=u[0],h[1]=u[1],h[2]=u[2]),h[3]=c,h),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var p=!1,m=0,g=0;m<o;m+=r,g+=1){var y=o-m;y>r&&(y=r),g>=s.length&&s.push(this._generateOneMoreBuffer(t));var v=s[g];v.uploadDynamic(e,m,y),(p=p||v._updateID<(t._bufferUpdateIDs[g]||0))&&(v._updateID=t._updateID,v.uploadStatic(e,m,y)),i.geometry.bind(v.geometry),d.drawElements(d.TRIANGLES,6*y,d.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],n=t._maxSize,r=t._batchSize,i=t._properties,o=0;o<n;o+=r)e.push(new sv(this.properties,i,r));return e},e.prototype._generateOneMoreBuffer=function(t){return new sv(this.properties,t._properties,t._batchSize)},e.prototype.uploadVertices=function(t,e,n,r,i,o){for(var s=0,a=0,u=0,c=0,h=0;h<n;++h){var l=t[e+h],d=l._texture,f=l.scale.x,p=l.scale.y,m=d.trim,g=d.orig;m?(s=(a=m.x-l.anchor.x*g.width)+m.width,u=(c=m.y-l.anchor.y*g.height)+m.height):(s=g.width*(1-l.anchor.x),a=g.width*-l.anchor.x,u=g.height*(1-l.anchor.y),c=g.height*-l.anchor.y),r[o]=a*f,r[o+1]=c*p,r[o+i]=s*f,r[o+i+1]=c*p,r[o+2*i]=s*f,r[o+2*i+1]=u*p,r[o+3*i]=a*f,r[o+3*i+1]=u*p,o+=4*i}},e.prototype.uploadPosition=function(t,e,n,r,i,o){for(var s=0;s<n;s++){var a=t[e+s].position;r[o]=a.x,r[o+1]=a.y,r[o+i]=a.x,r[o+i+1]=a.y,r[o+2*i]=a.x,r[o+2*i+1]=a.y,r[o+3*i]=a.x,r[o+3*i+1]=a.y,o+=4*i}},e.prototype.uploadRotation=function(t,e,n,r,i,o){for(var s=0;s<n;s++){var a=t[e+s].rotation;r[o]=a,r[o+i]=a,r[o+2*i]=a,r[o+3*i]=a,o+=4*i}},e.prototype.uploadUvs=function(t,e,n,r,i,o){for(var s=0;s<n;++s){var a=t[e+s]._texture._uvs;a?(r[o]=a.x0,r[o+1]=a.y0,r[o+i]=a.x1,r[o+i+1]=a.y1,r[o+2*i]=a.x2,r[o+2*i+1]=a.y2,r[o+3*i]=a.x3,r[o+3*i+1]=a.y3,o+=4*i):(r[o]=0,r[o+1]=0,r[o+i]=0,r[o+i+1]=0,r[o+2*i]=0,r[o+2*i+1]=0,r[o+3*i]=0,r[o+3*i+1]=0,o+=4*i)}},e.prototype.uploadTint=function(t,e,n,r,i,o){for(var s=0;s<n;++s){var a=t[e+s],u=a.alpha,c=u<1&&a._texture.baseTexture.premultiplyAlpha?Tf(a._tintRGB,u):a._tintRGB+(255*u<<24);r[o]=c,r[o+i]=c,r[o+2*i]=c,r[o+3*i]=c,o+=4*i}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(cm),hv=function(t,e,n){void 0===n&&(n=null),this.baseTexture=t,this.textures={},this.animations={},this.data=e,this.resolution=this._updateResolution(n||(this.baseTexture.resource?this.baseTexture.resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null},lv={BATCH_SIZE:{configurable:!0}};lv.BATCH_SIZE.get=function(){return 1e3},hv.prototype._updateResolution=function(t){var e=this.data.meta.scale,n=Ff(t,null);return null===n&&(n=void 0!==e?parseFloat(e):1),1!==n&&this.baseTexture.setResolution(n),n},hv.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=hv.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},hv.prototype._processFrames=function(t){for(var e=t,n=hv.BATCH_SIZE;e-t<n&&e<this._frameKeys.length;){var r=this._frameKeys[e],i=this._frames[r],o=i.frame;if(o){var s,a=null,u=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,c=new ip(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);s=i.rotated?new ip(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):new ip(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(a=new ip(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new Hp(this.baseTexture,s,c,a,i.rotated?2:0,i.anchor),Hp.addToCache(this.textures[r],r)}e++}},hv.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var n=0;n<t[e].length;n++)this.animations[e].push(this.textures[t[e][n]])}},hv.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},hv.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*hv.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*hv.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},hv.prototype.destroy=function(t){for(var e in void 0===t&&(t=!1),this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},Object.defineProperties(hv,lv);var dv=function(){};dv.use=function(t,e){var n=t.name+"_image";if(t.data&&t.type===ov.TYPE.JSON&&t.data.frames&&!this.resources[n]){var r={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},i=dv.getResourcePath(t,this.baseUrl);this.add(n,i,r,function(n){if(n.error)e(n.error);else{var r=new hv(n.texture.baseTexture,t.data,t.url);r.parse(function(){t.spritesheet=r,t.textures=r.textures,e()})}})}else e()},dv.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:af.a.resolve(t.url.replace(e,""),t.data.meta.image)},new Uf;var fv="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",pv="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n",mv="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",gv=new Wf,yv=function(t){function e(e){t.call(this,e);var n={globals:this.renderer.globalUniforms};this.shader=Um.from(fv,pv,n),this.simpleShader=Um.from(fv,mv,n),this.quad=new im}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(t){var e=this.renderer,n=this.quad,r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((r=n.uvs)[0]=r[6]=-t.anchor.x,r[1]=r[3]=-t.anchor.y,r[2]=r[4]=1-t.anchor.x,r[5]=r[7]=1-t.anchor.y),n.invalidate();var i=t._texture,o=i.baseTexture,s=t.tileTransform.localTransform,a=t.uvMatrix,u=o.isPowerOfTwo&&i.frame.width===o.width&&i.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=33071!==o.wrapMode:33071===o.wrapMode&&(o.wrapMode=10497));var c,h,l,d,f=u?this.simpleShader:this.shader,p=i.width,m=i.height,g=t._width,y=t._height;gv.set(s.a*p/g,s.b*p/y,s.c*m/g,s.d*m/y,s.tx/g,s.ty/y),gv.invert(),u?gv.prepend(a.mapCoord):(f.uniforms.uMapCoord=a.mapCoord.toArray(!0),f.uniforms.uClampFrame=a.uClampFrame,f.uniforms.uClampOffset=a.uClampOffset),f.uniforms.uTransform=gv.toArray(!0),f.uniforms.uColor=(c=t.tint,h=t.worldAlpha,d=o.premultiplyAlpha,(l=(l=f.uniforms.uColor)||new Float32Array(4))[0]=(c>>16&255)/255,l[1]=(c>>8&255)/255,l[2]=(255&c)/255,(d||void 0===d)&&(l[0]*=h,l[1]*=h,l[2]*=h),l[3]=h,l),f.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),f.uniforms.uSampler=i,e.shader.bind(f),e.geometry.bind(n),e.state.setBlendMode(Ef(t.blendMode,o.premultiplyAlpha)),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(cm),vv=function(t){function e(e,n){var r=this;void 0===n&&(n={}),t.call(this),this._textWidth=0,this._textHeight=0,this._glyphs=[],this._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},this.font=n.font,this._text=e,this._maxWidth=0,this._maxLineHeight=0,this._letterSpacing=0,this._anchor=new Vf(function(){r.dirty=!0},this,0,0),this.dirty=!1,this.roundPixels=tf.ROUND_PIXELS,this.updateText()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={tint:{configurable:!0},align:{configurable:!0},anchor:{configurable:!0},font:{configurable:!0},text:{configurable:!0},maxWidth:{configurable:!0},maxLineHeight:{configurable:!0},textWidth:{configurable:!0},letterSpacing:{configurable:!0},textHeight:{configurable:!0}};return e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],n=this._font.size/t.size,r=new Uf,i=[],o=[],s=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",a=s.length,u=this._maxWidth*t.size/this._font.size,c=null,h=0,l=0,d=0,f=-1,p=0,m=0,g=0,y=0;y<a;y++){var v=s.charCodeAt(y),b=s.charAt(y);if(/(?:\s)/.test(b)&&(f=y,p=h),"\r"!==b&&"\n"!==b){var w=t.chars[v];w&&(c&&w.kerning[c]&&(r.x+=w.kerning[c]),i.push({texture:w.texture,line:d,charCode:v,position:new Uf(r.x+w.xOffset+this._letterSpacing/2,r.y+w.yOffset)}),r.x+=w.xAdvance+this._letterSpacing,h=r.x,g=Math.max(g,w.yOffset+w.texture.height),c=v,-1!==f&&u>0&&r.x>u&&(xf(i,1+f-++m,1+y-f),y=f,f=-1,o.push(p),l=Math.max(l,p),d++,r.x=0,r.y+=t.lineHeight,c=null))}else o.push(h),l=Math.max(l,h),++d,++m,r.x=0,r.y+=t.lineHeight,c=null}var _=s.charAt(s.length-1);"\r"!==_&&"\n"!==_&&(/(?:\s)/.test(_)&&(h=p),o.push(h),l=Math.max(l,h));for(var E=[],T=0;T<=d;T++){var x=0;"right"===this._font.align?x=l-o[T]:"center"===this._font.align&&(x=(l-o[T])/2),E.push(x)}for(var S=i.length,C=this.tint,A=0;A<S;A++){var I=this._glyphs[A];I?I.texture=i[A].texture:((I=new ay(i[A].texture)).roundPixels=this.roundPixels,this._glyphs.push(I)),I.position.x=(i[A].position.x+E[i[A].line])*n,I.position.y=i[A].position.y*n,I.scale.x=I.scale.y=n,I.tint=C,I.parent||this.addChild(I)}for(var O=S;O<this._glyphs.length;++O)this.removeChild(this._glyphs[O]);if(this._textWidth=l*n,this._textHeight=(r.y+t.lineHeight)*n,0!==this.anchor.x||0!==this.anchor.y)for(var D=0;D<S;D++)this._glyphs[D].x-=this._textWidth*this.anchor.x,this._glyphs[D].y-=this._textHeight*this.anchor.y;this._maxLineHeight=g*n},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},n.tint.get=function(){return this._font.tint},n.tint.set=function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0},n.align.get=function(){return this._font.align},n.align.set=function(t){this._font.align=t||"left",this.dirty=!0},n.anchor.get=function(){return this._anchor},n.anchor.set=function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},n.font.get=function(){return this._font},n.font.set=function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)},n.text.get=function(){return this._text},n.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},n.maxWidth.get=function(){return this._maxWidth},n.maxWidth.set=function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},n.maxLineHeight.get=function(){return this.validate(),this._maxLineHeight},n.textWidth.get=function(){return this.validate(),this._textWidth},n.letterSpacing.get=function(){return this._letterSpacing},n.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},n.textHeight.get=function(){return this.validate(),this._textHeight},e.registerFont=function(t,n){var r={},i=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0],s=t.getElementsByTagName("page"),a=Ff(s[0].getAttribute("file"),tf.RESOLUTION),u={};r.font=i.getAttribute("face"),r.size=parseInt(i.getAttribute("size"),10),r.lineHeight=parseInt(o.getAttribute("lineHeight"),10)/a,r.chars={},n instanceof Hp&&(n=[n]);for(var c=0;c<s.length;c++){var h=s[c].getAttribute("id"),l=s[c].getAttribute("file");u[h]=n instanceof Array?n[c]:n[l]}for(var d=t.getElementsByTagName("char"),f=0;f<d.length;f++){var p=d[f],m=parseInt(p.getAttribute("id"),10),g=p.getAttribute("page")||0,y=new ip(parseInt(p.getAttribute("x"),10)/a+u[g].frame.x/a,parseInt(p.getAttribute("y"),10)/a+u[g].frame.y/a,parseInt(p.getAttribute("width"),10)/a,parseInt(p.getAttribute("height"),10)/a);r.chars[m]={xOffset:parseInt(p.getAttribute("xoffset"),10)/a,yOffset:parseInt(p.getAttribute("yoffset"),10)/a,xAdvance:parseInt(p.getAttribute("xadvance"),10)/a,kerning:{},texture:new Hp(u[g].baseTexture,y),page:g}}for(var v=t.getElementsByTagName("kerning"),b=0;b<v.length;b++){var w=v[b],_=parseInt(w.getAttribute("first"),10)/a,E=parseInt(w.getAttribute("second"),10)/a,T=parseInt(w.getAttribute("amount"),10)/a;r.chars[E]&&(r.chars[E].kerning[_]=T)}return e.fonts[r.font]=r,r},Object.defineProperties(e.prototype,n),e}(pp);vv.fonts={};var bv=function(){};bv.parse=function(t,e){t.bitmapFont=vv.registerFont(t.data,e)},bv.add=function(){ov.setExtensionXhrType("fnt",ov.XHR_RESPONSE_TYPE.DOCUMENT)},bv.dirname=function(t){var e=t.replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},bv.use=function(t,e){if(t.data&&t.type===ov.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var n=t.isDataUrl?"":bv.dirname(t.url);t.isDataUrl&&("."===n&&(n=""),this.baseUrl&&n&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(n+="/")),(n=n.replace(this.baseUrl,""))&&"/"!==n.charAt(n.length-1)&&(n+="/");for(var r=t.data.getElementsByTagName("page"),i={},o=function(n){i[n.metadata.pageFile]=n.texture,Object.keys(i).length===r.length&&(bv.parse(t,i),e())},s=0;s<r.length;++s){var a=r[s].getAttribute("file"),u=n+a,c=!1;for(var h in this.resources){var l=this.resources[h];if(l.url===u){l.metadata.pageFile=a,l.texture?o(l):l.onAfterMiddleware.add(o),c=!0;break}}if(!c){var d={crossOrigin:t.crossOrigin,loadType:ov.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:a},t.metadata.imageMetadata),parentResource:t};this.add(u,d,o)}}}else e();else e()},["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var wv="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",_v=function(t){function e(){var e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};t.call(this,mg,wv,e),this.alpha=1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={matrix:{configurable:!0},alpha:{configurable:!0}};return e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)},e.prototype.greyscale=function(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var n=Math.cos(t),r=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i);this._loadMatrix([n+(1-n)*i,i*(1-n)-o*r,i*(1-n)+o*r,0,0,i*(1-n)+o*r,n+i*(1-n),i*(1-n)-o*r,0,0,i*(1-n)-o*r,i*(1-n)+o*r,n+i*(1-n),0,0,0,0,0,1,0],e)},e.prototype.contrast=function(t,e){var n=(t||0)+1,r=-.5*(n-1);this._loadMatrix([n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0],e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var n=2*t/3+1,r=-.5*(n-1);this._loadMatrix([n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0],e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,n,r,i){var o=((n=n||16770432)>>16&255)/255,s=(n>>8&255)/255,a=(255&n)/255,u=((r=r||3375104)>>16&255)/255,c=(r>>8&255)/255,h=(255&r)/255;this._loadMatrix([.3,.59,.11,0,0,o,s,a,t=t||.2,0,u,c,h,e=e||.15,0,o-u,s-c,a-h,0,0],i)},e.prototype.night=function(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)},e.prototype.predator=function(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},n.matrix.get=function(){return this.uniforms.m},n.matrix.set=function(t){this.uniforms.m=t},n.alpha.get=function(){return this.uniforms.uAlpha},n.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(e.prototype,n),e}(Gm);_v.prototype.grayscale=_v.prototype.greyscale;var Ev=new Wf;dp.prototype._cacheAsBitmap=!1,dp.prototype._cacheData=!1;var Tv=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(dp.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Tv),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),dp.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},dp.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var n=this.getLocalBounds().clone();this.filters&&n.pad(this.filters[0].padding),n.ceil(tf.RESOLUTION);var r=t.renderTexture.current,i=t.renderTexture.sourceFrame,o=t.projection.transform,s=Wp.create(n.width,n.height),a="cacheAsBitmap_"+Cf();this._cacheData.textureCacheId=a,kp.addToCache(s.baseTexture,a),Hp.addToCache(s,a);var u=Ev;u.tx=-n.x,u.ty=-n.y,this.transform.worldTransform.identity(),this.render=this._cacheData.originalRender,t.render(this,s,!0,u,!0),t.projection.transform=o,t.renderTexture.bind(r,i),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var c=new ay(s);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-n.x/n.width,c.anchor.y=-n.y/n.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)}},dp.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},dp.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),n=this.alpha;this.alpha=1;var r=t.context;e.ceil(tf.RESOLUTION);var i=Wp.create(e.width,e.height),o="cacheAsBitmap_"+Cf();this._cacheData.textureCacheId=o,kp.addToCache(i.baseTexture,o),Hp.addToCache(i,o);var s=Ev;this.transform.localTransform.copyTo(s),s.invert(),s.tx-=e.x,s.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,i,!0,s,!1),t.context=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var a=new ay(i);a.transform.worldTransform=this.transform.worldTransform,a.anchor.x=-e.x/e.width,a.anchor.y=-e.y/e.height,a.alpha=n,a._bounds=this._bounds,this._cacheData.sprite=a,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=a.containsPoint.bind(a)}},dp.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},dp.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},dp.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,kp.removeFromCache(this._cacheData.textureCacheId),Hp.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},dp.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},dp.prototype.name=null,pp.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},dp.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Uf),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var xv=function(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0};xv.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var Sv=new Uf,Cv=new cp;(function(t){function e(e,n,r,i){void 0===i&&(i=lf.TRIANGLES),t.call(this),this.geometry=e,e.refCount++,this.shader=n,this.state=r||jm.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=0,this._transformID=-1,this.tint=16777215,this.blendMode=hf.NORMAL,this._roundPixels=tf.ROUND_PIXELS,this.batchUvs=null}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={uvBuffer:{configurable:!0},verticesBuffer:{configurable:!0},material:{configurable:!0},blendMode:{configurable:!0},roundPixels:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return n.uvBuffer.get=function(){return this.geometry.buffers[1]},n.verticesBuffer.get=function(){return this.geometry.buffers[0]},n.material.set=function(t){this.shader=t},n.material.get=function(){return this.shader},n.blendMode.set=function(t){this.state.blendMode=t},n.blendMode.get=function(){return this.state.blendMode},n.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},n.roundPixels.get=function(){return this._roundPixels},n.tint.get=function(){return this.shader.tint},n.tint.set=function(t){this.shader.tint=t},n.texture.get=function(){return this.shader.texture},n.texture.set=function(t){this.shader.texture=t},e.prototype._render=function(t){this.shader.batchable&&this.drawMode===lf.TRIANGLES&&this.geometry.buffers[0].data.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var n=this.transform.worldTransform,r=n.a,i=n.b,o=n.c,s=n.d,a=n.tx,u=n.ty,c=this.vertexData,h=0;h<c.length/2;h++){var l=e[2*h],d=e[2*h+1];c[2*h]=r*l+o*d+a,c[2*h+1]=i*l+s*d+u}if(this._roundPixels)for(var f=0;f<c.length;f++)c[f]=Math.round(c[f]);this.vertexDirty=t.vertexDirtyId}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new xv(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,Sv);for(var e=this.geometry.getBuffer("aVertexPosition").data,n=Cv.points,r=this.geometry.getIndex().data,i=r.length,o=4===this.drawMode?3:1,s=0;s+2<i;s+=o){var a=2*r[s],u=2*r[s+1],c=2*r[s+2];if(n[0]=e[a],n[1]=e[a+1],n[2]=e[u],n[3]=e[u+1],n[4]=e[c],n[5]=e[c+1],Cv.contains(Sv.x,Sv.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Object.defineProperties(e.prototype,n),e}(pp)).BATCHABLE_SIZE=100;var Av=function(t){function e(e,n){t.call(this,e[0]instanceof Hp?e[0]:e[0].texture),this._textures=null,this._durations=null,this.textures=e,this._autoUpdate=!1!==n,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this.playing=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={totalFrames:{configurable:!0},textures:{configurable:!0},currentFrame:{configurable:!0}};return e.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&bp.shared.remove(this.update,this))},e.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&bp.shared.add(this.update,this,25))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){var e=this.animationSpeed*t,n=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())},e.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copy(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var n=[],r=0;r<t.length;++r)n.push(Hp.from(t[r]));return new e(n)},e.fromImages=function(t){for(var n=[],r=0;r<t.length;++r)n.push(Hp.from(t[r]));return new e(n)},n.totalFrames.get=function(){return this._textures.length},n.textures.get=function(){return this._textures},n.textures.set=function(t){if(t[0]instanceof Hp)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this.gotoAndStop(0),this.updateTexture()},n.currentFrame.get=function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},Object.defineProperties(e.prototype,n),e}(ay);pg.registerPlugin("accessibility",mp),pg.registerPlugin("extract",Ig),pg.registerPlugin("interaction",Lg),pg.registerPlugin("particle",cv),pg.registerPlugin("prepare",Iy),pg.registerPlugin("batch",Cg),pg.registerPlugin("tilingSprite",yv),rv.registerPlugin(bv),rv.registerPlugin(dv),Ny.registerPlugin(Ep),Ny.registerPlugin(iv);class Iv{constructor(t,e){this.elementRef=t,this.ngZone=e,this.devicePixelRatio=window.devicePixelRatio||1,this.applicationOptions={}}init(){this.ngZone.runOutsideAngular(()=>{this.app=new Ny(this.applicationOptions)}),this.elementRef.nativeElement.appendChild(this.app.view),this.resize()}ngOnInit(){this.init()}resize(){const t=1/this.devicePixelRatio;this.app.renderer.resize(this.elementRef.nativeElement.offsetWidth*this.devicePixelRatio,this.elementRef.nativeElement.offsetHeight*this.devicePixelRatio),this.app.view.style.transform=`scale(${t})`,this.app.view.style.transformOrigin="top left"}destroy(){this.app.destroy()}ngOnDestroy(){this.destroy()}}var Ov=Hn({encapsulation:2,styles:[],data:{}});function Dv(t){return Xo(0,[],null,null)}class kv{constructor(){this.active=!1,this.onDestroyedSubject$=new x,this.shot=new xi,this.move=new xi,Gl(25).pipe(zl(this.onDestroyedSubject$),Zl(()=>this.active)).subscribe(()=>{this.pressedMove&&this.move.emit(this.pressedMove)})}ngOnInit(){this.active=!0}ngOnDestroy(){this.onDestroyedSubject$.next(!0),this.onDestroyedSubject$.complete()}visibilityChangeListener(){this.active=!document.hidden}clickShot(t){return t.preventDefault(),t.stopPropagation(),this.shot.emit(),!1}release(){this.pressedMove=void 0}press(t){this.pressedMove=t}touchmove(t){const e=t.touches.item(0),n=document.elementFromPoint(e.clientX,e.clientY);this.moveControllers.nativeElement.contains(n)&&n.classList.contains("button")&&this.press(n.classList.toString().replace("button","").trim())}touchstart(t){t.preventDefault(),t.stopPropagation();const e=t.touches.item(0),n=document.elementFromPoint(e.clientX,e.clientY);return this.moveControllers.nativeElement.contains(n)&&n.classList.contains("button")&&this.press(n.classList.toString().replace("button","").trim()),!1}handleKeyDownEvent(t){switch(t.key){case"ArrowLeft":this.pressedMove="left";break;case"ArrowRight":this.pressedMove="right";break;case"ArrowUp":this.pressedMove="up";break;case"ArrowDown":this.pressedMove="down";break;case" ":this.shot.emit()}}handleKeyUpEvent(t){switch(t.key){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.release()}}}var Pv=Hn({encapsulation:0,styles:[[".tank-move-controllers[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:10px;left:10px}.tank-move-controllers[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/arrow-controller.1d1c9cc0c5ca19e42365.png);width:64px;height:64px;position:relative;opacity:.7}.tank-move-controllers[_ngcontent-%COMP%]   .up[_ngcontent-%COMP%]{left:64px;top:64px}.tank-move-controllers[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{top:64px;left:128px;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.tank-move-controllers[_ngcontent-%COMP%]   .down[_ngcontent-%COMP%]{top:64px;left:64px;-webkit-transform:rotate(180deg);transform:rotate(180deg)}.tank-move-controllers[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{top:-64px;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.tank-shot-controller[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:62px;right:55px}.tank-shot-controller[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/shot-controller.c287a59665cc4e5ef601.png);width:85px;height:85px;position:relative;opacity:.7}"]],data:{}});function Nv(t){return Xo(0,[Bo(402653184,1,{moveControllers:0}),(t()(),No(1,0,[[1,0],["moveControllers",1]],null,4,"div",[["class","tank-move-controllers"]],null,null,null,null,null)),(t()(),No(2,0,null,null,0,"div",[["class","up button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchstart(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.release()&&r),"mousedown"===e&&(r=!1!==i.press("up")&&r),"mouseup"===e&&(r=!1!==i.release()&&r),"mouseleave"===e&&(r=!1!==i.release()&&r),r},null,null)),(t()(),No(3,0,null,null,0,"div",[["class","right button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchstart(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.release()&&r),"mousedown"===e&&(r=!1!==i.press("right")&&r),"mouseup"===e&&(r=!1!==i.release()&&r),"mouseleave"===e&&(r=!1!==i.release()&&r),r},null,null)),(t()(),No(4,0,null,null,0,"div",[["class","down button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchstart(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.release()&&r),"mousedown"===e&&(r=!1!==i.press("down")&&r),"mouseup"===e&&(r=!1!==i.release()&&r),"mouseleave"===e&&(r=!1!==i.release()&&r),r},null,null)),(t()(),No(5,0,null,null,0,"div",[["class","left button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchstart(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.release()&&r),"mousedown"===e&&(r=!1!==i.press("left")&&r),"mouseup"===e&&(r=!1!==i.release()&&r),"mouseleave"===e&&(r=!1!==i.release()&&r),r},null,null)),(t()(),No(6,0,null,null,1,"div",[["class","tank-shot-controller"]],null,null,null,null,null)),(t()(),No(7,0,null,null,0,"div",[["class","shot button"]],null,[[null,"touchstart"]],function(t,e,n){var r=!0;return"touchstart"===e&&(r=!1!==t.component.clickShot(n)&&r),r},null,null))],null,null)}var Mv=Object.keys,Rv=Array.isArray,Lv="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function Fv(t,e){return"object"!=typeof e?t:(Mv(e).forEach(function(n){t[n]=e[n]}),t)}var Bv=Object.getPrototypeOf,Uv={}.hasOwnProperty;function Vv(t,e){return Uv.call(t,e)}function jv(t,e){"function"==typeof e&&(e=e(Bv(t))),Mv(e).forEach(function(n){Gv(t,n,e[n])})}var qv=Object.defineProperty;function Gv(t,e,n,r){qv(t,e,Fv(n&&Vv(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Hv(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Gv(t.prototype,"constructor",t),{extend:jv.bind(null,t.prototype)}}}}var zv=Object.getOwnPropertyDescriptor,Wv=[].slice;function Kv(t,e,n){return Wv.call(t,e,n)}function Xv(t,e){return e(t)}function Qv(t){if(!t)throw new Error("Assertion Failed")}function Yv(t){Lv.setImmediate?setImmediate(t):setTimeout(t,0)}function Jv(t,e){return t.reduce(function(t,n,r){var i=e(n,r);return i&&(t[i[0]]=i[1]),t},{})}function $v(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Zv(t,e){if(Vv(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var o=Zv(t,e[r]);n.push(o)}return n}var s=e.indexOf(".");if(-1!==s){var a=t[e.substr(0,s)];return void 0===a?void 0:Zv(a,e.substr(s+1))}}function tb(t,e,n){if(t&&void 0!==e&&!("isFrozen"in Object&&Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){Qv("string"!=typeof n&&"length"in n);for(var r=0,i=e.length;r<i;++r)tb(t,e[r],n[r])}else{var o=e.indexOf(".");if(-1!==o){var s=e.substr(0,o),a=e.substr(o+1);if(""===a)void 0===n?delete t[s]:t[s]=n;else{var u=t[s];u||(u=t[s]={}),tb(u,a,n)}}else void 0===n?delete t[e]:t[e]=n}}function eb(t){var e={};for(var n in t)Vv(t,n)&&(e[n]=t[n]);return e}var nb=[].concat;function rb(t){return nb.apply([],t)}var ib="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(rb([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return Lv[t]}).map(function(t){return Lv[t]});function ob(t){if(!t||"object"!=typeof t)return t;var e;if(Rv(t)){e=[];for(var n=0,r=t.length;n<r;++n)e.push(ob(t[n]))}else if(ib.indexOf(t.constructor)>=0)e=t;else for(var i in e=t.constructor?Object.create(t.constructor.prototype):{},t)Vv(t,i)&&(e[i]=ob(t[i]));return e}function sb(t,e,n,r){return n=n||{},r=r||"",Mv(t).forEach(function(i){if(Vv(e,i)){var o=t[i],s=e[i];"object"==typeof o&&"object"==typeof s&&o&&s&&""+o.constructor==""+s.constructor?sb(o,s,n,r+i+"."):o!==s&&(n[r+i]=e[i])}else n[r+i]=void 0}),Mv(e).forEach(function(i){Vv(t,i)||(n[r+i]=e[i])}),n}var ab="undefined"!=typeof Symbol&&Symbol.iterator,ub=ab?function(t){var e;return null!=t&&(e=t[ab])&&e.apply(t)}:function(){return null},cb={};function hb(t){var e,n,r,i;if(1===arguments.length){if(Rv(t))return t.slice();if(this===cb&&"string"==typeof t)return[t];if(i=ub(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var lb="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function db(t,e){lb=t,fb=e}var fb=function(){return!0},pb=!new Error("").stack;function mb(){if(pb)try{throw new Error}catch(t){return t}return new Error}function gb(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(fb).map(function(t){return"\n"+t}).join("")):""}var yb=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],vb=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(yb),bb={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function wb(t,e){this._e=mb(),this.name=t,this.message=e}function _b(t,e,n,r){this._e=mb(),this.failures=e,this.failedKeys=r,this.successCount=n}function Eb(t,e){this._e=mb(),this.name="BulkError",this.failures=e,this.message=function(t,e){return t+". Errors: "+e.map(function(t){return t.toString()}).filter(function(t,e,n){return n.indexOf(t)===e}).join("\n")}(t,e)}Hv(wb).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+gb(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Hv(_b).from(wb),Hv(Eb).from(wb);var Tb=vb.reduce(function(t,e){return t[e]=e+"Error",t},{}),xb=wb,Sb=vb.reduce(function(t,e){var n=e+"Error";function r(t,r){this._e=mb(),this.name=n,t?"string"==typeof t?(this.message=t,this.inner=r||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=bb[e]||n,this.inner=null)}return Hv(r).from(xb),t[e]=r,t},{});Sb.Syntax=SyntaxError,Sb.Type=TypeError,Sb.Range=RangeError;var Cb=yb.reduce(function(t,e){return t[e+"Error"]=Sb[e],t},{}),Ab=vb.reduce(function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=Sb[e]),t},{});function Ib(){}function Ob(t){return t}function Db(t,e){return null==t||t===Ob?e:function(n){return e(t(n))}}function kb(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Pb(t,e){return t===Ib?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?kb(r,this.onsuccess):r),i&&(this.onerror=this.onerror?kb(i,this.onerror):i),void 0!==o?o:n}}function Nb(t,e){return t===Ib?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?kb(n,this.onsuccess):n),r&&(this.onerror=this.onerror?kb(r,this.onerror):r)}}function Mb(t,e){return t===Ib?e:function(n){var r=t.apply(this,arguments);Fv(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?kb(i,this.onsuccess):i),o&&(this.onerror=this.onerror?kb(o,this.onerror):o),void 0===r?void 0===s?void 0:s:Fv(r,s)}}function Rb(t,e){return t===Ib?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function Lb(t,e){return t===Ib?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}Ab.ModifyError=_b,Ab.DexieError=wb,Ab.BulkError=Eb;var Fb={},Bb=100,Ub=7,Vb=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(e){var t=Lv.Promise;return t?[t.resolve(),t.prototype,t.resolve()]:[]}}(),jb=Vb[0],qb=Vb[1],Gb=Vb[2],Hb=qb&&qb.then,zb=jb&&jb.constructor,Wb=Vb[3],Kb=!!Gb,Xb=!1,Qb=Gb?function(){Gb.then(gw)}:Lv.setImmediate?setImmediate.bind(null,gw):Lv.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){gw(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(gw,0)},Yb=function(t,e){ow.push([t,e]),$b&&(Qb(),$b=!1)},Jb=!0,$b=!0,Zb=[],tw=[],ew=null,nw=Ob,rw={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Uw,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{Uw(t[0],t[1])}catch(e){}})}},iw=rw,ow=[],sw=0,aw=[];function uw(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Ib,this._lib=!1;var e=this._PSD=iw;if(lb&&(this._stackHolder=mb(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==Fb)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&lw(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,n){try{n(function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&yw();n&&"function"==typeof n.then?t(e,function(t,e){n instanceof uw?n._then(t,e):n.then(t,e)}):(e._state=!0,e._value=n,dw(e)),r&&vw()}},lw.bind(null,e))}catch(r){lw(e,r)}}(this,t)}var cw={get:function(){var t=iw,e=Cw;function n(n,r){var i=this,o=!t.global&&(t!==iw||e!==Cw);o&&Dw();var s=new uw(function(e,s){fw(i,new hw(Lw(n,t,o),Lw(r,t,o),e,s,t))});return lb&&mw(s,this),s}return n.prototype=Fb,n},set:function(t){Gv(this,"then",t&&t.prototype===Fb?cw:{get:function(){return t},set:cw.set})}};function hw(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function lw(t,e){if(tw.push(e),null===t._state){var n=t._lib&&yw();e=nw(e),t._state=!1,t._value=e,lb&&null!==e&&"object"==typeof e&&!e._promise&&$v(function(){var n=function t(e,n){var r;return zv(e,n)||(r=Bv(e))&&t(r,n)}(e,"stack");e._promise=t,Gv(e,"stack",{get:function(){return Xb?n&&(n.get?n.get.apply(e):n.value):t.stack}})}),function(t){Zb.some(function(e){return e._value===t._value})||Zb.push(t)}(t),dw(t),n&&vw()}}function dw(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)fw(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),0===sw&&(++sw,Yb(function(){0==--sw&&bw()},[]))}function fw(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++sw,Yb(pw,[n,t,e])}else t._listeners.push(e)}function pw(t,e,n){try{ew=e;var r,i=e._value;e._state?r=t(i):(tw.length&&(tw=[]),r=t(i),-1===tw.indexOf(i)&&function(t){for(var e=Zb.length;e;)if(Zb[--e]._value===t._value)return void Zb.splice(e,1)}(e)),n.resolve(r)}catch(o){n.reject(o)}finally{ew=null,0==--sw&&bw(),--n.psd.ref||n.psd.finalize()}}function mw(t,e){var n=e?e._numPrev+1:0;n<Bb&&(t._prev=e,t._numPrev=n)}function gw(){yw()&&vw()}function yw(){var t=Jb;return Jb=!1,$b=!1,t}function vw(){var t,e,n;do{for(;ow.length>0;)for(t=ow,ow=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(ow.length>0);Jb=!0,$b=!0}function bw(){var t=Zb;Zb=[],t.forEach(function(t){t._PSD.onunhandled.call(null,t._value,t)});for(var e=aw.slice(0),n=e.length;n;)e[--n]()}function ww(t){return new uw(Fb,!1,t)}function _w(t,e){var n=iw;return function(){var r=yw(),i=iw;try{return Nw(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{Nw(i,!1),r&&vw()}}}jv(uw.prototype,{then:cw,_then:function(t,e){fw(this,new hw(null,null,t,e,iw))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return this.then(null,"function"==typeof e?function(t){return t instanceof e?n(t):ww(t)}:function(t){return t&&t.name===e?n(t):ww(t)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),ww(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Xb=!0;var t=function t(e,n,r){if(n.length===r)return n;var i="";if(!1===e._state){var o,s,a=e._value;null!=a?(o=a.name||"Error",s=a.message||a,i=gb(a,0)):(o=a,s=""),n.push(o+(s?": "+s:"")+i)}return lb&&((i=gb(e._stackHolder,2))&&-1===n.indexOf(i)&&n.push(i),e._prev&&t(e._prev,n,r)),n}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{Xb=!1}}},timeout:function(t,e){var n=this;return t<1/0?new uw(function(r,i){var o=setTimeout(function(){return i(new Sb.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&Gv(uw.prototype,Symbol.toStringTag,"Promise"),rw.env=Mw(),jv(uw,{all:function(){var t=hb.apply(null,arguments).map(kw);return new uw(function(e,n){0===t.length&&e([]);var r=t.length;t.forEach(function(i,o){return uw.resolve(i).then(function(n){t[o]=n,--r||e(t)},n)})})},resolve:function(t){if(t instanceof uw)return t;if(t&&"function"==typeof t.then)return new uw(function(e,n){t.then(e,n)});var e=new uw(Fb,!0,t);return mw(e,ew),e},reject:ww,race:function(){var t=hb.apply(null,arguments).map(kw);return new uw(function(e,n){t.map(function(t){return uw.resolve(t).then(e,n)})})},PSD:{get:function(){return iw},set:function(t){return iw=t}},newPSD:Iw,usePSD:Rw,scheduler:{get:function(){return Yb},set:function(t){Yb=t}},rejectionMapper:{get:function(){return nw},set:function(t){nw=t}},follow:function(t,e){return new uw(function(n,r){return Iw(function(e,n){var r=iw;r.unhandleds=[],r.onunhandled=n,r.finalize=kb(function(){var t=this;aw.push(function r(){0===t.unhandleds.length?e():n(t.unhandleds[0]),aw.splice(aw.indexOf(r),1)}),++sw,Yb(function(){0==--sw&&bw()},[])},r.finalize),t()},e,n,r)})}});var Ew={awaits:0,echoes:0,id:0},Tw=0,xw=[],Sw=0,Cw=0,Aw=0;function Iw(t,e,n,r){var i=iw,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++Aw;var s=rw.env;o.env=Kb?{Promise:uw,PromiseProp:{value:uw,configurable:!0,writable:!0},all:uw.all,race:uw.race,resolve:uw.resolve,reject:uw.reject,nthen:Fw(s.nthen,o),gthen:Fw(s.gthen,o)}:{},e&&Fv(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Rw(o,t,n,r);return 0===o.ref&&o.finalize(),a}function Ow(){return Ew.id||(Ew.id=++Tw),++Ew.awaits,Ew.echoes+=Ub,Ew.id}function Dw(t){!Ew.awaits||t&&t!==Ew.id||(0==--Ew.awaits&&(Ew.id=0),Ew.echoes=Ew.awaits*Ub)}function kw(t){return Ew.echoes&&t&&t.constructor===zb?(Ow(),t.then(function(t){return Dw(),t},function(t){return Dw(),Vw(t)})):t}function Pw(){var t=xw[xw.length-1];xw.pop(),Nw(t,!1)}function Nw(t,e){var n,r=iw;if((e?!Ew.echoes||Sw++&&t===iw:!Sw||--Sw&&t===iw)||(n=e?(function(t){++Cw,Ew.echoes&&0!=--Ew.echoes||(Ew.echoes=Ew.id=0),xw.push(iw),Nw(t,!0)}).bind(null,t):Pw,Hb.call(jb,n)),t!==iw&&(iw=t,r===rw&&(rw.env=Mw()),Kb)){var i=rw.env.Promise,o=t.env;qb.then=o.nthen,i.prototype.then=o.gthen,(r.global||t.global)&&(Object.defineProperty(Lv,"Promise",o.PromiseProp),i.all=o.all,i.race=o.race,i.resolve=o.resolve,i.reject=o.reject)}}function Mw(){var t=Lv.Promise;return Kb?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(Lv,"Promise"),all:t.all,race:t.race,resolve:t.resolve,reject:t.reject,nthen:qb.then,gthen:t.prototype.then}:{}}function Rw(t,e,n,r,i){var o=iw;try{return Nw(t,!0),e(n,r,i)}finally{Nw(o,!1)}}function Lw(t,e,n){return"function"!=typeof t?t:function(){var r=iw;n&&Ow(),Nw(e,!0);try{return t.apply(this,arguments)}finally{Nw(r,!1)}}}function Fw(t,e){return function(n,r){return t.call(this,Lw(n,e,!1),Lw(r,e,!1))}}var Bw="unhandledrejection";function Uw(t,e){var n;try{n=e.onuncatched(t)}catch(o){}if(!1!==n)try{var r,i={promise:e,reason:t};if(Lv.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Bw,!0,!0),Fv(r,i)):Lv.CustomEvent&&Fv(r=new CustomEvent(Bw,{detail:i}),i),r&&Lv.dispatchEvent&&(dispatchEvent(r),!Lv.PromiseRejectionEvent&&Lv.onunhandledrejection))try{Lv.onunhandledrejection(r)}catch(s){}r.defaultPrevented||console.warn("Unhandled rejection: "+(t.stack||t))}catch(o){}}var Vw=uw.reject;function jw(t){var e={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[n].subscribe.apply(null,o),t}if("string"==typeof n)return e[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(t,r,i){if("object"!=typeof t){var s;r||(r=Rb),i||(i=Ib);var a={subscribers:[],fire:i,subscribe:function(t){-1===a.subscribers.indexOf(t)&&(a.subscribers.push(t),a.fire=r(a.fire,t))},unsubscribe:function(t){a.subscribers=a.subscribers.filter(function(e){return e!==t}),a.fire=a.subscribers.reduce(r,i)}};return e[t]=n[t]=a,a}Mv(s=t).forEach(function(t){var e=s[t];if(Rv(e))o(t,s[t][0],s[t][1]);else{if("asap"!==e)throw new Sb.InvalidArgument("Invalid event config");var n=o(t,Ob,function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];n.subscribers.forEach(function(t){Yv(function(){t.apply(null,e)})})})}})}}var qw,Gw=String.fromCharCode(65535),Hw=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(t){return Gw}}(),zw=-1/0,Ww="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Kw="String expected.",Xw=[],Qw="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Yw=Qw,Jw=Qw,$w=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)};function Zw(t,e){var n,r,i,o,s,a=Zw.dependencies,u=Fv({addons:Zw.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},e),c=u.addons,h=u.autoOpen,l=u.indexedDB,d=u.IDBKeyRange,f=this._dbSchema={},p=[],m=[],g={},y=null,v=null,b=!1,w=null,_=!1,E="readwrite",T=this,x=new uw(function(t){n=t}),S=new uw(function(t,e){r=e}),C=!0,A=!!h_(l);function I(t){this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function O(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(t){D(i,t)}),i}function D(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function k(t,e,n){var r=arguments.length;if(r<2)throw new Sb.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,rb(i),n]}function P(t,e,n){this.name=t,this.schema=e,this._tx=n,this.hook=g[t]?g[t].hook:jw(null,{creating:[Pb,Ib],reading:[Db,Ob],updating:[Mb,Ib],deleting:[Nb,Ib]})}function N(t,e,n){return(n?i_:n_)(function(n){t.push(n),e&&e()})}function M(t,e,n,r,i){return new uw(function(o,s){var a=n.length,u=a-1;if(0===a)return o();if(r){var c,h=i_(s),l=e_(null);$v(function(){for(var r=0;r<a;++r){var s=n[r];i.call(c={onsuccess:null,onerror:null},s[0],s[1],e);var d=t.delete(s[0]);d._hookCtx=c,d.onerror=h,d.onsuccess=r===u?e_(o):l}},function(t){throw c.onerror&&c.onerror(t),t})}else for(var d=0;d<a;++d){var f=t.delete(n[d]);f.onerror=n_(s),d===u&&(f.onsuccess=_w(function(){return o()}))}})}function R(t,e,n,r){var i=this;this.db=T,this.mode=t,this.storeNames=e,this.idbtrans=null,this.on=jw(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new uw(function(t,e){i._resolve=t,i._reject=e}),this._completion.then(function(){i.active=!1,i.on.complete.fire()},function(t){var e=i.active;return i.active=!1,i.on.error.fire(t),i.parent?i.parent._reject(t):e&&i.idbtrans&&i.idbtrans.abort(),Vw(t)})}function L(t,e,n){this._ctx={table:t,index:":id"===e?null:e,or:n}}function F(t,e){var n=null,r=null;if(e)try{n=e()}catch(s){r=s}var i=t._ctx,o=i.table;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:o.hook.reading.fire}}function B(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function U(t,e){return t._cfg.version-e._cfg.version}function V(t,e,n){e.forEach(function(e){var r=n[e];t.forEach(function(t){e in t||(t===R.prototype||t instanceof R?Gv(t,e,{get:function(){return this.table(e)}}):t[e]=new P(e,r))})})}function j(t,e,n,r,i,o){var s=_w(o?function(t,e,r){return n(o(t),e,r)}:n,i);t.onerror||(t.onerror=n_(i)),t.onsuccess=function(t,e){return function(){try{t.apply(this,arguments)}catch(n){e(n)}}}(e?function(){var n=t.result;if(n){var o=function(){n.continue()};e(n,function(t){o=t},r,i)&&s(n.value,n,function(t){o=t}),o()}else r()}:function(){var e=t.result;if(e){var n=function(){e.continue()};s(e.value,e,function(t){n=t}),n()}else r()},i)}function q(t,e){return l.cmp(t,e)}function G(t,e){return q(t,e)>0?t:e}function H(t,e){return l.cmp(t,e)}function z(t,e){return l.cmp(e,t)}function W(t,e){return t<e?-1:t===e?0:1}function K(t,e){return t>e?-1:t===e?0:1}function X(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}function Q(t,e){for(var n=e.db.objectStoreNames,r=0;r<n.length;++r){var o=n[r],s=e.objectStore(o);i="getAll"in s;for(var a=0;a<s.indexNames.length;++a){var u=s.indexNames[a],c=s.index(u).keyPath,h="string"==typeof c?c:"["+Kv(c).join("+")+"]";if(t[o]){var l=t[o].idxByName[h];l&&(l.name=u)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Lv.WorkerGlobalScope&&Lv instanceof Lv.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i=!1)}function Y(t){T.on("blocked").fire(t),Xw.filter(function(t){return t.name===T.name&&t!==T&&!t._vcFired}).map(function(e){return e.on("versionchange").fire(t)})}this.version=function(t){if(y||b)throw new Sb.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=p.filter(function(e){return e._cfg.version===t})[0];return e||(e=new I(t),p.push(e),p.sort(U),C=!1,e)},Fv(I.prototype,{stores:function(t){this._cfg.storesSource=this._cfg.storesSource?Fv(this._cfg.storesSource,t):t;var e={};p.forEach(function(t){Fv(e,t._cfg.storesSource)});var n=this._cfg.dbschema={};return this._parseStoresSpec(e,n),f=T._dbSchema=n,[g,T,R.prototype].forEach(function(t){for(var e in t)t[e]instanceof P&&delete t[e]}),V([g,T,R.prototype,this._cfg.tables],Mv(n),n),m=Mv(n),this},upgrade:function(t){return this._cfg.contentUpgrade=t,this},_parseStoresSpec:function(t,e){Mv(t).forEach(function(n){if(null!==t[n]){var r={},i=(s=[],t[n].split(",").forEach(function(t){var e=(t=t.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(e)?e.match(/^\[(.*)\]$/)[1].split("+"):e;s.push(new a_(e,n||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),Rv(n),/\./.test(t)))}),s),o=i.shift();if(o.multi)throw new Sb.Schema("Primary key cannot be multi-valued");o.keyPath&&tb(r,o.keyPath,o.auto?0:o.keyPath),i.forEach(function(t){if(t.auto)throw new Sb.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new Sb.Schema("Index must have a name and cannot be an empty string");tb(r,t.keyPath,t.compound?t.keyPath.map(function(){return""}):"")}),e[n]=new u_(n,o,i,r)}var s})}}),this._allTables=g,this._createTransaction=function(t,e,n,r){return new R(t,e,n,r)},this._whenReady=function(t){return _||iw.letThrough?t():new uw(function(t,e){if(!b){if(!h)return void e(new Sb.DatabaseClosed);T.open().catch(Ib)}x.then(t,e)}).then(t)},this.verno=0,this.open=function(){if(b||y)return x.then(function(){return v?Vw(v):T});lb&&(S._stackHolder=mb()),b=!0,v=null,_=!1;var e=n,r=null;return uw.race([S,new uw(function(e,n){if(!l)throw new Sb.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var i=C?l.open(t):l.open(t,Math.round(10*T.verno));if(!i)throw new Sb.MissingAPI("IndexedDB API not available");i.onerror=n_(n),i.onblocked=_w(Y),i.onupgradeneeded=_w(function(e){if(r=i.transaction,C&&!T._allowEmptyDB){i.onerror=o_,r.abort(),i.result.close();var o=l.deleteDatabase(t);o.onsuccess=o.onerror=_w(function(){n(new Sb.NoSuchDatabase("Database "+t+" doesnt exist"))})}else r.onerror=n_(n),function(t,e,n){var r=T._createTransaction(E,m,f);r.create(e),r._completion.catch(n);var i=r._reject.bind(r);Iw(function(){iw.trans=r,0===t?(Mv(f).forEach(function(t){O(e,t,f[t].primKey,f[t].indexes)}),uw.follow(function(){return T.on.populate.fire(r)}).catch(i)):function(t,e,n){var r=[],i=p.filter(function(e){return e._cfg.version===t})[0];if(!i)throw new Sb.Upgrade("Dexie specification of currently installed DB version is missing");f=T._dbSchema=i._cfg.dbschema;var o=!1;return p.filter(function(e){return e._cfg.version>t}).forEach(function(t){r.push(function(){var r=f,i=t._cfg.dbschema;Q(r,n),Q(i,n),f=T._dbSchema=i;var s=function(t,e){var n={del:[],add:[],change:[]};for(var r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(i){var s={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)s.recreate=!0,n.change.push(s);else{var a=i.idxByName,u=o.idxByName;for(var c in a)u[c]||s.del.push(c);for(c in u){var h=a[c],l=u[c];h?h.src!==l.src&&s.change.push(l):s.add.push(l)}(s.del.length>0||s.add.length>0||s.change.length>0)&&n.change.push(s)}}else n.add.push([r,o])}return n}(r,i);if(s.add.forEach(function(t){O(n,t[0],t[1].primKey,t[1].indexes)}),s.change.forEach(function(t){if(t.recreate)throw new Sb.Upgrade("Not yet support for changing primary key");var e=n.objectStore(t.name);t.add.forEach(function(t){D(e,t)}),t.change.forEach(function(t){e.deleteIndex(t.name),D(e,t)}),t.del.forEach(function(t){e.deleteIndex(t)})}),t._cfg.contentUpgrade)return o=!0,uw.follow(function(){t._cfg.contentUpgrade(e)})}),r.push(function(e){o&&Yw||function(t,e){for(var n=0;n<e.db.objectStoreNames.length;++n){var r=e.db.objectStoreNames[n];null==t[r]&&e.db.deleteObjectStore(r)}}(t._cfg.dbschema,e)})}),function t(){return r.length?uw.resolve(r.shift()(e.idbtrans)).then(t):uw.resolve()}().then(function(){!function(t,e){Mv(t).forEach(function(n){e.db.objectStoreNames.contains(n)||O(e,n,t[n].primKey,t[n].indexes)})}(f,n)})}(t,r,e).catch(i)})}((e.oldVersion>Math.pow(2,62)?0:e.oldVersion)/10,r,n)},n),i.onsuccess=_w(function(){if(r=null,y=i.result,Xw.push(T),C)!function(){if(T.verno=y.version/10,T._dbSchema=f={},0!==(m=Kv(y.objectStoreNames,0)).length){var t=y.transaction(c_(m),"readonly");m.forEach(function(e){for(var n=t.objectStore(e),r=n.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf("."),o=new a_(r,r||"",!1,!1,!!n.autoIncrement,r&&"string"!=typeof r,i),s=[],a=0;a<n.indexNames.length;++a){var u=n.index(n.indexNames[a]);i=(r=u.keyPath)&&"string"==typeof r&&-1!==r.indexOf(".");var c=new a_(u.name,r,!!u.unique,!!u.multiEntry,!1,r&&"string"!=typeof r,i);s.push(c)}f[e]=new u_(e,o,s,{})}),V([g],Mv(f),f)}}();else if(y.objectStoreNames.length>0)try{Q(f,y.transaction(c_(y.objectStoreNames),"readonly"))}catch(n){}y.onversionchange=_w(function(t){T._vcFired=!0,T.on("versionchange").fire(t)}),A||"__dbnames"===t||qw.dbnames.put({name:t}).catch(Ib),e()},n)})]).then(function(){return w=[],uw.resolve(Zw.vip(T.on.ready.fire)).then(function t(){if(w.length>0){var e=w.reduce(Lb,Ib);return w=[],uw.resolve(Zw.vip(e)).then(t)}})}).finally(function(){w=null}).then(function(){return b=!1,T}).catch(function(t){try{r&&r.abort()}catch(e){}return b=!1,T.close(),Vw(v=t)}).finally(function(){_=!0,e()})},this.close=function(){var t=Xw.indexOf(T);if(t>=0&&Xw.splice(t,1),y){try{y.close()}catch(e){}y=null}h=!1,v=new Sb.DatabaseClosed,b&&r(v),x=new uw(function(t){n=t}),S=new uw(function(t,e){r=e})},this.delete=function(){var e=arguments.length>0;return new uw(function(n,r){if(e)throw new Sb.InvalidArgument("Arguments not allowed in db.delete()");function i(){T.close();var e=l.deleteDatabase(t);e.onsuccess=_w(function(){A||qw.dbnames.delete(t).catch(Ib),n()}),e.onerror=n_(r),e.onblocked=Y}b?x.then(i):i()})},this.backendDB=function(){return y},this.isOpen=function(){return null!==y},this.hasBeenClosed=function(){return v&&v instanceof Sb.DatabaseClosed},this.hasFailed=function(){return null!==v},this.dynamicallyOpened=function(){return C},this.name=t,jv(this,{tables:{get:function(){return Mv(g).map(function(t){return g[t]})}}}),this.on=jw(this,"populate","blocked","versionchange",{ready:[Lb,Ib]}),this.on.ready.subscribe=Xv(this.on.ready.subscribe,function(t){return function(e,n){Zw.vip(function(){_?(v||uw.resolve().then(e),n&&t(e)):w?(w.push(e),n&&t(e)):(t(e),n||t(function t(){T.on.ready.unsubscribe(e),T.on.ready.unsubscribe(t)}))})}}),this.transaction=function(){var t=k.apply(this,arguments);return this._transaction.apply(this,t)},this._transaction=function(t,e,n){var r=iw.trans;r&&r.db===T&&-1===t.indexOf("!")||(r=null);var i=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{var o=e.map(function(t){var e=t instanceof P?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e});if("r"==t||"readonly"==t)t="readonly";else{if("rw"!=t&&t!=E)throw new Sb.InvalidArgument("Invalid transaction mode: "+t);t=E}if(r){if("readonly"===r.mode&&t===E){if(!i)throw new Sb.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach(function(t){if(r&&-1===r.storeNames.indexOf(t)){if(!i)throw new Sb.SubTransaction("Table "+t+" not included in parent transaction.");r=null}}),i&&r&&!r.active&&(r=null)}}catch(a){return r?r._promise(null,function(t,e){e(a)}):Vw(a)}return r?r._promise(t,s,"lock"):iw.trans?Rw(iw.transless,function(){return T._whenReady(s)}):T._whenReady(s);function s(){return uw.resolve().then(function(){var e,i=iw.transless||iw,s=T._createTransaction(t,o,f,r),a={trans:s,transless:i};r?s.idbtrans=r.idbtrans:s.create(),n.constructor===Wb&&Ow();var u=uw.follow(function(){if(e=n.call(s,s))if(e.constructor===zb){var t=Dw.bind(null,null);e.then(t,t)}else"function"==typeof e.next&&"function"==typeof e.throw&&(e=s_(e))},a);return(e&&"function"==typeof e.then?uw.resolve(e).then(function(t){return s.active?t:Vw(new Sb.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):u.then(function(){return e})).then(function(t){return r&&s._resolve(),s._completion.then(function(){return t})}).catch(function(t){return s._reject(t),Vw(t)})})}},this.table=function(t){if(!Vv(g,t))throw new Sb.InvalidTable("Table "+t+" does not exist");return g[t]},jv(P.prototype,{_trans:function(t,e,n){var r=this._tx||iw.trans;return r&&r.db===T?r===iw.trans?r._promise(t,e,n):Iw(function(){return r._promise(t,e,n)},{trans:r,transless:iw.transless||iw}):function t(e,n,r){if(_||iw.letThrough){var i=T._createTransaction(e,n,f);try{i.create()}catch(o){return Vw(o)}return i._promise(e,function(t,e){return Iw(function(){return iw.trans=i,r(t,e,i)})}).then(function(t){return i._completion.then(function(){return t})})}if(!b){if(!h)return Vw(new Sb.DatabaseClosed);T.open().catch(Ib)}return x.then(function(){return t(e,n,r)})}(t,[this.name],e)},_idbstore:function(t,e,n){var r=this.name;return this._trans(t,function(t,n,i){if(-1===i.storeNames.indexOf(r))throw new Sb.NotFound("Table"+r+" not part of transaction");return e(t,n,i.idbtrans.objectStore(r),i)},n)},get:function(t,e){if(t&&t.constructor===Object)return this.where(t).first(e);var n=this;return this._idbstore("readonly",function(e,r,i){var o=i.get(t);o.onerror=n_(r),o.onsuccess=_w(function(){e(n.hook.reading.fire(o.result))},r)}).then(e)},where:function(t){if("string"==typeof t)return new L(this,t);if(Rv(t))return new L(this,"["+t.join("+")+"]");var e=Mv(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&e.every(function(e){return t.keyPath.indexOf(e)>=0})&&t.keyPath.every(function(t){return e.indexOf(t)>=0})})[0];if(n&&Hw!==Gw)return this.where(n.name).equals(n.keyPath.map(function(e){return t[e]}));n||console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a compound index ["+e.join("+")+"]");var r=this.schema.idxByName,i=e.reduce(function(e,n){return[e[0]||r[n],e[0]||!r[n]?X(e[1],function(e){return""+Zv(e,n)==""+t[n]}):e[1]]},[null,null]),o=i[0];return o?this.where(o.name).equals(t[o.keyPath]).filter(i[1]):n?this.filter(i[1]):this.where(e).equals("")},count:function(t){return this.toCollection().count(t)},offset:function(t){return this.toCollection().offset(t)},limit:function(t){return this.toCollection().limit(t)},reverse:function(){return this.toCollection().reverse()},filter:function(t){return this.toCollection().and(t)},each:function(t){return this.toCollection().each(t)},toArray:function(t){return this.toCollection().toArray(t)},orderBy:function(t){return new F(new L(this,Rv(t)?"["+t.join("+")+"]":t))},toCollection:function(){return new F(new L(this))},mapToClass:function(t,e){this.schema.mappedClass=t;var n=Object.create(t.prototype);e&&t_(n,e),this.schema.instanceTemplate=n;var r=function(e){if(!e)return e;var n=Object.create(t.prototype);for(var r in e)if(Vv(e,r))try{n[r]=e[r]}catch(i){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t},defineClass:function(t){return this.mapToClass(Zw.defineClass(t),t)},bulkDelete:function(t){return this.hook.deleting.fire===Ib?this._idbstore(E,function(e,n,r,i){e(M(r,i,t,!1,Ib))}):this.where(":id").anyOf(t).delete().then(function(){})},bulkPut:function(t,e){var n=this;return this._idbstore(E,function(r,i,o){if(!o.keyPath&&!n.schema.primKey.auto&&!e)throw new Sb.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(o.keyPath&&e)throw new Sb.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new Sb.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return r();var s,a,u=function(t){0===c.length?r(t):i(new Eb(n.name+".bulkPut(): "+c.length+" of "+h+" operations failed",c))},c=[],h=t.length,l=n;if(n.hook.creating.fire===Ib&&n.hook.updating.fire===Ib){a=N(c);for(var d=0,f=t.length;d<f;++d)(s=e?o.put(t[d],e[d]):o.put(t[d])).onerror=a;s.onerror=N(c,u),s.onsuccess=r_(u)}else{var p=e||o.keyPath&&t.map(function(t){return Zv(t,o.keyPath)}),m=p&&Jv(p,function(e,n){return null!=e&&[e,t[n]]});(p?l.where(":id").anyOf(p.filter(function(t){return null!=t})).modify(function(){this.value=m[this.primKey],m[this.primKey]=null}).catch(_b,function(t){c=t.failures}).then(function(){for(var n=[],r=e&&[],i=p.length-1;i>=0;--i){var o=p[i];(null==o||m[o])&&(n.push(t[i]),e&&r.push(o),null!=o&&(m[o]=null))}return n.reverse(),e&&r.reverse(),l.bulkAdd(n,r)}).then(function(t){var e=p[p.length-1];return null!=e?e:t}):l.bulkAdd(t)).then(u).catch(Eb,function(t){c=c.concat(t.failures),u()}).catch(i)}},"locked")},bulkAdd:function(t,e){var n=this,r=this.hook.creating.fire;return this._idbstore(E,function(i,o,s,a){if(!s.keyPath&&!n.schema.primKey.auto&&!e)throw new Sb.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(s.keyPath&&e)throw new Sb.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new Sb.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return i();function u(t){0===d.length?i(t):o(new Eb(n.name+".bulkAdd(): "+d.length+" of "+f+" operations failed",d))}var c,h,l,d=[],f=t.length;if(r!==Ib){var p,m=s.keyPath;h=N(d,null,!0),l=e_(null),$v(function(){for(var n=0,i=t.length;n<i;++n){p={onerror:null,onsuccess:null};var o=e&&e[n],u=t[n],d=e?o:m?Zv(u,m):void 0,f=r.call(p,d,u,a);null==d&&null!=f&&(m?tb(u=ob(u),m,f):o=f),(c=null!=o?s.add(u,o):s.add(u))._hookCtx=p,n<i-1&&(c.onerror=h,p.onsuccess&&(c.onsuccess=l))}},function(t){throw p.onerror&&p.onerror(t),t}),c.onerror=N(d,u,!0),c.onsuccess=e_(u)}else{h=N(d);for(var g=0,y=t.length;g<y;++g)(c=e?s.add(t[g],e[g]):s.add(t[g])).onerror=h;c.onerror=N(d,u),c.onsuccess=r_(u)}})},add:function(t,e){var n=this.hook.creating.fire;return this._idbstore(E,function(r,i,o,s){var a={onsuccess:null,onerror:null};if(n!==Ib){var u=null!=e?e:o.keyPath?Zv(t,o.keyPath):void 0,c=n.call(a,u,t,s);null==u&&null!=c&&(o.keyPath?tb(t,o.keyPath,c):e=c)}try{var h=null!=e?o.add(t,e):o.add(t);h._hookCtx=a,h.onerror=i_(i),h.onsuccess=e_(function(e){var n=o.keyPath;n&&tb(t,n,e),r(e)})}catch(l){throw a.onerror&&a.onerror(l),l}})},put:function(t,e){var n=this;if(this.hook.creating.fire!==Ib||this.hook.updating.fire!==Ib){var r=this.schema.primKey.keyPath,i=void 0!==e?e:r&&Zv(t,r);return null==i?this.add(t):(t=ob(t),this._trans(E,function(){return n.where(":id").equals(i).modify(function(){this.value=t}).then(function(r){return 0===r?n.add(t,e):i})},"locked"))}return this._idbstore(E,function(n,r,i){var o=void 0!==e?i.put(t,e):i.put(t);o.onerror=n_(r),o.onsuccess=_w(function(e){var r=i.keyPath;r&&tb(t,r,e.target.result),n(o.result)})})},delete:function(t){return this.hook.deleting.subscribers.length?this.where(":id").equals(t).delete():this._idbstore(E,function(e,n,r){var i=r.delete(t);i.onerror=n_(n),i.onsuccess=_w(function(){e(i.result)})})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(E,function(t,e,n){var r=n.clear();r.onerror=n_(e),r.onsuccess=_w(function(){t(r.result)})})},update:function(t,e){if("object"!=typeof e||Rv(e))throw new Sb.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||Rv(t))return this.where(":id").equals(t).modify(e);Mv(e).forEach(function(n){tb(t,n,e[n])});var n=Zv(t,this.schema.primKey.keyPath);return void 0===n?Vw(new Sb.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(e)}}),jv(R.prototype,{_lock:function(){return Qv(!iw.global),++this._reculock,1!==this._reculock||iw.global||(iw.lockOwnerFor=this),this},_unlock:function(){if(Qv(!iw.global),0==--this._reculock)for(iw.global||(iw.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Rw(t[1],t[0])}catch(e){}}return this},_locked:function(){return this._reculock&&iw.lockOwnerFor!==this},create:function(t){var e=this;if(!this.mode)return this;if(Qv(!this.idbtrans),!t&&!y)switch(v&&v.name){case"DatabaseClosedError":throw new Sb.DatabaseClosed(v);case"MissingAPIError":throw new Sb.MissingAPI(v.message,v);default:throw new Sb.OpenFailed(v)}if(!this.active)throw new Sb.TransactionInactive;return Qv(null===this._completion._state),(t=this.idbtrans=t||y.transaction(c_(this.storeNames),this.mode)).onerror=_w(function(n){o_(n),e._reject(t.error)}),t.onabort=_w(function(n){o_(n),e.active&&e._reject(new Sb.Abort(t.error)),e.active=!1,e.on("abort").fire(n)}),t.oncomplete=_w(function(){e.active=!1,e._resolve()}),this},_promise:function(t,e,n){var r=this;if(t===E&&this.mode!==E)return Vw(new Sb.ReadOnly("Transaction is readonly"));if(!this.active)return Vw(new Sb.TransactionInactive);if(this._locked())return new uw(function(i,o){r._blockedFuncs.push([function(){r._promise(t,e,n).then(i,o)},iw])});if(n)return Iw(function(){var t=new uw(function(t,n){r._lock();var i=e(t,n,r);i&&i.then&&i.then(t,n)});return t.finally(function(){return r._unlock()}),t._lib=!0,t});var i=new uw(function(t,n){var i=e(t,n,r);i&&i.then&&i.then(t,n)});return i._lib=!0,i},_root:function(){return this.parent?this.parent._root():this},waitFor:function(t){var e=this._root();if(t=uw.resolve(t),e._waitingFor)e._waitingFor=e._waitingFor.then(function(){return t});else{e._waitingFor=t,e._waitingQueue=[];var n=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(n.get(-1/0).onsuccess=t)}()}var r=e._waitingFor;return new uw(function(n,i){t.then(function(t){return e._waitingQueue.push(_w(n.bind(null,t)))},function(t){return e._waitingQueue.push(_w(i.bind(null,t)))}).finally(function(){e._waitingFor===r&&(e._waitingFor=null)})})},abort:function(){this.active&&this._reject(new Sb.Abort),this.active=!1},tables:{get:(o="Transaction.tables",s=function(){return g},function(){return console.warn(o+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+gb(mb(),1)),s.apply(this,arguments)})},table:function(t){return new P(t,T.table(t).schema,this)}}),jv(L.prototype,function(){function t(t,e,n){var r=t instanceof L?new F(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function e(t){return new F(t,function(){return d.only("")}).limit(0)}function n(t,e,n,r,i,o){for(var s=Math.min(t.length,r.length),a=-1,u=0;u<s;++u){var c=e[u];if(c!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;i(t[u],c)<0&&(a=u)}return s<r.length&&"next"===o?t+n.substr(t.length):s<t.length&&"prev"===o?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function r(e,r,i,o){var s,a,u,c,h,l,f,p=i.length;if(!i.every(function(t){return"string"==typeof t}))return t(e,Kw);function m(t){s=function(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}(t),a=function(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}(t),u="next"===t?W:K;var e=i.map(function(t){return{lower:a(t),upper:s(t)}}).sort(function(t,e){return u(t.lower,e.lower)});c=e.map(function(t){return t.upper}),h=e.map(function(t){return t.lower}),l=t,f="next"===t?"":o}m("next");var g=new F(e,function(){return d.bound(c[0],h[p-1]+o)});g._ondirectionchange=function(t){m(t)};var y=0;return g._addAlgorithm(function(t,e,i){var o=t.key;if("string"!=typeof o)return!1;var s=a(o);if(r(s,h,y))return!0;for(var d=null,m=y;m<p;++m){var g=n(o,s,c[m],h[m],u,l);null===g&&null===d?y=m+1:(null===d||u(d,g)>0)&&(d=g)}return e(null!==d?function(){t.continue(d+f)}:i),!1}),g}return{between:function(n,r,i,o){i=!1!==i,o=!0===o;try{return q(n,r)>0||0===q(n,r)&&(i||o)&&(!i||!o)?e(this):new F(this,function(){return d.bound(n,r,!i,!o)})}catch(s){return t(this,Ww)}},equals:function(t){return new F(this,function(){return d.only(t)})},above:function(t){return new F(this,function(){return d.lowerBound(t,!0)})},aboveOrEqual:function(t){return new F(this,function(){return d.lowerBound(t)})},below:function(t){return new F(this,function(){return d.upperBound(t,!0)})},belowOrEqual:function(t){return new F(this,function(){return d.upperBound(t)})},startsWith:function(e){return"string"!=typeof e?t(this,Kw):this.between(e,e+Gw,!0,!0)},startsWithIgnoreCase:function(t){return""===t?this.startsWith(t):r(this,function(t,e){return 0===t.indexOf(e[0])},[t],Gw)},equalsIgnoreCase:function(t){return r(this,function(t,e){return t===e[0]},[t],"")},anyOfIgnoreCase:function(){var t=hb.apply(cb,arguments);return 0===t.length?e(this):r(this,function(t,e){return-1!==e.indexOf(t)},t,"")},startsWithAnyOfIgnoreCase:function(){var t=hb.apply(cb,arguments);return 0===t.length?e(this):r(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},t,Gw)},anyOf:function(){var n=hb.apply(cb,arguments),r=H;try{n.sort(r)}catch(s){return t(this,Ww)}if(0===n.length)return e(this);var i=new F(this,function(){return d.bound(n[0],n[n.length-1])});i._ondirectionchange=function(t){n.sort(r="next"===t?H:z)};var o=0;return i._addAlgorithm(function(t,e,i){for(var s=t.key;r(s,n[o])>0;)if(++o===n.length)return e(i),!1;return 0===r(s,n[o])||(e(function(){t.continue(n[o])}),!1)}),i},notEqual:function(t){return this.inAnyRange([[zw,t],[t,Hw]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var e=hb.apply(cb,arguments);if(0===e.length)return new F(this);try{e.sort(H)}catch(r){return t(this,Ww)}var n=e.reduce(function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[zw,e]]},null);return n.push([e[e.length-1],Hw]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){if(0===n.length)return e(this);if(!n.every(function(t){return void 0!==t[0]&&void 0!==t[1]&&H(t[0],t[1])<=0}))return t(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Sb.InvalidArgument);var i,o=!r||!1!==r.includeLowers,s=r&&!0===r.includeUppers,a=H;function u(t,e){return a(t[0],e[0])}try{(i=n.reduce(function(t,e){for(var n=0,r=t.length;n<r;++n){var i=t[n];if(q(e[0],i[1])<0&&q(e[1],i[0])>0){i[0]=q(o=i[0],s=e[0])<0?o:s,i[1]=G(i[1],e[1]);break}}var o,s;return n===r&&t.push(e),t},[])).sort(u)}catch(m){return t(this,Ww)}var c=0,h=s?function(t){return H(t,i[c][1])>0}:function(t){return H(t,i[c][1])>=0},l=o?function(t){return z(t,i[c][0])>0}:function(t){return z(t,i[c][0])>=0},f=h,p=new F(this,function(){return d.bound(i[0][0],i[i.length-1][1],!o,!s)});return p._ondirectionchange=function(t){"next"===t?(f=h,a=H):(f=l,a=z),i.sort(u)},p._addAlgorithm(function(t,e,n){for(var r=t.key;f(r);)if(++c===i.length)return e(n),!1;return!!function(t){return!h(t)&&!l(t)}(r)||0!==q(r,i[c][1])&&0!==q(r,i[c][0])&&(e(function(){t.continue(a===H?i[c][0]:i[c][1])}),!1)}),p},startsWithAnyOf:function(){var n=hb.apply(cb,arguments);return n.every(function(t){return"string"==typeof t})?0===n.length?e(this):this.inAnyRange(n.map(function(t){return[t,t+Gw]})):t(this,"startsWithAnyOf() only works with strings")}}}),jv(F.prototype,function(){function t(t,e){t.filter=X(t.filter,e)}function e(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return X(r(),e())}:e,t.justLimit=n&&!r}function n(t,e){if(t.isPrimKey)return e;var n=t.table.schema.idxByName[t.index];if(!n)throw new Sb.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return e.index(n.name)}function r(t,e){var r=n(t,e);return t.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(t.range||null,t.dir+t.unique):r.openCursor(t.range||null,t.dir+t.unique)}function o(t,e,n,i,o){var s=t.replayFilter?X(t.filter,t.replayFilter()):t.filter;t.or?function(){var a={},u=0;function c(){2==++u&&n()}function h(t,n,r){if(!s||s(n,r,c,i)){var o=n.primaryKey,u=""+o;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(o)),Vv(a,u)||(a[u]=!0,e(t,n,r))}}t.or._iterate(h,c,i,o),j(r(t,o),t.algorithm,h,c,i,!t.keysOnly&&t.valueMapper)}():j(r(t,o),X(t.algorithm,s),e,n,i,!t.keysOnly&&t.valueMapper)}return{_read:function(t,e){var n=this._ctx;return n.error?n.table._trans(null,Vw.bind(null,n.error)):n.table._idbstore("readonly",t).then(e)},_write:function(t){var e=this._ctx;return e.error?e.table._trans(null,Vw.bind(null,e.error)):e.table._idbstore(E,t,"locked")},_addAlgorithm:function(t){var e=this._ctx;e.algorithm=X(e.algorithm,t)},_iterate:function(t,e,n,r){return o(this._ctx,t,e,n,r)},clone:function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&Fv(n,t),e._ctx=n,e},raw:function(){return this._ctx.valueMapper=null,this},each:function(t){var e=this._ctx;return this._read(function(n,r,i){o(e,t,n,r,i)})},count:function(t){var e=this._ctx;if(B(e,!0))return this._read(function(t,r,i){var o=n(e,i),s=e.range?o.count(e.range):o.count();s.onerror=n_(r),s.onsuccess=function(n){t(Math.min(n.target.result,e.limit))}},t);var r=0;return this._read(function(t,n,i){o(e,function(){return++r,!1},function(){t(r)},n,i)},t)},sortBy:function(t,e){var n=t.split(".").reverse(),r=n[0],i=n.length-1;function o(t,e){return e?o(t[n[e]],e-1):t[r]}var s="next"===this._ctx.dir?1:-1;function a(t,e){var n=o(t,i),r=o(e,i);return n<r?-s:n>r?s:0}return this.toArray(function(t){return t.sort(a)}).then(e)},toArray:function(t){var e=this._ctx;return this._read(function(t,r,s){if(i&&"next"===e.dir&&B(e,!0)&&e.limit>0){var a=e.table.hook.reading.fire,u=n(e,s),c=e.limit<1/0?u.getAll(e.range,e.limit):u.getAll(e.range);c.onerror=n_(r),c.onsuccess=r_(a===Ob?t:function(e){try{t(e.map(a))}catch(n){r(n)}})}else{var h=[];o(e,function(t){h.push(t)},function(){t(h)},r,s)}},t)},offset:function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,B(n)?e(n,function(){var e=t;return function(t,n){return 0===e||(1===e?(--e,!1):(n(function(){t.advance(e),e=0}),!1))}}):e(n,function(){var e=t;return function(){return--e<0}}),this)},limit:function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),e(this._ctx,function(){var e=t;return function(t,n,r){return--e<=0&&n(r),e>=0}},!0),this},until:function(e,n){return t(this._ctx,function(t,r,i){return!e(t.value)||(r(i),n)}),this},first:function(t){return this.limit(1).toArray(function(t){return t[0]}).then(t)},last:function(t){return this.reverse().first(t)},filter:function(e){return t(this._ctx,function(t){return e(t.value)}),(n=this._ctx).isMatch=X(n.isMatch,e),this;var n},and:function(t){return this.filter(t)},or:function(t){return new L(this._ctx.table,t,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.key,n)})},eachUniqueKey:function(t){return this._ctx.unique="unique",this.eachKey(t)},eachPrimaryKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.primaryKey,n)})},keys:function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each(function(t,e){n.push(e.key)}).then(function(){return n}).then(t)},primaryKeys:function(t){var e=this._ctx;if(i&&"next"===e.dir&&B(e,!0)&&e.limit>0)return this._read(function(t,r,i){var o=n(e,i),s=e.limit<1/0?o.getAllKeys(e.range,e.limit):o.getAllKeys(e.range);s.onerror=n_(r),s.onsuccess=r_(t)}).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each(function(t,e){r.push(e.primaryKey)}).then(function(){return r}).then(t)},uniqueKeys:function(t){return this._ctx.unique="unique",this.keys(t)},firstKey:function(t){return this.limit(1).keys(function(t){return t[0]}).then(t)},lastKey:function(t){return this.reverse().firstKey(t)},distinct:function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return t(this._ctx,function(t){var e=t.primaryKey.toString(),n=Vv(r,e);return r[e]=!0,!n}),this},modify:function(t){var e=this,n=this._ctx.table.hook,r=n.updating.fire,i=n.deleting.fire;return this._write(function(n,o,s,a){var u;if("function"==typeof t)u=r===Ib&&i===Ib?t:function(e){var n=ob(e);if(!1===t.call(this,e,this))return!1;if(Vv(this,"value")){var o=sb(n,this.value),s=r.call(this,o,this.primKey,n,a);s&&(e=this.value,Mv(s).forEach(function(t){tb(e,t,s[t])}))}else i.call(this,this.primKey,e,a)};else if(r===Ib){var c=Mv(t),h=c.length;u=function(e){for(var n=!1,r=0;r<h;++r){var i=c[r],o=t[i];Zv(e,i)!==o&&(tb(e,i,o),n=!0)}return n}}else{var l=t;t=eb(l),u=function(e){var n=!1,i=r.call(this,t,this.primKey,ob(e),a);return i&&Fv(t,i),Mv(t).forEach(function(r){var i=t[r];Zv(e,r)!==i&&(tb(e,r,i),n=!0)}),i&&(t=eb(l)),n}}var d=0,f=0,p=!1,m=[],g=[],y=null;function v(t){return t&&(m.push(t),g.push(y)),o(new _b("Error modifying one or more objects",m,f,g))}function b(){p&&f+m.length===d&&(m.length>0?v():n(f))}e.clone().raw()._iterate(function(t,e){y=e.primaryKey;var n={primKey:e.primaryKey,value:t,onsuccess:null,onerror:null};function r(t){return m.push(t),g.push(n.primKey),b(),!0}if(!1!==u.call(n,t,n)){var i=!Vv(n,"value");++d,$v(function(){var t=i?e.delete():e.update(n.value);t._hookCtx=n,t.onerror=i_(r),t.onsuccess=e_(function(){++f,b()})},r)}else n.onsuccess&&n.onsuccess(n.value)},function(){p=!0,b()},v,s)})},delete:function(){var t=this,e=this._ctx,n=e.range,r=e.table.hook.deleting.fire,i=r!==Ib;if(!i&&B(e)&&(e.isPrimKey&&!Jw||!n))return this._write(function(t,e,r){var i=n_(e),o=n?r.count(n):r.count();o.onerror=i,o.onsuccess=function(){var s=o.result;$v(function(){var e=n?r.delete(n):r.clear();e.onerror=i,e.onsuccess=function(){return t(s)}},function(t){return e(t)})}});var o=i?2e3:1e4;return this._write(function(n,s,a,u){var c=0,h=t.clone({keysOnly:!e.isMatch&&!i}).distinct().limit(o).raw(),l=[],d=function(){return h.each(i?function(t,e){l.push([e.primaryKey,e.value])}:function(t,e){l.push(e.primaryKey)}).then(function(){return l.sort(i?function(t,e){return H(t[0],e[0])}:H),M(a,u,l,i,r)}).then(function(){var t=l.length;return c+=t,l=[],t<o?c:d()})};n(d())})}}}),Fv(this,{Collection:F,Table:P,Transaction:R,Version:I,WhereClause:L}),T.on("versionchange",function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '"+T.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+T.name+"'. Closing db now to resume the delete request."),T.close()}),T.on("blocked",function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+T.name+"') was blocked"):console.warn("Upgrade '"+T.name+"' blocked by other connection holding version "+t.oldVersion/10)}),c.forEach(function(t){t(T)})}function t_(t,e){return Mv(e).forEach(function(n){var r=function t(e){if("function"==typeof e)return new e;if(Rv(e))return[t(e[0])];if(e&&"object"==typeof e){var n={};return t_(n,e),n}return e}(e[n]);t[n]=r}),t}function e_(t){return _w(function(e){var n=e.target,r=n._hookCtx,i=r.value||n.result,o=r&&r.onsuccess;o&&o(i),t&&t(i)},t)}function n_(t){return _w(function(e){return o_(e),t(e.target.error),!1})}function r_(t){return _w(function(e){t(e.target.result)})}function i_(t){return _w(function(e){var n=e.target,r=n.error,i=n._hookCtx,o=i&&i.onerror;return o&&o(r),o_(e),t(r),!1})}function o_(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}function s_(t){var e=function(e){return t.next(e)},n=i(e),r=i(function(e){return t.throw(e)});function i(t){return function(e){var i=t(e),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):Rv(o)?uw.all(o).then(n,r):n(o)}}return i(e)()}function a_(t,e,n,r,i,o,s){this.name=t,this.keyPath=e,this.unique=n,this.multi=r,this.auto=i,this.compound=o,this.dotted=s;var a="string"==typeof e?e:e&&"["+[].join.call(e,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+a}function u_(t,e,n,r){this.name=t,this.primKey=e||new a_,this.indexes=n||[new a_],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=Jv(n,function(t){return[t.name,t]})}function c_(t){return 1===t.length?t[0]:t}function h_(t){var e=t&&(t.getDatabaseNames||t.webkitGetDatabaseNames);return e&&e.bind(t)}db(lb,$w),jv(Zw,Ab),jv(Zw,{delete:function(t){var e=new Zw(t),n=e.delete();return n.onblocked=function(t){return e.on("blocked",t),this},n},exists:function(t){return new Zw(t).open().then(function(t){return t.close(),!0}).catch(Zw.NoSuchDatabaseError,function(){return!1})},getDatabaseNames:function(t){var e=h_(Zw.dependencies.indexedDB);return e?new uw(function(t,n){var r=e();r.onsuccess=function(e){t(Kv(e.target.result,0))},r.onerror=n_(n)}).then(t):qw.dbnames.toCollection().primaryKeys(t)},defineClass:function(){return function(t){t&&Fv(this,t)}},applyStructure:t_,ignoreTransaction:function(t){return iw.trans?Rw(iw.transless,t):t()},vip:function(t){return Iw(function(){return iw.letThrough=!0,t()})},async:function(t){return function(){try{var e=s_(t.apply(this,arguments));return e&&"function"==typeof e.then?e:uw.resolve(e)}catch(n){return Vw(n)}}},spawn:function(t,e,n){try{var r=s_(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:uw.resolve(r)}catch(i){return Vw(i)}},currentTransaction:{get:function(){return iw.trans||null}},waitFor:function(t,e){var n=uw.resolve("function"==typeof t?Zw.ignoreTransaction(t):t).timeout(e||6e4);return iw.trans?iw.trans.waitFor(n):n},Promise:uw,debug:{get:function(){return lb},set:function(t){db(t,"dexie"===t?function(){return!0}:$w)}},derive:Hv,extend:Fv,props:jv,override:Xv,Events:jw,getByKeyPath:Zv,setByKeyPath:tb,delByKeyPath:function(t,e){"string"==typeof e?tb(t,e,void 0):"length"in e&&[].map.call(e,function(e){tb(t,e,void 0)})},shallowClone:eb,deepClone:ob,getObjectDiff:sb,asap:Yv,maxKey:Hw,minKey:zw,addons:[],connections:Xw,MultiModifyError:Sb.Modify,errnames:Tb,IndexSpec:a_,TableSchema:u_,dependencies:function(){try{return{indexedDB:Lv.indexedDB||Lv.mozIndexedDB||Lv.webkitIndexedDB||Lv.msIndexedDB,IDBKeyRange:Lv.IDBKeyRange||Lv.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"{version}",version:"{version}".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)}),default:Zw,Dexie:Zw}),uw.rejectionMapper=function(t,e){if(!t||t instanceof wb||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Cb[t.name])return t;var n=new Cb[t.name](e||t.message,t);return"stack"in t&&Gv(n,"stack",{get:function(){return this.inner.stack}}),n},(qw=new Zw("__dbnames")).version(1).stores({dbnames:"name"}),function(){try{void 0!==typeof localStorage&&void 0!==Lv.document&&(JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]").forEach(function(t){return qw.dbnames.put({name:t}).catch(Ib)}),localStorage.removeItem("Dexie.DatabaseNames"))}catch(t){}}();var l_=Zw;class d_ extends l_{constructor(){super("GameServiceDatabase"),this.version(1).stores({levels:"&name"}),this.version(2).stores({levels:"&name",ais:"&name"})}}let f_,p_,m_=(()=>{class t{constructor(t){this.firestoreService=t,this.db=new d_,this.dbExpireTimeSeconds=21600,this.aiExpireTimeSeconds=21600}loadLevel(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=yield this.db.levels.where("name").equals(t).first();if(e&&e.timestamp&&!((Number(new Date)-e.timestamp)/1e3>this.dbExpireTimeSeconds)&&ea.production)return e.mapInfo;const n=yield this.firestoreService.level(t);return this.db.levels.put({name:t,mapInfo:n,timestamp:Number(new Date)}),ea.production?n:Object.assign({},n,{enemies:{[Hc.Tank3]:1e3}})})}isExpired(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=yield this.db.ais.where("name").equals(t).first(),n=e?(Number(new Date)-e.timestamp)/1e3:0,r=!e||n>this.aiExpireTimeSeconds;return r?console.log(`${t} expired.`):console.log(`${t} expire in ${this.aiExpireTimeSeconds-n} seconds.`),r})}loadAI(t){return ra.__awaiter(this,void 0,void 0,function*(){try{const n=yield this.loadAIFromServer(t);return{name:n.name,ai:n.ai}}catch(e){if("storage/object-not-found"===e.code||"storage/quota-exceeded"===e.code)throw e;return this.loadAI(t)}})}loadAIFromServer(t){return ra.__awaiter(this,void 0,void 0,function*(){const e=yield this.firestoreService.loadAI(t);return yield this.db.ais.put({name:e.name,timestamp:e.timestamp}),e})}updateAI(t,e){return ra.__awaiter(this,void 0,void 0,function*(){const n=yield this.db.ais.where("name").equals(t).first();n&&n.timestamp?(Number(new Date)-n.timestamp)/1e3>this.aiExpireTimeSeconds&&(yield this.loadFromServerOrUploadToServer(t,n,e)):yield this.loadFromServerOrUploadToServer(t,n,e)})}loadFromServerOrUploadToServer(t,e,n){return ra.__awaiter(this,void 0,void 0,function*(){try{(yield this.firestoreService.loadAIInfo(t)).timestamp>e.timestamp?yield this.loadAIFromServer(t):yield this.uploadToServer(t,e,n)}catch(r){if("storage/object-not-found"!==r.code)throw r;yield this.uploadToServer(t,e,n)}})}uploadToServer(t,e,n){return ra.__awaiter(this,void 0,void 0,function*(){const r=Object.assign({},e,{timestamp:Number(new Date)});yield this.firestoreService.updateAI(t,n),yield this.updateAIInfo(t,{timestamp:r.timestamp,trainingInfo:n.ai.trainingInfo}),yield this.db.ais.put(r)})}updateAIInfo(t,e){return ra.__awaiter(this,void 0,void 0,function*(){return this.firestoreService.updateAIInfo(t,e)})}}return ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[String]),ra.__metadata("design:returntype",Promise)],t.prototype,"isExpired",null),ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[String]),ra.__metadata("design:returntype",Promise)],t.prototype,"loadAI",null),ra.__decorate([Ll(),ra.__metadata("design:type",Function),ra.__metadata("design:paramtypes",[String,Object]),ra.__metadata("design:returntype",Promise)],t.prototype,"updateAI",null),t})();const g_=()=>{if(f_)return f_;const t=new rv;return t.add(Hc.Brick1,"./assets/brick1.png").add(Hc.Brick2,"./assets/brick2.png").add(Hc.Steel,"./assets/steel.png").add(Hc.Tree,"./assets/tree.png").add(Hc.Bullet,"./assets/bullet.png").add(Hc.Water,"./assets/water.png").add(Hc.Tank,"./assets/tank.png").add(Hc.Tank3,"./assets/tank3.png").add(Hc.Explosion,"./assets/explosions.png").add(Hc.Eagle,"./assets/eagle.png").add(Hc.Blockade,"./assets/blockade.png"),f_=new Promise((e,n)=>{t.load((t,n)=>{p_=n,e(n)})})},y_={leading:!0,trailing:!1};class v_{constructor(t,e,n,r){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=r}call(t,e){return e.subscribe(new b_(t,this.duration,this.scheduler,this.leading,this.trailing))}}class b_ extends m{constructor(t,e,n,r,i){super(t),this.duration=e,this.scheduler=n,this.leading=r,this.trailing=i,this._hasTrailingValue=!1,this._trailingValue=null}_next(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(w_,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))}_complete(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}clearThrottle(){const t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}function w_(t){const{subscriber:e}=t;e.clearThrottle()}class __{constructor(t,e){this.count=t,this.source=e}call(t,e){return e.subscribe(new E_(t,this.count,this.source))}}class E_ extends m{constructor(t,e,n){super(t),this.count=e,this.source=n}error(t){if(!this.isStopped){const{source:e,count:n}=this;if(0===n)return super.error(t);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}}}var T_=n("ANjH"),x_=n("5HXA");function S_(t){return function(e){var n=e.dispatch,r=e.getState;return function(e){return function(i){return"function"==typeof i?i(n,r,t):e(i)}}}}var C_=S_();C_.withExtraArgument=S_;var A_=C_;const I_={status:Xl.None,name:""};var O_=function(t){return t.None="game_none",t.GameStart="game_start",t.GameStop="game_stop",t.GameOver="game_over",t.CreatePlayerSpawn="create_player_spawn",t.PlayerDestroyed="player_destroyed",t.CreateEnemySpawn="create_enemy_spawn",t.EnemyDestroyed="enemy_destroyed",t}({});function D_(){return{type:O_.GameStart}}const k_={id:`player-${n("xk4V")()}`,lives:3},P_={status:O_.None,player:k_,players:[k_],playerSpawns:[],enemySpawns:[]};var N_=function(t){return t.UpdateCenter="renderer_update_center",t.UpdateCameraPosition="update_camera_position",t.CreateTree="create_tree",t}({});function M_(t,e){return{type:N_.UpdateCenter,width:t,height:e}}var R_=function(t){return t.CreateBody="world_create_body",t.DeleteBody="world_delete_body",t.UpdateBody="world_update_body",t.CreateBox="world_create_box",t.UpdateBodies="world_update_bodies",t.CreateTree="world_create_tree",t.CreateBlockade="world_create_blockade",t.CreateBrick="world_create_brick",t.CreateWater="world_create_water",t.CreateEagle="world_create_eagle",t.CreatePlayer="world_create_player",t.CreateEnemy="world_create_enemy",t}({}),L_=function(t){return t.Container="container",t.Sprite="sprite",t.AnimatedSprite="animated_sprite",t}({});const F_={renderer:{center:{x:0,y:0},camera:{x:0,y:0}},objects:{},players:[],enemies:[]};var B_=function(t){return t[t.Default=Math.pow(2,0)]="Default",t[t.Water=Math.pow(2,1)]="Water",t[t.All=t.Default|t.Water]="All",t}({});function U_(t,e,n){const{object:{id:r}}=e;return Object.assign({},t,{objects:Object.assign({},t.objects,{[r]:Object.assign({},t.objects[r],{inWorld:n})})})}const V_=Object(T_.combineReducers)({battlefieldMap:function(t=I_,e){switch(e.type){case Xl.Loading:return Object.assign({},t,{status:Xl.Loading});case Xl.Loaded:return Object.assign({},t,{status:Xl.Loaded,name:e.name,map:e.level})}return t},currentGame:function(t=P_,e){switch(e.type){case O_.GameOver:return Object.assign({},t,{status:O_.GameOver});case O_.GameStart:return Object.assign({},t,{status:O_.GameStart});case O_.GameStop:return Object.assign({},t,{status:O_.GameStop});case O_.CreatePlayerSpawn:return Object.assign({},t,{playerSpawns:[...t.playerSpawns,{block:e.block}]})}return t},worldState:function(t=F_,e){const n=function(t,e){switch(e.type){case N_.UpdateCenter:return Object.assign({},t,{renderer:Object.assign({},t.renderer,{center:{x:e.width/2,y:e.height/2}})});case N_.UpdateCameraPosition:return Object.assign({},t,{renderer:Object.assign({},t.renderer,{camera:{x:e.x,y:e.y}})})}return t}(t,e);switch(e.type){case R_.UpdateBodies:return function(t,e){const n={};return e.updates.forEach(e=>{const{id:r}=e,i=t.objects[r],{position:{x:o,y:s},angle:a}=e.body,u=Object.assign({},i,{container:Object.assign({},i.container,{position:{x:o,y:s},rotation:a})});n[r]=u}),Object.assign({},t,{objects:Object.assign({},t.objects,n)})}(t,e);case R_.CreateTree:return function(t,e){const{id:n,block:r}=e;return Object.assign({},t,{objects:Object.assign({},t.objects,{[n]:{id:n,block:r,bodyOptions:{mass:0,position:[r.position.x,r.position.y]},box:{width:r.width,height:r.width,sensor:!1},inWorld:!0,container:{type:L_.Container,id:"",zIndex:10,pivot:{x:r.width/2,y:r.height/2},position:{x:r.position.x,y:r.position.y},rotation:0,children:[{type:L_.Sprite,id:"",textureId:Hc.Tree}]}}})})}(t,e);case R_.CreateBody:return U_(t,e,!0);case R_.CreateBlockade:return function(t,e){const{id:n,block:r}=e;return Object.assign({},t,{objects:Object.assign({},t.objects,{[n]:{id:n,block:r,bodyOptions:{mass:0,position:[r.position.x+r.width/2,r.position.y+r.height/2]},box:{width:r.width,height:r.width},inWorld:!0,container:{type:L_.Container,id:"",zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:r.position.x+r.width/2,y:r.position.y+r.height/2},rotation:0,children:[{type:L_.Sprite,id:"",textureId:Hc.Blockade}]}}})})}(t,e);case R_.CreateBrick:return function(t,e){const{id:n,block:r}=e;return Object.assign({},t,{objects:Object.assign({},t.objects,{[n]:{id:n,block:r,bodyOptions:{mass:.5,position:[r.position.x+r.width/2,r.position.y+r.height/2]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:B_.Default,collisionMask:B_.Default|B_.Water},inWorld:!0,container:{type:L_.Container,id:"",zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:r.position.x+r.width/2,y:r.position.y+r.height/2},rotation:0,children:[{type:L_.Sprite,id:"",textureId:e.block.type}]}}})})}(t,e);case R_.CreateWater:return function(t,e){const{id:n,block:r}=e;return Object.assign({},t,{objects:Object.assign({},t.objects,{[n]:{id:n,block:r,bodyOptions:{mass:0,position:[r.position.x+r.width/2,r.position.y+r.height/2]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:B_.Water},inWorld:!0,container:{type:L_.Container,id:"",zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:r.position.x+r.width/2,y:r.position.y+r.height/2},rotation:0,children:[{type:L_.AnimatedSprite,id:"",textureId:Hc.Water,frames:[{x:0,y:0,width:r.width,height:r.height},{x:32,y:0,width:r.width,height:r.height}],speed:.05}]}}})})}(t,e);case R_.CreateEagle:return function(t,e){const{id:n,block:r}=e;return Object.assign({},t,{objects:Object.assign({},t.objects,{[n]:{id:n,block:r,bodyOptions:{mass:0,position:[r.position.x,r.position.y]},box:{width:r.width,height:r.width,sensor:!1},inWorld:!0,container:{type:L_.Container,id:"",zIndex:0,pivot:{x:0,y:0},position:{x:r.position.x,y:r.position.y},rotation:0,children:[{type:L_.Sprite,id:"sprite-1",textureId:Hc.Eagle,frame:{x:0,y:0,width:r.width,height:r.height}}]}}})})}(t,e);case R_.CreatePlayer:return function(t,e){const{id:n,block:r}=e,i=r.position.x+r.width/2,o=r.position.y+r.height/2,s={id:n,block:r,bodyOptions:{mass:.5,fixedRotation:!0,position:[i,o]},body:{damping:.99},box:{width:r.width,height:r.width,collisionMask:B_.All},inWorld:!0,container:{type:L_.Container,id:"",zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:i,y:o},rotation:-Math.PI/2,children:[{type:L_.Sprite,id:"sprite-1",textureId:Hc.Tank,frame:{x:0,y:0,width:r.width,height:r.height}}]}};return Object.assign({},t,{objects:Object.assign({},t.objects,{[n]:s}),renderer:Object.assign({},t.renderer,{camera:{x:i,y:o}}),players:[...t.players,{id:n}]})}(t,e);case R_.DeleteBody:return U_(t,e,!1)}return n}});var j_=function(t){return"@@redux-saga/"+t},q_=j_("CANCEL_PROMISE"),G_=j_("CHANNEL_END"),H_=j_("IO"),z_=j_("MATCH"),W_=j_("MULTICAST"),K_=j_("SAGA_ACTION"),X_=j_("SELF_CANCELLATION"),Q_=j_("TASK"),Y_=j_("TASK_CANCEL"),J_=j_("TERMINATE"),$_=j_("LOCATION");function Z_(){return(Z_=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var tE=function(t){return null==t},eE=function(t){return null!=t},nE=function(t){return"function"==typeof t},rE=function(t){return"string"==typeof t},iE=Array.isArray,oE=function(t){return t&&nE(t.then)},sE=function(t){return t&&nE(t.next)&&nE(t.throw)},aE=function t(e){return e&&(rE(e)||hE(e)||nE(e)||iE(e)&&e.every(t))},uE=function(t){return t&&nE(t.take)&&nE(t.close)},cE=function(t){return nE(t)&&t.hasOwnProperty("toString")},hE=function(t){return Boolean(t)&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype},lE=function(t){return uE(t)&&t[W_]},dE=function(t){return function(){return!0}}(),fE=function(){},pE=function(t){return t};"function"==typeof Symbol&&Symbol.asyncIterator&&Symbol;var mE=function(t,e){Z_(t,e),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach(function(n){t[n]=e[n]})};function gE(t,e){var n=t.indexOf(e);n>=0&&t.splice(n,1)}var yE=function(t){throw t},vE=function(t){return{value:t,done:!0}};function bE(t,e,n){void 0===e&&(e=yE),void 0===n&&(n="iterator");var r={meta:{name:n},next:t,throw:e,return:vE,isSagaIterator:!0};return"undefined"!=typeof Symbol&&(r[Symbol.iterator]=function(){return r}),r}function wE(t,e){var n=e.sagaStack;console.error(t),console.error(n)}var _E=function(t){return Array.apply(null,new Array(t))},EE=function(t){return function(e){return t(Object.defineProperty(e,K_,{value:!0}))}},TE=function(t){return t===J_},xE=function(t){return t===Y_},SE=function(t){return TE(t)||xE(t)};function CE(t,e){var n,r=Object.keys(t),i=r.length,o=0,s=iE(t)?_E(i):{},a={};return r.forEach(function(t){var r=function(r,a){n||(a||SE(r)?(e.cancel(),e(r,a)):(s[t]=r,++o===i&&(n=!0,e(s))))};r.cancel=fE,a[t]=r}),e.cancel=function(){n||(n=!0,r.forEach(function(t){return a[t].cancel()}))},a}function AE(t){return{name:t.name||"anonymous",location:IE(t)}}function IE(t){return t[$_]}var OE="TAKE",DE="PUT",kE="ALL",PE="CALL",NE="SELECT",ME=function(t,e){var n;return(n={})[H_]=!0,n.combinator=!1,n.type=t,n.payload=e,n};function RE(t,e){return void 0===t&&(t="*"),aE(t)?ME(OE,{pattern:t}):lE(t)&&eE(e)&&aE(e)?ME(OE,{channel:t,pattern:e}):uE(t)?ME(OE,{channel:t}):void 0}function LE(t,e){return tE(e)&&(e=t,t=void 0),ME(DE,{channel:t,action:e})}function FE(t){var e=ME(kE,t);return e.combinator=!0,e}function BE(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return ME(PE,function(t,e){var n,r=null;return nE(t)?n=t:(iE(t)?(r=t[0],n=t[1]):(r=t.context,n=t.fn),r&&rE(n)&&nE(r[n])&&(n=r[n])),{context:r,fn:n,args:e}}(t,n))}function UE(t){void 0===t&&(t=pE);for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return ME(NE,{selector:t,args:n})}var VE=function(){var t={};return t.promise=new Promise(function(e,n){t.resolve=e,t.reject=n}),t},jE=[],qE=0;function GE(t){try{WE(),t()}finally{KE()}}function HE(t){jE.push(t),qE||(WE(),XE())}function zE(t){try{return WE(),t()}finally{XE()}}function WE(){qE++}function KE(){qE--}function XE(){var t;for(KE();!qE&&void 0!==(t=jE.shift());)GE(t)}var QE=function(t){return function(e){return t.some(function(t){return tT(t)(e)})}},YE=function(t){return function(e){return t(e)}},JE=function(t){return function(e){return e.type===String(t)}},$E=function(t){return function(e){return e.type===t}},ZE=function(){return dE};function tT(t){var e="*"===t?ZE:rE(t)?JE:iE(t)?QE:cE(t)?JE:nE(t)?YE:hE(t)?$E:null;if(null===e)throw new Error("invalid pattern: "+t);return e(t)}var eT={type:G_},nT=function(t){return t&&t.type===G_};function rT(){var t,e,n,r,i,o,s=(e=!1,r=n=[],i=function(){r===n&&(r=n.slice())},o=function(){e=!0;var t=n=r;r=[],t.forEach(function(t){t(eT)})},(t={})[W_]=!0,t.put=function(t){if(!e)if(nT(t))o();else for(var i=n=r,s=0,a=i.length;s<a;s++){var u=i[s];u[z_](t)&&(u.cancel(),u(t))}},t.take=function(t,n){var o,s;void 0===n&&(n=ZE),e?t(eT):(t[z_]=n,i(),r.push(t),t.cancel=(o=function(){i(),gE(r,t)},s=!1,function(){s||(s=!0,o())}))},t.close=o,t),a=s.put;return s.put=function(t){t[K_]?a(t):HE(function(){a(t)})},s}var iT=0,oT=1,sT=2,aT=3;function uT(t,e){var n=t[q_];nE(n)&&(e.cancel=n),t.then(e,function(t){e(t,!0)})}var cT,hT=0,lT=function(){return++hT};function dT(t){t.isRunning()&&t.cancel()}var fT=((cT={})[OE]=function(t,e,n){var r=e.channel,i=void 0===r?t.channel:r,o=e.pattern,s=e.maybe,a=function(t){t instanceof Error?n(t,!0):!nT(t)||s?n(t):n(J_)};try{i.take(a,eE(o)?tT(o):null)}catch(u){return void n(u,!0)}n.cancel=a.cancel},cT[DE]=function(t,e,n){var r=e.channel,i=e.action,o=e.resolve;HE(function(){var e;try{e=(r?r.put:t.dispatch)(i)}catch(s){return void n(s,!0)}o&&oE(e)?uT(e,n):n(e)})},cT[kE]=function(t,e,n,r){var i=r.digestEffect,o=hT,s=Object.keys(e);if(0!==s.length){var a=CE(e,n);s.forEach(function(t){i(e[t],o,a[t],t)})}else n(iE(e)?[]:{})},cT.RACE=function(t,e,n,r){var i=r.digestEffect,o=hT,s=Object.keys(e),a=iE(e)?_E(s.length):{},u={},c=!1;s.forEach(function(t){var e=function(e,r){c||(r||SE(e)?(n.cancel(),n(e,r)):(n.cancel(),c=!0,a[t]=e,n(a)))};e.cancel=fE,u[t]=e}),n.cancel=function(){c||(c=!0,s.forEach(function(t){return u[t].cancel()}))},s.forEach(function(t){c||i(e[t],o,u[t],t)})},cT[PE]=function(t,e,n,r){var i=e.context,o=e.fn,s=e.args,a=r.task;try{var u=o.apply(i,s);if(oE(u))return void uT(u,n);if(sE(u))return void ET(t,u,a.context,hT,AE(o),!1,n);n(u)}catch(c){n(c,!0)}},cT.CPS=function(t,e,n){var r=e.context,i=e.fn,o=e.args;try{var s=function(t,e){tE(t)?n(e):n(t,!0)};i.apply(r,o.concat(s)),s.cancel&&(n.cancel=s.cancel)}catch(a){n(a,!0)}},cT.FORK=function(t,e,n,r){var i=e.fn,o=e.detached,s=r.task,a=function(t){var e=t.context,n=t.fn,r=t.args;try{var i=n.apply(e,r);if(sE(i))return i;var o=!1;return bE(function(t){return o?{value:t,done:!0}:(o=!0,{value:i,done:!oE(i)})})}catch(s){return bE(function(){throw s})}}({context:e.context,fn:i,args:e.args}),u=function(t,e){return a.isSagaIterator?{name:a.meta.name}:AE(e)}(0,i);zE(function(){var e=ET(t,a,s.context,hT,u,o,fE);o?n(e):e.isRunning()?(s.queue.addTask(e),n(e)):e.isAborted()?s.queue.abort(e.error()):n(e)})},cT.JOIN=function(t,e,n,r){var i=r.task,o=function(t,e){if(t.isRunning()){var n={task:i,cb:e};e.cancel=function(){t.isRunning()&&gE(t.joiners,n)},t.joiners.push(n)}else t.isAborted()?e(t.error(),!0):e(t.result())};if(iE(e)){if(0===e.length)return void n([]);var s=CE(e,n);e.forEach(function(t,e){o(t,s[e])})}else o(e,n)},cT.CANCEL=function(t,e,n,r){e===X_?dT(r.task):iE(e)?e.forEach(dT):dT(e),n()},cT[NE]=function(t,e,n){var r=e.selector,i=e.args;try{n(r.apply(void 0,[t.getState()].concat(i)))}catch(o){n(o,!0)}},cT.ACTION_CHANNEL=function(t,e,n){var r=e.pattern,i=function(t){var e;void 0===t&&(t=function(t,e){void 0===t&&(t=10);var n=new Array(t),r=0,i=0,o=0,s=function(e){n[i]=e,i=(i+1)%t,r++},a=function(){if(0!=r){var e=n[o];return n[o]=null,r--,o=(o+1)%t,e}},u=function(){for(var t=[];r;)t.push(a());return t};return{isEmpty:function(){return 0==r},put:function(e){var a;r<t?s(e):(a=2*t,n=u(),r=n.length,i=n.length,o=0,n.length=a,t=a,s(e))},take:a,flush:u}}(e));var n=!1,r=[];return{take:function(e){n&&t.isEmpty()?e(eT):t.isEmpty()?(r.push(e),e.cancel=function(){gE(r,e)}):e(t.take())},put:function(e){if(!n){if(0===r.length)return t.put(e);r.shift()(e)}},flush:function(e){n&&t.isEmpty()?e(eT):e(t.flush())},close:function(){if(!n){n=!0;var t=r;r=[];for(var e=0,i=t.length;e<i;e++)(0,t[e])(eT)}}}}(e.buffer),o=tT(r),s=function e(n){nT(n)||t.channel.take(e,o),i.put(n)},a=i.close;i.close=function(){s.cancel(),a()},t.channel.take(s,o),n(i)},cT.CANCELLED=function(t,e,n,r){n(r.task.isCancelled())},cT.FLUSH=function(t,e,n){e.flush(n)},cT.GET_CONTEXT=function(t,e,n,r){n(r.task.context[e])},cT.SET_CONTEXT=function(t,e,n,r){mE(r.task.context,e),n()},cT);function pT(t,e){return t+"?"+e}function mT(t){var e=t.name,n=t.location;return n?e+"  "+pT(n.fileName,n.lineNumber):e}var gT=null,yT=[],vT=function(t){t.crashedEffect=gT,yT.push(t)},bT=function(){gT=null,yT.length=0},wT=function(t){gT=t},_T=function(){var t,e,n,r,i,o=yT[0],s=yT.slice(1),a=o.crashedEffect?function(t){var e=IE(o.crashedEffect);return e?e.code+"  "+pT(e.fileName,e.lineNumber):""}():null;return["The above error occurred in task "+mT(o.meta)+(a?" \n when executing effect "+a:"")].concat(s.map(function(t){return"    created by "+mT(t.meta)}),[(t=yT,n=function(t){return t.cancelledTasks},r=t,e=(i=[]).concat.apply(i,r.map(n)),e.length?["Tasks cancelled due to error:"].concat(e).join("\n"):"")]).join("\n")};function ET(t,e,n,r,i,o,s){var a=t.finalizeRunEffect(function(e,n,r){oE(e)?uT(e,r):sE(e)?ET(t,e,c.context,n,i,!1,r):e&&e[H_]?(0,fT[e.type])(t,e.payload,r,h):r(e)});l.cancel=fE;var u={meta:i,cancel:function(){u.status===iT&&(u.status=oT,l(Y_))},status:iT},c=function(t,e,n,r,i,o,s){var a,u,c,h=iT,l=null,d=[],f=Object.create(n),p=function(t,e,n){var r,i=[],o=!1;function s(t){e(),u(),n(t,!0)}function a(e){i.push(e),e.cont=function(a,u){o||(gE(i,e),e.cont=fE,u?s(a):(e===t&&(r=a),i.length||(o=!0,n(r))))}}function u(){o||(o=!0,i.forEach(function(t){t.cont=fE,t.cancel()}),i=[])}return a(t),{addTask:a,cancelAll:u,abort:s,getTasks:function(){return i}}}(e,function(){d.push.apply(d,p.getTasks().map(function(t){return t.meta.name}))},m);function m(e,n){if(n){if(h=sT,vT({meta:i,cancelledTasks:d}),g.isRoot){var r=_T();bT(),t.onError(e,{sagaStack:r})}c=e,l&&l.reject(e)}else e===Y_?h=oT:h!==oT&&(h=aT),u=e,l&&l.resolve(e);g.cont(e,n),g.joiners.forEach(function(t){t.cb(e,n)}),g.joiners=null}var g=((a={})[Q_]=!0,a.id=r,a.meta=i,a.isRoot=o,a.context=f,a.joiners=[],a.queue=p,a.cancel=function(){h===iT&&(h=oT,p.cancelAll(),m(Y_,!1))},a.cont=s,a.end=m,a.setContext=function(t){mE(f,t)},a.toPromise=function(){return l?l.promise:(l=VE(),h===sT?l.reject(c):h!==iT&&l.resolve(u),l.promise)},a.isRunning=function(){return h===iT},a.isCancelled=function(){return h===oT||h===iT&&e.status===oT},a.isAborted=function(){return h===sT},a.result=function(){return u},a.error=function(){return c},a);return g}(t,u,n,r,i,o,s),h={task:c,digestEffect:d};return s.cancel=c.cancel,l(),c;function l(t,n){try{var i;n?(i=e.throw(t),bT()):xE(t)?(u.status=oT,l.cancel(),i=nE(e.return)?e.return(Y_):{done:!0,value:Y_}):i=TE(t)?nE(e.return)?e.return():{done:!0}:e.next(t),i.done?(u.status!==oT&&(u.status=aT),u.cont(i.value)):d(i.value,r,l)}catch(o){if(u.status===oT)throw o;u.status=sT,u.cont(o,!0)}}function d(e,n,r,i){void 0===i&&(i="");var o,s=lT();function u(n,i){o||(o=!0,r.cancel=fE,t.sagaMonitor&&(i?t.sagaMonitor.effectRejected(s,n):t.sagaMonitor.effectResolved(s,n)),i&&wT(e),r(n,i))}t.sagaMonitor&&t.sagaMonitor.effectTriggered({effectId:s,parentEffectId:n,label:i,effect:e}),u.cancel=fE,r.cancel=function(){o||(o=!0,u.cancel(),u.cancel=fE,t.sagaMonitor&&t.sagaMonitor.effectCancelled(s))},a(e,s,u)}}const TT=function(t){void 0===t&&(t={});var e,n=t,r=n.context,i=void 0===r?{}:r,o=n.channel,s=void 0===o?rT():o,a=n.sagaMonitor,u=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)e.indexOf(n=o[r])>=0||(i[n]=t[n]);return i}(n,["context","channel","sagaMonitor"]);function c(t){return e=(function(t,e){for(var n=t.channel,r=void 0===n?rT():n,i=t.dispatch,o=t.getState,s=t.context,a=void 0===s?{}:s,u=t.sagaMonitor,c=t.effectMiddlewares,h=t.onError,l=void 0===h?wE:h,d=arguments.length,f=new Array(d>2?d-2:0),p=2;p<d;p++)f[p-2]=arguments[p];var m,g=e.apply(void 0,f),y=lT();if(u&&(u.rootSagaStarted=u.rootSagaStarted||fE,u.effectTriggered=u.effectTriggered||fE,u.effectResolved=u.effectResolved||fE,u.effectRejected=u.effectRejected||fE,u.effectCancelled=u.effectCancelled||fE,u.actionDispatched=u.actionDispatched||fE,u.rootSagaStarted({effectId:y,saga:e,args:f})),c){var v=T_.compose.apply(void 0,c);m=function(t){return function(e,n,r){return v(function(e){return t(e,n,r)})(e)}}}else m=pE;var b={channel:r,dispatch:EE(i),getState:o,sagaMonitor:u,onError:l,finalizeRunEffect:m};return zE(function(){var t=ET(b,g,a,y,AE(e),!0,fE);return u&&u.effectResolved(y,t),t})}).bind(null,Z_({},u,{context:i,channel:s,dispatch:t.dispatch,getState:t.getState,sagaMonitor:a})),function(t){return function(e){a&&a.actionDispatched&&a.actionDispatched(e);var n=t(e);return s.put(e),n}}}return c.run=function(){return e.apply(void 0,arguments)},c.setContext=function(t){mE(i,t)},c}();var xT=n("wYbb");function ST(t,e,n){return t.container.position.x.toFixed(0)!==e.toFixed(0)||t.container.position.y.toFixed(0)!==n.toFixed(0)}var CT=function(t){return t.Move="player_move",t.Shot="player_shot",t.AddLife="player_add_life",t}({});function AT(t,e,n,r,i,o){const s=new xT.Body(Object.assign({},r,{angle:o.rotation}));i&&i.damping&&(s.damping=i.damping),e.set(n,s),t.addBody(s)}function IT(t){return t.worldState.objects}function OT(t,e,n){const r=new xT.Box(n);r.sensor=n.sensor,t.get(e).addShape(r)}function DT(t){return e=>e.worldState.objects[t]}function*kT(t,e){for(;;){const{id:n}=yield RE([R_.CreateTree,R_.CreateBlockade,R_.CreateBrick,R_.CreateWater,R_.CreateEagle,R_.CreatePlayer]),{bodyOptions:r,body:i,container:o,box:s}=yield UE(DT(n));if(e.get(n))return;AT(t,e,n,r,i,o),OT(e,n,s)}}function*PT(t,e){for(;;){const{object:{id:n,bodyOptions:r,body:i,container:o}}=yield RE(R_.CreateBody);AT(t,e,n,r,i,o)}}function*NT(t,e){for(;;){const n=yield RE(R_.DeleteBody),r=e.get(n.object.id);t.removeBody(r),e.delete(n.object.id)}}const MT=t=>{const e=t.currentGame.player;if(e)return t.worldState.objects[e.id]},RT={left:{x:-150,y:0,angle:Math.PI},down:{x:0,y:150,angle:Math.PI/2},up:{x:0,y:-150,angle:-Math.PI/2},right:{x:150,y:0,angle:2*Math.PI}};function*LT(t){for(;;){const{direction:e}=yield RE([CT.Move]),n=yield UE(MT);if(n){const{x:r,y:i,angle:o}=RT[e],s=t.get(n.id);s.velocity=[s.velocity[0]/10+r,s.velocity[1]/10+i],s.angle=o}}}function*FT(t){const e=yield UE(MT);if(!e)return;const n=yield t.get(e.id);if(!n)return;const[r,i]=n.position;ST(yield UE(DT(e.id)),r,i)&&(yield LE(function(t,e){return{type:N_.UpdateCameraPosition,x:t,y:e}}(r,i)))}function*BT(t,e){for(;;){const r=yield UE();if(r.currentGame.status===O_.GameStart){t.step(1/30);const i=[...e.keys()].filter(t=>{const n=e.get(t),[i,o]=n.position,s=n.interpolatedAngle,a=r.worldState.objects[t];return ST(a,i,o)||a.container.rotation!==s}).map(t=>{const n=e.get(t),[r,i]=n.position;return{id:t,body:{position:{x:r,y:i},angle:n.interpolatedAngle||n.angle}}});yield BE(FT,e),i.length&&(yield LE((n=i,{type:R_.UpdateBodies,updates:n}))),yield new Promise(t=>window.requestAnimationFrame(t))}else yield RE(O_.GameStart)}var n}function UT(t,e){switch(t.type){case Hc.PlayerSpawn:return LE({type:O_.CreatePlayerSpawn,block:t});case Hc.EnemySpawn:return LE({type:O_.CreateEnemySpawn,block:t});case Hc.Water:return LE({type:R_.CreateWater,id:`water-${e}`,block:t});case Hc.Tree:return LE({type:R_.CreateTree,id:`tree-${e}`,block:t});case Hc.Blockade:return LE({type:R_.CreateBlockade,id:`blockade-${e}`,block:t});case Hc.Eagle:return LE({type:R_.CreateEagle,id:`eagle-${e}`,block:t});case Hc.Brick1:case Hc.Brick2:return LE({type:R_.CreateBrick,id:`brick-${e}`,block:t})}}function VT(t){return t.currentGame.playerSpawns}function jT(t){return t.worldState.players}function qT(t){return t.currentGame.players}function*GT(t){const e=yield UE(VT),n=yield UE(jT);if(t.lives>0&&!n.find(e=>e.id===t.id)){const n=e[(o=e.length,Math.floor(Math.random()*Math.floor(o)))];yield LE((r=t.id,i=n.block,{type:R_.CreatePlayer,id:r,block:i}))}var r,i,o}const HT=Object(x_.composeWithDevTools)({actionsBlacklist:[R_.UpdateBodies,N_.UpdateCameraPosition,CT.Move]}),zT=Object(T_.createStore)(V_,HT(Object(T_.applyMiddleware)(A_,TT)));TT.run(function*(){const t=new xT.World({gravity:[0,0]}),e=new Map,n=yield UE(IT);Object.values(n).forEach(({id:n,bodyOptions:r,container:i,box:o,body:s})=>{AT(t,e,n,r,s,i),OT(e,n,o)}),yield FE([BE(PT,t,e),BE(NT,t,e),BE(BT,t,e),BE(kT,t,e),BE(LT,e)])}),TT.run(function*(){for(;;){const{level:t}=yield RE(Xl.Loaded),e=new Set(t.map);yield FE([...e].map(UT).filter(t=>void 0!==t)),yield LE(D_())}}),TT.run(function*(){for(;;){yield RE([O_.CreatePlayerSpawn,O_.PlayerDestroyed]);const t=(yield UE(qT)).map(t=>BE(GT,t));yield FE(t)}});const WT=t=>{switch(t.battlefieldMap.status){case Xl.None:case Xl.Loaded:return!1;default:return!0}},KT=(t,e)=>{const n=(t=>t.battlefieldMap.name)(e),r=t.findIndex(t=>t===n);return-1===r||r+1>t.length-1?t[0]:t[r]},XT=new Map;class QT{constructor(t,e){this.gameService=t,this.ngZone=e,this.loading=!0,this.gameOver=!1,this.canWatchAds=!0,this.moveEvent=new x,this.destroySubject=new x,this.exit=new xi,this.devicePixelRatio=window.devicePixelRatio||1,this.levels=["level-6"],this.currentLevelIndex=0}ngAfterViewInit(){return ra.__awaiter(this,void 0,void 0,function*(){yield g_(),this.loadLevel(KT(this.levels,zT.getState())),this.storeSubscribe=this.ngZone.runOutsideAngular(()=>zT.subscribe(()=>{const t=zT.getState();this.gameOver=function(t){return t.currentGame.status===O_.GameOver}(t),this.loading=WT(t),function(t,e){t&&null!==t.parent&&(t.position.set(-e.renderer.camera.x+e.renderer.center.x,-e.renderer.camera.y+e.renderer.center.y),Object.values(e.objects).forEach(({id:e,container:n})=>{if(XT.has(e))!function(t,e){t.position.set(e.position.x,e.position.y),t.rotation=e.rotation}(XT.get(e),n);else{const r=function t(e){const n=new pp;return n.zIndex=e.zIndex,n.pivot.set(e.pivot.x,e.pivot.y),e.children.forEach(e=>(function(e,n){switch(n.type){case L_.Sprite:if(n.frame){const{x:t,y:r,width:i,height:o}=n.frame,s=new ip(t,r,i,o),a=new ay(new Hp(p_[n.textureId].texture,s));e.addChild(a)}else{const t=new ay(p_[n.textureId].texture);e.addChild(t)}break;case L_.AnimatedSprite:const i=new Av((r=n.textureId,n.frames.map(({x:t,y:e,width:n,height:i})=>new Hp(p_[r].texture,new ip(t,e,n,i)))));i.animationSpeed=n.speed,i.play(),e.addChild(i);break;case L_.Container:const o=t(n);e.addChild(o)}var r})(n,e)),n}(n);t.addChild(r),XT.set(e,r)}}))}(this.container,t.worldState)})),this.moveEvent.pipe(function(t,e=ql,n=y_){return t=>t.lift(new v_(150,e,n.leading,n.trailing))}(),zl(this.destroySubject)).subscribe(t=>{zT.dispatch(function(t){return{type:CT.Move,direction:t}}(t))})})}initContainer(){this.container=new pp,this.container.sortableChildren=!0,this.pixi.app.stage.addChild(this.container)}loadLevel(t){return ra.__awaiter(this,void 0,void 0,function*(){zT.dispatch(function(t){return{type:Xl.Loading,name:t}}(t)),yield this.clean(),this.initContainer(),this.setupAXY(),this.level=yield V(this.gameService.loadLevel(t)).pipe(function(t=-1){return e=>e.lift(new __(t,e))}(1/0)).toPromise(),zT.dispatch(function(t,e){return{type:Xl.Loaded,name:t,level:e}}(t,this.level))})}visibilityChangeListener(){document.hidden?this.stop():this.start()}onResize(t){this.devicePixelRatio=window.devicePixelRatio||1,setTimeout(()=>{zT.dispatch(M_(this.pixi.app.renderer.width,this.pixi.app.renderer.height))},0)}setupAXY(){zT.dispatch(M_(this.pixi.app.renderer.width,this.pixi.app.renderer.height))}move(t){this.moveEvent.next(t)}shot(){zT.dispatch({type:CT.Shot})}clean(){return ra.__awaiter(this,void 0,void 0,function*(){this.stop(),this.container&&this.container.destroy()})}ngOnDestroy(){this.stop(),this.storeSubscribe(),XT.clear(),this.container&&this.container.destroy(),this.destroySubject.next(!0),this.destroySubject.complete()}menuButtonClick(){this.exit.emit()}start(){zT.dispatch(D_())}stop(){zT.dispatch({type:O_.GameStop})}viewedRewardVideo(){this.canWatchAds=!1,zT.dispatch({type:CT.AddLife})}}var YT=Hn({encapsulation:0,styles:[['@import url(https://fonts.googleapis.com/css?family=VT323);.game[_ngcontent-%COMP%]{width:100%;height:100%}.game[_ngcontent-%COMP%]   app-pixi[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}.loading[_ngcontent-%COMP%]{z-index:2;background:#000;width:100vw;height:100vh;position:absolute}.loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:red;font-family:VT323,monospace;font-size:54px}.stats-bar[_ngcontent-%COMP%]{position:absolute;right:10px;top:0;z-index:1}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:32px;font-size:32px;font-family:VT323,monospace;font-weight:700;color:#fff}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]::before{content:"";height:32px;display:block;width:32px;line-height:32px;background-position:center center;float:left}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-left:5px;float:left;line-height:32px}.stats-bar[_ngcontent-%COMP%]   .lives[_ngcontent-%COMP%]::before{background:url(/games/tanks/heart.8693ae5b957ee03faac9.png)}.stats-bar[_ngcontent-%COMP%]   .enemies[_ngcontent-%COMP%]::before{background:#afacb7;-webkit-mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png);mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png)}']],data:{}});function JT(t){return Xo(0,[(t()(),No(0,0,null,null,1,"app-game-over",[],null,[[null,"viewedRewardVideo"],[null,"clickMenu"]],function(t,e,n){var r=!0,i=t.component;return"viewedRewardVideo"===e&&(r=!1!==i.viewedRewardVideo()&&r),"clickMenu"===e&&(r=!1!==i.menuButtonClick()&&r),r},qd,jd)),ni(1,49152,null,0,Vd,[oa],{canWatchAds:[0,"canWatchAds"]},{viewedRewardVideo:"viewedRewardVideo",clickMenu:"clickMenu"})],function(t,e){t(e,1,0,e.component.canWatchAds)},null)}function $T(t){return Xo(0,[Bo(402653184,1,{pixi:0}),(t()(),No(1,0,null,null,2,"div",[["class","loading"]],[[8,"hidden",0]],null,null,null,null)),(t()(),No(2,0,null,null,1,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),zo(-1,null,["Loading..."])),(t()(),Po(16777216,null,null,1,null,JT)),ni(5,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null),(t()(),No(6,0,null,null,0,"div",[["class","stats-bar"]],null,null,null,null,null)),(t()(),No(7,0,null,null,5,"div",[["class","game"]],null,null,null,null,null)),(t()(),No(8,0,null,null,1,"app-pixi",[],null,[["window","resize"]],function(t,e,n){var r=!0;return"window:resize"===e&&(r=!1!==Gr(t,9).resize()&&r),r},Dv,Ov)),ni(9,245760,[[1,4],["pixi",4]],0,Iv,[Ye,$i],{devicePixelRatio:[0,"devicePixelRatio"]},null),(t()(),No(10,0,null,null,1,"app-game-controllers",[],null,[[null,"move"],[null,"shot"],["document","visibilitychange"],["document","keydown"],["document","keyup"]],function(t,e,n){var r=!0,i=t.component;return"document:visibilitychange"===e&&(r=!1!==Gr(t,11).visibilityChangeListener(n)&&r),"document:keydown"===e&&(r=!1!==Gr(t,11).handleKeyDownEvent(n)&&r),"document:keyup"===e&&(r=!1!==Gr(t,11).handleKeyUpEvent(n)&&r),"move"===e&&(r=!1!==i.move(n)&&r),"shot"===e&&(r=!1!==i.shot()&&r),r},Nv,Pv)),ni(11,245760,null,0,kv,[],null,{shot:"shot",move:"move"}),(t()(),No(12,0,null,null,0,"button",[["class","menu-icon menu-button"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.menuButtonClick()&&r),r},null,null))],function(t,e){var n=e.component;t(e,5,0,n.gameOver),t(e,9,0,n.devicePixelRatio),t(e,11,0)},function(t,e){t(e,1,0,!e.component.loading)})}class ZT{constructor(t){this.firestore=t,this.exit=new xi,this.transferInProgress=!1}ngOnInit(){return ra.__awaiter(this,void 0,void 0,function*(){this.aiList=yield this.firestore.aiList()})}transfer(){return ra.__awaiter(this,void 0,void 0,function*(){if(this.transferInProgress)return;this.transferInProgress=!0;const t=this.fromAIId,e=this.toAIId,n=yield this.firestore.loadAI(t);yield this.firestore.updateAI(e,n),this.transferInProgress=!1,this.ngOnInit()})}changeTrained(t){return ra.__awaiter(this,void 0,void 0,function*(){console.log(t);const e=this.firestore;t.ai.data.trainingInfo.trained=!t.ai.data.trainingInfo.trained,yield e.updateAI(t.ai.id+"-info",t.ai.data),yield e.updateAIInfo(t.ai.id,t.ai.data),this.ngOnInit()})}}var tx=Hn({encapsulation:0,styles:[[".main-container[_ngcontent-%COMP%]{padding-top:50px}"]],data:{}});function ex(t){return Xo(0,[(t()(),No(0,0,null,null,7,"div",[],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==(t.component.fromAIId=t.context.$implicit.name)&&r),r},null,null)),(t()(),No(1,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),zo(2,null,["",""])),(t()(),zo(-1,null,[" trained: "])),(t()(),No(4,0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0]],[[null,"change"]],function(t,e,n){var r=!0;return"change"===e&&(r=!1!==t.component.changeTrained(t.context.$implicit)&&r),r},null,null)),(t()(),No(5,0,null,null,2,"pre",[],null,null,null,null,null)),(t()(),zo(6,null,["",""])),ri(0,Ia,[])],null,function(t,e){t(e,2,0,e.context.$implicit.name),t(e,4,0,e.context.$implicit.info.trainingInfo.trained),t(e,6,0,jn(e,6,0,Gr(e,7).transform(e.context.$implicit.info)))})}function nx(t){return Xo(0,[(t()(),No(0,0,null,null,0,"button",[["class","menu-icon menu-button"]],null,[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.exit.emit()&&r),r},null,null)),(t()(),No(1,0,null,null,29,"div",[["class","main-container"]],null,null,null,null,null)),(t()(),No(2,0,null,null,25,"div",[],null,null,null,null,null)),(t()(),zo(-1,null,[" from: "])),(t()(),No(4,0,null,null,5,"input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Gr(t,5)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Gr(t,5).onTouched()&&r),"compositionstart"===e&&(r=!1!==Gr(t,5)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Gr(t,5)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.fromAIId=n)&&r),r},null,null)),ni(5,16384,null,0,$u,[en,Ye,[2,Ju]],null,null),ii(1024,null,Qu,function(t){return[t]},[$u]),ni(7,671744,null,0,jc,[[8,null],[8,null],[8,null],[6,Qu]],{model:[0,"model"]},{update:"ngModelChange"}),ii(2048,null,nc,null,[jc]),ni(9,16384,null,0,rc,[[4,nc]],null,null),(t()(),No(10,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),zo(-1,null,[" to: "])),(t()(),No(12,0,null,null,5,"input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Gr(t,13)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Gr(t,13).onTouched()&&r),"compositionstart"===e&&(r=!1!==Gr(t,13)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Gr(t,13)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.toAIId=n)&&r),r},null,null)),ni(13,16384,null,0,$u,[en,Ye,[2,Ju]],null,null),ii(1024,null,Qu,function(t){return[t]},[$u]),ni(15,671744,null,0,jc,[[8,null],[8,null],[8,null],[6,Qu]],{model:[0,"model"]},{update:"ngModelChange"}),ii(2048,null,nc,null,[jc]),ni(17,16384,null,0,rc,[[4,nc]],null,null),(t()(),No(18,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),zo(-1,null,[" chunkLength: "])),(t()(),No(20,0,null,null,5,"input",[["type","tel"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Gr(t,21)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Gr(t,21).onTouched()&&r),"compositionstart"===e&&(r=!1!==Gr(t,21)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Gr(t,21)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.chunkLength=n)&&r),r},null,null)),ni(21,16384,null,0,$u,[en,Ye,[2,Ju]],null,null),ii(1024,null,Qu,function(t){return[t]},[$u]),ni(23,671744,null,0,jc,[[8,null],[8,null],[8,null],[6,Qu]],{model:[0,"model"]},{update:"ngModelChange"}),ii(2048,null,nc,null,[jc]),ni(25,16384,null,0,rc,[[4,nc]],null,null),(t()(),No(26,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),No(27,0,null,null,0,"input",[["type","submit"]],[[8,"value",0]],[[null,"click"]],function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.transfer()&&r),r},null,null)),(t()(),No(28,0,null,null,2,"div",[["class","list"]],null,null,null,null,null)),(t()(),Po(16777216,null,null,1,null,ex)),ni(30,278528,null,0,ba,[Sn,Tn,gn],{ngForOf:[0,"ngForOf"]},null)],function(t,e){var n=e.component;t(e,7,0,n.fromAIId),t(e,15,0,n.toAIId),t(e,23,0,n.chunkLength),t(e,30,0,n.aiList)},function(t,e){var n=e.component;t(e,4,0,Gr(e,9).ngClassUntouched,Gr(e,9).ngClassTouched,Gr(e,9).ngClassPristine,Gr(e,9).ngClassDirty,Gr(e,9).ngClassValid,Gr(e,9).ngClassInvalid,Gr(e,9).ngClassPending),t(e,12,0,Gr(e,17).ngClassUntouched,Gr(e,17).ngClassTouched,Gr(e,17).ngClassPristine,Gr(e,17).ngClassDirty,Gr(e,17).ngClassValid,Gr(e,17).ngClassInvalid,Gr(e,17).ngClassPending),t(e,20,0,Gr(e,25).ngClassUntouched,Gr(e,25).ngClassTouched,Gr(e,25).ngClassPristine,Gr(e,25).ngClassDirty,Gr(e,25).ngClassValid,Gr(e,25).ngClassInvalid,Gr(e,25).ngClassPending),t(e,27,0,n.transferInProgress?"transfer in progress":"transfer")})}var rx=Hn({encapsulation:0,styles:[["p[_ngcontent-%COMP%]{font-family:Lato}.game[_ngcontent-%COMP%], .map-editor[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}.menu[_ngcontent-%COMP%]{position:absolute;z-index:2}"]],data:{}});function ix(t){return Xo(0,[(t()(),No(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),No(1,0,null,null,1,"app-start-menu",[],null,[[null,"open"]],function(t,e,n){var r=!0;return"open"===e&&(r=!1!==t.component.open(n)&&r),r},La,Na)),ni(2,49152,null,0,Pa,[],null,{open:"open"})],null,null)}function ox(t){return Xo(0,[(t()(),No(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),No(1,0,null,null,1,"app-map-editor",[["class","map-editor"]],null,[[null,"exit"],["window","contextmenu"]],function(t,e,n){var r=!0,i=t.component;return"window:contextmenu"===e&&(r=!1!==Gr(t,2).onResize(n)&&r),"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r},Ud,Md)),ni(2,114688,null,0,Jl,[vn,vd,Fl],null,{exit:"exit"})],function(t,e){t(e,2,0)},null)}function sx(t){return Xo(0,[(t()(),No(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),No(1,0,null,null,1,"app-game",[["class","game"]],null,[[null,"exit"],["document","visibilitychange"],["window","resize"]],function(t,e,n){var r=!0,i=t.component;return"document:visibilitychange"===e&&(r=!1!==Gr(t,2).visibilityChangeListener(n)&&r),"window:resize"===e&&(r=!1!==Gr(t,2).onResize(n)&&r),"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r},$T,YT)),ni(2,4374528,null,0,QT,[m_,$i],null,{exit:"exit"})],null,null)}function ax(t){return Xo(0,[(t()(),No(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),No(1,0,null,null,1,"app-ai-transfer",[],null,[[null,"exit"]],function(t,e,n){var r=!0,i=t.component;return"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r},nx,tx)),ni(2,114688,null,0,ZT,[Fl],null,{exit:"exit"})],function(t,e){t(e,2,0)},null)}function ux(t){return Xo(0,[(t()(),No(0,0,null,null,8,"div",[["class","view"]],null,null,null,null,null)),(t()(),Po(16777216,null,null,1,null,ix)),ni(2,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null),(t()(),Po(16777216,null,null,1,null,ox)),ni(4,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null),(t()(),Po(16777216,null,null,1,null,sx)),ni(6,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null),(t()(),Po(16777216,null,null,1,null,ax)),ni(8,16384,null,0,_a,[Sn,Tn],{ngIf:[0,"ngIf"]},null)],function(t,e){var n=e.component;t(e,2,0,n.opened===n.View.START_MENU),t(e,4,0,n.opened===n.View.MAP_EDITOR),t(e,6,0,n.opened===n.View.GAME),t(e,8,0,n.opened===n.View.AI_TRANSFER)},null)}function cx(t){return Xo(0,[(t()(),No(0,0,null,null,1,"app-root",[],null,null,null,ux,rx)),ni(1,114688,null,0,aa,[oa,sa,Ye],null,null)],function(t,e){t(e,1,0)},null)}var hx=Pr("app-root",aa,cx,{},{},[]);class lx{constructor(){this._firebase=Rl.initializeApp({apiKey:"AIzaSyB49JgIB7uDcnW7QvYPmHCkI_t7_VtSWIU",authDomain:"tanks-game-cb0b2.firebaseapp.com",databaseURL:"https://tanks-game-cb0b2.firebaseio.com",projectId:"tanks-game-cb0b2",storageBucket:"tanks-game-cb0b2.appspot.com",messagingSenderId:"717418892505"})}get firebase(){return this._firebase}}let dx=(()=>(class{}))();const fx=new rn("8.1.1");let px;try{px="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(Dx){px=!1}let mx=(()=>(class{}))();Error;const gx=new rn("8.1.1"),yx=new bt("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}});let vx,bx=(()=>(class{constructor(t,e){this._sanityChecksEnabled=t,this._hammerLoader=e,this._hasDoneGlobalChecks=!1,this._hasCheckedHammer=!1,this._document="object"==typeof document&&document?document:null,this._window="object"==typeof window&&window?window:null,this._areChecksEnabled()&&!this._hasDoneGlobalChecks&&(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_areChecksEnabled(){return this._sanityChecksEnabled&&Jt()&&!this._isTestEnv()}_isTestEnv(){const t=this._window;return t&&(t.__karma__||t.jasmine)}_checkDoctypeIsDefined(){this._document&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._document||!this._document.body||"function"!=typeof getComputedStyle)return;const t=this._document.createElement("div");t.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(t);const e=getComputedStyle(t);e&&"none"!==e.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(t)}_checkCdkVersionMatch(){gx.full!==fx.full&&console.warn("The Angular Material version ("+gx.full+") does not match the Angular CDK version ("+fx.full+").\nPlease ensure the versions of these two packages exactly match.")}_checkHammerIsAvailable(){!this._hasCheckedHammer&&this._window&&(!this._areChecksEnabled()||this._window.Hammer||this._hammerLoader||console.warn("Could not find HammerJS. Certain Angular Material components may not work correctly."),this._hasCheckedHammer=!0)}}))();try{vx="undefined"!=typeof Intl}catch(Dx){vx=!1}let wx=(()=>(class{}))(),_x=(()=>(class{}))();class Ex{}class Tx{}class xx{}class Sx{}class Cx{}class Ax{}var Ix=Zs(na,[aa],function(t){return function(t){const e={},n=[];let r=!1;for(let i=0;i<t.length;i++){const o=t[i];o.token===Nt&&!0===o.value&&(r=!0),1073741824&o.flags&&n.push(o.token),o.index=i,e[Vn(o.token)]=o}return{factory:null,providersByKey:e,providers:t,modules:n,isRoot:r}}([Tr(512,He,ze,[[8,[hx]],[3,He],Ke]),Tr(5120,Li,Oo,[[3,Li]]),Tr(4608,la,da,[Li,[2,ha]]),Tr(5120,bi,Do,[$i]),Tr(4608,Hi,Hi,[]),Tr(5120,Oi,Di,[]),Tr(5120,gn,Ao,[]),Tr(5120,yn,Io,[]),Tr(4608,Fu,Bu,[ka]),Tr(6144,we,null,[Fu]),Tr(4608,Du,Pu,[]),Tr(5120,ru,function(t,e,n,r,i,o,s,a){return[new Iu(t,e,n),new Lu(r),new Nu(i,o,s,a)]},[ka,$i,Ni,ka,ka,Du,Ri,[2,ku]]),Tr(4608,iu,iu,[ru,$i]),Tr(135680,au,au,[ka]),Tr(4608,pu,pu,[iu,au,Oi]),Tr(6144,Ze,null,[pu]),Tr(6144,su,null,[au]),Tr(4608,oo,oo,[$i]),Tr(4608,fc,fc,[]),Tr(4608,Id,Od,[ka,Ni,Cd]),Tr(4608,Dd,Dd,[Id,Ad]),Tr(5120,wd,function(t){return[t]},[Dd]),Tr(4608,xd,xd,[]),Tr(6144,Td,null,[xd]),Tr(4608,Sd,Sd,[Td]),Tr(6144,rd,null,[Sd]),Tr(4608,nd,kd,[rd,Rt]),Tr(4608,vd,vd,[nd]),Tr(4608,lx,lx,[]),Tr(4608,Fl,Fl,[lx]),Tr(4608,m_,m_,[Fl]),Tr(4608,oa,oa,[]),Tr(4608,sa,sa,[]),Tr(1073742336,Da,Da,[]),Tr(1024,Ce,Wu,[]),Tr(1024,Ai,function(t){return[(e=t,tu("probe",nu),tu("coreTokens",Object.assign({},eu,(e||[]).reduce((t,e)=>(t[e.name]=e.token,t),{}))),()=>nu)];var e},[[2,fo]]),Tr(512,Ii,Ii,[[2,Ai]]),Tr(131584,vo,vo,[$i,Ri,Rt,Ce,He,Ii]),Tr(1073742336,ko,ko,[vo]),Tr(1073742336,Ku,Ku,[[3,Ku]]),Tr(1073742336,qc,qc,[]),Tr(1073742336,Gc,Gc,[]),Tr(1073742336,Pd,Pd,[]),Tr(1073742336,Nd,Nd,[]),Tr(1073742336,dx,dx,[]),Tr(1073742336,bx,bx,[[2,yx],[2,ku]]),Tr(1073742336,mx,mx,[]),Tr(1073742336,wx,wx,[]),Tr(1073742336,_x,_x,[]),Tr(1073742336,Ex,Ex,[]),Tr(1073742336,Tx,Tx,[]),Tr(1073742336,xx,xx,[]),Tr(1073742336,Sx,Sx,[]),Tr(1073742336,Cx,Cx,[]),Tr(1073742336,Ax,Ax,[]),Tr(1073742336,na,na,[]),Tr(256,Nt,!0,[]),Tr(256,Cd,"XSRF-TOKEN",[]),Tr(256,Ad,"X-XSRF-TOKEN",[])])});function Ox(){zu().bootstrapModuleFactory(Ix).catch(t=>console.log(t))}n.d(e,"start",function(){return Ox}),ea.production&&function(){if(Yt)throw new Error("Cannot enable prod mode after platform setup.");Qt=!1}(),document.addEventListener("deviceready",function(){Ox(),window.StatusBar.hide()},!1),window.cordova||Ox()},zVF4:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("mrSG"),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw s(e)},s=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},a=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=(15&a)<<2|c>>6,l=63&c;u||(l=64,s||(h=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[h],n[l])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(a(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();r.push(o<<2|s>>4),64!=a&&(r.push(s<<4&240|a>>2),64!=u&&r.push(a<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){try{return u.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=h(t[n],e[n]));return t}var l=function(){function t(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}(),d=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""},f="FirebaseError",p=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=f,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,m.prototype.create),i}return r.__extends(e,t),e}(Error),m=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t,e){void 0===e&&(e={});for(var n=this.service+"/"+t,r=this.errors[t],i=r?function(t,e){return t.replace(g,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(r,e):"Error",o=new p(n,this.serviceName+": "+i+" ("+n+")."),s=0,a=Object.keys(e);s<a.length;s++){var u=a[s];"_"!==u.slice(-1)&&(u in o&&console.warn('Overwriting FirebaseError base field "'+u+'" can cause unexpected behavior.'),o[u]=e[u])}return o},t}(),g=/\{\$([^}]+)}/g;function y(t){return JSON.parse(t)}var v=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=y(c(o[0])||""),n=y(c(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(s){}return{header:e,claims:n,data:r,signature:i}},b=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},w=function(t,e){return b(e,function(e,n){t[e]=n}),t},_=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},E=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++)n[r]=4294967295&((l=n[r-3]^n[r-8]^n[r-14]^n[r-16])<<1|l>>>31);var i,o,s=this.chain_[0],a=this.chain_[1],u=this.chain_[2],c=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(i=c^a&(u^c),o=1518500249):(i=a^u^c,o=1859775393):r<60?(i=a&u|c&(a|u),o=2400959708):(i=a^u^c,o=3395469782);var l=(s<<5|s>>>27)+i+h+o+n[r]&4294967295;h=c,c=u,u=4294967295&(a<<30|a>>>2),a=s,s=l}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}(),T=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=x),void 0===r.error&&(r.error=x),void 0===r.complete&&(r.complete=x);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function x(){}function S(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}e.CONSTANTS=i,e.Deferred=l,e.ErrorFactory=m,e.FirebaseError=p,e.Sha1=E,e.assert=o,e.assertionError=s,e.async=function(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];Promise.resolve(!0).then(function(){t.apply(void 0,n)}).catch(function(t){e&&e(t)})}},e.base64=u,e.base64Decode=c,e.base64Encode=function(t){var e=a(t);return u.encodeByteArray(e,!0)},e.clone=function(t){return w({},t)},e.contains=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.createSubscribe=function(t,e){var n=new T(t,e);return n.subscribe.bind(n)},e.decode=v,e.deepCopy=function(t){return h(void 0,t)},e.deepExtend=h,e.errorPrefix=S,e.every=function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0},e.extend=w,e.findKey=_,e.findValue=function(t,e,n){var r=_(t,e,n);return r&&t[r]},e.forEach=b,e.getAnyKey=function(t){for(var e in t)return e},e.getCount=function(t){var e=0;for(var n in t)e++;return e},e.getUA=d,e.getValues=function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e},e.isAdmin=function(t){var e=v(t).claims;return"object"==typeof e&&!0===e.admin},e.isEmpty=function(t){for(var e in t)return!1;return!0},e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())},e.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},e.isNonNullObject=function(t){return"object"==typeof t&&null!==t},e.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},e.isValidFormat=function(t){var e=v(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e,n,r=v(t).claims,i=Math.floor((new Date).getTime()/1e3);return"object"==typeof r&&(r.hasOwnProperty("nbf")?e=r.nbf:r.hasOwnProperty("iat")&&(e=r.iat),n=r.hasOwnProperty("exp")?r.exp:e+86400),i&&e&&n&&i>=e&&i<=n},e.issuedAtTime=function(t){var e=v(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},e.jsonEval=y,e.map=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},e.patchProperty=function(t,e,n){t[e]=n},e.querystring=function(t){var e=[];return b(t,function(t,n){Array.isArray(n)?n.forEach(function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}),e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach(function(t){if(t){var n=t.split("=");e[n[0]]=n[1]}}),e},e.safeGet=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},e.stringLength=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var s=i-55296;o(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(s<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},e.stringify=function(t){return JSON.stringify(t)},e.validateArgCount=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},e.validateCallback=function(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(S(t,e,r)+"must be a valid function.")},e.validateContextObject=function(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(S(t,e,r)+"must be a valid context object.")},e.validateNamespace=function(t,e,n,r){if((!r||n)&&"string"!=typeof n)throw new Error(S(t,e,r)+"must be a valid firebase namespace.")}},"zkF/":function(t,e,n){var r=n("IutQ"),i=n("3Gxb").f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return s&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(e){return s.slice()}}(t):i(r(t))}},zqkD:function(t,e){function n(){}t.exports=n,n.eq=function(t,e,n){return n=n||0,Math.abs(t-e)<n}}},[[0,0]]]);
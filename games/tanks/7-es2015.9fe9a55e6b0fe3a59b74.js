(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{rZCR:function(t,e,n){"use strict";n.r(e);var s=n("8Y7J");class i{}var o=n("pMnS"),l=n("fGXz"),r=n("AytR");class a{constructor(t,e,n){this.elementRef=t,this.ngZone=e,this.platform=n,this.devicePixelRatio=r.a.ssr?1:window.devicePixelRatio||1,this.applicationOptions={}}init(){r.a.ssr||(this.ngZone.runOutsideAngular(()=>{this.app=new l.Application(this.applicationOptions)}),this.elementRef.nativeElement.appendChild(this.app.view),this.resize())}ngOnInit(){this.init()}resize(){const t=1/this.devicePixelRatio;this.app.renderer.resize(this.elementRef.nativeElement.offsetWidth*this.devicePixelRatio,this.elementRef.nativeElement.offsetHeight*this.devicePixelRatio),this.app.view.style.transform=`scale(${t})`,this.app.view.style.transformOrigin="top left"}destroy(){this.app&&this.app.destroy()}ngOnDestroy(){this.destroy()}}var u=n("/HVE"),c=s.ob({encapsulation:2,styles:[],data:{}});function h(t){return s.Hb(0,[],null,null)}var d=n("HDdC"),p=n("D0XW"),b=n("DH7j");function m(t){const{subscriber:e,counter:n,period:s}=t;e.next(n),this.schedule({subscriber:e,counter:n+1,period:s},s)}class v{constructor(){this.shot=new s.m,this.move=new s.m,this.pressedMoveKeys=new Set,this.pressedShot=!1}ngOnInit(){r.a.ssr||(this.intervalSubscription=function(t=0,e=p.a){var n;return n=t,(Object(b.a)(n)||!(n-parseFloat(n)+1>=0)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=p.a),new d.a(n=>(n.add(e.schedule(m,t,{subscriber:n,counter:0,period:t})),n))}(50).subscribe(()=>{const t=function(t){const e=Array.from(t);return e[e.length-1]}(this.pressedMoveKeys);this.move.emit(t),this.pressedShot&&this.shot.emit()}))}ngOnDestroy(){r.a.ssr||this.intervalSubscription.unsubscribe()}pressShot(t){return t.preventDefault(),t.stopPropagation(),this.pressedShot=!0,!1}releaseShot(t){return t.preventDefault(),t.stopPropagation(),this.pressedShot=!1,!1}release(t){this.pressedMoveKeys.delete(t)}press(t){this.pressedMoveKeys.add(t)}touchmove(t){t.preventDefault(),t.stopPropagation();const e=t.touches.item(0),n=document.elementFromPoint(e.clientX,e.clientY);return this.moveControllers.nativeElement.contains(n)&&n.classList.contains("button")&&(this.pressedMoveKeys.clear(),this.press(n.classList.toString().replace("button","").trim())),!1}touchend(t){return t.preventDefault(),t.stopPropagation(),this.pressedMoveKeys.clear(),!1}handleKeyDownEvent(t){switch(t.key){case"ArrowLeft":this.press("left");break;case"ArrowRight":this.press("right");break;case"ArrowUp":this.press("up");break;case"ArrowDown":this.press("down");break;case" ":this.pressedShot=!0}}handleKeyUpEvent(t){switch(t.key){case"ArrowLeft":this.release("left");break;case"ArrowRight":this.release("right");break;case"ArrowUp":this.release("up");break;case"ArrowDown":this.release("down");break;case" ":this.pressedShot=!1}}}var g=s.ob({encapsulation:0,styles:[[".tank-move-controllers[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:10px;left:10px}.tank-move-controllers[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/arrow-controller.1d1c9cc0c5ca19e42365.png);width:64px;height:64px;position:relative;opacity:.7}.tank-move-controllers[_ngcontent-%COMP%]   .up[_ngcontent-%COMP%]{left:64px;top:64px}.tank-move-controllers[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{top:64px;left:128px;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.tank-move-controllers[_ngcontent-%COMP%]   .down[_ngcontent-%COMP%]{top:64px;left:64px;-webkit-transform:rotate(180deg);transform:rotate(180deg)}.tank-move-controllers[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{top:-64px;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.tank-shot-controller[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:62px;right:55px}.tank-shot-controller[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/shot-controller.c287a59665cc4e5ef601.png);width:85px;height:85px;position:relative;opacity:.7}"]],data:{}});function f(t){return s.Hb(0,[s.Eb(402653184,1,{moveControllers:0}),(t()(),s.qb(1,0,[[1,0],["moveControllers",1]],null,4,"div",[["class","tank-move-controllers"]],null,null,null,null,null)),(t()(),s.qb(2,0,null,null,0,"div",[["class","up button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var s=!0,i=t.component;return"touchstart"===e&&(s=!1!==i.touchmove(n)&&s),"touchmove"===e&&(s=!1!==i.touchmove(n)&&s),"touchend"===e&&(s=!1!==i.touchend(n)&&s),"mousedown"===e&&(s=!1!==i.press("up")&&s),"mouseup"===e&&(s=!1!==i.release("up")&&s),"mouseleave"===e&&(s=!1!==i.release("up")&&s),s}),null,null)),(t()(),s.qb(3,0,null,null,0,"div",[["class","right button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var s=!0,i=t.component;return"touchstart"===e&&(s=!1!==i.touchmove(n)&&s),"touchmove"===e&&(s=!1!==i.touchmove(n)&&s),"touchend"===e&&(s=!1!==i.touchend(n)&&s),"mousedown"===e&&(s=!1!==i.press("right")&&s),"mouseup"===e&&(s=!1!==i.release("right")&&s),"mouseleave"===e&&(s=!1!==i.release("right")&&s),s}),null,null)),(t()(),s.qb(4,0,null,null,0,"div",[["class","down button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var s=!0,i=t.component;return"touchstart"===e&&(s=!1!==i.touchmove(n)&&s),"touchmove"===e&&(s=!1!==i.touchmove(n)&&s),"touchend"===e&&(s=!1!==i.touchend(n)&&s),"mousedown"===e&&(s=!1!==i.press("down")&&s),"mouseup"===e&&(s=!1!==i.release("down")&&s),"mouseleave"===e&&(s=!1!==i.release("down")&&s),s}),null,null)),(t()(),s.qb(5,0,null,null,0,"div",[["class","left button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var s=!0,i=t.component;return"touchstart"===e&&(s=!1!==i.touchmove(n)&&s),"touchmove"===e&&(s=!1!==i.touchmove(n)&&s),"touchend"===e&&(s=!1!==i.touchend(n)&&s),"mousedown"===e&&(s=!1!==i.press("left")&&s),"mouseup"===e&&(s=!1!==i.release("left")&&s),"mouseleave"===e&&(s=!1!==i.release("left")&&s),s}),null,null)),(t()(),s.qb(6,0,null,null,1,"div",[["class","tank-shot-controller"]],null,null,null,null,null)),(t()(),s.qb(7,0,null,null,0,"div",[["class","shot button"]],null,[[null,"touchstart"],[null,"touchend"]],(function(t,e,n){var s=!0,i=t.component;return"touchstart"===e&&(s=!1!==i.pressShot(n)&&s),"touchend"===e&&(s=!1!==i.releaseShot(n)&&s),s}),null,null))],null,null)}var w=n("iInd"),x=n("mrSG"),y=n("ePZZ"),k=n("XNiG"),O=n("xgIS"),_=n("Cfvw"),P=n("1G5W"),C=n("7o/Q");class M{constructor(t){this.total=t}call(t,e){return e.subscribe(new S(t,this.total))}}class S extends C.a{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){++this.count>this.total&&this.destination.next(t)}}var j=n("pLZG"),A=n("lJxs"),R=n("eIep");n("l7GE"),n("ZUHj");const V={leading:!0,trailing:!1};class z{constructor(t,e,n,s){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=s}call(t,e){return e.subscribe(new E(t,this.duration,this.scheduler,this.leading,this.trailing))}}class E extends C.a{constructor(t,e,n,s,i){super(t),this.duration=e,this.scheduler=n,this.leading=s,this.trailing=i,this._hasTrailingValue=!1,this._trailingValue=null}_next(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(L,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))}_complete(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}clearThrottle(){const t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}function L(t){const{subscriber:e}=t;e.clearThrottle()}var q=n("qdB0"),D=n("U2x6"),G=n("vHjY"),T=n("xk4V"),H=n.n(T);const I=t=>t.map(K),K=t=>Object.keys(t).map(e=>{if(!Object.values(G.a).find(t=>t===e))throw new Error(`Wrong enemy tank type: ${e} in map: ${name}`);return new Array(Number(t[e])).fill(0).map(()=>({id:`enemy-${H()()}`,type:e,direction:"down"}))}).reduce((t,e)=>t.concat(e),[]);class Z{constructor(t){this.http=t}loadLevel(t){return this.http.get(`assets/maps/${t}.json`).pipe(Object(A.a)(t=>Object.assign({},t,{enemiesGroups:I(t.enemiesGroups)})))}}var X=n("4g07"),U=n("jcNP"),Y=n("wRQt");const B=(t,e)=>{const n=t.findIndex(t=>t===e);return-1===n||n+1>t.length-1?t[0]:t[n+1]};var W=n("+cCG");class F{constructor(t,e,n,s,i,o){this.gameService=t,this.ngZone=e,this.elRef=n,this.route=s,this.router=i,this.adsService=o,this.gameOver=!1,this.hideControllers=!1,this.canWatchAds=!0,this.moveEvent=new k.a,this.destroySubject=new k.a,this.devicePixelRatio=r.a.ssr?1:window.devicePixelRatio||1,this.levels=["level-1","level-2","level-6"],this.fullscreen=!1}ngAfterViewInit(){return x.__awaiter(this,void 0,void 0,(function*(){r.a.ssr||(this.initContainer(),yield Object(Y.a)(),W.a.dispatch({type:y.a.SetupPIXI,container:this.container}),W.a.dispatch({type:y.a.SetupLevelLoader,nextLevel:t=>this.loadLevel(B(this.levels,t))}),W.a.dispatch({type:y.a.SetupRewardedAd,showRewardedAd:()=>this.adsService.rewardVideo()}),this.setupAXY(),this.route.data.pipe(Object(P.a)(this.destroySubject)).subscribe(t=>x.__awaiter(this,void 0,void 0,(function*(){var e;t.fullscreen&&(this.fullscreen=!0,function(t){return x.__awaiter(this,void 0,void 0,(function*(){yield t.requestFullscreen(),yield window.screen.orientation.lock("landscape")}))}(this.elRef.nativeElement).then(()=>this.onResize()).catch(t=>{console.warn(t)})),W.a.dispatch(t.resume?Object(q.c)():{type:y.a.NewGame}),Object(O.a)(document,"visibilitychange").pipe((e=this.fullscreen?1:0,t=>t.lift(new M(e))),Object(j.a)(()=>document.hidden),Object(A.a)(()=>this.stop()),Object(R.a)(()=>this.router.navigate([".."])),Object(P.a)(this.destroySubject)).subscribe()}))),this.storeSubscribe=this.ngZone.runOutsideAngular(()=>W.a.subscribe(()=>x.__awaiter(this,void 0,void 0,(function*(){const t=W.a.getState();this.gameOver=Object(U.a)(t),this.hideControllers=Object(X.a)(t)})))),this.moveEvent.pipe(function(t,e=p.a,n=V){return s=>s.lift(new z(t,e,n.leading,n.trailing))}(50),Object(P.a)(this.destroySubject)).subscribe(t=>{W.a.dispatch(function(t){return{type:y.a.Move,direction:t}}(t))}))}))}initContainer(){this.container=new l.Container,this.container.sortableChildren=!0,this.pixi.app.stage.addChild(this.container)}loadLevel(t){return x.__awaiter(this,void 0,void 0,(function*(){this.setupAXY(),W.a.dispatch(function(t){return{type:y.a.Loading,name:t}}(t));const e=yield Object(_.a)(this.gameService.loadLevel(t)).toPromise();W.a.dispatch(function(t,e){return{type:y.a.Loaded,name:t,level:e}}(t,e))}))}onResize(){this.devicePixelRatio=window.devicePixelRatio||1,this.setupAXY()}setupAXY(){this.pixi.app.renderer&&W.a.dispatch({type:y.a.UpdateCenter,width:this.pixi.app.renderer.width,height:this.pixi.app.renderer.height,pixelRatio:this.devicePixelRatio})}move(t){this.moveEvent.next(t)}shot(){W.a.dispatch({type:y.a.Shot})}ngOnDestroy(){this.stop(),this.storeSubscribe&&this.storeSubscribe(),this.container&&this.container.destroy(),this.destroySubject.next(!0),this.destroySubject.complete(),this.fullscreen&&function(t){return x.__awaiter(this,void 0,void 0,(function*(){yield t.exitFullscreen()}))}(document).catch(t=>{console.warn(t)})}start(){W.a.dispatch(Object(q.c)())}stop(){W.a.dispatch(Object(q.d)())}}var N=s.ob({encapsulation:0,styles:[['@import url(https://fonts.googleapis.com/css?family=VT323);.game[_ngcontent-%COMP%]{width:100%;height:100%}.game[_ngcontent-%COMP%]   app-pixi[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}.loading[_ngcontent-%COMP%]{z-index:2;background:#000;width:100vw;height:100vh;position:absolute}.loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:red;font-family:VT323,monospace;font-size:54px}.stats-bar[_ngcontent-%COMP%]{position:absolute;right:10px;top:0;z-index:1}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:32px;font-size:32px;font-family:VT323,monospace;font-weight:700}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]::before{content:"";height:32px;display:block;width:32px;line-height:32px;background-position:center center;float:left}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-left:5px;float:left;line-height:32px}.stats-bar[_ngcontent-%COMP%]   .lives[_ngcontent-%COMP%]::before{background:url(/games/tanks/heart.8693ae5b957ee03faac9.png)}.stats-bar[_ngcontent-%COMP%]   .enemies[_ngcontent-%COMP%]::before{background:#afacb7;-webkit-mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png);mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png)}']],data:{}});function $(t){return s.Hb(0,[s.Eb(402653184,1,{pixi:0}),(t()(),s.qb(1,0,null,null,0,"div",[["class","stats-bar"]],null,null,null,null,null)),(t()(),s.qb(2,0,null,null,6,"div",[["class","game"]],null,null,null,null,null)),(t()(),s.qb(3,0,null,null,1,"app-pixi",[],null,[["window","resize"]],(function(t,e,n){var i=!0;return"window:resize"===e&&(i=!1!==s.Bb(t,4).resize()&&i),i}),h,c)),s.pb(4,245760,[[1,4],["pixi",4]],0,a,[s.k,s.x,u.a],{devicePixelRatio:[0,"devicePixelRatio"]},null),(t()(),s.qb(5,0,null,null,1,"app-game-controllers",[],[[8,"hidden",0]],[[null,"move"],[null,"shot"],["document","keydown"],["document","keyup"]],(function(t,e,n){var i=!0,o=t.component;return"document:keydown"===e&&(i=!1!==s.Bb(t,6).handleKeyDownEvent(n)&&i),"document:keyup"===e&&(i=!1!==s.Bb(t,6).handleKeyUpEvent(n)&&i),"move"===e&&(i=!1!==o.move(n)&&i),"shot"===e&&(i=!1!==o.shot()&&i),i}),f,g)),s.pb(6,245760,null,0,v,[],null,{shot:"shot",move:"move"}),(t()(),s.qb(7,0,null,null,1,"button",[["class","menu-icon menu-button"],["routerLink",""]],null,[[null,"click"]],(function(t,e,n){var i=!0;return"click"===e&&(i=!1!==s.Bb(t,8).onClick()&&i),i}),null,null)),s.pb(8,16384,null,0,w.l,[w.k,w.a,[8,null],s.C,s.k],{routerLink:[0,"routerLink"]},null)],(function(t,e){t(e,4,0,e.component.devicePixelRatio),t(e,6,0),t(e,8,0,"")}),(function(t,e){t(e,5,0,e.component.hideControllers)}))}function J(t){return s.Hb(0,[(t()(),s.qb(0,0,null,null,1,"app-game",[],null,[["window","resize"]],(function(t,e,n){var i=!0;return"window:resize"===e&&(i=!1!==s.Bb(t,1).onResize(n)&&i),i}),$,N)),s.pb(1,4374528,null,0,F,[Z,s.x,s.k,w.a,w.k,D.a],null,null)],null,null)}var Q=s.mb("app-game",F,J,{},{},[]),tt=n("SVse"),et=n("IheW");const nt={fullscreen:r.a.production},st={resume:!0,fullscreen:r.a.production};class it{}class ot{}n.d(e,"GameModuleNgFactory",(function(){return lt}));var lt=s.nb(i,[],(function(t){return s.zb([s.Ab(512,s.j,s.Z,[[8,[o.a,Q]],[3,s.j],s.v]),s.Ab(4608,tt.l,tt.k,[s.s,[2,tt.x]]),s.Ab(4608,Z,Z,[et.c]),s.Ab(1073742336,tt.b,tt.b,[]),s.Ab(1073742336,w.n,w.n,[[2,w.s],[2,w.k]]),s.Ab(1073742336,it,it,[]),s.Ab(1073742336,ot,ot,[]),s.Ab(1073742336,i,i,[]),s.Ab(1024,w.i,(function(){return[[{path:"",component:F,data:nt},{path:"resume",component:F,data:st}]]}),[])])}))}}]);
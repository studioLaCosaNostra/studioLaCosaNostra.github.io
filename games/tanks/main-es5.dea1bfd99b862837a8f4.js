function _toArray(t){return _arrayWithHoles(t)||_iterableToArray(t)||_nonIterableRest()}function _defineProperty2(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _construct(t,e,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _get(t,e,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=_superPropBase(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck2(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass2(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+1EK":function(t,e,n){t.exports=o;var r=n("JtD1"),i=n("Wk7T");function o(t,e,n,r){this.minForce=void 0===n?-Number.MAX_VALUE:n,this.maxForce=void 0===r?Number.MAX_VALUE:r,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new i.ARRAY_TYPE(6);for(var a=0;a<6;a++)this.G[a]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}n("RZpa"),o.prototype.constructor=o,o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4,o.prototype.update=function(){var t=this.stiffness,e=this.relaxation,n=this.timeStep;this.a=4/(n*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(n*n*t*(1+4*e)),this.needsUpdate=!1},o.prototype.gmult=function(t,e,n,r,i){return t[0]*e[0]+t[1]*e[1]+t[2]*n+t[3]*r[0]+t[4]*r[1]+t[5]*i},o.prototype.computeB=function(t,e,n){var r=this.computeGW();return-this.computeGq()*t-r*e-this.computeGiMf()*n};var a=r.create(),s=r.create();o.prototype.computeGq=function(){return this.gmult(this.G,a,this.bodyA.angle,s,this.bodyB.angle)+this.offset},o.prototype.computeGW=function(){var t=this.bodyA,e=this.bodyB;return this.gmult(this.G,t.velocity,t.angularVelocity,e.velocity,e.angularVelocity)+this.relativeVelocity},o.prototype.computeGWlambda=function(){var t=this.bodyA,e=this.bodyB;return this.gmult(this.G,t.vlambda,t.wlambda,e.vlambda,e.wlambda)};var u=r.create(),c=r.create();o.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,n=t.angularForce,i=e.force,o=e.angularForce,a=e.invMassSolve,s=t.invInertiaSolve,l=e.invInertiaSolve,h=this.G;return r.scale(u,t.force,t.invMassSolve),r.multiply(u,t.massMultiplier,u),r.scale(c,i,a),r.multiply(c,e.massMultiplier,c),this.gmult(h,u,n*s,c,o*l)},o.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,n=t.invMassSolve,r=e.invMassSolve,i=this.G;return i[0]*i[0]*n*t.massMultiplier[0]+i[1]*i[1]*n*t.massMultiplier[1]+i[2]*i[2]*t.invInertiaSolve+i[3]*i[3]*r*e.massMultiplier[0]+i[4]*i[4]*r*e.massMultiplier[1]+i[5]*i[5]*e.invInertiaSolve};var l=r.create(),h=r.create(),f=r.create();r.create(),r.create(),r.create(),o.prototype.addToWlambda=function(t){var e=this.bodyA,n=this.bodyB,i=l,o=h,a=f,s=e.invMassSolve,u=n.invMassSolve,c=e.invInertiaSolve,d=n.invInertiaSolve,p=this.G;o[0]=p[0],o[1]=p[1],a[0]=p[3],a[1]=p[4],r.scale(i,o,s*t),r.multiply(i,i,e.massMultiplier),r.add(e.vlambda,e.vlambda,i),e.wlambda+=c*p[2]*t,r.scale(i,a,u*t),r.multiply(i,i,n.massMultiplier),r.add(n.vlambda,n.vlambda,i),n.wlambda+=d*p[5]*t},o.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},"+nTh":function(t,e){function n(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}t.exports=n,n.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},"/bTq":function(t){t.exports=JSON.parse('{"_args":[["p2@0.7.1","/tmp/build/1fb68066/game-repo"]],"_from":"p2@0.7.1","_id":"p2@0.7.1","_inBundle":false,"_integrity":"sha1-JfJHTZvDptMUCh2iamfJ4RislUM=","_location":"/p2","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"p2@0.7.1","name":"p2","escapedName":"p2","rawSpec":"0.7.1","saveSpec":null,"fetchSpec":"0.7.1"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/p2/-/p2-0.7.1.tgz","_spec":"0.7.1","_where":"/tmp/build/1fb68066/game-repo","author":{"name":"Stefan Hedman","email":"schteppe@gmail.com","url":"http://steffe.se"},"bugs":{"url":"https://github.com/schteppe/p2.js/issues"},"dependencies":{"poly-decomp":"0.1.1"},"description":"A JavaScript 2D physics engine.","devDependencies":{"grunt":"^0.4.5","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0"},"engines":{"node":"*"},"homepage":"https://github.com/schteppe/p2.js#readme","keywords":["p2.js","p2","physics","engine","2d"],"licenses":[{"type":"MIT"}],"main":"./src/p2.js","name":"p2","repository":{"type":"git","url":"git+https://github.com/schteppe/p2.js.git"},"version":"0.7.1"}')},0:function(t,e,n){t.exports=n("zUnb")},"0DzJ":function(t,e,n){var r=n("+1EK"),i=n("JtD1");function o(t,e,n){n=n||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0;var i=this.G;i[2]=1,i[5]=-1}t.exports=o,(o.prototype=new r).constructor=o;var a=i.create(),s=i.create(),u=i.fromValues(1,0),c=i.fromValues(0,1);o.prototype.computeGq=function(){return i.rotate(a,u,this.bodyA.angle+this.angle),i.rotate(s,c,this.bodyB.angle),i.dot(a,s)}},"0pMi":function(t,e,n){t.exports=i;var r=n("Wk7T");function i(t,e,n,i){this.type=n,i=r.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(t){for(var e=this.equations,n=0;n!==e.length;n++){var r=e[n];r.stiffness=t,r.needsUpdate=!0}},i.prototype.setRelaxation=function(t){for(var e=this.equations,n=0;n!==e.length;n++){var r=e[n];r.relaxation=t,r.needsUpdate=!0}}},"1eSL":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e,n,r){void 0===n&&(n=!1),i(this,t),this._fn=e,this._once=n,this._thisArg=r,this._next=this._prev=this._owner=null}return r(t,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),t}();function a(t,e){return t._head?(t._tail._next=e,e._prev=t._tail,t._tail=e):(t._head=e,t._tail=e),e._owner=t,e}var s=function(){function t(){i(this,t),this._head=this._tail=void 0}return r(t,[{key:"handlers",value:function(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],e=this._head;if(t)return!!e;for(var n=[];e;)n.push(e),e=e._next;return n}},{key:"has",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}},{key:"dispatch",value:function(){var t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}},{key:"add",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#add(): First arg must be a Function.");return a(this,new o(t,!1,e))}},{key:"once",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof t)throw new Error("MiniSignal#once(): First arg must be a Function.");return a(this,new o(t,!0,e))}},{key:"detach",value:function(t){if(!(t instanceof o))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,null===t._next&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}},{key:"detachAll",value:function(){var t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}]),t}();s.MiniSignalBinding=o,e.default=s,t.exports=e.default},"1vck":function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),this.radius=(t=t||{}).radius||1,t.type=r.CIRCLE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e,n){var r=this.radius;i.set(t.upperBound,r,r),i.set(t.lowerBound,-r,-r),e&&(i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e))};var a=i.create(),s=i.create();o.prototype.raycast=function(t,e,n,r){var o=e.from,u=e.to,c=this.radius,l=Math.pow(u[0]-o[0],2)+Math.pow(u[1]-o[1],2),h=2*((u[0]-o[0])*(o[0]-n[0])+(u[1]-o[1])*(o[1]-n[1])),f=Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2)-Math.pow(c,2),d=Math.pow(h,2)-4*l*f,p=a,v=s;if(!(d<0))if(0===d)i.lerp(p,o,u,d),i.sub(v,p,n),i.normalize(v,v),e.reportIntersection(t,d,v,-1);else{var m=Math.sqrt(d),y=1/(2*l),g=(-h-m)*y,b=(-h+m)*y;if(g>=0&&g<=1&&(i.lerp(p,o,u,g),i.sub(v,p,n),i.normalize(v,v),e.reportIntersection(t,g,v,-1),t.shouldStop(e)))return;b>=0&&b<=1&&(i.lerp(p,o,u,b),i.sub(v,p,n),i.normalize(v,v),e.reportIntersection(t,b,v,-1))}}},"22PD":function(t,e,n){var r=n("0pMi"),i=n("+1EK"),o=n("JtD1"),a=n("Wk7T");function s(t,e,n){n=a.defaults(n,{localAnchorA:[0,0],localAnchorB:[0,0]}),r.call(this,t,e,r.DISTANCE,n),this.localAnchorA=o.fromValues(n.localAnchorA[0],n.localAnchorA[1]),this.localAnchorB=o.fromValues(n.localAnchorB[0],n.localAnchorB[1]);var s,u=this.localAnchorA,c=this.localAnchorB;if(this.distance=0,"number"==typeof n.distance)this.distance=n.distance;else{var l=o.create(),h=o.create(),f=o.create();o.rotate(l,u,t.angle),o.rotate(h,c,e.angle),o.add(f,e.position,h),o.sub(f,f,l),o.sub(f,f,t.position),this.distance=o.length(f)}s=void 0===n.maxForce?Number.MAX_VALUE:n.maxForce;var d=new i(t,e,-s,s);this.equations=[d],this.maxForce=s,f=o.create();var p=o.create(),v=o.create(),m=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,n=t.position,r=e.position;return o.rotate(p,u,t.angle),o.rotate(v,c,e.angle),o.add(f,r,v),o.sub(f,f,p),o.sub(f,f,n),o.length(f)-m.distance},this.setMaxForce(s),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}t.exports=s,(s.prototype=new r).constructor=s;var u=o.create(),c=o.create(),l=o.create();s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=t.position,r=e.position,i=this.equations[0],a=this.equations[0].G;o.rotate(c,this.localAnchorA,t.angle),o.rotate(l,this.localAnchorB,e.angle),o.add(u,r,l),o.sub(u,u,c),o.sub(u,u,n),this.position=o.length(u);var s=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(i.maxForce=0,i.minForce=-this.maxForce,this.distance=this.upperLimit,s=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(i.maxForce=this.maxForce,i.minForce=0,this.distance=this.lowerLimit,s=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||s){i.enabled=!0,o.normalize(u,u);var h=o.crossLength(c,u),f=o.crossLength(l,u);a[0]=-u[0],a[1]=-u[1],a[2]=-h,a[3]=u[0],a[4]=u[1],a[5]=f}else i.enabled=!1},s.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},s.prototype.getMaxForce=function(){return this.equations[0].maxForce}},"2Vfd":function(t,e,n){var r=n("fq9q"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},"3Jud":function(t,e,n){var r=n("RZpa");function i(){this.equations=[],this.bodies=[]}t.exports=i,i.prototype.reset=function(){this.equations.length=this.bodies.length=0};var o=[];i.prototype.getBodies=function(t){var e=t||[],n=this.equations;o.length=0;for(var r=0;r!==n.length;r++){var i=n[r];-1===o.indexOf(i.bodyA.id)&&(e.push(i.bodyA),o.push(i.bodyA.id)),-1===o.indexOf(i.bodyB.id)&&(e.push(i.bodyB),o.push(i.bodyB.id))}return e},i.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep)return!1}return!0},i.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},"3UD+":function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},"4fRq":function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},"5HXA":function(t,e,n){"use strict";var r=n("ANjH").compose;e.__esModule=!0,e.composeWithDevTools="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?r:r.apply(null,arguments)},e.devToolsEnhancer="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__:function(){return function(t){return t}}},"5xXB":function(t,e,n){n("JtD1"),n("3Jud"),n("+nTh");var r=n("vgT8"),i=n("RJ5M"),o=n("RZpa");function a(t){this.nodePool=new r({size:16}),this.islandPool=new i({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}t.exports=a,a.getUnvisitedNode=function(t){for(var e=t.length,n=0;n!==e;n++){var r=t[n];if(!r.visited&&r.body.type===o.DYNAMIC)return r}return!1},a.prototype.visit=function(t,e,n){e.push(t.body);for(var r=t.equations.length,i=0;i!==r;i++){var o=t.equations[i];-1===n.indexOf(o)&&n.push(o)}},a.prototype.bfs=function(t,e,n){var r=this.queue;for(r.length=0,r.push(t),t.visited=!0,this.visit(t,e,n);r.length;)for(var i,s=r.pop();i=a.getUnvisitedNode(s.neighbors);)i.visited=!0,this.visit(i,e,n),i.body.type===o.DYNAMIC&&r.push(i)},a.prototype.split=function(t){for(var e=t.bodies,n=this.nodes,r=this.equations;n.length;)this.nodePool.release(n.pop());for(var i=0;i!==e.length;i++){var o=this.nodePool.get();o.body=e[i],n.push(o)}for(var s=0;s!==r.length;s++){var u=r[s],c=(i=e.indexOf(u.bodyA),e.indexOf(u.bodyB)),l=n[i],h=n[c];l.neighbors.push(h),h.neighbors.push(l),l.equations.push(u),h.equations.push(u)}var f,d=this.islands;for(i=0;i<d.length;i++)this.islandPool.release(d[i]);for(d.length=0;f=a.getUnvisitedNode(n);){var p=this.islandPool.get();this.bfs(f,p.bodies,p.equations),d.push(p)}return d}},"6Joi":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i=(r=n("wj3C"))&&"object"==typeof r&&"default"in r?r.default:r,o=n("mrSG"),a=n("q/0M"),s=n("zVF4"),u=n("S+S0"),c=n("x7I3"),l=i.SDK_VERSION,h=new a.Logger("@firebase/firestore"),f=function(t){return t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT",t}({});function d(){return h.logLevel===a.LogLevel.DEBUG?f.DEBUG:h.logLevel===a.LogLevel.SILENT?f.SILENT:f.ERROR}function p(t){switch(t){case f.DEBUG:h.logLevel=a.LogLevel.DEBUG;break;case f.ERROR:h.logLevel=a.LogLevel.ERROR;break;case f.SILENT:h.logLevel=a.LogLevel.SILENT;break;default:h.error("Firestore ("+l+"): Invalid value passed to `setLogLevel`")}}function v(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(h.logLevel<=a.LogLevel.DEBUG){var i=n.map(y);h.debug.apply(h,o.__spreadArrays(["Firestore ("+l+") ["+t+"]: "+e],i))}}function m(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(h.logLevel<=a.LogLevel.ERROR){var r=e.map(y);h.error.apply(h,o.__spreadArrays(["Firestore ("+l+"): "+t],r))}}function y(t){if("string"==typeof t)return t;var e=_.getPlatform();try{return e.formatJSON(t)}catch(n){return t}}function g(t){var e="FIRESTORE ("+l+") INTERNAL ASSERTION FAILED: "+t;throw m(e),new Error(e)}function b(t,e){t||g(e)}var _=function(){function t(){}return t.setPlatform=function(e){t.platform&&g("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||g("Platform not set"),t.platform},t}();function w(){return _.getPlatform().emptyByteString}var E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return o.__extends(e,t),e}(Error);function T(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new x(E.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function k(t,e){return void 0!==t?t:e}function S(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function A(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function I(t){for(var e in b(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function O(t,e){if(0!==e.length)throw new x(E.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+X(e.length,"argument")+".")}function P(t,e,n){if(e.length!==n)throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires "+X(n,"argument")+", but was called with "+X(e.length,"argument")+".")}function D(t,e,n){if(e.length<n)throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires at least "+X(n,"argument")+", but was called with "+X(e.length,"argument")+".")}function N(t,e,n,r){if(e.length<n||e.length>r)throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+X(e.length,"argument")+".")}function R(t,e,n,r){V(t,e,K(n)+" argument",r)}function M(t,e,n,r){void 0!==r&&R(t,e,n,r)}function L(t,e,n,r){V(t,e,n+" option",r)}function B(t,e,n,r){void 0!==r&&L(t,e,n,r)}function F(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(q(u))}var c=q(r);throw new x(E.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function U(t,e,n,r){if(!e.some((function(t){return t===r})))throw new x(E.INVALID_ARGUMENT,"Invalid value "+q(r)+" provided to function "+t+"() for its "+K(n)+" argument. Acceptable values: "+e.join(", "))}function V(t,e,n,r){if(!("object"===e?j(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=q(r);throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function j(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function q(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":g("Unknown wrong type: "+typeof t)}function G(t,e,n){if(void 0===n)throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+K(e)+" argument, but it was undefined.")}function z(t,e,n){A(e,(function(e,r){if(n.indexOf(e)<0)throw new x(E.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function H(t,e,n,r){var i=q(r);return new x(E.INVALID_ARGUMENT,"Function "+t+"() requires its "+K(n)+" argument to be a "+e+", but it was: "+i)}function W(t,e,n){if(n<=0)throw new x(E.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+K(e)+" argument to be a positive number, but it was: "+n+".")}function K(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function X(t,e){return t+" "+e+(1===t?"":"s")}var Y=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return b(20===e.length,"Invalid auto ID: "+e),e},t}();function Q(t,e){return t<e?-1:t>e?1:0}function J(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function Z(t){return t+"\0"}function $(){if("undefined"==typeof Uint8Array)throw new x(E.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function tt(){if(!_.getPlatform().base64Available)throw new x(E.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var et=function(){function t(t){tt(),this._binaryString=t}return t.fromBase64String=function(e){P("Blob.fromBase64String",arguments,1),R("Blob.fromBase64String","string",1,e),tt();try{var n=_.getPlatform().atob(e);return new t(n)}catch(r){throw new x(E.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+r)}},t.fromUint8Array=function(e){if(P("Blob.fromUint8Array",arguments,1),$(),!(e instanceof Uint8Array))throw H("Blob.fromUint8Array","Uint8Array",1,e);var n=Array.prototype.map.call(e,(function(t){return String.fromCharCode(t)})).join("");return new t(n)},t.prototype.toBase64=function(){return P("Blob.toBase64",arguments,0),tt(),_.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){P("Blob.toUint8Array",arguments,0),$();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return Q(this._binaryString,t._binaryString)},t}(),nt=T(et,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),rt=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},it="(default)",ot=function(){function t(t,e){this.projectId=t,this.database=e||it}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===it},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return Q(this.projectId,t.projectId)||Q(this.database,t.database)},t}(),at=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),st=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&g("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&g("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return b(this.length>=(t=void 0===t?1:t),"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return b(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return b(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return b(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new x(E.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.EMPTY_PATH=new e([]),e}(st),ct=/^[_a-zA-Z][_a-zA-Z0-9]*$/,lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ct.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new x(E.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new x(E.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new x(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new x(E.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(st),ht=function(){function t(e){this.path=e,b(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ut.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ut.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ut(e.slice()))},t.fromPathString=function(e){return new t(ut.fromString(e))},t.EMPTY=new t(new ut([])),t}(),ft=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},dt=function(t){return t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection",t.RetryTransaction="retry_transaction",t}({}),pt=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ft,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new x(E.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),vt=function(){function t(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueAndInitiateShutdown=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise((function(t){})):this.enqueueInternal(t)},t.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then((function(){return e.operationInProgress=!0,t().catch((function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw m("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.operationInProgress=!1,t}))}));return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),b(e>=0,"Attempted to schedule an operation with a negative delay of "+e),this.timerIdsToSkip.indexOf(t)>-1&&(e=0);var i=pt.createAndSchedule(this,t,e,n,(function(t){return r.removeDelayedOperation(t)}));return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&g("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){b(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueueEvenAfterShutdown((function(){return Promise.resolve()}))},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then((function(){b(t===dt.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==dt.All&&i.timerId===t)break}return e.drain()}))},t.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);b(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),mt="\x01",yt="\x01",gt="\x10",bt="\x11";function _t(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Et(e)),e=wt(t.get(n),e);return Et(e)}function wt(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=mt+gt;break;case mt:n+=mt+bt;break;default:n+=o}}return n}function Et(t){return t+mt+yt}function xt(t){var e=t.length;if(b(e>=2,"Invalid path "+t),2===e)return b(t.charAt(0)===mt&&t.charAt(1)===yt,"Non-empty path "+t+" had length 2"),ut.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(mt,o);switch((a<0||a>n)&&g('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case yt:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case gt:i+=t.substring(o,a),i+="\0";break;case bt:i+=t.substring(o,a+1);break;default:g('Invalid encoded resource path: "'+t+'"')}o=a+2}return new ut(r)}var Tt=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Q(this.nanoseconds,t.nanoseconds):Q(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),Ct=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new Tt(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new Tt(0,0)),t}(),kt=function(){function t(t,e){this.comparator=t,this.root=e||At.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,At.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,At.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new St(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new St(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new St(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new St(this.root,t,this.comparator,!0)},t}(),St=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){b(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),At=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw g("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw g("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw g("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),It=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw g("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw g("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw g("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw g("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw g("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new At(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();At.EMPTY=new It;var Ot=function(){function t(t){this.comparator=t,this.data=new kt(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach((function(t){n=n.add(t)})),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Pt(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Pt(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Pt=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Dt=new kt(ht.comparator);function Nt(){return Dt}function Rt(){return Nt()}var Mt=new kt(ht.comparator);function Lt(){return Mt}var Bt=new kt(ht.comparator);function Ft(){return Bt}var Ut=new Ot(ht.comparator);function Vt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ut,r=0,i=t;r<i.length;r++)n=n.add(i[r]);return n}var jt=new Ot(Q);function qt(){return jt}var Gt=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,b(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&b(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;b(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=o.applyToRemoteDocument(e,r[i]))}return e},t.prototype.applyToLocalView=function(t,e){e&&b(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Vt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&J(this.mutations,t.mutations)&&J(this.baseMutations,t.baseMutations)},t}(),zt=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){b(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Ft(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),Ht=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&g("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(r){return t.reject(r)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),Wt="SimpleDb",Kt=function(){function t(e){this.db=e,12.2===t.getIOSVersion(s.getUA())&&m("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.openOrCreate=function(e,n,r){return b(t.isAvailable(),"IndexedDB not supported in current environment."),v(Wt,"Opening database:",e),new Ht((function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){i(new t(e.target.result))},a.onblocked=function(){o(new x(E.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;o("VersionError"===e.name?new x(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):e)},a.onupgradeneeded=function(t){v(Wt,'Database "'+e+'" requires upgrade from version:',t.oldVersion),r.createOrUpgrade(t.target.result,a.transaction,t.oldVersion,nn).next((function(){v(Wt,"Database upgrade to version "+nn+" complete")}))}})).toPromise()},t.delete=function(t){return v(Wt,"Removing database:",t),Jt(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(t.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var e=s.getUA(),n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.isMockPersistence=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.USE_MOCK_PERSISTENCE)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var r,i,a,s,u,c;return o.__generator(this,(function(l){switch(l.label){case 0:r=t.startsWith("readonly"),i=t.endsWith("idempotent"),a=0,s=function(){var t,s,c,l;return o.__generator(this,(function(o){switch(o.label){case 0:++a,t=Yt.open(u.db,r?"readonly":"readwrite",e),o.label=1;case 1:return o.trys.push([1,3,,4]),(s=n(t).catch((function(e){return t.abort(e),Ht.reject(e)})).toPromise()).catch((function(){})),[4,t.completionPromise];case 2:return o.sent(),[2,{value:s}];case 3:return c=o.sent(),v(Wt,"Transaction failed with error: %s. Retrying: %s.",c.message,l=i&&"FirebaseError"!==c.name&&a<3),l?[3,4]:[2,{value:Promise.reject(c)}];case 4:return[2]}}))},u=this,l.label=1;case 1:return[5,s()];case 2:return"object"==typeof(c=l.sent())?[2,c.value]:[3,1];case 3:return[2]}}))}))},t.prototype.close=function(){this.db.close()},t}(),Xt=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return Jt(this.dbCursor.delete())},t}(),Yt=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new ft,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=$t(t.target.error);e.completionDeferred.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(v(Wt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return b(!!e,"Object store not part of transaction: "+t),new Qt(e)},t}(),Qt=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(v(Wt,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(v(Wt,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Jt(n)},t.prototype.add=function(t){return v(Wt,"ADD",this.store.name,t,t),Jt(this.store.add(t))},t.prototype.get=function(t){var e=this;return Jt(this.store.get(t)).next((function(n){return void 0===n&&(n=null),v(Wt,"GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return v(Wt,"DELETE",this.store.name,t),Jt(this.store.delete(t))},t.prototype.count=function(){return v(Wt,"COUNT",this.store.name),Jt(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.deleteAll=function(t,e){v(Wt,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,(function(t,e,n){return n.delete()}))},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new Ht((function(n,r){e.onerror=function(t){var e=$t(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.iterateCursor=function(t,e){var n=[];return new Ht((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Xt(i),a=e(i.primaryKey,i.value,o);if(a instanceof Ht){var s=a.catch((function(t){return o.done(),Ht.reject(t)}));n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}})).next((function(){return Ht.waitFor(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(b(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Jt(t){return new Ht((function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=$t(t.target.error);n(e)}}))}var Zt=!1;function $t(t){var e=Kt.getIOSVersion(s.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new x("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Zt||(Zt=!0,setTimeout((function(){throw r}),0)),r}}return t}var te=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return b(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ie(t).iterate({index:un.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next((function(e){return e.lastStreamToken=re(n),ae(t).put(e)}))},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next((function(t){return t.lastStreamToken}))},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next((function(n){return n.lastStreamToken=re(e),ae(t).put(n)}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=oe(t),a=ie(t);return a.add({}).next((function(s){b("number"==typeof s,"Auto-generated key is not a number");for(var u=new Gt(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u),l=[],h=new Ot((function(t,e){return Q(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],v=cn.key(i.userId,p.key.path,s);h=h.add(p.key.path.popLast()),l.push(a.put(c)),l.push(o.put(v,cn.PLACEHOLDER))}return h.forEach((function(e){l.push(i.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.documentKeysByBatchId[s]=u.keys()})),Ht.waitFor(l).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return ie(t).get(e).next((function(t){return t?(b(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null}))},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?Ht.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ie(t).iterate({index:un.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(b(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ie(t).iterate({index:un.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ie(t).loadAll(un.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.fromDbMutationBatch(t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=cn.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return oe(t).iterate({range:i},(function(r,i,a){var s=r[0],u=r[2],c=xt(r[1]);if(s===n.userId&&e.path.isEqual(c))return ie(t).get(u).next((function(t){if(!t)throw g("Dangling document-mutation reference found: "+r+" which points to "+u);b(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+u),o.push(n.serializer.fromDbMutationBatch(t))}));a.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ot(Q),i=[];return e.forEach((function(e){var o=cn.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=oe(t).iterate({range:a},(function(t,i,o){var a=t[0],s=t[2],u=xt(t[1]);a===n.userId&&e.path.isEqual(u)?r=r.add(s):o.done()}));i.push(s)})),Ht.waitFor(i).next((function(){return n.lookupMutationBatches(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;b(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),b(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=cn.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new Ot(Q);return oe(t).iterate({range:a},(function(t,e,o){var a=t[0],u=t[2],c=xt(t[1]);a===n.userId&&r.isPrefixOf(c)?c.length===i&&(s=s.add(u)):o.done()})).next((function(){return n.lookupMutationBatches(t,s)}))},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ie(t).get(e).next((function(t){if(null===t)throw g("Dangling document-mutation reference found, which points to "+e);b(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))})))})),Ht.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return ne(t.simpleDbTransaction,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.removeCachedMutationKeys(e.batchId)})),Ht.forEach(r,(function(e){return n.referenceDelegate.removeMutationReference(t,e)}))}))},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return Ht.resolve();var r=IDBKeyRange.lowerBound(cn.prefixForUser(e.userId)),i=[];return oe(t).iterate({range:r},(function(t,n,r){if(t[0]===e.userId){var o=xt(t[1]);i.push(o)}else r.done()})).next((function(){b(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.canonicalString()})))}))}))},t.prototype.containsKey=function(t,e){return ee(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return ae(t).get(this.userId).next((function(t){return t||new sn(e.userId,-1,"")}))},t}();function ee(t,e,n){var r=cn.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return oe(t).iterate({range:o,keysOnly:!0},(function(t,n,r){t[0]===e&&t[1]===i&&(a=!0),r.done()})).next((function(){return a}))}function ne(t,e,n){var r=t.store(un.store),i=t.store(cn.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},(function(t,e,n){return s++,n.delete()}));o.push(u.next((function(){b(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var c=[],l=0,h=n.mutations;l<h.length;l++){var f=h[l],d=cn.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ht.waitFor(o).next((function(){return c}))}function re(t){return t instanceof Uint8Array?(b(Kt.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function ie(t){return Un.getStore(t,un.store)}function oe(t){return Un.getStore(t,cn.store)}function ae(t){return Un.getStore(t,sn.store)}var se=1,ue=function(t){return t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine",t}({}),ce=function(){function t(t,e){this.generatorId=t,b((t&se)===t,"Generator ID "+t+" contains more than "+se+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<se,t},t.prototype.after=function(t){return this.seek(t+(1<<se)),this.next()},t.prototype.seek=function(t){b((t&se)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forTargetCache=function(){return new t(ue.QueryCache,2)},t.forSyncEngine=function(){return new t(ue.SyncEngine)},t}(),le=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=ce.forTargetCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next((function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next((function(t){return Ct.fromTimestamp(new Tt(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return de(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.saveTargetData(t,e).next((function(){return n.retrieveMetadata(t).next((function(r){return r.targetCount+=1,n.updateMetadataFromTargetData(e,r),n.saveMetadata(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return he(t).delete(e.targetId)})).next((function(){return n.retrieveMetadata(t)})).next((function(e){return b(e.targetCount>0,"Removing from an empty target cache"),e.targetCount-=1,n.saveMetadata(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return he(t).iterate((function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return Ht.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){var n=this;return he(t).iterate((function(t,r){var i=n.serializer.fromDbTarget(r);e(i)}))},t.prototype.retrieveMetadata=function(t){return fe(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,Un.getStore(n,mn.store)).put(mn.key,e);var n},t.prototype.saveTargetData=function(t,e){return he(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return he(t).iterate({range:i,index:pn.queryTargetsIndexName},(function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.target)&&(o=a,i.done())})).next((function(){return o}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=pe(t);return e.forEach((function(e){var a=_t(e.path);i.push(o.put(new vn(n,a))),i.push(r.referenceDelegate.addReference(t,e))})),Ht.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=pe(t);return Ht.forEach(e,(function(e){var o=_t(e.path);return Ht.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=pe(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=pe(t),i=Vt();return r.iterate({range:n,keysOnly:!0},(function(t,e,n){var r=xt(t[1]),o=new ht(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=_t(e.path),r=IDBKeyRange.bound([n],[Z(n)],!1,!0),i=0;return pe(t).iterate({index:vn.documentTargetsIndex,keysOnly:!0,range:r},(function(t,e,n){0!==t[0]&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.getTargetDataForTarget=function(t,e){var n=this;return he(t).get(e).next((function(t){return t?n.serializer.fromDbTarget(t):null}))},t}();function he(t){return Un.getStore(t,pn.store)}function fe(t){return Kt.getStore(t,mn.store).get(mn.key).next((function(t){return b(null!==t,"Missing metadata row."),t}))}function de(t){return fe(t).next((function(t){return t.highestListenSequenceNumber}))}function pe(t){return Un.getStore(t,vn.store)}var ve=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new Ot(lt.comparator);return e.forEach((function(t){return n=n.add(t)})),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach((function(n){n.isPrefixOf(t)&&(e=!0)})),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),me=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),ye=function(t,e){this.version=t,this.transformResults=e},ge=function(t){return t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete",t}({}),be=function(){function t(t,e){this.updateTime=t,this.exists=e,b(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof ze&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof ze:(b(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return n=t.updateTime,(null!=(e=this.updateTime)?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),_e=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&b(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof ze?t.version:Ct.MIN},t}(),we=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=ge.Set,i}return o.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),b(null==e.transformResults,"Transform results received by SetMutation."),new ze(this.key,e.version,{hasCommittedMutations:!0},this.value)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=_e.getPostMutationVersion(t);return new ze(this.key,r,{hasLocalMutations:!0},this.value)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(_e),Ee=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=ge.Patch,o}return o.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),b(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new We(this.key,e.version);var n=this.patchDocument(t);return new ze(this.key,e.version,{hasCommittedMutations:!0},n)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=_e.getPostMutationVersion(t),i=this.patchDocument(t);return new ze(this.key,r,{hasLocalMutations:!0},i)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof ze?t.data():je.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}})),t},e}(_e),xe=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=ge.Transform,r.precondition=be.exists(!0),r}return o.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),b(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new We(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new ze(this.key,i,{hasCommittedMutations:!0},o)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new ze(this.key,r.version,{hasLocalMutations:!0},o)},e.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof ze?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?je.EMPTY.set(i.field,a):e.set(i.field,a))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&J(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){return b(t instanceof ze,"Unknown MaybeDocument type "+t),b(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},e.prototype.serverTransformResults=function(t,e){var n=[];b(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof ze&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof ze&&(u=e.field(a.field)),null===u&&n instanceof ze&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},e.prototype.transformObject=function(t,e){b(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++)t=t.set(this.fieldTransforms[n].field,e[n]);return t},e}(_e),Te=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=ge.Delete,r}return o.__extends(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),b(null==e.transformResults,"Transform results received by DeleteMutation."),new He(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&b(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new He(this.key,Ct.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(_e),Ce=function(t){return t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue",t}({}),ke=function(t){return t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous",t}({}),Se=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(ke.Estimate,n);case"previous":return new t(ke.Previous,n);case"none":case void 0:return new t(ke.Default,n);default:return g("fromSnapshotOptions() called with invalid options.")}},t}(),Ae=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return b(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Q(this.typeOrder,t.typeOrder)},t}(),Ie=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=Ce.NullValue,e.internalValue=null,e}return o.__extends(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(Ae),Oe=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.BooleanValue,n}return o.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Q(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(Ae),Pe=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.NumberValue,n}return o.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue)<(r=t.internalValue)?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1:this.defaultCompareTo(t);var n,r},e}(Ae);function De(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.isEqual=function(t){return t instanceof e&&De(this.internalValue,t.internalValue)},e}(Pe),Re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.isEqual=function(t){return t instanceof e&&De(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Pe),Me=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.StringValue,n}return o.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?Q(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(Ae),Le=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.TimestampValue,n}return o.__extends(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Be?-1:this.defaultCompareTo(t)},e}(Ae),Be=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=Ce.TimestampValue,r}return o.__extends(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===ke.Estimate?new Le(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===ke.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Le?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(Ae),Fe=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.BlobValue,n}return o.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Ae),Ue=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=Ce.RefValue,r}return o.__extends(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:ht.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(Ae),Ve=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.GeoPointValue,n}return o.__extends(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(Ae),je=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.ObjectValue,n}return o.__extends(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal((function(n,r){e[n]=r.value(t)})),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=Q(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return Q(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(b(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(b(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return null!==this.field(t)},e.prototype.field=function(t){b(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach((function(t){n=n instanceof e?n.internalValue.get(t):null})),n},e.prototype.fieldMask=function(){var t=new Ot(lt.comparator);return this.internalValue.forEach((function(n,r){var i=new lt([n]);if(r instanceof e){var o=r.fieldMask().fields;o.isEmpty()?t=t.add(i):o.forEach((function(e){t=t.add(i.child(e))}))}else t=t.add(i)})),ve.fromSet(t)},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new kt(Q)),e}(Ae),qe=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ce.ArrayValue,n}return o.__extends(e,t),e.prototype.value=function(t){return this.internalValue.map((function(e){return e.value(t)}))},e.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return Q(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map((function(t){return t.toString()})).join(",")+"]"},e}(Ae),Ge=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return ht.comparator(t.key,e.key)},t}(),ze=function(t){function e(e,n,r,i,o,a){var s=t.call(this,e,n)||this;return s.objectValue=i,s.proto=o,s.converter=a,b(void 0!==s.objectValue||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.hasLocalMutations=!!r.hasLocalMutations,s.hasCommittedMutations=!!r.hasCommittedMutations,s}return o.__extends(e,t),e.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},e.prototype.data=function(){var t=this;if(!this.objectValue){var e=je.EMPTY;A(this.proto.fields||{},(function(n,r){e=e.set(new lt([n]),t.converter(r))})),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},e.prototype.value=function(){return this.data().value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.getProtoField=function(t){b(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):g("Trying to compare documents on fields that don't exist")},e}(Ge),He=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return o.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Ge),We=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Ge),Ke=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[1];if(o[0].isEqual(t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){A(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}}))},t.prototype.isEmpty=function(){return I(this.inner)},t}(),Xe=function(){function t(){this.changes=new Ke((function(t){return t.toString()})),this.changesApplied=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return b(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){b(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},t.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ht.resolve(n):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){b(!this.changesApplied,"Changes have already been applied.")},t}(),Ye=function(){function t(t,e){this.serializer=t,this.indexManager=e}return t.prototype.addEntry=function(t,e,n){return Je(t).put(Ze(e),n)},t.prototype.removeEntry=function(t,e){var n=Je(t),r=Ze(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.setMetadata(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return Je(t).get(Ze(e)).next((function(t){return n.maybeDecodeDocument(t)}))},t.prototype.getSizedEntry=function(t,e){var n=this;return Je(t).get(Ze(e)).next((function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:$e(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Rt();return this.forEachDbEntry(t,e,(function(t,e){var i=n.maybeDecodeDocument(e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.getSizedEntries=function(t,e){var n=this,r=Rt(),i=new kt(ht.comparator);return this.forEachDbEntry(t,e,(function(t,e){var o=n.maybeDecodeDocument(e);o?(r=r.insert(t,o),i=i.insert(t,$e(e))):(r=r.insert(t,null),i=i.insert(t,0))})).next((function(){return{maybeDocuments:r,sizeMap:i}}))},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return Ht.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Je(t).iterate({range:r},(function(t,e,r){for(var a=ht.fromSegments(t);o&&ht.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this;b(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=Lt(),o=e.path.length+1,a={};if(n.isEqual(Ct.MIN)){var s=e.path.toArray();a.range=IDBKeyRange.lowerBound(s)}else{var u=e.path.toArray(),c=this.serializer.toDbTimestampKey(n);a.range=IDBKeyRange.lowerBound([u,c],!0),a.index=fn.collectionReadTimeIndex}return Je(t).iterate(a,(function(t,n,a){if(t.length===o){var s=r.serializer.fromDbRemoteDocument(n);e.path.isPrefixOf(s.key.path)?s instanceof ze&&e.matches(s)&&(i=i.insert(s.key,s)):a.done()}})).next((function(){return i}))},t.prototype.getNewDocumentChanges=function(t,e){var n=this,r=Nt(),i=this.serializer.toDbTimestampKey(e),o=Je(t),a=IDBKeyRange.lowerBound(i,!0);return o.iterate({index:fn.readTimeIndex,range:a},(function(t,e){var o=n.serializer.fromDbRemoteDocument(e);r=r.insert(o.key,o),i=e.readTime})).next((function(){return{changedDocs:r,readTime:n.serializer.fromDbTimestampKey(i)}}))},t.prototype.getLastDocumentChange=function(t){var e,n=this,r=Je(t),i=Ct.MIN;return r.iterate({index:fn.readTimeIndex,reverse:!0},(function(t,r,o){e=n.serializer.fromDbRemoteDocument(r),r.readTime&&(i=n.serializer.fromDbTimestampKey(r.readTime)),o.done()})).next((function(){return{changedDoc:e,readTime:i}}))},t.prototype.newChangeBuffer=function(e){return new t.RemoteDocumentChangeBuffer(this,!!e&&e.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Qe(t).get(dn.key).next((function(t){return b(!!t,"Missing document cache metadata"),t}))},t.prototype.setMetadata=function(t,e){return Qe(t).put(dn.key,e)},t.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof He&&e.version.isEqual(Ct.forDeletedDoc())?null:e}return null},t.RemoteDocumentChangeBuffer=function(t){function e(e,n){var r=t.call(this)||this;return r.documentCache=e,r.trackRemovals=n,r.documentSizes=new Ke((function(t){return t.toString()})),r}return o.__extends(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Ot((function(t,e){return Q(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,a){var s=e.documentSizes.get(o);if(b(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){b(!e.readTime.isEqual(Ct.MIN),"Cannot add a document with a read time of zero");var u=e.documentCache.serializer.toDbRemoteDocument(a,e.readTime);i=i.add(o.path.popLast());var c=$e(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else if(r-=s,e.trackRemovals){var l=e.documentCache.serializer.toDbRemoteDocument(new He(o,Ct.forDeletedDoc()),e.readTime);n.push(e.documentCache.addEntry(t,o,l))}else n.push(e.documentCache.removeEntry(t,o))})),i.forEach((function(r){n.push(e.documentCache.indexManager.addToCollectionParentIndex(t,r))})),n.push(this.documentCache.updateMetadata(t,r)),Ht.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next((function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next((function(t){var e=t.maybeDocuments;return t.sizeMap.forEach((function(t,e){n.documentSizes.set(t,e)})),e}))},e}(Xe),t}();function Qe(t){return Un.getStore(t,dn.store)}function Je(t){return Un.getStore(t,fn.store)}function Ze(t){return t.path.toArray()}function $e(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw g("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var tn=function(){function t(){this.collectionParentIndex=new en}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Ht.resolve()},t.prototype.getCollectionParents=function(t,e){return Ht.resolve(this.collectionParentIndex.getEntries(e))},t}(),en=function(){function t(){this.index={}}return t.prototype.add=function(t){b(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ot(ut.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Ot(ut.comparator)).toArray()},t}(),nn=9,rn=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;b(n<r&&n>=0&&r<=nn,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new Yt(e);n<1&&r>=1&&(function(t){t.createObjectStore(an.store)}(t),function(t){t.createObjectStore(sn.store,{keyPath:sn.keyPath}),t.createObjectStore(un.store,{keyPath:un.keyPath,autoIncrement:!0}).createIndex(un.userMutationsIndex,un.userMutationsKeyPath,{unique:!0}),t.createObjectStore(cn.store)}(t),gn(t),function(t){t.createObjectStore(fn.store)}(t));var a=Ht.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(vn.store),t.deleteObjectStore(pn.store),t.deleteObjectStore(mn.store)}(t),gn(t)),a=a.next((function(){return function(t){var e=t.store(mn.store),n=new mn(0,0,Ct.MIN.toTimestamp(),0);return e.put(mn.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(a=a.next((function(){return function(t,e){return e.store(un.store).loadAll().next((function(n){t.deleteObjectStore(un.store),t.createObjectStore(un.store,{keyPath:un.keyPath,autoIncrement:!0}).createIndex(un.userMutationsIndex,un.userMutationsKeyPath,{unique:!0});var r=e.store(un.store),i=n.map((function(t){return r.put(t)}));return Ht.waitFor(i)}))}(t,o)}))),a=a.next((function(){!function(t){t.createObjectStore(bn.store,{keyPath:bn.keyPath})}(t)}))),n<5&&r>=5&&(a=a.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(a=a.next((function(){return function(t){t.createObjectStore(dn.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(a=a.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(a=a.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(a=a.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(fn.store);e.createIndex(fn.readTimeIndex,fn.readTimeIndexPath,{unique:!1}),e.createIndex(fn.collectionReadTimeIndex,fn.collectionReadTimeIndexPath,{unique:!1})}(e)}))),a},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(fn.store).iterate((function(t,n){e+=$e(n)})).next((function(){var n=new dn(e);return t.store(dn.store).put(dn.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(sn.store),r=t.store(un.store);return n.loadAll().next((function(n){return Ht.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(un.userMutationsIndex,i).next((function(r){return Ht.forEach(r,(function(r){b(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return ne(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(vn.store),n=t.store(fn.store);return de(t).next((function(t){var r=[];return n.iterate((function(n,i){var o=new ut(n),a=function(t){return[0,_t(t)]}(o);r.push(e.get(a).next((function(n){return n?Ht.resolve():function(n){return e.put(new vn(0,_t(n),t))}(o)})))})).next((function(){return Ht.waitFor(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(yn.store,{keyPath:yn.keyPath});var n=e.store(yn.store),r=new en,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:_t(i)})}};return e.store(fn.store).iterate({keysOnly:!0},(function(t,e){var n=new ut(t);return i(n.popLast())})).next((function(){return e.store(cn.store).iterate({keysOnly:!0},(function(t,e){var n=xt(t[1]);return i(n.popLast())}))}))},t}(),on=function(t,e){this.seconds=t,this.nanoseconds=e},an=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}(),sn=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),un=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}(),cn=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,_t(e)]},t.key=function(t,e,n){return[t,_t(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}(),ln=function(t,e){this.path=t,this.readTime=e},hn=function(t,e){this.path=t,this.version=e},fn=function(){function t(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}return t.store="remoteDocuments",t.readTimeIndex="readTimeIndex",t.readTimeIndexPath="readTime",t.collectionReadTimeIndex="collectionReadTimeIndex",t.collectionReadTimeIndexPath=["parentPath","readTime"],t}(),dn=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}(),pn=function(){function t(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),vn=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,b(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),mn=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),yn=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function gn(t){t.createObjectStore(vn.store,{keyPath:vn.keyPath}).createIndex(vn.documentTargetsIndex,vn.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(pn.store,{keyPath:pn.keyPath}).createIndex(pn.queryTargetsIndexName,pn.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(mn.store)}var bn=function(){function t(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}return t.store="clientMetadata",t.keyPath="clientId",t}(),_n=o.__spreadArrays([sn.store,un.store,cn.store,fn.store,pn.store,an.store,mn.store,vn.store],[bn.store]),wn=o.__spreadArrays(_n,[dn.store]),En=o.__spreadArrays(wn,[yn.store]),xn=function(){function t(){this.collectionParentsCache=new en}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(b(e.length%2==1,"Expected a collection path."),!this.collectionParentsCache.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.collectionParentsCache.add(e)}));var o={collectionId:r,parent:_t(i)};return Tn(t).put(o)}return Ht.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Z(e),""],!1,!0);return Tn(t).loadAll(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(xt(o.parent))}return n}))},t}();function Tn(t){return Un.getStore(t,yn.store)}var Cn=function(t){return t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution",t}({}),kn=function(){function t(t,e,n,r,i,o,a){void 0===i&&(i=Ct.MIN),void 0===o&&(o=Ct.MIN),void 0===a&&(a=w()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},t}(),Sn=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=ht.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new He(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=ht.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new We(e,n)):g("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof ze){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t);return new fn(null,null,i,s=t.hasCommittedMutations,n,r)}if(t instanceof He){var o=t.key.path.toArray(),a=this.toDbTimestamp(t.version),s=t.hasCommittedMutations;return new fn(null,new ln(o,a),null,s,n,r)}if(t instanceof We){o=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new fn(new hn(o,u),null,null,!0,n,r)}return g("Unexpected MaybeDocument")},t.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},t.prototype.fromDbTimestampKey=function(t){var e=new Tt(t[0],t[1]);return Ct.fromTimestamp(e)},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new on(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Tt(t.seconds,t.nanoseconds);return Ct.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.remoteSerializer.toMutation(t)})),i=e.mutations.map((function(t){return n.remoteSerializer.toMutation(t)}));return new un(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.remoteSerializer.fromMutation(t)})),r=t.mutations.map((function(t){return e.remoteSerializer.fromMutation(t)})),i=Tt.fromMillis(t.localWriteTimeMs);return new Gt(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach((function(t){e.push(_t(t.path))})),e},t.prototype.fromDbResourcePaths=function(t){for(var e=Vt(),n=0,r=t;n<r.length;n++)e=e.add(new ht(xt(r[n])));return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):Ct.MIN,i=t.resumeToken;return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new kn(e,t.targetId,Cn.Listen,t.lastListenSequenceNumber,n,r,i)},t.prototype.toDbTarget=function(t){b(Cn.Listen===t.purpose,"Only queries with purpose "+Cn.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),t.resumeToken instanceof Uint8Array?(b(Kt.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new pn(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},t}();function An(t,e){var n=t[1],r=e[1],i=Q(t[0],e[0]);return 0===i?Q(n,r):i}var In=function(){function t(t){this.maxElements=t,this.buffer=new Ot(An),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();An(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),On={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pn=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),Dn=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}return t.prototype.start=function(){b(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Pn.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;b(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;v("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(dt.LruGarbageCollection,e,(function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then((function(){return t.scheduleGC()})).catch(Vn)}))},t}(),Nn=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ht.resolve(at.INVALID);var r=new In(e);return this.delegate.forEachTarget(t,(function(t){return r.addElement(t.sequenceNumber)})).next((function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,(function(t){return r.addElement(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Pn.COLLECTION_DISABLED?(v("LruGarbageCollector","Garbage collection skipped; disabled"),Ht.resolve(On)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),On):n.runGarbageCollection(t,e)}))},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),d()<=f.DEBUG&&v("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-l)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-l)+"ms"),Ht.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),Rn=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),Mn="IndexedDbPersistence",Ln="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Bn="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Fn=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return o.__extends(e,t),e}(Rn),Un=function(){function t(e,n,r,i,o,a,s,u){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.queue=a,this.sequenceNumberSyncer=u,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new Gn(this,o),this.dbName=n+t.MAIN_DATABASE,this.serializer=new Sn(s),this.document=i.document,this.targetCache=new le(this.referenceDelegate,this.serializer),this.indexManager=new xn,this.remoteDocumentCache=new Ye(this.serializer,this.indexManager),!i.window||!i.window.localStorage)throw new x(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=i.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof Fn)return Kt.getStore(t.simpleDbTransaction,e);throw g("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e){return o.__awaiter(this,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:if(!t.isAvailable())throw new x(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(n=new t(e.allowTabSynchronization,e.persistenceKey,e.clientId,e.platform,e.lruParams,e.queue,e.serializer,e.sequenceNumberSyncer)).start()];case 1:return r.sent(),[2,n]}}))}))},t.prototype.start=function(){var t=this;return b(!this.started,"IndexedDbPersistence double-started!"),b(null!==this.window,"Expected 'window' to be defined"),Kt.openOrCreate(this.dbName,nn,new rn(this.serializer)).then((function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()})).then((function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.simpleDb.runTransaction("readonly-idempotent",[mn.store],(function(t){return de(t)}))})).then((function(e){t.listenSequence=new at(e,t.sequenceNumberSyncer)})).then((function(){t._started=!0})).catch((function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)}))},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener((function(n){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget((function(){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite-idempotent",En,(function(e){return qn(e).put(new bn(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next((function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget((function(){return t.primaryStateListener(!1)})))}))})).next((function(){return t.canActAsPrimary(e)})).next((function(n){return t.isPrimary&&!n?t.releasePrimaryLeaseIfHeld(e).next((function(){return!1})):!!n&&t.acquireOrExtendPrimaryLease(e).next((function(){return!0}))}))})).catch((function(e){if(!t.allowTabSynchronization)throw e;return v(Mn,"Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.queue.enqueueAndForget((function(){return t.primaryStateListener(e)})),t.isPrimary=e}))},t.prototype.verifyPrimaryLease=function(t){var e=this;return jn(t).get(an.key).next((function(t){return Ht.resolve(e.isLocalClient(t))}))},t.prototype.removeClientMetadata=function(t){return qn(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return o.__awaiter(this,void 0,void 0,(function(){var e=this;return o.__generator(this,(function(n){switch(n.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",(function(n){var r=t.getStore(n,bn.store);return r.loadAll().next((function(t){var n=e.filterActiveClients(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return Ht.forEach(i,(function(t){return r.delete(t.clientId)})).next((function(){return i}))}))}))]);case 1:n.sent().forEach((function(t){e.window.localStorage.removeItem(e.zombiedClientLocalStorageKey(t.clientId))})),n.label=2;case 2:return[2]}}))}))},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(dt.ClientMetadataRefresh,4e3,(function(){return t.updateClientMetadataAndTryBecomePrimary().then((function(){return t.maybeGarbageCollectMultiClientState()})).then((function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()}))}))},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return jn(t).get(an.key).next((function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new x(E.FAILED_PRECONDITION,Bn);return!1}}return!(!e.networkEnabled||!e.inForeground)||qn(t).loadAll().next((function(t){return void 0===e.filterActiveClients(t,5e3).find((function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))}))}))})).next((function(t){return e.isPrimary!==t&&v(Mn,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return o.__awaiter(this,void 0,void 0,(function(){var t=this;return o.__generator(this,(function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[an.store,bn.store],(function(e){return t.releasePrimaryLeaseIfHeld(e).next((function(){return t.removeClientMetadata(e)}))}))];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}}))}))},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter((function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)}))},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly-idempotent",[bn.store],(function(e){return qn(e).loadAll().next((function(e){return t.filterActiveClients(e,18e5).map((function(t){return t.clientId}))}))}))},t.clearPersistence=function(e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(n){switch(n.label){case 0:return t.isAvailable()?[4,Kt.delete(e+t.MAIN_DATABASE)]:[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return b(this.started,"Cannot initialize MutationQueue before persistence is started."),te.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getTargetCache=function(){return b(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},t.prototype.getRemoteDocumentCache=function(){return b(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return b(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;v(Mn,"Starting transaction:",t);var i,o=e.endsWith("idempotent"),a=e.startsWith("readonly");return this.simpleDb.runTransaction(a?o?"readonly-idempotent":"readonly":o?"readwrite-idempotent":"readwrite",En,(function(o){return i=new Fn(o,r.listenSequence.next()),"readwrite-primary"===e||"readwrite-primary-idempotent"===e?r.verifyPrimaryLease(o).next((function(t){return!!t||r.canActAsPrimary(o)})).next((function(e){if(!e)throw m("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget((function(){return r.primaryStateListener(!1)})),new x(E.FAILED_PRECONDITION,Ln);return n(i)})).next((function(t){return r.acquireOrExtendPrimaryLease(o).next((function(){return t}))})):r.verifyAllowTabSynchronization(o).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return jn(t).get(an.key).next((function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new x(E.FAILED_PRECONDITION,Bn)}))},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new an(this.clientId,this.allowTabSynchronization,Date.now());return jn(t).put(an.key,e)},t.isAvailable=function(){return Kt.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=jn(t);return n.get(an.key).next((function(t){return e.isLocalClient(t)?(v(Mn,"Releasing primary lease."),n.delete(an.key)):Ht.resolve()}))},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(m("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()}))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(b(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(b("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return v(Mn,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(n){return m(Mn,"Failed to get zombied client id.",n),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){m("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Vn(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){if(!function(t){return t.code===E.FAILED_PRECONDITION&&t.message===Ln}(t))throw t;return v(Mn,"Unexpectedly lost primary lease"),[2]}))}))}function jn(t){return t.store(an.store)}function qn(t){return t.store(bn.store)}var Gn=function(){function t(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new Nn(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,(function(t,n){return e(n)}))},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return zn(t,e)},t.prototype.removeReference=function(t,e){return zn(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return zn(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Ht.resolve(!0):function(t,e){var n=!1;return ae(t).iterateSerial((function(r){return ee(t,r,e).next((function(t){return t&&(n=!0),Ht.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,(function(a,s){if(s<=e){var u=n.isPinned(t,a).next((function(e){if(!e)return o++,r.getEntry(t,a).next((function(){return r.removeEntry(a),pe(t).delete([0,_t(a.path)])}))}));i.push(u)}})).next((function(){return Ht.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return zn(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=pe(t),i=at.INVALID;return r.iterate({index:vn.documentTargetsIndex},(function(t,r){var o=r.path,a=r.sequenceNumber;0===t[0]?(i!==at.INVALID&&e(new ht(xt(n)),i),i=a,n=o):i=at.INVALID})).next((function(){i!==at.INVALID&&e(new ht(xt(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function zn(t,e){return pe(t).put(function(t,e){return new vn(0,_t(t.path),e)}(e,t.currentSequenceNumber))}var Hn=Number,Wn=Hn.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),Kn=Hn.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Xn=Hn.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Yn(t){return null==t}function Qn(t){return Xn(t)&&t<=Kn&&t>=Wn}var Jn=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}return t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";Yn(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),Yn(this.limit)||(t+=", limit: "+this.limit),this.orderBy.length>0&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},t.prototype.isDocumentQuery=function(){return ht.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t}(),Zn=function(t){return t.First="F",t.Last="L",t}({}),$n=function(){function t(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=Zn.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)this.memoizedOrderBy=t.isKeyField()?[hr]:[new lr(t),hr];else{b(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}n||this.memoizedOrderBy.push((this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:ur.ASCENDING)===ur.ASCENDING?hr:fr)}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){b(null==this.getInequalityFilterField()||!(e instanceof nr)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),b(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){b(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.withLimitToFirst=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,Zn.First,this.startAt,this.endAt)},t.prototype.withLimitToLast=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,Zn.Last,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},t.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},t.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},t.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},t.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return b(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimitToFirst=function(){return!Yn(this.limit)&&this.limitType===Zn.First},t.prototype.hasLimitToLast=function(){return!Yn(this.limit)&&this.limitType===Zn.Last},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof nr&&n.isInequality())return n.field}return null},t.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof nr&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===Zn.First)this.memoizedTarget=new Jn(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e];t.push(new lr(r.field,r.dir===ur.DESCENDING?ur.ASCENDING:ur.DESCENDING))}var i=this.endAt?new cr(this.endAt.position,!this.endAt.before):null,o=this.startAt?new cr(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new Jn(this.path,this.collectionGroup,t,this.filters,this.limit,i,o)}return this.memoizedTarget},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):ht.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){b(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),tr=function(){},er=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return g("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),nr=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return o.__extends(e,t),e.create=function(t,n,r){if(t.isKeyField())return n===er.IN?(b(r instanceof qe,"Comparing on key with IN, but filter value not an ArrayValue"),b(r.internalValue.every((function(t){return t instanceof Ue})),"Comparing on key with IN, but an array value was not a RefValue"),new ir(t,r)):(b(r instanceof Ue,"Comparing on key, but filter value not a RefValue"),b(n!==er.ARRAY_CONTAINS&&n!==er.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new rr(t,n,r));if(r.isEqual(Ie.INSTANCE)){if(n!==er.EQUAL)throw new x(E.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(r.isEqual(Re.NAN)){if(n!==er.EQUAL)throw new x(E.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===er.ARRAY_CONTAINS?new or(t,r):n===er.IN?(b(r instanceof qe,"IN filter has invalid value: "+r.toString()),new ar(t,r)):n===er.ARRAY_CONTAINS_ANY?(b(r instanceof qe,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new sr(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case er.LESS_THAN:return t<0;case er.LESS_THAN_OR_EQUAL:return t<=0;case er.EQUAL:return 0===t;case er.GREATER_THAN:return t>0;case er.GREATER_THAN_OR_EQUAL:return t>=0;default:return g("Unknown FieldFilter operator: "+this.op)}},e.prototype.isInequality=function(){return[er.LESS_THAN,er.LESS_THAN_OR_EQUAL,er.GREATER_THAN,er.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(tr),rr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.matches=function(t){var e=ht.comparator(t.key,this.value.key);return this.matchesComparison(e)},e}(nr),ir=function(t){function e(e,n){var r=t.call(this,e,er.IN,n)||this;return r.value=n,r}return o.__extends(e,t),e.prototype.matches=function(t){return this.value.internalValue.some((function(e){return t.key.isEqual(e.key)}))},e}(nr),or=function(t){function e(e,n){return t.call(this,e,er.ARRAY_CONTAINS,n)||this}return o.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return e instanceof qe&&e.contains(this.value)},e}(nr),ar=function(t){function e(e,n){var r=t.call(this,e,er.IN,n)||this;return r.value=n,r}return o.__extends(e,t),e.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},e}(nr),sr=function(t){function e(e,n){var r=t.call(this,e,er.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return o.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof qe&&n.internalValue.some((function(t){return e.value.contains(t)}))},e}(nr),ur=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),cr=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},t.prototype.sortsBeforeDocument=function(t,e){b(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())b(o instanceof Ue,"Bound has a non-key value where the key path is being used."),n=ht.comparator(o.key,e.key);else{var a=e.field(i.field);b(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===ur.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!this.position[e].isEqual(t.position[e]))return!1;return!0},t}(),lr=function(){function t(t,e){this.field=t,void 0===e&&(e=ur.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?ze.compareByKey(t,e):ze.compareByField(this.field,t,e);switch(this.dir){case ur.ASCENDING:return n;case ur.DESCENDING:return-1*n;default:return g("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),hr=new lr(lt.keyField(),ur.ASCENDING),fr=new lr(lt.keyField(),ur.DESCENDING),dr=function(){function t(){}return t.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return b(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),e.matchesAllDocuments()?this.executeFullCollectionScan(t,e):n.isEqual(Ct.MIN)?this.executeFullCollectionScan(t,e):this.localDocumentsView.getDocuments(t,r).next((function(o){var a=i.applyQuery(e,o);return(e.hasLimitToFirst()||e.hasLimitToLast())&&i.needsRefill(e.limitType,a,r,n)?i.executeFullCollectionScan(t,e):(d()<=f.DEBUG&&v("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),i.localDocumentsView.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.applyQuery=function(t,e){var n=new Ot((function(e,n){return t.docComparator(e,n)}));return e.forEach((function(e,r){r instanceof ze&&t.matches(r)&&(n=n.add(r))})),n},t.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===Zn.First?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.executeFullCollectionScan=function(t,e){return d()<=f.DEBUG&&v("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,Ct.MIN)},t}(),pr=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.getDocumentInternal(t,e,r)}))},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].applyToLocalView(e,t);return t}))},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Rt();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].applyToLocalView(t,e);r=r.insert(t,e)})),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next((function(e){return n.getLocalViewOfDocuments(t,e)}))},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=Nt();return i.forEach((function(t,e){e||(e=new He(t,Ct.forDeletedDoc())),o=o.insert(t,e)})),o}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new ht(e)).next((function(t){var e=Lt();return t instanceof ze&&(e=e.insert(t.key,t)),e}))},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e,n){var r=this;b(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=Lt();return this.indexManager.getCollectionParents(t,i).next((function(a){return Ht.forEach(a,(function(a){var s=e.asCollectionQueryAtPath(a.child(i));return r.getDocumentsMatchingCollectionQuery(t,s,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e,n){var r,i,o=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return o.addMissingBaseDocuments(t,i=e,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,l=r.get(c),h=u.applyToLocalView(l,l,o.localWriteTime);r=h instanceof ze?r.insert(c,h):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Vt(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Ee&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof ze&&(c=c.insert(t,e))})),c}))},t}(),vr=function(){function t(){this.refsByKey=new Ot(mr.compareByKey),this.refsByTarget=new Ot(mr.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new mr(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.removeRef(new mr(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.removeReferencesForId=function(t){var e=this,n=ht.EMPTY,r=new mr(n,t),i=new mr(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],(function(t){e.removeRef(t),o.push(t.key)})),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach((function(e){return t.removeRef(e)}))},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=ht.EMPTY,n=new mr(e,t),r=new mr(e,t+1),i=Vt();return this.refsByTarget.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new mr(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),mr=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return ht.comparator(t.key,e.key)||Q(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return Q(t.targetOrBatchId,e.targetOrBatchId)||ht.comparator(t.key,e.key)},t}(),yr=function(){function t(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new vr,this.targetDataByTarget=new kt(Q),this.targetIdByTarget=new Ke((function(t){return t.canonicalId()})),this.lastDocumentChangeReadTime=Ct.MIN,b(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new pr(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}return t.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},t.prototype.handleUserChange=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,r,i=this;return o.__generator(this,(function(o){switch(o.label){case 0:return e=this.mutationQueue,n=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",(function(r){var o;return i.mutationQueue.getAllMutationBatches(r).next((function(a){return o=a,e=i.persistence.getMutationQueue(t),n=new pr(i.remoteDocuments,e,i.persistence.getIndexManager()),e.getAllMutationBatches(r)})).next((function(t){for(var e=[],i=[],a=Vt(),s=0,u=o;s<u.length;s++){e.push((d=u[s]).batchId);for(var c=0,l=d.mutations;c<l.length;c++)a=a.add(l[c].key)}for(var h=0,f=t;h<f.length;h++){var d;i.push((d=f[h]).batchId);for(var p=0,v=d.mutations;p<v.length;p++)a=a.add(v[p].key)}return n.getDocuments(r,a).next((function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:i}}))}))}))];case 1:return r=o.sent(),this.mutationQueue=e,this.localDocuments=n,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,r]}}))}))},t.prototype.localWrite=function(t){var e,n=this,r=Tt.now(),i=t.reduce((function(t,e){return t.add(e.key)}),Vt());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",(function(o){return n.localDocuments.getDocuments(o,i).next((function(i){e=i;for(var a=[],s=0,u=t;s<u.length;s++){var c=u[s],l=c.extractBaseValue(e.get(c.key));null!=l&&a.push(new Ee(c.key,l,l.fieldMask(),be.exists(!0)))}return n.mutationQueue.addMutationBatch(o,r,a,t)}))})).then((function(t){var n=t.applyToLocalDocumentSet(e);return{batchId:t.batchId,changes:n}}))},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",(function(n){return e.mutationQueue.lookupMutationKeys(n,t).next((function(t){return t?e.localDocuments.getDocuments(n,t):Ht.resolve(null)}))}))},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",(function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer({trackRemovals:!0});return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next((function(){return e.applyWriteToRemoteDocuments(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",(function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next((function(t){return b(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)})).next((function(){return e.mutationQueue.performConsistencyCheck(n)})).next((function(){return e.localDocuments.getDocuments(n,r)}))}))},t.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",(function(e){return t.mutationQueue.getLastStreamToken(e)}))},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",(function(n){return e.mutationQueue.setLastStreamToken(n,t)}))},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",(function(e){return t.targetCache.getLastRemoteSnapshotVersion(e)}))},t.prototype.applyRemoteEvent=function(e){var n=this,r=e.snapshotVersion,i=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",(function(o){var a=n.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=n.targetDataByTarget;var s=[];S(e.targetChanges,(function(e,a){var u=i.get(e);if(u){s.push(n.targetCache.removeMatchingKeys(o,a.removedDocuments,e).next((function(){return n.targetCache.addMatchingKeys(o,a.addedDocuments,e)})));var c=a.resumeToken;if(c.length>0){var l=u.withResumeToken(c,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(e,l),t.shouldPersistTargetData(u,l,a)&&s.push(n.targetCache.updateTargetData(o,l))}}}));var u=Nt(),c=Vt();if(e.documentUpdates.forEach((function(t,e){c=c.add(t)})),s.push(a.getEntries(o,c).next((function(t){e.documentUpdates.forEach((function(i,c){var l=t.get(i);c instanceof He&&c.version.isEqual(Ct.MIN)?(a.removeEntry(i,r),u=u.insert(i,c)):null==l||c.version.compareTo(l.version)>0||0===c.version.compareTo(l.version)&&l.hasPendingWrites?(b(!Ct.MIN.isEqual(r),"Cannot add a document when the remote version is zero"),a.addEntry(c,r),u=u.insert(i,c)):v("LocalStore","Ignoring outdated watch update for ",i,". Current version:",l.version," Watch version:",c.version),e.resolvedLimboDocuments.has(i)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(o,i))}))}))),!r.isEqual(Ct.MIN)){var l=n.targetCache.getLastRemoteSnapshotVersion(o).next((function(t){return b(r.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+r+" < "+t),n.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,r)}));s.push(l)}return Ht.waitFor(s).next((function(){return a.apply(o)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(o,u)}))})).then((function(t){return n.targetDataByTarget=i,t}))},t.shouldPersistTargetData=function(t,e,n){return b(e.resumeToken.length>0,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0},t.prototype.notifyLocalViewChanges=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);b(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.withLastLimboFreeSnapshotVersion(a.snapshotVersion);this.targetDataByTarget=this.targetDataByTarget.insert(o,s)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",(function(n){return Ht.forEach(t,(function(t){return Ht.forEach(t.removedKeys,(function(t){return e.persistence.referenceDelegate.removeReference(n,t)}))}))}))},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",(function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)}))},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly-idempotent",(function(n){return e.localDocuments.getDocument(n,t)}))},t.prototype.allocateTarget=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",(function(n){var r;return e.targetCache.getTargetData(n,t).next((function(i){return i?Ht.resolve(r=i):e.targetCache.allocateTargetId(n).next((function(i){return r=new kn(t,i,Cn.Listen,n.currentSequenceNumber),e.targetCache.addTargetData(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.targetDataByTarget.get(n.targetId)&&(e.targetDataByTarget=e.targetDataByTarget.insert(n.targetId,n),e.targetIdByTarget.set(t,n.targetId)),n}))},t.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Ht.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},t.prototype.releaseTarget=function(t,e){var n=this,r=this.targetDataByTarget.get(t);return b(null!==r,"Tried to release nonexistent target: "+t),this.persistence.runTransaction("Release target",e?"readwrite-idempotent":"readwrite-primary-idempotent",(function(i){var o=n.localViewReferences.removeReferencesForId(t);return e?Ht.resolve():Ht.forEach(o,(function(t){return n.persistence.referenceDelegate.removeReference(i,t)})).next((function(){n.persistence.referenceDelegate.removeTarget(i,r)}))})).then((function(){n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(r.target)}))},t.prototype.executeQuery=function(t,e){var n=this,r=Ct.MIN,i=Vt();return this.persistence.runTransaction("Execute query","readonly-idempotent",(function(o){return n.getTargetData(o,t.toTarget()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.queryEngine.getDocumentsMatchingQuery(o,t,e?r:Ct.MIN,e?i:Vt())})).next((function(t){return{documents:t,remoteKeys:i}}))}))},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",(function(n){return e.targetCache.getMatchingKeysForTargetId(n,t)}))},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=Ht.resolve();return o.forEach((function(r){a=a.next((function(){return n.getEntry(t,r)})).next((function(t){var o=t,a=e.docVersions.get(r);b(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o,e.commitVersion):b(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),a.next((function(){return r.mutationQueue.removeMutationBatch(t,i)}))},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",(function(n){return t.collect(n,e.targetDataByTarget)}))},t.prototype.getTarget=function(t){var e=this,n=this.targetDataByTarget.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly-idempotent",(function(n){return e.targetCache.getTargetDataForTarget(n,t).next((function(t){return t?t.target:null}))}))},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",(function(e){return t.remoteDocuments.getNewDocumentChanges(e,t.lastDocumentChangeReadTime)})).then((function(e){var n=e.changedDocs;return t.lastDocumentChangeReadTime=e.readTime,n}))},t.prototype.synchronizeLastDocumentChangeReadTime=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e=this;return o.__generator(this,(function(n){return this.remoteDocuments instanceof Ye?(t=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",(function(e){return t.getLastDocumentChange(e)})).then((function(t){e.lastDocumentChangeReadTime=t.readTime}))]):[2]}))}))},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),gr=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=w(),this.batchesByDocumentKey=new Ot(mr.compareByKey)}return t.prototype.checkEmpty=function(t){return Ht.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");b(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return b(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Ht.resolve()},t.prototype.getLastStreamToken=function(t){return Ht.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Ht.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){b(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&b(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Gt(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new mr(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Ht.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ht.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return b(null!=n,"Failed to find local mutation batch."),Ht.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.indexOfBatchId(e+1),r=n<0?0:n;return Ht.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ht.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},t.prototype.getAllMutationBatches=function(t){return Ht.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new mr(e,0),i=new mr(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],(function(t){b(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);b(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),Ht.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ot(Q);return e.forEach((function(t){var e=new mr(t,0),i=new mr(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],(function(e){b(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)}))})),Ht.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){b(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;ht.isDocumentKey(i)||(i=i.child(""));var o=new mr(new ht(i),0),a=new Ot(Q);return this.batchesByDocumentKey.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)}),o),Ht.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;b(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return Ht.forEach(e.mutations,(function(i){var o=new mr(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)})).next((function(){n.batchesByDocumentKey=r}))},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new mr(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Ht.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&b(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Ht.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return b(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return b(n.batchId===t,"If found batch must match"),n},t}(),br=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new kt(ht.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){b(!n.isEqual(Ct.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ht.resolve(n?n.maybeDocument:null)},t.prototype.getEntries=function(t,e){var n=this,r=Rt();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)})),Ht.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){b(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=Lt(),i=new ht(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.value,u=s.maybeDocument,c=s.readTime;if(!e.path.isPrefixOf(a.key.path))break;c.compareTo(n)<=0||u instanceof ze&&e.matches(u)&&(r=r.insert(u.key,u))}return Ht.resolve(r)},t.prototype.forEachDocumentKey=function(t,e){return Ht.forEach(this.docs,(function(t){return e(t)}))},t.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},t.prototype.newChangeBuffer=function(e){return new t.RemoteDocumentChangeBuffer(this)},t.prototype.getSize=function(t){return Ht.resolve(this.size)},t.RemoteDocumentChangeBuffer=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return o.__extends(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i?n.push(e.documentCache.addEntry(t,i,e.readTime)):e.documentCache.removeEntry(r)})),Ht.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},e}(Xe),t}(),_r=function(){function t(t){this.persistence=t,this.targets=new Ke((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=Ct.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new vr,this.targetCount=0,this.targetIdGenerator=ce.forTargetCache()}return t.prototype.forEachTarget=function(t,e){return this.targets.forEach((function(t,n){return e(n)})),Ht.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ht.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ht.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Ht.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Ht.resolve()},t.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return b(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Ht.resolve()},t.prototype.updateTargetData=function(t,e){return b(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Ht.resolve()},t.prototype.removeTargetData=function(t,e){return b(this.targetCount>0,"Removing a target from an empty cache"),b(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Ht.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.targets.forEach((function(a,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.targets.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)})),Ht.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return Ht.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Ht.resolve(n)},t.prototype.getTargetDataForTarget=function(t,e){return g("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.addReference(t,e))})),Ht.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.removeReference(t,e))})),Ht.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Ht.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Ht.resolve(n)},t.prototype.containsKey=function(t,e){return Ht.resolve(this.references.containsKey(e))},t}(),wr=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new at(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new _r(this),this.indexManager=new tn,this.remoteDocumentCache=new br(this.indexManager,(function(t){return n.referenceDelegate.documentSize(t)}))}return t.createLruPersistence=function(e,n,r){return new t(e,(function(t){return new Tr(t,new Sn(n),r)}))},t.createEagerPersistence=function(e){return new t(e,(function(t){return new xr(t)}))},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return[2,[this.clientId]]}))}))},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new gr(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.targetCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;v("MemoryPersistence","Starting transaction:",t);var i=new Er(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next((function(t){return r.referenceDelegate.onTransactionCommitted(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.mutationQueuesContainKey=function(t,e){return Ht.or((n=this.mutationQueues,r=[],A(n,(function(t,e){return r.push(e)})),r).map((function(n){return function(){return n.containsKey(t,e)}})));var n,r},t}(),Er=function(t){function e(e){var n=t.call(this)||this;return n.currentSequenceNumber=e,n}return o.__extends(e,t),e}(Rn),xr=function(){function t(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}return Object.defineProperty(t.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw g("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Ht.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Ht.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Ht.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.orphanedDocuments.add(t)}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ht.forEach(this.orphanedDocuments,(function(r){return e.isReferenced(t,r).next((function(t){t||n.removeEntry(r)}))})).next((function(){return e._orphanedDocuments=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next((function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)}))},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return Ht.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Ht.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Tr=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new Ke((function(t){return _t(t.path)})),this.garbageCollector=new Nn(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return Ht.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return Ht.forEach(this.orphanedSequenceNumbers,(function(r,i){return n.isPinned(t,r,i).next((function(t){return t?Ht.resolve():e(i)}))}))},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,(function(i){return n.isPinned(t,i,e).next((function(t){t||(r++,o.removeEntry(i))}))})).next((function(){return o.apply(t)})).next((function(){return r}))},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Ht.resolve()},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Ht.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Ht.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Ht.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw g("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return Ht.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Ht.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Ht.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),Cr=1e3,kr=1.5,Sr=6e4,Ar=function(){function t(t,e,n,r,i){void 0===n&&(n=Cr),void 0===r&&(r=kr),void 0===i&&(i=Sr),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&v("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,(function(){return e.lastAttemptTime=Date.now(),t()})),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}(),Ir=function(t){return t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff",t}({}),Or=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=Ir.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Ar(t,e)}return t.prototype.isStarted=function(){return this.state===Ir.Starting||this.state===Ir.Open||this.state===Ir.Backoff},t.prototype.isOpen=function(){return this.state===Ir.Open},t.prototype.start=function(){this.state!==Ir.Error?(b(this.state===Ir.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(Ir.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.inhibitBackoff=function(){b(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=Ir.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,(function(){return t.handleIdleCloseTimer()})))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.isOpen()?[2,this.close(Ir.Initial)]:[2]}))}))},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(n){switch(n.label){case 0:return b(this.isStarted(),"Only started streams should be closed."),b(t===Ir.Error||Yn(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==Ir.Error?this.backoff.reset():e&&e.code===E.RESOURCE_EXHAUSTED?(m(e.toString()),m("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===E.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;b(this.state===Ir.Initial,"Must be in initial state to auth"),this.state=Ir.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then((function(e){t.closeCount===n&&t.startStream(e)}),(function(n){e((function(){var e=new x(E.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)}))}))},t.prototype.startStream=function(t){var e=this;b(this.state===Ir.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen((function(){n((function(){return b(e.state===Ir.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=Ir.Open,e.listener.onOpen()}))})),this.stream.onClose((function(t){n((function(){return e.handleStreamClose(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.performBackoff=function(){var t=this;b(this.state===Ir.Error,"Should only perform backoff when in Error state"),this.state=Ir.Backoff,this.backoff.backoffAndRun((function(){return o.__awaiter(t,void 0,void 0,(function(){return o.__generator(this,(function(t){return b(this.state===Ir.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=Ir.Initial,this.start(),b(this.isStarted(),"PersistentStream should have started"),[2]}))}))}))},t.prototype.handleStreamClose=function(t){return b(this.isStarted(),"Can't handle server close on non-started stream"),v("PersistentStream","close with error: "+t),this.stream=null,this.close(Ir.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget((function(){return e.closeCount===t?n():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Pr=function(t){function e(e,n,r,i,o){var a=t.call(this,e,dt.ListenStreamConnectionBackoff,dt.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return o.__extends(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Or),Dr=function(t){function e(e,n,r,i,o){var a=t.call(this,e,dt.WriteStreamConnectionBackoff,dt.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a.lastStreamToken=w(),a}return o.__extends(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(b(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return b(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){b(this.isOpen(),"Writing handshake requires an opened stream"),b(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;b(this.isOpen(),"Writing mutations requires an opened stream"),b(this.handshakeComplete_,"Handshake must be complete before writing mutations"),b(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map((function(t){return e.serializer.toMutation(t)}))};this.sendRequest(n)},e}(Or),Nr=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Dr(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Pr(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map((function(t){return e.serializer.toMutation(t)}))};return this.invokeRPC("Commit",n).then((function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)}))},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map((function(t){return e.serializer.toName(t)}))};return this.invokeStreamingRPC("BatchGetDocuments",n).then((function(n){var r=Nt();n.forEach((function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);b(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeRPC(t,e,r)})).catch((function(t){throw t.code===E.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.invokeStreamingRPC(t,e,r)})).catch((function(t){throw t.code===E.UNAUTHENTICATED&&n.credentials.invalidateToken(),t}))},t}(),Rr=function(){function t(t){this.datastore=t,this.readVersions=Ft(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n=this;return o.__generator(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new x(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof He||t instanceof ze?n.recordVersion(t):g("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(n){this.lastWriteError=n}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new Te(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach((function(e){t=t.remove(e.key)})),!t.isEmpty())throw new x(E.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t instanceof ze)e=t.version;else{if(!(t instanceof He))throw g("Document in a transaction was a "+t.constructor.name);e=Ct.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new x(E.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?be.updateTime(e):be.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(!this.writtenDocs.has(t)&&e){if(e.isEqual(Ct.forDeletedDoc()))throw new x(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return be.updateTime(e)}return be.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){b(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}(),Mr=function(t){return t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline",t}({}),Lr=function(t){return t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState",t}({}),Br=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Mr.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Mr.Unknown),b(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(dt.OnlineStateTimeout,1e4,(function(){return t.onlineStateTimer=null,b(t.state===Mr.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Mr.Offline),Promise.resolve()})))},t.prototype.handleWatchStreamFailure=function(t){this.state===Mr.Online?(this.setAndBroadcast(Mr.Unknown),b(0===this.watchStreamFailures,"watchStreamFailures must be 0"),b(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Mr.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Mr.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(m(e),this.shouldWarnClientIsOffline=!1):v("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),Fr=function(t){return t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS",t}({});function Ur(t){switch(t){case E.OK:return g("Treated status OK as error");case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0;default:return g("Unknown status code: "+t)}}function Vr(t){if(void 0===t)return m("GRPC error has no .code"),E.UNKNOWN;switch(t){case Fr.OK:return E.OK;case Fr.CANCELLED:return E.CANCELLED;case Fr.UNKNOWN:return E.UNKNOWN;case Fr.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case Fr.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case Fr.INTERNAL:return E.INTERNAL;case Fr.UNAVAILABLE:return E.UNAVAILABLE;case Fr.UNAUTHENTICATED:return E.UNAUTHENTICATED;case Fr.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case Fr.NOT_FOUND:return E.NOT_FOUND;case Fr.ALREADY_EXISTS:return E.ALREADY_EXISTS;case Fr.PERMISSION_DENIED:return E.PERMISSION_DENIED;case Fr.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case Fr.ABORTED:return E.ABORTED;case Fr.OUT_OF_RANGE:return E.OUT_OF_RANGE;case Fr.UNIMPLEMENTED:return E.UNIMPLEMENTED;case Fr.DATA_LOSS:return E.DATA_LOSS;default:return g("Unknown status code: "+t)}}function jr(t){if(void 0===t)return Fr.OK;switch(t){case E.OK:return Fr.OK;case E.CANCELLED:return Fr.CANCELLED;case E.UNKNOWN:return Fr.UNKNOWN;case E.DEADLINE_EXCEEDED:return Fr.DEADLINE_EXCEEDED;case E.RESOURCE_EXHAUSTED:return Fr.RESOURCE_EXHAUSTED;case E.INTERNAL:return Fr.INTERNAL;case E.UNAVAILABLE:return Fr.UNAVAILABLE;case E.UNAUTHENTICATED:return Fr.UNAUTHENTICATED;case E.INVALID_ARGUMENT:return Fr.INVALID_ARGUMENT;case E.NOT_FOUND:return Fr.NOT_FOUND;case E.ALREADY_EXISTS:return Fr.ALREADY_EXISTS;case E.PERMISSION_DENIED:return Fr.PERMISSION_DENIED;case E.FAILED_PRECONDITION:return Fr.FAILED_PRECONDITION;case E.ABORTED:return Fr.ABORTED;case E.OUT_OF_RANGE:return Fr.OUT_OF_RANGE;case E.UNIMPLEMENTED:return Fr.UNIMPLEMENTED;case E.DATA_LOSS:return Fr.DATA_LOSS;default:return g("Unknown status code: "+t)}}var qr=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ht.comparator(e.key,n.key)}:function(t,e){return ht.comparator(t.key,e.key)},this.keyedMap=Lt(),this.sortedSet=new kt(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Gr=function(t){return t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata",t}({}),zr=function(t){return t[t.Local=0]="Local",t[t.Synced=1]="Synced",t}({}),Hr=function(){function t(){this.changeMap=new kt(ht.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Gr.Added&&n.type===Gr.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Gr.Metadata&&n.type!==Gr.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Gr.Modified&&n.type===Gr.Modified?this.changeMap=this.changeMap.insert(e,{type:Gr.Modified,doc:t.doc}):t.type===Gr.Modified&&n.type===Gr.Added?this.changeMap=this.changeMap.insert(e,{type:Gr.Added,doc:t.doc}):t.type===Gr.Removed&&n.type===Gr.Added?this.changeMap=this.changeMap.remove(e):t.type===Gr.Removed&&n.type===Gr.Modified?this.changeMap=this.changeMap.insert(e,{type:Gr.Removed,doc:n.doc}):t.type===Gr.Added&&n.type===Gr.Removed?this.changeMap=this.changeMap.insert(e,{type:Gr.Modified,doc:t.doc}):g("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal((function(e,n){t.push(n)})),t},t}(),Wr=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:Gr.Added,doc:t})})),new t(e,n,qr.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Kr=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=Xr.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Ct.MIN,i,qt(),Nt(),Vt())},t}(),Xr=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(w(),n,Vt(),Vt(),Vt())},t}(),Yr=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},Qr=function(t,e){this.targetId=t,this.existenceFilter=e},Jr=function(t){return t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset",t}({}),Zr=function(t,e,n,r){void 0===n&&(n=w()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},$r=function(){function t(){this.pendingResponses=0,this.documentChanges=ni(),this._resumeToken=w(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=Vt(),e=Vt(),n=Vt();return this.documentChanges.forEach((function(r,i){switch(i){case Gr.Added:t=t.add(r);break;case Gr.Modified:e=e.add(r);break;case Gr.Removed:n=n.add(r);break;default:g("Encountered invalid change type: "+i)}})),new Xr(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=ni()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),ti=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Nt(),this.pendingDocumentTargetMapping=ei(),this.pendingTargetResets=new Ot(Q)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof ze?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof He&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.removeDocumentFromTarget(r=o[i],t.key,t.newDoc)},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.ensureTargetState(n);switch(t.state){case Jr.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case Jr.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case Jr.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),b(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case Jr.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case Jr.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:g("Unknown target watch change state: "+t.state)}}))},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):S(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new ht(i.path);this.removeDocumentFromTarget(e,o,new He(o,Ct.forDeletedDoc()))}else b(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};S(this.targetStates,(function(r,i){var o=e.targetDataForActiveTarget(r);if(o){if(i.current&&o.target.isDocumentQuery()){var a=new ht(o.target.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new He(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}}));var r=Vt();this.pendingDocumentTargetMapping.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.targetDataForActiveTarget(t);return!n||n.purpose===Cn.LimboResolution||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Kr(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Nt(),this.pendingDocumentTargetMapping=ei(),this.pendingTargetResets=new Ot(Q),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Gr.Modified:Gr.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Gr.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new $r),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Ot(Q),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||v("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;b(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new $r,this.metadataProvider.getRemoteKeysForTarget(t).forEach((function(n){e.removeDocumentFromTarget(t,n,null)}))},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function ei(){return new kt(ht.comparator)}function ni(){return new kt(ht.comparator)}var ri="RemoteStore",ii=function(){function t(t,e,n,r,i){var a=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback((function(t){n.enqueueAndForget((function(){return o.__awaiter(a,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(v(ri,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.onlineStateTracker=new Br(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Mr.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.disableNetwork=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Mr.Offline),[2]}}))}))},t.prototype.disableNetworkInternal=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(v(ri,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}}))}))},t.prototype.shutdown=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return v(ri,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Mr.Unknown),[2]}}))}))},t.prototype.listen=function(t){C(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},t.prototype.unlisten=function(t){b(C(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),I(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Mr.Unknown))},t.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){b(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new ti(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!I(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return o.__awaiter(this,void 0,void 0,(function(){var t=this;return o.__generator(this,(function(e){return S(this.listenTargets,(function(e,n){t.sendWatchRequest(n)})),[2]}))}))},t.prototype.onWatchStreamClose=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return void 0===t&&b(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Mr.Unknown),[2]}))}))},t.prototype.onWatchStreamChange=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Mr.Online),t instanceof Zr&&t.state===Jr.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof Yr?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Qr?this.watchChangeAggregator.handleExistenceFilter(t):(b(t instanceof Zr,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Ct.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.raiseWatchSnapshot=function(t){var e=this;b(!t.isEqual(Ct.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return S(n.targetChanges,(function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(w(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new kn(n.target,t,Cn.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}})),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;b(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return o.__awaiter(e,void 0,void 0,(function(){return o.__generator(this,(function(e){return C(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]}))}))}))})),r},t.prototype.fillWritePipeline=function(){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(e){switch(e.label){case 0:return this.canAddToWritePipeline()?[4,this.localStore.nextMutationBatch(this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1)]:[3,4];case 1:return null!==(t=e.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(t),[4,this.fillWritePipeline()];case 3:e.sent(),e.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}}))}))},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){b(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){b(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.writeStream.writeHandshake(),[2]}))}))},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then((function(){for(var e=0,n=t.writePipeline;e<n.length;e++)t.writeStream.writeMutations(n[e].mutations)})).catch(Vn)},t.prototype.onMutationResult=function(t,e){var n=this;b(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=zt.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then((function(){return n.fillWritePipeline()}))},t.prototype.onWriteStreamClose=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e=this;return o.__generator(this,(function(n){return void 0===t&&b(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then((function(){e.shouldStartWriteStream()&&e.startWriteStream()}))]:[2]}))}))},t.prototype.handleHandshakeError=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return Ur(t.code)?(v(ri,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=w(),[2,this.localStore.setLastStreamToken(w()).catch(Vn)]):[2]}))}))},t.prototype.handleWriteError=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n=this;return o.__generator(this,(function(r){return Ur(i=t.code)&&i!==E.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then((function(){return n.fillWritePipeline()}))]):[2];var i}))}))},t.prototype.createTransaction=function(){return new Rr(this.datastore)},t.prototype.restartNetwork=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Mr.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},t.prototype.handleCredentialChange=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.canUseNetwork()?(v(ri,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.applyPrimaryState=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Mr.Unknown),e.label=4;case 4:return[2]}}))}))},t}(),oi=function(){function t(t,e){if(P("GeoPoint",arguments,2),R("GeoPoint","number",1,t),R("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new x(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return Q(this._lat,t._lat)||Q(this._long,t._long)},t}(),ai=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new Be(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),si=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=li(t),n=function(t){e.find((function(e){return e.isEqual(t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new qe(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&J(e.elements,this.elements)},t}(),ui=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=li(t),n=function(t){e=e.filter((function(e){return!e.isEqual(t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return new qe(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&J(e.elements,this.elements)},t}(),ci=function(){function t(t){this.operand=t}return t.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);return n instanceof Ne&&this.operand instanceof Ne?new Ne(n.internalValue+this.operand.internalValue):new Re(n.internalValue+this.operand.internalValue)},t.prototype.applyToRemoteDocument=function(t,e){return b(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.computeBaseValue=function(t){return t instanceof Pe?t:new Ne(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function li(t){return t instanceof qe?t.internalValue.slice():[]}var hi,fi,di=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),pi=((hi={})[ur.ASCENDING.name]="ASCENDING",hi[ur.DESCENDING.name]="DESCENDING",hi),vi=((fi={})[er.LESS_THAN.name]="LESS_THAN",fi[er.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",fi[er.GREATER_THAN.name]="GREATER_THAN",fi[er.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",fi[er.EQUAL.name]="EQUAL",fi[er.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",fi[er.IN.name]="IN",fi[er.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",fi),mi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yi(t,e){b(!Yn(t),e+" is missing")}function gi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):g("can't parse "+t)}var bi=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?E.UNKNOWN:Vr(t.code);return new x(e,t.message||"")},t.prototype.toInt32Value=function(t){return this.options.useProto3Json||Yn(t)?t:{value:t}},t.prototype.fromInt32Value=function(t){var e;return Yn(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);b(!!t,"Cannot deserialize null or undefined timestamp.");var e=gi(t.seconds||"0");return new Tt(e,t.nanos||0)},t.prototype.fromIso8601String=function(t){var e=0,n=mi.exec(t);if(b(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Tt(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(b(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),et.fromBase64String(t)):(b(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),et.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return b(!!t,"Trying to deserialize version that isn't set"),Ct.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=ut.fromString(t);return b(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return b(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),b(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new ht(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?ut.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new ut(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new ut(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return b(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Ie)return{nullValue:"NULL_VALUE"};if(t instanceof Oe)return{booleanValue:t.value()};if(t instanceof Ne)return{integerValue:""+t.value()};if(t instanceof Re){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Me?{stringValue:t.value()}:t instanceof je?{mapValue:this.toMapValue(t)}:t instanceof qe?{arrayValue:this.toArrayValue(t)}:t instanceof Le?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Ve?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Fe?{bytesValue:this.toBytes(t.value())}:t instanceof Ue?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:g("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Ie.INSTANCE;if("booleanValue"in t)return Oe.of(t.booleanValue);if("integerValue"in t)return new Ne(gi(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Re.NAN;if("Infinity"===t.doubleValue)return Re.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Re.NEGATIVE_INFINITY}return new Re(t.doubleValue)}if("stringValue"in t)return new Me(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t)return yi(t.arrayValue,"arrayValue"),new qe((t.arrayValue.values||[]).map((function(t){return e.fromValue(t)})));if("timestampValue"in t)return yi(t.timestampValue,"timestampValue"),new Le(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t)return yi(t.geoPointValue,"geoPointValue"),new Ve(new oi(t.geoPointValue.latitude||0,t.geoPointValue.longitude||0));if("bytesValue"in t){yi(t.bytesValue,"bytesValue");var n=this.fromBlob(t.bytesValue);return new Fe(n)}if("referenceValue"in t){yi(t.referenceValue,"referenceValue");var r=this.fromResourceName(t.referenceValue),i=new ot(r.get(1),r.get(3)),o=new ht(this.extractLocalPathFromResourceName(r));return new Ue(i,o)}return g("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return b(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new ze(r,i,{hasCommittedMutations:!!e},void 0,t,(function(t){return n.fromValue(t)}))},t.prototype.toFields=function(t){var e=this,n={};return t.forEach((function(t,r){n[t]=e.toValue(r)})),n},t.prototype.fromFields=function(t){var e=this,n=je.EMPTY;return A(t,(function(t,r){n=n.set(new lt([t]),e.fromValue(r))})),n},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.toValue(t))})),{values:n}},t.prototype.fromFound=function(t){var e=this;b(!!t.found,"Tried to deserialize a found document from a missing document."),yi(t.found.name,"doc.found.name"),yi(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new ze(n,r,{},void 0,t.found,(function(t){return e.fromValue(t)}))},t.prototype.fromMissing=function(t){b(!!t.missing,"Tried to deserialize a missing document from a found document."),b(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new He(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):g("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case Jr.Added:return"ADD";case Jr.Current:return"CURRENT";case Jr.NoChange:return"NO_CHANGE";case Jr.Removed:return"REMOVE";case Jr.Reset:return"RESET";default:return g("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof Qr)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof Yr){var e;if(t.newDoc instanceof ze)return{documentChange:{document:{name:this.toName((e=t.newDoc).key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}};if(t.newDoc instanceof He)return{documentDelete:{document:this.toName((e=t.newDoc).key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof Zr){var n=void 0;return t.cause&&(n={code:jr(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return g("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){yi(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new Zr(r,i,o,s||null)}else if("documentChange"in t){yi(t.documentChange,"documentChange");var u=t.documentChange;yi(u.document,"documentChange.name"),yi(u.document.name,"documentChange.document.name"),yi(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),l=this.fromVersion(u.document.updateTime),h=new ze(c,l,{},void 0,u.document,(function(t){return n.fromValue(t)}));e=new Yr(u.targetIds||[],u.removedTargetIds||[],h.key,h)}else if("documentDelete"in t){yi(t.documentDelete,"documentDelete");var f=t.documentDelete;yi(f.document,"documentDelete.document"),c=this.fromName(f.document),l=f.readTime?this.fromVersion(f.readTime):Ct.forDeletedDoc(),h=new He(c,l),e=new Yr([],f.removedTargetIds||[],h.key,h)}else if("documentRemove"in t){yi(t.documentRemove,"documentRemove");var d=t.documentRemove;yi(d.document,"documentRemove"),c=this.fromName(d.document),e=new Yr([],d.removedTargetIds||[],c,null)}else{if(!("filter"in t))return g("Unknown change type "+JSON.stringify(t));yi(t.filter,"filter");var p=t.filter;yi(p.targetId,"filter.targetId");var v=new di(p.count||0);e=new Qr(p.targetId,v)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?Jr.NoChange:"ADD"===t?Jr.Added:"REMOVE"===t?Jr.Removed:"CURRENT"===t?Jr.Current:"RESET"===t?Jr.Reset:g("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Ct.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ct.MIN:e.readTime?this.fromVersion(e.readTime):Ct.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof we)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Te)e={delete:this.toName(t.key)};else if(t instanceof Ee)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof xe))return g("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.toFieldTransform(t)}))}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):be.NONE;if(t.update){yi(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Ee(r,i,o,n)}return new we(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new Te(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map((function(t){return e.fromFieldTransform(t)}));return b(!0===n.exists,'Transforms only support precondition "exists == true"'),new xe(r,a)}return g("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return b(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:g("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?be.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?be.exists(t.exists):be.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=this.fromVersion(t.updateTime?t.updateTime:e);r.isEqual(Ct.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map((function(t){return n.fromValue(t)}))),new ye(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(b(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.fromWriteResult(t,e)}))):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof ai)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof si)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof ui)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map((function(t){return e.toValue(t)}))}};if(n instanceof ci)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw g("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)b("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=ai.instance;else if("appendMissingElements"in t)n=new si((t.appendMissingElements.values||[]).map((function(t){return e.fromValue(t)})));else if("removeAllFromArray"in t)n=new ui((t.removeAllFromArray.values||[]).map((function(t){return e.fromValue(t)})));else if("increment"in t){var r=this.fromValue(t.increment);b(r instanceof Pe,"NUMERIC_ADD transform requires a NumberValue"),n=new ci(r)}else g("Unknown transform proto: "+JSON.stringify(t));var i=lt.fromServerFormat(t.fieldPath);return new me(i,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;return b(1===e,"DocumentsTarget contained other than 1 document: "+e),$n.atPath(this.fromQueryPath(t.documents[0])).toTarget()},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(b(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(b(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){b(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var l=null;return n.endAt&&(l=this.fromCursor(n.endAt)),new $n(e,i,s,a,u,Zn.First,c,l).toTarget()},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case Cn.Listen:return null;case Cn.ExistenceFilterMismatch:return"existence-filter-mismatch";case Cn.LimboResolution:return"limbo-document";default:return g("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof nr?e.toUnaryOrFieldFilter(t):g("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.fromFilter(t)})).reduce((function(t,e){return t.concat(e)})):g("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.toPropertyOrder(t)}))},t.prototype.fromOrder=function(t){var e=this;return t.map((function(t){return e.fromPropertyOrder(t)}))},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map((function(t){return e.toValue(t)}))}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map((function(t){return e.fromValue(t)}));return new cr(r,n)},t.prototype.toDirection=function(t){return pi[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return ur.ASCENDING;case"DESCENDING":return ur.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return vi[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return er.EQUAL;case"GREATER_THAN":return er.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return er.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return er.LESS_THAN;case"LESS_THAN_OR_EQUAL":return er.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return er.ARRAY_CONTAINS;case"IN":return er.IN;case"ARRAY_CONTAINS_ANY":return er.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return g("Unspecified operator");default:return g("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return lt.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new lr(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return nr.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===er.EQUAL){if(t.value.isEqual(Re.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Ie.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return nr.create(e,er.EQUAL,Re.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return nr.create(n,er.EQUAL,Ie.INSTANCE);case"OPERATOR_UNSPECIFIED":return g("Unspecified filter");default:return g("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map((function(t){return lt.fromServerFormat(t)}));return ve.fromArray(e)},t}(),_i=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},wi=function(){function t(t){this.syncEngine=t,this.queries=new Ke((function(t){return t.canonicalId()})),this.onlineState=Mr.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new _i,this.queries.set(e,r)),r.listeners.push(t),b(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.viewSnap&&t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then((function(t){return r.targetId=t,t})):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,r,i;return o.__generator(this,(function(o){return n=!1,(r=this.queries.get(e=t.query))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]}))}))},t.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=this.queries.get(i.query);if(o){for(var a=0,s=o.listeners;a<s.length;a++)s[a].onViewSnapshot(i)&&(e=!0);o.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].applyOnlineStateChange(t)&&(e=!0)})),e&&this.raiseSnapshotsInSyncEvent()},t.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},t.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},t.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach((function(t){t.next()}))},t}(),Ei=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=Mr.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(b(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Gr.Metadata&&e.push(i)}t=new Wr(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},t.prototype.shouldRaiseInitialEvent=function(t,e){return b(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache||(this.options.waitForSyncWhenOnline&&e!==Mr.Offline?(b(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Mr.Offline)},t.prototype.shouldRaiseEvent=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){b(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Wr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),xi=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}return t.fromSnapshot=function(e,n){for(var r=Vt(),i=Vt(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Gr.Added:r=r.add(s.doc.key);break;case Gr.Removed:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ti=function(t){this.key=t},Ci=function(t){this.key=t},ki=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Vt(),this.mutatedKeys=Vt(),this.documentSet=new qr(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new Hr,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimitToFirst()&&i.size===this.query.limit?i.last():null,c=this.query.hasLimitToLast()&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var l=i.get(t),h=e instanceof ze?e:null;h&&(b(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;l&&h?l.data().isEqual(h.data())?f!==d&&(r.track({type:Gr.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(l,h)||(r.track({type:Gr.Modified,doc:h}),p=!0,(u&&n.query.docComparator(h,u)>0||c&&n.query.docComparator(h,c)<0)&&(s=!0)):!l&&h?(r.track({type:Gr.Added,doc:h}),p=!0):l&&!h&&(r.track({type:Gr.Removed,doc:l}),p=!0,(u||c)&&(s=!0)),p&&(h?(a=a.add(h),o=d?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))})),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;a.size>this.query.limit;){var l=this.query.hasLimitToFirst()?a.last():a.first();a=a.delete(l.key),o=o.delete(l.key),r.track({type:Gr.Removed,doc:l})}return b(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;b(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case Gr.Added:return 1;case Gr.Modified:case Gr.Metadata:return 2;case Gr.Removed:return 0;default:return g("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)})),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?zr.Synced:zr.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new Wr(this.query,t.documentSet,i,o,t.mutatedKeys,s===zr.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Mr.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Hr,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.add(t)})),t.modifiedDocuments.forEach((function(t){return b(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")})),t.removedDocuments.forEach((function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)})),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Vt(),this.documentSet.forEach((function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))}));var n=[];return e.forEach((function(e){t.limboDocuments.has(e)||n.push(new Ci(e))})),this.limboDocuments.forEach((function(t){e.has(t)||n.push(new Ti(t))})),n},t.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Vt();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},t.prototype.computeInitialSnapshot=function(){return Wr.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===zr.Local)},t}(),Si=5,Ai=function(){function t(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=Si,this.backoff=new Ar(this.asyncQueue,dt.RetryTransaction)}return t.prototype.run=function(){this.runWithBackOff()},t.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun((function(){return o.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return o.__generator(this,(function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.handleTransactionError(t)}))}))})).catch((function(t){n.handleTransactionError(t)})),[2]}))}))}))},t.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!Yn(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(m){return this.deferred.reject(m),null}},t.prototype.handleTransactionError=function(t){var e=this;this.retries>0&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget((function(){return e.runWithBackOff(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ur(e)}return!1},t}(),Ii=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Oi=function(t){this.key=t,this.receivedDocument=!1},Pi=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Ke((function(t){return t.canonicalId()})),this.queriesByTarget={},this.limboTargetsByKey=new kt(ht.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new vr,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ce.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Mr.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){b(null!==t,"SyncEngine listener cannot be null"),b(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,r,i,a;return o.__generator(this,(function(o){switch(o.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(this.sharedClientState.addLocalQueryTarget(e=r.targetId),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(t.toTarget())];case 2:return i=o.sent(),a=this.sharedClientState.addLocalQueryTarget(i.targetId),[4,this.initializeViewAndComputeSnapshot(t,e=i.targetId,"current"===a)];case 3:n=o.sent(),this.isPrimary&&this.remoteStore.listen(i),o.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}}))}))},t.prototype.initializeViewAndComputeSnapshot=function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var r,i,a,s,u,c;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return r=o.sent(),i=new ki(t,r.remoteKeys),a=i.computeDocChanges(r.documents),s=Xr.createSynthesizedTargetChangeForCurrentChange(e,n&&this.onlineState!==Mr.Offline),b(0===(u=i.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),b(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new Ii(t,e,i),this.queryViewsByQuery.set(t,c),this.queriesByTarget[e]||(this.queriesByTarget[e]=[]),this.queriesByTarget[e].push(t),[2,u.snapshot]}}))}))},t.prototype.synchronizeViewAndComputeSnapshot=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(r){switch(r.label){case 0:return[4,this.localStore.executeQuery(t.query,!0)];case 1:return e=r.sent(),n=t.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(t.targetId,n.limboChanges),[2,n]}}))}))},t.prototype.unlisten=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return o.__generator(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("unlisten()"),b(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),(n=this.queriesByTarget[e.targetId]).length>1?(this.queriesByTarget[e.targetId]=n.filter((function(e){return!e.isEqual(t)})),this.queryViewsByQuery.delete(t),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then((function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)})).catch(Vn)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}}))}))},t.prototype.runTransaction=function(t,e,n){new Ai(t,this.remoteStore,e,n).run()},t.prototype.applyRemoteEvent=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n=this;return o.__generator(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),A(t.targetChanges,(function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(b(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?b(r.receivedDocument,"Received change for limbo target document without add."):e.removedDocuments.size>0&&(b(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))})),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Vn(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Lr.RemoteStore||!this.isPrimary&&e===Lr.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach((function(e,r){var i=r.view.applyOnlineStateChange(t);b(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,r,i,a,s,u=this;return o.__generator(this,(function(o){switch(o.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),(r=(n=this.limboResolutionsByTarget[t])&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new kt(ht.comparator)).insert(r,new He(r,Ct.forDeletedDoc())),a=Vt().add(r),s=new Kr(Ct.MIN,{},new Ot(Q),i,a),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return[4,this.localStore.releaseTarget(t,!1).then((function(){return u.removeAndCleanupTarget(t,e)})).catch(Vn)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},t.prototype.applyBatchState=function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var r;return o.__generator(this,(function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(v("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):g("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}}))}))},t.prototype.applySuccessfulWrite=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),this.processUserCallback(e=t.batch.batchId,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Vn(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.rejectFailedWrite=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Vn(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.registerPendingWritesCallback=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?(t.resolve(),[2]):((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n),[2])}}))}))},t.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach((function(t){t.resolve()})),this.pendingWritesCallbacks.delete(t)},t.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach((function(e){e.forEach((function(e){e.reject(new x(E.CANCELLED,t))}))})),this.pendingWritesCallbacks.clear()},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new kt(Q)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(b(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),b(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach((function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)}))}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Ti?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof Ci?(v("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):g("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){v("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=$n.atPath(e.path);this.limboResolutionsByTarget[n]=new Oi(e),this.remoteStore.listen(new kn(r.toTarget(),n,Cn.LimboResolution,at.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,r,i,a=this;return o.__generator(this,(function(o){switch(o.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach((function(o,s){i.push(Promise.resolve().then((function(){var e=s.view.computeDocChanges(t);return e.needsRefill?a.localStore.executeQuery(s.query,!1).then((function(t){return s.view.computeDocChanges(t.documents,e)})):e})).then((function(t){var i=s.view.applyChanges(t,!0===a.isPrimary,e&&e.targetChanges[s.targetId]);if(a.updateTrackedLimbos(s.targetId,i.limboChanges),i.snapshot){a.isPrimary&&a.sharedClientState.updateQueryState(s.targetId,i.snapshot.fromCache?"not-current":"current"),n.push(i.snapshot);var o=xi.fromSnapshot(s.targetId,i.snapshot);r.push(o)}})))})),[4,Promise.all(i)];case 1:return o.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return o.sent(),[2]}}))}))},t.prototype.assertSubscribed=function(t){b(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n;return o.__generator(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}}))}))},t.prototype.applyPrimaryState=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,r,i,a,s,u=this;return o.__generator(this,(function(o){switch(o.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return o.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=o.sent(),r=0,i=n;r<i.length;r++)this.remoteStore.listen(i[r]);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),S(this.queriesByTarget,(function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then((function(){return u.removeAndCleanupTarget(t),u.localStore.releaseTarget(t,!0)})),u.remoteStore.unlisten(t)})),[4,s]);case 4:return o.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return o.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:o.sent(),o.label=7;case 7:return[2]}}))}))},t.prototype.resetLimboDocuments=function(){var t=this;S(this.limboResolutionsByTarget,(function(e){t.remoteStore.unlisten(e)})),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new kt(ht.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return o.__awaiter(this,void 0,void 0,(function(){var e,n,r,i,a,s,u,c,l,h,f,d,p;return o.__generator(this,(function(o){switch(o.label){case 0:e=[],n=[],r=0,i=t,o.label=1;case 1:return r<i.length?(s=void 0,(u=this.queriesByTarget[a=i[r]])&&0!==u.length?[4,this.localStore.releaseTarget(a,!0)]:[3,8]):[3,14];case 2:return o.sent(),[4,this.localStore.allocateTarget(u[0].toTarget())];case 3:s=o.sent(),c=0,l=u,o.label=4;case 4:return c<l.length?(b(!!(f=this.queryViewsByQuery.get(h=l[c])),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(f)]):[3,7];case 5:(d=o.sent()).snapshot&&n.push(d.snapshot),o.label=6;case 6:return c++,[3,4];case 7:return[3,12];case 8:return b(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(a)];case 9:return b(!!(p=o.sent()),"Target for id "+a+" not found"),[4,this.localStore.allocateTarget(p)];case 10:return s=o.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(p),a,!1)];case 11:o.sent(),o.label=12;case 12:e.push(s),o.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}}))}))},t.prototype.synthesizeTargetToQuery=function(t){return new $n(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,Zn.First,t.startAt,t.endAt)},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return o.__awaiter(this,void 0,void 0,(function(){var r,i;return o.__generator(this,(function(o){switch(o.label){case 0:if(this.isPrimary)return v("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[t])return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return r=o.sent(),i=Kr.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return o.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(t,!0)];case 5:return o.sent(),this.removeAndCleanupTarget(t,n),[3,7];case 6:g("Unexpected target state: "+e),o.label=7;case 7:return[2]}}))}))},t.prototype.applyActiveTargetsChange=function(t,e){return o.__awaiter(this,void 0,void 0,(function(){var n,r,i,a,s,u,c,l,h,f=this;return o.__generator(this,(function(d){switch(d.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,d.label=1;case 1:return n<r.length?(b(!this.queriesByTarget[h=r[n]],"Trying to add an already active target"),[4,this.localStore.getTarget(h)]):[3,6];case 2:return b(!!(i=d.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateTarget(i)];case 3:return a=d.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(i),a.targetId,!1)];case 4:d.sent(),this.remoteStore.listen(a),d.label=5;case 5:return n++,[3,1];case 6:s=function(t){return o.__generator(this,(function(e){switch(e.label){case 0:return u.queriesByTarget[t]?[4,u.localStore.releaseTarget(t,!1).then((function(){f.remoteStore.unlisten(t),f.removeAndCleanupTarget(t)})).catch(Vn)]:[2,"continue"];case 1:return e.sent(),[2]}}))},u=this,c=0,l=e,d.label=7;case 7:return c<l.length?[5,s(h=l[c])]:[3,10];case 8:d.sent(),d.label=9;case 9:return c++,[3,7];case 10:return[2]}}))}))},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Vt().add(e.key);var n=Vt(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);b(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},t}(),Di=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Ni="firestore_clients";function Ri(t,e){return b(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),Ni+"_"+t+"_"+e}var Mi="firestore_mutations";function Li(t,e,n){var r=Mi+"_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}var Bi="firestore_targets";function Fi(t,e){return Bi+"_"+t+"_"+e}var Ui="firestore_online_state",Vi="firestore_sequence_number",ji="SharedClientState",qi=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,b(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new x(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(m(ji,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Gi=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,b(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new x(r.error.code,r.error.message)),i?new t(e,r.state,o):(m(ji,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),zi=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=qt(),a=0;i&&a<r.activeTargetIds.length;++a)i=Qn(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(m(ji,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Hi=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&n.onlineState in Mr&&"string"==typeof n.clientId?new t(n.clientId,Mr[n.onlineState]):(m(ji,"Failed to parse online state: "+e),null)},t}(),Wi=function(){function t(){this.activeTargetIds=qt()}return t.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ki=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new x(E.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=Ri(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return Vi+"_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new Wi,this.clientStateKeyRe=new RegExp("^"+Ni+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Mi+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+Bi+"_"+a+"_(\\d+)$"),this.onlineStateKey=function(t){return Ui+"_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return o.__awaiter(this,void 0,void 0,(function(){var t,e,n,r,i,a,s,u,c,l,h=this;return o.__generator(this,(function(o){switch(o.label){case 0:return b(!this.started,"WebStorageSharedClientState already started"),b(null!==this.syncEngine,"syncEngine property must be set before calling start()"),b(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=o.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(Ri(this.persistenceKey,r)))&&(a=zi.fromWebStorageEntry(r,i))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,l=this.earlyEvents;c<l.length;c++)this.handleWebStorageEvent(l[c]);return this.earlyEvents=[],this.platform.window.addEventListener("unload",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=qt();return A(this.activeClients,(function(e,n){t=t.unionWith(n.activeTargetIds)})),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Fi(this.persistenceKey,t));if(n){var r=Gi.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Fi(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.removeMutationState(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return v(ji,"READ",t,e),e},t.prototype.setItem=function(t,e){v(ji,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){v(ji,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(v(ji,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void m("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget((function(){return o.__awaiter(e,void 0,void 0,(function(){var e,n,r,i,a,s;return o.__generator(this,(function(o){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(a=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(a)]}else t.key===this.sequenceNumberKey&&(b(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=at.INVALID;if(null!=t)try{var n=JSON.parse(t);b("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(r){m(ji,"Failed to read sequence number from WebStorage",r)}return e}(t.newValue))!==at.INVALID&&this.sequenceNumberHandler(s));return[2]}))}))}))}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new qi(this.currentUser,t,e,n),i=Li(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=Li(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){this.storage.setItem(this.onlineStateKey,JSON.stringify({clientId:this.localClientId,onlineState:Mr[t]}))},t.prototype.persistQueryTargetState=function(t,e,n){var r=Fi(this.persistenceKey,t),i=new Gi(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return b(null!==n,"Cannot parse client state key '"+t+"'"),zi.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);b(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]);return qi.fromWebStorageEntry(new Di(void 0!==n[2]?n[2]:null),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);b(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Gi.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return Hi.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(e){return t.user.uid!==this.currentUser.uid?(v(ji,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]}))}))},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),a=[],s=[];return i.forEach((function(t){return o.__awaiter(n,void 0,void 0,(function(){return o.__generator(this,(function(e){return r.has(t)||a.push(t),[2]}))}))})),r.forEach((function(t){return o.__awaiter(n,void 0,void 0,(function(){return o.__generator(this,(function(e){return i.has(t)||s.push(t),[2]}))}))})),this.syncEngine.applyActiveTargetsChange(a,s)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}(),Xi=function(){function t(){this.localState=new Wi,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new Wi,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),Yi=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Pn.withCacheSize(this.cacheSizeBytes)},t}(),Qi=function(){},Ji=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Y.newId()}return t.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new ft,r=new ft,i=!1;return this.credentials.setChangeListener((function(o){i?e.asyncQueue.enqueueAndForget((function(){return e.handleCredentialChange(o)})):(i=!0,e.initializePersistence(t,r,o).then((function(t){return e.initializeRest(o,t)})).then(n.resolve,n.reject))})),this.asyncQueue.enqueueAndForget((function(){return n.promise})),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.enableNetwork()}))},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Yi?this.startIndexedDbPersistence(n,t).then((function(t){return e.resolve(),t})).catch((function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()})):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof x?t.code===E.FAILED_PRECONDITION||t.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new x(E.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=Un.buildStoragePrefix(this.databaseInfo),i=new bi(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then((function(){return o.__awaiter(n,void 0,void 0,(function(){var n,a;return o.__generator(this,(function(o){switch(o.label){case 0:if(e.synchronizeTabs&&!Ki.isAvailable(this.platform))throw new x(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new Ki(this.asyncQueue,this.platform,r,this.clientId,t):new Xi,[4,Un.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return a=o.sent(),this.persistence=a,[2,a.referenceDelegate.garbageCollector]}}))}))}))},t.prototype.startMemoryPersistence=function(){return this.persistence=wr.createEagerPersistence(this.clientId),this.sharedClientState=new Xi,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return v("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then((function(r){return o.__awaiter(n,void 0,void 0,(function(){var n,i,a,s,u,c=this;return o.__generator(this,(function(l){switch(l.label){case 0:return n=new dr,this.localStore=new yr(this.persistence,n,t),[4,this.localStore.start()];case 1:return l.sent(),e&&(this.lruScheduler=new Dn(e,this.asyncQueue,this.localStore)),i=this.platform.newConnectivityMonitor(),a=this.platform.newSerializer(this.databaseInfo.databaseId),s=new Nr(this.asyncQueue,r,this.credentials,a),u=function(t){return c.syncEngine.applyOnlineStateChange(t,Lr.SharedClientState)},this.remoteStore=new ii(this.localStore,s,this.asyncQueue,(function(t){return c.syncEngine.applyOnlineStateChange(t,Lr.RemoteStore)}),i),this.syncEngine=new Pi(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=u,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new wi(this.syncEngine),[4,this.sharedClientState.start()];case 2:return l.sent(),[4,this.remoteStore.start()];case 3:return l.sent(),[4,this.persistence.setPrimaryStateListener((function(t){return o.__awaiter(c,void 0,void 0,(function(){return o.__generator(this,(function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}}))}))}))];case 4:return l.sent(),[4,this.persistence.setDatabaseDeletedListener((function(){return o.__awaiter(c,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 5:return l.sent(),[2]}}))}))}))},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return t.syncEngine.disableNetwork()}))},t.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown((function(){return o.__awaiter(t,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}}))}))}))},t.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new ft;return this.asyncQueue.enqueueAndForget((function(){return t.syncEngine.registerPendingWritesCallback(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new Ei(t,e,n);return this.asyncQueue.enqueueAndForget((function(){return r.eventMgr.listen(i)})),i},t.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.unlisten(t)}))},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return e.localStore.readDocument(t)})).then((function(t){if(t instanceof ze)return t;if(t instanceof He)return null;throw new x(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue((function(){return o.__awaiter(e,void 0,void 0,(function(){var e,n,r;return o.__generator(this,(function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t,!0)];case 1:return e=i.sent(),n=new ki(t,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}}))}))}))},t.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new ft;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.write(t,n)})),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget((function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()}))},t.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(t.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new ft;return this.asyncQueue.enqueueAndForget((function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()})),n.promise},t}(),Zi=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),$i=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new x(E.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+X(1,"element")+".")}(0,t);for(var n=0;n<t.length;++n)if(R("FieldPath","string",n,t[n]),0===t[n].length)throw new x(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lt(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(lt.keyField().canonicalString()),t}(),to=new RegExp("[~\\*/\\[\\]]"),eo=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},no=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){b(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(Di.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){b(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),ro=function(){function t(t){var e=this;this.tokenListener=null,this.currentUser=Di.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then((function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)}),(function(){})))}return t.prototype.getToken=function(){var t=this;b(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t.tokenCounter!==e)throw new x(E.ABORTED,"getToken aborted due to token change.");return n?(b("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new eo(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){b(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){b(null!=this.tokenListener,"removeChangeListener() called twice"),b(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return b(null===t||"string"==typeof t,"Received invalid UID: "+t),new Di(t)},t}(),io=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Di.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),oo=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new io(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(Di.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function ao(t){if(!t)return new no;switch(t.type){case"gapi":var e=t.client;return b(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new oo(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new x(E.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}function so(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}var uo=function(){function t(t){this._methodName=t}return t.delete=function(){return O("FieldValue.delete",arguments),co.instance},t.serverTimestamp=function(){return O("FieldValue.serverTimestamp",arguments),lo.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return D("FieldValue.arrayUnion",arguments,1),new ho(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return D("FieldValue.arrayRemove",arguments,1),new fo(t)},t.increment=function(t){return R("FieldValue.increment","number",1,t),P("FieldValue.increment",arguments,1),new po(t)},t.prototype.isEqual=function(t){return this===t},t}(),co=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return o.__extends(e,t),e.instance=new e,e}(uo),lo=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return o.__extends(e,t),e.instance=new e,e}(uo),ho=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return o.__extends(e,t),e}(uo),fo=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return o.__extends(e,t),e}(uo),po=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return o.__extends(e,t),e}(uo),vo=T(uo,"Use FieldValue.<field>() instead."),mo=/^__.*__$/,yo=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return n.push(null!==this.fieldMask?new Ee(t,this.data,this.fieldMask,e):new we(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new xe(t,this.fieldTransforms)),n},t}(),go=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Ee(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new xe(t,this.fieldTransforms)),n},t}(),bo=function(t){return t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument",t[t.ArrayArgument=4]="ArrayArgument",t}({});function _o(t){switch(t){case bo.Set:case bo.MergeSet:case bo.Update:return!0;case bo.Argument:case bo.ArrayArgument:return!1;default:throw g("Unexpected case for UserDataSource: "+t)}}var wo=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new x(E.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(_o(this.dataSource)&&mo.test(t))throw this.createError('Document fields cannot begin and end with "__"')},t}(),Eo=function(t,e){this.databaseId=t,this.key=e},xo=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new wo(bo.Set,t,lt.EMPTY_PATH);Co("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new yo(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new wo(bo.MergeSet,t,lt.EMPTY_PATH);Co("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Ot(lt.comparator),u=0,c=n;u<c.length;u++){var l=c[u],h=void 0;if(l instanceof $i)h=l._internalPath;else{if("string"!=typeof l)throw g("Expected stringOrFieldPath to be a string or a FieldPath");h=So(t,l)}if(!r.contains(h))throw new x(E.INVALID_ARGUMENT,"Field '"+h+"' is specified in your field mask but missing from your input data.");s=s.add(h)}i=ve.fromSet(s),o=r.fieldTransforms.filter((function(t){return i.covers(t.field)}))}else i=ve.fromArray(r.fieldMask),o=r.fieldTransforms;return new yo(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new wo(bo.Update,t,lt.EMPTY_PATH);Co("Data must be an object, but it was:",r,e);var i=new Ot(lt.comparator),o=je.EMPTY;A(e,(function(e,a){var s=So(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof co)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}}));var a=ve.fromSet(i);return new go(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new wo(bo.Update,t,lt.EMPTY_PATH),o=[ko(t,e)],a=[n];if(r.length%2!=0)throw new x(E.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(ko(t,r[s])),a.push(r[s+1]);var u=new Ot(lt.comparator),c=je.EMPTY;for(s=0;s<o.length;++s){var l=o[s],h=i.childContextForFieldPath(l),f=this.runPreConverter(a[s],h);if(f instanceof co)u=u.add(l);else{var d=this.parseData(f,h);null!=d&&(u=u.add(l),c=c.set(l,d))}}var p=ve.fromSet(u);return new go(c,p,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new wo(n?bo.ArrayArgument:bo.Argument,t,lt.EMPTY_PATH),i=this.parseData(e,r);return b(null!=i,"Parsed data should not be null."),b(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(r){var n=Ao(r);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(To(t=this.runPreConverter(t,e)))return Co("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof uo)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==bo.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new kt(Q);return I(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):A(t,(function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))})),new je(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=this.parseData(o[i],e.childContextForArray(r));null==a&&(a=Ie.INSTANCE),n.push(a),r++}return new qe(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!_o(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof co){if(e.dataSource!==bo.MergeSet)throw e.dataSource===bo.Update?(b(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof lo)e.fieldTransforms.push(new me(e.path,ai.instance));else if(t instanceof ho){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new si(n);e.fieldTransforms.push(new me(e.path,r))}else if(t instanceof fo){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new ui(n);e.fieldTransforms.push(new me(e.path,i))}else if(t instanceof po){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new ci(o);e.fieldTransforms.push(new me(e.path,a))}else g("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Ie.INSTANCE;if("number"==typeof t)return Qn(t)?new Ne(t):new Re(t);if("boolean"==typeof t)return Oe.of(t);if("string"==typeof t)return new Me(t);if(t instanceof Date)return new Le(Tt.fromDate(t));if(t instanceof Tt)return new Le(new Tt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof oi)return new Ve(t);if(t instanceof et)return new Fe(t);if(t instanceof Eo)return new Ue(t.databaseId,t.key);throw e.createError("Unsupported field value: "+q(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map((function(e,r){var i=new wo(bo.Argument,t,lt.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))}))},t}();function To(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Tt||t instanceof oi||t instanceof et||t instanceof Eo||t instanceof uo)}function Co(t,e,n){if(!To(n)||!j(n)){var r=q(n);throw e.createError("an object"===r?t+" a custom object":t+" "+r)}}function ko(t,e){if(e instanceof $i)return e._internalPath;if("string"==typeof e)return So(t,e);throw new x(E.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function So(t,e){try{return function(t){if(t.search(to)>=0)throw new x(E.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new($i.bind.apply($i,o.__spreadArrays([void 0],t.split("."))))}catch(e){throw new x(E.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(r){var n=Ao(r);throw new x(E.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Ao(t){return t instanceof Error?t.message:t.toString()}var Io="firestore.googleapis.com",Oo=!0,Po=!0,Do=!1,No=Pn.COLLECTION_DISABLED,Ro=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new x(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Io,this.ssl=Oo}else L("settings","non-empty string","host",t.host),this.host=t.host,B("settings","boolean","ssl",t.ssl),this.ssl=k(t.ssl,Oo);if(z("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),B("settings","object","credentials",t.credentials),this.credentials=t.credentials,B("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?m("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&m("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=k(t.timestampsInSnapshots,Po),B("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Pn.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==No&&t.cacheSizeBytes<Pn.MINIMUM_CACHE_SIZE_BYTES)throw new x(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Pn.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}B("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?Do:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),Mo=function(){function t(e,n){var r=this;if(this._firebaseApp=null,this._queue=new vt,this.INTERNAL={delete:function(){return o.__awaiter(r,void 0,void 0,(function(){return o.__generator(this,(function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var i=e;this._firebaseApp=i,this._databaseId=t.databaseIdFromApp(i),this._persistenceKey=i.name,this._credentials=new ro(n)}else{var a=e;if(!a.projectId)throw new x(E.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new ot(a.projectId,a.database),this._persistenceKey="[DEFAULT]",this._credentials=new no}this._settings=new Ro({}),this._dataConverter=this.createDataConverter(this._databaseId)}return t.prototype.settings=function(t){if(P("Firestore.settings",arguments,1),R("Firestore.settings","object",1,t),C(t,"persistence"))throw new x(E.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Ro(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new x(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._settings=e,void 0!==e.credentials&&(this._credentials=ao(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new x(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&m("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=k(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Yi(this._settings.cacheSizeBytes,e))},t.prototype.clearPersistence=function(){var t=this,e=Un.buildStoragePrefix(this.makeDatabaseInfo()),n=new ft;return this._queue.enqueueAndForgetEvenAfterShutdown((function(){return o.__awaiter(t,void 0,void 0,(function(){var t;return o.__generator(this,(function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new x(E.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Un.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}}))}))})),n.promise},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){return this.ensureClientConfigured(),so(t)?this.onSnapshotsInSyncInternal(t):(R("Firestore.onSnapshotsInSync","function",1,t),this.onSnapshotsInSyncInternal({next:t}))},t.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new Zi({next:function(){t.next&&t.next()},error:function(t){throw g("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Qi),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new rt(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},t.prototype.configureClient=function(t){b(!!this._settings.host,"FirestoreSettings.host is not set"),b(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new Ji(_.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},t.prototype.createDataConverter=function(t){return new xo((function(e){if(e instanceof Fo){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new x(E.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Eo(t,e._key)}return e}))},t.databaseIdFromApp=function(t){var e=t.options;if(!C(e,"projectId"))throw new x(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new x(E.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new ot(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._firebaseApp)throw new x(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return P("Firestore.collection",arguments,1),R("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new zo(ut.fromString(t),this)},t.prototype.doc=function(t){return P("Firestore.doc",arguments,1),R("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),Fo.forPath(ut.fromString(t),this)},t.prototype.collectionGroup=function(t){if(P("Firestore.collectionGroup",arguments,1),R("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new x(E.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new qo(new $n(ut.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return P("Firestore.runTransaction",arguments,1),R("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction((function(n){return t(new Lo(e,n))}))},t.prototype.batch=function(){return this.ensureClientConfigured(),new Bo(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(d()){case f.DEBUG:return"debug";case f.ERROR:return"error";case f.SILENT:return"silent";default:return g("Unknown log level: "+d())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(P("Firestore.setLogLevel",arguments,1),R("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":p(f.DEBUG);break;case"error":p(f.ERROR);break;case"silent":p(f.SILENT);break;default:throw new x(E.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},t}(),Lo=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;P("Transaction.get",arguments,1);var n=Xo("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return g("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof He)return new Vo(e._firestore,n._key,null,!1,!1,n._converter);if(r instanceof ze)return new Vo(e._firestore,n._key,r,!1,!1,n._converter);throw g("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},t.prototype.set=function(t,e,n){N("Transaction.set",arguments,2,3);var r=Xo("Transaction.set",t,this._firestore);n=Ho("Transaction.set",n);var i=Qo(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof $i?(D("Transaction.update",arguments,3),r=Xo("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(P("Transaction.update",arguments,2),r=Xo("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){P("Transaction.delete",arguments,1);var e=Xo("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Bo=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){N("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Xo("WriteBatch.set",t,this._firestore);n=Ho("WriteBatch.set",n);var i=Qo(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,be.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof $i?(D("WriteBatch.update",arguments,3),r=Xo("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(P("WriteBatch.update",arguments,2),r=Xo("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,be.exists(!0))),this},t.prototype.delete=function(t){P("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Xo("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Te(e._key,be.NONE)),this},t.prototype.commit=function(){return o.__awaiter(this,void 0,void 0,(function(){return o.__generator(this,(function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]}))}))},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new x(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Fo=function(){function t(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n,r){if(e.length%2!=0)throw new x(E.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new ht(e),n,r)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new zo(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(P("DocumentReference.collection",arguments,1),R("DocumentReference.collection","non-empty string",1,t),!t)throw new x(E.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=ut.fromString(t);return new zo(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)&&this._converter===e._converter},t.prototype.set=function(t,e){N("DocumentReference.set",arguments,1,2),e=Ho("DocumentReference.set",e);var n=Qo(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,be.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof $i?(D("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(P("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,be.exists(!0)))},t.prototype.delete=function(){return P("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Te(this._key,be.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];N("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||so(t[i])||(z("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),B("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return so(t[i])?n=t[i]:(R("DocumentReference.onSnapshot","function",i,t[i]),M("DocumentReference.onSnapshot","function",i+1,t[i+1]),M("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Zi({next:function(t){if(e.next){b(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Vo(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites,n._converter))}},error:r}),o=this._firestoreClient.listen($n.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return N("DocumentReference.get",arguments,0,1),Ko("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then((function(t){n(new Vo(e.firestore,e._key,t,!0,t instanceof ze&&t.hasLocalMutations,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new x(E.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new x(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t.prototype.withConverter=function(e){return new t(this._key,this.firestore,e)},t}(),Uo=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Vo=function(){function t(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}return t.prototype.data=function(t){if(N("DocumentSnapshot.data",arguments,0,1),t=Wo("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new jo(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),Se.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},t.prototype.get=function(t,e){if(N("DocumentSnapshot.get",arguments,1,2),e=Wo("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(ko("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,Se.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Fo(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Uo(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))&&this._converter===e._converter},t.prototype.toJSObject=function(t,e){var n=this,r={};return t.forEach((function(t,i){r[t]=n.toJSValue(i,e)})),r},t.prototype.toJSValue=function(t,e){if(t instanceof je)return this.toJSObject(t,e);if(t instanceof qe)return this.toJSArray(t,e);if(t instanceof Ue){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||m("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Fo(n,this._firestore,this._converter)}return t.value(e)},t.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map((function(t){return n.toJSValue(t,e)}))},t}(),jo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o.__extends(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return b(void 0!==n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Vo),qo=function(){function t(t,e,n){this._query=t,this.firestore=e,this._converter=n}return t.prototype.where=function(e,n,r){P("Query.where",arguments,3),G("Query.where",3,r);var i,o=["<","<=","==",">=",">","array-contains","in","array-contains-any"];U("Query.where",o,2,n);var a=ko("Query.where",e),s=er.fromString(n);if(a.isKeyField()){if(s===er.ARRAY_CONTAINS||s===er.ARRAY_CONTAINS_ANY)throw new x(E.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+s.toString()+"' queries on FieldPath.documentId().");if(s===er.IN){this.validateDisjunctiveFilterElements(r,s);for(var u=[],c=0,l=r;c<l.length;c++){var h=l[c];u.push(this.parseDocumentIdValue(h))}i=new qe(u)}else i=this.parseDocumentIdValue(r)}else s!==er.IN&&s!==er.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(r,s),i=this.firestore._dataConverter.parseQueryValue("Query.where",r,s===er.IN);var f=nr.create(a,s,i);return this.validateNewFilter(f),new t(this._query.addFilter(f),this.firestore,this._converter)},t.prototype.orderBy=function(e,n){var r;if(N("Query.orderBy",arguments,1,2),M("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=ur.ASCENDING;else{if("desc"!==n)throw new x(E.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=ur.DESCENDING}if(null!==this._query.startAt)throw new x(E.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new x(E.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=ko("Query.orderBy",e),o=new lr(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore,this._converter)},t.prototype.limit=function(e){return P("Query.limit",arguments,1),R("Query.limit","number",1,e),W("Query.limit",1,e),new t(this._query.withLimitToFirst(e),this.firestore,this._converter)},t.prototype.limitToLast=function(e){return P("Query.limitToLast",arguments,1),R("Query.limitToLast","number",1,e),W("Query.limitToLast",1,e),new t(this._query.withLimitToLast(e),this.firestore,this._converter)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];D("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore,this._converter)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];D("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore,this._converter)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];D("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore,this._converter)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];D("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore,this._converter)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.withConverter=function(e){return new t(this._query,this.firestore,e)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(G(t,1,e),e instanceof Vo){if(n.length>0)throw new x(E.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new x(E.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Ue(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Be)throw new x(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new x(E.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new cr(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new x(E.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new x(E.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new x(E.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(ut.fromString(a));if(!ht.isDocumentKey(s))throw new x(E.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new ht(s);i.push(new Ue(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new cr(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];N("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||so(t[i])||(z("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),B("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),so(t[i])?n=t[i]:(R("Query.onSnapshot","function",i,t[i]),M("Query.onSnapshot","function",i+1,t[i+1]),M("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Zi({next:function(t){e.next&&e.next(new Go(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new x(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},t.prototype.get=function(t){var e=this;return N("Query.get",arguments,0,1),Ko("Query.get",t),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then((function(t){n(new Go(e.firestore,e._query,t,e._converter))}),r):e.getViaSnapshotListener(n,r,t)}))},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new x(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new x(E.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new x(E.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(ut.fromString(t));if(!ht.isDocumentKey(e))throw new x(E.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new Ue(this.firestore._databaseId,new ht(e))}if(t instanceof Fo)return new Ue(this.firestore._databaseId,t._key);throw new x(E.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+q(t)+".")},t.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new x(E.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new x(E.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new x(E.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new x(E.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.validateNewFilter=function(t){if(t instanceof nr){var e=[er.ARRAY_CONTAINS,er.ARRAY_CONTAINS_ANY],n=[er.IN,er.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new x(E.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw new x(E.INVALID_ARGUMENT,s===t.op?"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter.":"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new x(E.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),Go=function(){function t(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Uo(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;N("QuerySnapshot.forEach",arguments,1,2),R("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach((function(r){t.call(e,n.convertToDocumentImpl(r))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new qo(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(z("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),B("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new x(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n,r){if(n.oldDocs.isEmpty()){var i,o=0;return n.docChanges.map((function(e){var a=new jo(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r);return b(e.type===Gr.Added,"Invalid event type for first snapshot"),b(!i||n.query.docComparator(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:a,oldIndex:-1,newIndex:o++}}))}var a=n.oldDocs;return n.docChanges.filter((function(t){return e||t.type!==Gr.Metadata})).map((function(e){var i=new jo(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key),r),o=-1,s=-1;return e.type!==Gr.Added&&(b((o=a.indexOf(e.doc.key))>=0,"Index for document not found"),a=a.delete(e.doc.key)),e.type!==Gr.Removed&&(s=(a=a.add(e.doc)).indexOf(e.doc.key)),{type:Yo(e.type),doc:i,oldIndex:o,newIndex:s}}))}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw H("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)&&this._converter===e._converter},t.prototype.convertToDocumentImpl=function(t){return new jo(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},t}();o.__spreadArrays(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(Go.prototype.docChanges,t,{get:function(){return function(){throw new x(E.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(e){}}));var zo=function(t){function e(e,n,r){var i=t.call(this,$n.atPath(e),n,r)||this;if(i._path=e,e.length%2!=1)throw new x(E.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return i}return o.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new Fo(new ht(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(N("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Y.newId()),R("CollectionReference.doc","non-empty string",1,t),""===t)throw new x(E.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=ut.fromString(t);return Fo.forPath(this._query.path.child(e),this.firestore,this._converter)},e.prototype.add=function(t){P("CollectionReference.add",arguments,1),R("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this._path,this.firestore,t)},e}(qo);function Ho(t,e){if(void 0===e)return{merge:!1};if(z(t,e,["merge","mergeFields"]),B(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r,i){if(!(r instanceof Array))throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires its mergeFields option to be an array, but it was: "+q(r));for(var o=0;o<r.length;++o)if(!("string"==typeof(a=r[o])||a instanceof $i))throw new x(E.INVALID_ARGUMENT,"Function "+t+"() requires all mergeFields elements to be a string or a FieldPath, but the value at index "+o+" was: "+q(r[o]));var a}(t,0,0,n),void 0!==e.mergeFields&&void 0!==e.merge)throw new x(E.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Wo(t,e){return void 0===e?{}:(z(t,e,["serverTimestamps"]),F(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Ko(t,e){M(t,"object",1,e),e&&(z(t,e,["source"]),F(t,0,"source",e.source,["default","server","cache"]))}function Xo(t,e,n){if(e instanceof Fo){if(e.firestore!==n)throw new x(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw H(t,"DocumentReference",1,e)}function Yo(t){switch(t){case Gr.Added:return"added";case Gr.Modified:case Gr.Metadata:return"modified";case Gr.Removed:return"removed";default:return g("Unknown change type: "+t)}}function Qo(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var Jo=T(Mo,"Use firebase.firestore() instead."),Zo=T(Lo,"Use firebase.firestore().runTransaction() instead."),$o=T(Bo,"Use firebase.firestore().batch() instead."),ta=T(Fo,"Use firebase.firestore().doc() instead."),ea=T(Vo),na=T(jo),ra=T(qo),ia=T(Go),oa=T(zo,"Use firebase.firestore().collection() instead."),aa={Firestore:Jo,GeoPoint:oi,Timestamp:Tt,Blob:nt,Transaction:Zo,WriteBatch:$o,DocumentReference:ta,DocumentSnapshot:ea,Query:ra,QueryDocumentSnapshot:na,QuerySnapshot:ia,CollectionReference:oa,FieldPath:$i,FieldValue:vo,setLogLevel:Mo.setLogLevel,CACHE_SIZE_UNLIMITED:No},sa=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),ua=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},t.prototype.onNetworkUnavailable=function(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),ca=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){b(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){b(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){b(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){b(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){b(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){b(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),la="Connection",ha={BatchGetDocuments:"batchGet",Commit:"commit"},fa="gl-js/ fire/"+l,da=function(){function t(t){this.databaseId=t.databaseId,this.baseUrl=(t.ssl?"https":"http")+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=fa},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise((function(a,s){var u=new c.XhrIo;u.listenOnce(c.EventType.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case c.ErrorCode.NO_ERROR:var e=u.getResponseJson();v(la,"XHR received:",JSON.stringify(e)),a(e);break;case c.ErrorCode.TIMEOUT:v(la,'RPC "'+t+'" timed out'),s(new x(E.DEADLINE_EXCEEDED,"Request time out"));break;case c.ErrorCode.HTTP_ERROR:var n=u.getStatus();if(v(la,'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var i=(o=r.status.toLowerCase().replace("_","-"),Object.values(E).indexOf(o)>=0?o:E.UNKNOWN);s(new x(i,r.message))}else s(new x(E.UNKNOWN,"Server responded with status "+u.getStatus()))}else v(la,'RPC "'+t+'" failed'),s(new x(E.UNAVAILABLE,"Connection failed."));break;default:g('RPC "'+t+'" failed with unanticipated webchannel error '+u.getLastErrorCode()+": "+u.getLastError()+", giving up.")}}finally{v(la,'RPC "'+t+'" completed.')}var o}));var l=o.__assign({},e);delete l.database;var h=JSON.stringify(l);v(la,"XHR sending: ",i+" "+h);var f={"Content-Type":"text/plain"};r.modifyHeadersForRequest(f,n),u.send(i,"POST",h,f,15)}))},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=c.createWebChannelTransport(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),s.isReactNative()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");v(la,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),u=!1,l=!1,h=new ca({sendFn:function(t){l?v(la,"Not sending because WebChannel is closed:",t):(u||(v(la,"Opening WebChannel transport."),a.open(),u=!0),v(la,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),f=function(t,e){a.listen(t,(function(t){try{e(t)}catch(n){setTimeout((function(){throw n}),0)}}))};return f(c.WebChannel.EventType.OPEN,(function(){l||v(la,"WebChannel transport opened.")})),f(c.WebChannel.EventType.CLOSE,(function(){l||(l=!0,v(la,"WebChannel transport closed"),h.callOnClose())})),f(c.WebChannel.EventType.ERROR,(function(t){l||(l=!0,v(la,"WebChannel transport errored:",t),h.callOnClose(new x(E.UNAVAILABLE,"The operation could not be completed")))})),f(c.WebChannel.EventType.MESSAGE,(function(t){var e;if(!l){var n=t.data[0];b(!!n,"Got a webchannel message without data.");var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){v(la,"WebChannel received error:",r);var i=r.status,o=function(t){var e=Fr[t];if(void 0!==e)return Vr(e)}(i),s=r.message;void 0===o&&(o=E.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),l=!0,h.callOnClose(new x(o,s)),a.close()}else v(la,"WebChannel received:",n),h.callOnMessage(n)}})),setTimeout((function(){h.callOnOpen()}),0),h},t.prototype.makeUrl=function(t){var e=ha[t];return b(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},t}();_.setPlatform(new(function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new da(t))},t.prototype.newConnectivityMonitor=function(){return ua.isAvailable()?new ua:new sa},t.prototype.newSerializer=function(t){return new bi(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}()));var pa="@firebase/firestore",va="1.9.1";function ma(t){(function(t){t.INTERNAL.registerComponent(new u.Component("firestore",(function(t){var e=t.getProvider("app").getImmediate();return new Mo(e,t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(function(t){b(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(aa)))})(t),t.registerVersion(pa,va)}ma(i),e.registerFirestore=ma},"6MUB":function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,n,i){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(i){var o=encodeURIComponent(r(i))+n;return Array.isArray(t[i])?t[i].map((function(t){return o+encodeURIComponent(r(t))})).join(e):o+encodeURIComponent(r(t[i]))})).join(e):i?encodeURIComponent(r(i))+n+encodeURIComponent(r(t)):""}},"6Pil":function(t,e,n){n("JtD1");var r=n("Wk7T");function i(t,e,n){n=r.defaults(n,{stiffness:100,damping:1}),this.stiffness=n.stiffness,this.damping=n.damping,this.bodyA=t,this.bodyB=e}t.exports=i,i.prototype.applyForce=function(){}},ANjH:function(t,e,n){"use strict";n.r(e),n.d(e,"__DO_NOT_USE__ActionTypes",(function(){return o})),n.d(e,"applyMiddleware",(function(){return v})),n.d(e,"bindActionCreators",(function(){return l})),n.d(e,"combineReducers",(function(){return u})),n.d(e,"compose",(function(){return p})),n.d(e,"createStore",(function(){return a}));var r=n("bCCX"),i=function(){return Math.random().toString(36).substring(7).split("").join(".")},o={INIT:"@@redux/INIT"+i(),REPLACE:"@@redux/REPLACE"+i(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+i()}};function a(t,e,n){var i;if("function"==typeof e&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(a)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var s=t,u=e,c=[],l=c,h=!1;function f(){l===c&&(l=c.slice())}function d(){if(h)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return u}function p(t){if("function"!=typeof t)throw new Error("Expected the listener to be a function.");if(h)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var e=!0;return f(),l.push(t),function(){if(e){if(h)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");e=!1,f();var n=l.indexOf(t);l.splice(n,1),c=null}}}function v(t){if(!function(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(h)throw new Error("Reducers may not dispatch actions.");try{h=!0,u=s(u,t)}finally{h=!1}for(var e=c=l,n=0;n<e.length;n++)(0,e[n])();return t}return v({type:o.INIT}),(i={dispatch:v,subscribe:p,getState:d,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");s=t,v({type:o.REPLACE})}})[r.a]=function(){var t,e=p;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");function n(){t.next&&t.next(d())}return n(),{unsubscribe:e(n)}}})[r.a]=function(){return this},t},i}function s(t,e){var n=e&&e.type;return"Given "+(n&&'action "'+String(n)+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function u(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var i=e[r];"function"==typeof t[i]&&(n[i]=t[i])}var a,u=Object.keys(n);try{!function(t){Object.keys(t).forEach((function(e){var n=t[e];if(void 0===n(void 0,{type:o.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:o.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+o.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(n)}catch(c){a=c}return function(t,e){if(void 0===t&&(t={}),a)throw a;for(var r=!1,i={},o=0;o<u.length;o++){var c=u[o],l=t[c],h=(0,n[c])(l,e);if(void 0===h){var f=s(c,e);throw new Error(f)}i[c]=h,r=r||h!==l}return(r=r||u.length!==Object.keys(t).length)?i:t}}function c(t,e){return function(){return e(t.apply(this,arguments))}}function l(t,e){if("function"==typeof t)return c(t,e);if("object"!=typeof t||null===t)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===t?"null":typeof t)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');var n={};for(var r in t){var i=t[r];"function"==typeof i&&(n[r]=c(i,e))}return n}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function f(t,e){var n=Object.keys(t);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(t)),e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?f(n,!0).forEach((function(e){h(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):f(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}function v(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(){var n=t.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},i={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},o=e.map((function(t){return t(i)}));return d({},n,{dispatch:r=p.apply(void 0,o)(n.dispatch)})}}}},AeTl:function(t,e){function n(t,e,n,r){this.shapeA=e,this.shapeB=r,this.bodyA=t,this.bodyB=n}t.exports=n,n.prototype.set=function(t,e,r,i){n.call(this,t,e,r,i)}},B9yW:function(t,e,n){var r=n("+1EK");function i(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}n("JtD1"),t.exports=i,(i.prototype=new r).constructor=i,i.prototype.computeB=function(t,e,n){var r=this.G;r[2]=-1,r[5]=this.ratio;var i=this.computeGiMf();return-this.computeGW()*e-n*i}},BcWo:function(t,e,n){var r=n("JtD1");function i(t){this.lowerBound=r.create(),t&&t.lowerBound&&r.copy(this.lowerBound,t.lowerBound),this.upperBound=r.create(),t&&t.upperBound&&r.copy(this.upperBound,t.upperBound)}n("Wk7T"),t.exports=i;var o=r.create();i.prototype.setFromPoints=function(t,e,n,i){var a=this.lowerBound,s=this.upperBound;"number"!=typeof n&&(n=0),0!==n?r.rotate(a,t[0],n):r.copy(a,t[0]),r.copy(s,a);for(var u=Math.cos(n),c=Math.sin(n),l=1;l<t.length;l++){var h=t[l];if(0!==n){var f=h[0],d=h[1];o[0]=u*f-c*d,o[1]=c*f+u*d,h=o}for(var p=0;p<2;p++)h[p]>s[p]&&(s[p]=h[p]),h[p]<a[p]&&(a[p]=h[p])}e&&(r.add(this.lowerBound,this.lowerBound,e),r.add(this.upperBound,this.upperBound,e)),i&&(this.lowerBound[0]-=i,this.lowerBound[1]-=i,this.upperBound[0]+=i,this.upperBound[1]+=i)},i.prototype.copy=function(t){r.copy(this.lowerBound,t.lowerBound),r.copy(this.upperBound,t.upperBound)},i.prototype.extend=function(t){for(var e=2;e--;){var n=t.lowerBound[e];this.lowerBound[e]>n&&(this.lowerBound[e]=n);var r=t.upperBound[e];this.upperBound[e]<r&&(this.upperBound[e]=r)}},i.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound;return(r[0]<=n[0]&&n[0]<=i[0]||e[0]<=i[0]&&i[0]<=n[0])&&(r[1]<=n[1]&&n[1]<=i[1]||e[1]<=i[1]&&i[1]<=n[1])},i.prototype.containsPoint=function(t){var e=this.lowerBound,n=this.upperBound;return e[0]<=t[0]&&t[0]<=n[0]&&e[1]<=t[1]&&t[1]<=n[1]},i.prototype.overlapsRay=function(t){var e=1/t.direction[0],n=1/t.direction[1],r=(this.lowerBound[0]-t.from[0])*e,i=(this.upperBound[0]-t.from[0])*e,o=(this.lowerBound[1]-t.from[1])*n,a=(this.upperBound[1]-t.from[1])*n,s=Math.max(Math.max(Math.min(r,i),Math.min(o,a))),u=Math.min(Math.min(Math.max(r,i),Math.max(o,a)));return u<0?-1:s>u?-1:s}},Bixm:function(t,e,n){var r=n("JtD1"),i=n("RZpa");function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}t.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(t){};var a=r.create();o.boundingRadiusCheck=function(t,e){r.sub(a,t.position,e.position);var n=r.squaredLength(a),i=t.boundingRadius+e.boundingRadius;return n<=i*i},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var n;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:n=o.boundingRadiusCheck(t,e);break;case o.AABB:n=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return n},o.canCollide=function(t,e){var n=i.KINEMATIC,r=i.STATIC;return!(t.type===r&&e.type===r||t.type===n&&e.type===r||t.type===r&&e.type===n||t.type===n&&e.type===n||t.sleepState===i.SLEEPING&&e.sleepState===i.SLEEPING||t.sleepState===i.SLEEPING&&e.type===r||e.sleepState===i.SLEEPING&&t.type===r)},o.NAIVE=1,o.SAP=2},C78X:function(t,e,n){var r=n("0pMi"),i=n("fq9q"),o=n("+1EK"),a=n("JtD1"),s=n("0DzJ");function u(t,e,n){r.call(this,t,e,r.PRISMATIC,n=n||{});var u=a.fromValues(0,0),c=a.fromValues(1,0),l=a.fromValues(0,0);n.localAnchorA&&a.copy(u,n.localAnchorA),n.localAxisA&&a.copy(c,n.localAxisA),n.localAnchorB&&a.copy(l,n.localAnchorB),this.localAnchorA=u,this.localAnchorB=l,this.localAxisA=c;var h=this.maxForce=void 0!==n.maxForce?n.maxForce:Number.MAX_VALUE,f=new o(t,e,-h,h),d=new a.create,p=new a.create,v=new a.create,m=new a.create;if(f.computeGq=function(){return a.dot(v,m)},f.updateJacobian=function(){var n=this.G,r=t.position,i=e.position;a.rotate(d,u,t.angle),a.rotate(p,l,e.angle),a.add(v,i,p),a.sub(v,v,r),a.sub(v,v,d),a.rotate(m,c,t.angle+Math.PI/2),n[0]=-m[0],n[1]=-m[1],n[2]=-a.crossLength(d,m)+a.crossLength(m,v),n[3]=m[0],n[4]=m[1],n[5]=a.crossLength(p,m)},this.equations.push(f),!n.disableRotationalLock){var y=new s(t,e,-h,h);this.equations.push(y)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==n.lowerLimit,this.upperLimitEnabled=void 0!==n.upperLimit,this.lowerLimit=void 0!==n.lowerLimit?n.lowerLimit:0,this.upperLimit=void 0!==n.upperLimit?n.upperLimit:1,this.upperLimitEquation=new i(t,e),this.lowerLimitEquation=new i(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=h,this.motorEquation=new o(t,e),this.motorEnabled=!1,this.motorSpeed=0;var g=this,b=this.motorEquation;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.bodyA,e=this.bodyB;return this.gmult(this.G,t.velocity,t.angularVelocity,e.velocity,e.angularVelocity)+g.motorSpeed}}t.exports=u,(u.prototype=new r).constructor=u;var c=a.create(),l=a.create(),h=a.create(),f=a.create(),d=a.create(),p=a.create();u.prototype.update=function(){var t=this.equations,e=this.upperLimit,n=this.lowerLimit,r=this.upperLimitEquation,i=this.lowerLimitEquation,o=this.bodyA,s=this.bodyB,u=this.localAxisA,v=this.localAnchorA,m=this.localAnchorB;t[0].updateJacobian(),a.rotate(c,u,o.angle),a.rotate(f,v,o.angle),a.add(l,f,o.position),a.rotate(d,m,s.angle),a.add(h,d,s.position);var y,g=this.position=a.dot(h,c)-a.dot(l,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=a.crossLength(c,d),b[3]=-c[0],b[4]=-c[1],b[5]=-a.crossLength(c,f)}this.upperLimitEnabled&&g>e?(a.scale(r.normalA,c,-1),a.sub(r.contactPointA,l,o.position),a.sub(r.contactPointB,h,s.position),a.scale(p,c,e),a.add(r.contactPointA,r.contactPointA,p),-1===t.indexOf(r)&&t.push(r)):-1!==(y=t.indexOf(r))&&t.splice(y,1),this.lowerLimitEnabled&&g<n?(a.scale(i.normalA,c,1),a.sub(i.contactPointA,l,o.position),a.sub(i.contactPointB,h,s.position),a.scale(p,c,n),a.sub(i.contactPointB,i.contactPointB,p),-1===t.indexOf(i)&&t.push(i)):-1!==(y=t.indexOf(i))&&t.splice(y,1)},u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},u.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},u.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},CPZc:function(t,e){function n(){}t.exports=n,n.area=function(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1])},n.left=function(t,e,r){return n.area(t,e,r)>0},n.leftOn=function(t,e,r){return n.area(t,e,r)>=0},n.right=function(t,e,r){return n.area(t,e,r)<0},n.rightOn=function(t,e,r){return n.area(t,e,r)<=0};var r=[],i=[];n.collinear=function(t,e,o,a){if(a){var s=r,u=i;s[0]=e[0]-t[0],s[1]=e[1]-t[1],u[0]=o[0]-e[0],u[1]=o[1]-e[1];var c=s[0]*u[0]+s[1]*u[1],l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),h=Math.sqrt(u[0]*u[0]+u[1]*u[1]);return Math.acos(c/(l*h))<a}return 0==n.area(t,e,o)},n.sqdist=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}},CxY0:function(t,e,n){"use strict";var r=n("nYho"),i=n("Nehr");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=b,e.resolve=function(t,e){return b(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},e.format=function(t){return i.isString(t)&&(t=b(t)),t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),h=["%","/","?",";","#"].concat(l),f=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=n("r8II");function b(t,e,n){if(t&&i.isObject(t)&&t instanceof o)return t;var r=new o;return r.parse(t,e,n),r}o.prototype.parse=function(t,e,n){if(!i.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var o=t.indexOf("?"),s=-1!==o&&o<t.indexOf("#")?"?":"#",c=t.split(s);c[0]=c[0].replace(/\\/g,"/");var b=t=c.join(s);if(b=b.trim(),!n&&1===t.split("#").length){var _=u.exec(b);if(_)return this.path=b,this.href=b,this.pathname=_[1],_[2]?(this.search=_[2],this.query=e?g.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var w=a.exec(b);if(w){var E=(w=w[0]).toLowerCase();this.protocol=E,b=b.substr(w.length)}if(n||w||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var x="//"===b.substr(0,2);!x||w&&m[w]||(b=b.substr(2),this.slashes=!0)}if(!m[w]&&(x||w&&!y[w])){for(var T,C,k=-1,S=0;S<f.length;S++)-1!==(A=b.indexOf(f[S]))&&(-1===k||A<k)&&(k=A);for(-1!==(C=-1===k?b.lastIndexOf("@"):b.lastIndexOf("@",k))&&(T=b.slice(0,C),b=b.slice(C+1),this.auth=decodeURIComponent(T)),k=-1,S=0;S<h.length;S++){var A;-1!==(A=b.indexOf(h[S]))&&(-1===k||A<k)&&(k=A)}-1===k&&(k=b.length),this.host=b.slice(0,k),b=b.slice(k),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var O=this.hostname.split(/\./),P=(S=0,O.length);S<P;S++){var D=O[S];if(D&&!D.match(d)){for(var N="",R=0,M=D.length;R<M;R++)D.charCodeAt(R)>127?N+="x":N+=D[R];if(!N.match(d)){var L=O.slice(0,S),B=O.slice(S+1),F=D.match(p);F&&(L.push(F[1]),B.unshift(F[2])),B.length&&(b="/"+B.join(".")+b),this.hostname=L.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),I||(this.hostname=r.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!v[E])for(S=0,P=l.length;S<P;S++){var U=l[S];if(-1!==b.indexOf(U)){var V=encodeURIComponent(U);V===U&&(V=escape(U)),b=b.split(U).join(V)}}var j=b.indexOf("#");-1!==j&&(this.hash=b.substr(j),b=b.slice(0,j));var q=b.indexOf("?");return-1!==q?(this.search=b.substr(q),this.query=b.substr(q+1),e&&(this.query=g.parse(this.query)),b=b.slice(0,q)):e&&(this.search="",this.query={}),b&&(this.pathname=b),y[E]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,a="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(a=g.stringify(this.query));var s=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+o+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(i.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var n=new o,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var u=Object.keys(t),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(n[l]=t[l])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!y[t.protocol]){for(var h=Object.keys(t),f=0;f<h.length;f++){var d=h[f];n[d]=t[d]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||m[t.protocol])n.pathname=t.pathname;else{for(var p=(t.pathname||"").split("/");p.length&&!(t.host=p.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}return n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,(n.pathname||n.search)&&(n.path=(n.pathname||"")+(n.search||"")),n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=g||v||n.host&&t.pathname,_=b,w=n.pathname&&n.pathname.split("/")||[],E=(p=t.pathname&&t.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(E&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===p[0]?p[0]=t.host:p.unshift(t.host)),t.host=null),b=b&&(""===p[0]||""===w[0])),g)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,w=p;else if(p.length)w||(w=[]),w.pop(),w=w.concat(p),n.search=t.search,n.query=t.query;else if(!i.isNullOrUndefined(t.search))return E&&(n.hostname=n.host=w.shift(),(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift())),n.search=t.search,n.query=t.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!w.length)return n.pathname=null,n.path=n.search?"/"+n.search:null,n.href=n.format(),n;for(var x=w.slice(-1)[0],T=(n.host||t.host||w.length>1)&&("."===x||".."===x)||""===x,C=0,k=w.length;k>=0;k--)"."===(x=w[k])?w.splice(k,1):".."===x?(w.splice(k,1),C++):C&&(w.splice(k,1),C--);if(!b&&!_)for(;C--;C)w.unshift("..");!b||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),T&&"/"!==w.join("/").substr(-1)&&w.push("");var S,A=""===w[0]||w[0]&&"/"===w[0].charAt(0);return E&&(n.hostname=n.host=A?"":w.length?w.shift():"",(S=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=S.shift(),n.host=n.hostname=S.shift())),(b=b||n.host&&w.length)&&!A&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},Dded:function(t,e,n){t.exports={Polygon:n("KEt/"),Point:n("CPZc")}},Dp7I:function(t,e,n){var r=n("JtD1"),i=n("yBzR");function o(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}t.exports=o,o.prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return r.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(t,e){r.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===i.ANY},o.prototype.set=function(t,e,n,i,o){r.copy(this.normal,t),this.shape=e,this.body=n,this.fraction=i,this.faceIndex=o}},Fmjy:function(t,e,n){var r=n("ucEh"),i=n("+1EK");function o(t,e,n){if(n=n||{},!(t instanceof r&&e instanceof r))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==n.friction?Number(n.friction):.3,this.restitution=void 0!==n.restitution?Number(n.restitution):0,this.stiffness=void 0!==n.stiffness?Number(n.stiffness):i.DEFAULT_STIFFNESS,this.relaxation=void 0!==n.relaxation?Number(n.relaxation):i.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==n.frictionStiffness?Number(n.frictionStiffness):i.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==n.frictionRelaxation?Number(n.frictionRelaxation):i.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==n.surfaceVelocity?Number(n.surfaceVelocity):0,this.contactSkinSize=.005}t.exports=o,o.idCounter=0},"I+AN":function(t,e,n){var r=n("JtD1"),i=n("rCTz"),o=n("sbLb");function a(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })"));var e=this.width=(t=t||{}).width||1,n=this.height=t.height||1,a=[r.fromValues(-e/2,-n/2),r.fromValues(e/2,-n/2),r.fromValues(e/2,n/2),r.fromValues(-e/2,n/2)],s=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=a,t.axes=s,t.type=i.BOX,o.call(this,t)}t.exports=a,(a.prototype=new o).constructor=a,a.prototype.computeMomentOfInertia=function(t){var e=this.width,n=this.height;return t*(n*n+e*e)/12},a.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},r.create(),r.create(),r.create(),r.create(),a.prototype.computeAABB=function(t,e,n){t.setFromPoints(this.vertices,e,n,0)},a.prototype.updateArea=function(){this.area=this.width*this.height}},I2ZF:function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}},JaUx:function(t,e,n){t.exports=function(){"use strict";function t(t,r,i,o,a){!function t(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1);t(n,r,Math.max(i,Math.floor(r-u*l/s+h)),Math.min(o,Math.floor(r+(s-u)*l/s+h)),a)}var f=n[r],d=i,p=o;for(e(n,i,r),a(n[o],f)>0&&e(n,i,o);d<p;){for(e(n,d,p),d++,p--;a(n[d],f)<0;)d++;for(;a(n[p],f)>0;)p--}0===a(n[i],f)?e(n,i,p):e(n,++p,o),p<=r&&(i=p+1),r<=p&&(o=p-1)}}(t,r,i||0,o||t.length-1,a||n)}function e(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function n(t,e){return t<e?-1:t>e?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,r,i){i||(i=p(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=e;o<n;o++){var a=t.children[o];s(i,t.leaf?r(a):a)}return i}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function l(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,n,r,i,o){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=i)){var s=n+Math.ceil((r-n)/i/2)*i;t(e,s,n,r,o),a.push(n,s,s,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var e=this.data,n=[];if(!d(t,e))return n;for(var r=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?r(a):a;d(t,s)&&(e.leaf?n.push(a):f(t,s)?this._all(a,n):i.push(a))}e=i.pop()}return n},r.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var n=[];e;){for(var r=0;r<e.children.length;r++){var i=e.children[r],o=e.leaf?this.toBBox(i):i;if(d(t,o)){if(e.leaf||f(t,o))return!0;n.push(i)}}e=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,e){if(!t)return this;for(var n,r,o,a=this.data,s=this.toBBox(t),u=[],c=[];a||u.length;){if(a||(a=u.pop(),r=u[u.length-1],n=c.pop(),o=!0),a.leaf){var l=i(t,a.children,e);if(-1!==l)return a.children.splice(l,1),u.push(a),this._condense(u),this}o||a.leaf||!f(a,s)?r?(a=r.children[++n],o=!1):a=null:(u.push(a),c.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,e){return t.minX-e.minX},r.prototype.compareMinY=function(t,e){return t.minY-e.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},r.prototype._build=function(t,e,n,r){var i,a=n-e+1,s=this._maxEntries;if(a<=s)return o(i=p(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,r-1))),(i=p([])).leaf=!1,i.height=r;var u=Math.ceil(a/s),c=u*Math.ceil(Math.sqrt(s));v(t,e,n,c,this.compareMinX);for(var l=e;l<=n;l+=c){var h=Math.min(l+c-1,n);v(t,l,h,u,this.compareMinY);for(var f=l;f<=h;f+=u){var d=Math.min(f+u-1,h);i.children.push(this._build(t,f,d,r-1))}}return o(i,this.toBBox),i},r.prototype._chooseSubtree=function(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],c=l(u),h=(f=t,d=u,(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-c);h<o?(o=h,i=c<i?c:i,a=u):h===o&&c<i&&(i=c,a=u)}e=a||e.children[0]}var f,d;return e},r.prototype._insert=function(t,e,n){var r=n?t:this.toBBox(t),i=[],o=this._chooseSubtree(r,this.data,e,i);for(o.children.push(t),s(o,r);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(r,i,e)},r.prototype._split=function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r),s=p(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},r.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,e,n){for(var r,i,o,s,u,c,h,f=1/0,d=1/0,p=e;p<=n-e;p++){var v=a(t,0,p,this.toBBox),m=a(t,p,n,this.toBBox),y=(i=v,o=m,s=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),c=Math.min(i.maxX,o.maxX),h=Math.min(i.maxY,o.maxY),Math.max(0,c-s)*Math.max(0,h-u)),g=l(v)+l(m);y<f?(f=y,r=p,d=g<d?g:d):y===f&&g<d&&(d=g,r=p)}return r||n-e},r.prototype._chooseSplitAxis=function(t,e,n){var r=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,e,n,r){t.children.sort(r);for(var i=this.toBBox,o=a(t,0,e,i),u=a(t,n-e,n,i),c=h(o)+h(u),l=e;l<n-e;l++){var f=t.children[l];s(o,t.leaf?i(f):f),c+=h(o)}for(var d=n-e-1;d>=e;d--){var p=t.children[d];s(u,t.leaf?i(p):p),c+=h(u)}return c},r.prototype._adjustParentBBoxes=function(t,e,n){for(var r=n;r>=0;r--)s(e[r],t)},r.prototype._condense=function(t){for(var e=t.length-1,n=void 0;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children).splice(n.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},r}()},JtD1:function(t,e,n){var r=t.exports={},i=n("Wk7T");r.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},r.crossVZ=function(t,e,n){return r.rotate(t,e,-Math.PI/2),r.scale(t,t,n),t},r.crossZV=function(t,e,n){return r.rotate(t,n,Math.PI/2),r.scale(t,t,e),t},r.rotate=function(t,e,n){if(0!==n){var r=Math.cos(n),i=Math.sin(n),o=e[0],a=e[1];t[0]=r*o-i*a,t[1]=i*o+r*a}else t[0]=e[0],t[1]=e[1]},r.rotate90cw=function(t,e){var n=e[0];t[0]=e[1],t[1]=-n},r.toLocalFrame=function(t,e,n,i){r.copy(t,e),r.sub(t,t,n),r.rotate(t,t,-i)},r.toGlobalFrame=function(t,e,n,i){r.copy(t,e),r.rotate(t,t,i),r.add(t,t,n)},r.vectorToLocalFrame=function(t,e,n){r.rotate(t,e,-n)},r.vectorToGlobalFrame=function(t,e,n){r.rotate(t,e,n)},r.centroid=function(t,e,n,i){return r.add(t,e,n),r.add(t,t,i),r.scale(t,t,1/3),t},r.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var n=new i.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,n){return t[0]=e,t[1]=n,t},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},r.div=r.divide,r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},r.distance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.normalize=function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.lerp=function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},r.reflect=function(t,e,n){var r=e[0]*n[0]+e[1]*n[1];t[0]=e[0]-2*n[0]*r,t[1]=e[1]-2*n[1]*r},r.getLineSegmentsIntersection=function(t,e,n,i,o){var a=r.getLineSegmentsIntersectionFraction(e,n,i,o);return!(a<0||(t[0]=e[0]+a*(n[0]-e[0]),t[1]=e[1]+a*(n[1]-e[1]),0))},r.getLineSegmentsIntersectionFraction=function(t,e,n,r){var i,o,a=e[0]-t[0],s=e[1]-t[1],u=r[0]-n[0],c=r[1]-n[1];return o=(u*(t[1]-n[1])-c*(t[0]-n[0]))/(-u*s+a*c),(i=(-s*(t[0]-n[0])+a*(t[1]-n[1]))/(-u*s+a*c))>=0&&i<=1&&o>=0&&o<=1?o:-1}},"KEt/":function(t,e,n){var r=n("gJmg"),i=n("CPZc"),o=n("zqkD");function a(){this.vertices=[]}t.exports=a,a.prototype.at=function(t){var e=this.vertices,n=e.length;return e[t<0?t%n+n:t%n]},a.prototype.first=function(){return this.vertices[0]},a.prototype.last=function(){return this.vertices[this.vertices.length-1]},a.prototype.clear=function(){this.vertices.length=0},a.prototype.append=function(t,e,n){if(void 0===e)throw new Error("From is not given!");if(void 0===n)throw new Error("To is not given!");if(n-1<e)throw new Error("lol1");if(n>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var r=e;r<n;r++)this.vertices.push(t.vertices[r])},a.prototype.makeCCW=function(){for(var t=0,e=this.vertices,n=1;n<this.vertices.length;++n)(e[n][1]<e[t][1]||e[n][1]==e[t][1]&&e[n][0]>e[t][0])&&(t=n);i.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},a.prototype.reverse=function(){for(var t=[],e=0,n=this.vertices.length;e!==n;e++)t.push(this.vertices.pop());this.vertices=t},a.prototype.isReflex=function(t){return i.right(this.at(t-1),this.at(t),this.at(t+1))};var s=[],u=[];function c(t,e,n,r,i){var a=e[1]-t[1],s=t[0]-e[0],u=a*t[0]+s*t[1],c=r[1]-n[1],l=n[0]-r[0],h=c*n[0]+l*n[1],f=a*l-c*s;return o.eq(f,0,i=i||0)?[0,0]:[(l*u-s*h)/f,(a*h-c*u)/f]}a.prototype.canSee=function(t,e){var n,o,a=s,c=u;if(i.leftOn(this.at(t+1),this.at(t),this.at(e))&&i.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=i.sqdist(this.at(t),this.at(e));for(var l=0;l!==this.vertices.length;++l)if((l+1)%this.vertices.length!==t&&l!==t&&i.leftOn(this.at(t),this.at(e),this.at(l+1))&&i.rightOn(this.at(t),this.at(e),this.at(l))&&(a[0]=this.at(t),a[1]=this.at(e),c[0]=this.at(l),c[1]=this.at(l+1),n=r.lineInt(a,c),i.sqdist(this.at(t),n)<o))return!1;return!0},a.prototype.copy=function(t,e,n){var r=n||new a;if(r.clear(),t<e)for(var i=t;i<=e;i++)r.vertices.push(this.vertices[i]);else{for(i=0;i<=e;i++)r.vertices.push(this.vertices[i]);for(i=t;i<this.vertices.length;i++)r.vertices.push(this.vertices[i])}return r},a.prototype.getCutEdges=function(){for(var t=[],e=[],n=[],r=new a,i=Number.MAX_VALUE,o=0;o<this.vertices.length;++o)if(this.isReflex(o))for(var s=0;s<this.vertices.length;++s)if(this.canSee(o,s)){e=this.copy(o,s,r).getCutEdges(),n=this.copy(s,o,r).getCutEdges();for(var u=0;u<n.length;u++)e.push(n[u]);e.length<i&&(i=e.length,(t=e).push([this.at(o),this.at(s)]))}return t},a.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},a.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],n=0;n<t.length;n++)for(var r=t[n],i=0;i<e.length;i++){var o=e[i].slice(r);if(o){e.splice(i,1),e.push(o[0],o[1]);break}}return e}return n=this.vertices.indexOf((r=t)[0]),i=this.vertices.indexOf(r[1]),-1!=n&&-1!=i&&[this.copy(n,i),this.copy(i,n)]},a.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var n=0;n<e-1;n++)if(r.segmentsIntersect(t[e],t[e+1],t[n],t[n+1]))return!1;for(e=1;e<t.length-2;e++)if(r.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},a.prototype.quickDecomp=function(t,e,n,r,o,s){o=o||100,s=s||0,r=r||25,t=void 0!==t?t:[],e=e||[],n=n||[];var u=[0,0],l=[0,0],h=[0,0],f=0,d=0,p=0,v=0,m=0,y=0,g=0,b=new a,_=new a,w=this.vertices;if(w.length<3)return t;if(++s>o)return console.warn("quickDecomp: max level ("+o+") reached."),t;for(var E=0;E<this.vertices.length;++E)if(this.isReflex(E)){e.push(this.vertices[E]),f=d=Number.MAX_VALUE;for(var x=0;x<this.vertices.length;++x)i.left(this.at(E-1),this.at(E),this.at(x))&&i.rightOn(this.at(E-1),this.at(E),this.at(x-1))&&(h=c(this.at(E-1),this.at(E),this.at(x),this.at(x-1)),i.right(this.at(E+1),this.at(E),h)&&(p=i.sqdist(this.vertices[E],h))<d&&(d=p,l=h,y=x)),i.left(this.at(E+1),this.at(E),this.at(x+1))&&i.rightOn(this.at(E+1),this.at(E),this.at(x))&&(h=c(this.at(E+1),this.at(E),this.at(x),this.at(x+1)),i.left(this.at(E-1),this.at(E),h)&&(p=i.sqdist(this.vertices[E],h))<f&&(f=p,u=h,m=x));if(y==(m+1)%this.vertices.length)h[0]=(l[0]+u[0])/2,h[1]=(l[1]+u[1])/2,n.push(h),E<m?(b.append(this,E,m+1),b.vertices.push(h),_.vertices.push(h),0!=y&&_.append(this,y,this.vertices.length),_.append(this,0,E+1)):(0!=E&&b.append(this,E,this.vertices.length),b.append(this,0,m+1),b.vertices.push(h),_.vertices.push(h),_.append(this,y,E+1));else{if(y>m&&(m+=this.vertices.length),v=Number.MAX_VALUE,m<y)return t;for(x=y;x<=m;++x)i.leftOn(this.at(E-1),this.at(E),this.at(x))&&i.rightOn(this.at(E+1),this.at(E),this.at(x))&&(p=i.sqdist(this.at(E),this.at(x)))<v&&(v=p,g=x%this.vertices.length);E<g?(b.append(this,E,g+1),0!=g&&_.append(this,g,w.length),_.append(this,0,E+1)):(0!=E&&b.append(this,E,w.length),b.append(this,0,g+1),_.append(this,g,E+1))}return b.vertices.length<_.vertices.length?(b.quickDecomp(t,e,n,r,o,s),_.quickDecomp(t,e,n,r,o,s)):(_.quickDecomp(t,e,n,r,o,s),b.quickDecomp(t,e,n,r,o,s)),t}return t.push(this),t},a.prototype.removeCollinearPoints=function(t){for(var e=0,n=this.vertices.length-1;this.vertices.length>3&&n>=0;--n)i.collinear(this.at(n-1),this.at(n),this.at(n+1),t)&&(this.vertices.splice(n%this.vertices.length,1),n--,e++);return e}},KXN6:function(t,e){var n={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,n=0,r=0;r<e;r+=2)n+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);return.5*-(n+=(t[0]-t[e])*(t[e+1]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var r=[],i=[],o=0;o<e;o++)i.push(o);o=0;for(var a=e;a>3;){var s=i[(o+0)%a],u=i[(o+1)%a],c=i[(o+2)%a],l=t[2*s],h=t[2*s+1],f=t[2*u],d=t[2*u+1],p=t[2*c],v=t[2*c+1],m=!1;if(n._convex(l,h,f,d,p,v)){m=!0;for(var y=0;y<a;y++){var g=i[y];if(g!=s&&g!=u&&g!=c&&n._PointInTriangle(t[2*g],t[2*g+1],l,h,f,d,p,v)){m=!1;break}}}if(m)r.push(s,u,c),i.splice((o+1)%a,1),a--,o=0;else if(o++>3*a)break}return r.push(i[0],i[1],i[2]),r},_PointInTriangle:function(t,e,n,r,i,o,a,s){var u=a-n,c=s-r,l=i-n,h=o-r,f=t-n,d=e-r,p=u*u+c*c,v=u*l+c*h,m=u*f+c*d,y=l*l+h*h,g=l*f+h*d,b=1/(p*y-v*v),_=(y*m-v*g)*b,w=(p*g-v*m)*b;return _>=0&&w>=0&&_+w<1},_convex:function(t,e,n,r,i,o){return(e-r)*(i-n)+(n-t)*(o-r)>=0}};t.exports=n},MKEH:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){(t=t||{}).type=r.PARTICLE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e,n){i.copy(t.lowerBound,e),i.copy(t.upperBound,e)}},"MVd/":function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){(t=t||{}).type=r.PLANE,r.call(this,t)}n("Wk7T"),t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,n){var r=n%(2*Math.PI),o=i.set,a=t.lowerBound,s=t.upperBound;o(a,-1e7,-1e7),o(s,1e7,1e7),0===r?s[1]=0:r===Math.PI/2?a[0]=0:r===Math.PI?a[1]=0:r===3*Math.PI/2&&(s[0]=0)},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var a=i.create(),s=(i.create(),i.create(),i.create()),u=i.create();o.prototype.raycast=function(t,e,n,r){var o=e.from,c=e.to,l=e.direction,h=a,f=s,d=u;i.set(f,0,1),i.rotate(f,f,r),i.sub(d,o,n);var p=i.dot(d,f);if(i.sub(d,c,n),!(p*i.dot(d,f)>0||i.squaredDistance(o,c)<p*p)){var v=i.dot(f,l);i.sub(h,o,n);var m=-i.dot(f,h)/v/e.length;e.reportIntersection(t,m,f,-1)}}},MgzW:function(t,e,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(t,e){for(var n,s,u=a(t),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var h=0;h<s.length;h++)o.call(n,s[h])&&(u[s[h]]=n[s[h]])}}return u}},Nehr:function(t,e,n){"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},OQdp:function(t,e,n){var r;!function(i){var o=i.Promise,a=o&&"resolve"in o&&"reject"in o&&"all"in o&&"race"in o&&function(){var t;return new o((function(e){t=e})),"function"==typeof t}();e?(e.Promise=a?o:k,e.Polyfill=k):void 0===(r=(function(){return a?o:k}).call(e,n,e,t))||(t.exports=r);var s="pending",u="sealed",c="fulfilled",l="rejected",h=function(){};function f(t){return"[object Array]"===Object.prototype.toString.call(t)}var d,p="undefined"!=typeof setImmediate?setImmediate:setTimeout,v=[];function m(){for(var t=0;t<v.length;t++)v[t][0](v[t][1]);v=[],d=!1}function y(t,e){v.push([t,e]),d||(d=!0,p(m,0))}function g(t){var e=t.owner,n=e.state_,r=e.data_,i=t[n],o=t.then;if("function"==typeof i){n=c;try{r=i(r)}catch(a){E(o,a)}}b(o,r)||(n===c&&_(o,r),n===l&&E(o,r))}function b(t,e){var n;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&("function"==typeof e||"object"==typeof e)){var r=e.then;if("function"==typeof r)return r.call(e,(function(r){n||(n=!0,e!==r?_(t,r):w(t,r))}),(function(e){n||(n=!0,E(t,e))})),!0}}catch(i){return n||E(t,i),!0}return!1}function _(t,e){t!==e&&b(t,e)||w(t,e)}function w(t,e){t.state_===s&&(t.state_=u,t.data_=e,y(T,t))}function E(t,e){t.state_===s&&(t.state_=u,t.data_=e,y(C,t))}function x(t){var e=t.then_;t.then_=void 0;for(var n=0;n<e.length;n++)g(e[n])}function T(t){t.state_=c,x(t)}function C(t){t.state_=l,x(t)}function k(t){if("function"!=typeof t)throw new TypeError("Promise constructor takes a function argument");if(this instanceof k==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(t,e){function n(t){E(e,t)}try{t((function(t){_(e,t)}),n)}catch(r){n(r)}}(t,this)}k.prototype={constructor:k,state_:s,then_:null,data_:void 0,then:function(t,e){var n={owner:this,then:new this.constructor(h),fulfilled:t,rejected:e};return this.state_===c||this.state_===l?y(g,n):this.then_.push(n),n.then},catch:function(t){return this.then(null,t)}},k.all=function(t){if(!f(t))throw new TypeError("You must pass an array to Promise.all().");return new this((function(e,n){var r=[],i=0;function o(t){return i++,function(n){r[t]=n,--i||e(r)}}for(var a,s=0;s<t.length;s++)(a=t[s])&&"function"==typeof a.then?a.then(o(s),n):r[s]=a;i||e(r)}))},k.race=function(t){if(!f(t))throw new TypeError("You must pass an array to Promise.race().");return new this((function(e,n){for(var r,i=0;i<t.length;i++)(r=t[i])&&"function"==typeof r.then?r.then(e,n):e(r)}))},k.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this((function(e){e(t)}))},k.reject=function(t){return new this((function(e,n){n(t)}))}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this)},Q2Wg:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}this.heights=(t=t||{}).heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=r.HEIGHTFIELD,r.call(this,t)}n("Wk7T"),t.exports=o,(o.prototype=new r).constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],n=t[0],r=0;r!==t.length;r++){var i=t[r];i>e&&(e=i),i<n&&(n=i)}this.maxValue=e,this.minValue=n},o.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,n=0;n<t.length-1;n++)e+=(t[n]+t[n+1])/2*this.elementWidth;this.area=e};var a=[i.create(),i.create(),i.create(),i.create()];o.prototype.computeAABB=function(t,e,n){i.set(a[0],0,this.maxValue),i.set(a[1],this.elementWidth*this.heights.length,this.maxValue),i.set(a[2],this.elementWidth*this.heights.length,this.minValue),i.set(a[3],0,this.minValue),t.setFromPoints(a,e,n)},o.prototype.getLineSegment=function(t,e,n){var r=this.heights,o=this.elementWidth;i.set(t,n*o,r[n]),i.set(e,(n+1)*o,r[n+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return Math.min(this.heights.length,Math.max(e,0))},i.create();var s=i.create(),u=i.create(),c=i.create(),l=i.create(),h=i.create();i.fromValues(0,1),o.prototype.raycast=function(t,e,n,r){var o=e.to,a=s,f=u,d=c,p=l,v=h;i.toLocalFrame(p,e.from,n,r),i.toLocalFrame(v,o,n,r);var m=this.getClampedSegmentIndex(p),y=this.getClampedSegmentIndex(v);if(m>y){var g=m;m=y,y=g}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(f,d,b);var _=i.getLineSegmentsIntersectionFraction(p,v,f,d);if(_>=0&&(i.sub(a,d,f),i.rotate(a,a,r+Math.PI/2),i.normalize(a,a),e.reportIntersection(t,_,a,-1),t.shouldStop(e)))return}}},RJ5M:function(t,e,n){var r=n("3Jud"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.reset(),this}},RZpa:function(t,e,n){var r=n("JtD1"),i=n("Dded"),o=n("sbLb"),a=n("Dp7I"),s=n("yBzR"),u=n("BcWo"),c=n("i+N5");function l(t){t=t||{},c.call(this),this.id=t.id||++l._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=r.create(),this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.interpolatedPosition=r.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=r.fromValues(0,0),this.previousAngle=0,this.velocity=r.fromValues(0,0),t.velocity&&r.copy(this.velocity,t.velocity),this.vlambda=r.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=r.create(),t.force&&r.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=l.STATIC,this.type=void 0!==t.type?t.type:t.mass?l.DYNAMIC:l.STATIC,this.boundingRadius=0,this.aabb=new u,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=l.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}t.exports=l,(l.prototype=new c).constructor=l,l._idCounter=0,l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},l.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},l.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},l.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var h=new u,f=r.create();l.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,n=f,i=this.angle,o=0;o!==e;o++){var a=t[o],s=a.angle+i;r.rotate(n,a.position,i),r.add(n,n,this.position),a.computeAABB(h,n,s),0===o?this.aabb.copy(h):this.aabb.extend(h)}this.aabbNeedsUpdate=!1},l.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,n=0,i=0;i!==e;i++){var o=t[i],a=r.length(o.position),s=o.boundingRadius;a+s>n&&(n=a+s)}this.boundingRadius=n},l.prototype.addShape=function(t,e,n){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?r.copy(t.position,e):r.set(t.position,0,0),t.angle=n||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},l.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},l.prototype.updateMassProperties=function(){if(this.type===l.STATIC||this.type===l.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,n=this.mass/e,i=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var o=0;o<e;o++){var a=t[o],s=r.squaredLength(a.position);i+=a.computeMomentOfInertia(n)+n*s}this.inertia=i,this.invInertia=i>0?1/i:0}this.invMass=1/this.mass,r.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},r.create(),l.prototype.applyForce=function(t,e){if(r.add(this.force,this.force,t),e){var n=r.crossLength(e,t);this.angularForce+=n}};var d=r.create(),p=r.create(),v=r.create();l.prototype.applyForceLocal=function(t,e){e=e||v;var n=d,r=p;this.vectorToWorldFrame(n,t),this.vectorToWorldFrame(r,e),this.applyForce(n,r)};var m=r.create();l.prototype.applyImpulse=function(t,e){if(this.type===l.DYNAMIC){var n=m;if(r.scale(n,t,this.invMass),r.multiply(n,this.massMultiplier,n),r.add(this.velocity,n,this.velocity),e){var i=r.crossLength(e,t);this.angularVelocity+=i*=this.invInertia}}};var y=r.create(),g=r.create(),b=r.create();l.prototype.applyImpulseLocal=function(t,e){e=e||b;var n=y,r=g;this.vectorToWorldFrame(n,t),this.vectorToWorldFrame(r,e),this.applyImpulse(n,r)},l.prototype.toLocalFrame=function(t,e){r.toLocalFrame(t,e,this.position,this.angle)},l.prototype.toWorldFrame=function(t,e){r.toGlobalFrame(t,e,this.position,this.angle)},l.prototype.vectorToLocalFrame=function(t,e){r.vectorToLocalFrame(t,e,this.angle)},l.prototype.vectorToWorldFrame=function(t,e){r.vectorToGlobalFrame(t,e,this.angle)},l.prototype.fromPolygon=function(t,e){e=e||{};for(var n=this.shapes.length;n>=0;--n)this.removeShape(this.shapes[n]);var a,s=new i.Polygon;if(s.vertices=t,s.makeCCW(),"number"==typeof e.removeCollinearPoints&&s.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!s.isSimple())return!1;for(this.concavePath=s.vertices.slice(0),n=0;n<this.concavePath.length;n++)r.copy(h=[0,0],this.concavePath[n]),this.concavePath[n]=h;a=e.optimalDecomp?s.decomp():s.quickDecomp();var u=r.create();for(n=0;n!==a.length;n++){for(var c=new o({vertices:a[n].vertices}),l=0;l!==c.vertices.length;l++){var h;r.sub(h=c.vertices[l],h,c.centerOfMass)}r.scale(u,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,u)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0},r.fromValues(0,0);var _=r.fromValues(0,0),w=r.fromValues(0,0),E=r.fromValues(0,0);l.prototype.adjustCenterOfMass=function(){var t=_,e=w,n=E,i=0;r.set(e,0,0);for(var o=0;o!==this.shapes.length;o++)r.scale(t,(a=this.shapes[o]).position,a.area),r.add(e,e,t),i+=a.area;for(r.scale(n,e,1/i),o=0;o!==this.shapes.length;o++){var a;r.sub((a=this.shapes[o]).position,a.position,n)}for(r.add(this.position,this.position,n),o=0;this.concavePath&&o<this.concavePath.length;o++)r.sub(this.concavePath[o],this.concavePath[o],n);this.updateMassProperties(),this.updateBoundingRadius()},l.prototype.setZeroForce=function(){r.set(this.force,0,0),this.angularForce=0},l.prototype.resetConstraintVelocity=function(){r.set(this.vlambda,0,0),this.wlambda=0},l.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},l.prototype.applyDamping=function(t){if(this.type===l.DYNAMIC){var e=this.velocity;r.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},l.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=l.AWAKE,this.idleTime=0,t!==l.AWAKE&&this.emit(l.wakeUpEvent)},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.angularVelocity=0,this.angularForce=0,r.set(this.velocity,0,0),r.set(this.force,0,0),this.emit(l.sleepEvent)},l.prototype.sleepTick=function(t,e,n){this.allowSleep&&this.type!==l.SLEEPING&&(this.wantsToSleep=!1,r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=l.AWAKE):(this.idleTime+=n,this.sleepState=l.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},l.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var x=r.create(),T=r.create();l.prototype.integrate=function(t){var e=this.invMass,n=this.force,i=this.position,o=this.velocity;r.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),r.scale(x,n,t*e),r.multiply(x,this.massMultiplier,x),r.add(o,x,o),this.integrateToTimeOfImpact(t)||(r.scale(T,o,t),r.add(i,i,T),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var C=new a,k=new s({mode:s.ALL}),S=r.create(),A=r.create(),I=r.create(),O=r.create();l.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||r.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;r.normalize(S,this.velocity),r.scale(A,this.velocity,t),r.add(A,A,this.position),r.sub(I,A,this.position);var e,n=this.angularVelocity*t,i=r.length(I),o=1,a=this;if(C.reset(),k.callback=function(t){t.body!==a&&(e=t.body,t.getHitPoint(A,k),r.sub(I,A,a.position),o=r.length(I)/i,t.stop())},r.copy(k.from,this.position),r.copy(k.to,A),k.update(),this.world.raycast(C,k),!e)return!1;var s=this.angle;r.copy(O,this.position);for(var u=0,c=0,l=0,h=o;h>=c&&u<this.ccdIterations;)u++,l=(h-c)/2,r.scale(T,I,o),r.add(this.position,O,T),this.angle=s+n*o,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?c=l:h=l;return o=l,r.copy(this.position,O),this.angle=s,r.scale(T,I,o),r.add(this.position,this.position,T),this.fixedRotation||(this.angle+=n*o),!0},l.prototype.getVelocityAtPoint=function(t,e){return r.crossVZ(t,e,this.angularVelocity),r.subtract(t,this.velocity,t),t},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.wakeUpEvent={type:"wakeup"},l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2},"S+S0":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("mrSG"),i=n("zVF4"),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),a=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.Deferred;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(o){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=r.__assign({identifier:"[DEFAULT]",optional:!1},t),n=e.optional,i=this.normalizeInstanceIdentifier(e.identifier);try{var o=this.getOrInitializeService(i);if(!o){if(n)return null;throw Error("Service "+this.name+" is not available")}return o}catch(a){if(n)return null;throw a}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService("[DEFAULT]")}catch(l){}try{for(var i=r.__values(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=r.__read(o.value,2),s=a[1],u=this.normalizeInstanceIdentifier(a[0]);try{var c=this.getOrInitializeService(u);s.resolve(c)}catch(l){}}}catch(h){e={error:h}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}(),s=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new a(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();e.Component=o,e.ComponentContainer=s,e.Provider=a},SLVX:function(t,e,n){"use strict";function r(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}n.d(e,"a",(function(){return r}))},SN9G:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),this.length=(t=t||{}).length||1,this.radius=t.radius||1,t.type=r.CAPSULE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){var e=this.radius,n=this.length+e,r=2*e;return t*(r*r+n*n)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var a=i.create();o.prototype.computeAABB=function(t,e,n){var r=this.radius;i.set(a,this.length/2,0),0!==n&&i.rotate(a,a,n),i.set(t.upperBound,Math.max(a[0]+r,-a[0]+r),Math.max(a[1]+r,-a[1]+r)),i.set(t.lowerBound,Math.min(a[0]-r,-a[0]-r),Math.min(a[1]-r,-a[1]-r)),i.add(t.lowerBound,t.lowerBound,e),i.add(t.upperBound,t.upperBound,e)};var s=i.create(),u=i.create(),c=i.create(),l=i.create(),h=i.fromValues(0,1);o.prototype.raycast=function(t,e,n,r){for(var o=e.from,a=e.to,f=s,d=u,p=c,v=l,m=this.length/2,y=0;y<2;y++){var g=this.radius*(2*y-1);if(i.set(p,-m,g),i.set(v,m,g),i.toGlobalFrame(p,p,n,r),i.toGlobalFrame(v,v,n,r),(_=i.getLineSegmentsIntersectionFraction(o,a,p,v))>=0&&(i.rotate(d,h,r),i.scale(d,d,2*y-1),e.reportIntersection(t,_,d,-1),t.shouldStop(e)))return}var b=Math.pow(this.radius,2)+Math.pow(m,2);for(y=0;y<2;y++){i.set(p,m*(2*y-1),0),i.toGlobalFrame(p,p,n,r);var _,w=Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2),E=2*((a[0]-o[0])*(o[0]-p[0])+(a[1]-o[1])*(o[1]-p[1])),x=Math.pow(o[0]-p[0],2)+Math.pow(o[1]-p[1],2)-Math.pow(this.radius,2);if(!((_=Math.pow(E,2)-4*w*x)<0))if(0===_){if(i.lerp(f,o,a,_),i.squaredDistance(f,n)>b&&(i.sub(d,f,p),i.normalize(d,d),e.reportIntersection(t,_,d,-1),t.shouldStop(e)))return}else{var T=Math.sqrt(_),C=1/(2*w),k=(-E-T)*C,S=(-E+T)*C;if(k>=0&&k<=1&&(i.lerp(f,o,a,k),i.squaredDistance(f,n)>b&&(i.sub(d,f,p),i.normalize(d,d),e.reportIntersection(t,k,d,-1),t.shouldStop(e))))return;if(S>=0&&S<=1&&(i.lerp(f,o,a,S),i.squaredDistance(f,n)>b&&(i.sub(d,f,p),i.normalize(d,d),e.reportIntersection(t,S,d,-1),t.shouldStop(e))))return}}}},SeMp:function(t,e){function n(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}t.exports=n,n.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},n.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},n.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},VmRL:function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,u,c,l,d,p,m=e&&e.length,y=m?e[0]*n:t.length,g=i(t,0,y,n,!0),b=[];if(!g||g.next===g.prev)return b;if(m&&(g=function(t,e,n,r){var a,s,u,c=[];for(a=0,s=e.length;a<s;a++)(u=i(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r,!1))===u.next&&(u.steiner=!0),c.push(v(u));for(c.sort(h),a=0;a<c.length;a++)f(c[a],n),n=o(n,n.next);return n}(t,e,g,n)),t.length>80*n){r=u=t[0],s=c=t[1];for(var _=n;_<y;_+=n)(l=t[_])<r&&(r=l),(d=t[_+1])<s&&(s=d),l>u&&(u=l),d>c&&(c=d);p=0!==(p=Math.max(u-r,c-s))?1/p:0}return a(g,b,n,r,s,p),b}function i(t,e,n,r,i){var o,a;if(i===A(t,e,n,r)>0)for(o=e;o<n;o+=r)a=C(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=C(o,t[o],t[o+1],a);return a&&b(a,a.next)&&(k(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!b(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(k(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,h,f){if(t){!f&&h&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=p(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,h);for(var d,v,m=t;t.prev!==t.next;)if(d=t.prev,v=t.next,h?u(t,r,i,h):s(t))e.push(d.i/n),e.push(t.i/n),e.push(v.i/n),k(t),t=v.next,m=v.next;else if((t=v)===m){f?1===f?a(t=c(o(t),e,n),e,n,r,i,h,2):2===f&&l(t,e,n,r,i,h):a(o(t),e,n,r,i,h,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(m(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=p(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),l=p(s,u,e,n,r),h=t.prevZ,f=t.nextZ;h&&h.z>=c&&f&&f.z<=l;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,f!==t.prev&&f!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;f&&f.z<=l;){if(f!==t.prev&&f!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!b(i,a)&&_(i,r,r.next,a)&&x(i,a)&&x(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),k(r),k(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function l(t,e,n,r,i,s){var u=t;do{for(var c=u.next.next;c!==u.prev;){if(u.i!==c.i&&y(u,c)){var l=T(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,e,n,r,i,s),void a(l,e,n,r,i,s)}c=c.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function f(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&m(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),x(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&d(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}(t,e)){var n=T(e,t);o(n,n.next)}}function d(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function p(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function m(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&_(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(x(t,e)&&x(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||b(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function b(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,n,r){var i=E(g(t,e,n)),o=E(g(t,e,r)),a=E(g(n,r,t)),s=E(g(n,r,e));return i!==o&&a!==s||!(0!==i||!w(t,n,e))||!(0!==o||!w(t,r,e))||!(0!==a||!w(n,t,r))||!(0!==s||!w(n,e,r))}function w(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function E(t){return t>0?1:t<0?-1:0}function x(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function T(t,e){var n=new S(t.i,t.x,t.y),r=new S(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function C(t,e,n,r){var i=new S(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function k(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(A(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(A(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var u=0;for(a=0;a<r.length;a+=3){var c=r[a]*n,l=r[a+1]*n,h=r[a+2]*n;u+=Math.abs((t[c]-t[h])*(t[l+1]-t[c+1])-(t[c]-t[l])*(t[h+1]-t[c+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n}},Wcq6:function(t,e,n){"use strict";var r,i=(r=n("wj3C"))&&"object"==typeof r&&"default"in r?r.default:r;i.registerVersion("firebase","7.6.1","app"),t.exports=i},Wk7T:function(t,e){function n(){}t.exports=n,n.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var n=0,r=e.length;n!==r;++n)t.push(e[n])},n.splice=function(t,e,n){for(var r=e,i=t.length-(n=n||1);r<i;r++)t[r]=t[r+n];t.length=i},n.ARRAY_TYPE="undefined"!=typeof P2_ARRAY_TYPE?P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?Float32Array:Array,n.extend=function(t,e){for(var n in e)t[n]=e[n]},n.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},XZ30:function(t,e,n){var r=n("AeTl"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},YcCt:function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,i){n=n||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(e=e||"&");var s=1e3;i&&"number"==typeof i.maxKeys&&(s=i.maxKeys);var u=t.length;s>0&&u>s&&(u=s);for(var c=0;c<u;++c){var l,h,f,d,p=t[c].replace(a,"%20"),v=p.indexOf(n);v>=0?(l=p.substr(0,v),h=p.substr(v+1)):(l=p,h=""),f=decodeURIComponent(l),d=decodeURIComponent(h),r(o,f)?Array.isArray(o[f])?o[f].push(d):o[f]=[o[f],d]:o[f]=d}return o}},YuTi:function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},bCCX:function(t,e,n){"use strict";(function(t){var r,i=n("SLVX");r="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:t;var o=Object(i.a)(r);e.a=o}).call(this,n("3UD+")(t))},bcDB:function(t,e,n){var r=n("0pMi"),i=(n("+1EK"),n("kR7G"));function o(t,e,n){r.call(this,t,e,r.GEAR,n=n||{}),this.ratio=void 0!==n.ratio?n.ratio:1,this.angle=void 0!==n.angle?n.angle:e.angle-this.ratio*t.angle,n.angle=this.angle,n.ratio=this.ratio,this.equations=[new i(t,e,n)],void 0!==n.maxTorque&&this.setMaxTorque(n.maxTorque)}n("JtD1"),t.exports=o,(o.prototype=new r).constructor=o,o.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},crnd:function(t,e){function n(t){return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}))}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="crnd"},dOQH:function(t,e,n){var r=n("0pMi"),i=n("JtD1"),o=n("+1EK");function a(t,e,n){r.call(this,t,e,r.LOCK,n=n||{});var a=void 0===n.maxForce?Number.MAX_VALUE:n.maxForce,s=new o(t,e,-a,a),u=new o(t,e,-a,a),c=new o(t,e,-a,a),l=i.create(),h=i.create(),f=this;s.computeGq=function(){return i.rotate(l,f.localOffsetB,t.angle),i.sub(h,e.position,t.position),i.sub(h,h,l),h[0]},u.computeGq=function(){return i.rotate(l,f.localOffsetB,t.angle),i.sub(h,e.position,t.position),i.sub(h,h,l),h[1]};var d=i.create(),p=i.create();c.computeGq=function(){return i.rotate(d,f.localOffsetB,e.angle-f.localAngleB),i.scale(d,d,-1),i.sub(h,t.position,e.position),i.add(h,h,d),i.rotate(p,d,-Math.PI/2),i.normalize(p,p),i.dot(h,p)},this.localOffsetB=i.create(),n.localOffsetB?i.copy(this.localOffsetB,n.localOffsetB):(i.sub(this.localOffsetB,e.position,t.position),i.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,this.localAngleB="number"==typeof n.localAngleB?n.localAngleB:e.angle-t.angle,this.equations.push(s,u,c),this.setMaxForce(a)}t.exports=a,(a.prototype=new r).constructor=a,a.prototype.setMaxForce=function(t){for(var e=this.equations,n=0;n<this.equations.length;n++)e[n].maxForce=t,e[n].minForce=-t},a.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=i.create(),u=i.create(),c=i.create(),l=i.fromValues(1,0),h=i.fromValues(0,1);a.prototype.update=function(){var t=this.equations[0],e=this.equations[1],n=this.equations[2],r=this.bodyB;i.rotate(s,this.localOffsetB,this.bodyA.angle),i.rotate(u,this.localOffsetB,r.angle-this.localAngleB),i.scale(u,u,-1),i.rotate(c,u,Math.PI/2),i.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-i.crossLength(s,l),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-i.crossLength(s,h),e.G[4]=1,n.G[0]=-c[0],n.G[1]=-c[1],n.G[3]=c[0],n.G[4]=c[1],n.G[5]=i.crossLength(u,c)}},fq9q:function(t,e,n){var r=n("+1EK"),i=n("JtD1");function o(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=i.create(),this.penetrationVec=i.create(),this.contactPointB=i.create(),this.normalA=i.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeB=function(t,e,n){var r,o,a=this.contactPointA,s=this.contactPointB,u=this.bodyA.position,c=this.bodyB.position,l=this.penetrationVec,h=this.normalA,f=this.G,d=i.crossLength(a,h),p=i.crossLength(s,h);return f[0]=-h[0],f[1]=-h[1],f[2]=-d,f[3]=h[0],f[4]=h[1],f[5]=p,i.add(l,c,s),i.sub(l,l,u),i.sub(l,l,a),this.firstImpact&&0!==this.restitution?(o=0,r=1/e*(1+this.restitution)*this.computeGW()):(o=i.dot(h,l)+this.offset,r=this.computeGW()),-o*t-r*e-n*this.computeGiMf()};var a=i.create(),s=i.create(),u=i.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(a,this.contactPointA),this.bodyB.getVelocityAtPoint(s,this.contactPointB),i.subtract(u,a,s),i.dot(this.normalA,u)}},gB0W:function(t,e,n){var r=n("rCTz"),i=n("JtD1");function o(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),this.length=(t=t||{}).length||1,t.type=r.LINE,r.call(this,t)}t.exports=o,(o.prototype=new r).constructor=o,o.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[i.create(),i.create()];o.prototype.computeAABB=function(t,e,n){var r=this.length/2;i.set(a[0],-r,0),i.set(a[1],r,0),t.setFromPoints(a,e,n,0)},i.create();var s=i.create(),u=i.create(),c=i.create(),l=i.fromValues(0,1);o.prototype.raycast=function(t,e,n,r){var o=e.from,a=e.to,h=u,f=c,d=this.length/2;i.set(h,-d,0),i.set(f,d,0),i.toGlobalFrame(h,h,n,r),i.toGlobalFrame(f,f,n,r);var p=i.getLineSegmentsIntersectionFraction(h,f,o,a);if(p>=0){var v=s;i.rotate(v,l,r),e.reportIntersection(t,p,v,-1)}}},"gC/R":function(t,e,n){n("JtD1");var r=n("6Pil");function i(t,e,n){r.call(this,t,e,n=n||{}),this.restAngle="number"==typeof n.restAngle?n.restAngle:e.angle-t.angle}t.exports=i,(i.prototype=new r).constructor=i,i.prototype.applyForce=function(){var t=this.bodyA,e=this.bodyB,n=-this.stiffness*(e.angle-t.angle-this.restAngle)-this.damping*(e.angularVelocity-t.angularVelocity)*0;t.angularForce-=n,e.angularForce+=n}},gJmg:function(t,e,n){var r=n("zqkD");function i(){}t.exports=i,i.lineInt=function(t,e,n){var i,o,a,s,u,c,l,h=[0,0];return a=(i=t[1][1]-t[0][1])*t[0][0]+(o=t[0][0]-t[1][0])*t[0][1],c=(s=e[1][1]-e[0][1])*e[0][0]+(u=e[0][0]-e[1][0])*e[0][1],r.eq(l=i*u-s*o,0,n=n||0)||(h[0]=(u*a-o*c)/l,h[1]=(i*c-s*a)/l),h},i.segmentsIntersect=function(t,e,n,r){var i=e[0]-t[0],o=e[1]-t[1],a=r[0]-n[0],s=r[1]-n[1];if(a*o-s*i==0)return!1;var u=(i*(n[1]-t[1])+o*(t[0]-n[0]))/(a*o-s*i),c=(a*(t[1]-n[1])+s*(n[0]-t[0]))/(s*i-a*o);return u>=0&&u<=1&&c>=0&&c<=1}},gRQh:function(t,e,n){var r,i,o;!function(n){var a=/iPhone/i,s=/iPod/i,u=/iPad/i,c=/\bAndroid(?:.+)Mobile\b/i,l=/Android/i,h=/\bAndroid(?:.+)SD4930UR\b/i,f=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,d=/Windows Phone/i,p=/\bWindows(?:.+)ARM\b/i,v=/BlackBerry/i,m=/BB10/i,y=/Opera Mini/i,g=/\b(CriOS|Chrome)(?:.+)Mobile/i,b=/Mobile(?:.+)Firefox\b/i;function _(t,e){return t.test(e)}function w(t){var e=t||("undefined"!=typeof navigator?navigator.userAgent:""),n=e.split("[FBAN");void 0!==n[1]&&(e=n[0]),void 0!==(n=e.split("Twitter"))[1]&&(e=n[0]);var r={apple:{phone:_(a,e)&&!_(d,e),ipod:_(s,e),tablet:!_(a,e)&&_(u,e)&&!_(d,e),device:(_(a,e)||_(s,e)||_(u,e))&&!_(d,e)},amazon:{phone:_(h,e),tablet:!_(h,e)&&_(f,e),device:_(h,e)||_(f,e)},android:{phone:!_(d,e)&&_(h,e)||!_(d,e)&&_(c,e),tablet:!_(d,e)&&!_(h,e)&&!_(c,e)&&(_(f,e)||_(l,e)),device:!_(d,e)&&(_(h,e)||_(f,e)||_(c,e)||_(l,e))||_(/\bokhttp\b/i,e)},windows:{phone:_(d,e),tablet:_(p,e),device:_(d,e)||_(p,e)},other:{blackberry:_(v,e),blackberry10:_(m,e),opera:_(y,e),firefox:_(b,e),chrome:_(g,e),device:_(v,e)||_(m,e)||_(y,e)||_(b,e)||_(g,e)}};return r.any=r.apple.device||r.android.device||r.windows.device||r.other.device,r.phone=r.apple.phone||r.android.phone||r.windows.phone,r.tablet=r.apple.tablet||r.android.tablet||r.windows.tablet,r}t.exports&&"undefined"==typeof window?t.exports=w:t.exports&&"undefined"!=typeof window?(t.exports=w(),t.exports.isMobile=w):(i=[],r=n.isMobile=w(),void 0===(o="function"==typeof r?r.apply(e,i):r)||(t.exports=o))}(this)},goqo:function(t,e,n){var r=n("0pMi"),i=n("+1EK"),o=n("B9yW"),a=n("0DzJ"),s=n("JtD1");t.exports=d;var u=s.create(),c=s.create(),l=s.fromValues(1,0),h=s.fromValues(0,1),f=s.create();function d(t,e,n){r.call(this,t,e,r.REVOLUTE,n=n||{});var d=this.maxForce=void 0!==n.maxForce?n.maxForce:Number.MAX_VALUE;this.pivotA=s.create(),this.pivotB=s.create(),n.worldPivot?(s.sub(this.pivotA,n.worldPivot,t.position),s.sub(this.pivotB,n.worldPivot,e.position),s.rotate(this.pivotA,this.pivotA,-t.angle),s.rotate(this.pivotB,this.pivotB,-e.angle)):(s.copy(this.pivotA,n.localPivotA),s.copy(this.pivotB,n.localPivotB));var p=this.equations=[new i(t,e,-d,d),new i(t,e,-d,d)],v=p[0],m=p[1],y=this;v.computeGq=function(){return s.rotate(u,y.pivotA,t.angle),s.rotate(c,y.pivotB,e.angle),s.add(f,e.position,c),s.sub(f,f,t.position),s.sub(f,f,u),s.dot(f,l)},m.computeGq=function(){return s.rotate(u,y.pivotA,t.angle),s.rotate(c,y.pivotB,e.angle),s.add(f,e.position,c),s.sub(f,f,t.position),s.sub(f,f,u),s.dot(f,h)},m.minForce=v.minForce=-d,m.maxForce=v.maxForce=d,this.motorEquation=new o(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}(d.prototype=new r).constructor=d,d.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},d.prototype.update=function(){var t,e=this.bodyA,n=this.bodyB,r=this.pivotA,i=this.pivotB,o=this.equations,a=o[0],f=o[1],d=this.upperLimit,p=this.lowerLimit,v=this.upperLimitEquation,m=this.lowerLimitEquation,y=this.angle=n.angle-e.angle;this.upperLimitEnabled&&y>d?(v.angle=d,-1===o.indexOf(v)&&o.push(v)):-1!==(t=o.indexOf(v))&&o.splice(t,1),this.lowerLimitEnabled&&y<p?(m.angle=p,-1===o.indexOf(m)&&o.push(m)):-1!==(t=o.indexOf(m))&&o.splice(t,1),s.rotate(u,r,e.angle),s.rotate(c,i,n.angle),a.G[0]=-1,a.G[1]=0,a.G[2]=-s.crossLength(u,l),a.G[3]=1,a.G[4]=0,a.G[5]=s.crossLength(c,l),f.G[0]=0,f.G[1]=-1,f.G[2]=-s.crossLength(u,h),f.G[3]=0,f.G[4]=1,f.G[5]=s.crossLength(c,h)},d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},d.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},d.prototype.motorIsEnabled=function(){return!!this.motorEnabled},d.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},d.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},"i+N5":function(t,e){var n=function(){};t.exports=n,n.prototype={constructor:n,on:function(t,e,n){e.context=n||this,void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;if(e){if(void 0!==n[t]&&-1!==n[t].indexOf(e))return!0}else if(void 0!==n[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners,r=n[t].indexOf(e);return-1!==r&&n[t].splice(r,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=0,r=e.length;n<r;n++){var i=e[n];i.call(i.context,t)}}return this}}},iFPw:function(t,e,n){var r=n("JtD1"),i=r.sub,o=r.add,a=r.dot,s=(n("Wk7T"),n("2Vfd")),u=n("iZbu"),c=n("vMUY"),l=n("+1EK"),h=(n("fq9q"),n("yqpj"),n("1vck")),f=n("sbLb"),d=n("rCTz"),p=(n("RZpa"),n("I+AN"));t.exports=M;var v=r.fromValues(0,1),m=r.fromValues(0,0),y=r.fromValues(0,0),g=r.fromValues(0,0),b=r.fromValues(0,0),_=r.fromValues(0,0),w=r.fromValues(0,0),E=r.fromValues(0,0),x=r.fromValues(0,0),T=r.fromValues(0,0),C=r.fromValues(0,0),k=r.fromValues(0,0),S=r.fromValues(0,0),A=r.fromValues(0,0),I=r.fromValues(0,0),O=r.fromValues(0,0),P=r.fromValues(0,0),D=r.fromValues(0,0),N=r.fromValues(0,0),R=[];function M(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new s({size:32}),this.frictionEquationPool=new u({size:64}),this.restitution=0,this.stiffness=l.DEFAULT_STIFFNESS,this.relaxation=l.DEFAULT_RELAXATION,this.frictionStiffness=l.DEFAULT_STIFFNESS,this.frictionRelaxation=l.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new c,this.contactSkinSize=.01}var L=r.create(),B=r.create();function F(t,e){r.set(t.vertices[0],.5*-e.length,-e.radius),r.set(t.vertices[1],.5*e.length,-e.radius),r.set(t.vertices[2],.5*e.length,e.radius),r.set(t.vertices[3],.5*-e.length,e.radius)}M.prototype.bodiesOverlap=function(t,e){for(var n=L,r=B,i=0,o=t.shapes.length;i!==o;i++){var a=t.shapes[i];t.toWorldFrame(n,a.position);for(var s=0,u=e.shapes.length;s!==u;s++){var c=e.shapes[s];if(e.toWorldFrame(r,c.position),this[a.type|c.type](t,a,n,a.angle+t.angle,e,c,r,c.angle+e.angle,!0))return!0}}return!1},M.prototype.collidedLastStep=function(t,e){return!!this.collidingBodiesLastStep.get(0|t.id,0|e.id)},M.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var n=t[e];this.collidingBodiesLastStep.set(n.bodyA.id,n.bodyB.id,!0)}for(var r=this.contactEquations,i=this.frictionEquations,o=0;o<r.length;o++)this.contactEquationPool.release(r[o]);for(o=0;o<i.length;o++)this.frictionEquationPool.release(i[o]);this.contactEquations.length=this.frictionEquations.length=0},M.prototype.createContactEquation=function(t,e,n,r){var i=this.contactEquationPool.get();return i.bodyA=t,i.bodyB=e,i.shapeA=n,i.shapeB=r,i.restitution=this.restitution,i.firstImpact=!this.collidedLastStep(t,e),i.stiffness=this.stiffness,i.relaxation=this.relaxation,i.needsUpdate=!0,i.enabled=this.enabledEquations,i.offset=this.contactSkinSize,i},M.prototype.createFrictionEquation=function(t,e,n,r){var i=this.frictionEquationPool.get();return i.bodyA=t,i.bodyB=e,i.shapeA=n,i.shapeB=r,i.setSlipForce(this.slipForce),i.frictionCoefficient=this.frictionCoefficient,i.relativeVelocity=this.surfaceVelocity,i.enabled=this.enabledEquations,i.needsUpdate=!0,i.stiffness=this.frictionStiffness,i.relaxation=this.frictionRelaxation,i.contactEquations.length=0,i},M.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return r.copy(e.contactPointA,t.contactPointA),r.copy(e.contactPointB,t.contactPointB),r.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},M.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],n=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;r.set(n.contactPointA,0,0),r.set(n.contactPointB,0,0),r.set(n.t,0,0);for(var o=0;o!==t;o++)(e=this.contactEquations[this.contactEquations.length-1-o]).bodyA===i?(r.add(n.t,n.t,e.normalA),r.add(n.contactPointA,n.contactPointA,e.contactPointA),r.add(n.contactPointB,n.contactPointB,e.contactPointB)):(r.sub(n.t,n.t,e.normalA),r.add(n.contactPointA,n.contactPointA,e.contactPointB),r.add(n.contactPointB,n.contactPointB,e.contactPointA)),n.contactEquations.push(e);var a=1/t;return r.scale(n.contactPointA,n.contactPointA,a),r.scale(n.contactPointB,n.contactPointB,a),r.normalize(n.t,n.t),r.rotate90cw(n.t,n.t),n},M.prototype[d.LINE|d.CONVEX]=M.prototype.convexLine=function(t,e,n,r,i,o,a,s,u){return!u&&0},M.prototype[d.LINE|d.BOX]=M.prototype.lineBox=function(t,e,n,r,i,o,a,s,u){return!u&&0};var U=new p({width:1,height:1}),V=r.create();M.prototype[d.CAPSULE|d.CONVEX]=M.prototype[d.CAPSULE|d.BOX]=M.prototype.convexCapsule=function(t,e,n,i,o,a,s,u,c){var l=V;r.set(l,a.length/2,0),r.rotate(l,l,u),r.add(l,l,s);var h=this.circleConvex(o,a,l,u,t,e,n,i,c,a.radius);r.set(l,-a.length/2,0),r.rotate(l,l,u),r.add(l,l,s);var f=this.circleConvex(o,a,l,u,t,e,n,i,c,a.radius);if(c&&(h||f))return!0;var d=U;return F(d,a),this.convexConvex(t,e,n,i,o,d,s,u,c)+h+f},M.prototype[d.CAPSULE|d.LINE]=M.prototype.lineCapsule=function(t,e,n,r,i,o,a,s,u){return!u&&0};var j=r.create(),q=r.create(),G=new p({width:1,height:1});M.prototype[d.CAPSULE|d.CAPSULE]=M.prototype.capsuleCapsule=function(t,e,n,i,o,a,s,u,c){for(var l=j,h=q,f=0,d=0;d<2;d++){r.set(l,(0===d?-1:1)*e.length/2,0),r.rotate(l,l,i),r.add(l,l,n);for(var p=0;p<2;p++){r.set(h,(0===p?-1:1)*a.length/2,0),r.rotate(h,h,u),r.add(h,h,s),this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var v=this.circleCircle(t,e,l,i,o,a,h,u,c,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=g),c&&v)return!0;f+=v}}this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var m=G;F(m,e);var y=this.convexCapsule(t,m,n,i,o,a,s,u,c);if(this.enableFrictionReduction&&(this.enableFriction=g),c&&y)return!0;if(f+=y,this.enableFrictionReduction){var g=this.enableFriction;this.enableFriction=!1}F(m,a);var b=this.convexCapsule(o,m,s,u,t,e,n,i,c);return this.enableFrictionReduction&&(this.enableFriction=g),!(!c||!b)||(f+=b,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},M.prototype[d.LINE|d.LINE]=M.prototype.lineLine=function(t,e,n,r,i,o,a,s,u){return!u&&0},M.prototype[d.PLANE|d.LINE]=M.prototype.planeLine=function(t,e,n,s,u,c,l,h,f){var d=m,p=y,C=g,k=b,S=_,A=w,I=E,O=x,P=T,D=R,N=0;r.set(d,-c.length/2,0),r.set(p,c.length/2,0),r.rotate(C,d,h),r.rotate(k,p,h),o(C,C,l),o(k,k,l),r.copy(d,C),r.copy(p,k),i(S,p,d),r.normalize(A,S),r.rotate90cw(P,A),r.rotate(O,v,s),D[0]=d,D[1]=p;for(var M=0;M<D.length;M++){var L=D[M];i(I,L,n);var B=a(I,O);if(B<0){if(f)return!0;var F=this.createContactEquation(t,u,e,c);N++,r.copy(F.normalA,O),r.normalize(F.normalA,F.normalA),r.scale(I,O,B),i(F.contactPointA,L,I),i(F.contactPointA,F.contactPointA,t.position),i(F.contactPointB,L,l),o(F.contactPointB,F.contactPointB,l),i(F.contactPointB,F.contactPointB,u.position),this.contactEquations.push(F),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(F))}}return!f&&(this.enableFrictionReduction||N&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(N)),N)},M.prototype[d.PARTICLE|d.CAPSULE]=M.prototype.particleCapsule=function(t,e,n,r,i,o,a,s,u){return this.circleLine(t,e,n,r,i,o,a,s,u,o.radius,0)},M.prototype[d.CIRCLE|d.LINE]=M.prototype.circleLine=function(t,e,n,s,u,c,l,h,f,d,p){d=d||0,p=void 0!==p?p:e.radius;var v=m,O=y,P=g,D=b,N=_,M=w,L=E,B=x,F=T,U=C,V=k,j=S,q=A,G=I,z=R;r.set(B,-c.length/2,0),r.set(F,c.length/2,0),r.rotate(U,B,h),r.rotate(V,F,h),o(U,U,l),o(V,V,l),r.copy(B,U),r.copy(F,V),i(M,F,B),r.normalize(L,M),r.rotate90cw(N,L),i(j,n,B);var H=a(j,N);i(D,B,l),i(q,n,l);var W=p+d;if(Math.abs(H)<W){r.scale(v,N,H),i(P,n,v),r.scale(O,N,a(N,q)),r.normalize(O,O),r.scale(O,O,d),o(P,P,O);var K=a(L,P),X=a(L,B),Y=a(L,F);if(K>X&&K<Y){if(f)return!0;var Q=this.createContactEquation(t,u,e,c);return r.scale(Q.normalA,v,-1),r.normalize(Q.normalA,Q.normalA),r.scale(Q.contactPointA,Q.normalA,p),o(Q.contactPointA,Q.contactPointA,n),i(Q.contactPointA,Q.contactPointA,t.position),i(Q.contactPointB,P,l),o(Q.contactPointB,Q.contactPointB,l),i(Q.contactPointB,Q.contactPointB,u.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1}}z[0]=B,z[1]=F;for(var J=0;J<z.length;J++){var Z=z[J];if(i(j,Z,n),r.squaredLength(j)<Math.pow(W,2))return!!f||(Q=this.createContactEquation(t,u,e,c),r.copy(Q.normalA,j),r.normalize(Q.normalA,Q.normalA),r.scale(Q.contactPointA,Q.normalA,p),o(Q.contactPointA,Q.contactPointA,n),i(Q.contactPointA,Q.contactPointA,t.position),i(Q.contactPointB,Z,l),r.scale(G,Q.normalA,-d),o(Q.contactPointB,Q.contactPointB,G),o(Q.contactPointB,Q.contactPointB,l),i(Q.contactPointB,Q.contactPointB,u.position),this.contactEquations.push(Q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Q)),1)}return 0},M.prototype[d.CIRCLE|d.CAPSULE]=M.prototype.circleCapsule=function(t,e,n,r,i,o,a,s,u){return this.circleLine(t,e,n,r,i,o,a,s,u,o.radius)},M.prototype[d.CIRCLE|d.CONVEX]=M.prototype[d.CIRCLE|d.BOX]=M.prototype.circleConvex=function(t,e,n,a,s,u,c,l,h,f){f="number"==typeof f?f:e.radius;for(var d=m,p=y,v=g,w=b,E=_,x=C,T=k,S=A,D=I,N=O,R=P,M=!1,L=Number.MAX_VALUE,B=u.vertices,F=0;F!==B.length+1;F++){var U=B[(F+1)%B.length];if(r.rotate(d,B[F%B.length],l),r.rotate(p,U,l),o(d,d,c),o(p,p,c),i(v,p,d),r.normalize(w,v),r.rotate90cw(E,w),r.scale(D,E,-e.radius),o(D,D,n),X(D,u,c,l)){r.sub(N,d,D);var V=Math.abs(r.dot(N,E));V<L&&(r.copy(R,D),L=V,r.scale(S,E,V),r.add(S,S,D),M=!0)}}if(M){if(h)return!0;var j=this.createContactEquation(t,s,e,u);return r.sub(j.normalA,R,n),r.normalize(j.normalA,j.normalA),r.scale(j.contactPointA,j.normalA,f),o(j.contactPointA,j.contactPointA,n),i(j.contactPointA,j.contactPointA,t.position),i(j.contactPointB,S,c),o(j.contactPointB,j.contactPointB,c),i(j.contactPointB,j.contactPointB,s.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}if(f>0)for(F=0;F<B.length;F++)if(r.rotate(T,B[F],l),o(T,T,c),i(x,T,n),r.squaredLength(x)<Math.pow(f,2))return!!h||(j=this.createContactEquation(t,s,e,u),r.copy(j.normalA,x),r.normalize(j.normalA,j.normalA),r.scale(j.contactPointA,j.normalA,f),o(j.contactPointA,j.contactPointA,n),i(j.contactPointA,j.contactPointA,t.position),i(j.contactPointB,T,c),o(j.contactPointB,j.contactPointB,c),i(j.contactPointB,j.contactPointB,s.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1);return 0};var z=r.create(),H=r.create(),W=r.create(),K=r.create();function X(t,e,n,a){for(var s=z,u=H,c=W,l=K,h=t,f=e.vertices,d=null,p=0;p!==f.length+1;p++){var v=f[(p+1)%f.length];r.rotate(s,f[p%f.length],a),r.rotate(u,v,a),o(s,s,n),o(u,u,n),i(c,s,h),i(l,u,h);var m=r.crossLength(c,l);if(null===d&&(d=m),m*d<=0)return!1;d=m}return!0}M.prototype[d.PARTICLE|d.CONVEX]=M.prototype[d.PARTICLE|d.BOX]=M.prototype.particleConvex=function(t,e,n,s,u,c,l,h,f){var d=m,p=y,v=g,x=b,T=_,k=w,S=E,I=C,O=A,P=D,R=N,M=Number.MAX_VALUE,L=!1,B=c.vertices;if(!X(n,c,l,h))return 0;if(f)return!0;for(var F=0;F!==B.length+1;F++){var U=B[(F+1)%B.length];r.rotate(d,B[F%B.length],h),r.rotate(p,U,h),o(d,d,l),o(p,p,l),i(v,p,d),r.normalize(x,v),r.rotate90cw(T,x),i(I,n,d),a(I,T),i(k,d,l),i(S,n,l),r.sub(P,d,n);var V=Math.abs(r.dot(P,T));V<M&&(M=V,r.scale(O,T,V),r.add(O,O,n),r.copy(R,T),L=!0)}if(L){var j=this.createContactEquation(t,u,e,c);return r.scale(j.normalA,R,-1),r.normalize(j.normalA,j.normalA),r.set(j.contactPointA,0,0),o(j.contactPointA,j.contactPointA,n),i(j.contactPointA,j.contactPointA,t.position),i(j.contactPointB,O,l),o(j.contactPointB,j.contactPointB,l),i(j.contactPointB,j.contactPointB,u.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}return 0},M.prototype[d.CIRCLE]=M.prototype.circleCircle=function(t,e,n,a,s,u,c,l,h,f,d){var p=m;f=f||e.radius,d=d||u.radius,i(p,n,c);var v=f+d;if(r.squaredLength(p)>Math.pow(v,2))return 0;if(h)return!0;var y=this.createContactEquation(t,s,e,u);return i(y.normalA,c,n),r.normalize(y.normalA,y.normalA),r.scale(y.contactPointA,y.normalA,f),r.scale(y.contactPointB,y.normalA,-d),o(y.contactPointA,y.contactPointA,n),i(y.contactPointA,y.contactPointA,t.position),o(y.contactPointB,y.contactPointB,c),i(y.contactPointB,y.contactPointB,s.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},M.prototype[d.PLANE|d.CONVEX]=M.prototype[d.PLANE|d.BOX]=M.prototype.planeConvex=function(t,e,n,s,u,c,l,h,f){var d=m,p=y,b=g,_=0;r.rotate(p,v,s);for(var w=0;w!==c.vertices.length;w++)if(r.rotate(d,c.vertices[w],h),o(d,d,l),i(b,d,n),a(b,p)<=0){if(f)return!0;_++;var E=this.createContactEquation(t,u,e,c);i(b,d,n),r.copy(E.normalA,p);var x=a(b,E.normalA);r.scale(b,E.normalA,x),i(E.contactPointB,d,u.position),i(E.contactPointA,d,b),i(E.contactPointA,E.contactPointA,t.position),this.contactEquations.push(E),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(E))}return this.enableFrictionReduction&&this.enableFriction&&_&&this.frictionEquations.push(this.createFrictionFromAverage(_)),_},M.prototype[d.PARTICLE|d.PLANE]=M.prototype.particlePlane=function(t,e,n,o,s,u,c,l,h){var f=m,d=y;l=l||0,i(f,n,c),r.rotate(d,v,l);var p=a(f,d);if(p>0)return 0;if(h)return!0;var g=this.createContactEquation(s,t,u,e);return r.copy(g.normalA,d),r.scale(f,g.normalA,p),i(g.contactPointA,n,f),i(g.contactPointA,g.contactPointA,s.position),i(g.contactPointB,n,t.position),this.contactEquations.push(g),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(g)),1},M.prototype[d.CIRCLE|d.PARTICLE]=M.prototype.circleParticle=function(t,e,n,a,s,u,c,l,h){var f=m;if(i(f,c,n),r.squaredLength(f)>Math.pow(e.radius,2))return 0;if(h)return!0;var d=this.createContactEquation(t,s,e,u);return r.copy(d.normalA,f),r.normalize(d.normalA,d.normalA),r.scale(d.contactPointA,d.normalA,e.radius),o(d.contactPointA,d.contactPointA,n),i(d.contactPointA,d.contactPointA,t.position),i(d.contactPointB,c,s.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var Y=new h({radius:1}),Q=r.create(),J=r.create();r.create(),M.prototype[d.PLANE|d.CAPSULE]=M.prototype.planeCapsule=function(t,e,n,i,a,s,u,c,l){var h,f=Q,d=J,p=Y;r.set(f,-s.length/2,0),r.rotate(f,f,c),o(f,f,u),r.set(d,s.length/2,0),r.rotate(d,d,c),o(d,d,u),p.radius=s.radius,this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(a,p,f,0,t,e,n,i,l),m=this.circlePlane(a,p,d,0,t,e,n,i,l);if(this.enableFrictionReduction&&(this.enableFriction=h),l)return v||m;var y=v+m;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},M.prototype[d.CIRCLE|d.PLANE]=M.prototype.circlePlane=function(t,e,n,s,u,c,l,h,f){var d=t,p=e,b=n,_=u,w=l,E=h;E=E||0;var x=m,T=y,C=g;i(x,b,w),r.rotate(T,v,E);var k=a(T,x);if(k>p.radius)return 0;if(f)return!0;var S=this.createContactEquation(_,d,c,e);return r.copy(S.normalA,T),r.scale(S.contactPointB,S.normalA,-p.radius),o(S.contactPointB,S.contactPointB,b),i(S.contactPointB,S.contactPointB,d.position),r.scale(C,S.normalA,k),i(S.contactPointA,x,C),o(S.contactPointA,S.contactPointA,w),i(S.contactPointA,S.contactPointA,_.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1},M.prototype[d.CONVEX]=M.prototype[d.CONVEX|d.BOX]=M.prototype[d.BOX]=M.prototype.convexConvex=function(t,e,n,s,u,c,l,h,f,d){var p=m,v=y,w=g,C=b,k=_,S=E,A=x,I=T,O=0;if(d="number"==typeof d?d:0,!M.findSeparatingAxis(e,n,s,c,l,h,p))return 0;i(A,l,n),a(p,A)>0&&r.scale(p,p,-1);var P=M.getClosestEdge(e,s,p,!0),D=M.getClosestEdge(c,h,p);if(-1===P||-1===D)return 0;for(var N=0;N<2;N++){var R,L=P,B=D,F=e,U=c,V=n,j=l,q=s,G=h,z=t,H=u;0===N&&(R=L,L=B,B=R,R=F,F=U,U=R,R=V,V=j,j=R,R=q,q=G,G=R,R=z,z=H,H=R);for(var W=B;W<B+2;W++){r.rotate(v,U.vertices[(W+U.vertices.length)%U.vertices.length],G),o(v,v,j);for(var K=0,X=L-1;X<L+2;X++){var Y=F.vertices[(X+1+F.vertices.length)%F.vertices.length];r.rotate(w,F.vertices[(X+F.vertices.length)%F.vertices.length],q),r.rotate(C,Y,q),o(w,w,V),o(C,C,V),i(k,C,w),r.rotate90cw(I,k),r.normalize(I,I),i(A,v,w);var Q=a(I,A);(X===L&&Q<=d||X!==L&&Q<=0)&&K++}if(K>=3){if(f)return!0;var J=this.createContactEquation(z,H,F,U);O++,Y=F.vertices[(L+1)%F.vertices.length],r.rotate(w,F.vertices[L%F.vertices.length],q),r.rotate(C,Y,q),o(w,w,V),o(C,C,V),i(k,C,w),r.rotate90cw(J.normalA,k),r.normalize(J.normalA,J.normalA),i(A,v,w),Q=a(J.normalA,A),r.scale(S,J.normalA,Q),i(J.contactPointA,v,V),i(J.contactPointA,J.contactPointA,S),o(J.contactPointA,J.contactPointA,V),i(J.contactPointA,J.contactPointA,z.position),i(J.contactPointB,v,j),o(J.contactPointB,J.contactPointB,j),i(J.contactPointB,J.contactPointB,H.position),this.contactEquations.push(J),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J))}}}return this.enableFrictionReduction&&this.enableFriction&&O&&this.frictionEquations.push(this.createFrictionFromAverage(O)),O};var Z=r.fromValues(0,0);M.projectConvexOntoAxis=function(t,e,n,i,o){var s,u=null,c=null,l=Z;r.rotate(l,i,-n);for(var h=0;h<t.vertices.length;h++)s=a(t.vertices[h],l),(null===u||s>u)&&(u=s),(null===c||s<c)&&(c=s);if(c>u){var f=c;c=u,u=f}var d=a(e,i);r.set(o,c+d,u+d)};var $=r.fromValues(0,0),tt=r.fromValues(0,0),et=r.fromValues(0,0),nt=r.fromValues(0,0),rt=r.fromValues(0,0),it=r.fromValues(0,0);M.findSeparatingAxis=function(t,e,n,o,a,s,u){var c=null,l=!1,h=!1,f=$,d=tt,v=et,m=nt,y=rt,g=it;if(t instanceof p&&o instanceof p)for(var b=0;2!==b;b++){var _=t,w=n;1===b&&(_=o,w=s);for(var E=0;2!==E;E++){0===E?r.set(m,0,1):1===E&&r.set(m,1,0),0!==w&&r.rotate(m,m,w),M.projectConvexOntoAxis(t,e,n,m,y),M.projectConvexOntoAxis(o,a,s,m,g);var x=y,T=g;y[0]>g[0]&&(T=y,x=g),l=(C=T[0]-x[1])<=0,(null===c||C>c)&&(r.copy(u,m),c=C,h=l)}}else for(b=0;2!==b;b++)for(_=t,w=n,1===b&&(_=o,w=s),E=0;E!==_.vertices.length;E++){var C;r.rotate(d,_.vertices[E],w),r.rotate(v,_.vertices[(E+1)%_.vertices.length],w),i(f,v,d),r.rotate90cw(m,f),r.normalize(m,m),M.projectConvexOntoAxis(t,e,n,m,y),M.projectConvexOntoAxis(o,a,s,m,g),x=y,T=g,y[0]>g[0]&&(T=y,x=g),l=(C=T[0]-x[1])<=0,(null===c||C>c)&&(r.copy(u,m),c=C,h=l)}return h};var ot=r.fromValues(0,0),at=r.fromValues(0,0),st=r.fromValues(0,0);M.getClosestEdge=function(t,e,n,o){var s=ot,u=at,c=st;r.rotate(s,n,-e),o&&r.scale(s,s,-1);for(var l=-1,h=t.vertices.length,f=-1,d=0;d!==h;d++){i(u,t.vertices[(d+1)%h],t.vertices[d%h]),r.rotate90cw(c,u),r.normalize(c,c);var p=a(c,s);(-1===l||p>f)&&(l=d%h,f=p)}return l};var ut=r.create(),ct=r.create(),lt=r.create(),ht=r.create(),ft=r.create(),dt=r.create(),pt=r.create();M.prototype[d.CIRCLE|d.HEIGHTFIELD]=M.prototype.circleHeightfield=function(t,e,n,a,s,u,c,l,h,f){var d=u.heights,p=(f=f||e.radius,u.elementWidth),v=ct,m=ut,y=ft,g=pt,b=dt,_=lt,w=ht,E=Math.floor((n[0]-f-c[0])/p),x=Math.ceil((n[0]+f-c[0])/p);E<0&&(E=0),x>=d.length&&(x=d.length-1);for(var T=d[E],C=d[x],k=E;k<x;k++)d[k]<C&&(C=d[k]),d[k]>T&&(T=d[k]);if(n[1]-f>T)return!h&&0;var S=!1;for(k=E;k<x;k++){r.set(_,k*p,d[k]),r.set(w,(k+1)*p,d[k+1]),r.add(_,_,c),r.add(w,w,c),r.sub(b,w,_),r.rotate(b,b,Math.PI/2),r.normalize(b,b),r.scale(m,b,-f),r.add(m,m,n),r.sub(v,m,_);var A=r.dot(v,b);if(m[0]>=_[0]&&m[0]<w[0]&&A<=0){if(h)return!0;S=!0,r.scale(v,b,-A),r.add(y,m,v),r.copy(g,b);var I=this.createContactEquation(s,t,u,e);r.copy(I.normalA,g),r.scale(I.contactPointB,I.normalA,-f),o(I.contactPointB,I.contactPointB,n),i(I.contactPointB,I.contactPointB,t.position),r.copy(I.contactPointA,y),r.sub(I.contactPointA,I.contactPointA,s.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}}if(S=!1,f>0)for(k=E;k<=x;k++)if(r.set(_,k*p,d[k]),r.add(_,_,c),r.sub(v,n,_),r.squaredLength(v)<Math.pow(f,2)){if(h)return!0;S=!0,I=this.createContactEquation(s,t,u,e),r.copy(I.normalA,v),r.normalize(I.normalA,I.normalA),r.scale(I.contactPointB,I.normalA,-f),o(I.contactPointB,I.contactPointB,n),i(I.contactPointB,I.contactPointB,t.position),i(I.contactPointA,_,c),o(I.contactPointA,I.contactPointA,c),i(I.contactPointA,I.contactPointA,s.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}return S?1:0};var vt=r.create(),mt=r.create(),yt=r.create(),gt=new f({vertices:[r.create(),r.create(),r.create(),r.create()]});M.prototype[d.BOX|d.HEIGHTFIELD]=M.prototype[d.CONVEX|d.HEIGHTFIELD]=M.prototype.convexHeightfield=function(t,e,n,i,o,a,s,u,c){var l=a.heights,h=a.elementWidth,f=vt,d=mt,p=yt,v=gt,m=Math.floor((t.aabb.lowerBound[0]-s[0])/h),y=Math.ceil((t.aabb.upperBound[0]-s[0])/h);m<0&&(m=0),y>=l.length&&(y=l.length-1);for(var g=l[m],b=l[y],_=m;_<y;_++)l[_]<b&&(b=l[_]),l[_]>g&&(g=l[_]);if(t.aabb.lowerBound[1]>g)return!c&&0;var w=0;for(_=m;_<y;_++)r.set(f,_*h,l[_]),r.set(d,(_+1)*h,l[_+1]),r.add(f,f,s),r.add(d,d,s),r.set(p,.5*(d[0]+f[0]),.5*(d[1]+f[1]-100)),r.sub(v.vertices[0],d,p),r.sub(v.vertices[1],f,p),r.copy(v.vertices[2],v.vertices[1]),r.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=100,v.vertices[3][1]-=100,w+=this.convexConvex(t,e,n,i,o,v,p,0,c);return w}},iZbu:function(t,e,n){var r=n("yqpj"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},jB7R:function(t,e,n){var r=n("JtD1"),i=n("6Pil");function o(t,e,n){i.call(this,t,e,n=n||{}),this.localAnchorA=r.fromValues(0,0),this.localAnchorB=r.fromValues(0,0),n.localAnchorA&&r.copy(this.localAnchorA,n.localAnchorA),n.localAnchorB&&r.copy(this.localAnchorB,n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB);var o=r.create(),a=r.create();this.getWorldAnchorA(o),this.getWorldAnchorB(a);var s=r.distance(o,a);this.restLength="number"==typeof n.restLength?n.restLength:s}n("Wk7T"),t.exports=o,(o.prototype=new i).constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var a=r.create(),s=r.create(),u=r.create(),c=r.create(),l=r.create(),h=r.create(),f=r.create(),d=r.create(),p=r.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,o=this.bodyB,v=a,m=s,y=u,g=c,b=p,_=l,w=h,E=f,x=d;this.getWorldAnchorA(_),this.getWorldAnchorB(w),r.sub(E,_,i.position),r.sub(x,w,o.position),r.sub(v,w,_);var T=r.len(v);r.normalize(m,v),r.sub(y,o.velocity,i.velocity),r.crossZV(b,o.angularVelocity,x),r.add(y,y,b),r.crossZV(b,i.angularVelocity,E),r.sub(y,y,b),r.scale(g,m,-t*(T-n)-e*r.dot(y,m)),r.sub(i.force,i.force,g),r.add(o.force,o.force,g);var C=r.crossLength(E,g),k=r.crossLength(x,g);i.angularForce-=C,o.angularForce+=k}},kR7G:function(t,e,n){var r=n("+1EK");function i(t,e,n){n=n||{},r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0,this.ratio="number"==typeof n.ratio?n.ratio:1,this.setRatio(this.ratio)}n("JtD1"),t.exports=i,(i.prototype=new r).constructor=i,i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},i.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},i.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},l2mZ:function(t,e,n){var r=n("tOqy"),i=(n("wUIi"),n("yBzR"),n("JtD1")),o=n("1vck"),a=n("sbLb"),s=(n("gB0W"),n("MVd/")),u=n("SN9G"),c=n("MKEH"),l=n("i+N5"),h=n("RZpa"),f=(n("rCTz"),n("jB7R"),n("ucEh")),d=n("Fmjy"),p=(n("22PD"),n("0pMi"),n("dOQH"),n("goqo"),n("C78X"),n("bcDB"),n("/bTq"),n("Bixm"),n("BcWo")),v=n("oYfg"),m=n("iFPw"),y=n("Wk7T"),g=n("wVJv"),b=n("5xXB");function _(t){l.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new r,this.narrowphase=new m(this),this.islandManager=new b,this.gravity=i.fromValues(0,-9.78),t.gravity&&i.copy(this.gravity,t.gravity),this.frictionGravity=i.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new v,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new f,this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=_.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}n("gC/R"),t.exports=_,(_.prototype=new Object(l.prototype)).constructor=_,_.NO_SLEEPING=1,_.BODY_SLEEPING=2,_.ISLAND_SLEEPING=4,_.prototype.addConstraint=function(t){this.constraints.push(t)},_.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},_.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&y.splice(this.contactMaterials,e,1)},_.prototype.getContactMaterial=function(t,e){for(var n=this.contactMaterials,r=0,i=n.length;r!==i;r++){var o=n[r];if(o.materialA.id===t.id&&o.materialB.id===e.id||o.materialA.id===e.id&&o.materialB.id===t.id)return o}return!1},_.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&y.splice(this.constraints,e,1)},i.create(),i.create(),i.create(),i.create(),i.create(),i.create();var w=i.create(),E=i.fromValues(0,0),x=i.fromValues(0,0);i.fromValues(0,0),i.fromValues(0,0),_.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var r=0;this.accumulator>=t&&r<n;)this.internalStep(t),this.time+=t,this.accumulator-=t,r++;for(var o=this.accumulator%t/t,a=0;a!==this.bodies.length;a++){var s=this.bodies[a];i.lerp(s.interpolatedPosition,s.previousPosition,s.position,o),s.interpolatedAngle=s.previousAngle+o*(s.angle-s.previousAngle)}}};var T=[];_.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,n=this.springs,r=this.bodies,o=this.gravity,a=this.solver,s=this.bodies.length,u=this.broadphase,c=this.narrowphase,l=this.constraints,f=w,d=i.add,p=this.islandManager;if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var v=i.length(this.gravity);0===v&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=v)}if(this.applyGravity)for(var m=0;m!==s;m++){var g=(b=r[m]).force;b.type===h.DYNAMIC&&b.sleepState!==h.SLEEPING&&(i.scale(f,o,b.mass*b.gravityScale),d(g,g,f))}if(this.applySpringForces)for(m=0;m!==e;m++)n[m].applyForce();if(this.applyDamping)for(m=0;m!==s;m++){var b;(b=r[m]).type===h.DYNAMIC&&b.applyDamping(t)}var E=u.getCollisionPairs(this),x=this.disabledBodyCollisionPairs;for(m=x.length-2;m>=0;m-=2)for(var C=E.length-2;C>=0;C-=2)(x[m]===E[C]&&x[m+1]===E[C+1]||x[m+1]===E[C]&&x[m]===E[C+1])&&E.splice(C,2);var k=l.length;for(m=0;m!==k;m++){var S=l[m];if(!S.collideConnected)for(C=E.length-2;C>=0;C-=2)(S.bodyA===E[C]&&S.bodyB===E[C+1]||S.bodyB===E[C]&&S.bodyA===E[C+1])&&E.splice(C,2)}this.postBroadphaseEvent.pairs=E,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,c.reset(this),m=0;for(var A=E.length;m!==A;m+=2)for(var I=E[m],O=E[m+1],P=0,D=I.shapes.length;P!==D;P++)for(var N=I.shapes[P],R=N.position,M=N.angle,L=0,B=O.shapes.length;L!==B;L++){var F=O.shapes[L],U=F.position,V=F.angle,j=this.defaultContactMaterial;if(N.material&&F.material){var q=this.getContactMaterial(N.material,F.material);q&&(j=q)}this.runNarrowphase(c,I,N,R,M,O,F,U,V,j,this.frictionGravity)}for(m=0;m!==s;m++)(W=r[m])._wakeUpAfterNarrowphase&&(W.wakeUp(),W._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(T);var G=this.endContactEvent;for(L=T.length;L--;){var z=T[L];G.shapeA=z.shapeA,G.shapeB=z.shapeB,G.bodyA=z.bodyA,G.bodyB=z.bodyB,this.emit(G)}T.length=0}var H=this.preSolveEvent;for(H.contactEquations=c.contactEquations,H.frictionEquations=c.frictionEquations,this.emit(H),H.contactEquations=H.frictionEquations=null,k=l.length,m=0;m!==k;m++)l[m].update();if(c.contactEquations.length||c.frictionEquations.length||k)if(this.islandSplit){for(p.equations.length=0,y.appendArray(p.equations,c.contactEquations),y.appendArray(p.equations,c.frictionEquations),m=0;m!==k;m++)y.appendArray(p.equations,l[m].equations);for(p.split(this),m=0;m!==p.islands.length;m++)(Y=p.islands[m]).equations.length&&a.solveIsland(t,Y)}else{for(a.addEquations(c.contactEquations),a.addEquations(c.frictionEquations),m=0;m!==k;m++)a.addEquations(l[m].equations);this.solveConstraints&&a.solve(t,this),a.removeAllEquations()}for(m=0;m!==s;m++){var W;(W=r[m]).integrate(t)}for(m=0;m!==s;m++)r[m].setZeroForce();if(this.emitImpactEvent&&this.has("impact")){var K=this.impactEvent;for(m=0;m!==c.contactEquations.length;m++){var X=c.contactEquations[m];X.firstImpact&&(K.bodyA=X.bodyA,K.bodyB=X.bodyB,K.shapeA=X.shapeA,K.shapeB=X.shapeB,K.contactEquation=X,this.emit(K))}}if(this.sleepMode===_.BODY_SLEEPING)for(m=0;m!==s;m++)r[m].sleepTick(this.time,!1,t);else if(this.sleepMode===_.ISLAND_SLEEPING&&this.islandSplit){for(m=0;m!==s;m++)r[m].sleepTick(this.time,!0,t);for(m=0;m<this.islandManager.islands.length;m++){var Y;(Y=this.islandManager.islands[m]).wantsToSleep()&&Y.sleep()}}this.stepping=!1;var Q=this.bodiesToBeRemoved;for(m=0;m!==Q.length;m++)this.removeBody(Q[m]);Q.length=0,this.emit(this.postStepEvent)},_.prototype.runNarrowphase=function(t,e,n,r,o,a,s,u,c,l,f){if(0!=(n.collisionGroup&s.collisionMask)&&0!=(s.collisionGroup&n.collisionMask)){i.rotate(E,r,e.angle),i.rotate(x,u,a.angle),i.add(E,E,e.position),i.add(x,x,a.position);var d=o+e.angle,p=c+a.angle;t.enableFriction=l.friction>0,t.frictionCoefficient=l.friction,t.slipForce=l.friction*f*(e.type===h.STATIC||e.type===h.KINEMATIC?a.mass:a.type===h.STATIC||a.type===h.KINEMATIC?e.mass:e.mass*a.mass/(e.mass+a.mass)),t.restitution=l.restitution,t.surfaceVelocity=l.surfaceVelocity,t.frictionStiffness=l.frictionStiffness,t.frictionRelaxation=l.frictionRelaxation,t.stiffness=l.stiffness,t.relaxation=l.relaxation,t.contactSkinSize=l.contactSkinSize,t.enabledEquations=e.collisionResponse&&a.collisionResponse&&n.collisionResponse&&s.collisionResponse;var v=t[n.type|s.type],m=0;if(v){var y=n.sensor||s.sensor,g=t.frictionEquations.length;m=n.type<s.type?v.call(t,e,n,E,d,a,s,x,p,y):v.call(t,a,s,x,p,e,n,E,d,y);var b=t.frictionEquations.length-g;if(m){if(e.allowSleep&&e.type===h.DYNAMIC&&e.sleepState===h.SLEEPING&&a.sleepState===h.AWAKE&&a.type!==h.STATIC&&i.squaredLength(a.velocity)+Math.pow(a.angularVelocity,2)>=2*Math.pow(a.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0),a.allowSleep&&a.type===h.DYNAMIC&&a.sleepState===h.SLEEPING&&e.sleepState===h.AWAKE&&e.type!==h.STATIC&&i.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(a._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(e,n,a,s),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(n,s)){var _=this.beginContactEvent;if(_.shapeA=n,_.shapeB=s,_.bodyA=e,_.bodyB=a,_.contactEquations.length=0,"number"==typeof m)for(var w=t.contactEquations.length-m;w<t.contactEquations.length;w++)_.contactEquations.push(t.contactEquations[w]);this.emit(_)}if("number"==typeof m&&b>1)for(w=t.frictionEquations.length-b;w<t.frictionEquations.length;w++){var T=t.frictionEquations[w];T.setSlipForce(T.getSlipForce()/b)}}}}},_.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},_.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&y.splice(this.springs,e,1)},_.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},_.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(y.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},_.prototype.getBodyById=function(t){for(var e=this.bodies,n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}return!1},_.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},_.prototype.enableBodyCollision=function(t,e){for(var n=this.disabledBodyCollisionPairs,r=0;r<n.length;r+=2)if(n[r]===t&&n[r+1]===e||n[r+1]===t&&n[r]===e)return void n.splice(r,2)},_.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);var n=this.bodies;for(e=n.length-1;e>=0;e--)this.removeBody(n[e]);var r=this.springs;for(e=r.length-1;e>=0;e--)this.removeSpring(r[e]);var i=this.contactMaterials;for(e=i.length-1;e>=0;e--)this.removeContactMaterial(i[e]);_.apply(this)};var C=i.create(),k=(i.fromValues(0,0),i.fromValues(0,0));_.prototype.hitTest=function(t,e,n){n=n||0;var r=new h({position:t}),l=new c,f=t,d=C,p=k;r.addShape(l);for(var v=this.narrowphase,m=[],y=0,g=e.length;y!==g;y++)for(var b=e[y],_=0,w=b.shapes.length;_!==w;_++){var E=b.shapes[_];i.rotate(d,E.position,b.angle),i.add(d,d,b.position);var x=E.angle+b.angle;(E instanceof o&&v.circleParticle(b,E,d,x,r,l,f,0,!0)||E instanceof a&&v.particleConvex(r,l,f,0,b,E,d,x,!0)||E instanceof s&&v.particlePlane(r,l,f,0,b,E,d,x,!0)||E instanceof u&&v.particleCapsule(r,l,f,0,b,E,d,x,!0)||E instanceof c&&i.squaredLength(i.sub(p,d,t))<n*n)&&m.push(b)}return m},_.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,n=0;n!==e.length;n++)for(var r=e[n],i=0;i!==r.equations.length;i++){var o=r.equations[i];o.stiffness=t,o.needsUpdate=!0}var a=this.contactMaterials;for(n=0;n!==a.length;n++)(r=a[n]).stiffness=r.frictionStiffness=t;(r=this.defaultContactMaterial).stiffness=r.frictionStiffness=t},_.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var n=this.constraints[e],r=0;r!==n.equations.length;r++){var i=n.equations[r];i.relaxation=t,i.needsUpdate=!0}for(e=0;e!==this.contactMaterials.length;e++)(n=this.contactMaterials[e]).relaxation=n.frictionRelaxation=t;(n=this.defaultContactMaterial).relaxation=n.frictionRelaxation=t};var S=new p,A=[];_.prototype.raycast=function(t,e){return e.getAABB(S),this.broadphase.aabbQuery(this,S,A),e.intersectBodies(t,A),A.length=0,t.hasHit()}},mrSG:function(t,e,n){"use strict";n.r(e),n.d(e,"__extends",(function(){return i})),n.d(e,"__assign",(function(){return o})),n.d(e,"__rest",(function(){return a})),n.d(e,"__decorate",(function(){return s})),n.d(e,"__param",(function(){return u})),n.d(e,"__metadata",(function(){return c})),n.d(e,"__awaiter",(function(){return l})),n.d(e,"__generator",(function(){return h})),n.d(e,"__exportStar",(function(){return f})),n.d(e,"__values",(function(){return d})),n.d(e,"__read",(function(){return p})),n.d(e,"__spread",(function(){return v})),n.d(e,"__spreadArrays",(function(){return m})),n.d(e,"__await",(function(){return y})),n.d(e,"__asyncGenerator",(function(){return g})),n.d(e,"__asyncDelegator",(function(){return b})),n.d(e,"__asyncValues",(function(){return _})),n.d(e,"__makeTemplateObject",(function(){return w})),n.d(e,"__importStar",(function(){return E})),n.d(e,"__importDefault",(function(){return x}));var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function s(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function u(t,e){return function(n,r){e(n,r,t)}}function c(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function l(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r.throw(t))}catch(e){o(e)}}function u(t){t.done?i(t.value):new n((function(e){e(t.value)})).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function h(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function f(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function p(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function v(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function m(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function g(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||s(t,e)}))})}function s(t,e){try{(n=i[t](e)).value instanceof y?Promise.resolve(n.value.v).then(u,c):l(o[0][2],n)}catch(r){l(o[0][3],r)}var n}function u(t){s("next",t)}function c(t){s("throw",t)}function l(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function b(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:y(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function _(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=d(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){!function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)}(r,i,(e=t[n](e)).done,e.value)}))}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function E(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function x(t){return t&&t.__esModule?t:{default:t}}},nYho:function(t,e,n){(function(t){var r;!function(i){"object"==typeof global&&global;var o,a=2147483647,s=36,u=1,c=26,l=38,h=700,f=72,d=128,p="-",v=/^xn--/,m=/[^\x20-\x7E]/,y=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},b=s-u,_=Math.floor,w=String.fromCharCode;function E(t){throw RangeError(g[t])}function x(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function T(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+x((t=t.replace(y,".")).split("."),e).join(".")}function C(t){for(var e,n,r=[],i=0,o=t.length;i<o;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<o?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function k(t){return x(t,(function(t){var e="";return t>65535&&(e+=w((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+w(t)})).join("")}function S(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function A(t,e,n){var r=0;for(t=n?_(t/h):t>>1,t+=_(t/e);t>b*c>>1;r+=s)t=_(t/b);return _(r+(b+1)*t/(t+l))}function I(t){var e,n,r,i,o,l,h,v,m,y,g,b=[],w=t.length,x=0,T=d,C=f;for((n=t.lastIndexOf(p))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&E("not-basic"),b.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<w;){for(o=x,l=1,h=s;i>=w&&E("invalid-input"),((v=(g=t.charCodeAt(i++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:s)>=s||v>_((a-x)/l))&&E("overflow"),x+=v*l,!(v<(m=h<=C?u:h>=C+c?c:h-C));h+=s)l>_(a/(y=s-m))&&E("overflow"),l*=y;C=A(x-o,e=b.length+1,0==o),_(x/e)>a-T&&E("overflow"),T+=_(x/e),x%=e,b.splice(x++,0,T)}return k(b)}function O(t){var e,n,r,i,o,l,h,v,m,y,g,b,x,T,k,I=[];for(b=(t=C(t)).length,e=d,n=0,o=f,l=0;l<b;++l)(g=t[l])<128&&I.push(w(g));for(r=i=I.length,i&&I.push(p);r<b;){for(h=a,l=0;l<b;++l)(g=t[l])>=e&&g<h&&(h=g);for(h-e>_((a-n)/(x=r+1))&&E("overflow"),n+=(h-e)*x,e=h,l=0;l<b;++l)if((g=t[l])<e&&++n>a&&E("overflow"),g==e){for(v=n,m=s;!(v<(y=m<=o?u:m>=o+c?c:m-o));m+=s)I.push(w(S(y+(k=v-y)%(T=s-y),0))),v=_(k/T);I.push(w(S(v,0))),o=A(n,x,r==i),n=0,++r}++n,++e}return I.join("")}o={version:"1.3.2",ucs2:{decode:C,encode:k},decode:I,encode:O,toASCII:function(t){return T(t,(function(t){return m.test(t)?"xn--"+O(t):t}))},toUnicode:function(t){return T(t,(function(t){return v.test(t)?I(t.slice(4).toLowerCase()):t}))}},void 0===(r=(function(){return o}).call(e,n,e,t))||(t.exports=r)}()}).call(this,n("YuTi")(t))},oYfg:function(t,e,n){var r=n("Wk7T"),i=n("Bixm");function o(){i.call(this,i.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var n=t.axisList.indexOf(e.body);-1!==n&&t.axisList.splice(n,1)}}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.sortAxisList=function(t,e){e|=0;for(var n=1,r=t.length;n<r;n++){for(var i=t[n],o=n-1;o>=0&&!(t[o].aabb.lowerBound[e]<=i.aabb.lowerBound[e]);o--)t[o+1]=t[o];t[o+1]=i}return t},o.prototype.sortList=function(){o.sortAxisList(this.axisList,this.axisIndex)},o.prototype.getCollisionPairs=function(t){var e=this.axisList,n=this.result,r=this.axisIndex;n.length=0;for(var o=e.length;o--;){var a=e[o];a.aabbNeedsUpdate&&a.updateAABB()}this.sortList();for(var s=0,u=0|e.length;s!==u;s++)for(var c=e[s],l=s+1;l<u;l++){var h=e[l];if(!(h.aabb.lowerBound[r]<=c.aabb.upperBound[r]))break;i.canCollide(c,h)&&this.boundingVolumeCheck(c,h)&&n.push(c,h)}return n},o.prototype.aabbQuery=function(t,e,n){n=n||[],this.sortList();for(var r=this.axisList,i=0;i<r.length;i++){var o=r[i];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&n.push(o)}return n}},"q/0M":function(t,e,n){"use strict";function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}n.r(e),n.d(e,"LogLevel",(function(){return o})),n.d(e,"Logger",(function(){return u})),n.d(e,"setLogLevel",(function(){return c}));var i=[],o=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}({}),a=o.INFO,s=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var a=(new Date).toISOString();switch(e){case o.DEBUG:case o.VERBOSE:console.log.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case o.INFO:console.info.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case o.WARN:console.warn.apply(console,r(["["+a+"]  "+t.name+":"],n));break;case o.ERROR:console.error.apply(console,r(["["+a+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},u=function(){function t(t){this.name=t,this._logLevel=a,this._logHandler=s,i.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in o))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,o.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,o.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,o.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,o.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,r([this,o.ERROR],t))},t}();function c(t){i.forEach((function(e){e.logLevel=t}))}},r8II:function(t,e,n){"use strict";e.decode=e.parse=n("YcCt"),e.encode=e.stringify=n("6MUB")},rCTz:function(t,e,n){t.exports=i;var r=n("JtD1");function i(t){t=t||{},this.body=null,this.position=r.fromValues(0,0),t.position&&r.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.BOX=32,Object.defineProperty(i,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),i.BOX}}),i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype.computeMomentOfInertia=function(t){},i.prototype.updateBoundingRadius=function(){},i.prototype.updateArea=function(){},i.prototype.computeAABB=function(t,e,n){},i.prototype.raycast=function(t,e,n,r){}},sQJA:function(t,e,n){var r=n("JtD1"),i=(n("Wk7T"),n("0pMi")),o=n("yqpj"),a=n("RZpa");function s(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new a({mass:0}),this.world=null;var n=this;this.preStepCallback=function(){n.update()}}function u(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new o(t.chassisBody,t.groundBody),this.sideEquation=new o(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=r.fromValues(0,1),e.localForwardVector&&r.copy(this.localForwardVector,e.localForwardVector),this.localPosition=r.fromValues(0,0),e.localPosition&&r.copy(this.localPosition,e.localPosition),i.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}t.exports=s,s.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++)t.addConstraint(this.wheels[e])},s.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++)t.removeConstraint(this.wheels[e]);this.world=null},s.prototype.addWheel=function(t){var e=new u(this,t);return this.wheels.push(e),e},s.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},(u.prototype=new i).setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},u.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=r.create(),l=r.create();u.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(l,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(c,l),r.dot(c,l)};var h=r.create();u.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),r.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),r.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),r.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),r.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),r.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),r.normalize(h,this.forwardEquation.t),r.scale(h,h,this.engineForce),this.vehicle.chassisBody.applyForce(h,this.forwardEquation.contactPointA)}},sbLb:function(t,e,n){var r=n("rCTz"),i=n("JtD1"),o=n("KXN6");function a(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],n=0;n<e.length;n++){var o=i.create();i.copy(o,e[n]),this.vertices.push(o)}if(this.axes=[],t.axes)for(n=0;n<t.axes.length;n++){var a=i.create();i.copy(a,t.axes[n]),this.axes.push(a)}else for(n=0;n<this.vertices.length;n++){var s=this.vertices[n],u=this.vertices[(n+1)%this.vertices.length],c=i.create();i.sub(c,u,s),i.rotate90cw(c,c),i.normalize(c,c),this.axes.push(c)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=r.CONVEX,r.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}n("Dded"),t.exports=a,(a.prototype=new r).constructor=a;var s=i.create(),u=i.create();a.prototype.projectOntoLocalAxis=function(t,e){for(var n,r=null,o=null,a=(t=s,0);a<this.vertices.length;a++)n=i.dot(this.vertices[a],t),(null===r||n>r)&&(r=n),(null===o||n<o)&&(o=n);if(o>r){var u=o;o=r,r=u}i.set(e,o,r)},a.prototype.projectOntoWorldAxis=function(t,e,n,r){var o=u;this.projectOntoLocalAxis(t,r),0!==n?i.rotate(o,t,n):o=t;var a=i.dot(e,o);i.set(r,r[0]+a,r[1]+a)},a.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var n=this.vertices[e];t.push(n[0],n[1])}var r=o.Triangulate(t);for(e=0;e<r.length;e+=3)this.triangles.push([r[e],r[e+1],r[e+2]])};var c=i.create(),l=i.create(),h=i.create(),f=i.create(),d=i.create();i.create(),i.create(),i.create(),i.create(),a.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,n=this.centerOfMass,r=c,o=h,s=f,u=d,p=l;i.set(n,0,0);for(var v=0,m=0;m!==t.length;m++){var y=t[m];i.centroid(r,o=e[y[0]],s=e[y[1]],u=e[y[2]]);var g=a.triangleArea(o,s,u);v+=g,i.scale(p,r,g),i.add(n,n,p)}i.scale(n,n,1/v)},a.prototype.computeMomentOfInertia=function(t){for(var e=0,n=0,r=this.vertices.length,o=r-1,a=0;a<r;o=a,a++){var s=this.vertices[o],u=this.vertices[a],c=Math.abs(i.crossLength(s,u));e+=c*(i.dot(u,u)+i.dot(u,s)+i.dot(s,s)),n+=c}return t/6*(e/n)},a.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,n=0;n!==t.length;n++){var r=i.squaredLength(t[n]);r>e&&(e=r)}this.boundingRadius=Math.sqrt(e)},a.triangleArea=function(t,e,n){return.5*((e[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(e[1]-t[1]))},a.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,n=0;n!==t.length;n++){var r=t[n],i=a.triangleArea(e[r[0]],e[r[1]],e[r[2]]);this.area+=i}},a.prototype.computeAABB=function(t,e,n){t.setFromPoints(this.vertices,e,n,0)};var p=i.create(),v=i.create(),m=i.create();a.prototype.raycast=function(t,e,n,r){var o=p,a=v,s=m,u=this.vertices;i.toLocalFrame(o,e.from,n,r),i.toLocalFrame(a,e.to,n,r);for(var c=u.length,l=0;l<c&&!t.shouldStop(e);l++){var h=u[l],f=u[(l+1)%c],d=i.getLineSegmentsIntersectionFraction(o,a,h,f);d>=0&&(i.sub(s,f,h),i.rotate(s,s,-Math.PI/2+r),i.normalize(s,s),e.reportIntersection(t,d,s,l))}}},tOqy:function(t,e,n){n("JtD1");var r=n("wUIi"),i=n("Wk7T"),o=n("yqpj");function a(t){r.call(this,t,r.GS),this.iterations=(t=t||{}).iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new i.ARRAY_TYPE(this.arrayStep),this.Bs=new i.ARRAY_TYPE(this.arrayStep),this.invCs=new i.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}t.exports=a,(a.prototype=new r).constructor=a,a.prototype.solve=function(t,e){this.sortEquations();var n=0,r=this.iterations,s=this.frictionIterations,u=this.equations,c=u.length,l=Math.pow(this.tolerance*c,2),h=e.bodies,f=e.bodies.length,d=this.useZeroRHS,p=this.lambda;if(this.usedIterations=0,c)for(var v=0;v!==f;v++)h[v].updateSolveMassProperties();p.length<c&&(p=this.lambda=new i.ARRAY_TYPE(c+this.arrayStep),this.Bs=new i.ARRAY_TYPE(c+this.arrayStep),this.invCs=new i.ARRAY_TYPE(c+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(p);var m,y,g=this.invCs,b=this.Bs;for(p=this.lambda,v=0;v!==u.length;v++){var _;((_=u[v]).timeStep!==t||_.needsUpdate)&&(_.timeStep=t,_.update()),b[v]=_.computeB(_.a,_.b,t),g[v]=_.computeInvC(_.epsilon)}if(0!==c){for(v=0;v!==f;v++)h[v].resetConstraintVelocity();if(s){for(n=0;n!==s;n++){for(m=0,y=0;y!==c;y++){var w=a.iterateEquation(y,_=u[y],_.epsilon,b,g,p,d,t,n);m+=Math.abs(w)}if(this.usedIterations++,m*m<=l)break}for(a.updateMultipliers(u,p,1/t),y=0;y!==c;y++){var E=u[y];if(E instanceof o){for(var x=0,T=0;T!==E.contactEquations.length;T++)x+=E.contactEquations[T].multiplier;E.maxForce=x*=E.frictionCoefficient/E.contactEquations.length,E.minForce=-x}}}for(n=0;n!==r;n++){for(m=0,y=0;y!==c;y++)w=a.iterateEquation(y,_=u[y],_.epsilon,b,g,p,d,t,n),m+=Math.abs(w);if(this.usedIterations++,m*m<=l)break}for(v=0;v!==f;v++)h[v].addConstraintVelocity();a.updateMultipliers(u,p,1/t)}},a.updateMultipliers=function(t,e,n){for(var r=t.length;r--;)t[r].multiplier=e[r]*n},a.iterateEquation=function(t,e,n,r,i,o,a,s,u){var c=r[t],l=i[t],h=o[t],f=e.computeGWlambda(),d=e.maxForce,p=e.minForce;a&&(c=0);var v=l*(c-f-n*h),m=h+v;return m<p*s?v=p*s-h:m>d*s&&(v=d*s-h),o[t]+=v,e.addToWlambda(v),v}},u62O:function(t,e,n){"use strict";t.exports=function(t,e){for(var n={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},r=n.parser[(e=e||{}).strictMode?"strict":"loose"].exec(t),i={},o=14;o--;)i[n.key[o]]=r[o]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,(function(t,e,r){e&&(i[n.q.name][e]=r)})),i}},ucEh:function(t,e){function n(t){this.id=t||n.idCounter++}t.exports=n,n.idCounter=0},uhBA:function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||t,o),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=this._events[i?i+t:t];if(!e)return[];if(e.fn)return[e.fn];for(var n=0,r=e.length,o=new Array(r);n<r;n++)o[n]=e[n].fn;return o},c.prototype.listenerCount=function(t){var e=this._events[i?i+t:t];return e?e.fn?1:e.length:0},c.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,d=l.length;for(c=0;c<d;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?this._events[e=i?i+t:t]&&u(this,e):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},vMUY:function(t,e,n){var r=n("Wk7T");function i(){this.data={},this.keys=[]}t.exports=i,i.prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.prototype.getByKey=function(t){return this.data[t|=0]},i.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},i.prototype.set=function(t,e,n){if(!n)throw new Error("No data!");var r=this.getKey(t,e);return this.data[r]||this.keys.push(r),this.data[r]=n,r},i.prototype.reset=function(){for(var t=this.data,e=this.keys,n=e.length;n--;)delete t[e[n]];e.length=0},i.prototype.copy=function(t){this.reset(),r.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var n=t.keys[e];this.data[n]=t.data[n]}}},vgT8:function(t,e,n){var r=n("+nTh"),i=n("SeMp");function o(){i.apply(this,arguments)}t.exports=o,(o.prototype=new i).constructor=o,o.prototype.create=function(){return new r},o.prototype.destroy=function(t){return t.reset(),this}},wUIi:function(t,e,n){n("Wk7T");var r=n("i+N5");function i(t,e){t=t||{},r.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}t.exports=i,(i.prototype=new r).constructor=i,i.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};i.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),o.bodies.length=0,e.getBodies(o.bodies),o.bodies.length&&this.solve(t,o))},i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.addEquations=function(t){for(var e=0,n=t.length;e!==n;e++){var r=t[e];r.enabled&&this.equations.push(r)}},i.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0},i.GS=1,i.ISLAND=2},wVJv:function(t,e,n){var r=n("vMUY"),i=(n("AeTl"),n("XZ30"));function o(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new i({size:16}),this.tmpDict=new r,this.tmpArray1=[]}n("Wk7T"),t.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,n=t.keys.length;n--;){var r=t.keys[n],i=t.getByKey(r);e.getByKey(r),i&&this.recordPool.release(i)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,n,r){var i=this.overlappingShapesCurrentState;if(!i.get(e.id,r.id)){var o=this.recordPool.get();o.set(t,e,n,r),i.set(e.id,r.id,o)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var n=this.overlappingShapesCurrentState,r=n.keys.length;r--;){var i=n.data[n.keys[r]];if(i.bodyA===t&&i.bodyB===e||i.bodyA===e&&i.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,n){var r=t,i=e;(n=n||[]).length=0;for(var o=i.keys.length;o--;){var a=i.keys[o],s=i.data[a];if(!s)throw new Error("Key "+a+" had no data!");r.data[a]||n.push(s)}return n},o.prototype.isNewOverlap=function(t,e){var n=0|t.id,r=0|e.id,i=this.overlappingShapesCurrentState;return!this.overlappingShapesLastState.get(n,r)&&!!i.get(n,r)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var n=this.tmpDict,r=t.length;r--;)n.set(0|(i=t[r]).bodyA.id,0|i.bodyB.id,i);for(r=n.keys.length;r--;){var i;(i=n.getByKey(n.keys[r]))&&e.push(i.bodyA,i.bodyB)}return n.reset(),e}},wYbb:function(t,e,n){var r=t.exports={AABB:n("BcWo"),AngleLockEquation:n("kR7G"),Body:n("RZpa"),Broadphase:n("Bixm"),Capsule:n("SN9G"),Circle:n("1vck"),Constraint:n("0pMi"),ContactEquation:n("fq9q"),ContactEquationPool:n("2Vfd"),ContactMaterial:n("Fmjy"),Convex:n("sbLb"),DistanceConstraint:n("22PD"),Equation:n("+1EK"),EventEmitter:n("i+N5"),FrictionEquation:n("yqpj"),FrictionEquationPool:n("iZbu"),GearConstraint:n("bcDB"),GSSolver:n("tOqy"),Heightfield:n("Q2Wg"),Line:n("gB0W"),LockConstraint:n("dOQH"),Material:n("ucEh"),Narrowphase:n("iFPw"),NaiveBroadphase:n("wt/p"),Particle:n("MKEH"),Plane:n("MVd/"),Pool:n("SeMp"),RevoluteConstraint:n("goqo"),PrismaticConstraint:n("C78X"),Ray:n("yBzR"),RaycastResult:n("Dp7I"),Box:n("I+AN"),RotationalVelocityEquation:n("B9yW"),SAPBroadphase:n("oYfg"),Shape:n("rCTz"),Solver:n("wUIi"),Spring:n("6Pil"),TopDownVehicle:n("sQJA"),LinearSpring:n("jB7R"),RotationalSpring:n("gC/R"),Utils:n("Wk7T"),World:n("l2mZ"),vec2:n("JtD1"),version:n("/bTq").version};Object.defineProperty(r,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},wj3C:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,i,o=n("mrSG"),a=n("zVF4"),s=n("S+S0"),u=n("q/0M"),c=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r),l=new a.ErrorFactory("app","Firebase",c),h="@firebase/app",f="[DEFAULT]",d=((i={})[h]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),p=new u.Logger("@firebase/app"),v=function(){function t(t,e,n){var r,i,u=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=a.deepCopy(t),this.container=new s.ComponentContainer(e.name),this._addComponent(new s.Component("app",(function(){return u}),"PUBLIC"));try{for(var c=o.__values(this.firebase_.INTERNAL.components.values()),l=c.next();!l.done;l=c.next())this._addComponent(l.value)}catch(h){r={error:h}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e=f),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=f),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){p.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{appName:this.name_})},t}();v.prototype.name&&v.prototype.options||v.prototype.delete||console.log("dc");var m=function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=f);var s=o.name;if("string"!=typeof s||!s)throw l.create("bad-app-name",{appName:String(s)});if(a.contains(e,s))throw l.create("duplicate-app",{appName:s});var u=new t(n,o,r);return e[s]=u,u},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=d[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var c=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&c.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&c.push("and"),a&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void p.warn(c.join(" "))}u(new s.Component(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},apps:null,SDK_VERSION:"7.6.0",INTERNAL:{registerComponent:u,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}};function i(t){if(!a.contains(e,t=t||f))throw l.create("no-app",{appName:t});return e[t]}function u(s){var u,c,h=s.name;if(n.has(h))return p.debug("There were multiple attempts to register component "+h+"."),"PUBLIC"===s.type?r[h]:null;if(n.set(h,s),"PUBLIC"===s.type){var f=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[h])throw l.create("invalid-app-argument",{appName:h});return t[h]()};void 0!==s.serviceProps&&a.deepExtend(f,s.serviceProps),r[h]=f,t.prototype[h]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,h);return n.apply(this,s.multipleInstances?t:[])}}try{for(var d=o.__values(Object.keys(e)),v=d.next();!v.done;v=d.next())e[v.value]._addComponent(s)}catch(m){u={error:m}}finally{try{v&&!v.done&&(c=d.return)&&c.call(d)}finally{if(u)throw u.error}}return"PUBLIC"===s.type?r[h]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(v);return e.INTERNAL=o.__assign(o.__assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){a.deepExtend(e,t)},createSubscribe:a.createSubscribe,ErrorFactory:a.ErrorFactory,deepExtend:a.deepExtend}),e}(),y=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e;return"VERSION"===(null===(e=t.getComponent())||void 0===e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();if(a.isBrowser()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var g=self.firebase.SDK_VERSION;g&&g.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var b=m.initializeApp;m.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return a.isNode()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),b.apply(void 0,t)};var _=m;!function(t,e){t.INTERNAL.registerComponent(new s.Component("platform-logger",(function(t){return new y(t)}),"PRIVATE")),t.registerVersion(h,"0.5.0",void 0),t.registerVersion("fire-js","")}(_),e.default=_,e.firebase=_},"wt/p":function(t,e,n){n("1vck"),n("MVd/"),n("rCTz"),n("MKEH");var r=n("Bixm");function i(){r.call(this,r.NAIVE)}n("JtD1"),t.exports=i,(i.prototype=new r).constructor=i,i.prototype.getCollisionPairs=function(t){var e=t.bodies,n=this.result;n.length=0;for(var i=0,o=e.length;i!==o;i++)for(var a=e[i],s=0;s<i;s++){var u=e[s];r.canCollide(a,u)&&this.boundingVolumeCheck(a,u)&&n.push(a,u)}return n},i.prototype.aabbQuery=function(t,e,n){n=n||[];for(var r=t.bodies,i=0;i<r.length;i++){var o=r[i];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&n.push(o)}return n}},x7I3:function(t,e,n){"use strict";n.r(e),n.d(e,"ErrorCode",(function(){return sr})),n.d(e,"EventType",(function(){return ur})),n.d(e,"WebChannel",(function(){return cr})),n.d(e,"XhrIo",(function(){return lr})),n.d(e,"createWebChannelTransport",(function(){return ar}));var r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=o||{},a=i;function s(t){return"string"==typeof t}function u(t){return"number"==typeof t}function c(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function l(){}function h(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function f(t){return"array"==h(t)}function d(t){var e=h(t);return"array"==e||"object"==e&&"number"==typeof t.length}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var v="closure_uid_"+(1e9*Math.random()>>>0),m=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function g(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:g).apply(null,arguments)}function _(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var w=Date.now||function(){return+new Date};function E(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.xb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function x(){this.j=this.j,this.i=this.i}x.prototype.j=!1,x.prototype.la=function(){!this.j&&(this.j=!0,this.G(),0)&&(this[v]||(this[v]=++m))},x.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var T=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},C=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function k(t){return Array.prototype.concat.apply([],arguments)}function S(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function A(t){return/^[\s\xa0]*$/.test(t)}var I,O=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function P(t,e){return-1!=t.indexOf(e)}function D(t,e){return t<e?-1:t>e?1:0}t:{var N=a.navigator;if(N){var R=N.userAgent;if(R){I=R;break t}}I=""}function M(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function L(t){var e,n={};for(e in t)n[e]=t[e];return n}var B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<B.length;o++)n=B[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function U(t){return U[" "](t),t}U[" "]=l;var V,j,q=P(I,"Opera"),G=P(I,"Trident")||P(I,"MSIE"),z=P(I,"Edge"),H=z||G,W=P(I,"Gecko")&&!(P(I.toLowerCase(),"webkit")&&!P(I,"Edge"))&&!(P(I,"Trident")||P(I,"MSIE"))&&!P(I,"Edge"),K=P(I.toLowerCase(),"webkit")&&!P(I,"Edge");function X(){var t=a.document;return t?t.documentMode:void 0}t:{var Y="",Q=(j=I,W?/rv:([^\);]+)(\)|;)/.exec(j):z?/Edge\/([\d\.]+)/.exec(j):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(j):K?/WebKit\/(\S+)/.exec(j):q?/(?:Version)[ \/]?(\S+)/.exec(j):void 0);if(Q&&(Y=Q?Q[1]:""),G){var J=X();if(null!=J&&J>parseFloat(Y)){V=String(J);break t}}V=Y}var Z,$={};function tt(t){return function(t,e){var n=$;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,(function(){for(var e=0,n=O(String(V)).split("."),r=O(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=D(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||D(0==a[2].length,0==s[2].length)||D(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}))}var et=a.document;Z=et&&G?X()||("CSS1Compat"==et.compatMode?parseInt(V,10):5):void 0;var nt=!G||9<=Number(Z),rt=G&&!tt("9"),it=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(n){}return t}();function ot(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function at(t,e){if(ot.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(W){t:{try{U(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:st[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ot.prototype.b=function(){this.Ia=!1},E(at,ot);var st={2:"touch",3:"pen",4:"mouse"};at.prototype.b=function(){at.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var ut="closure_listenable_"+(1e6*Math.random()|0),ct=0;function lt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++ct,this.X=this.Z=!1}function ht(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function ft(t){this.src=t,this.a={},this.b=0}function dt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=T(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ht(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}ft.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=pt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new lt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var vt="closure_lm_"+(1e6*Math.random()|0),mt={};function yt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(f(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}return r=Tt(r),e&&e[ut]?e.Aa(n,r,p(i)?!!i.capture:!!i,o):gt(e,n,r,!0,i,o)}(t,e,n,r,i);if(f(e)){for(var o=0;o<e.length;o++)yt(t,e[o],n,r,i);return null}return n=Tt(n),t&&t[ut]?t.za(e,n,p(r)?!!r.capture:!!r,i):gt(t,e,n,!1,r,i)}function gt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=p(i)?!!i.capture:!!i;if(a&&!nt)return null;var s=Et(t);if(s||(t[vt]=s=new ft(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=wt,e=nt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)it||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(_t(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function bt(t){if(!u(t)&&t&&!t.X){var e=t.src;if(e&&e[ut])dt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(_t(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Et(e))?(dt(n,t),0==n.b&&(n.src=null,e[vt]=null)):ht(t)}}}function _t(t){return t in mt?mt[t]:mt[t]="on"+t}function wt(t,e){return!!t.X||function(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&bt(t),n.call(r,e)}(t,nt?new at(e,this):e=new at(e||c("window.event"),this))}function Et(t){return(t=t[vt])instanceof ft?t:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Tt(t){return"function"==h(t)?t:(t[xt]||(t[xt]=function(e){return t.handleEvent(e)}),t[xt])}function Ct(){x.call(this),this.c=new ft(this),this.J=this,this.B=null}function kt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&dt(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}E(Ct,x),Ct.prototype[ut]=!0,(r=Ct.prototype).addEventListener=function(t,e,n,r){yt(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(f(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=p(i)?!!i.capture:!!i,r=Tt(r),e&&e[ut]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=pt(a=e.a[n],r,i,o))&&(ht(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=Et(e))&&(n=e.a[n.toString()],e=-1,n&&(e=pt(n,r,i,o)),(r=-1<e?n[e]:null)&&bt(r))}(this,t,e,n,r)},r.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(s(t))t=new ot(t,n);else if(t instanceof ot)t.target=t.target||n;else{var i=t;F(t=new ot(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=kt(a,r,!0,t)&&i}if(i=kt(a=t.a=n,r,!0,t)&&i,i=kt(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=kt(a=t.a=e[o],r,!1,t)&&i;return i},r.G=function(){if(Ct.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)ht(n[r]);delete e.a[t],e.b--}}this.B=null},r.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},r.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var St=a.JSON.stringify;function At(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function It(){this.b=this.a=null}At.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Ot,Pt=new At((function(){return new Nt}),(function(t){t.reset()}));function Dt(){var t=Bt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Nt(){this.next=this.b=this.a=null}function Rt(t){a.setTimeout((function(){throw t}),0)}function Mt(t,e){Ot||function(){var t=a.Promise.resolve(void 0);Ot=function(){t.then(Ft)}}(),Lt||(Ot(),Lt=!0),Bt.add(t,e)}It.prototype.add=function(t,e){var n=Pt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Nt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Nt.prototype.reset=function(){this.next=this.b=this.a=null};var Lt=!1,Bt=new It;function Ft(){for(var t;t=Dt();){try{t.a.call(t.b)}catch(n){Rt(n)}var e=Pt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Lt=!1}function Ut(t,e){Ct.call(this),this.b=t||1,this.a=e||a,this.f=b(this.fb,this),this.g=w()}function Vt(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function jt(t,e,n){if("function"==h(t))n&&(t=b(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=b(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function qt(t,e,n){x.call(this),this.f=null!=n?b(t,n):t,this.c=e,this.b=b(this.$a,this),this.a=[]}function Gt(t){t.U=jt(t.b,t.c),t.f.apply(null,t.a)}function zt(t){x.call(this),this.b=t,this.a={}}E(Ut,Ct),(r=Ut.prototype).ba=!1,r.L=null,r.fb=function(){if(this.ba){var t=w()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Vt(this),this.start()))}},r.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=w())},r.G=function(){Ut.N.G.call(this),Vt(this),delete this.a},E(qt,x),(r=qt.prototype).ea=!1,r.U=null,r.Ta=function(t){this.a=arguments,this.U?this.ea=!0:Gt(this)},r.G=function(){qt.N.G.call(this),this.U&&(a.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},r.$a=function(){this.U=null,this.ea&&(this.ea=!1,Gt(this))},E(zt,x);var Ht=[];function Wt(t,e,n,r){f(n)||(n&&(Ht[0]=n.toString()),n=Ht);for(var i=0;i<n.length;i++){var o=yt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Kt(t){M(t.a,(function(t,e){this.a.hasOwnProperty(e)&&bt(t)}),t),t.a={}}function Xt(){}zt.prototype.G=function(){zt.N.G.call(this),Kt(this)},zt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Yt=new Ct;function Qt(t){ot.call(this,"serverreachability",t)}function Jt(t){Yt.dispatchEvent(new Qt(Yt,t))}function Zt(t){ot.call(this,"statevent",t)}function $t(t){Yt.dispatchEvent(new Zt(Yt,t))}function te(t){ot.call(this,"timingevent",t)}function ee(t,e){if("function"!=h(t))throw Error("Fn must not be null and must be a function");return a.setTimeout((function(){t()}),e)}E(Qt,ot),E(Zt,ot),E(te,ot);var ne={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},re={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function ie(){}function oe(){}ie.prototype.a=null;var ae,se={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function ue(){ot.call(this,"d")}function ce(){ot.call(this,"c")}function le(){}function he(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new zt(this),this.O=fe,this.P=new Ut(t=H?125:void 0),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}E(ue,ot),E(ce,ot),E(le,ie),ae=new le;var fe=45e3,de={},pe={};function ve(t,e,n){t.F=1,t.f=Ve(Ne(e)),t.l=n,t.H=!0,ye(t,null)}function me(t,e,n,r){t.F=1,t.f=Ve(Ne(e)),t.l=null,t.H=n,ye(t,r)}function ye(t,e){t.v=w(),_e(t),t.D=Ne(t.f),Ue(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new qt(b(t.Ja,t,t.a),t.J)),Wt(t.I,t.a,"readystatechange",t.cb),e=t.h?L(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),Jt(1)}function ge(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=be(t,n);if(i==pe){4==e&&(t.c=4,$t(14),r=!1);break}if(i==de){t.c=4,$t(15),r=!1;break}Ce(t,i)}4==e&&0==n.length&&(t.c=1,$t(16),r=!1),t.b=t.b&&r,r||(Te(t),xe(t))}function be(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?pe:(n=Number(e.substring(n,r)),isNaN(n)?de:(r+=1)+n>e.length?pe:(e=e.substr(r,n),t.A=r+n,e))}function _e(t){t.R=w()+t.O,we(t,t.O)}function we(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=ee(b(t.ab,t),e)}function Ee(t){t.i&&(a.clearTimeout(t.i),t.i=null)}function xe(t){t.g.Ca()||t.m||t.g.na(t)}function Te(t){Ee(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Vt(t.P),Kt(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Ce(t,e){try{t.g.Fa(t,e),Jt(4)}catch(n){}}function ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||s(t))C(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(d(t)||s(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(s(t))return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Se(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Se)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ae(t,e){Oe(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ie(t))}function Ie(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Oe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Oe(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Oe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(r=he.prototype).setTimeout=function(t){this.O=t},r.cb=function(t){t=t.target;var e=this.B;e&&3==Nn(t)?e.Ta():this.Ja(t)},r.Ja=function(t){try{if(t==this.a)t:{var e=Nn(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!H&&!this.a.aa())){this.m||4!=e||7==n||Jt(8==n||0>=r?3:2),Ee(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=Rn(this.a,"X-HTTP-Initial-Response");if(a&&!A(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,$t(12),Te(this),xe(this);break t}this.s=!0,Ce(this,s)}this.H?(ge(this,e,o),H&&this.b&&3==e&&(Wt(this.I,this.P,"tick",this.bb),this.P.start())):Ce(this,o),4==e&&Te(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,_e(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,$t(12)):(this.c=0,$t(13)),Te(this),xe(this)}}}catch(u){}},r.bb=function(){if(this.a){var t=Nn(this.a),e=this.a.aa();this.A<e.length&&(Ee(this),ge(this,t,e),this.b&&4!=t&&_e(this))}},r.cancel=function(){this.m=!0,Te(this)},r.ab=function(){this.i=null;var t=w();0<=t-this.R?(2!=this.F&&(Jt(3),$t(17)),Te(this),this.c=2,xe(this)):we(this,this.R-t)},(r=Se.prototype).C=function(){Ie(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},r.K=function(){return Ie(this),this.a.concat()},r.get=function(t,e){return Oe(this.b,t)?this.b[t]:e},r.set=function(t,e){Oe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},r.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Pe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function De(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof De?(this.h=void 0!==e?e:t.h,Re(this,t.f),this.j=t.j,Me(this,t.b),Le(this,t.i),this.a=t.a,Be(this,tn(t.c)),this.g=t.g):t&&(n=String(t).match(Pe))?(this.h=!!e,Re(this,n[1]||"",!0),this.j=je(n[2]||""),Me(this,n[3]||"",!0),Le(this,n[4]),this.a=je(n[5]||"",!0),Be(this,n[6]||"",!0),this.g=je(n[7]||"")):(this.h=!!e,this.c=new Ye(null,this.h))}function Ne(t){return new De(t)}function Re(t,e,n){t.f=n?je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Me(t,e,n){t.b=n?je(e,!0):e}function Le(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Be(t,e,n){e instanceof Ye?(t.c=e,function(t,e){e&&!t.f&&(Qe(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Je(this,e),$e(this,n,t))}),t)),t.f=e}(t.c,t.h)):(n||(e=qe(e,Ke)),t.c=new Ye(e,t.h))}function Fe(t,e,n){t.c.set(e,n)}function Ue(t,e,n){f(n)||(n=[String(n)]),$e(t.c,e,n)}function Ve(t){return Fe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^w()).toString(36)),t}function je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qe(t,e,n){return s(t)?(t=encodeURI(t).replace(e,Ge),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ge(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}De.prototype.toString=function(){var t=[],e=this.f;e&&t.push(qe(e,ze,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(qe(e,ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(qe(n,"/"==n.charAt(0)?We:He,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",qe(n,Xe)),t.join("")},De.prototype.resolve=function(t){var e=Ne(this),n=!!t.f;n?Re(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?Me(e,t.b):n=null!=t.i;var r=t.a;if(n)Le(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(P(i,"./")||P(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Be(e,tn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var ze=/[#\/\?@]/g,He=/[#\?:]/g,We=/[#\?]/g,Ke=/[#\?@]/g,Xe=/#/g;function Ye(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Qe(t){t.a||(t.a=new Se,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Je(t,e){Qe(t),e=en(t,e),Oe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ae(t.a,e))}function Ze(t,e){return Qe(t),e=en(t,e),Oe(t.a.b,e)}function $e(t,e,n){Je(t,e),0<n.length&&(t.c=null,t.a.set(en(t,e),S(n)),t.b+=n.length)}function tn(t){var e=new Ye;return e.c=t.c,t.a&&(e.a=new Se(t.a),e.b=t.b),e}function en(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function nn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function rn(t){var e=t.a.F.a;if(null!=e)$t(4),e?($t(10),Wn(t.a,t,!1)):($t(11),Wn(t.a,t,!0));else{t.b=new he(t,void 0,void 0),t.b.h=t.h,e=Jn(e=t.a,e.Y()?t.f:null,t.i),$t(4),Ue(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Fe(e,n,r),me(t.b,e,!1,t.f)}}function on(){this.a=this.b=null}function an(){this.a=new Se}function sn(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[v]||(t[v]=++m)):e.charAt(0)+t}function un(t,e){this.b=t,this.a=e}function cn(t){this.g=t||ln,t=a.PerformanceNavigationTiming?0<(t=a.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(a.ka&&a.ka.Da&&a.ka.Da()&&a.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new an),this.b=null,this.c=[]}(r=Ye.prototype).add=function(t,e){Qe(this),this.c=null,t=en(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},r.forEach=function(t,e){Qe(this),this.a.forEach((function(n,r){C(n,(function(n){t.call(e,n,r,this)}),this)}),this)},r.K=function(){Qe(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},r.C=function(t){Qe(this);var e=[];if(s(t))Ze(this,t)&&(e=k(e,this.a.get(en(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=k(e,t[n])}return e},r.set=function(t,e){return Qe(this),this.c=null,Ze(this,t=en(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},r.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},r.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},E((function(){}),(function(){})),(r=nn.prototype).M=null,r.$=function(t){return this.a.$(t)},r.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},r.Ca=function(){return!1},r.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=Rn(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=Rn(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(i){return(e=this.a).m=this.c,void Yn(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Yn(e,2)}else 1==this.M&&(this.g?$t(6):"11111"==e?($t(5),this.g=!0,(!G||10<=Number(Z))&&(this.c=200,this.b.cancel(),$t(11),Wn(this.a,this,!0))):($t(7),this.g=!1))},r.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,rn(this)):1==this.M&&(this.g?($t(11),Wn(this.a,this,!0)):($t(10),Wn(this.a,this,!1)));else{0==this.M?$t(8):1==this.M&&$t(9);var t=this.a;t.m=this.c,Yn(t,2)}},r.Y=function(){return this.a.Y()},r.ma=function(){return this.a.ma()},an.prototype.add=function(t){this.a.set(sn(t),t)},an.prototype.C=function(){return this.a.C()};var ln=10;function hn(t,e){!t.a&&(P(e,"spdy")||P(e,"quic")||P(e,"h2"))&&(t.f=t.g,t.a=new an,t.b&&(vn(t,t.b),t.b=null))}function fn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function dn(t){return t.b?1:t.a?t.a.a.c:0}function pn(t,e){return t.b?t=t.b==e:t.a?(e=sn(e),t=Oe(t.a.a.b,e)):t=!1,t}function vn(t,e){t.a?t.a.add(e):t.b=e}function mn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=sn(e),n=Oe(t.a.a.b,n)),n&&Ae(t.a.a,sn(e)))}function yn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return C(t.a.C(),(function(t){e=e.concat(t.j)})),e}return S(t.c)}function gn(){}function bn(){this.a=new gn}function _n(t,e,n){var r=n||"";try{ke(t,(function(t,n){var i=t;p(t)&&(i=St(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function wn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}cn.prototype.cancel=function(){this.c=yn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(C(this.a.C(),(function(t){t.cancel()})),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},gn.prototype.stringify=function(t){return a.JSON.stringify(t,void 0)},gn.prototype.parse=function(t){return a.JSON.parse(t,void 0)};var En=a.JSON.parse;function xn(t){Ct.call(this),this.headers=new Se,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Tn,this.D=this.F=!1}E(xn,Ct);var Tn="",Cn=/^https?$/i,kn=["POST","PUT"];function Sn(t){return"content-type"==t.toLowerCase()}function An(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,In(t),Pn(t)}function In(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function On(t){if(t.b&&void 0!==o&&(!t.s[1]||4!=Nn(t)||2!=t.T()))if(t.l&&4==Nn(t))jt(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==Nn(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.A).match(Pe)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!Cn.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var c=2<Nn(t)?t.a.statusText:""}catch(l){c=""}t.f=c+" ["+t.T()+"]",In(t)}}finally{Pn(t)}}}function Pn(t,e){if(t.a){Dn(t);var n=t.a,r=t.s[0]?l:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(i){}}}function Dn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(a.clearTimeout(t.m),t.m=null)}function Nn(t){return t.a?t.a.readyState:0}function Rn(t,e){return t.a?t.a.getResponseHeader(e):null}function Mn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return M(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),s(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Fe(t,e,n),t}function Ln(t){this.f=[],this.F=new on,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!c("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=c("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=c("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=c("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=c("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new cn(t&&t.concurrentRequestLimit),this.ja=new bn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Bn(t){if(Fn(t),3==t.u){var e=t.P++,n=Ne(t.B);Fe(n,"SID",t.H),Fe(n,"RID",e),Fe(n,"TYPE","terminate"),qn(t,n),(e=new he(t,e,void 0)).F=2,e.f=Ve(Ne(n)),n=!1,a.navigator&&a.navigator.sendBeacon&&(n=a.navigator.sendBeacon(e.f.toString(),"")),!n&&a.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=w(),_e(e)}Qn(t)}function Fn(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(a.clearTimeout(t.l),t.l=null),Kn(t),t.b.cancel(),t.h&&(u(t.h)&&a.clearTimeout(t.h),t.h=null)}function Un(t,e){t.f.push(new un(t.Qa++,e)),3==t.u&&Vn(t)}function Vn(t){fn(t.b)||t.h||(t.h=!0,Mt(t.Ha,t),t.A=0)}function jn(t,e){var n;n=e?e.W:t.P++;var r=Ne(t.B);Fe(r,"SID",t.H),Fe(r,"RID",n),Fe(r,"AID",t.O),qn(t,r),t.g&&t.i&&Mn(r,t.g,t.i),n=new he(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Gn(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),vn(t.b,n),ve(n,r,e)}function qn(t,e){t.c&&ke({},(function(t,n){Fe(e,n,t)}))}function Gn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?b(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?a.push("ofs="+(o=i[0].b)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{_n(l,a,"req"+c+"_")}catch(h){r&&r(l)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function zn(t){t.a||t.l||(t.S=1,Mt(t.Ga,t),t.v=0)}function Hn(t){return!(t.a||t.l||3<=t.v||(t.S++,t.l=ee(b(t.Ga,t),Xn(t,t.v)),t.v++,0))}function Wn(t,e,n){var r=e.l;r&&hn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Jn(t,null,t.ha),Vn(t)}function Kn(t){null!=t.s&&(a.clearTimeout(t.s),t.s=null)}function Xn(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function Yn(t,e){if(2==e){var n=null;t.c&&(n=null);var r=b(t.eb,t);n||(n=new De("//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||Re(n,"https"),Ve(n)),function(t,e){var n=new Xt;if(a.Image){var r=new Image;r.onload=_(wn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=_(wn,n,r,"TestLoadImage: error",!1,e),r.onabort=_(wn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=_(wn,n,r,"TestLoadImage: timeout",!1,e),a.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else $t(2);t.u=0,t.c&&t.c.ta(e),Qn(t),Fn(t)}function Qn(t){t.u=0,t.m=-1,t.c&&(0==yn(t.b).length&&0==t.f.length||(t.b.c.length=0,S(t.f),t.f.length=0),t.c.sa())}function Jn(t,e,n){var r=function(t){return t instanceof De?Ne(t):new De(t,void 0)}(n);if(""!=r.b)e&&Me(r,e+"."+r.b),Le(r,r.i);else{var i=a.location;r=function(t,e,n,r){var i=new De(null,void 0);return t&&Re(i,t),e&&Me(i,e),n&&Le(i,n),r&&(i.a=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&M(t.V,(function(t,e){Fe(r,e,t)})),n=t.I,(e=t.j)&&n&&Fe(r,e,n),Fe(r,"VER",t.wa),qn(t,r),r}function Zn(){}function $n(){if(G&&!(10<=Number(Z)))throw Error("Environmental error: no available transport.")}function tr(t,e){Ct.call(this),this.a=new Ln(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!A(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!A(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new rr(this)}function er(t){ue.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function nr(){ce.call(this),this.status=1}function rr(t){this.a=t}(r=xn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:ae),this.a.onreadystatechange=b(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(o){return void An(this,o)}t=n||"";var i=new Se(this.headers);r&&ke(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=Sn,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:s(t)?t.charAt(e):t[e]}(i.K()),n=a.FormData&&t instanceof a.FormData,!(0<=T(kn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Dn(this),0<this.o&&((this.D=function(t){return G&&tt(9)&&u(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=b(this.Ba,this)):this.m=jt(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){An(this,o)}},r.Ba=function(){void 0!==o&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},r.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Pn(this))},r.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Pn(this,!0)),xn.N.G.call(this)},r.Ea=function(){this.j||(this.w||this.l||this.g?On(this):this.Za())},r.Za=function(){On(this)},r.T=function(){try{return 2<Nn(this)?this.a.status:-1}catch(j){return-1}},r.aa=function(){try{return this.a?this.a.responseText:""}catch(j){return""}},r.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),En(e)}},r.ya=function(){return this.h},r.Xa=function(){return s(this.f)?this.f:String(this.f)},(r=Ln.prototype).wa=8,r.u=1,r.Ca=function(){return 0==this.u},r.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new he(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?F(r=L(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&s(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Gn(this,n,e),Fe(i=Ne(this.B),"RID",t),Fe(i,"CVER",22),this.o&&this.j&&Fe(i,"X-HTTP-Session-Id",this.j),qn(this,i),this.g&&r&&Mn(i,this.g,r),vn(this.b,n),this.W?(Fe(i,"$req",e),Fe(i,"SID","null"),n.S=!0,ve(n,i,null)):ve(n,i,e),this.u=2}}else 3==this.u&&(t?jn(this,t):0==this.f.length||fn(this.b)||jn(this))},r.Ga=function(){this.l=null,this.a=new he(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=Ne(this.pa);Fe(t,"RID","rpc"),Fe(t,"SID",this.H),Fe(t,"CI",this.ia?"0":"1"),Fe(t,"AID",this.O),qn(this,t),Fe(t,"TYPE","xmlhttp"),this.g&&this.i&&Mn(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),me(this.a,t,!0,this.ga)},r.Fa=function(t,e){if(0!=this.u&&(this.a==t||pn(this.b,t)))if(this.m=t.o,!t.s&&pn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(o){n=null}if(f(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Kn(this),this.a.cancel(),this.a=null}Hn(this),$t(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=ee(b(this.Ya,this),6e3));if(1>=dn(this.b)&&this.fa){try{this.fa()}catch(o){}this.fa=void 0}}else Yn(this,11)}else if((t.s||this.a==t)&&Kn(this),!A(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&u(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=Rn(r,"X-Client-Wire-Protocol"))&&hn(this.b,i),this.j&&(r=Rn(r,"X-HTTP-Session-Id")))&&(this.I=r,Fe(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Jn(this,this.Y()?this.ga:null,this.ha),r.s?(mn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Ee(r),_e(r)),this.a=r):zn(this),0<this.f.length&&Vn(this)}else"stop"!=r[0]&&"close"!=r[0]||Yn(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Yn(this,7):Bn(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},r.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Hn(this),$t(19))},r.na=function(t){var e=null;if(this.a==t){Kn(this),this.a=null;var n=2}else{if(!pn(this.b,t))return;e=t.j,mn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=w()-t.v,Yt.dispatchEvent(new te(Yt,t.l?t.l.length:0,e,this.A)),Vn(this)):zn(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(dn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa)||(t.h=ee(b(t.Ha,t,e),Xn(t,t.A)),t.A++,0)))}(this,t)||2==n&&Hn(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Yn(this,5);break;case 4:Yn(this,10);break;case 3:Yn(this,6);break;default:Yn(this,2)}}},r.eb=function(t){$t(t?2:1)},r.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new xn(this.Ka)).F=this.R,t},r.ma=function(){return!!this.c&&!0},r.Y=function(){return this.R},(r=Zn.prototype).va=function(){},r.ua=function(){},r.ta=function(){},r.sa=function(){},r.Sa=function(){},$n.prototype.a=function(t,e){return new tr(t,e)},E(tr,Ct),(r=tr.prototype).addEventListener=function(t,e,n,r){tr.N.addEventListener.call(this,t,e,n,r)},r.removeEventListener=function(t,e,n,r){tr.N.removeEventListener.call(this,t,e,n,r)},r.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;$t(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new nn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Mn(e,t.g,t.i)),(t=t.w).i=n,e=Jn(t.a,null,t.i),$t(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,rn(t)):(Ue(e,"MODE","init"),!t.a.o&&t.a.j&&Ue(e,"X-HTTP-Session-Id",t.a.j),t.b=new he(t,void 0,void 0),t.b.h=t.h,me(t.b,e,!1,null),t.M=0)},r.close=function(){Bn(this.a)},r.Wa=function(t){if(s(t)){var e={};e.__data__=t,Un(this.a,e)}else this.h?((e={}).__data__=St(t),Un(this.a,e)):Un(this.a,t)},r.G=function(){this.a.c=null,delete this.f,Bn(this.a),delete this.a,tr.N.G.call(this)},E(er,ue),E(nr,ce),E(rr,Zn),rr.prototype.va=function(){this.a.dispatchEvent("a")},rr.prototype.ua=function(t){this.a.dispatchEvent(new er(t))},rr.prototype.ta=function(t){this.a.dispatchEvent(new nr(t))},rr.prototype.sa=function(){this.a.dispatchEvent("b")};var ir=_((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),$n);$n.prototype.createWebChannel=$n.prototype.a,tr.prototype.send=tr.prototype.Wa,tr.prototype.open=tr.prototype.Va,tr.prototype.close=tr.prototype.close,ne.NO_ERROR=0,ne.TIMEOUT=8,ne.HTTP_ERROR=6,re.COMPLETE="complete",oe.EventType=se,se.OPEN="a",se.CLOSE="b",se.ERROR="c",se.MESSAGE="d",Ct.prototype.listen=Ct.prototype.za,xn.prototype.listenOnce=xn.prototype.Aa,xn.prototype.getLastError=xn.prototype.Xa,xn.prototype.getLastErrorCode=xn.prototype.ya,xn.prototype.getStatus=xn.prototype.T,xn.prototype.getResponseJson=xn.prototype.Ua,xn.prototype.getResponseText=xn.prototype.aa,xn.prototype.send=xn.prototype.ca;var or={createWebChannelTransport:ir,ErrorCode:ne,EventType:re,WebChannel:oe,XhrIo:xn},ar=or.createWebChannelTransport,sr=or.ErrorCode,ur=or.EventType,cr=or.WebChannel,lr=or.XhrIo;e.default=or},xk4V:function(t,e,n){var r=n("4fRq"),i=n("I2ZF");t.exports=function(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[o+s]=a[s];return e||i(a)}},yBzR:function(t,e,n){t.exports=i;var r=n("JtD1");function i(t){this.from=(t=t||{}).from?r.fromValues(t.from[0],t.from[1]):r.create(),this.to=t.to?r.fromValues(t.to[0],t.to[1]):r.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:i.ANY,this.callback=t.callback||function(t){},this.direction=r.create(),this.length=1,this.update()}n("Dp7I"),n("rCTz"),n("BcWo"),i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4,i.prototype.update=function(){var t=this.direction;r.sub(t,this.to,this.from),this.length=r.length(t),r.normalize(t,t)},i.prototype.intersectBodies=function(t,e){for(var n=0,r=e.length;!t.shouldStop(this)&&n<r;n++){var i=e[n],o=i.getAABB();(o.overlapsRay(this)>=0||o.containsPoint(this.from))&&this.intersectBody(t,i)}};var o=r.create();i.prototype.intersectBody=function(t,e){var n=this.checkCollisionResponse;if(!n||e.collisionResponse)for(var i=o,a=0,s=e.shapes.length;a<s;a++){var u=e.shapes[a];if((!n||u.collisionResponse)&&0!=(this.collisionGroup&u.collisionMask)&&0!=(u.collisionGroup&this.collisionMask)&&(r.rotate(i,u.position,e.angle),r.add(i,i,e.position),this.intersectShape(t,u,u.angle+e.angle,i,e),t.shouldStop(this)))break}},i.prototype.intersectShape=function(t,e,n,i,o){(function(t,e,n){r.sub(a,n,t);var i=r.dot(a,e);return r.scale(s,e,i),r.add(s,s,t),r.squaredDistance(n,s)})(this.from,this.direction,i)>e.boundingRadius*e.boundingRadius||(this._currentBody=o,this._currentShape=e,e.raycast(t,this,i,n),this._currentBody=this._currentShape=null)},i.prototype.getAABB=function(t){var e=this.to,n=this.from;r.set(t.lowerBound,Math.min(e[0],n[0]),Math.min(e[1],n[1])),r.set(t.upperBound,Math.max(e[0],n[0]),Math.max(e[1],n[1]))},r.create(),i.prototype.reportIntersection=function(t,e,n,o){var a=this._currentShape,s=this._currentBody;if(!(this.skipBackfaces&&r.dot(n,this.direction)>0))switch(this.mode){case i.ALL:t.set(n,a,s,e,o),this.callback(t);break;case i.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(n,a,s,e,o);break;case i.ANY:t.set(n,a,s,e,o)}};var a=r.create(),s=r.create()},yqpj:function(t,e,n){var r=n("JtD1"),i=n("+1EK");function o(t,e,n){i.call(this,t,e,-n,n),this.contactPointA=r.create(),this.contactPointB=r.create(),this.t=r.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}n("Wk7T"),t.exports=o,(o.prototype=new i).constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,n){var i=this.contactPointA,o=this.contactPointB,a=this.t,s=this.G;return s[0]=-a[0],s[1]=-a[1],s[2]=-r.crossLength(i,a),s[3]=a[0],s[4]=a[1],s[5]=r.crossLength(o,a),-this.computeGW()*e-n*this.computeGiMf()}},zUnb:function(t,e,n){"use strict";var r,i,o=regeneratorRuntime.mark(nd),a=regeneratorRuntime.mark(ad),s=regeneratorRuntime.mark(cd),u=regeneratorRuntime.mark(dd),c=regeneratorRuntime.mark(Xv),l=regeneratorRuntime.mark(PE),h=regeneratorRuntime.mark(DE),f=regeneratorRuntime.mark(NE),d=regeneratorRuntime.mark(RE),p=regeneratorRuntime.mark(HE),v=regeneratorRuntime.mark(WE),m=regeneratorRuntime.mark(KE),y=regeneratorRuntime.mark(XE),g=regeneratorRuntime.mark(QE),b=regeneratorRuntime.mark(JE),_=regeneratorRuntime.mark(ZE),w=regeneratorRuntime.mark($E),E=regeneratorRuntime.mark(tx),x=regeneratorRuntime.mark(ex),T=regeneratorRuntime.mark(nx),C=regeneratorRuntime.mark(rx),k=regeneratorRuntime.mark(mx),S=regeneratorRuntime.mark(xx),A=regeneratorRuntime.mark(Sx),I=regeneratorRuntime.mark(Ix),O=regeneratorRuntime.mark(Ox),P=regeneratorRuntime.mark(Px),D=regeneratorRuntime.mark(zx),N=regeneratorRuntime.mark(Hx),R=regeneratorRuntime.mark(Wx),M=regeneratorRuntime.mark(Xx),L=regeneratorRuntime.mark(Yx),B=regeneratorRuntime.mark(Jx),F=regeneratorRuntime.mark(Zx),U=regeneratorRuntime.mark($x),V=regeneratorRuntime.mark(tT),j=regeneratorRuntime.mark(eT),q=regeneratorRuntime.mark(nT),G=regeneratorRuntime.mark(rT),z=regeneratorRuntime.mark(lT),H=regeneratorRuntime.mark(dT);function W(t){return"function"==typeof t}n.r(e);var K=!1,X={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else K&&console.log("RxJS: Back to a better error behavior. Thank you. <3");K=t},get useDeprecatedSynchronousErrorHandling(){return K}};function Y(t){setTimeout((function(){throw t}),0)}var Q={closed:!0,next:function(t){},error:function(t){if(X.useDeprecatedSynchronousErrorHandling)throw t;Y(t)},complete:function(){}},J=Array.isArray||function(t){return t&&"number"==typeof t.length};function Z(t){return null!==t&&"object"==typeof t}var $,tt=function(){function t(t){return Error.call(this),this.message=t?"".concat(t.length," errors occurred during unsubscription:\n").concat(t.map((function(t,e){return"".concat(e+1,") ").concat(t.toString())})).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),et=(($=function(){function t(e){_classCallCheck2(this,t),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return _createClass2(t,[{key:"unsubscribe",value:function(){var e;if(!this.closed){var n=this._parentOrParents,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var o=0;o<n.length;++o)n[o].remove(this);if(W(r))try{r.call(this)}catch(c){e=c instanceof tt?nt(c.errors):[c]}if(J(i))for(var a=-1,s=i.length;++a<s;){var u=i[a];if(Z(u))try{u.unsubscribe()}catch(c){e=e||[],c instanceof tt?e=e.concat(nt(c.errors)):e.push(c)}}if(e)throw new tt(e)}}},{key:"add",value:function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n}},{key:"remove",value:function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}]),t}()).EMPTY=function(t){return t.closed=!0,t}(new $),$);function nt(t){return t.reduce((function(t,e){return t.concat(e instanceof tt?e.errors:e)}),[])}var rt="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),it=function(t){function e(t,n,r){var i;switch(_classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=Q;break;case 1:if(!t){i.destination=Q;break}if("object"==typeof t){t instanceof e?(i.syncErrorThrowable=t.syncErrorThrowable,i.destination=t,t.add(_assertThisInitialized(i))):(i.syncErrorThrowable=!0,i.destination=new ot(_assertThisInitialized(i),t));break}default:i.syncErrorThrowable=!0,i.destination=new ot(_assertThisInitialized(i),t,n,r)}return i}return _inherits(e,t),_createClass2(e,[{key:rt,value:function(){return this}},{key:"next",value:function(t){this.isStopped||this._next(t)}},{key:"error",value:function(t){this.isStopped||(this.isStopped=!0,this._error(t))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(e.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(t){this.destination.next(t)}},{key:"_error",value:function(t){this.destination.error(t),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}],[{key:"create",value:function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i}}]),e}(et),ot=function(t){function e(t,n,r,i){var o,a;_classCallCheck2(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._parentSubscriber=t;var s=_assertThisInitialized(o);return W(n)?a=n:n&&(a=n.next,r=n.error,i=n.complete,n!==Q&&(W((s=Object.create(n)).unsubscribe)&&o.add(s.unsubscribe.bind(s)),s.unsubscribe=o.unsubscribe.bind(_assertThisInitialized(o)))),o._context=s,o._next=a,o._error=r,o._complete=i,o}return _inherits(e,t),_createClass2(e,[{key:"next",value:function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;X.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}},{key:"error",value:function(t){if(!this.isStopped){var e=this._parentSubscriber,n=X.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Y(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Y(t)}}}},{key:"complete",value:function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};X.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),X.useDeprecatedSynchronousErrorHandling)throw n;Y(n)}}},{key:"__tryOrSetError",value:function(t,e,n){if(!X.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return X.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(Y(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}]),e}(it),at="function"==typeof Symbol&&Symbol.observable||"@@observable";function st(){}var ut,ct=((ut=function(){function t(e){_classCallCheck2(this,t),this._isScalar=!1,e&&(this._subscribe=e)}return _createClass2(t,[{key:"lift",value:function(e){var n=new t;return n.source=this,n.operator=e,n}},{key:"subscribe",value:function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof it)return t;if(t[rt])return t[rt]()}return t||e||n?new it(t,e,n):new it(Q)}(t,e,n);if(i.add(r?r.call(i,this.source):this.source||X.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),X.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}},{key:"_trySubscribe",value:function(t){try{return this._subscribe(t)}catch(e){X.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof it?r:null}return!0}(t)?t.error(e):console.warn(e)}}},{key:"forEach",value:function(t,e){var n=this;return new(e=lt(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(n){r(n),i&&i.unsubscribe()}}),r,e)}))}},{key:"_subscribe",value:function(t){var e=this.source;return e&&e.subscribe(t)}},{key:at,value:function(){return this}},{key:"pipe",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?this:((r=e)?1===r.length?r[0]:function(t){return r.reduce((function(t,e){return e(t)}),t)}:st)(this);var r}},{key:"toPromise",value:function(t){var e=this;return new(t=lt(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))}}]),t}()).create=function(t){return new ut(t)},ut);function lt(t){if(t||(t=X.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var ht,ft=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),dt=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).subject=t,r.subscriber=n,r.closed=!1,r}return _inherits(e,t),_createClass2(e,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}}}]),e}(et),pt=function(t){function e(t){var n;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).destination=t,n}return _inherits(e,t),e}(it),vt=((ht=function(t){function e(){var t;return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return _inherits(e,t),_createClass2(e,[{key:rt,value:function(){return new pt(this)}},{key:"lift",value:function(t){var e=new mt(this,this);return e.operator=t,e}},{key:"next",value:function(t){if(this.closed)throw new ft;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)}},{key:"error",value:function(t){if(this.closed)throw new ft;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new ft;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(t){if(this.closed)throw new ft;return _get(_getPrototypeOf(e.prototype),"_trySubscribe",this).call(this,t)}},{key:"_subscribe",value:function(t){if(this.closed)throw new ft;return this.hasError?(t.error(this.thrownError),et.EMPTY):this.isStopped?(t.complete(),et.EMPTY):(this.observers.push(t),new dt(this,t))}},{key:"asObservable",value:function(){var t=new ct;return t.source=this,t}}]),e}(ct)).create=function(t,e){return new mt(t,e)},ht),mt=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).destination=t,r.source=n,r}return _inherits(e,t),_createClass2(e,[{key:"next",value:function(t){var e=this.destination;e&&e.next&&e.next(t)}},{key:"error",value:function(t){var e=this.destination;e&&e.error&&this.destination.error(t)}},{key:"complete",value:function(){var t=this.destination;t&&t.complete&&this.destination.complete()}},{key:"_subscribe",value:function(t){return this.source?this.source.subscribe(t):et.EMPTY}}]),e}(vt);function yt(t){return t&&"function"==typeof t.schedule}var gt=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}},{key:"_error",value:function(t){this.parent.notifyError(t,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),e}(it),bt=function(t){return function(e){for(var n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}};var _t="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",wt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Et(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var xt=function(t){if(t&&"function"==typeof t[at])return e=t,function(t){var n=e[at]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)};var e,n,r;if(wt(t))return bt(t);if(Et(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Y),t};if(t&&"function"==typeof t[_t])return r=t,function(t){for(var e=r[_t]();;){var n=e.next();if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof e.return&&t.add((function(){e.return&&e.return()})),t};var i=Z(t)?"an invalid object":"'".concat(t,"'");throw new TypeError("You provided ".concat(i," where a stream was expected.")+" You can provide an Observable, Promise, Array, or Iterable.")};function Tt(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new gt(t,n,r);if(!i.closed)return e instanceof ct?e.subscribe(i):xt(e)(i)}var Ct=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"notifyNext",value:function(t,e,n,r,i){this.destination.next(e)}},{key:"notifyError",value:function(t,e){this.destination.error(t)}},{key:"notifyComplete",value:function(t){this.destination.complete()}}]),e}(it);function kt(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new St(t,e))}}var St=function(){function t(e,n){_classCallCheck2(this,t),this.project=e,this.thisArg=n}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new At(t,this.project,this.thisArg))}}]),t}(),At=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).project=n,i.count=0,i.thisArg=r||_assertThisInitialized(i),i}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}]),e}(it);function It(t,e){return new ct((function(n){var r=new et,i=0;return r.add(e.schedule((function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function Ot(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[at]}(t))return function(t,e){return new ct((function(n){var r=new et;return r.add(e.schedule((function(){var i=t[at]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if(Et(t))return function(t,e){return new ct((function(n){var r=new et;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if(wt(t))return It(t,e);if(function(t){return t&&"function"==typeof t[_t]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new ct((function(n){var r,i=new et;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(e.schedule((function(){r=t[_t](),i.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(o){return void n.error(o)}e?n.complete():(n.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof ct?t:new ct(xt(t))}function Pt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof e?function(r){return r.pipe(Pt((function(n,r){return Ot(t(n,r)).pipe(kt((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new Dt(t,n))})}var Dt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck2(this,t),this.project=e,this.concurrent=n}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new Nt(t,this.project,this.concurrent))}}]),t}(),Nt=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}},{key:"_tryNext",value:function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,n)}},{key:"_innerSub",value:function(t,e,n){var r=new gt(this,e,n),i=this.destination;i.add(r);var o=Tt(this,t,void 0,void 0,r);o!==r&&i.add(o)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(t,e,n,r,i){this.destination.next(e)}},{key:"notifyComplete",value:function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),e}(Ct);function Rt(t){return t}function Mt(){return Pt(Rt,arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY)}function Lt(t,e){return e?It(t,e):new ct(bt(t))}function Bt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=Number.POSITIVE_INFINITY,i=null,o=e[e.length-1];return yt(o)?(i=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(r=e.pop())):"number"==typeof o&&(r=e.pop()),null===i&&1===e.length&&e[0]instanceof ct?e[0]:Mt(r)(Lt(e,i))}function Ft(){return function(t){return t.lift(new Vt(t))}}var Ut,Vt=function(){function t(e){_classCallCheck2(this,t),this.connectable=e}return _createClass2(t,[{key:"call",value:function(t,e){var n=this.connectable;n._refCount++;var r=new jt(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i}}]),t}(),jt=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).connectable=n,r}return _inherits(e,t),_createClass2(e,[{key:"_unsubscribe",value:function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}]),e}(it),qt={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(Ut=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return _inherits(e,t),_createClass2(e,[{key:"_subscribe",value:function(t){return this.getSubject().subscribe(t)}},{key:"getSubject",value:function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new et).add(this.source.subscribe(new Gt(this.getSubject(),this))),t.closed&&(this._connection=null,t=et.EMPTY)),t}},{key:"refCount",value:function(){return Ft()(this)}}]),e}(ct).prototype)._subscribe},_isComplete:{value:Ut._isComplete,writable:!0},getSubject:{value:Ut.getSubject},connect:{value:Ut.connect},refCount:{value:Ut.refCount}},Gt=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).connectable=n,r}return _inherits(e,t),_createClass2(e,[{key:"_error",value:function(t){this._unsubscribe(),_get(_getPrototypeOf(e.prototype),"_error",this).call(this,t)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(e.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}]),e}(pt);function zt(t,e){return function(n){var r;if(r="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new Ht(r,e));var i=Object.create(n,qt);return i.source=n,i.subjectFactory=r,i}}var Ht=function(){function t(e,n){_classCallCheck2(this,t),this.subjectFactory=e,this.selector=n}return _createClass2(t,[{key:"call",value:function(t,e){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(t);return i.add(e.subscribe(r)),i}}]),t}();function Wt(){return new vt}var Kt="__parameters__";function Xt(t,e,n){var r=function(t){return function(){if(t){var e=t.apply(void 0,arguments);for(var n in e)this[n]=e[n]}}}(e);function i(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(this instanceof i)return r.apply(this,e),this;var o=_construct(i,e);return a.annotation=o,a;function a(t,e,n){for(var r=t.hasOwnProperty(Kt)?t[Kt]:Object.defineProperty(t,Kt,{value:[]})[Kt];r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(o),t}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i}var Yt=Xt("Inject",(function(t){return{token:t}})),Qt=Xt("Optional"),Jt=Xt("Self"),Zt=Xt("SkipSelf"),$t=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});function te(t){for(var e in t)if(t[e]===te)return e;throw Error("Could not find renamed property on target object.")}function ee(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function ne(t){var e=t[re];return e&&e.token===t?e:null}var re=te({ngInjectableDef:te});function ie(t){if("string"==typeof t)return t;if(t instanceof Array)return"["+t.map(ie).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return"".concat(t.overriddenName);if(t.name)return"".concat(t.name);var e=t.toString();if(null==e)return""+e;var n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}var oe=te({__forward_ref__:te});function ae(t){return t.__forward_ref__=ae,t.toString=function(){return ie(this())},t}function se(t){var e=t;return"function"==typeof e&&e.hasOwnProperty(oe)&&e.__forward_ref__===ae?e():t}var ue="undefined"!=typeof globalThis&&globalThis,ce="undefined"!=typeof window&&window,le="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,he="undefined"!=typeof global&&global,fe=ue||he||ce||le,de=function(){function t(e,n){_classCallCheck2(this,t),this._desc=e,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.ngInjectableDef=ee({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return _createClass2(t,[{key:"toString",value:function(){return"InjectionToken ".concat(this._desc)}}]),t}(),pe=new de("INJECTOR",-1),ve=new Object,me=/\n/gm,ye="\u0275",ge="__source",be=te({provide:String,useValue:te}),_e=void 0;function we(t){var e=_e;return _e=t,e}function Ee(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$t.Default;if(void 0===_e)throw new Error("inject() must be called from an injection context");return null===_e?function(t,e,n){var r=ne(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&$t.Optional)return null;throw new Error("Injector: NOT_FOUND [".concat(ie(t),"]"))}(t,0,e):_e.get(t,e&$t.Optional?null:void 0,e)}var xe=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve;if(e===ve){var n=new Error("NullInjectorError: No provider for ".concat(ie(t),"!"));throw n.name="NullInjectorError",n}return e}}]),t}();function Te(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;t=t&&"\n"===t.charAt(0)&&t.charAt(1)==ye?t.substr(2):t;var i=ie(e);if(e instanceof Array)i=e.map(ie).join(" -> ");else if("object"==typeof e){var o=[];for(var a in e)if(e.hasOwnProperty(a)){var s=e[a];o.push(a+":"+("string"==typeof s?JSON.stringify(s):ie(s)))}i="{".concat(o.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(i,"]: ").concat(t.replace(me,"\n  "))}var Ce=function t(){_classCallCheck2(this,t)},ke=function t(){_classCallCheck2(this,t)};function Se(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Ae(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}var Ie=function(){var t={Emulated:0,Native:1,None:2,ShadowDom:3};return t[t.Emulated]="Emulated",t[t.Native]="Native",t[t.None]="None",t[t.ShadowDom]="ShadowDom",t}(),Oe=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(fe),Pe="ngDebugContext",De="ngOriginalError",Ne="ngErrorLogger";function Re(t){return t[Pe]}function Me(t){return t[De]}function Le(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];t.error.apply(t,n)}var Be=function(){function t(){_classCallCheck2(this,t),this._console=console}return _createClass2(t,[{key:"handleError",value:function(t){var e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t[Ne]||Le}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(t){return t?Re(t)?Re(t):this._findContext(Me(t)):null}},{key:"_findOriginalError",value:function(t){for(var e=Me(t);e&&Me(e);)e=Me(e);return e}}]),t}(),Fe=!0,Ue=!1;function Ve(){return Ue=!0,Fe}var je=function(){function t(e){if(_classCallCheck2(this,t),this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n),this.inertBodyElement=this.inertDocument.createElement("body"),n.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(t){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return _createClass2(t,[{key:"getInertBodyElement_XHR",value:function(t){t="<body><remove></remove>"+t+"</body>";try{t=encodeURI(t)}catch(r){return null}var e=new XMLHttpRequest;e.responseType="document",e.open("GET","data:text/html;charset=utf-8,"+t,!1),e.send(void 0);var n=e.response.body;return n.removeChild(n.firstChild),n}},{key:"getInertBodyElement_DOMParser",value:function(t){t="<body><remove></remove>"+t+"</body>";try{var e=(new window.DOMParser).parseFromString(t,"text/html").body;return e.removeChild(e.firstChild),e}catch(n){return null}}},{key:"getInertBodyElement_InertDocument",value:function(t){var e=this.inertDocument.createElement("template");return"content"in e?(e.innerHTML=t,e):(this.inertBodyElement.innerHTML=t,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}},{key:"stripCustomNsAttrs",value:function(t){for(var e=t.attributes,n=e.length-1;0<n;n--){var r=e.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||t.removeAttribute(r)}for(var i=t.firstChild;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}]),t}(),qe=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,Ge=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function ze(t){return(t=String(t)).match(qe)||t.match(Ge)?t:(Ve()&&console.warn("WARNING: sanitizing unsafe URL value ".concat(t," (see http://g.co/ng/security#xss)")),"unsafe:"+t)}function He(t){var e={},n=!0,r=!1,i=void 0;try{for(var o,a=t.split(",")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){e[o.value]=!0}}catch(s){r=!0,i=s}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return e}function We(){for(var t={},e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)a.hasOwnProperty(s)&&(t[s]=!0)}return t}var Ke,Xe=He("area,br,col,hr,img,wbr"),Ye=He("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Qe=He("rp,rt"),Je=We(Qe,Ye),Ze=We(Xe,We(Ye,He("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),We(Qe,He("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Je),$e=He("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),tn=He("srcset"),en=We($e,tn,He("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),He("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),nn=He("script,style,template"),rn=function(){function t(){_classCallCheck2(this,t),this.sanitizedSomething=!1,this.buf=[]}return _createClass2(t,[{key:"sanitizeChildren",value:function(t){for(var e=t.firstChild,n=!0;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);var r=this.checkClobberedElement(e,e.nextSibling);if(r){e=r;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(t){var e=t.nodeName.toLowerCase();if(!Ze.hasOwnProperty(e))return this.sanitizedSomething=!0,!nn.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);for(var n,r=t.attributes,i=0;i<r.length;i++){var o=r.item(i),a=o.name,s=a.toLowerCase();if(en.hasOwnProperty(s)){var u=o.value;$e[s]&&(u=ze(u)),tn[s]&&(n=u,u=(n=String(n)).split(",").map((function(t){return ze(t.trim())})).join(", ")),this.buf.push(" ",a,'="',sn(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(t){var e=t.nodeName.toLowerCase();Ze.hasOwnProperty(e)&&!Xe.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}},{key:"chars",value:function(t){this.buf.push(sn(t))}},{key:"checkClobberedElement",value:function(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: ".concat(t.outerHTML));return e}}]),t}(),on=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,an=/([^\#-~ |!])/g;function sn(t){return t.replace(/&/g,"&amp;").replace(on,(function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"})).replace(an,(function(t){return"&#"+t.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function un(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var cn=function(){var t={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return t[t.NONE]="NONE",t[t.HTML]="HTML",t[t.STYLE]="STYLE",t[t.SCRIPT]="SCRIPT",t[t.URL]="URL",t[t.RESOURCE_URL]="RESOURCE_URL",t}(),ln=function t(){_classCallCheck2(this,t)},hn=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|Z|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),fn=/^url\(([^)]+)\)$/,dn=/([A-Z])/g;function pn(t){try{return null!=t?t.toString().slice(0,30):t}catch(e){return"[ERROR] Exception while trying to serialize the value"}}var vn=function(){var t=function t(){_classCallCheck2(this,t)};return t.__NG_ELEMENT_ID__=function(){return mn()},t}(),mn=function(){},yn=new de("The presence of this token marks an injector as being the root injector."),gn=function(t,e,n){return new Tn(t,e,n)},bn=function(){var t=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,null,[{key:"create",value:function(t,e){return Array.isArray(t)?gn(t,e,""):gn(t.providers,t.parent,t.name||"")}}]),t}();return t.THROW_IF_NOT_FOUND=ve,t.NULL=new xe,t.ngInjectableDef=ee({token:t,providedIn:"any",factory:function(){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$t.Default;return Ee(t,e)}(pe)}}),t.__NG_ELEMENT_ID__=-1,t}(),_n=function(t){return t},wn=[],En=_n,xn=function(){return Array.prototype.slice.call(arguments)},Tn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bn.NULL,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck2(this,t),this.parent=n,this.source=r;var i=this._records=new Map;i.set(bn,{token:bn,fn:_n,deps:wn,value:this,useNew:!1}),i.set(pe,{token:pe,fn:_n,deps:wn,value:this,useNew:!1}),function t(e,n){if(n)if((n=se(n))instanceof Array)for(var r=0;r<n.length;r++)t(e,n[r]);else{if("function"==typeof n)throw kn("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw kn("Unexpected provider",n);var i=se(n.provide),o=function(t){var e=function(t){var e=wn,n=t.deps;if(n&&n.length){e=[];for(var r=0;r<n.length;r++){var i=6,o=se(n[r]);if(o instanceof Array)for(var a=0,s=o;a<s.length;a++){var u=s[a];u instanceof Qt||u==Qt?i|=1:u instanceof Zt||u==Zt?i&=-3:u instanceof Jt||u==Jt?i&=-5:o=u instanceof Yt?u.token:se(u)}e.push({token:o,options:i})}}else if(t.useExisting)e=[{token:se(t.useExisting),options:6}];else if(!(n||be in t))throw kn("'deps' required",t);return e}(t),n=_n,r=wn,i=!1,o=se(t.provide);if(be in t)r=t.useValue;else if(t.useFactory)n=t.useFactory;else if(t.useExisting);else if(t.useClass)i=!0,n=se(t.useClass);else{if("function"!=typeof o)throw kn("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",t);i=!0,n=o}return{deps:e,fn:n,useNew:i,value:r}}(n);if(!0===n.multi){var a=e.get(i);if(a){if(a.fn!==xn)throw Cn(i)}else e.set(i,a={token:n.provide,deps:[],useNew:!1,fn:xn,value:wn});a.deps.push({token:i=n,options:6})}var s=e.get(i);if(s&&s.fn==xn)throw Cn(i);e.set(i,o)}}(i,e)}return _createClass2(t,[{key:"get",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$t.Default,r=this._records.get(t);try{return function t(e,n,r,i,o,a){try{return function(e,n,r,i,o,a){var s;if(!n||a&$t.SkipSelf)a&$t.Self||(s=i.get(e,o,$t.Default));else{if((s=n.value)==En)throw Error("\u0275Circular dependency");if(s===wn){n.value=En;var u=n.useNew,c=n.fn,l=n.deps,h=wn;if(l.length){h=[];for(var f=0;f<l.length;f++){var d=l[f],p=d.options,v=2&p?r.get(d.token):void 0;h.push(t(d.token,v,r,v||4&p?i:bn.NULL,1&p?null:bn.THROW_IF_NOT_FOUND,$t.Default))}}n.value=s=u?_construct(c,_toConsumableArray(h)):c.apply(void 0,h)}}return s}(e,n,r,i,o,a)}catch(s){throw s instanceof Error||(s=new Error(s)),(s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(e),n&&n.value==En&&(n.value=wn),s}}(t,r,this._records,this.parent,e,n)}catch(i){return function(t,e,n,r){var i=t.ngTempTokenPath;throw e[ge]&&i.unshift(e[ge]),t.message=Te("\n"+t.message,i,"StaticInjectorError",r),t.ngTokenPath=i,t.ngTempTokenPath=null,t}(i,t,0,this.source)}}},{key:"toString",value:function(){var t=[];return this._records.forEach((function(e,n){return t.push(ie(n))})),"StaticInjector[".concat(t.join(", "),"]")}}]),t}();function Cn(t){return kn("Cannot mix multi providers and regular providers",t)}function kn(t,e){return new Error(Te(t,e,"StaticInjectorError"))}var Sn=null;function An(){if(!Sn){var t=fe.Symbol;if(t&&t.iterator)Sn=t.iterator;else for(var e=Object.getOwnPropertyNames(Map.prototype),n=0;n<e.length;++n){var r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Sn=r)}}return Sn}function In(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)}function On(t,e){var n=Dn(t),r=Dn(e);return n&&r?function(t,e,n){for(var r=t[An()](),i=e[An()]();;){var o=r.next(),a=i.next();if(o.done&&a.done)return!0;if(o.done||a.done)return!1;if(!n(o.value,a.value))return!1}}(t,e,On):!(n||!(t&&("object"==typeof t||"function"==typeof t))||r||!(e&&("object"==typeof e||"function"==typeof e)))||In(t,e)}var Pn=function(){function t(e){_classCallCheck2(this,t),this.wrapped=e}return _createClass2(t,null,[{key:"wrap",value:function(e){return new t(e)}},{key:"unwrap",value:function(e){return t.isWrapped(e)?e.wrapped:e}},{key:"isWrapped",value:function(e){return e instanceof t}}]),t}();function Dn(t){return!!Nn(t)&&(Array.isArray(t)||!(t instanceof Map)&&An()in t)}function Nn(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Rn(t){return!!t&&"function"==typeof t.then}function Mn(t){return!!t&&"function"==typeof t.subscribe}var Ln=function(){function t(e,n,r){_classCallCheck2(this,t),this.previousValue=e,this.currentValue=n,this.firstChange=r}return _createClass2(t,[{key:"isFirstChange",value:function(){return this.firstChange}}]),t}(),Bn=function t(){_classCallCheck2(this,t)},Fn=function t(){_classCallCheck2(this,t)};function Un(t){var e=Error("No component factory found for ".concat(ie(t),". Did you add it to @NgModule.entryComponents?"));return e[Vn]=t,e}var Vn="ngComponent",jn=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"resolveComponentFactory",value:function(t){throw Un(t)}}]),t}(),qn=function(){var t=function t(){_classCallCheck2(this,t)};return t.NULL=new jn,t}(),Gn=function(){function t(e,n,r){_classCallCheck2(this,t),this._parent=n,this._ngModule=r,this._factories=new Map;for(var i=0;i<e.length;i++){var o=e[i];this._factories.set(o.componentType,o)}}return _createClass2(t,[{key:"resolveComponentFactory",value:function(t){var e=this._factories.get(t);if(!e&&this._parent&&(e=this._parent.resolveComponentFactory(t)),!e)throw Un(t);return new zn(e,this._ngModule)}}]),t}(),zn=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).factory=t,r.ngModule=n,r.selector=t.selector,r.componentType=t.componentType,r.ngContentSelectors=t.ngContentSelectors,r.inputs=t.inputs,r.outputs=t.outputs,r}return _inherits(e,t),_createClass2(e,[{key:"create",value:function(t,e,n,r){return this.factory.create(t,e,n,r||this.ngModule)}}]),e}(Fn);function Hn(){}var Wn=function(){var t=function t(e){_classCallCheck2(this,t),this.nativeElement=e};return t.__NG_ELEMENT_ID__=function(){return Kn(t)},t}(),Kn=Hn,Xn=function t(){_classCallCheck2(this,t)},Yn=function(){var t={Important:1,DashCase:2};return t[t.Important]="Important",t[t.DashCase]="DashCase",t}(),Qn=function(){var t=function t(){_classCallCheck2(this,t)};return t.__NG_ELEMENT_ID__=function(){return Jn()},t}(),Jn=Hn,Zn=function t(e){_classCallCheck2(this,t),this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")},$n=new Zn("8.2.14"),tr=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"supports",value:function(t){return Dn(t)}},{key:"create",value:function(t){return new nr(t)}}]),t}(),er=function(t,e){return e},nr=function(){function t(e){_classCallCheck2(this,t),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||er}return _createClass2(t,[{key:"forEachItem",value:function(t){var e;for(e=this._itHead;null!==e;e=e._next)t(e)}},{key:"forEachOperation",value:function(t){for(var e=this._itHead,n=this._removalsHead,r=0,i=null;e||n;){var o=!n||e&&e.currentIndex<ar(n,r,i)?e:n,a=ar(o,r,i),s=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(e=e._next,null==o.previousIndex)r++;else{i||(i=[]);var u=a-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<i.length?i[l]:i[l]=0,f=h+l;c<=f&&f<u&&(i[l]=h+1)}i[o.previousIndex]=c-u}}a!==s&&t(o,a,s)}}},{key:"forEachPreviousItem",value:function(t){var e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}},{key:"forEachAddedItem",value:function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}},{key:"forEachMovedItem",value:function(t){var e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}},{key:"forEachRemovedItem",value:function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}},{key:"forEachIdentityChange",value:function(t){var e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}},{key:"diff",value:function(t){if(null==t&&(t=[]),!Dn(t))throw new Error("Error trying to diff '".concat(ie(t),"'. Only arrays and iterables are allowed"));return this.check(t)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(t){var e=this;this._reset();var n,r,i,o=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(var s=0;s<this.length;s++)i=this._trackByFn(s,r=t[s]),null!==o&&In(o.trackById,i)?(a&&(o=this._verifyReinsertion(o,r,i,s)),In(o.item,r)||this._addIdentityChange(o,r)):(o=this._mismatch(o,r,i,s),a=!0),o=o._next}else n=0,function(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e(t[n]);else for(var r,i=t[An()]();!(r=i.next()).done;)e(r.value)}(t,(function(t){i=e._trackByFn(n,t),null!==o&&In(o.trackById,i)?(a&&(o=e._verifyReinsertion(o,t,i,n)),In(o.item,t)||e._addIdentityChange(o,t)):(o=e._mismatch(o,t,i,n),a=!0),o=o._next,n++})),this.length=n;return this._truncate(o),this.collection=t,this.isDirty}},{key:"_reset",value:function(){if(this.isDirty){var t,e;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=e)t.previousIndex=t.currentIndex,e=t._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(t,e,n,r){var i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(In(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(In(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,r)):t=this._addAfter(new rr(e,n),i,r),t}},{key:"_verifyReinsertion",value:function(t,e,n,r){var i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?t=this._reinsertAfter(i,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}},{key:"_truncate",value:function(t){for(;null!==t;){var e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);var r=t._prevRemoved,i=t._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t}},{key:"_moveAfter",value:function(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t}},{key:"_addAfter",value:function(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}},{key:"_insertAfter",value:function(t,e,n){var r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new or),this._linkedRecords.put(t),t.currentIndex=n,t}},{key:"_remove",value:function(t){return this._addToRemovals(this._unlink(t))}},{key:"_unlink",value:function(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);var e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t}},{key:"_addToMoves",value:function(t,e){return t.previousIndex===e?t:(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t,t)}},{key:"_addToRemovals",value:function(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new or),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}},{key:"_addIdentityChange",value:function(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}}]),t}(),rr=function t(e,n){_classCallCheck2(this,t),this.item=e,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},ir=function(){function t(){_classCallCheck2(this,t),this._head=null,this._tail=null}return _createClass2(t,[{key:"add",value:function(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}},{key:"get",value:function(t,e){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&In(n.trackById,t))return n;return null}},{key:"remove",value:function(t){var e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}]),t}(),or=function(){function t(){_classCallCheck2(this,t),this.map=new Map}return _createClass2(t,[{key:"put",value:function(t){var e=t.trackById,n=this.map.get(e);n||(n=new ir,this.map.set(e,n)),n.add(t)}},{key:"get",value:function(t,e){var n=this.map.get(t);return n?n.get(t,e):null}},{key:"remove",value:function(t){var e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}},{key:"clear",value:function(){this.map.clear()}},{key:"isEmpty",get:function(){return 0===this.map.size}}]),t}();function ar(t,e,n){var r=t.previousIndex;if(null===r)return r;var i=0;return n&&r<n.length&&(i=n[r]),r+e+i}var sr=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"supports",value:function(t){return t instanceof Map||Nn(t)}},{key:"create",value:function(){return new ur}}]),t}(),ur=function(){function t(){_classCallCheck2(this,t),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass2(t,[{key:"forEachItem",value:function(t){var e;for(e=this._mapHead;null!==e;e=e._next)t(e)}},{key:"forEachPreviousItem",value:function(t){var e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}},{key:"forEachChangedItem",value:function(t){var e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}},{key:"forEachAddedItem",value:function(t){var e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}},{key:"forEachRemovedItem",value:function(t){var e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}},{key:"diff",value:function(t){if(t){if(!(t instanceof Map||Nn(t)))throw new Error("Error trying to diff '".concat(ie(t),"'. Only maps and objects are allowed"))}else t=new Map;return this.check(t)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(t){var e=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(function(t,r){if(n&&n.key===r)e._maybeAddToChanges(n,t),e._appendAfter=n,n=n._next;else{var i=e._getOrCreateRecordForKey(r,t);n=e._insertBeforeOrAppend(n,i)}})),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(t,e){if(t){var n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}},{key:"_getOrCreateRecordForKey",value:function(t,e){if(this._records.has(t)){var n=this._records.get(t);this._maybeAddToChanges(n,e);var r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}var o=new cr(t);return this._records.set(t,o),o.currentValue=e,this._addToAdditions(o),o}},{key:"_reset",value:function(){if(this.isDirty){var t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(t,e){In(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}},{key:"_addToAdditions",value:function(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}},{key:"_addToChanges",value:function(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}},{key:"_forEach",value:function(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach((function(n){return e(t[n],n)}))}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}}]),t}(),cr=function t(e){_classCallCheck2(this,t),this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},lr=function(){var t=function(){function t(e){_classCallCheck2(this,t),this.factories=e}return _createClass2(t,[{key:"find",value:function(t){var e,n=this.factories.find((function(e){return e.supports(t)}));if(null!=n)return n;throw new Error("Cannot find a differ supporting object '".concat(t,"' of type '").concat((e=t).name||typeof e,"'"))}}],[{key:"create",value:function(e,n){if(null!=n){var r=n.factories.slice();e=e.concat(r)}return new t(e)}},{key:"extend",value:function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return t.create(e,n)},deps:[[t,new Zt,new Qt]]}}}]),t}();return t.ngInjectableDef=ee({token:t,providedIn:"root",factory:function(){return new t([new tr])}}),t}(),hr=function(){var t=function(){function t(e){_classCallCheck2(this,t),this.factories=e}return _createClass2(t,[{key:"find",value:function(t){var e=this.factories.find((function(e){return e.supports(t)}));if(e)return e;throw new Error("Cannot find a differ supporting object '".concat(t,"'"))}}],[{key:"create",value:function(e,n){if(n){var r=n.factories.slice();e=e.concat(r)}return new t(e)}},{key:"extend",value:function(e){return{provide:t,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return t.create(e,n)},deps:[[t,new Zt,new Qt]]}}}]),t}();return t.ngInjectableDef=ee({token:t,providedIn:"root",factory:function(){return new t([new sr])}}),t}(),fr=[new sr],dr=new lr([new tr]),pr=new hr(fr),vr=function(){var t=function t(){_classCallCheck2(this,t)};return t.__NG_ELEMENT_ID__=function(){return mr(t,Wn)},t}(),mr=Hn,yr=function(){var t=function t(){_classCallCheck2(this,t)};return t.__NG_ELEMENT_ID__=function(){return gr(t,Wn)},t}(),gr=Hn;function br(t,e,n,r){var i="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '".concat(e,"'. Current value: '").concat(n,"'.");return r&&(i+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(t,e){var n=new Error(t);return _r(n,e),n}(i,t)}function _r(t,e){t[Pe]=e,t[Ne]=e.logError.bind(e)}function wr(t){return new Error("ViewDestroyedError: Attempt to use a destroyed view: ".concat(t))}function Er(t,e,n){var r=t.state,i=1792&r;return i===e?(t.state=-1793&r|n,t.initIndex=-1,!0):i===n}function xr(t,e,n){return(1792&t.state)===e&&t.initIndex<=n&&(t.initIndex=n+1,!0)}function Tr(t,e){return t.nodes[e]}function Cr(t,e){return t.nodes[e]}function kr(t,e){return t.nodes[e]}function Sr(t,e){return t.nodes[e]}function Ar(t,e){return t.nodes[e]}var Ir={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},Or=function(){},Pr=new Map;function Dr(t){var e=Pr.get(t);return e||(e=ie(t)+"_"+Pr.size,Pr.set(t,e)),e}function Nr(t,e,n,r){if(Pn.isWrapped(r)){r=Pn.unwrap(r);var i=t.def.nodes[e].bindingIndex+n,o=Pn.unwrap(t.oldValues[i]);t.oldValues[i]=new Pn(o)}return r}var Rr="$$undefined",Mr="$$empty";function Lr(t){return{id:Rr,styles:t.styles,encapsulation:t.encapsulation,data:t.data}}var Br=0;function Fr(t,e,n,r){return!(!(2&t.state)&&In(t.oldValues[e.bindingIndex+n],r))}function Ur(t,e,n,r){return!!Fr(t,e,n,r)&&(t.oldValues[e.bindingIndex+n]=r,!0)}function Vr(t,e,n,r){var i=t.oldValues[e.bindingIndex+n];if(1&t.state||!On(i,r)){var o=e.bindings[n].name;throw br(Ir.createDebugContext(t,e.nodeIndex),"".concat(o,": ").concat(i),"".concat(o,": ").concat(r),0!=(1&t.state))}}function jr(t){for(var e=t;e;)2&e.def.flags&&(e.state|=8),e=e.viewContainerParent||e.parent}function qr(t,e){for(var n=t;n&&n!==e;)n.state|=64,n=n.viewContainerParent||n.parent}function Gr(t,e,n,r){try{return jr(33554432&t.def.nodes[e].flags?Cr(t,e).componentView:t),Ir.handleEvent(t,e,n,r)}catch(i){t.root.errorHandler.handleError(i)}}function zr(t){return t.parent?Cr(t.parent,t.parentNodeDef.nodeIndex):null}function Hr(t){return t.parent?t.parentNodeDef.parent:null}function Wr(t,e){switch(201347067&e.flags){case 1:return Cr(t,e.nodeIndex).renderElement;case 2:return Tr(t,e.nodeIndex).renderText}}function Kr(t){return!!t.parent&&!!(32768&t.parentNodeDef.flags)}function Xr(t){return!(!t.parent||32768&t.parentNodeDef.flags)}function Yr(t){return 1<<t%32}function Qr(t){var e={},n=0,r={};return t&&t.forEach((function(t){var i=_slicedToArray(t,2),o=i[0],a=i[1];"number"==typeof o?(e[o]=a,n|=Yr(o)):r[o]=a})),{matchedQueries:e,references:r,matchedQueryIds:n}}function Jr(t,e){return t.map((function(t){var n,r,i;return Array.isArray(t)?(i=(n=_slicedToArray(t,2))[0],r=n[1]):(i=0,r=t),r&&("function"==typeof r||"object"==typeof r)&&e&&Object.defineProperty(r,ge,{value:e,configurable:!0}),{flags:i,token:r,tokenKey:Dr(r)}}))}function Zr(t,e,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===Ie.Native?Cr(t,n.renderParent.nodeIndex).renderElement:void 0:e}var $r=new WeakMap;function ti(t){var e=$r.get(t);return e||((e=t((function(){return Or}))).factory=t,$r.set(t,e)),e}function ei(t,e,n,r,i){3===e&&(n=t.renderer.parentNode(Wr(t,t.def.lastRenderRootNode))),ni(t,e,0,t.def.nodes.length-1,n,r,i)}function ni(t,e,n,r,i,o,a){for(var s=n;s<=r;s++){var u=t.def.nodes[s];11&u.flags&&ii(t,u,e,i,o,a),s+=u.childCount}}function ri(t,e,n,r,i,o){for(var a=t;a&&!Kr(a);)a=a.parent;for(var s=a.parent,u=Hr(a),c=u.nodeIndex+u.childCount,l=u.nodeIndex+1;l<=c;l++){var h=s.def.nodes[l];h.ngContentIndex===e&&ii(s,h,n,r,i,o),l+=h.childCount}if(!s.parent){var f=t.root.projectableNodes[e];if(f)for(var d=0;d<f.length;d++)oi(t,f[d],n,r,i,o)}}function ii(t,e,n,r,i,o){if(8&e.flags)ri(t,e.ngContent.index,n,r,i,o);else{var a=Wr(t,e);if(3===n&&33554432&e.flags&&48&e.bindingFlags?(16&e.bindingFlags&&oi(t,a,n,r,i,o),32&e.bindingFlags&&oi(Cr(t,e.nodeIndex).componentView,a,n,r,i,o)):oi(t,a,n,r,i,o),16777216&e.flags)for(var s=Cr(t,e.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)ei(s[u],n,r,i,o);1&e.flags&&!e.element.name&&ni(t,n,e.nodeIndex+1,e.nodeIndex+e.childCount,r,i,o)}}function oi(t,e,n,r,i,o){var a=t.renderer;switch(n){case 1:a.appendChild(r,e);break;case 2:a.insertBefore(r,e,i);break;case 3:a.removeChild(r,e);break;case 0:o.push(e)}}var ai=/^:([^:]+):(.+)$/;function si(t){if(":"===t[0]){var e=t.match(ai);return[e[1],e[2]]}return["",t]}function ui(t){for(var e=0,n=0;n<t.length;n++)e|=t[n].flags;return e}function ci(t,e,n,r,i,o,a,s,u,c,l,h,f,d,p,v,m,y,g,b){switch(t){case 1:return e+li(n)+r;case 2:return e+li(n)+r+li(i)+o;case 3:return e+li(n)+r+li(i)+o+li(a)+s;case 4:return e+li(n)+r+li(i)+o+li(a)+s+li(u)+c;case 5:return e+li(n)+r+li(i)+o+li(a)+s+li(u)+c+li(l)+h;case 6:return e+li(n)+r+li(i)+o+li(a)+s+li(u)+c+li(l)+h+li(f)+d;case 7:return e+li(n)+r+li(i)+o+li(a)+s+li(u)+c+li(l)+h+li(f)+d+li(p)+v;case 8:return e+li(n)+r+li(i)+o+li(a)+s+li(u)+c+li(l)+h+li(f)+d+li(p)+v+li(m)+y;case 9:return e+li(n)+r+li(i)+o+li(a)+s+li(u)+c+li(l)+h+li(f)+d+li(p)+v+li(m)+y+li(g)+b;default:throw new Error("Does not support more than 9 expressions")}}function li(t){return null!=t?t.toString():""}var hi=new Object,fi=Dr(bn),di=Dr(pe),pi=Dr(Ce);function vi(t,e,n,r){return n=se(n),{index:-1,deps:Jr(r,ie(e)),flags:t,token:e,value:n}}function mi(t,e){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bn.THROW_IF_NOT_FOUND,o=we(t);try{if(8&e.flags)return e.token;if(2&e.flags&&(i=null),1&e.flags)return t._parent.get(e.token,i);var a=e.tokenKey;switch(a){case fi:case di:case pi:return t}var s,u=t._def.providersByKey[a];if(u){var c=t._providers[u.index];return void 0===c&&(c=t._providers[u.index]=yi(t,u)),c===hi?void 0:c}if((s=ne(e.token))&&(n=t,null!=(r=s).providedIn&&(function(t,e){return t._def.modules.indexOf(e)>-1}(n,r.providedIn)||"root"===r.providedIn&&n._def.isRoot))){var l=t._providers.length;return t._def.providers[l]=t._def.providersByKey[e.tokenKey]={flags:5120,value:s.factory,deps:[],index:l,token:e.token},t._providers[l]=hi,t._providers[l]=yi(t,t._def.providersByKey[e.tokenKey])}return 4&e.flags?i:t._parent.get(e.token,i)}finally{we(o)}}function yi(t,e){var n;switch(201347067&e.flags){case 512:n=function(t,e,n){var r=n.length;switch(r){case 0:return new e;case 1:return new e(mi(t,n[0]));case 2:return new e(mi(t,n[0]),mi(t,n[1]));case 3:return new e(mi(t,n[0]),mi(t,n[1]),mi(t,n[2]));default:for(var i=new Array(r),o=0;o<r;o++)i[o]=mi(t,n[o]);return _construct(e,i)}}(t,e.value,e.deps);break;case 1024:n=function(t,e,n){var r=n.length;switch(r){case 0:return e();case 1:return e(mi(t,n[0]));case 2:return e(mi(t,n[0]),mi(t,n[1]));case 3:return e(mi(t,n[0]),mi(t,n[1]),mi(t,n[2]));default:for(var i=Array(r),o=0;o<r;o++)i[o]=mi(t,n[o]);return e.apply(void 0,i)}}(t,e.value,e.deps);break;case 2048:n=mi(t,e.deps[0]);break;case 256:n=e.value}return n===hi||null===n||"object"!=typeof n||131072&e.flags||"function"!=typeof n.ngOnDestroy||(e.flags|=131072),void 0===n?hi:n}function gi(t,e){var n=t.viewContainer._embeddedViews;if((null==e||e>=n.length)&&(e=n.length-1),e<0)return null;var r=n[e];return r.viewContainerParent=null,Ae(n,e),Ir.dirtyParentQueries(r),_i(r),r}function bi(t,e,n){var r=e?Wr(e,e.def.lastRenderRootNode):t.renderElement,i=n.renderer.parentNode(r),o=n.renderer.nextSibling(r);ei(n,2,i,o,void 0)}function _i(t){ei(t,3,null,null,void 0)}var wi=new Object;var Ei=function(t){function e(t,n,r,i,o,a){var s;return _classCallCheck2(this,e),(s=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).selector=t,s.componentType=n,s._inputs=i,s._outputs=o,s.ngContentSelectors=a,s.viewDefFactory=r,s}return _inherits(e,t),_createClass2(e,[{key:"create",value:function(t,e,n,r){if(!r)throw new Error("ngModule should be provided");var i=ti(this.viewDefFactory),o=i.nodes[0].element.componentProvider.nodeIndex,a=Ir.createRootView(t,e||[],n,i,r,wi),s=kr(a,o).instance;return n&&a.renderer.setAttribute(Cr(a,0).renderElement,"ng-version",$n.full),new xi(a,new Si(a),s)}},{key:"inputs",get:function(){var t=[],e=this._inputs;for(var n in e)t.push({propName:n,templateName:e[n]});return t}},{key:"outputs",get:function(){var t=[];for(var e in this._outputs)t.push({propName:e,templateName:this._outputs[e]});return t}}]),e}(Fn),xi=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._view=t,i._viewRef=n,i._component=r,i._elDef=i._view.def.nodes[0],i.hostView=n,i.changeDetectorRef=n,i.instance=r,i}return _inherits(e,t),_createClass2(e,[{key:"destroy",value:function(){this._viewRef.destroy()}},{key:"onDestroy",value:function(t){this._viewRef.onDestroy(t)}},{key:"location",get:function(){return new Wn(Cr(this._view,this._elDef.nodeIndex).renderElement)}},{key:"injector",get:function(){return new Pi(this._view,this._elDef)}},{key:"componentType",get:function(){return this._component.constructor}}]),e}(Bn);function Ti(t,e,n){return new Ci(t,e,n)}var Ci=function(){function t(e,n,r){_classCallCheck2(this,t),this._view=e,this._elDef=n,this._data=r,this._embeddedViews=[]}return _createClass2(t,[{key:"clear",value:function(){for(var t=this._embeddedViews.length-1;t>=0;t--){var e=gi(this._data,t);Ir.destroyView(e)}}},{key:"get",value:function(t){var e=this._embeddedViews[t];if(e){var n=new Si(e);return n.attachToViewContainerRef(this),n}return null}},{key:"createEmbeddedView",value:function(t,e,n){var r=t.createEmbeddedView(e||{});return this.insert(r,n),r}},{key:"createComponent",value:function(t,e,n,r,i){var o=n||this.parentInjector;i||t instanceof zn||(i=o.get(Ce));var a=t.create(o,r,void 0,i);return this.insert(a.hostView,e),a}},{key:"insert",value:function(t,e){if(t.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,i,o,a,s=t;return n=this._view,r=this._data,i=e,o=s._view,a=r.viewContainer._embeddedViews,null==i&&(i=a.length),o.viewContainerParent=n,Se(a,i,o),function(t,e){var n=zr(e);if(n&&n!==t&&!(16&e.state)){e.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(e),function(t,e){if(!(4&e.flags)){t.nodeFlags|=4,e.flags|=4;for(var n=e.parent;n;)n.childFlags|=4,n=n.parent}}(e.parent.def,e.parentNodeDef)}}(r,o),Ir.dirtyParentQueries(o),bi(r,i>0?a[i-1]:null,o),s.attachToViewContainerRef(this),t}},{key:"move",value:function(t,e){if(t.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,i,o,a,s=this._embeddedViews.indexOf(t._view);return n=this._data,r=s,i=e,o=n.viewContainer._embeddedViews,a=o[r],Ae(o,r),null==i&&(i=o.length),Se(o,i,a),Ir.dirtyParentQueries(a),_i(a),bi(n,i>0?o[i-1]:null,a),t}},{key:"indexOf",value:function(t){return this._embeddedViews.indexOf(t._view)}},{key:"remove",value:function(t){var e=gi(this._data,t);e&&Ir.destroyView(e)}},{key:"detach",value:function(t){var e=gi(this._data,t);return e?new Si(e):null}},{key:"element",get:function(){return new Wn(this._data.renderElement)}},{key:"injector",get:function(){return new Pi(this._view,this._elDef)}},{key:"parentInjector",get:function(){for(var t=this._view,e=this._elDef.parent;!e&&t;)e=Hr(t),t=t.parent;return t?new Pi(t,e):new Pi(this._view,null)}},{key:"length",get:function(){return this._embeddedViews.length}}]),t}();function ki(t){return new Si(t)}var Si=function(){function t(e){_classCallCheck2(this,t),this._view=e,this._viewContainerRef=null,this._appRef=null}return _createClass2(t,[{key:"markForCheck",value:function(){jr(this._view)}},{key:"detach",value:function(){this._view.state&=-5}},{key:"detectChanges",value:function(){var t=this._view.root.rendererFactory;t.begin&&t.begin();try{Ir.checkAndUpdateView(this._view)}finally{t.end&&t.end()}}},{key:"checkNoChanges",value:function(){Ir.checkNoChangesView(this._view)}},{key:"reattach",value:function(){this._view.state|=4}},{key:"onDestroy",value:function(t){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(t)}},{key:"destroy",value:function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),Ir.destroyView(this._view)}},{key:"detachFromAppRef",value:function(){this._appRef=null,_i(this._view),Ir.dirtyParentQueries(this._view)}},{key:"attachToAppRef",value:function(t){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}},{key:"attachToViewContainerRef",value:function(t){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=t}},{key:"rootNodes",get:function(){return ei(this._view,0,void 0,void 0,t=[]),t;var t}},{key:"context",get:function(){return this._view.context}},{key:"destroyed",get:function(){return 0!=(128&this._view.state)}}]),t}();function Ai(t,e){return new Ii(t,e)}var Ii=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._parentView=t,r._def=n,r}return _inherits(e,t),_createClass2(e,[{key:"createEmbeddedView",value:function(t){return new Si(Ir.createEmbeddedView(this._parentView,this._def,this._def.element.template,t))}},{key:"elementRef",get:function(){return new Wn(Cr(this._parentView,this._def.nodeIndex).renderElement)}}]),e}(vr);function Oi(t,e){return new Pi(t,e)}var Pi=function(){function t(e,n){_classCallCheck2(this,t),this.view=e,this.elDef=n}return _createClass2(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bn.THROW_IF_NOT_FOUND;return Ir.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:t,tokenKey:Dr(t)},e)}}]),t}();function Di(t,e){var n=t.def.nodes[e];if(1&n.flags){var r=Cr(t,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return Tr(t,n.nodeIndex).renderText;if(20240&n.flags)return kr(t,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index ".concat(e))}function Ni(t){return new Ri(t.renderer)}var Ri=function(){function t(e){_classCallCheck2(this,t),this.delegate=e}return _createClass2(t,[{key:"selectRootElement",value:function(t){return this.delegate.selectRootElement(t)}},{key:"createElement",value:function(t,e){var n=_slicedToArray(si(e),2),r=n[0],i=n[1],o=this.delegate.createElement(i,r);return t&&this.delegate.appendChild(t,o),o}},{key:"createViewRoot",value:function(t){return t}},{key:"createTemplateAnchor",value:function(t){var e=this.delegate.createComment("");return t&&this.delegate.appendChild(t,e),e}},{key:"createText",value:function(t,e){var n=this.delegate.createText(e);return t&&this.delegate.appendChild(t,n),n}},{key:"projectNodes",value:function(t,e){for(var n=0;n<e.length;n++)this.delegate.appendChild(t,e[n])}},{key:"attachViewAfter",value:function(t,e){for(var n=this.delegate.parentNode(t),r=this.delegate.nextSibling(t),i=0;i<e.length;i++)this.delegate.insertBefore(n,e[i],r)}},{key:"detachView",value:function(t){for(var e=0;e<t.length;e++){var n=t[e],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}}},{key:"destroyView",value:function(t,e){for(var n=0;n<e.length;n++)this.delegate.destroyNode(e[n])}},{key:"listen",value:function(t,e,n){return this.delegate.listen(t,e,n)}},{key:"listenGlobal",value:function(t,e,n){return this.delegate.listen(t,e,n)}},{key:"setElementProperty",value:function(t,e,n){this.delegate.setProperty(t,e,n)}},{key:"setElementAttribute",value:function(t,e,n){var r=_slicedToArray(si(e),2),i=r[0],o=r[1];null!=n?this.delegate.setAttribute(t,o,n,i):this.delegate.removeAttribute(t,o,i)}},{key:"setBindingDebugInfo",value:function(t,e,n){}},{key:"setElementClass",value:function(t,e,n){n?this.delegate.addClass(t,e):this.delegate.removeClass(t,e)}},{key:"setElementStyle",value:function(t,e,n){null!=n?this.delegate.setStyle(t,e,n):this.delegate.removeStyle(t,e)}},{key:"invokeElementMethod",value:function(t,e,n){t[e].apply(t,n)}},{key:"setText",value:function(t,e){this.delegate.setValue(t,e)}},{key:"animate",value:function(){throw new Error("Renderer.animate is no longer supported!")}}]),t}();function Mi(t,e,n,r){return new Li(t,e,n,r)}var Li=function(){function t(e,n,r,i){_classCallCheck2(this,t),this._moduleType=e,this._parent=n,this._bootstrapComponents=r,this._def=i,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(t){for(var e=t._def,n=t._providers=new Array(e.providers.length),r=0;r<e.providers.length;r++){var i=e.providers[r];4096&i.flags||void 0===n[r]&&(n[r]=yi(t,i))}}(this)}return _createClass2(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bn.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$t.Default,r=0;return n&$t.SkipSelf?r|=1:n&$t.Self&&(r|=4),mi(this,{token:t,tokenKey:Dr(t),flags:r},e)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The ng module ".concat(ie(this.instance.constructor)," has already been destroyed."));this._destroyed=!0,function(t,e){for(var n=t._def,r=new Set,i=0;i<n.providers.length;i++)if(131072&n.providers[i].flags){var o=t._providers[i];if(o&&o!==hi){var a=o.ngOnDestroy;"function"!=typeof a||r.has(o)||(a.apply(o),r.add(o))}}}(this),this._destroyListeners.forEach((function(t){return t()}))}},{key:"onDestroy",value:function(t){this._destroyListeners.push(t)}},{key:"instance",get:function(){return this.get(this._moduleType)}},{key:"componentFactoryResolver",get:function(){return this.get(qn)}}]),t}(),Bi=Dr((function t(){_classCallCheck2(this,t)})),Fi=Dr(Qn),Ui=Dr(Wn),Vi=Dr(yr),ji=Dr(vr),qi=Dr(vn),Gi=Dr(bn),zi=Dr(pe);function Hi(t,e,n,r,i,o,a,s){var u=[];if(a)for(var c in a){var l=_slicedToArray(a[c],2),h=l[0],f=l[1];u[h]={flags:8,name:c,nonMinifiedName:f,ns:null,securityContext:null,suffix:null}}var d=[];if(s)for(var p in s)d.push({type:1,propName:p,target:null,eventName:s[p]});return Xi(t,e|=16384,n,r,i,i,o,u,d)}function Wi(t,e,n){return Xi(-1,t|=16,null,0,e,e,n)}function Ki(t,e,n,r,i){return Xi(-1,t,e,0,n,r,i)}function Xi(t,e,n,r,i,o,a,s,u){var c=Qr(n),l=c.matchedQueries,h=c.references,f=c.matchedQueryIds;u||(u=[]),s||(s=[]),o=se(o);var d=Jr(a,ie(i));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:l,matchedQueryIds:f,references:h,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:ui(s),outputs:u,element:null,provider:{token:i,value:o,deps:d},text:null,query:null,ngContent:null}}function Yi(t,e){return $i(t,e)}function Qi(t,e){for(var n=t;n.parent&&!Kr(n);)n=n.parent;return to(n.parent,Hr(n),!0,e.provider.value,e.provider.deps)}function Ji(t,e){var n=to(t,e.parent,(32768&e.flags)>0,e.provider.value,e.provider.deps);if(e.outputs.length)for(var r=0;r<e.outputs.length;r++){var i=e.outputs[r],o=n[i.propName];if(!Mn(o))throw new Error("@Output ".concat(i.propName," not initialized in '").concat(n.constructor.name,"'."));var a=o.subscribe(Zi(t,e.parent.nodeIndex,i.eventName));t.disposables[e.outputIndex+r]=a.unsubscribe.bind(a)}return n}function Zi(t,e,n){return function(r){return Gr(t,e,n,r)}}function $i(t,e){var n=(8192&e.flags)>0,r=e.provider;switch(201347067&e.flags){case 512:return to(t,e.parent,n,r.value,r.deps);case 1024:return function(t,e,n,r,i){var o=i.length;switch(o){case 0:return r();case 1:return r(no(t,e,n,i[0]));case 2:return r(no(t,e,n,i[0]),no(t,e,n,i[1]));case 3:return r(no(t,e,n,i[0]),no(t,e,n,i[1]),no(t,e,n,i[2]));default:for(var a=Array(o),s=0;s<o;s++)a[s]=no(t,e,n,i[s]);return r.apply(void 0,a)}}(t,e.parent,n,r.value,r.deps);case 2048:return no(t,e.parent,n,r.deps[0]);case 256:return r.value}}function to(t,e,n,r,i){var o=i.length;switch(o){case 0:return new r;case 1:return new r(no(t,e,n,i[0]));case 2:return new r(no(t,e,n,i[0]),no(t,e,n,i[1]));case 3:return new r(no(t,e,n,i[0]),no(t,e,n,i[1]),no(t,e,n,i[2]));default:for(var a=new Array(o),s=0;s<o;s++)a[s]=no(t,e,n,i[s]);return _construct(r,a)}}var eo={};function no(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bn.THROW_IF_NOT_FOUND;if(8&r.flags)return r.token;var o=t;2&r.flags&&(i=null);var a=r.tokenKey;a===qi&&(n=!(!e||!e.element.componentView)),e&&1&r.flags&&(n=!1,e=e.parent);for(var s=t;s;){if(e)switch(a){case Bi:return Ni(ro(s,e,n));case Fi:return ro(s,e,n).renderer;case Ui:return new Wn(Cr(s,e.nodeIndex).renderElement);case Vi:return Cr(s,e.nodeIndex).viewContainer;case ji:if(e.element.template)return Cr(s,e.nodeIndex).template;break;case qi:return ki(ro(s,e,n));case Gi:case zi:return Oi(s,e);default:var u=(n?e.element.allProviders:e.element.publicProviders)[a];if(u){var c=kr(s,u.nodeIndex);return c||(c={instance:$i(s,u)},s.nodes[u.nodeIndex]=c),c.instance}}n=Kr(s),e=Hr(s),s=s.parent,4&r.flags&&(s=null)}var l=o.root.injector.get(r.token,eo);return l!==eo||i===eo?l:o.root.ngModule.injector.get(r.token,i)}function ro(t,e,n){var r;if(n)r=Cr(t,e.nodeIndex).componentView;else for(r=t;r.parent&&!Kr(r);)r=r.parent;return r}function io(t,e,n,r,i,o){if(32768&n.flags){var a=Cr(t,n.parent.nodeIndex).componentView;2&a.def.flags&&(a.state|=8)}if(e.instance[n.bindings[r].name]=i,524288&n.flags){o=o||{};var s=Pn.unwrap(t.oldValues[n.bindingIndex+r]);o[n.bindings[r].nonMinifiedName]=new Ln(s,i,0!=(2&t.state))}return t.oldValues[n.bindingIndex+r]=i,o}function oo(t,e){if(t.def.nodeFlags&e)for(var n=t.def.nodes,r=0,i=0;i<n.length;i++){var o=n[i],a=o.parent;for(!a&&o.flags&e&&so(t,i,o.flags&e,r++),0==(o.childFlags&e)&&(i+=o.childCount);a&&1&a.flags&&i===a.nodeIndex+a.childCount;)a.directChildFlags&e&&(r=ao(t,a,e,r)),a=a.parent}}function ao(t,e,n,r){for(var i=e.nodeIndex+1;i<=e.nodeIndex+e.childCount;i++){var o=t.def.nodes[i];o.flags&n&&so(t,i,o.flags&n,r++),i+=o.childCount}return r}function so(t,e,n,r){var i=kr(t,e);if(i){var o=i.instance;o&&(Ir.setCurrentNode(t,e),1048576&n&&xr(t,512,r)&&o.ngAfterContentInit(),2097152&n&&o.ngAfterContentChecked(),4194304&n&&xr(t,768,r)&&o.ngAfterViewInit(),8388608&n&&o.ngAfterViewChecked(),131072&n&&o.ngOnDestroy())}}var uo=new de("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return Oe}}),co={},lo=function(){var t={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencySymbol:15,CurrencyName:16,Currencies:17,PluralCase:18,ExtraData:19};return t[t.LocaleId]="LocaleId",t[t.DayPeriodsFormat]="DayPeriodsFormat",t[t.DayPeriodsStandalone]="DayPeriodsStandalone",t[t.DaysFormat]="DaysFormat",t[t.DaysStandalone]="DaysStandalone",t[t.MonthsFormat]="MonthsFormat",t[t.MonthsStandalone]="MonthsStandalone",t[t.Eras]="Eras",t[t.FirstDayOfWeek]="FirstDayOfWeek",t[t.WeekendRange]="WeekendRange",t[t.DateFormat]="DateFormat",t[t.TimeFormat]="TimeFormat",t[t.DateTimeFormat]="DateTimeFormat",t[t.NumberSymbols]="NumberSymbols",t[t.NumberFormats]="NumberFormats",t[t.CurrencySymbol]="CurrencySymbol",t[t.CurrencyName]="CurrencyName",t[t.Currencies]="Currencies",t[t.PluralCase]="PluralCase",t[t.ExtraData]="ExtraData",t}(),ho=void 0,fo=["en",[["a","p"],["AM","PM"],ho],[["AM","PM"],ho,ho],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],ho,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],ho,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",ho,"{1} 'at' {0}",ho],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(t){var e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}],po="en-US";function vo(t){null==t&&function(t){throw new Error("ASSERTION ERROR: ".concat("Expected localeId to be defined"))}(),"string"==typeof t&&t.toLowerCase().replace(/_/g,"-")}var mo=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).__isAsync=n,t}return _inherits(e,t),_createClass2(e,[{key:"emit",value:function(t){_get(_getPrototypeOf(e.prototype),"next",this).call(this,t)}},{key:"subscribe",value:function(t,n,r){var i,o=function(t){return null},a=function(){return null};t&&"object"==typeof t?(i=this.__isAsync?function(e){setTimeout((function(){return t.next(e)}))}:function(e){t.next(e)},t.error&&(o=this.__isAsync?function(e){setTimeout((function(){return t.error(e)}))}:function(e){t.error(e)}),t.complete&&(a=this.__isAsync?function(){setTimeout((function(){return t.complete()}))}:function(){t.complete()})):(i=this.__isAsync?function(e){setTimeout((function(){return t(e)}))}:function(e){t(e)},n&&(o=this.__isAsync?function(t){setTimeout((function(){return n(t)}))}:function(t){n(t)}),r&&(a=this.__isAsync?function(){setTimeout((function(){return r()}))}:function(){r()}));var s=_get(_getPrototypeOf(e.prototype),"subscribe",this).call(this,i,o,a);return t instanceof et&&t.add(s),s}}]),e}(vt);function yo(){return this._results[An()]()}var go=function(){function t(){_classCallCheck2(this,t),this.dirty=!0,this._results=[],this.changes=new mo,this.length=0;var e=An(),n=t.prototype;n[e]||(n[e]=yo)}return _createClass2(t,[{key:"map",value:function(t){return this._results.map(t)}},{key:"filter",value:function(t){return this._results.filter(t)}},{key:"find",value:function(t){return this._results.find(t)}},{key:"reduce",value:function(t,e){return this._results.reduce(t,e)}},{key:"forEach",value:function(t){this._results.forEach(t)}},{key:"some",value:function(t){return this._results.some(t)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(t){this._results=function t(e,n){void 0===n&&(n=e);for(var r=0;r<e.length;r++){var i=e[r];Array.isArray(i)?(n===e&&(n=e.slice(0,r)),t(i,n)):n!==e&&n.push(i)}return n}(t),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}},{key:"notifyOnChanges",value:function(){this.changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),t}(),bo=new de("Application Initializer"),_o=function(){function t(e){var n=this;_classCallCheck2(this,t),this.appInits=e,this.initialized=!1,this.done=!1,this.donePromise=new Promise((function(t,e){n.resolve=t,n.reject=e}))}return _createClass2(t,[{key:"runInitializers",value:function(){var t=this;if(!this.initialized){var e=[],n=function(){t.done=!0,t.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var i=this.appInits[r]();Rn(i)&&e.push(i)}Promise.all(e).then((function(){n()})).catch((function(e){t.reject(e)})),0===e.length&&n(),this.initialized=!0}}}]),t}(),wo=new de("AppId");function Eo(){return"".concat(xo()).concat(xo()).concat(xo())}function xo(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var To=new de("Platform Initializer"),Co=new de("Platform ID"),ko=new de("appBootstrapListener"),So=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"log",value:function(t){console.log(t)}},{key:"warn",value:function(t){console.warn(t)}}]),t}(),Ao=new de("LocaleId"),Io=!1;function Oo(){throw new Error("Runtime compiler is not loaded")}var Po,Do,No=Oo,Ro=Oo,Mo=Oo,Lo=Oo,Bo=function(){function t(){_classCallCheck2(this,t),this.compileModuleSync=No,this.compileModuleAsync=Ro,this.compileModuleAndAllComponentsSync=Mo,this.compileModuleAndAllComponentsAsync=Lo}return _createClass2(t,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(t){}},{key:"getModuleId",value:function(t){}}]),t}(),Fo=function t(){_classCallCheck2(this,t)};var Uo,Vo=!(!(Uo=fe.wtf)||!(Po=Uo.trace)||(Do=Po.events,0));function jo(t,e){return null}var qo=Vo?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Do.createScope(t,e)}:function(t,e){return jo},Go=Vo?function(t,e){return Po.leaveScope(t,e),e}:function(t,e){return e},zo=Promise.resolve(0);function Ho(t){"undefined"==typeof Zone?zo.then((function(){t&&t.apply(null,null)})):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}var Wo=function(){function t(e){var n,r=e.enableLongStackTrace,i=void 0!==r&&r;if(_classCallCheck2(this,t),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new mo(!1),this.onMicrotaskEmpty=new mo(!1),this.onStable=new mo(!1),this.onError=new mo(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(n=this)._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(t,e,r,i,o,a){try{return Qo(n),t.invokeTask(r,i,o,a)}finally{Jo(n)}},onInvoke:function(t,e,r,i,o,a,s){try{return Qo(n),t.invoke(r,i,o,a,s)}finally{Jo(n)}},onHasTask:function(t,e,r,i){t.hasTask(r,i),e===r&&("microTask"==i.change?(n.hasPendingMicrotasks=i.microTask,Yo(n)):"macroTask"==i.change&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:function(t,e,r,i){return t.handleError(r,i),n.runOutsideAngular((function(){return n.onError.emit(i)})),!1}})}return _createClass2(t,[{key:"run",value:function(t,e,n){return this._inner.run(t,e,n)}},{key:"runTask",value:function(t,e,n,r){var i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+r,t,Xo,Ko,Ko);try{return i.runTask(o,e,n)}finally{i.cancelTask(o)}}},{key:"runGuarded",value:function(t,e,n){return this._inner.runGuarded(t,e,n)}},{key:"runOutsideAngular",value:function(t){return this._outer.run(t)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!t.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(t.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),t}();function Ko(){}var Xo={};function Yo(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular((function(){return t.onStable.emit(null)}))}finally{t.isStable=!0}}}function Qo(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Jo(t){t._nesting--,Yo(t)}var Zo,$o=function(){function t(){_classCallCheck2(this,t),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new mo,this.onMicrotaskEmpty=new mo,this.onStable=new mo,this.onError=new mo}return _createClass2(t,[{key:"run",value:function(t){return t()}},{key:"runGuarded",value:function(t){return t()}},{key:"runOutsideAngular",value:function(t){return t()}},{key:"runTask",value:function(t){return t()}}]),t}(),ta=function(){function t(e){var n=this;_classCallCheck2(this,t),this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run((function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")}))}return _createClass2(t,[{key:"_watchAngularEvents",value:function(){var t=this;this._ngZone.onUnstable.subscribe({next:function(){t._didWork=!0,t._isZoneStable=!1}}),this._ngZone.runOutsideAngular((function(){t._ngZone.onStable.subscribe({next:function(){Wo.assertNotInAngularZone(),Ho((function(){t._isZoneStable=!0,t._runCallbacksIfReady()}))}})}))}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var t=this;if(this.isStable())Ho((function(){for(;0!==t._callbacks.length;){var e=t._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(t._didWork)}t._didWork=!1}));else{var e=this.getPendingTasks();this._callbacks=this._callbacks.filter((function(t){return!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)})),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map((function(t){return{source:t.source,creationLocation:t.creationLocation,data:t.data}})):[]}},{key:"addCallback",value:function(t,e,n){var r=this,i=-1;e&&e>0&&(i=setTimeout((function(){r._callbacks=r._callbacks.filter((function(t){return t.timeoutId!==i})),t(r._didWork,r.getPendingTasks())}),e)),this._callbacks.push({doneCb:t,timeoutId:i,updateCb:n})}},{key:"whenStable",value:function(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(t,e,n){return[]}}]),t}(),ea=function(){function t(){_classCallCheck2(this,t),this._applications=new Map,na.addToWindow(this)}return _createClass2(t,[{key:"registerApplication",value:function(t,e){this._applications.set(t,e)}},{key:"unregisterApplication",value:function(t){this._applications.delete(t)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(t){return this._applications.get(t)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return na.findTestabilityInTree(this,t,e)}}]),t}(),na=new(function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"addToWindow",value:function(t){}},{key:"findTestabilityInTree",value:function(t,e,n){return null}}]),t}()),ra=function(t,e,n){return t.get(Fo).createCompiler([e]).compileModuleAsync(n)},ia=new de("AllowMultipleToken"),oa=function t(e,n){_classCallCheck2(this,t),this.name=e,this.token=n};function aa(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: ".concat(e),i=new de(r);return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=sa();if(!o||o.injector.get(ia,!1))if(t)t(n.concat(e).concat({provide:i,useValue:!0}));else{var a=n.concat(e).concat({provide:i,useValue:!0});!function(t){if(Zo&&!Zo.destroyed&&!Zo.injector.get(ia,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Zo=t.get(ua);var e=t.get(To,null);e&&e.forEach((function(t){return t()}))}(bn.create({providers:a,name:r}))}return function(t){var e=sa();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function sa(){return Zo&&!Zo.destroyed?Zo:null}var ua=function(){function t(e){_classCallCheck2(this,t),this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass2(t,[{key:"bootstrapModuleFactory",value:function(t,e){var n,r=this,i="noop"===(n=e?e.ngZone:void 0)?new $o:("zone.js"===n?void 0:n)||new Wo({enableLongStackTrace:Ve()}),o=[{provide:Wo,useValue:i}];return i.run((function(){var e=bn.create({providers:o,parent:r.injector,name:t.moduleType.name}),n=t.create(e),a=n.injector.get(Be,null);if(!a)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return Io&&vo(n.injector.get(Ao,po)||po),n.onDestroy((function(){return fa(r._modules,n)})),i.runOutsideAngular((function(){return i.onError.subscribe({next:function(t){a.handleError(t)}})})),function(t,e,i){try{var o=((a=n.injector.get(_o)).runInitializers(),a.donePromise.then((function(){return r._moduleDoBootstrap(n),n})));return Rn(o)?o.catch((function(n){throw e.runOutsideAngular((function(){return t.handleError(n)})),n})):o}catch(s){throw e.runOutsideAngular((function(){return t.handleError(s)})),s}var a}(a,i)}))}},{key:"bootstrapModule",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=ca({},n);return ra(this.injector,r,t).then((function(t){return e.bootstrapModuleFactory(t,r)}))}},{key:"_moduleDoBootstrap",value:function(t){var e=t.injector.get(ha);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach((function(t){return e.bootstrap(t)}));else{if(!t.instance.ngDoBootstrap)throw new Error("The module ".concat(ie(t.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. ')+"Please define one of these.");t.instance.ngDoBootstrap(e)}this._modules.push(t)}},{key:"onDestroy",value:function(t){this._destroyListeners.push(t)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach((function(t){return t.destroy()})),this._destroyListeners.forEach((function(t){return t()})),this._destroyed=!0}},{key:"injector",get:function(){return this._injector}},{key:"destroyed",get:function(){return this._destroyed}}]),t}();function ca(t,e){return Array.isArray(e)?e.reduce(ca,t):Object.assign({},t,e)}var la,ha=((la=function(){function t(e,n,r,i,o,a){var s=this;_classCallCheck2(this,t),this._zone=e,this._console=n,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=o,this._initStatus=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Ve(),this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run((function(){s.tick()}))}});var u=new ct((function(t){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular((function(){t.next(s._stable),t.complete()}))})),c=new ct((function(t){var e;s._zone.runOutsideAngular((function(){e=s._zone.onStable.subscribe((function(){Wo.assertNotInAngularZone(),Ho((function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,t.next(!0))}))}))}));var n=s._zone.onUnstable.subscribe((function(){Wo.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular((function(){t.next(!1)})))}));return function(){e.unsubscribe(),n.unsubscribe()}}));this.isStable=Bt(u,c.pipe((function(t){return Ft()(zt(Wt)(t))})))}return _createClass2(t,[{key:"bootstrap",value:function(t,e){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=t instanceof Fn?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);var i=n instanceof zn?null:this._injector.get(Ce),o=n.create(bn.NULL,[],e||n.selector,i);o.onDestroy((function(){r._unloadComponent(o)}));var a=o.injector.get(ta,null);return a&&o.injector.get(ea).registerApplication(o.location.nativeElement,a),this._loadComponent(o),Ve()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),o}},{key:"tick",value:function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=t._tickScope();try{this._runningTick=!0;var r=!0,i=!1,o=void 0;try{for(var a,s=this._views[Symbol.iterator]();!(r=(a=s.next()).done);r=!0)a.value.detectChanges()}catch(d){i=!0,o=d}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}if(this._enforceNoNewChanges){var u=!0,c=!1,l=void 0;try{for(var h,f=this._views[Symbol.iterator]();!(u=(h=f.next()).done);u=!0)h.value.checkNoChanges()}catch(d){c=!0,l=d}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}}}catch(p){this._zone.runOutsideAngular((function(){return e._exceptionHandler.handleError(p)}))}finally{this._runningTick=!1,Go(n)}}},{key:"attachView",value:function(t){var e=t;this._views.push(e),e.attachToAppRef(this)}},{key:"detachView",value:function(t){var e=t;fa(this._views,e),e.detachFromAppRef()}},{key:"_loadComponent",value:function(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(ko,[]).concat(this._bootstrapListeners).forEach((function(e){return e(t)}))}},{key:"_unloadComponent",value:function(t){this.detachView(t.hostView),fa(this.components,t)}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach((function(t){return t.destroy()}))}},{key:"viewCount",get:function(){return this._views.length}}]),t}())._tickScope=qo("ApplicationRef#tick()"),la);function fa(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}var da=function t(e,n){_classCallCheck2(this,t),this.name=e,this.callback=n},pa=function(){function t(e,n,r){_classCallCheck2(this,t),this.listeners=[],this.parent=null,this._debugContext=r,this.nativeNode=e,n&&n instanceof va&&n.addChild(this)}return _createClass2(t,[{key:"injector",get:function(){return this._debugContext.injector}},{key:"componentInstance",get:function(){return this._debugContext.component}},{key:"context",get:function(){return this._debugContext.context}},{key:"references",get:function(){return this._debugContext.references}},{key:"providerTokens",get:function(){return this._debugContext.providerTokens}}]),t}(),va=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n,r))).properties={},i.attributes={},i.classes={},i.styles={},i.childNodes=[],i.nativeElement=t,i}return _inherits(e,t),_createClass2(e,[{key:"addChild",value:function(t){t&&(this.childNodes.push(t),t.parent=this)}},{key:"removeChild",value:function(t){var e=this.childNodes.indexOf(t);-1!==e&&(t.parent=null,this.childNodes.splice(e,1))}},{key:"insertChildrenAfter",value:function(t,e){var n,r=this,i=this.childNodes.indexOf(t);-1!==i&&((n=this.childNodes).splice.apply(n,[i+1,0].concat(_toConsumableArray(e))),e.forEach((function(e){e.parent&&e.parent.removeChild(e),t.parent=r})))}},{key:"insertBefore",value:function(t,e){var n=this.childNodes.indexOf(t);-1===n?this.addChild(e):(e.parent&&e.parent.removeChild(e),e.parent=this,this.childNodes.splice(n,0,e))}},{key:"query",value:function(t){return this.queryAll(t)[0]||null}},{key:"queryAll",value:function(t){var n=[];return function t(n,r,i){n.childNodes.forEach((function(n){n instanceof e&&(r(n)&&i.push(n),t(n,r,i))}))}(this,t,n),n}},{key:"queryAllNodes",value:function(t){var n=[];return function t(n,r,i){n instanceof e&&n.childNodes.forEach((function(n){r(n)&&i.push(n),n instanceof e&&t(n,r,i)}))}(this,t,n),n}},{key:"triggerEventHandler",value:function(t,e){this.listeners.forEach((function(n){n.name==t&&n.callback(e)}))}},{key:"children",get:function(){return this.childNodes.filter((function(t){return t instanceof e}))}}]),e}(pa),ma=new Map,ya=function(t){return ma.get(t)||null};function ba(t){ma.set(t.nativeNode,t)}var _a=aa(null,"core",[{provide:Co,useValue:"unknown"},{provide:ua,deps:[bn]},{provide:ea,deps:[]},{provide:So,deps:[]}]);function wa(){return dr}function Ea(){return pr}function xa(t){return t?(Io&&vo(t),t):po}function Ta(t){var e=[];return t.onStable.subscribe((function(){for(;e.length;)e.pop()()})),function(t){e.push(t)}}var Ca=function t(e){_classCallCheck2(this,t)};function ka(t,e,n,r,i,o){t|=1;var a=Qr(e),s=a.matchedQueries,u=a.references;return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:t,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:a.matchedQueryIds,references:u,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:o?ti(o):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:i||Or},provider:null,text:null,query:null,ngContent:null}}function Sa(t,e,n,r,i,o){var a,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],u=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,l=arguments.length>9?arguments[9]:void 0,h=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0;l||(l=Or);var d=Qr(n),p=d.matchedQueries,v=d.references,m=d.matchedQueryIds,y=null,g=null;o&&(y=(a=_slicedToArray(si(o),2))[0],g=a[1]),u=u||[];for(var b=new Array(u.length),_=0;_<u.length;_++){var w=_slicedToArray(u[_],3),E=w[0],x=w[1],T=w[2],C=_slicedToArray(si(x),2),k=C[0],S=C[1],A=void 0,I=void 0;switch(15&E){case 4:I=T;break;case 1:case 8:A=T}b[_]={flags:E,ns:k,name:S,nonMinifiedName:S,securityContext:A,suffix:I}}c=c||[];for(var O=new Array(c.length),P=0;P<c.length;P++){var D=_slicedToArray(c[P],2),N=D[0],R=D[1];O[P]={type:0,target:N,eventName:R,propName:null}}var M=(s=s||[]).map((function(t){var e=_slicedToArray(t,2),n=e[0],r=e[1],i=_slicedToArray(si(n),2);return[i[0],i[1],r]}));return f=function(t){if(t&&t.id===Rr){var e=null!=t.encapsulation&&t.encapsulation!==Ie.None||t.styles.length||Object.keys(t.data).length;t.id=e?"c".concat(Br++):Mr}return t&&t.id===Mr&&(t=null),t||null}(f),h&&(e|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:e|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:p,matchedQueryIds:m,references:v,ngContentIndex:r,childCount:i,bindings:b,bindingFlags:ui(b),outputs:O,element:{ns:y,name:g,attrs:M,template:null,componentProvider:null,componentView:h||null,componentRendererType:f,publicProviders:null,allProviders:null,handleEvent:l||Or},provider:null,text:null,query:null,ngContent:null}}function Aa(t,e,n){var r,i=n.element,o=t.root.selectorOrNode,a=t.renderer;if(t.parent||!o){r=i.name?a.createElement(i.name,i.ns):a.createComment("");var s=Zr(t,e,n);s&&a.appendChild(s,r)}else r=a.selectRootElement(o,!!i.componentRendererType&&i.componentRendererType.encapsulation===Ie.ShadowDom);if(i.attrs)for(var u=0;u<i.attrs.length;u++){var c=_slicedToArray(i.attrs[u],3),l=c[0],h=c[1],f=c[2];a.setAttribute(r,h,f,l)}return r}function Ia(t,e,n,r){for(var i=0;i<n.outputs.length;i++){var o=n.outputs[i],a=Oa(t,n.nodeIndex,(h=o.eventName,(l=o.target)?"".concat(l,":").concat(h):h)),s=o.target,u=t;"component"===o.target&&(s=null,u=e);var c=u.renderer.listen(s||r,o.eventName,a);t.disposables[n.outputIndex+i]=c}var l,h}function Oa(t,e,n){return function(r){return Gr(t,e,n,r)}}function Pa(t,e,n,r){if(!Ur(t,e,n,r))return!1;var i=e.bindings[n],o=Cr(t,e.nodeIndex),a=o.renderElement,s=i.name;switch(15&i.flags){case 1:!function(t,e,n,r,i,o){var a=e.securityContext,s=a?t.root.sanitizer.sanitize(a,o):o;s=null!=s?s.toString():null;var u=t.renderer;null!=o?u.setAttribute(n,i,s,r):u.removeAttribute(n,i,r)}(t,i,a,i.ns,s,r);break;case 2:!function(t,e,n,r){var i=t.renderer;r?i.addClass(e,n):i.removeClass(e,n)}(t,a,s,r);break;case 4:!function(t,e,n,r,i){var o=t.root.sanitizer.sanitize(cn.STYLE,i);if(null!=o){o=o.toString();var a=e.suffix;null!=a&&(o+=a)}else o=null;var s=t.renderer;null!=o?s.setStyle(n,r,o):s.removeStyle(n,r)}(t,i,a,s,r);break;case 8:!function(t,e,n,r,i){var o=e.securityContext,a=o?t.root.sanitizer.sanitize(o,i):i;t.renderer.setProperty(n,r,a)}(33554432&e.flags&&32&i.flags?o.componentView:t,i,a,s,r)}return!0}function Da(t,e,n){var r=[];for(var i in n)r.push({propName:i,bindingType:n[i]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:e,filterId:Yr(e),bindings:r},ngContent:null}}function Na(t){for(var e=t.def.nodeMatchedQueries;t.parent&&Xr(t);){var n=t.parentNodeDef;t=t.parent;for(var r=n.nodeIndex+n.childCount,i=0;i<=r;i++){var o=t.def.nodes[i];67108864&o.flags&&536870912&o.flags&&(o.query.filterId&e)===o.query.filterId&&Ar(t,i).setDirty(),!(1&o.flags&&i+o.childCount<n.nodeIndex)&&67108864&o.childFlags&&536870912&o.childFlags||(i+=o.childCount)}}if(134217728&t.def.nodeFlags)for(var a=0;a<t.def.nodes.length;a++){var s=t.def.nodes[a];134217728&s.flags&&536870912&s.flags&&Ar(t,a).setDirty(),a+=s.childCount}}function Ra(t,e){var n=Ar(t,e.nodeIndex);if(n.dirty){var r,i=void 0;if(67108864&e.flags){var o=e.parent.parent;i=Ma(t,o.nodeIndex,o.nodeIndex+o.childCount,e.query,[]),r=kr(t,e.parent.nodeIndex).instance}else 134217728&e.flags&&(i=Ma(t,0,t.def.nodes.length-1,e.query,[]),r=t.component);n.reset(i);for(var a=e.query.bindings,s=!1,u=0;u<a.length;u++){var c=a[u],l=void 0;switch(c.bindingType){case 0:l=n.first;break;case 1:l=n,s=!0}r[c.propName]=l}s&&n.notifyOnChanges()}}function Ma(t,e,n,r,i){for(var o=e;o<=n;o++){var a=t.def.nodes[o],s=a.matchedQueries[r.id];if(null!=s&&i.push(La(t,a,s)),1&a.flags&&a.element.template&&(a.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=Cr(t,o);if((a.childMatchedQueries&r.filterId)===r.filterId&&(Ma(t,o+1,o+a.childCount,r,i),o+=a.childCount),16777216&a.flags)for(var c=u.viewContainer._embeddedViews,l=0;l<c.length;l++){var h=c[l],f=zr(h);f&&f===u&&Ma(h,0,h.def.nodes.length-1,r,i)}var d=u.template._projectedViews;if(d)for(var p=0;p<d.length;p++){var v=d[p];Ma(v,0,v.def.nodes.length-1,r,i)}}(a.childMatchedQueries&r.filterId)!==r.filterId&&(o+=a.childCount)}return i}function La(t,e,n){if(null!=n)switch(n){case 1:return Cr(t,e.nodeIndex).renderElement;case 0:return new Wn(Cr(t,e.nodeIndex).renderElement);case 2:return Cr(t,e.nodeIndex).template;case 3:return Cr(t,e.nodeIndex).viewContainer;case 4:return kr(t,e.nodeIndex).instance}}function Ba(t,e,n){var r=Zr(t,e,n);r&&ri(t,n.ngContent.index,1,r,null,void 0)}function Fa(t,e){for(var n=Object.keys(e),r=n.length,i=new Array(r),o=0;o<r;o++){var a=n[o];i[e[a]]=a}return function(t,e,n){for(var r=new Array(n.length),i=0;i<n.length;i++){var o=n[i];r[i]={flags:8,name:o,ns:null,nonMinifiedName:o,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:64,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:r,bindingFlags:ui(r),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,t,i)}function Ua(t,e,n){for(var r=new Array(n.length-1),i=1;i<n.length;i++)r[i-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[i]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Va(t,e,n){var r,i=t.renderer;r=i.createText(n.text.prefix);var o=Zr(t,e,n);return o&&i.appendChild(o,r),{renderText:r}}function ja(t,e){return(null!=t?t.toString():"")+e.suffix}function qa(t,e,n,r){for(var i=0,o=0,a=0,s=0,u=0,c=null,l=null,h=!1,f=!1,d=null,p=0;p<e.length;p++){var v=e[p];if(v.nodeIndex=p,v.parent=c,v.bindingIndex=i,v.outputIndex=o,v.renderParent=l,a|=v.flags,u|=v.matchedQueryIds,v.element){var m=v.element;m.publicProviders=c?c.element.publicProviders:Object.create(null),m.allProviders=m.publicProviders,h=!1,f=!1,v.element.template&&(u|=v.element.template.nodeMatchedQueries)}if(za(c,v,e.length),i+=v.bindings.length,o+=v.outputs.length,!l&&3&v.flags&&(d=v),20224&v.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);var y=0!=(32768&v.flags);0==(8192&v.flags)||y?c.element.publicProviders[Dr(v.provider.token)]=v:(f||(f=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[Dr(v.provider.token)]=v),y&&(c.element.componentProvider=v)}if(c?(c.childFlags|=v.flags,c.directChildFlags|=v.flags,c.childMatchedQueries|=v.matchedQueryIds,v.element&&v.element.template&&(c.childMatchedQueries|=v.element.template.nodeMatchedQueries)):s|=v.flags,v.childCount>0)c=v,Ga(v)||(l=v);else for(;c&&p===c.nodeIndex+c.childCount;){var g=c.parent;g&&(g.childFlags|=c.childFlags,g.childMatchedQueries|=c.childMatchedQueries),l=(c=g)&&Ga(c)?c.renderParent:c}}return{factory:null,nodeFlags:a,rootNodeFlags:s,nodeMatchedQueries:u,flags:t,nodes:e,updateDirectives:n||Or,updateRenderer:r||Or,handleEvent:function(t,n,r,i){return e[n].element.handleEvent(t,r,i)},bindingCount:i,outputCount:o,lastRenderRootNode:d}}function Ga(t){return 0!=(1&t.flags)&&null===t.element.name}function za(t,e,n){var r=e.element&&e.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index ".concat(e.nodeIndex,"!"))}if(20224&e.flags&&0==(1&(t?t.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ".concat(e.nodeIndex,"!"));if(e.query){if(67108864&e.flags&&(!t||0==(16384&t.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index ".concat(e.nodeIndex,"!"));if(134217728&e.flags&&t)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index ".concat(e.nodeIndex,"!"))}if(e.childCount){var i=t?t.nodeIndex+t.childCount:n-1;if(e.nodeIndex<=i&&e.nodeIndex+e.childCount>i)throw new Error("Illegal State: childCount of node leads outside of parent, at index ".concat(e.nodeIndex,"!"))}}function Ha(t,e,n,r){var i=Xa(t.root,t.renderer,t,e,n);return Ya(i,t.component,r),Qa(i),i}function Wa(t,e,n){var r=Xa(t,t.renderer,null,null,e);return Ya(r,n,n),Qa(r),r}function Ka(t,e,n,r){var i,o=e.element.componentRendererType;return i=o?t.root.rendererFactory.createRenderer(r,o):t.root.renderer,Xa(t.root,i,t,e.element.componentProvider,n)}function Xa(t,e,n,r,i){var o=new Array(i.nodes.length),a=i.outputCount?new Array(i.outputCount):null;return{def:i,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:o,state:13,root:t,renderer:e,oldValues:new Array(i.bindingCount),disposables:a,initIndex:-1}}function Ya(t,e,n){t.component=e,t.context=n}function Qa(t){var e;Kr(t)&&(e=Cr(t.parent,t.parentNodeDef.parent.nodeIndex).renderElement);for(var n=t.def,r=t.nodes,i=0;i<n.nodes.length;i++){var o=n.nodes[i],a=void 0;switch(Ir.setCurrentNode(t,i),201347067&o.flags){case 1:var s=Aa(t,e,o),u=void 0;if(33554432&o.flags){var c=ti(o.element.componentView);u=Ir.createComponentView(t,o,c,s)}Ia(t,u,o,s),a={renderElement:s,componentView:u,viewContainer:null,template:o.element.template?Ai(t,o):void 0},16777216&o.flags&&(a.viewContainer=Ti(t,o,a));break;case 2:a=Va(t,e,o);break;case 512:case 1024:case 2048:case 256:(a=r[i])||4096&o.flags||(a={instance:Yi(t,o)});break;case 16:a={instance:Qi(t,o)};break;case 16384:(a=r[i])||(a={instance:Ji(t,o)}),32768&o.flags&&Ya(Cr(t,o.parent.nodeIndex).componentView,a.instance,a.instance);break;case 32:case 64:case 128:a={value:void 0};break;case 67108864:case 134217728:a=new go;break;case 8:Ba(t,e,o),a=void 0}r[i]=a}os(t,is.CreateViewNodes),cs(t,201326592,268435456,0)}function Ja(t){ts(t),Ir.updateDirectives(t,1),as(t,is.CheckNoChanges),Ir.updateRenderer(t,1),os(t,is.CheckNoChanges),t.state&=-97}function Za(t){1&t.state?(t.state&=-2,t.state|=2):t.state&=-3,Er(t,0,256),ts(t),Ir.updateDirectives(t,0),as(t,is.CheckAndUpdate),cs(t,67108864,536870912,0);var e=Er(t,256,512);oo(t,2097152|(e?1048576:0)),Ir.updateRenderer(t,0),os(t,is.CheckAndUpdate),cs(t,134217728,536870912,0),oo(t,8388608|((e=Er(t,512,768))?4194304:0)),2&t.def.flags&&(t.state&=-9),t.state&=-97,Er(t,768,1024)}function $a(t,e,n,r,i,o,a,s,u,c,l,h,f){return 0===n?function(t,e,n,r,i,o,a,s,u,c,l,h){switch(201347067&e.flags){case 1:return function(t,e,n,r,i,o,a,s,u,c,l,h){var f=e.bindings.length,d=!1;return f>0&&Pa(t,e,0,n)&&(d=!0),f>1&&Pa(t,e,1,r)&&(d=!0),f>2&&Pa(t,e,2,i)&&(d=!0),f>3&&Pa(t,e,3,o)&&(d=!0),f>4&&Pa(t,e,4,a)&&(d=!0),f>5&&Pa(t,e,5,s)&&(d=!0),f>6&&Pa(t,e,6,u)&&(d=!0),f>7&&Pa(t,e,7,c)&&(d=!0),f>8&&Pa(t,e,8,l)&&(d=!0),f>9&&Pa(t,e,9,h)&&(d=!0),d}(t,e,n,r,i,o,a,s,u,c,l,h);case 2:return function(t,e,n,r,i,o,a,s,u,c,l,h){var f=!1,d=e.bindings,p=d.length;if(p>0&&Ur(t,e,0,n)&&(f=!0),p>1&&Ur(t,e,1,r)&&(f=!0),p>2&&Ur(t,e,2,i)&&(f=!0),p>3&&Ur(t,e,3,o)&&(f=!0),p>4&&Ur(t,e,4,a)&&(f=!0),p>5&&Ur(t,e,5,s)&&(f=!0),p>6&&Ur(t,e,6,u)&&(f=!0),p>7&&Ur(t,e,7,c)&&(f=!0),p>8&&Ur(t,e,8,l)&&(f=!0),p>9&&Ur(t,e,9,h)&&(f=!0),f){var v=e.text.prefix;p>0&&(v+=ja(n,d[0])),p>1&&(v+=ja(r,d[1])),p>2&&(v+=ja(i,d[2])),p>3&&(v+=ja(o,d[3])),p>4&&(v+=ja(a,d[4])),p>5&&(v+=ja(s,d[5])),p>6&&(v+=ja(u,d[6])),p>7&&(v+=ja(c,d[7])),p>8&&(v+=ja(l,d[8])),p>9&&(v+=ja(h,d[9]));var m=Tr(t,e.nodeIndex).renderText;t.renderer.setValue(m,v)}return f}(t,e,n,r,i,o,a,s,u,c,l,h);case 16384:return function(t,e,n,r,i,o,a,s,u,c,l,h){var f=kr(t,e.nodeIndex),d=f.instance,p=!1,v=void 0,m=e.bindings.length;return m>0&&Fr(t,e,0,n)&&(p=!0,v=io(t,f,e,0,n,v)),m>1&&Fr(t,e,1,r)&&(p=!0,v=io(t,f,e,1,r,v)),m>2&&Fr(t,e,2,i)&&(p=!0,v=io(t,f,e,2,i,v)),m>3&&Fr(t,e,3,o)&&(p=!0,v=io(t,f,e,3,o,v)),m>4&&Fr(t,e,4,a)&&(p=!0,v=io(t,f,e,4,a,v)),m>5&&Fr(t,e,5,s)&&(p=!0,v=io(t,f,e,5,s,v)),m>6&&Fr(t,e,6,u)&&(p=!0,v=io(t,f,e,6,u,v)),m>7&&Fr(t,e,7,c)&&(p=!0,v=io(t,f,e,7,c,v)),m>8&&Fr(t,e,8,l)&&(p=!0,v=io(t,f,e,8,l,v)),m>9&&Fr(t,e,9,h)&&(p=!0,v=io(t,f,e,9,h,v)),v&&d.ngOnChanges(v),65536&e.flags&&xr(t,256,e.nodeIndex)&&d.ngOnInit(),262144&e.flags&&d.ngDoCheck(),p}(t,e,n,r,i,o,a,s,u,c,l,h);case 32:case 64:case 128:return function(t,e,n,r,i,o,a,s,u,c,l,h){var f=e.bindings,d=!1,p=f.length;if(p>0&&Ur(t,e,0,n)&&(d=!0),p>1&&Ur(t,e,1,r)&&(d=!0),p>2&&Ur(t,e,2,i)&&(d=!0),p>3&&Ur(t,e,3,o)&&(d=!0),p>4&&Ur(t,e,4,a)&&(d=!0),p>5&&Ur(t,e,5,s)&&(d=!0),p>6&&Ur(t,e,6,u)&&(d=!0),p>7&&Ur(t,e,7,c)&&(d=!0),p>8&&Ur(t,e,8,l)&&(d=!0),p>9&&Ur(t,e,9,h)&&(d=!0),d){var v,m=Sr(t,e.nodeIndex);switch(201347067&e.flags){case 32:v=new Array(f.length),p>0&&(v[0]=n),p>1&&(v[1]=r),p>2&&(v[2]=i),p>3&&(v[3]=o),p>4&&(v[4]=a),p>5&&(v[5]=s),p>6&&(v[6]=u),p>7&&(v[7]=c),p>8&&(v[8]=l),p>9&&(v[9]=h);break;case 64:v={},p>0&&(v[f[0].name]=n),p>1&&(v[f[1].name]=r),p>2&&(v[f[2].name]=i),p>3&&(v[f[3].name]=o),p>4&&(v[f[4].name]=a),p>5&&(v[f[5].name]=s),p>6&&(v[f[6].name]=u),p>7&&(v[f[7].name]=c),p>8&&(v[f[8].name]=l),p>9&&(v[f[9].name]=h);break;case 128:var y=n;switch(p){case 1:v=y.transform(n);break;case 2:v=y.transform(r);break;case 3:v=y.transform(r,i);break;case 4:v=y.transform(r,i,o);break;case 5:v=y.transform(r,i,o,a);break;case 6:v=y.transform(r,i,o,a,s);break;case 7:v=y.transform(r,i,o,a,s,u);break;case 8:v=y.transform(r,i,o,a,s,u,c);break;case 9:v=y.transform(r,i,o,a,s,u,c,l);break;case 10:v=y.transform(r,i,o,a,s,u,c,l,h)}}m.value=v}return d}(t,e,n,r,i,o,a,s,u,c,l,h);default:throw"unreachable"}}(t,e,r,i,o,a,s,u,c,l,h,f):function(t,e,n){switch(201347067&e.flags){case 1:return function(t,e,n){for(var r=!1,i=0;i<n.length;i++)Pa(t,e,i,n[i])&&(r=!0);return r}(t,e,n);case 2:return function(t,e,n){for(var r=e.bindings,i=!1,o=0;o<n.length;o++)Ur(t,e,o,n[o])&&(i=!0);if(i){for(var a="",s=0;s<n.length;s++)a+=ja(n[s],r[s]);a=e.text.prefix+a;var u=Tr(t,e.nodeIndex).renderText;t.renderer.setValue(u,a)}return i}(t,e,n);case 16384:return function(t,e,n){for(var r=kr(t,e.nodeIndex),i=r.instance,o=!1,a=void 0,s=0;s<n.length;s++)Fr(t,e,s,n[s])&&(o=!0,a=io(t,r,e,s,n[s],a));return a&&i.ngOnChanges(a),65536&e.flags&&xr(t,256,e.nodeIndex)&&i.ngOnInit(),262144&e.flags&&i.ngDoCheck(),o}(t,e,n);case 32:case 64:case 128:return function(t,e,n){for(var r=e.bindings,i=!1,o=0;o<n.length;o++)Ur(t,e,o,n[o])&&(i=!0);if(i){var a,s=Sr(t,e.nodeIndex);switch(201347067&e.flags){case 32:a=n;break;case 64:a={};for(var u=0;u<n.length;u++)a[r[u].name]=n[u];break;case 128:var c=n[0],l=n.slice(1);a=c.transform.apply(c,_toConsumableArray(l))}s.value=a}return i}(t,e,n);default:throw"unreachable"}}(t,e,r)}function ts(t){var e=t.def;if(4&e.nodeFlags)for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n];if(4&r.flags){var i=Cr(t,n).template._projectedViews;if(i)for(var o=0;o<i.length;o++){var a=i[o];a.state|=32,qr(a,t)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function es(t,e,n,r,i,o,a,s,u,c,l,h,f){return 0===n?function(t,e,n,r,i,o,a,s,u,c,l,h){var f=e.bindings.length;f>0&&Vr(t,e,0,n),f>1&&Vr(t,e,1,r),f>2&&Vr(t,e,2,i),f>3&&Vr(t,e,3,o),f>4&&Vr(t,e,4,a),f>5&&Vr(t,e,5,s),f>6&&Vr(t,e,6,u),f>7&&Vr(t,e,7,c),f>8&&Vr(t,e,8,l),f>9&&Vr(t,e,9,h)}(t,e,r,i,o,a,s,u,c,l,h,f):function(t,e,n){for(var r=0;r<n.length;r++)Vr(t,e,r,n[r])}(t,e,r),!1}function ns(t,e){if(Ar(t,e.nodeIndex).dirty)throw br(Ir.createDebugContext(t,e.nodeIndex),"Query ".concat(e.query.id," not dirty"),"Query ".concat(e.query.id," dirty"),0!=(1&t.state))}function rs(t){if(!(128&t.state)){if(as(t,is.Destroy),os(t,is.Destroy),oo(t,131072),t.disposables)for(var e=0;e<t.disposables.length;e++)t.disposables[e]();!function(t){if(16&t.state){var e=zr(t);if(e){var n=e.template._projectedViews;n&&(Ae(n,n.indexOf(t)),Ir.dirtyParentQueries(t))}}}(t),t.renderer.destroyNode&&function(t){for(var e=t.def.nodes.length,n=0;n<e;n++){var r=t.def.nodes[n];1&r.flags?t.renderer.destroyNode(Cr(t,n).renderElement):2&r.flags?t.renderer.destroyNode(Tr(t,n).renderText):(67108864&r.flags||134217728&r.flags)&&Ar(t,n).destroy()}}(t),Kr(t)&&t.renderer.destroy(),t.state|=128}}var is=function(){var t={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return t[t.CreateViewNodes]="CreateViewNodes",t[t.CheckNoChanges]="CheckNoChanges",t[t.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",t[t.CheckAndUpdate]="CheckAndUpdate",t[t.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",t[t.Destroy]="Destroy",t}();function os(t,e){var n=t.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var i=n.nodes[r];33554432&i.flags?ss(Cr(t,r).componentView,e):0==(33554432&i.childFlags)&&(r+=i.childCount)}}function as(t,e){var n=t.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var i=n.nodes[r];if(16777216&i.flags)for(var o=Cr(t,r).viewContainer._embeddedViews,a=0;a<o.length;a++)ss(o[a],e);else 0==(16777216&i.childFlags)&&(r+=i.childCount)}}function ss(t,e){var n=t.state;switch(e){case is.CheckNoChanges:0==(128&n)&&(12==(12&n)?Ja(t):64&n&&us(t,is.CheckNoChangesProjectedViews));break;case is.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?Ja(t):64&n&&us(t,e));break;case is.CheckAndUpdate:0==(128&n)&&(12==(12&n)?Za(t):64&n&&us(t,is.CheckAndUpdateProjectedViews));break;case is.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?Za(t):64&n&&us(t,e));break;case is.Destroy:rs(t);break;case is.CreateViewNodes:Qa(t)}}function us(t,e){as(t,e),os(t,e)}function cs(t,e,n,r){if(t.def.nodeFlags&e&&t.def.nodeFlags&n)for(var i=t.def.nodes.length,o=0;o<i;o++){var a=t.def.nodes[o];if(a.flags&e&&a.flags&n)switch(Ir.setCurrentNode(t,a.nodeIndex),r){case 0:Ra(t,a);break;case 1:ns(t,a)}a.childFlags&e&&a.childFlags&n||(o+=a.childCount)}}var ls=!1;function hs(t,e,n,r,i,o){var a=i.injector.get(Xn);return Wa(ds(t,i,a,e,n),r,o)}function fs(t,e,n,r,i,o){var a=i.injector.get(Xn),s=ds(t,i,new Hs(a),e,n),u=xs(r);return Gs(Ds.create,Wa,null,[s,u,o])}function ds(t,e,n,r,i){var o=e.injector.get(ln),a=e.injector.get(Be),s=n.createRenderer(null,null);return{ngModule:e,injector:t,projectableNodes:r,selectorOrNode:i,sanitizer:o,rendererFactory:n,renderer:s,errorHandler:a}}function ps(t,e,n,r){var i=xs(n);return Gs(Ds.create,Ha,null,[t,e,i,r])}function vs(t,e,n,r){return n=bs.get(e.element.componentProvider.provider.token)||xs(n),Gs(Ds.create,Ka,null,[t,e,n,r])}function ms(t,e,n,r){return Mi(t,e,n,function(t){var e=function(t){var e=!1,n=!1;return 0===ys.size?{hasOverrides:e,hasDeprecatedOverrides:n}:(t.providers.forEach((function(t){var r=ys.get(t.token);3840&t.flags&&r&&(e=!0,n=n||r.deprecatedBehavior)})),t.modules.forEach((function(t){gs.forEach((function(r,i){ne(i).providedIn===t&&(e=!0,n=n||r.deprecatedBehavior)}))})),{hasOverrides:e,hasDeprecatedOverrides:n})}(t),n=e.hasOverrides,r=e.hasDeprecatedOverrides;return n?(function(t){for(var e=0;e<t.providers.length;e++){var n=t.providers[e];r&&(n.flags|=4096);var i=ys.get(n.token);i&&(n.flags=-3841&n.flags|i.flags,n.deps=Jr(i.deps),n.value=i.value)}if(gs.size>0){var o=new Set(t.modules);gs.forEach((function(e,n){if(o.has(ne(n).providedIn)){var i={token:n,flags:e.flags|(r?4096:0),deps:Jr(e.deps),value:e.value,index:t.providers.length};t.providers.push(i),t.providersByKey[Dr(n)]=i}}))}}(t=t.factory((function(){return Or}))),t):t}(r))}var ys=new Map,gs=new Map,bs=new Map;function _s(t){var e;ys.set(t.token,t),"function"==typeof t.token&&(e=ne(t.token))&&"function"==typeof e.providedIn&&gs.set(t.token,t)}function ws(t,e){var n=ti(e.viewDefFactory),r=ti(n.nodes[0].element.componentView);bs.set(t,r)}function Es(){ys.clear(),gs.clear(),bs.clear()}function xs(t){if(0===ys.size)return t;var e=function(t){for(var e=[],n=null,r=0;r<t.nodes.length;r++){var i=t.nodes[r];1&i.flags&&(n=i),n&&3840&i.flags&&ys.has(i.provider.token)&&(e.push(n.nodeIndex),n=null)}return e}(t);if(0===e.length)return t;t=t.factory((function(){return Or}));for(var n=0;n<e.length;n++)r(t,e[n]);return t;function r(t,e){for(var n=e+1;n<t.nodes.length;n++){var r=t.nodes[n];if(1&r.flags)return;if(3840&r.flags){var i=r.provider,o=ys.get(i.token);o&&(r.flags=-3841&r.flags|o.flags,i.deps=Jr(o.deps),i.value=o.value)}}}}function Ts(t,e,n,r,i,o,a,s,u,c,l,h,f){var d=t.def.nodes[e];return $a(t,d,n,r,i,o,a,s,u,c,l,h,f),224&d.flags?Sr(t,e).value:void 0}function Cs(t,e,n,r,i,o,a,s,u,c,l,h,f){var d=t.def.nodes[e];return es(t,d,n,r,i,o,a,s,u,c,l,h,f),224&d.flags?Sr(t,e).value:void 0}function ks(t){return Gs(Ds.detectChanges,Za,null,[t])}function Ss(t){return Gs(Ds.checkNoChanges,Ja,null,[t])}function As(t){return Gs(Ds.destroy,rs,null,[t])}var Is,Os,Ps,Ds=function(){var t={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return t[t.create]="create",t[t.detectChanges]="detectChanges",t[t.checkNoChanges]="checkNoChanges",t[t.destroy]="destroy",t[t.handleEvent]="handleEvent",t}();function Ns(t,e){Os=t,Ps=e}function Rs(t,e,n,r){return Ns(t,e),Gs(Ds.handleEvent,t.def.handleEvent,null,[t,e,n,r])}function Ms(t,e){if(128&t.state)throw wr(Ds[Is]);return Ns(t,Us(t,0)),t.def.updateDirectives((function(t,n,r){for(var i=t.def.nodes[n],o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];return 0===e?Bs(t,i,r,a):Fs(t,i,r,a),16384&i.flags&&Ns(t,Us(t,n)),224&i.flags?Sr(t,i.nodeIndex).value:void 0}),t)}function Ls(t,e){if(128&t.state)throw wr(Ds[Is]);return Ns(t,Vs(t,0)),t.def.updateRenderer((function(t,n,r){for(var i=t.def.nodes[n],o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];return 0===e?Bs(t,i,r,a):Fs(t,i,r,a),3&i.flags&&Ns(t,Vs(t,n)),224&i.flags?Sr(t,i.nodeIndex).value:void 0}),t)}function Bs(t,e,n,r){if($a.apply(void 0,[t,e,n].concat(_toConsumableArray(r)))){var i=1===n?r[0]:r;if(16384&e.flags){for(var o={},a=0;a<e.bindings.length;a++){var s=e.bindings[a],u=i[a];8&s.flags&&(o[(d=s.nonMinifiedName,p=void 0,p=d.replace(/[$@]/g,"_"),"ng-reflect-".concat(d=p.replace(dn,(function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return"-"+e[1].toLowerCase()}))))]=pn(u))}var c=e.parent,l=Cr(t,c.nodeIndex).renderElement;if(c.element.name)for(var h in o){var f=o[h];null!=f?t.renderer.setAttribute(l,h,f):t.renderer.removeAttribute(l,h)}else t.renderer.setValue(l,"bindings=".concat(JSON.stringify(o,null,2)))}}var d,p}function Fs(t,e,n,r){es.apply(void 0,[t,e,n].concat(_toConsumableArray(r)))}function Us(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function Vs(t,e){for(var n=e;n<t.def.nodes.length;n++){var r=t.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var js=function(){function t(e,n){_classCallCheck2(this,t),this.view=e,this.nodeIndex=n,null==n&&(this.nodeIndex=n=0),this.nodeDef=e.def.nodes[n];for(var r=this.nodeDef,i=e;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&i;)r=Hr(i),i=i.parent;this.elDef=r,this.elView=i}return _createClass2(t,[{key:"logError",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i,o;2&this.nodeDef.flags?(i=this.view.def,o=this.nodeDef.nodeIndex):(i=this.elView.def,o=this.elDef.nodeIndex);var a=function(t,e){for(var n=-1,r=0;r<=e;r++)3&t.nodes[r].flags&&n++;return n}(i,o),s=-1;i.factory((function(){var e;return++s===a?(e=t.error).bind.apply(e,[t].concat(n)):Or})),s<a&&(t.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),t.error.apply(t,n))}},{key:"elOrCompView",get:function(){return Cr(this.elView,this.elDef.nodeIndex).componentView||this.view}},{key:"injector",get:function(){return Oi(this.elView,this.elDef)}},{key:"component",get:function(){return this.elOrCompView.component}},{key:"context",get:function(){return this.elOrCompView.context}},{key:"providerTokens",get:function(){var t=[];if(this.elDef)for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&t.push(n.provider.token),e+=n.childCount}return t}},{key:"references",get:function(){var t={};if(this.elDef){qs(this.elView,this.elDef,t);for(var e=this.elDef.nodeIndex+1;e<=this.elDef.nodeIndex+this.elDef.childCount;e++){var n=this.elView.def.nodes[e];20224&n.flags&&qs(this.elView,n,t),e+=n.childCount}}return t}},{key:"componentRenderElement",get:function(){var t=function(t){for(;t&&!Kr(t);)t=t.parent;return t.parent?Cr(t.parent,Hr(t).nodeIndex):null}(this.elOrCompView);return t?t.renderElement:void 0}},{key:"renderNode",get:function(){return 2&this.nodeDef.flags?Wr(this.view,this.nodeDef):Wr(this.elView,this.elDef)}}]),t}();function qs(t,e,n){for(var r in e.references)n[r]=La(t,e,e.references[r])}function Gs(t,e,n,r){var i,o,a=Is,s=Os,u=Ps;try{Is=t;var c=e.apply(n,r);return Os=s,Ps=u,Is=a,c}catch(l){if(Re(l)||!Os)throw l;throw i=l,o=zs(),i instanceof Error||(i=new Error(i.toString())),_r(i,o),i}}function zs(){return Os?new js(Os,Ps):null}var Hs=function(){function t(e){_classCallCheck2(this,t),this.delegate=e}return _createClass2(t,[{key:"createRenderer",value:function(t,e){return new Ws(this.delegate.createRenderer(t,e))}},{key:"begin",value:function(){this.delegate.begin&&this.delegate.begin()}},{key:"end",value:function(){this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}]),t}(),Ws=function(){function t(e){_classCallCheck2(this,t),this.delegate=e,this.debugContextFactory=zs,this.data=this.delegate.data}return _createClass2(t,[{key:"createDebugContext",value:function(t){return this.debugContextFactory(t)}},{key:"destroyNode",value:function(t){var e=ya(t);!function(t){ma.delete(t.nativeNode)}(e),e instanceof pa&&(e.listeners.length=0),this.delegate.destroyNode&&this.delegate.destroyNode(t)}},{key:"destroy",value:function(){this.delegate.destroy()}},{key:"createElement",value:function(t,e){var n=this.delegate.createElement(t,e),r=this.createDebugContext(n);if(r){var i=new va(n,null,r);i.name=t,ba(i)}return n}},{key:"createComment",value:function(t){var e=this.delegate.createComment(t),n=this.createDebugContext(e);return n&&ba(new pa(e,null,n)),e}},{key:"createText",value:function(t){var e=this.delegate.createText(t),n=this.createDebugContext(e);return n&&ba(new pa(e,null,n)),e}},{key:"appendChild",value:function(t,e){var n=ya(t),r=ya(e);n&&r&&n instanceof va&&n.addChild(r),this.delegate.appendChild(t,e)}},{key:"insertBefore",value:function(t,e,n){var r=ya(t),i=ya(e),o=ya(n);r&&i&&r instanceof va&&r.insertBefore(o,i),this.delegate.insertBefore(t,e,n)}},{key:"removeChild",value:function(t,e){var n=ya(t),r=ya(e);n&&r&&n instanceof va&&n.removeChild(r),this.delegate.removeChild(t,e)}},{key:"selectRootElement",value:function(t,e){var n=this.delegate.selectRootElement(t,e),r=zs();return r&&ba(new va(n,null,r)),n}},{key:"setAttribute",value:function(t,e,n,r){var i=ya(t);i&&i instanceof va&&(i.attributes[r?r+":"+e:e]=n),this.delegate.setAttribute(t,e,n,r)}},{key:"removeAttribute",value:function(t,e,n){var r=ya(t);r&&r instanceof va&&(r.attributes[n?n+":"+e:e]=null),this.delegate.removeAttribute(t,e,n)}},{key:"addClass",value:function(t,e){var n=ya(t);n&&n instanceof va&&(n.classes[e]=!0),this.delegate.addClass(t,e)}},{key:"removeClass",value:function(t,e){var n=ya(t);n&&n instanceof va&&(n.classes[e]=!1),this.delegate.removeClass(t,e)}},{key:"setStyle",value:function(t,e,n,r){var i=ya(t);i&&i instanceof va&&(i.styles[e]=n),this.delegate.setStyle(t,e,n,r)}},{key:"removeStyle",value:function(t,e,n){var r=ya(t);r&&r instanceof va&&(r.styles[e]=null),this.delegate.removeStyle(t,e,n)}},{key:"setProperty",value:function(t,e,n){var r=ya(t);r&&r instanceof va&&(r.properties[e]=n),this.delegate.setProperty(t,e,n)}},{key:"listen",value:function(t,e,n){if("string"!=typeof t){var r=ya(t);r&&r.listeners.push(new da(e,n))}return this.delegate.listen(t,e,n)}},{key:"parentNode",value:function(t){return this.delegate.parentNode(t)}},{key:"nextSibling",value:function(t){return this.delegate.nextSibling(t)}},{key:"setValue",value:function(t,e){return this.delegate.setValue(t,e)}}]),t}();var Ks=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).moduleType=t,i._bootstrapComponents=n,i._ngModuleDefFactory=r,i}return _inherits(e,t),_createClass2(e,[{key:"create",value:function(t){!function(){if(!ls){ls=!0;var t=Ve()?{setCurrentNode:Ns,createRootView:fs,createEmbeddedView:ps,createComponentView:vs,createNgModuleRef:ms,overrideProvider:_s,overrideComponentView:ws,clearOverrides:Es,checkAndUpdateView:ks,checkNoChangesView:Ss,destroyView:As,createDebugContext:function(t,e){return new js(t,e)},handleEvent:Rs,updateDirectives:Ms,updateRenderer:Ls}:{setCurrentNode:function(){},createRootView:hs,createEmbeddedView:Ha,createComponentView:Ka,createNgModuleRef:Mi,overrideProvider:Or,overrideComponentView:Or,clearOverrides:Or,checkAndUpdateView:Za,checkNoChangesView:Ja,destroyView:rs,createDebugContext:function(t,e){return new js(t,e)},handleEvent:function(t,e,n,r){return t.def.handleEvent(t,e,n,r)},updateDirectives:function(t,e){return t.def.updateDirectives(0===e?Ts:Cs,t)},updateRenderer:function(t,e){return t.def.updateRenderer(0===e?Ts:Cs,t)}};Ir.setCurrentNode=t.setCurrentNode,Ir.createRootView=t.createRootView,Ir.createEmbeddedView=t.createEmbeddedView,Ir.createComponentView=t.createComponentView,Ir.createNgModuleRef=t.createNgModuleRef,Ir.overrideProvider=t.overrideProvider,Ir.overrideComponentView=t.overrideComponentView,Ir.clearOverrides=t.clearOverrides,Ir.checkAndUpdateView=t.checkAndUpdateView,Ir.checkNoChangesView=t.checkNoChangesView,Ir.destroyView=t.destroyView,Ir.resolveDep=no,Ir.createDebugContext=t.createDebugContext,Ir.handleEvent=t.handleEvent,Ir.updateDirectives=t.updateDirectives,Ir.updateRenderer=t.updateRenderer,Ir.dirtyParentQueries=Na}}();var e=function(t){var e=Array.from(t.providers),n=Array.from(t.modules),r={};for(var i in t.providersByKey)r[i]=t.providersByKey[i];return{factory:t.factory,isRoot:t.isRoot,providers:e,modules:n,providersByKey:r}}(ti(this._ngModuleDefFactory));return Ir.createNgModuleRef(this.moduleType,t||bn.NULL,this._bootstrapComponents,e)}}]),e}(ke),Xs={production:!0,rewardVideoId:"ca-app-pub-7811559275890870/3956102909"},Ys=function t(){_classCallCheck2(this,t)},Qs=n("mrSG"),Js=function(t){return t[t.NEW_GAME=0]="NEW_GAME",t[t.RESUME_GAME=1]="RESUME_GAME",t[t.MAP_EDITOR=2]="MAP_EDITOR",t[t.START_MENU=3]="START_MENU",t[t.AI_TRANSFER=4]="AI_TRANSFER",t}({}),Zs=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"initConfig",value:function(t,e){if(window.admob)return window.admob[e].load(t)}},{key:"interstitial",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.interstitialConfig;return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initConfig(t,"interstitial");case 2:return e.abrupt("return",this._interstitial());case 3:case"end":return e.stop()}}),e,this)})))}},{key:"_interstitial",value:function(){return new Promise((function(t,e){document.addEventListener("admob.interstitial.close",(function(){t()}),!1),document.addEventListener("admob.interstitial.load_fail",(function(){e(new Error("Interstitial load fail."))}),!1),window.admob.interstitial.show()}))}},{key:"rewardVideo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rewardVideoConfig;return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initConfig(t,"rewardVideo");case 2:return e.abrupt("return",this._rewardVideo());case 3:case"end":return e.stop()}}),e,this)})))}},{key:"_rewardVideo",value:function(){return new Promise((function(t,e){var n=!1;document.addEventListener("admob.reward_video.close",(function(){t(n)}),!1),document.addEventListener("admob.reward_video.load_fail",(function(){e(new Error("Reward video load failed."))}),!1),document.addEventListener("admob.reward_video.reward",(function(){n=!0}),!1),window.admob.rewardVideo.show()}))}}]),t}(),$s=function(){function t(){_classCallCheck2(this,t),this.AppRate=window.AppRate,this.AppRate&&(this.AppRate.preferences.storeAppURL={android:"https://play.google.com/store/apps/details?id=com.laCosaNostra.tanks"})}return _createClass2(t,[{key:"prompt",value:function(){this.AppRate&&this.AppRate.promptForRating()}}]),t}(),tu="object"==typeof global&&global&&global.Object===Object&&global,eu="object"==typeof self&&self&&self.Object===Object&&self,nu=(tu||eu||Function("return this")()).Symbol,ru=Object.prototype,iu=ru.hasOwnProperty,ou=ru.toString,au=nu?nu.toStringTag:void 0,su=Object.prototype.toString,uu=nu?nu.toStringTag:void 0,cu=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object),lu=Function.prototype,hu=Object.prototype,fu=lu.toString,du=hu.hasOwnProperty,pu=fu.call(Object),vu=function(t){if(!function(t){return null!=t&&"object"==typeof t}(t)||"[object Object]"!=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":uu&&uu in Object(t)?function(t){var e=iu.call(t,au),n=t[au];try{t[au]=void 0;var r=!0}catch(o){}var i=ou.call(t);return r&&(e?t[au]=n:delete t[au]),i}(t):function(t){return su.call(t)}(t)}(t))return!1;var e=cu(t);if(null===e)return!0;var n=du.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&fu.call(n)==pu},mu=n("bCCX"),yu={INIT:"@@redux/INIT"};function gu(t,e,n){var r;if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(gu)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var i=t,o=e,a=[],s=a,u=!1;function c(){s===a&&(s=a.slice())}function l(){return o}function h(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var e=!0;return c(),s.push(t),function(){if(e){e=!1,c();var n=s.indexOf(t);s.splice(n,1)}}}function f(t){if(!vu(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(u)throw new Error("Reducers may not dispatch actions.");try{u=!0,o=i(o,t)}finally{u=!1}for(var e=a=s,n=0;n<e.length;n++)(0,e[n])();return t}return f({type:yu.INIT}),(r={dispatch:f,subscribe:h,getState:l,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");i=t,f({type:yu.INIT})}})[mu.a]=function(){var t,e=h;return(t={subscribe:function(t){if("object"!=typeof t)throw new TypeError("Expected the observer to be an object.");function n(){t.next&&t.next(l())}return n(),{unsubscribe:e(n)}}})[mu.a]=function(){return this},t},r}function bu(t,e){var n=e&&e.type;return"Given action "+(n&&'"'+n.toString()+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function _u(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var i=e[r];"function"==typeof t[i]&&(n[i]=t[i])}var o=Object.keys(n),a=void 0;try{!function(t){Object.keys(t).forEach((function(e){var n=t[e];if(void 0===n(void 0,{type:yu.INIT}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===n(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+yu.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(n)}catch(s){a=s}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(a)throw a;for(var r=!1,i={},s=0;s<o.length;s++){var u=o[s],c=n[u],l=t[u],h=c(l,e);if(void 0===h){var f=bu(u,e);throw new Error(f)}i[u]=h,r=r||h!==l}return r?i:t}}function wu(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}var Eu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function xu(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(n,r,i){var o,a=t(n,r,i),s=a.dispatch,u={getState:a.getState,dispatch:function(t){return s(t)}};return o=e.map((function(t){return t(u)})),s=wu.apply(void 0,o)(a.dispatch),Eu({},a,{dispatch:s})}}}function Tu(t,e,n,r,i,o){if("undefined"!=typeof window)return arguments.length>1?document.cookie="".concat(t,"=").concat(encodeURIComponent(e)).concat(n?"; expires=".concat(new Date(+new Date+1e3*n).toUTCString()):"").concat(r?"; path=".concat(r):"").concat(i?"; domain=".concat(i):"").concat(o?"; secure":""):decodeURIComponent(("; ".concat(document.cookie).split("; ".concat(t,"="))[1]||"").split(";")[0])}var Cu=Tu,ku=Tu;function Su(t){return(Su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Au(t){var e;try{void 0===(e=JSON.parse(t))&&(e=t),"true"===e&&(e=!0),"false"===e&&(e=!1),parseFloat(e)===e&&"object"!==Su(e)&&(e=parseFloat(e))}catch(n){e=t}return e}function Iu(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==this?this:{}}var Ou="localStorage",Pu="cookie",Du=function(){try{if("undefined"==typeof localStorage||"undefined"==typeof JSON)return!1;localStorage.setItem("__test","1"),localStorage.removeItem("__test")}catch(t){return!1}return!0}(),Nu=function(){try{Tu("___c","1");var t=-1!==document.cookie.indexOf("___c");return Tu("___c","",-1),t}catch(e){return!1}}();function Ru(t){return"string"==typeof t?t:t.storage}function Mu(t){return Du&&(!t||t===Ou)}function Lu(t){return Nu&&(!t||t===Pu)}var Bu={getItem:function(t){if(!t)return null;var e=Ru(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});if("all"===e)return function(t){return{cookie:Au(Cu(t)),localStorage:Au(localStorage.getItem(t)),global:Iu[t]||null}}(t);if(Mu(e)){var n=localStorage.getItem(t);if(n||e===Ou)return Au(n)}if(Lu(e)){var r=Cu(t);if(r||e===Pu)return Au(r)}return Iu[t]||null},setItem:function(t,e){if(!t||!e)return!1;var n=Ru(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}),r=JSON.stringify(e);if(Mu(n)){var i=Au(localStorage.getItem(t));return localStorage.setItem(t,r),{value:e,oldValue:i,location:Ou}}if(Lu(n)){var o=Au(Cu(t));return ku(t,r),{value:e,oldValue:o,location:Pu}}var a=Iu[t];return Iu[t]=e,{value:e,oldValue:a,location:"global"}},removeItem:function(t){if(!t)return!1;var e=Ru(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return Mu(e)?(localStorage.removeItem(t),Ou):Lu(e)?(Tu(t,"",-1),Pu):(Iu[t]=null,"global")}};function Fu(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return null}}var Uu="undefined"!=typeof window;function Vu(t){var e=function(t){if(t){var e=t.match(/\?(.*)/);return e&&e[1]?e[1].split("#")[0]:""}return Uu&&window.location.search.substring(1)}(t);return e?function(t){for(var e,n=/([^&=]+)=?([^&]*)/g,r={};e=n.exec(t);){var i=Fu(e[1]),o=Fu(e[2]);"[]"===i.substring(i.length-2)?(r[i=i.substring(0,i.length-2)]||(r[i]=[])).push(o):r[i]=""===o||o}for(var a in r){var s=a.split("[");if(s.length>1){var u=[];s.forEach((function(t,e){var n=t.replace(/[?[\]\\ ]/g,"");u.push(n)})),ju(r,u,r[a]),delete r[a]}}return r}(e):{}}function ju(t,e,n){for(var r=e.length-1,i=0;i<r;++i){var o=e[i];o in t||(t[o]={}),t=t[o]}t[e[r]]=n}function qu(){for(var t,e,n,r,i=[],o=0;o<256;o++)i[o]=(o<16?"0":"")+o.toString(16);return t=Gu(),e=Gu(),n=Gu(),r=Gu(),"".concat(i[255&t]+i[t>>8&255]+i[t>>16&255]+i[t>>24&255],"-").concat(i[255&e]).concat(i[e>>8&255],"-").concat(i[e>>16&15|64]).concat(i[e>>24&255],"-").concat(i[63&n|128]).concat(i[n>>8&255],"-").concat(i[n>>16&255]).concat(i[n>>24&255]).concat(i[255&r]).concat(i[r>>8&255]).concat(i[r>>16&255]).concat(i[r>>24&255])}function Gu(){return 4294967295*Math.random()|0}"undefined"!=typeof self&&self?self:"undefined"!=typeof window&&window?window:"undefined"!=typeof global&&global?global:"undefined"!=typeof globalThis&&globalThis&&globalThis;var zu=function(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()};function Hu(t,e){return t(e={exports:{}},e.exports),e.exports}var Wu=Hu((function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(r){return t.exports=n="function"==typeof Symbol&&"symbol"===e(Symbol.iterator)?function(t){return e(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":e(t)},n(r)}t.exports=n})),Ku=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};function Xu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Yu=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Xu(n,!0).forEach((function(e){Ku(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Xu(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t},Qu=["bootstrap","params","campaign","initializeStart","initialize","initializeEnd","ready","resetStart","reset","resetEnd","pageStart","page","pageEnd","pageAborted","trackStart","track","trackEnd","trackAborted","identifyStart","identify","identifyEnd","identifyAborted","userIdChanged","registerPlugins","enablePlugin","disablePlugin","loadPlugin","online","offline","setItemStart","setItem","setItemEnd","setItemAborted","removeItemStart","removeItem","removeItemEnd","removeItemAborted"],Ju=["name","EVENTS","config","loaded"],Zu=Qu.reduce((function(t,e){return t[e]=e,t}),{registerPluginType:function(t){return"registerPlugin:".concat(t)},pluginReadyType:function(t){return"ready:".concat(t)}}),$u="__anon_id",tc="__user_id",ec="__user_traits",nc=/^utm_/,rc=/^an_prop_/,ic=/^an_trait_/;function oc(t){return function(e){return function(n){return function(r){if(r.type===Zu.bootstrap){var i=r.params,o=r.user;Bu.getItem($u)||t.storage.setItem($u,o.anonymousId);var a=Object.keys(r.params);if(a.length){var s=i.an_uid,u=i.an_event,c=a.reduce((function(t,e){if(e.match(nc)||e.match(/^(d|g)clid/)){var n=e.replace(nc,"");t.campaign["campaign"===n?"name":n]=i[e]}return e.match(rc)&&(t.props["".concat(e.replace(rc,""))]=i[e]),e.match(ic)&&(t.traits["".concat(e.replace(ic,""))]=i[e]),t}),{campaign:{},props:{},traits:{}});e.dispatch(Yu({type:Zu.params,raw:i},c,{},s?{userId:s}:{})),s&&setTimeout((function(){return t.identify(s,c.traits)}),0),u&&setTimeout((function(){return t.track(u,c.props)}),0),Object.keys(c.campaign).length&&e.dispatch({type:Zu.campaign,campaign:c.campaign})}}return n(r)}}}}function ac(t){return"function"==typeof t}function sc(t){var e=t.storage,n=e.setItem,r=e.removeItem,i=e.getItem;return function(t){return function(e){return function(o){var a=o.userId,s=o.traits,u=o.options,c=o.callback;if(o.type===Zu.reset&&([tc,ec,$u].forEach((function(t){return r(t)})),ac(c)&&c()),o.type===Zu.identify){var l=i(tc),h=i(ec)||{};l&&l!==a&&t.dispatch({type:Zu.userIdChanged,old:{userId:l,traits:h},new:{userId:a,traits:s},options:u}),a&&n(tc,a),s&&n(ec,Yu({},h,{},s))}return e(o)}}}}var uc=Hu((function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,n,r){var i=Object.create((e&&e.prototype instanceof v?e:v).prototype),o=new S(r||[]);return i._invoke=function(t,e,n){var r=l;return function(i,o){if(r===f)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var u=c(t,e,n);if("normal"===u.type){if(r=n.done?d:h,u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(t,n,o),i}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(r){return{type:"throw",arg:r}}}t.wrap=u;var l="suspendedStart",h="suspendedYield",f="executing",d="completed",p={};function v(){}function m(){}function y(){}var g={};g[o]=function(){return this};var b=Object.getPrototypeOf,_=b&&b(b(A([])));_&&_!==n&&r.call(_,o)&&(g=_);var w=y.prototype=v.prototype=Object.create(g);function E(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function x(t){var e;this._invoke=function(n,i){function o(){return new Promise((function(e,o){!function e(n,i,o,a){var s=c(t[n],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then((function(t){e("next",t,o,a)}),(function(t){e("throw",t,o,a)})):Promise.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return e("throw",t,o,a)}))}a(s.arg)}(n,i,e,o)}))}return e=e?e.then(o,o):o()}}function T(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=c(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,p;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,p):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function A(t){if(t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:I}}function I(){return{value:e,done:!0}}return m.prototype=w.constructor=y,y.constructor=m,y[s]=m.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},E(x.prototype),x.prototype[a]=function(){return this},t.AsyncIterator=x,t.async=function(e,n,r,i){var o=new x(u(e,n,r,i));return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},E(w),w[s]="Generator",w[o]=function(){return this},w.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=A,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;k(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),p}},t}(t.exports);try{regeneratorRuntime=e}catch(n){Function("r","regeneratorRuntime = r")(e)}}));function cc(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(c){return void n(c)}s.done?e(u):Promise.resolve(u).then(r,i)}var lc=function(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){cc(o,r,i,a,s,"next",t)}function s(t){cc(o,r,i,a,s,"throw",t)}a(void 0)}))}};function hc(t,e,n){return new Promise((function(r,i){return e()?r(t):n<1?i(Yu({},t,{queue:!0})):new Promise((function(t){return setTimeout(t,10)})).then((function(o){return hc(t,e,n-10).then(r,i)}))}))}var fc="userId",dc="anonymousId",pc="https://lytics.dev/errors/";function vc(t,e,n){var r=e(),i=t.getState(),o=i.plugins,a=i.queue,s=i.user;if(!i.context.offline&&a&&a.actions&&a.actions.length){var u=a.actions.reduce((function(t,e,n){return o[e.plugin].loaded?(t.process.push(e),t.processIndex.push(n)):(t.requeue.push(e),t.requeueIndex.push(n)),t}),{processIndex:[],process:[],requeue:[],requeueIndex:[]});if(u.processIndex&&u.processIndex.length){u.processIndex.forEach((function(e){var i=a.actions[e],u=i.plugin,c=i.payload.type,l=r[u][c];if(l&&ac(l)){var h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[fc,dc].reduce((function(t,n){return function(t,e,n){return t.hasOwnProperty(n)&&!t[n]&&e[n]?Object.assign({},t,Ku({},"".concat(n),e[n])):t}(t,e,n)}),t)}(i.payload,s);l({payload:h,config:o[u].config,instance:n});var f="".concat(c,":").concat(u);t.dispatch(Yu({},h,{type:f,_:{called:f,from:"queueDrain"}}))}}));var c=a.actions.filter((function(t,e){return!~u.processIndex.indexOf(e)}));a.actions=c}}}var mc=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()};function yc(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object.keys(t).filter((function(t){var r=n.plugins||{};return!1!==r[t]&&(!0===r[t]||!e[t]||!1!==e[t].enabled)})).map((function(e){return t[e]}))}function gc(t){return"object"===Wu(t)}function bc(t){return"string"==typeof t}var _c=/Start$/,wc=/^bootstrap/,Ec=/^ready/;function xc(t,e,n,r,i){return Tc.apply(this,arguments)}function Tc(){return(Tc=lc(uc.mark((function t(e,n,r,i,o){var a,s,u,c,l,h,f,d,p,v,m,y;return uc.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=ac(n)?n():n,u=(s=e.type).replace(_c,""),!e._||!e._.called){t.next=5;break}return t.abrupt("return",e);case 5:return c=r.getState(),l=yc(a,c.plugins,e.options),h=l.map((function(t){return t.name})),f=Dc(s,l),t.next=11,kc({action:e,data:{exact:f.before,namespaced:f.beforeNS},state:c,allPlugins:a,allMatches:f,instance:r,store:i,EVENTS:o});case 11:if(!Rc(d=t.sent,h.length)){t.next=14;break}return t.abrupt("return",d);case 14:if(s!==u){t.next=18;break}p=d,t.next=21;break;case 18:return t.next=20,kc({action:Yu({},d,{type:u}),data:{exact:f.during,namespaced:f.duringNS},state:c,allPlugins:a,allMatches:f,instance:r,store:i,EVENTS:o});case 20:p=t.sent;case 21:if(!s.match(_c)){t.next=28;break}return v="".concat(u,"End"),t.next=25,kc({action:Yu({},p,{type:v}),data:{exact:f.after,namespaced:f.afterNS},state:c,allPlugins:a,allMatches:f,instance:r,store:i,EVENTS:o});case 25:(y=Cc(m=t.sent))&&y({payload:m});case 28:return t.abrupt("return",d);case 29:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Cc(t){return!!t.meta&&Object.keys(t.meta).reduce((function(e,n){var r=t.meta[n];return ac(r)?r:e}),!1)}function kc(t){return Sc.apply(this,arguments)}function Sc(){return(Sc=lc(uc.mark((function t(e){var n,r,i,o,a,s,u,c,l,h,f,d,p,v,m,y,g,b;return uc.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.data,i=e.instance,a=e.allPlugins,s=e.allMatches,u=e.store,c=e.EVENTS,l=(o=e.state).plugins,h=o.context,d=(f=(r=e.action).type).match(_c),p=n.exact.map((function(t){return t.pluginName})),d&&(p=s.during.map((function(t){return t.pluginName}))),v=Bc(i,p),m=n.exact.reduce((function(t,e){var n=e.pluginName,r=e.methodName,i=!1;return r.match(/^initialize/)||r.match(/^reset/)||(i=!l[n].loaded),h.offline&&(r.match(/^page/)||r.match(/^track/)||r.match(/^identify/))&&(i=!0),t["".concat(n)]=i,t}),{}),t.next=10,n.exact.reduce(function(){var t=lc(uc.mark((function t(e,o,s){var u,c;return uc.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=o.pluginName,t.next=3,e;case 3:if(c=t.sent,!n.namespaced||!n.namespaced[u]){t.next=11;break}return t.next=7,n.namespaced[u].reduce(function(){var t=lc(uc.mark((function t(e,n,r){var o,s,c,h;return uc.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=function(t,e,n){return function(r,i){return Yu({},t,{abort:{reason:r,plugins:i||[e],caller:f,from:n||e}})}},t.next=3,e;case 3:if(o=t.sent,n.method&&ac(n.method)){t.next=6;break}return t.abrupt("return",o);case 6:return Fc(n.methodName,n.pluginName),t.next=9,n.method({payload:o,instance:i,abort:s(o,u,n.pluginName),config:Ic(u,l,a),plugins:l});case 9:return h=gc(c=t.sent)?c:{},t.abrupt("return",Promise.resolve(Yu({},o,{},h)));case 12:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),Promise.resolve(r));case 7:c[u]=t.sent,t.next=12;break;case 11:c[u]=r;case 12:return t.abrupt("return",Promise.resolve(c));case 13:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),Promise.resolve({}));case 10:return y=t.sent,t.next=13,n.exact.reduce(function(){var t=lc(uc.mark((function t(e,r,o){var s,c,h,p,g,b,_,w,E,x,T;return uc.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=n.exact.length===o+1,h=a[c=r.pluginName],t.next=5,e;case 5:if(p=t.sent,g=y[c]?y[c]:{},d&&(g=p),!Nc(g,c)){t.next=11;break}return Ac({data:g,method:f,instance:i,pluginName:c,store:u}),t.abrupt("return",Promise.resolve(p));case 11:if(!Nc(p,c)){t.next=14;break}return s&&Ac({data:p,method:f,instance:i,store:u}),t.abrupt("return",Promise.resolve(p));case 14:if(!m.hasOwnProperty(c)||!0!==m[c]){t.next=17;break}return u.dispatch({type:"queue",plugin:c,payload:g,_:{called:"queue",from:"queueMechanism"}}),t.abrupt("return",Promise.resolve(p));case 17:return b=v(y[c],a[c]),t.next=20,h[f]({hello:c,abort:b.abort,payload:g,instance:i,config:Ic(c,l,a),plugins:l});case 20:return w=gc(_=t.sent)?_:{},E=Yu({},p,{},w),Nc(x=y[c],c)?Ac({data:x,method:f,instance:i,pluginName:c,store:u}):((T="".concat(f,":").concat(c)).match(/:/g)||[]).length<2&&!f.match(wc)&&!f.match(Ec)&&i.dispatch(Yu({},d?E:g,{type:T,_:{called:T,from:"submethod"}})),t.abrupt("return",Promise.resolve(E));case 26:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),Promise.resolve(r));case 13:if(g=t.sent,f.match(_c)||f.match(/^registerPlugin/)||f.match(Ec)||f.match(wc)||f.match(/^params/)||f.match(/^userIdChanged/)){t.next=21;break}if(c.plugins.includes(f),!g._||g._.originalAction!==f){t.next=18;break}return t.abrupt("return",g);case 18:b=Yu({},g,{},{_:{originalAction:g.type,called:g.type,from:"engineEnd"}}),Rc(g,n.exact.length)&&!f.match(/End$/)&&(b=Yu({},b,{},{type:"".concat(g.type,"Aborted")})),u.dispatch(b);case 21:return t.abrupt("return",g);case 22:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ac(t){var e=t.data,n=t.method,r=t.pluginName,i=t.store,o=r?":".concat(r):"",a="".concat(n,"Aborted").concat(o);i.dispatch(Yu({},e,{type:a,_:{called:a,from:"abort"}}))}function Ic(t,e,n){var r=e[t]||n[t];return r&&r.config?r.config:{}}function Oc(t,e){return e.reduce((function(e,n){return n[t]?e.concat({methodName:t,pluginName:n.name,method:n[t]}):e}),[])}function Pc(t,e){var n=t.replace(_c,""),r=e?":".concat(e):"";return["".concat(t).concat(r),"".concat(n).concat(r),"".concat(n,"End").concat(r)]}function Dc(t,e,n){var r=Pc(t).map((function(t){return Oc(t,e)}));return e.reduce((function(n,r){var i=r.name,o=Pc(t,i).map((function(t){return Oc(t,e)})),a=mc(o,3),s=a[0],u=a[1],c=a[2];return s.length&&(n.beforeNS[i]=s),u.length&&(n.duringNS[i]=u),c.length&&(n.afterNS[i]=c),n}),{before:r[0],beforeNS:{},during:r[1],duringNS:{},after:r[2],afterNS:{}})}function Nc(t,e){var n=t.abort;return!!n&&(!0===n||Lc(n,e)||n&&Lc(n.plugins,e))}function Rc(t,e){var n=t.abort;if(!n)return!1;if(!0===n||bc(n))return!0;var r=n.plugins;return Mc(n)&&n.length===e||Mc(r)&&r.length===e}function Mc(t){return Array.isArray(t)}function Lc(t,e){return!(!t||!Mc(t))&&t.includes(e)}function Bc(t,e){return function(n,r,i){var o=r.config,a=r.name,s="".concat(a,".").concat(n.type);i&&(s=i.event);var u=n.type.match(_c)?function(t,e,n,r,i){return function(o,a){var s=r?r.name:t,u=a&&Mc(a)?a:n;if(r&&(!(u=a&&Mc(a)?a:[t]).includes(t)||1!==u.length))throw new Error("Method ".concat(e," can only abort ").concat(t," plugin. ").concat(JSON.stringify(u)," input valid"));return Yu({},i,{abort:{reason:o,plugins:u,caller:e,_:s}})}}(a,s,e,i,n):function(t,e){return function(){throw new Error("Action ".concat(t.type," not cancellable. Remove abort in ").concat(e))}}(n,s);return{payload:Vc(n),instance:t,config:o||{},abort:u}}}function Fc(t,e){var n=Uc(t);if(n&&n.name===e){var r=Uc(n.method),i=r?"or ".concat(r.method):"";throw new Error(["Plugin ".concat(e," is calling method [").concat(t,"]"),"Plugins can't call their own name","Use ".concat(n.method," ").concat(i," in ").concat(e," plugin instead of ").concat(t)].join("\n"))}}function Uc(t){var e=t.match(/(.*):(.*)/);return!!e&&{method:e[1],name:e[2]}}function Vc(t){return Object.keys(t).reduce((function(e,n){return"type"===n?e:(e[n]=gc(t[n])?Object.assign({},t[n]):t[n],e)}),{})}function jc(t,e,n){var r={};return function(i){return function(o){return a=lc(uc.mark((function a(s){var u,c,l,h,f,d,p,v,m,y,g,b,_;return uc.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(u=s.type,c=s.name,l=s.callback,h=s,!s.abort){a.next=4;break}return a.abrupt("return",o(s));case 4:if(u!==Zu.disablePlugin&&u!==Zu.enablePlugin||ac(l)&&l(c),u!==Zu.loadPlugin){a.next=13;break}return f=e(),d=Object.keys(f).filter((function(t){return s.plugins.includes(t)})).reduce((function(t,e){return t[e]=f[e],t}),{}),p={type:Zu.initializeStart,plugins:s.plugins},a.next=11,xc(p,d,t,i,n);case 11:return a.abrupt("return",o(a.sent));case 13:if(u===Zu.initializeEnd&&(v=e(),m=Object.keys(v),y=m.filter((function(t){return s.plugins.includes(t)})).map((function(t){return v[t]})),g=[],b=[],_=y.map((function(t){var e=t.name;return hc(t,t.loaded,1e4).then((function(n){r[e]||(i.dispatch({type:Zu.pluginReadyType(e),name:e,events:Object.keys(t).filter((function(t){return!Ju.includes(t)}))}),r[e]=!0),g=g.concat(e)})).catch((function(t){if(t instanceof Error)throw new Error(t);return b=b.concat(t.name),t}))})),Promise.all(_).then((function(t){setTimeout((function(){m.length===_.length&&i.dispatch({type:Zu.ready,plugins:g,failed:b})}),0)}))),u===Zu.bootstrap){a.next=20;break}return/^ready:([^:]*)$/.test(u)&&setTimeout((function(){return vc(i,e,t)}),0),a.next=18,xc(s,e,t,i,n);case 18:return a.abrupt("return",o(a.sent));case 20:return a.abrupt("return",o(h));case 21:case"end":return a.stop()}}),a)}))),function(t){return a.apply(this,arguments)};var a}}}function qc(){return(new Date).getTime()}var Gc=function t(){var e=this;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),Ku(this,"before",[]),Ku(this,"after",[]),Ku(this,"addMiddleware",(function(t,n){e[n]=e[n].concat(t)})),Ku(this,"removeMiddleware",(function(t,n){var r=e[n].findIndex((function(e){return e===t}));-1!==r&&(e[n]=[].concat(zu(e[n].slice(0,r)),zu(e[n].slice(r+1))))})),Ku(this,"resetMiddlewares",(function(t){t?e[t]=[]:(e.before=[],e.after=[])})),Ku(this,"dynamicMiddlewares",(function(t){return function(n){return function(r){return function(i){var o={getState:n.getState,dispatch:function(t){return n.dispatch(t)}},a=e[t].map((function(t){return t(o)}));return wu.apply(void 0,zu(a))(r)(i)}}}}))},zc={};function Hc(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zc,n=arguments.length>1?arguments[1]:void 0,r={};if("initialize:aborted"===n.type)return e;if(/^registerPlugin:([^:]*)$/.test(n.type)){var i=n.type.split(":")[1],o=t()[i];return o&&i?(r[i]={enabled:!0,initialized:!o.initialize,loaded:Boolean(o.loaded()),config:o.config||{}},Yu({},e,{},r)):e}if(/^initialize:([^:]*)$/.test(n.type)){var a=n.type.split(":")[1],s=t()[a];return s&&a?(r[a]=Yu({},e[a],{},{initialized:!0,loaded:Boolean(s.loaded())}),Yu({},e,{},r)):e}if(/^ready:([^:]*)$/.test(n.type))return r[n.name]=Yu({},e[n.name],{},{loaded:!0}),Yu({},e,{},r);switch(n.type){case Zu.disablePlugin:return Array.isArray(n.name)?(r=n.name.reduce((function(t,n){return t[n]=Yu({},e[n],{},{enabled:!1}),t}),e),Yu({},e,{},r)):(r[n.name]=Yu({},e[n.name],{},{enabled:!1}),Yu({},e,{},r));case Zu.enablePlugin:return Array.isArray(n.name)?(r=n.name.reduce((function(t,n){return t[n]=Yu({},e[n],{},{enabled:!0}),t}),e),Yu({},e,{},r)):(r[n.name]=Yu({},e[n.name],{},{enabled:!0}),Yu({},e,{},r));default:return e}}}var Wc,Kc,Xc,Yc,Qc=function(t,e){return{type:Zu.enablePlugin,name:t,callback:e,_:{originalAction:Zu.enablePlugin}}},Jc=function(t,e){return{type:Zu.disablePlugin,name:t,callback:e,_:{originalAction:Zu.disablePlugin}}},Zc="undefined"!=typeof window;Wc=function(){if(!Zc)return!1;var t=navigator.appVersion;return~t.indexOf("Win")?"Windows":~t.indexOf("Mac")?"MacOS":~t.indexOf("X11")?"UNIX":~t.indexOf("Linux")?"Linux":"Unknown OS"}(),Kc=document.referrer,Xc=function(){if(!Uu)return null;var t=navigator,e=t.languages;return e&&e.length?e[0]:t.userLanguage||t.language}(),Yc="undefined"==typeof Intl||"function"!=typeof Intl.DateTimeFormat||"function"!=typeof Intl.DateTimeFormat().resolvedOptions?null:Intl.DateTimeFormat().resolvedOptions().timeZone;var $c={initialized:!1,sessionId:qu(),app:null,version:null,debug:!1,offline:!!Zc&&!navigator.onLine,os:{name:Wc},userAgent:Zc?navigator.userAgent:"node",library:{name:"analytics",version:"0.2.6"},timezone:Yc,locale:Xc,campaign:{},referrer:Kc};function tl(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$c,e=arguments.length>1?arguments[1]:void 0,n=t.initialized,r=e.campaign;switch(e.type){case Zu.campaign:return Yu({},t,{},{campaign:r});case Zu.offline:return Yu({},t,{},{offline:!0});case Zu.online:return Yu({},t,{},{offline:!1});default:return n?t:Yu({},$c,{},t,{},{initialized:!0})}}var el=/#.*$/;function nl(t){var e=/(http[s]?:\/\/)?([^\/\s]+\/)(.*)/g.exec(t),n=e&&e[3]?e[3].split("?")[0].replace(el,""):"";return"/".concat(n)}function rl(t){var e=function(){if(Zc)for(var t,e=document.getElementsByTagName("link"),n=0;t=e[n];n++)if("canonical"===t.getAttribute("rel"))return t.getAttribute("href")}();return e?e.match(/\?/)?e:"".concat(e).concat(t):window.location.href.replace(el,"")}var il=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Zc)return t;var e=document,n=e.title,r=e.referrer,i=window,o=i.location,a=i.innerWidth,s=i.innerHeight,u=o.hash,c=o.search,l=rl(c),h={title:n,url:l,path:nl(l),hash:u,search:c,width:a,height:s};return r&&""!==r&&(h.referrer=r),Yu({},h,{},t)},ol=il();function al(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ol,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case Zu.page:return Object.assign({},t,e.data);default:return t}}var sl={event:{},lastEvent:null,history:[]};function ul(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sl,e=arguments.length>1?arguments[1]:void 0,n=e.payload,r=e.options,i=e.eventName;switch(e.type){case Zu.track:return Yu({},t,{},{event:{eventName:i,payload:n,options:r},lastEvent:e.eventName,history:t.history.concat(e)});default:return t}}var cl={actions:[]};function ll(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cl,e=arguments.length>1?arguments[1]:void 0,n=e.payload;switch(e.type){case"queue":var r;return r=n&&n.type&&n.type===Zu.identify?[e].concat(t.actions):t.actions.concat(e),Yu({},t,{actions:r});case"dequeue":return[];default:return t}}var hl="object"===("undefined"==typeof self?"undefined":Wu(self))&&self.self===self&&self||"object"===("undefined"==typeof global?"undefined":Wu(global))&&global.global===global&&global||void 0;function fl(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(e&&e.type===Zu.setItemEnd&&e.key===$u)return Object.assign({},t,{anonymousId:e.value});switch(e.type){case Zu.identify:return Object.assign({},t,{userId:e.userId,traits:Yu({},t.traits,{},e.traits)});case Zu.reset:return[fc,dc,"traits"].map((function(t){hl[pl(t)]=null})),[tc,$u,ec].map((function(t){Bu.removeItem(t)})),Object.assign({},t,{userId:null,anonymousId:null,traits:{}});default:return t}}function dl(t){return{userId:Bu.getItem(tc)||t.an_uid,anonymousId:Bu.getItem($u)||t.an_aid||qu(),traits:Bu.getItem(ec)||{}}}var pl=function(t){return"__TEMP__".concat(t)};function vl(t,e,n){return e.getState("user")[t]||(n&&gc(n)&&n[t]?n[t]:dl({})[t]||(hl[pl(t)]?hl[pl(t)]:null))}function ml(t,e,n,r,i){for(e=e.split?e.split("."):e,r=0;r<e.length;r++)t=t?t[e[r]]:i;return t===i?n:t}function yl(t,e,n){if(!Zc)return!1;var r=window[(n?"add":"remove")+"EventListener"];t.split(" ").forEach((function(t){r(t,e)}))}function gl(t){var e=yl.bind(null,"online offline",(function(e){return Promise.resolve(!navigator.onLine).then(t)}));return e(!0),function(t){return e(!1)}}function bl(){return Array.prototype.slice.call(arguments).reduce((function(t,e){return t||(ac(e)?e:t)}),!1)}function _l(){var t="__ANALYTICS_HISTORY__";return hl[t]=[],function(e){return function(n,r,i){var o=e(n,r,i),a=o.dispatch;return Object.assign(o,{dispatch:function(e){return hl[t].push(e.action||e),a(e)}})}}}function wl(t){return function(){return wu(wu.apply(null,arguments),_l())}}var El=function(t,e,n){return{type:Zu.setItemStart,timestamp:qc(),key:t,value:e,options:n}},xl=function(t,e){return{type:Zu.removeItemStart,timestamp:qc(),key:t,options:e}},Tl=function(t,e){return Bu.getItem(t,e)},Cl="after";function kl(){return"undefined"==typeof ga}function Sl(t){var e,n,r,i,o,a=t.config;if(!a.trackingId)throw new Error("No google analytics trackingId defined");kl()&&(e=window,n=document,r="script",e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=n.createElement(r),o=n.getElementsByTagName(r)[0],i.async=1,i.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(i,o),ga("create",a.trackingId,"auto"),a.debug&&(ga("set","sendHitTask",null),window.ga_debug={trace:!0}))}function Al(t){if(!kl()){var e=t||document.location.pathname;ga("set","page",e),ga("send","pageview")}}function Il(t){if(!kl()){var e,n={hitType:t.hitType||"event",eventAction:t.event,eventLabel:t.label,eventCategory:t.category||"All",nonInteraction:void 0!==t.nonInteraction&&!!t.nonInteraction};t.value&&(n.eventValue=!(e=t.value)||e<0?0:Math.round(e));var r=t.campaign||{},i=r.name,o=r.source,a=r.medium,s=r.content,u=r.keyword;return i&&(n.campaignName=i),o&&(n.campaignSource=o),a&&(n.campaignMedium=a),s&&(n.campaignContent=s),u&&(n.campaignKeyword=u),ga("send","event",n),n}}function Ol(t){kl()||t&&ga("set","userId",t)}var Pl=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.reducers||{},n=(t.plugins||[]).reduce((function(t,e){if(!ac(e)){if(e.NAMESPACE&&(e.name=e.NAMESPACE),!e.name)throw new Error("".concat(pc,"1"));var n=e.EVENTS?Object.keys(e.EVENTS).map((function(t){return e.EVENTS[t]})):[],r=Object.keys(e).concat(n),i=new Set(t.events.concat(r));if(t.events=Array.from(i),t.pluginsArray=t.pluginsArray.concat(e),t.plugins[e.name])throw new Error('"'.concat(e.name,'" plugin loaded twice'));return t.plugins[e.name]=e,t.plugins[e.name].loaded||(t.plugins[e.name].loaded=function(){return!0}),t}return t.middlewares=t.middlewares.concat(e),t}),{plugins:{},pluginsArray:[],middlewares:[],events:[]}),r=n.plugins,i=n.events.filter((function(t){return!Ju.includes(t)})),o=new Set(i.concat(Qu).filter((function(t){return!Ju.includes(t)}))),a=Array.from(o).sort(),s=i.sort(),u=function(){return r},c=new Gc,l=c.addMiddleware,h=c.removeMiddleware,f=c.dynamicMiddlewares,d=function(){throw new Error("Abort disabled in listener")},p=function(t,e){return function(n){e&&e(n),t(n)}},v=Vu(),m=dl(v),y={identify:function(t,e,n,r){var i=bc(t)?t:null,o=gc(t)?t:e,a=n||{},s=y.user();hl[pl(fc)]=i;var u=i||o.userId||vl(fc,y,o);return new Promise((function(t,c){C.dispatch(Yu({type:Zu.identifyStart,userId:u,traits:o||{},options:a,anonymousId:s.anonymousId},s.id&&s.id!==i&&{previousId:s.id},{meta:{timestamp:qc(),callback:p(t,bl(e,n,r))}}))}))},track:function(t,e,n,r){var i=gc(t)?t.event:t;if(!i||!bc(i))throw new Error("Event missing");var o=gc(t)?t:e||{},a=gc(n)?n:{};return new Promise((function(t,s){C.dispatch({type:Zu.trackStart,event:i,properties:o,options:a,userId:vl(fc,y,e),anonymousId:vl(dc,y,e),meta:{timestamp:qc(),callback:p(t,bl(e,n,r))}})}))},page:function(t,e,n){var r=gc(t)?t:{},i=gc(e)?e:{};return new Promise((function(o,a){C.dispatch({type:Zu.pageStart,properties:il(r),options:i,userId:vl(fc,y,r),anonymousId:vl(dc,y,r),meta:{timestamp:qc(),callback:p(o,bl(t,e,n))}})}))},user:function(t){if(t===fc||"id"===t)return vl(fc,y);var e=y.getState("user");return t?ml(e,t):e},reset:function(t){return new Promise((function(e,n){C.dispatch({type:Zu.resetStart,timestamp:qc(),callback:p(e,t)})}))},ready:function(t){return y.on(Zu.ready,t)},on:function(t,e){if(!t||!ac(e))return!1;if(t===Zu.bootstrap)throw new Error(".on disabled for ".concat(t));var n=/Start$|Start:/;if("*"===t){var i=function(t){return function(t){return function(i){return i.type.match(n)&&e({payload:i,instance:y,plugins:r}),t(i)}}},o=function(t){return function(t){return function(i){return i.type.match(n)||e({payload:i,instance:y,plugins:r}),t(i)}}};return l(i,"before"),l(o,Cl),function(){h(i,"before"),h(o,Cl)}}var a=t.match(n)?"before":Cl,s=function(n){return function(n){return function(i){return i.type===t&&e({payload:i,instance:y,plugins:r,abort:d}),n(i)}}};return l(s,a),function(){return h(s,a)}},once:function(t,e){if(!t||!ac(e))return!1;if(t===Zu.bootstrap)throw new Error(".once disabled for ".concat(t));var n=y.on(t,(function(t){e({payload:t.payload,instance:y,plugins:r,abort:d}),n()}));return n},getState:function(t){var e=C.getState();return t?ml(e,t):Object.assign({},e)},dispatch:function(t){var e=bc(t)?{type:t}:t;if(Qu.includes(e.type))throw new Error('reserved action "'.concat(e.type,'"'));var n=e.meta||{},r=t._||{},i=Yu({},e,{meta:Yu({timestamp:qc()},n),_:Yu({originalAction:e.type},r)});C.dispatch(i)},enablePlugin:function(t,e){C.dispatch(Qc(t,e))},disablePlugin:function(t,e){C.dispatch(Jc(t,e))},loadPlugin:function(t){C.dispatch({type:Zu.loadPlugin,plugins:t?[t]:Object.keys(u())})},storage:{getItem:Tl,setItem:function(t,e,n){C.dispatch(El(t,e,n))},removeItem:function(t,e){C.dispatch(xl(t,e))}},setAnonymousId:function(t,e){y.storage.setItem($u,t,e)},events:{all:a,core:Qu,plugins:s}},g=n.middlewares.concat([f("before"),jc(y,u,{all:a,plugins:s}),function(t){return function(t){return function(e){var n=e.type,r=e.key,i=e.value,o=e.options;if(n===Zu.setItem||n===Zu.removeItem){if(e.abort)return t(e);n===Zu.setItem?Bu.setItem(r,i,o):Bu.removeItem(r,o)}return t(e)}}},oc(y),sc(y),f(Cl)]),b={context:tl,user:fl,page:al,track:ul,plugins:Hc(u),queue:ll},_=wu,w=wu;if(Zc&&t.debug){var E=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__;E&&(_=E({trace:!0,traceLimit:25})),w=function(){return 0===arguments.length?_l():gc(Wu(arguments[0]))?wl():wl().apply(null,arguments)}}var x=function(t){return Object.keys(t).reduce((function(e,n){return"plugins"===n||"reducers"===n?e:(e[n]=t[n],e)}),{})}(t),T={context:x,user:m,plugins:n.pluginsArray.reduce((function(t,e){var n=e.config,r=e.loaded;return t[e.name]={enabled:!0,initialized:Boolean(!e.initialize),loaded:Boolean(r()),config:n||{}},t}),{})},C=gu(_u(Yu({},b,{},e)),T,w(_(xu.apply(void 0,zu(g))))),k=Object.keys(r);return C.dispatch({type:Zu.bootstrap,plugins:k,config:x,params:v,user:m}),C.dispatch({type:Zu.registerPlugins,plugins:k}),n.pluginsArray.map((function(t,e){var r=t.bootstrap,i=t.config;r&&ac(r)&&r({instance:y,config:i,payload:t});var o=n.pluginsArray.length===e+1;C.dispatch({type:Zu.registerPluginType(t.name),name:t.name,plugin:t}),o&&C.dispatch({type:Zu.initializeStart,plugins:k})})),gl((function(t){C.dispatch({type:t?Zu.offline:Zu.online})})),function(t,e,n){setInterval((function(){vc(t,e,n)}),3e3)}(C,u,y),y}({app:"tanks",version:100,plugins:[function(){return{NAMESPACE:"google-analytics",config:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},initialize:Sl,page:function(t){Al(t.payload.properties.path)},track:function(t){var e=t.payload,n=e.properties;Il({hitType:"event",event:e.event,label:n.label,category:n.category||"All",value:n.value,nonInteraction:n.nonInteraction,campaign:t.instance.getState("context.campaign")})},identify:function(t){Ol(t.payload.userId)},loaded:function(){return!!window.gaplugins}}}({trackingId:"UA-133020393-1"})]}),Dl=function(){function t(e,n,r){_classCallCheck2(this,t),this.elRef=r,this.View=Js,this.opened=Js.START_MENU,e.rewardVideoConfig={id:{android:Xs.rewardVideoId}},n.prompt(),Xs.production&&Pl.page("/")}return _createClass2(t,[{key:"open",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t!==Js.NEW_GAME&&t!==Js.RESUME_GAME,e.t0){e.next=4;break}return e.next=4,function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.requestFullscreen();case 2:return e.next=4,window.screen.orientation.lock("landscape");case 4:case"end":return e.stop()}}),e)})))}(this.elRef.nativeElement).catch((function(t){return console.warn(t),Promise.resolve()}));case 4:if(e.t1=t!==Js.NEW_GAME&&t!==Js.RESUME_GAME,!e.t1){e.next=8;break}return e.next=8,function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.exitFullscreen();case 2:case"end":return e.stop()}}),e)})))}(document).catch((function(t){return console.warn(t),Promise.resolve()}));case 8:this.opened=t;case 9:case"end":return e.stop()}}),e,this)})))}}]),t}(),Nl=function t(){_classCallCheck2(this,t)},Rl=function(){var t={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return t[t.Zero]="Zero",t[t.One]="One",t[t.Two]="Two",t[t.Few]="Few",t[t.Many]="Many",t[t.Other]="Other",t}(),Ml=new de("UseV4Plurals"),Ll=function t(){_classCallCheck2(this,t)},Bl=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).locale=t,r.deprecatedPluralFn=n,r}return _inherits(e,t),_createClass2(e,[{key:"getPluralCategory",value:function(t,e){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(e||this.locale,t):function(t){return function(t){var e=t.toLowerCase().replace(/_/g,"-"),n=co[e];if(n)return n;var r=e.split("-")[0];if(n=co[r])return n;if("en"===r)return fo;throw new Error('Missing locale data for the locale "'.concat(t,'".'))}(t)[lo.PluralCase]}(e||this.locale)(t)){case Rl.Zero:return"zero";case Rl.One:return"one";case Rl.Two:return"two";case Rl.Few:return"few";case Rl.Many:return"many";default:return"other"}}}]),e}(Ll);function Fl(t,e){e=encodeURIComponent(e);var n=!0,r=!1,i=void 0;try{for(var o,a=t.split(";")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=s.indexOf("="),c=_slicedToArray(-1==u?[s,""]:[s.slice(0,u),s.slice(u+1)],2),l=c[0],h=c[1];if(l.trim()===e)return decodeURIComponent(h)}}catch(f){r=!0,i=f}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return null}var Ul=function t(){_classCallCheck2(this,t)},Vl=function(){function t(e,n,r,i){_classCallCheck2(this,t),this._iterableDiffers=e,this._keyValueDiffers=n,this._ngEl=r,this._renderer=i,this._initialClasses=[]}return _createClass2(t,[{key:"getValue",value:function(){return null}},{key:"setClass",value:function(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}},{key:"setNgClass",value:function(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Dn(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}},{key:"applyChanges",value:function(){if(this._iterableDiffer){var t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){var e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}},{key:"_applyKeyValueChanges",value:function(t){var e=this;t.forEachAddedItem((function(t){return e._toggleClass(t.key,t.currentValue)})),t.forEachChangedItem((function(t){return e._toggleClass(t.key,t.currentValue)})),t.forEachRemovedItem((function(t){t.previousValue&&e._toggleClass(t.key,!1)}))}},{key:"_applyIterableChanges",value:function(t){var e=this;t.forEachAddedItem((function(t){if("string"!=typeof t.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got ".concat(ie(t.item)));e._toggleClass(t.item,!0)})),t.forEachRemovedItem((function(t){return e._toggleClass(t.item,!1)}))}},{key:"_applyClasses",value:function(t){var e=this;t&&(Array.isArray(t)||t instanceof Set?t.forEach((function(t){return e._toggleClass(t,!0)})):Object.keys(t).forEach((function(n){return e._toggleClass(n,!!t[n])})))}},{key:"_removeClasses",value:function(t){var e=this;t&&(Array.isArray(t)||t instanceof Set?t.forEach((function(t){return e._toggleClass(t,!1)})):Object.keys(t).forEach((function(t){return e._toggleClass(t,!1)})))}},{key:"_toggleClass",value:function(t,e){var n=this;(t=t.trim())&&t.split(/\s+/g).forEach((function(t){e?n._renderer.addClass(n._ngEl.nativeElement,t):n._renderer.removeClass(n._ngEl.nativeElement,t)}))}}]),t}(),jl=function(t){function e(t){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,t),_createClass2(e,[{key:"ngDoCheck",value:function(){this._delegate.applyChanges()}},{key:"klass",set:function(t){this._delegate.setClass(t)}},{key:"ngClass",set:function(t){this._delegate.setNgClass(t)}}]),e}(function(){var t=function(){function t(e){_classCallCheck2(this,t),this._delegate=e}return _createClass2(t,[{key:"getValue",value:function(){return this._delegate.getValue()}}]),t}();return t.ngDirectiveDef=void 0,t}()),ql=function(){function t(e,n,r,i){_classCallCheck2(this,t),this.$implicit=e,this.ngForOf=n,this.index=r,this.count=i}return _createClass2(t,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),t}(),Gl=function(){function t(e,n,r){_classCallCheck2(this,t),this._viewContainer=e,this._template=n,this._differs=r,this._ngForOfDirty=!0,this._differ=null}return _createClass2(t,[{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '".concat(t,"' of type '").concat((e=t).name||typeof e,"'. NgFor only supports binding to Iterables such as Arrays."))}}var e;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}},{key:"_applyChanges",value:function(t){var e=this,n=[];t.forEachOperation((function(t,r,i){if(null==t.previousIndex){var o=e._viewContainer.createEmbeddedView(e._template,new ql(null,e._ngForOf,-1,-1),null===i?void 0:i),a=new zl(t,o);n.push(a)}else if(null==i)e._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=e._viewContainer.get(r);e._viewContainer.move(s,i);var u=new zl(t,s);n.push(u)}}));for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var i=0,o=this._viewContainer.length;i<o;i++){var a=this._viewContainer.get(i);a.context.index=i,a.context.count=o,a.context.ngForOf=this._ngForOf}t.forEachIdentityChange((function(t){e._viewContainer.get(t.currentIndex).context.$implicit=t.item}))}},{key:"_perViewChange",value:function(t,e){t.context.$implicit=e.item}},{key:"ngForOf",set:function(t){this._ngForOf=t,this._ngForOfDirty=!0}},{key:"ngForTrackBy",set:function(t){Ve()&&null!=t&&"function"!=typeof t&&console&&console.warn&&console.warn("trackBy must be a function, but received ".concat(JSON.stringify(t),". ")+"See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information."),this._trackByFn=t},get:function(){return this._trackByFn}},{key:"ngForTemplate",set:function(t){t&&(this._template=t)}}],[{key:"ngTemplateContextGuard",value:function(t,e){return!0}}]),t}(),zl=function t(e,n){_classCallCheck2(this,t),this.record=e,this.view=n},Hl=function(){function t(e,n){_classCallCheck2(this,t),this._viewContainer=e,this._context=new Wl,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}return _createClass2(t,[{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}},{key:"ngIf",set:function(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}},{key:"ngIfThen",set:function(t){Kl("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(t){Kl("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}}]),t}(),Wl=function t(){_classCallCheck2(this,t),this.$implicit=null,this.ngIf=null};function Kl(t,e){if(e&&!e.createEmbeddedView)throw new Error("".concat(t," must be a TemplateRef, but received '").concat(ie(e),"'."))}var Xl=function t(){_classCallCheck2(this,t)},Yl=function(){function t(e,n,r){_classCallCheck2(this,t),this._ngEl=e,this._differs=n,this._renderer=r}return _createClass2(t,[{key:"getValue",value:function(){return null}},{key:"setNgStyle",value:function(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}},{key:"applyChanges",value:function(){if(this._differ){var t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}},{key:"_applyChanges",value:function(t){var e=this;t.forEachRemovedItem((function(t){return e._setStyle(t.key,null)})),t.forEachAddedItem((function(t){return e._setStyle(t.key,t.currentValue)})),t.forEachChangedItem((function(t){return e._setStyle(t.key,t.currentValue)}))}},{key:"_setStyle",value:function(t,e){var n=_slicedToArray(t.split("."),2),r=n[0],i=n[1];null!=(e=null!=e&&i?"".concat(e).concat(i):e)?this._renderer.setStyle(this._ngEl.nativeElement,r,e):this._renderer.removeStyle(this._ngEl.nativeElement,r)}}]),t}(),Ql=function(t){function e(t){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,t),_createClass2(e,[{key:"ngDoCheck",value:function(){this._delegate.applyChanges()}},{key:"ngStyle",set:function(t){this._delegate.setNgStyle(t)}}]),e}(function(){var t=function(){function t(e){_classCallCheck2(this,t),this._delegate=e}return _createClass2(t,[{key:"getValue",value:function(){return this._delegate.getValue()}}]),t}();return t.ngDirectiveDef=void 0,t}()),Jl=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"transform",value:function(t){return JSON.stringify(t,null,2)}}]),t}(),Zl=function(){function t(e){_classCallCheck2(this,t),this.differs=e,this.keyValues=[]}return _createClass2(t,[{key:"transform",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$l;if(!t||!(t instanceof Map)&&"object"!=typeof t)return null;this.differ||(this.differ=this.differs.find(t).create());var r=this.differ.diff(t);return r&&(this.keyValues=[],r.forEachItem((function(t){var n,r;e.keyValues.push((n=t.key,r=t.currentValue,{key:n,value:r}))})),this.keyValues.sort(n)),this.keyValues}}]),t}();function $l(t,e){var n=t.key,r=e.key;if(n===r)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(null===n)return 1;if(null===r)return-1;if("string"==typeof n&&"string"==typeof r)return n<r?-1:1;if("number"==typeof n&&"number"==typeof r)return n-r;if("boolean"==typeof n&&"boolean"==typeof r)return n<r?-1:1;var i=String(n),o=String(r);return i==o?0:i<o?-1:1}var th=function t(){_classCallCheck2(this,t)},eh=new de("DocumentToken"),nh="browser",rh="server";function ih(t){return t===nh}var oh=n("ANjH"),ah=n("5HXA");function sh(t){return function(e){var n=e.dispatch,r=e.getState;return function(e){return function(i){return"function"==typeof i?i(n,r,t):e(i)}}}}var uh=sh();uh.withExtraArgument=sh;var ch,lh,hh=uh,fh=((ch={}).SetupPIXI="setup_pixi",ch.Move="player_move",ch.Shot="player_shot",ch.AddLife="player_add_life",ch.None="battlefield_map_none",ch.Loading="battlefield_map_loading",ch.Loaded="battlefield_map_loaded",ch.NewGame="new_game",ch.UpdateCenter="renderer_update_center",ch.UpdateCameraPosition="update_camera_position",ch.GameNone="game_none",ch.GameStart="game_start",ch.GameStop="game_stop",ch.GameOver="game_over",ch.CreatePlayerSpawn="create_player_spawn",ch.PlayerDestroyed="player_destroyed",ch.CreateEnemySpawn="create_enemy_spawn",ch.UpdateBodies="world_update_bodies",ch.CreateTree="world_create_tree",ch.CreateBlockade="world_create_blockade",ch.CreateBrick="world_create_brick",ch.CreateWater="world_create_water",ch.CreateEagle="world_create_eagle",ch.CreatePlayer="world_create_player",ch.CreateEnemy="world_create_enemy",ch.CreateSteel="world_create_steel",ch.EnemyAction="enemy_action",ch.LoadSave="load_save",ch.CreateBullet="create_bullet",ch.CreateExplosion="create_explosion",ch.RemoveExplosion="remove_explosion",ch.DestroyGameObject="destroy_game_object",ch.BulletHit="bullet_hit",ch.CreateTank="create_tank",ch.AnimateMovingTanks="animate_tank_moving",ch.CreateBonus="create_bonus",ch.DestroyBonus="destroy_bonus",ch),dh={name:""},ph=function(t){return t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Up=2]="Up",t[t.Down=3]="Down",t[t.Shot=4]="Shot",t}({}),vh=(_defineProperty2(r={},ph.Down,"down"),_defineProperty2(r,ph.Left,"left"),_defineProperty2(r,ph.Right,"right"),_defineProperty2(r,ph.Up,"up"),r),mh=function(t){return t[t.None=0]="None",t[t.StageLoading=1]="StageLoading",t[t.StageLoaded=2]="StageLoaded",t[t.Start=3]="Start",t[t.Stop=4]="Stop",t[t.Over=5]="Over",t}({}),yh=n("xk4V"),gh=function(t){return t.BasicTank="basic_tank",t.FastTank="fast_tank",t.PowerTank="power_tank",t.ArmorTank="armor_tank",t}({}),bh=Object.assign({},((lh={})[lh.Bullet=0]="Bullet",lh[lh.Brick=1]="Brick",lh[lh.Water=2]="Water",lh[lh.Steel=3]="Steel",lh[lh.Tree=4]="Tree",lh[lh.Eagle=5]="Eagle",lh[lh.Blockade=6]="Blockade",lh[lh.Bonus=7]="Bonus",lh),gh),_h=(_defineProperty2(i={},bh.Blockade,1/0),_defineProperty2(i,bh.Brick,1),_defineProperty2(i,bh.Steel,1/0),_defineProperty2(i,bh.Eagle,5),_defineProperty2(i,bh.ArmorTank,3),_defineProperty2(i,bh.BasicTank,1),_defineProperty2(i,bh.FastTank,1),_defineProperty2(i,bh.PowerTank,5),i),wh="player-".concat(yh()),Eh={status:mh.None,stageName:"",player:{id:wh,lives:3,direction:"up"},players:[],enemies:{},destroyedEnemies:[],waitingEnemies:[],playerSpawns:[],enemySpawns:[],healthPoints:{},bulletIdToTankId:{},gamePoints:{},bonus:void 0,activeBonuses:{}},xh={renderer:{view:{width:0,height:0},center:{x:0,y:0},camera:{x:0,y:0}},objects:{},contactMaterials:[],players:[],enemies:[],bullets:[],explosions:{}},Th=function(t){return t.Delete="delete",t.Brick1="brick1",t.Brick2="brick2",t.Steel="steel",t.Tree="tree",t.Water="water",t.Blockade="blockade",t.Eagle="eagle",t.Ice="ice",t.PlayerSpawn="player-spawn",t.EnemySpawn="enemy-spawn",t.BasicTankGrey="basic-tank-grey",t.BasicTankGreen="basic-tank-green",t.BasicTankGold="basic-tank-gold",t.BasicTankRed="basic-tank-red",t.FastTankGrey="fast-tank-grey",t.FastTankGreen="fast-tank-green",t.FastTankGold="fast-tank-gold",t.FastTankRed="fast-tank-red",t.PowerTankGrey="power-tank-grey",t.PowerTankGreen="power-tank-green",t.PowerTankGold="power-tank-gold",t.PowerTankRed="power-tank-red",t.ArmorTankGrey="armor-tank-grey",t.ArmorTankGreen="armor-tank-green",t.ArmorTankGold="armor-tank-gold",t.ArmorTankRed="armor-tank-red",t.Bullet="bullet",t.Explosion="explosion",t.EmptySpace="empty-space",t.GrenadeBonus="grenade-bonus",t.TimerBonus="timer-bonus",t.ShovelBonus="shovel-bonus",t.HelmetBonus="helmet-bonus",t.StarBonus="start-bonus",t.TankBonus="tank-bonus",t}({}),Ch=function(t){return t.Container="container",t.Sprite="sprite",t.AnimatedSprite="animated_sprite",t}({}),kh=function(t){return t[t.Default=Math.pow(2,0)]="Default",t[t.Water=Math.pow(2,1)]="Water",t[t.Bullet=Math.pow(2,2)]="Bullet",t[t.Bonus=Math.pow(2,3)]="Bonus",t}({}),Sh=function(t){return t[t.Grenade=0]="Grenade",t}({});function Ah(t){return _defineProperty2({},Sh.Grenade,Th.GrenadeBonus)[t]}var Ih=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r="function"!=typeof e[0]&&e.shift(),i=e;if(void 0===r)throw new TypeError("The initial state may not be undefined. If you do not want to set a value for this reducer, you can use null instead of undefined.");return function(t,e){for(var n=arguments.length,o=Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];var s=void 0===t,u=void 0===e;return s&&u&&r?r:i.reduce((function(t,n,r){if(void 0===n)throw new TypeError("An undefined reducer was passed in at index "+r);return n.apply(void 0,[t,e].concat(o))}),s&&!u&&r?r:t)}}((function(t,e){return e.type===fh.LoadSave?e.gameState:t}),Object(oh.combineReducers)({battlefieldMap:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dh,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case fh.NewGame:return Object.assign({},t,dh);case fh.Loading:return Object.assign({},t,{status:fh.Loading});case fh.Loaded:return Object.assign({},t,{status:fh.Loaded,name:e.name,map:e.level})}return t},currentGame:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Eh,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case fh.NewGame:return Object.assign({},t,Eh);case fh.GameOver:return Object.assign({},t,{status:mh.Over});case fh.Loading:return Object.assign({},t,{status:mh.StageLoading,stageName:e.name});case fh.Loaded:return Object.assign({},t,{status:mh.StageLoaded,waitingEnemies:_toConsumableArray(e.level.enemies)});case fh.GameStart:return t.status===mh.StageLoading?Object.assign({},t):Object.assign({},t,{status:mh.Start});case fh.GameStop:return t.status===mh.StageLoading?Object.assign({},t):Object.assign({},t,{status:mh.Stop});case fh.CreatePlayerSpawn:return Object.assign({},t,{playerSpawns:[].concat(_toConsumableArray(t.playerSpawns),[{block:e.block}])});case fh.CreateEnemySpawn:return Object.assign({},t,{enemySpawns:[].concat(_toConsumableArray(t.enemySpawns),[{block:e.block}])});case fh.CreateEnemy:var n=t.waitingEnemies.filter((function(t){return t.id!==e.id})),r=t.waitingEnemies.find((function(t){return t.id===e.id})),i=Object.assign({},t.enemies,_defineProperty2({},r.id,r));return Object.assign({},t,{enemies:i,waitingEnemies:n});case fh.Move:return e.direction?Object.assign({},t,{player:Object.assign({},t.player,{direction:e.direction})}):t;case fh.EnemyAction:return function(t,e){if(e.action!==ph.Shot){var n=Object.assign({},t.enemies,_defineProperty2({},e.id,Object.assign({},t.enemies[e.id],{direction:vh[e.type]})));return Object.assign({},t,{enemies:n})}return t}(t,e);case fh.CreateBullet:return function(t,e){var n=e.id,r=e.tankId;return Object.assign({},t,{bulletIdToTankId:Object.assign({},t.bulletIdToTankId,_defineProperty2({},n,r))})}(t,e);case fh.BulletHit:return function(t,e){var n=e.target.id,r=function(t,e){return e.healthPoints[t]}(n,t);return function(t,e,n){return Object.assign({},e,{healthPoints:Object.assign({},e.healthPoints,_defineProperty2({},t,n))})}(n,t,r?r-1:_h[e.target.type]-1)}(t,e);case fh.DestroyGameObject:return function(t,e){var n,r=e.gameObject.id,i=Qs.__rest(t.healthPoints,["symbol"==typeof r?r:r+""]),o=Qs.__rest(t.bulletIdToTankId,["symbol"==typeof r?r:r+""]),a=e.gameObject.type;if(n=a,[gh.BasicTank,gh.FastTank,gh.PowerTank,gh.ArmorTank].some((function(t){return t===n}))){var s=function(t){var e,n=(e={},_defineProperty2(e,gh.BasicTank,100),_defineProperty2(e,gh.FastTank,200),_defineProperty2(e,gh.PowerTank,300),_defineProperty2(e,gh.ArmorTank,400),e)[t];if(!n)throw new Error("Missing points for ".concat(t));return n}(a),u=Object.assign({},t.gamePoints,_defineProperty2({},a,t.gamePoints[a]||0+s)),c=t.enemies,l=r,h=c[l],f=Qs.__rest(c,["symbol"==typeof l?l:l+""]),d=t.destroyedEnemies.concat(h);return Object.assign({},t,{healthPoints:i,bulletIdToTankId:o,gamePoints:u,enemies:f,destroyedEnemies:d})}return Object.assign({},t,{healthPoints:i,bulletIdToTankId:o})}(t,e);case fh.CreateBonus:return function(t,e){var n=e.bonus;return Object.assign({},t,{bonus:n})}(t,e);case fh.DestroyBonus:return function(t,e){return Object.assign({},t,{bonus:void 0})}(t)}return t},worldState:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xh,e=arguments.length>1?arguments[1]:void 0,n=function(t,e){switch(e.type){case fh.UpdateCenter:return Object.assign({},t,{renderer:Object.assign({},t.renderer,{view:{width:e.width,height:e.height},center:{x:e.width/2,y:e.height/2}})});case fh.UpdateCameraPosition:return Object.assign({},t,{renderer:Object.assign({},t.renderer,{camera:{x:e.x,y:e.y}})})}return t}(t,e);switch(e.type){case fh.NewGame:return Object.assign({},xh);case fh.UpdateBodies:return function(t,e){return e.updates.forEach((function(e){var n=e.id,r=t.objects[n];if(r){var i=e.body,o=i.position,a=o.x,s=o.y,u=i.angle,c=i.velocity,l=Object.assign({},r,{container:Object.assign({},r.container,{position:{x:a,y:s},rotation:u}),body:Object.assign({},r.body,{velocity:c}),bodyOptions:Object.assign({},r.bodyOptions,{position:[a,s]})});t.objects[n]=l}})),t}(t,e);case fh.CreateTree:return function(t,e){var n=e.id,r=e.block,i=r.position.x+r.width/2,o=r.position.y+r.height/2;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Tree,id:n,bodyOptions:{mass:0,position:[i,o]},body:{velocity:[0,0]},box:{width:r.width,height:r.width,sensor:!0,collisionGroup:kh.Default,collisionMask:kh.Default},inPhysicsWorld:!1,container:{type:Ch.Container,zIndex:10,pivot:{x:r.width/2,y:r.height/2},position:{x:i,y:o},rotation:0,children:[{type:Ch.Sprite,textureId:Th.Tree}]}}))})}(t,e);case fh.CreateBlockade:return function(t,e){var n=e.id,r=e.block;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Blockade,id:n,bodyOptions:{mass:0,position:[r.position.x+r.width/2,r.position.y+r.height/2]},body:{velocity:[0,0]},box:{width:r.width,height:r.width,collisionGroup:kh.Default,collisionMask:kh.Default|kh.Bullet},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:r.position.x+r.width/2,y:r.position.y+r.height/2},rotation:0,children:[{type:Ch.Sprite,textureId:Th.Blockade}]}}))})}(t,e);case fh.CreateBrick:return function(t,e){var n=e.id,r=e.block,i=r.position.x+r.width/2,o=r.position.y+r.height/2;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Brick,id:n,bodyOptions:{mass:0,position:[i,o]},body:{velocity:[0,0]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:kh.Default,collisionMask:kh.Default|kh.Bullet},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:i,y:o},rotation:0,children:[{type:Ch.Sprite,textureId:e.block.type}]}}))})}(t,e);case fh.CreateWater:return function(t,e){var n=e.id,r=e.block;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Tree,id:n,bodyOptions:{mass:0,position:[r.position.x+r.width/2,r.position.y+r.height/2]},body:{velocity:[0,0]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:kh.Water,collisionMask:kh.Default},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:r.position.x+r.width/2,y:r.position.y+r.height/2},rotation:0,children:[{type:Ch.AnimatedSprite,textureId:Th.Water,frames:[{x:0,y:0,width:r.width,height:r.height},{x:32,y:0,width:r.width,height:r.height}],speed:.05,playing:!0}]}}))})}(t,e);case fh.CreateEagle:return function(t,e){var n=e.id,r=e.block,i=r.position.x+r.width/2,o=r.position.y+r.height/2;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Eagle,id:n,bodyOptions:{mass:0,position:[i,o]},body:{velocity:[0,0]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:kh.Default,collisionMask:kh.Default|kh.Bullet},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:i,y:o},rotation:0,children:[{type:Ch.Sprite,textureId:Th.Eagle,frame:{x:0,y:0,width:r.width,height:r.height}}]}}))})}(t,e);case fh.CreateSteel:return function(t,e){var n=e.id,r=e.block,i=r.position.x+r.width/2,o=r.position.y+r.height/2;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Steel,id:n,bodyOptions:{mass:0,position:[i,o]},body:{velocity:[0,0]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:kh.Default,collisionMask:kh.Default|kh.Bullet},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:i,y:o},rotation:0,children:[{type:Ch.Sprite,textureId:e.block.type}]}}))})}(t,e);case fh.CreatePlayer:return function(t,e){var n=e.id;return Object.assign({},t,{players:[].concat(_toConsumableArray(t.players),[{id:n}])})}(t,e);case fh.CreateEnemy:return function(t,e){var n=e.id;return Object.assign({},t,{enemies:[].concat(_toConsumableArray(t.enemies),[{id:n}])})}(t,e);case fh.CreateTank:return function(t,e){var n,r,i=e.id,o=e.block,a=e.tankType,s=o.position.x+o.width/2,u=o.position.y+o.height/2,c={type:a,id:i,bodyOptions:{mass:1,fixedRotation:!0,position:[s,u]},body:{damping:.99,velocity:[0,0]},box:{width:o.width,height:o.width,collisionGroup:kh.Default,collisionMask:kh.Default|kh.Bullet|kh.Bonus|kh.Water},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:o.width/2,y:o.height/2},position:{x:s,y:u},rotation:-Math.PI/2,children:[{type:Ch.AnimatedSprite,textureId:(r=a,(n={},_defineProperty2(n,gh.BasicTank,Th.BasicTankGrey),_defineProperty2(n,gh.FastTank,Th.FastTankGrey),_defineProperty2(n,gh.PowerTank,Th.PowerTankGrey),_defineProperty2(n,gh.ArmorTank,Th.ArmorTankGrey),n)[r]),frames:[{x:0,y:0,width:o.width,height:o.height},{x:64,y:0,width:o.width,height:o.height}],speed:.2,playing:!1}]}};return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},i,c))})}(t,e);case fh.CreateBullet:return function(t,e){var n=e.id,r=e.info,i=r.x+r.width/2,o=r.y+r.height/2;return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},n,{type:bh.Bullet,id:n,bodyOptions:{mass:.2,position:[i,o],fixedRotation:!0,angle:r.angle},body:{damping:.1,velocity:{left:[-220,0],right:[220,0],up:[0,-220],down:[0,220]}[r.direction]},box:{width:r.width,height:r.width,sensor:!1,collisionGroup:kh.Bullet,collisionMask:kh.Default},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:0,pivot:{x:r.width/2,y:r.height/2},position:{x:i,y:o},rotation:r.angle,children:[{type:Ch.Sprite,textureId:Th.Bullet}]}})),bullets:[].concat(_toConsumableArray(t.bullets),[{id:n}])})}(t,e);case fh.CreateExplosion:return function(t,e){var n=e.explosion,r=n.id;return Object.assign({},t,{explosions:Object.assign({},t.explosions,_defineProperty2({},r,n))})}(t,e);case fh.RemoveExplosion:return function(t,e){var n=e.id,r=Qs.__rest(t.explosions,["symbol"==typeof n?n:n+""]);return Object.assign({},t,{explosions:r})}(t,e);case fh.DestroyGameObject:return function(t,e){var n=e.gameObject.id,r=Qs.__rest(t.objects,["symbol"==typeof n?n:n+""]),i=t.bullets.filter((function(t){return t.id!==n})),o=t.players.filter((function(t){return t.id!==n})),a=t.enemies.filter((function(t){return t.id!==n})),s=Qs.__rest(t.explosions,["symbol"==typeof n?n:n+""]);return Object.assign({},t,{objects:r,bullets:i,players:o,enemies:a,explosions:s})}(t,e);case fh.AnimateMovingTanks:return function(t,e){return e.updates.reduce((function(e,n){var r=n.shouldAnimate,i=t.objects[n.id];if(!i)return e;if(i.container.children[0].type!==Ch.AnimatedSprite)throw new Error("You must update animation reducer after change tank container structure");return i.container.children[0].playing=r,e}),t)}(t,e);case fh.CreateBonus:return function(t,e){var n=e.bonus,r=n.id,i=n.position,o=n.type,a=i.x,s=i.y,u={type:bh.Bonus,id:r,bodyOptions:{mass:0,position:[a,s]},body:{velocity:[0,0]},box:{width:64,height:64,sensor:!0,collisionGroup:kh.Bonus,collisionMask:kh.Default},inPhysicsWorld:!0,container:{type:Ch.Container,zIndex:11,pivot:{x:32,y:32},position:{x:a,y:s},rotation:0,children:[{type:Ch.Sprite,textureId:Ah(o)}]}};return Object.assign({},t,{objects:Object.assign({},t.objects,_defineProperty2({},r,u))})}(t,e);case fh.DestroyBonus:return function(t,e){var n=e.id,r=Qs.__rest(t.objects,["symbol"==typeof n?n:n+""]);return Object.assign({},t,{objects:r})}(t,e)}return n}})),Oh=function(t){return"@@redux-saga/"+t},Ph=Oh("CANCEL_PROMISE"),Dh=Oh("CHANNEL_END"),Nh=Oh("IO"),Rh=Oh("MATCH"),Mh=Oh("MULTICAST"),Lh=Oh("SAGA_ACTION"),Bh=Oh("SELF_CANCELLATION"),Fh=Oh("TASK"),Uh=Oh("TASK_CANCEL"),Vh=Oh("TERMINATE"),jh=Oh("LOCATION");function qh(){return(qh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Gh=function(t){return null==t},zh=function(t){return null!=t},Hh=function(t){return"function"==typeof t},Wh=function(t){return"string"==typeof t},Kh=Array.isArray,Xh=function(t){return t&&Hh(t.then)},Yh=function(t){return t&&Hh(t.next)&&Hh(t.throw)},Qh=function t(e){return e&&(Wh(e)||$h(e)||Hh(e)||Kh(e)&&e.every(t))},Jh=function(t){return t&&Hh(t.take)&&Hh(t.close)},Zh=function(t){return Hh(t)&&t.hasOwnProperty("toString")},$h=function(t){return Boolean(t)&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype},tf=function(t){return Jh(t)&&t[Mh]},ef=function(){return!0},nf=function(){},rf=function(t){return t};"function"==typeof Symbol&&Symbol.asyncIterator&&Symbol;var of=function(t,e){qh(t,e),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(e).forEach((function(n){t[n]=e[n]}))};function af(t,e){var n=t.indexOf(e);n>=0&&t.splice(n,1)}function sf(t){var e=!1;return function(){e||(e=!0,t())}}var uf=function(t){throw t},cf=function(t){return{value:t,done:!0}};function lf(t,e,n){void 0===e&&(e=uf),void 0===n&&(n="iterator");var r={meta:{name:n},next:t,throw:e,return:cf,isSagaIterator:!0};return"undefined"!=typeof Symbol&&(r[Symbol.iterator]=function(){return r}),r}function hf(t,e){var n=e.sagaStack;console.error(t),console.error(n)}var ff=function(t){return Array.apply(null,new Array(t))},df=function(t){return function(e){return t(Object.defineProperty(e,Lh,{value:!0}))}},pf=function(t){return t===Vh},vf=function(t){return t===Uh},mf=function(t){return pf(t)||vf(t)};function yf(t,e){var n,r=Object.keys(t),i=r.length,o=0,a=Kh(t)?ff(i):{},s={};return r.forEach((function(t){var r=function(r,s){n||(s||mf(r)?(e.cancel(),e(r,s)):(a[t]=r,++o===i&&(n=!0,e(a))))};r.cancel=nf,s[t]=r})),e.cancel=function(){n||(n=!0,r.forEach((function(t){return s[t].cancel()})))},s}function gf(t){return{name:t.name||"anonymous",location:bf(t)}}function bf(t){return t[jh]}var _f="Channel's Buffer overflow!",wf=1,Ef=3,xf=4,Tf={isEmpty:ef,put:nf,take:nf};function Cf(t,e){void 0===t&&(t=10);var n=new Array(t),r=0,i=0,o=0,a=function(e){n[i]=e,i=(i+1)%t,r++},s=function(){if(0!=r){var e=n[o];return n[o]=null,r--,o=(o+1)%t,e}},u=function(){for(var t=[];r;)t.push(s());return t};return{isEmpty:function(){return 0==r},put:function(s){var c;if(r<t)a(s);else switch(e){case wf:throw new Error(_f);case Ef:n[i]=s,o=i=(i+1)%t;break;case xf:c=2*t,n=u(),r=n.length,i=n.length,o=0,n.length=c,t=c,a(s)}},take:s,flush:u}}var kf=function(){return Tf},Sf=function(t){return Cf(t,Ef)},Af=function(t){return Cf(t,xf)},If="TAKE",Of="PUT",Pf="ALL",Df="CALL",Nf="FORK",Rf="CANCEL",Mf="SELECT",Lf="ACTION_CHANNEL",Bf=function(t,e){var n;return(n={})[Nh]=!0,n.combinator=!1,n.type=t,n.payload=e,n};function Ff(t,e){return void 0===t&&(t="*"),Qh(t)?Bf(If,{pattern:t}):tf(t)&&zh(e)&&Qh(e)?Bf(If,{channel:t,pattern:e}):Jh(t)?Bf(If,{channel:t}):void 0}function Uf(t,e){return Gh(e)&&(e=t,t=void 0),Bf(Of,{channel:t,action:e})}function Vf(t){var e=Bf(Pf,t);return e.combinator=!0,e}function jf(t,e){var n,r=null;return Hh(t)?n=t:(Kh(t)?(r=t[0],n=t[1]):(r=t.context,n=t.fn),r&&Wh(n)&&Hh(r[n])&&(n=r[n])),{context:r,fn:n,args:e}}function qf(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Bf(Df,jf(t,n))}function Gf(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Bf(Nf,jf(t,n))}function zf(t){return void 0===t&&(t=Bh),Bf(Rf,t)}function Hf(t){void 0===t&&(t=rf);for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Bf(Mf,{selector:t,args:n})}var Wf=qf.bind(null,(function(t,e){var n;void 0===e&&(e=!0);var r=new Promise((function(r){n=setTimeout(r,t,e)}));return r[Ph]=function(){clearTimeout(n)},r})),Kf=function(t){return{done:!0,value:t}},Xf={};function Yf(t,e,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];var a,s,u,c,l,h={done:!1,value:(u=e,c=Sf(1),Bf(Lf,{pattern:u,buffer:c}))},f={done:!1,value:Wf(t)},d=function(t){return a=t},p=function(t){return s=t};return function(t,e,n){var r,i,o,a="q1";function s(e,n){if(a===Xf)return Kf(e);if(n&&!i)throw a=Xf,n;r&&r(e);var s=n?t[i](n):t[a]();return o=s.effect,r=s.stateUpdater,i=s.errorState,(a=s.nextState)===Xf?Kf(e):o}return lf(s,(function(t){return s(null,t)}),n)}({q1:function(){return{nextState:"q2",effect:h,stateUpdater:p}},q2:function(){return{nextState:"q3",effect:{done:!1,value:Ff(s)},stateUpdater:d}},q3:function(){return{nextState:"q4",effect:(t=a,{done:!1,value:Gf.apply(void 0,[n].concat(i,[t]))})};var t},q4:function(){return{nextState:"q2",effect:f}}},0,"throttle("+(Jh(l=e)?"channel":Zh(l)?String(l):Hh(l)?l.name:String(l))+", "+n.name+")")}function Qf(){return{type:fh.GameStart}}function Jf(t,e){switch(t.type){case Th.PlayerSpawn:return Uf({type:fh.CreatePlayerSpawn,block:t});case Th.EnemySpawn:return Uf({type:fh.CreateEnemySpawn,block:t});case Th.Water:return Uf({type:fh.CreateWater,id:"water-".concat(e),block:t});case Th.Tree:return Uf((n="tree-".concat(e),r=t,{type:fh.CreateTree,id:n,block:r}));case Th.Blockade:return Uf(function(t,e){return{type:fh.CreateBlockade,id:t,block:e}}("blockade-".concat(e),t));case Th.Eagle:return Uf(function(t,e){return{type:fh.CreateEagle,id:t,block:e}}("eagle-".concat(e),t));case Th.Brick1:case Th.Brick2:return Uf(function(t,e){return{type:fh.CreateBrick,id:t,block:e}}("brick-".concat(e),t));case Th.Steel:return Uf(function(t,e){return{type:fh.CreateSteel,id:t,block:e}}("steel-".concat(e),t));default:throw new Error("unknown game object ".concat(JSON.stringify(t,null,2)))}var n,r}function Zf(t){return Math.floor(Math.random()*Math.floor(t))}function $f(t){return[t.currentGame.player].concat(_toConsumableArray(t.currentGame.players))}function td(t){return t.worldState.players}function ed(t){return t.currentGame.playerSpawns}function nd(t){var e,n,r,i,a;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Hf(ed);case 2:return e=o.sent,o.next=5,Hf(td);case 5:if(n=o.sent,!(t.lives>0)||n.find((function(e){return e.id===t.id}))){o.next=10;break}return r=e[Zf(e.length)],o.next=10,Uf((i=t.id,a=r.block,{type:fh.CreatePlayer,id:i,spawnBlock:a}));case 10:case"end":return o.stop()}}),o)}function rd(t){return Object.values(t.currentGame.enemies)}function id(t){return t.currentGame.waitingEnemies}function od(t){return t.currentGame.enemySpawns}function ad(t){var e,n,r,i,o,s,u,c=arguments;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e=c.length>1&&void 0!==c[1]?c[1]:4e3;case 1:return a.next=3,Wf(e);case 3:return a.next=5,Hf(rd);case 5:if(a.t0=a.sent.length,a.t1=t,!(a.t0>=a.t1)){a.next=9;break}return a.abrupt("return");case 9:return a.next=11,Hf(id);case 11:if(0!==(n=a.sent).length){a.next=14;break}return a.abrupt("return");case 14:return a.next=16,Hf(od);case 16:return r=a.sent,i=r[Zf(r.length)],a.next=20,Uf((o=n[0].id,s=i.block,u=n[0].type,{type:fh.CreateEnemy,id:o,spawnBlock:s,tankType:u}));case 20:a.next=1;break;case 22:case"end":return a.stop()}}),a)}function sd(t){return t[Zf(t.length)]}function ud(t){return[mh.StageLoaded,mh.Start,mh.Stop].some((function(e){return t.currentGame.status===e}))}function cd(t,e){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,qf.apply(void 0,[t].concat(_toConsumableArray(e)));case 3:n.next=8;break;case 5:throw n.prev=5,n.t0=n.catch(0),n.t0;case 8:case"end":return n.stop()}}),s,null,[[0,5]])}var ld=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return Gf(cd,t,n)};function hd(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ff(fh.GameStart);case 2:if(!e.sent){e.next=16;break}return e.next=5,Hf(ud);case 5:if(e.sent){e.next=7;break}return e.abrupt("continue",14);case 7:return e.next=9,ld.apply(void 0,[t].concat(n));case 9:return r=e.sent,e.next=12,Ff(fh.GameStop);case 12:return e.next=14,zf(r);case 14:e.next=0;break;case 16:case"end":return e.stop()}}),e)})))}var fd=[ph.Left,ph.Right,ph.Up,ph.Down,ph.Shot];function dd(){var t,e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Wf(100);case 2:return n.next=4,Hf(rd);case 4:n.t0=function(t){var e,n,r=sd(fd);return Uf((e=t.id,n=r,{type:fh.EnemyAction,id:e,action:n}))},t=n.sent.map(n.t0),e=0;case 7:if(!(e<5)){n.next=15;break}return n.next=10,Vf(t);case 10:return n.next=12,Wf(300);case 12:e++,n.next=7;break;case 15:n.next=0;break;case 17:case"end":return n.stop()}}),u)}var pd=Object.keys,vd=Array.isArray,md="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function yd(t,e){return"object"!=typeof e?t:(pd(e).forEach((function(n){t[n]=e[n]})),t)}var gd=Object.getPrototypeOf,bd={}.hasOwnProperty;function _d(t,e){return bd.call(t,e)}function wd(t,e){"function"==typeof e&&(e=e(gd(t))),pd(e).forEach((function(n){xd(t,n,e[n])}))}var Ed=Object.defineProperty;function xd(t,e,n,r){Ed(t,e,yd(n&&_d(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Td(t){return{from:function(e){return t.prototype=Object.create(e.prototype),xd(t.prototype,"constructor",t),{extend:wd.bind(null,t.prototype)}}}}var Cd=Object.getOwnPropertyDescriptor,kd=[].slice;function Sd(t,e,n){return kd.call(t,e,n)}function Ad(t,e){return e(t)}function Id(t){if(!t)throw new Error("Assertion Failed")}function Od(t){md.setImmediate?setImmediate(t):setTimeout(t,0)}function Pd(t,e){return t.reduce((function(t,n,r){var i=e(n,r);return i&&(t[i[0]]=i[1]),t}),{})}function Dd(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function Nd(t,e){if(_d(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var o=Nd(t,e[r]);n.push(o)}return n}var a=e.indexOf(".");if(-1!==a){var s=t[e.substr(0,a)];return void 0===s?void 0:Nd(s,e.substr(a+1))}}function Rd(t,e,n){if(t&&void 0!==e&&!("isFrozen"in Object&&Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){Id("string"!=typeof n&&"length"in n);for(var r=0,i=e.length;r<i;++r)Rd(t,e[r],n[r])}else{var o=e.indexOf(".");if(-1!==o){var a=e.substr(0,o),s=e.substr(o+1);if(""===s)void 0===n?delete t[a]:t[a]=n;else{var u=t[a];u||(u=t[a]={}),Rd(u,s,n)}}else void 0===n?delete t[e]:t[e]=n}}function Md(t){var e={};for(var n in t)_d(t,n)&&(e[n]=t[n]);return e}var Ld=[].concat;function Bd(t){return Ld.apply([],t)}var Fd="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(Bd([8,16,32,64].map((function(t){return["Int","Uint","Float"].map((function(e){return e+t+"Array"}))})))).filter((function(t){return md[t]})).map((function(t){return md[t]}));function Ud(t){if(!t||"object"!=typeof t)return t;var e;if(vd(t)){e=[];for(var n=0,r=t.length;n<r;++n)e.push(Ud(t[n]))}else if(Fd.indexOf(t.constructor)>=0)e=t;else for(var i in e=t.constructor?Object.create(t.constructor.prototype):{},t)_d(t,i)&&(e[i]=Ud(t[i]));return e}function Vd(t,e,n,r){return n=n||{},r=r||"",pd(t).forEach((function(i){if(_d(e,i)){var o=t[i],a=e[i];"object"==typeof o&&"object"==typeof a&&o&&a&&""+o.constructor==""+a.constructor?Vd(o,a,n,r+i+"."):o!==a&&(n[r+i]=e[i])}else n[r+i]=void 0})),pd(e).forEach((function(i){_d(t,i)||(n[r+i]=e[i])})),n}var jd="undefined"!=typeof Symbol&&Symbol.iterator,qd=jd?function(t){var e;return null!=t&&(e=t[jd])&&e.apply(t)}:function(){return null},Gd={};function zd(t){var e,n,r,i;if(1===arguments.length){if(vd(t))return t.slice();if(this===Gd&&"string"==typeof t)return[t];if(i=qd(t)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var Hd="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wd(t,e){Hd=t,Kd=e}var Kd=function(){return!0},Xd=!new Error("").stack;function Yd(){if(Xd)try{throw new Error}catch(t){return t}return new Error}function Qd(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(Kd).map((function(t){return"\n"+t})).join("")):""}var Jd=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Zd=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Jd),$d={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function tp(t,e){this._e=Yd(),this.name=t,this.message=e}function ep(t,e,n,r){this._e=Yd(),this.failures=e,this.failedKeys=r,this.successCount=n}function np(t,e){this._e=Yd(),this.name="BulkError",this.failures=e,this.message=function(t,e){return t+". Errors: "+e.map((function(t){return t.toString()})).filter((function(t,e,n){return n.indexOf(t)===e})).join("\n")}(t,e)}Td(tp).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Qd(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Td(ep).from(tp),Td(np).from(tp);var rp=Zd.reduce((function(t,e){return t[e]=e+"Error",t}),{}),ip=tp,op=Zd.reduce((function(t,e){var n=e+"Error";function r(t,r){this._e=Yd(),this.name=n,t?"string"==typeof t?(this.message=t,this.inner=r||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=$d[e]||n,this.inner=null)}return Td(r).from(ip),t[e]=r,t}),{});op.Syntax=SyntaxError,op.Type=TypeError,op.Range=RangeError;var ap=Jd.reduce((function(t,e){return t[e+"Error"]=op[e],t}),{}),sp=Zd.reduce((function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=op[e]),t}),{});function up(){}function cp(t){return t}function lp(t,e){return null==t||t===cp?e:function(n){return e(t(n))}}function hp(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function fp(t,e){return t===up?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?hp(r,this.onsuccess):r),i&&(this.onerror=this.onerror?hp(i,this.onerror):i),void 0!==o?o:n}}function dp(t,e){return t===up?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?hp(n,this.onsuccess):n),r&&(this.onerror=this.onerror?hp(r,this.onerror):r)}}function pp(t,e){return t===up?e:function(n){var r=t.apply(this,arguments);yd(n,r);var i=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?hp(i,this.onsuccess):i),o&&(this.onerror=this.onerror?hp(o,this.onerror):o),void 0===r?void 0===a?void 0:a:yd(r,a)}}function vp(t,e){return t===up?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function mp(t,e){return t===up?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then((function(){return e.apply(r,o)}))}return e.apply(this,arguments)}}sp.ModifyError=ep,sp.DexieError=tp,sp.BulkError=np;var yp={},gp=100,bp=7,_p=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(e){var t=md.Promise;return t?[t.resolve(),t.prototype,t.resolve()]:[]}}(),wp=_p[0],Ep=_p[1],xp=_p[2],Tp=Ep&&Ep.then,Cp=wp&&wp.constructor,kp=_p[3],Sp=!!xp,Ap=!1,Ip=xp?function(){xp.then(Qp)}:md.setImmediate?setImmediate.bind(null,Qp):md.MutationObserver?function(){var t=document.createElement("div");new MutationObserver((function(){Qp(),t=null})).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(Qp,0)},Op=function(t,e){Up.push([t,e]),Dp&&(Ip(),Dp=!1)},Pp=!0,Dp=!0,Np=[],Rp=[],Mp=null,Lp=cp,Bp={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:_v,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(t){try{_v(t[0],t[1])}catch(e){}}))}},Fp=Bp,Up=[],Vp=0,jp=[];function qp(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=up,this._lib=!1;var e=this._PSD=Fp;if(Hd&&(this._stackHolder=Yd(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==yp)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Hp(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,n){try{n((function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Jp();n&&"function"==typeof n.then?t(e,(function(t,e){n instanceof qp?n._then(t,e):n.then(t,e)})):(e._state=!0,e._value=n,Wp(e)),r&&Zp()}}),Hp.bind(null,e))}catch(r){Hp(e,r)}}(this,t)}var Gp={get:function(){var t=Fp,e=av;function n(n,r){var i=this,o=!t.global&&(t!==Fp||e!==av);o&&lv();var a=new qp((function(e,a){Kp(i,new zp(yv(n,t,o),yv(r,t,o),e,a,t))}));return Hd&&Yp(a,this),a}return n.prototype=yp,n},set:function(t){xd(this,"then",t&&t.prototype===yp?Gp:{get:function(){return t},set:Gp.set})}};function zp(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function Hp(t,e){if(Rp.push(e),null===t._state){var n=t._lib&&Jp();e=Lp(e),t._state=!1,t._value=e,Hd&&null!==e&&"object"==typeof e&&!e._promise&&Dd((function(){var n=function t(e,n){var r;return Cd(e,n)||(r=gd(e))&&t(r,n)}(e,"stack");e._promise=t,xd(e,"stack",{get:function(){return Ap?n&&(n.get?n.get.apply(e):n.value):t.stack}})})),function(t){Np.some((function(e){return e._value===t._value}))||Np.push(t)}(t),Wp(t),n&&Zp()}}function Wp(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Kp(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),0===Vp&&(++Vp,Op((function(){0==--Vp&&$p()}),[]))}function Kp(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Vp,Op(Xp,[n,t,e])}else t._listeners.push(e)}function Xp(t,e,n){try{Mp=e;var r,i=e._value;e._state?r=t(i):(Rp.length&&(Rp=[]),r=t(i),-1===Rp.indexOf(i)&&function(t){for(var e=Np.length;e;)if(Np[--e]._value===t._value)return void Np.splice(e,1)}(e)),n.resolve(r)}catch(o){n.reject(o)}finally{Mp=null,0==--Vp&&$p(),--n.psd.ref||n.psd.finalize()}}function Yp(t,e){var n=e?e._numPrev+1:0;n<gp&&(t._prev=e,t._numPrev=n)}function Qp(){Jp()&&Zp()}function Jp(){var t=Pp;return Pp=!1,Dp=!1,t}function Zp(){var t,e,n;do{for(;Up.length>0;)for(t=Up,Up=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(Up.length>0);Pp=!0,Dp=!0}function $p(){var t=Np;Np=[],t.forEach((function(t){t._PSD.onunhandled.call(null,t._value,t)}));for(var e=jp.slice(0),n=e.length;n;)e[--n]()}function tv(t){return new qp(yp,!1,t)}function ev(t,e){var n=Fp;return function(){var r=Jp(),i=Fp;try{return pv(n,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{pv(i,!1),r&&Zp()}}}wd(qp.prototype,{then:Gp,_then:function(t,e){Kp(this,new zp(null,null,t,e,Fp))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return this.then(null,"function"==typeof e?function(t){return t instanceof e?n(t):tv(t)}:function(t){return t&&t.name===e?n(t):tv(t)})},finally:function(t){return this.then((function(e){return t(),e}),(function(e){return t(),tv(e)}))},stack:{get:function(){if(this._stack)return this._stack;try{Ap=!0;var t=function t(e,n,r){if(n.length===r)return n;var i="";if(!1===e._state){var o,a,s=e._value;null!=s?(o=s.name||"Error",a=s.message||s,i=Qd(s,0)):(o=s,a=""),n.push(o+(a?": "+a:"")+i)}return Hd&&((i=Qd(e._stackHolder,2))&&-1===n.indexOf(i)&&n.push(i),e._prev&&t(e._prev,n,r)),n}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{Ap=!1}}},timeout:function(t,e){var n=this;return t<1/0?new qp((function(r,i){var o=setTimeout((function(){return i(new op.Timeout(e))}),t);n.then(r,i).finally(clearTimeout.bind(null,o))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&xd(qp.prototype,Symbol.toStringTag,"Promise"),Bp.env=vv(),wd(qp,{all:function(){var t=zd.apply(null,arguments).map(hv);return new qp((function(e,n){0===t.length&&e([]);var r=t.length;t.forEach((function(i,o){return qp.resolve(i).then((function(n){t[o]=n,--r||e(t)}),n)}))}))},resolve:function(t){if(t instanceof qp)return t;if(t&&"function"==typeof t.then)return new qp((function(e,n){t.then(e,n)}));var e=new qp(yp,!0,t);return Yp(e,Mp),e},reject:tv,race:function(){var t=zd.apply(null,arguments).map(hv);return new qp((function(e,n){t.map((function(t){return qp.resolve(t).then(e,n)}))}))},PSD:{get:function(){return Fp},set:function(t){return Fp=t}},newPSD:uv,usePSD:mv,scheduler:{get:function(){return Op},set:function(t){Op=t}},rejectionMapper:{get:function(){return Lp},set:function(t){Lp=t}},follow:function(t,e){return new qp((function(n,r){return uv((function(e,n){var r=Fp;r.unhandleds=[],r.onunhandled=n,r.finalize=hp((function(){var t=this;jp.push((function r(){0===t.unhandleds.length?e():n(t.unhandleds[0]),jp.splice(jp.indexOf(r),1)})),++Vp,Op((function(){0==--Vp&&$p()}),[])}),r.finalize),t()}),e,n,r)}))}});var nv={awaits:0,echoes:0,id:0},rv=0,iv=[],ov=0,av=0,sv=0;function uv(t,e,n,r){var i=Fp,o=Object.create(i);o.parent=i,o.ref=0,o.global=!1,o.id=++sv;var a=Bp.env;o.env=Sp?{Promise:qp,PromiseProp:{value:qp,configurable:!0,writable:!0},all:qp.all,race:qp.race,resolve:qp.resolve,reject:qp.reject,nthen:gv(a.nthen,o),gthen:gv(a.gthen,o)}:{},e&&yd(o,e),++i.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=mv(o,t,n,r);return 0===o.ref&&o.finalize(),s}function cv(){return nv.id||(nv.id=++rv),++nv.awaits,nv.echoes+=bp,nv.id}function lv(t){!nv.awaits||t&&t!==nv.id||(0==--nv.awaits&&(nv.id=0),nv.echoes=nv.awaits*bp)}function hv(t){return nv.echoes&&t&&t.constructor===Cp?(cv(),t.then((function(t){return lv(),t}),(function(t){return lv(),wv(t)}))):t}function fv(t){++av,nv.echoes&&0!=--nv.echoes||(nv.echoes=nv.id=0),iv.push(Fp),pv(t,!0)}function dv(){var t=iv[iv.length-1];iv.pop(),pv(t,!1)}function pv(t,e){var n,r=Fp;if((e?!nv.echoes||ov++&&t===Fp:!ov||--ov&&t===Fp)||(n=e?fv.bind(null,t):dv,Tp.call(wp,n)),t!==Fp&&(Fp=t,r===Bp&&(Bp.env=vv()),Sp)){var i=Bp.env.Promise,o=t.env;Ep.then=o.nthen,i.prototype.then=o.gthen,(r.global||t.global)&&(Object.defineProperty(md,"Promise",o.PromiseProp),i.all=o.all,i.race=o.race,i.resolve=o.resolve,i.reject=o.reject)}}function vv(){var t=md.Promise;return Sp?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(md,"Promise"),all:t.all,race:t.race,resolve:t.resolve,reject:t.reject,nthen:Ep.then,gthen:t.prototype.then}:{}}function mv(t,e,n,r,i){var o=Fp;try{return pv(t,!0),e(n,r,i)}finally{pv(o,!1)}}function yv(t,e,n){return"function"!=typeof t?t:function(){var r=Fp;n&&cv(),pv(e,!0);try{return t.apply(this,arguments)}finally{pv(r,!1)}}}function gv(t,e){return function(n,r){return t.call(this,yv(n,e,!1),yv(r,e,!1))}}var bv="unhandledrejection";function _v(t,e){var n;try{n=e.onuncatched(t)}catch(o){}if(!1!==n)try{var r,i={promise:e,reason:t};if(md.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(bv,!0,!0),yd(r,i)):md.CustomEvent&&yd(r=new CustomEvent(bv,{detail:i}),i),r&&md.dispatchEvent&&(dispatchEvent(r),!md.PromiseRejectionEvent&&md.onunhandledrejection))try{md.onunhandledrejection(r)}catch(a){}r.defaultPrevented||console.warn("Unhandled rejection: "+(t.stack||t))}catch(o){}}var wv=qp.reject;function Ev(t){var e={},n=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[n].subscribe.apply(null,o),t}if("string"==typeof n)return e[n]};n.addEventType=o;for(var r=1,i=arguments.length;r<i;++r)o(arguments[r]);return n;function o(t,r,i){if("object"!=typeof t){var a;r||(r=vp),i||(i=up);var s={subscribers:[],fire:i,subscribe:function(t){-1===s.subscribers.indexOf(t)&&(s.subscribers.push(t),s.fire=r(s.fire,t))},unsubscribe:function(t){s.subscribers=s.subscribers.filter((function(e){return e!==t})),s.fire=s.subscribers.reduce(r,i)}};return e[t]=n[t]=s,s}pd(a=t).forEach((function(t){var e=a[t];if(vd(e))o(t,a[t][0],a[t][1]);else{if("asap"!==e)throw new op.InvalidArgument("Invalid event config");var n=o(t,cp,(function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];n.subscribers.forEach((function(t){Od((function(){t.apply(null,e)}))}))}))}}))}}var xv,Tv=String.fromCharCode(65535),Cv=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(t){return Tv}}(),kv=-1/0,Sv="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Av="String expected.",Iv=[],Ov="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Pv=Ov,Dv=Ov,Nv=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)};function Rv(t,e){var n,r,i,o,a,s=Rv.dependencies,u=yd({addons:Rv.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},e),c=u.addons,l=u.autoOpen,h=u.indexedDB,f=u.IDBKeyRange,d=this._dbSchema={},p=[],v=[],m={},y=null,g=null,b=!1,_=null,w=!1,E="readwrite",x=this,T=new qp((function(t){n=t})),C=new qp((function(t,e){r=e})),k=!0,S=!!Hv(h);function A(t){this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function I(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(t){O(i,t)})),i}function O(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function P(t,e,n){var r=arguments.length;if(r<2)throw new op.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,Bd(i),n]}function D(t,e,n){this.name=t,this.schema=e,this._tx=n,this.hook=m[t]?m[t].hook:Ev(null,{creating:[fp,up],reading:[lp,cp],updating:[pp,up],deleting:[dp,up]})}function N(t,e,n){return(n?Uv:Bv)((function(n){t.push(n),e&&e()}))}function R(t,e,n,r,i){return new qp((function(o,a){var s=n.length,u=s-1;if(0===s)return o();if(r){var c,l=Uv(a),h=Lv(null);Dd((function(){for(var r=0;r<s;++r){var a=n[r];i.call(c={onsuccess:null,onerror:null},a[0],a[1],e);var f=t.delete(a[0]);f._hookCtx=c,f.onerror=l,f.onsuccess=r===u?Lv(o):h}}),(function(t){throw c.onerror&&c.onerror(t),t}))}else for(var f=0;f<s;++f){var d=t.delete(n[f]);d.onerror=Bv(a),f===u&&(d.onsuccess=ev((function(){return o()})))}}))}function M(t,e,n,r){var i=this;this.db=x,this.mode=t,this.storeNames=e,this.idbtrans=null,this.on=Ev(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new qp((function(t,e){i._resolve=t,i._reject=e})),this._completion.then((function(){i.active=!1,i.on.complete.fire()}),(function(t){var e=i.active;return i.active=!1,i.on.error.fire(t),i.parent?i.parent._reject(t):e&&i.idbtrans&&i.idbtrans.abort(),wv(t)}))}function L(t,e,n){this._ctx={table:t,index:":id"===e?null:e,or:n}}function B(t,e){var n=null,r=null;if(e)try{n=e()}catch(a){r=a}var i=t._ctx,o=i.table;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:o.hook.reading.fire}}function F(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function U(t,e){return t._cfg.version-e._cfg.version}function V(t,e,n){e.forEach((function(e){var r=n[e];t.forEach((function(t){e in t||(t===M.prototype||t instanceof M?xd(t,e,{get:function(){return this.table(e)}}):t[e]=new D(e,r))}))}))}function j(t,e,n,r,i,o){var a=ev(o?function(t,e,r){return n(o(t),e,r)}:n,i);t.onerror||(t.onerror=Bv(i)),t.onsuccess=function(t,e){return function(){try{t.apply(this,arguments)}catch(n){e(n)}}}(e?function(){var n=t.result;if(n){var o=function(){n.continue()};e(n,(function(t){o=t}),r,i)&&a(n.value,n,(function(t){o=t})),o()}else r()}:function(){var e=t.result;if(e){var n=function(){e.continue()};a(e.value,e,(function(t){n=t})),n()}else r()},i)}function q(t,e){return h.cmp(t,e)}function G(t,e){return q(t,e)>0?t:e}function z(t,e){return h.cmp(t,e)}function H(t,e){return h.cmp(e,t)}function W(t,e){return t<e?-1:t===e?0:1}function K(t,e){return t>e?-1:t===e?0:1}function X(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}function Y(t,e){for(var n=e.db.objectStoreNames,r=0;r<n.length;++r){var o=n[r],a=e.objectStore(o);i="getAll"in a;for(var s=0;s<a.indexNames.length;++s){var u=a.indexNames[s],c=a.index(u).keyPath,l="string"==typeof c?c:"["+Sd(c).join("+")+"]";if(t[o]){var h=t[o].idxByName[l];h&&(h.name=u)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&md.WorkerGlobalScope&&md instanceof md.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(i=!1)}function Q(t){x.on("blocked").fire(t),Iv.filter((function(t){return t.name===x.name&&t!==x&&!t._vcFired})).map((function(e){return e.on("versionchange").fire(t)}))}this.version=function(t){if(y||b)throw new op.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=p.filter((function(e){return e._cfg.version===t}))[0];return e||(e=new A(t),p.push(e),p.sort(U),k=!1,e)},yd(A.prototype,{stores:function(t){this._cfg.storesSource=this._cfg.storesSource?yd(this._cfg.storesSource,t):t;var e={};p.forEach((function(t){yd(e,t._cfg.storesSource)}));var n=this._cfg.dbschema={};return this._parseStoresSpec(e,n),d=x._dbSchema=n,[m,x,M.prototype].forEach((function(t){for(var e in t)t[e]instanceof D&&delete t[e]})),V([m,x,M.prototype,this._cfg.tables],pd(n),n),v=pd(n),this},upgrade:function(t){return this._cfg.contentUpgrade=t,this},_parseStoresSpec:function(t,e){pd(t).forEach((function(n){if(null!==t[n]){var r={},i=function(t){var e=[];return t.split(",").forEach((function(t){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;e.push(new qv(n,r||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),vd(r),/\./.test(t)))})),e}(t[n]),o=i.shift();if(o.multi)throw new op.Schema("Primary key cannot be multi-valued");o.keyPath&&Rd(r,o.keyPath,o.auto?0:o.keyPath),i.forEach((function(t){if(t.auto)throw new op.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new op.Schema("Index must have a name and cannot be an empty string");Rd(r,t.keyPath,t.compound?t.keyPath.map((function(){return""})):"")})),e[n]=new Gv(n,o,i,r)}}))}}),this._allTables=m,this._createTransaction=function(t,e,n,r){return new M(t,e,n,r)},this._whenReady=function(t){return w||Fp.letThrough?t():new qp((function(t,e){if(!b){if(!l)return void e(new op.DatabaseClosed);x.open().catch(up)}T.then(t,e)})).then(t)},this.verno=0,this.open=function(){if(b||y)return T.then((function(){return g?wv(g):x}));Hd&&(C._stackHolder=Yd()),b=!0,g=null,w=!1;var e=n,r=null;return qp.race([C,new qp((function(e,n){if(!h)throw new op.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var i=k?h.open(t):h.open(t,Math.round(10*x.verno));if(!i)throw new op.MissingAPI("IndexedDB API not available");i.onerror=Bv(n),i.onblocked=ev(Q),i.onupgradeneeded=ev((function(e){if(r=i.transaction,k&&!x._allowEmptyDB){i.onerror=Vv,r.abort(),i.result.close();var o=h.deleteDatabase(t);o.onsuccess=o.onerror=ev((function(){n(new op.NoSuchDatabase("Database "+t+" doesnt exist"))}))}else r.onerror=Bv(n),function(t,e,n){var r=x._createTransaction(E,v,d);r.create(e),r._completion.catch(n);var i=r._reject.bind(r);uv((function(){Fp.trans=r,0===t?(pd(d).forEach((function(t){I(e,t,d[t].primKey,d[t].indexes)})),qp.follow((function(){return x.on.populate.fire(r)})).catch(i)):function(t,e,n){var r=[],i=p.filter((function(e){return e._cfg.version===t}))[0];if(!i)throw new op.Upgrade("Dexie specification of currently installed DB version is missing");d=x._dbSchema=i._cfg.dbschema;var o=!1;return p.filter((function(e){return e._cfg.version>t})).forEach((function(t){r.push((function(){var r=d,i=t._cfg.dbschema;Y(r,n),Y(i,n),d=x._dbSchema=i;var a=function(t,e){var n={del:[],add:[],change:[]};for(var r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],o=e[r];if(i){var a={name:r,def:o,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==o.primKey.src)a.recreate=!0,n.change.push(a);else{var s=i.idxByName,u=o.idxByName;for(var c in s)u[c]||a.del.push(c);for(c in u){var l=s[c],h=u[c];l?l.src!==h.src&&a.change.push(h):a.add.push(h)}(a.del.length>0||a.add.length>0||a.change.length>0)&&n.change.push(a)}}else n.add.push([r,o])}return n}(r,i);if(a.add.forEach((function(t){I(n,t[0],t[1].primKey,t[1].indexes)})),a.change.forEach((function(t){if(t.recreate)throw new op.Upgrade("Not yet support for changing primary key");var e=n.objectStore(t.name);t.add.forEach((function(t){O(e,t)})),t.change.forEach((function(t){e.deleteIndex(t.name),O(e,t)})),t.del.forEach((function(t){e.deleteIndex(t)}))})),t._cfg.contentUpgrade)return o=!0,qp.follow((function(){t._cfg.contentUpgrade(e)}))})),r.push((function(e){o&&Pv||function(t,e){for(var n=0;n<e.db.objectStoreNames.length;++n){var r=e.db.objectStoreNames[n];null==t[r]&&e.db.deleteObjectStore(r)}}(t._cfg.dbschema,e)}))})),function t(){return r.length?qp.resolve(r.shift()(e.idbtrans)).then(t):qp.resolve()}().then((function(){!function(t,e){pd(t).forEach((function(n){e.db.objectStoreNames.contains(n)||I(e,n,t[n].primKey,t[n].indexes)}))}(d,n)}))}(t,r,e).catch(i)}))}((e.oldVersion>Math.pow(2,62)?0:e.oldVersion)/10,r,n)}),n),i.onsuccess=ev((function(){if(r=null,y=i.result,Iv.push(x),k)!function(){if(x.verno=y.version/10,x._dbSchema=d={},0!==(v=Sd(y.objectStoreNames,0)).length){var t=y.transaction(zv(v),"readonly");v.forEach((function(e){for(var n=t.objectStore(e),r=n.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf("."),o=new qv(r,r||"",!1,!1,!!n.autoIncrement,r&&"string"!=typeof r,i),a=[],s=0;s<n.indexNames.length;++s){var u=n.index(n.indexNames[s]);i=(r=u.keyPath)&&"string"==typeof r&&-1!==r.indexOf(".");var c=new qv(u.name,r,!!u.unique,!!u.multiEntry,!1,r&&"string"!=typeof r,i);a.push(c)}d[e]=new Gv(e,o,a,{})})),V([m],pd(d),d)}}();else if(y.objectStoreNames.length>0)try{Y(d,y.transaction(zv(y.objectStoreNames),"readonly"))}catch(n){}y.onversionchange=ev((function(t){x._vcFired=!0,x.on("versionchange").fire(t)})),S||"__dbnames"===t||xv.dbnames.put({name:t}).catch(up),e()}),n)}))]).then((function(){return _=[],qp.resolve(Rv.vip(x.on.ready.fire)).then((function t(){if(_.length>0){var e=_.reduce(mp,up);return _=[],qp.resolve(Rv.vip(e)).then(t)}}))})).finally((function(){_=null})).then((function(){return b=!1,x})).catch((function(t){try{r&&r.abort()}catch(e){}return b=!1,x.close(),wv(g=t)})).finally((function(){w=!0,e()}))},this.close=function(){var t=Iv.indexOf(x);if(t>=0&&Iv.splice(t,1),y){try{y.close()}catch(e){}y=null}l=!1,g=new op.DatabaseClosed,b&&r(g),T=new qp((function(t){n=t})),C=new qp((function(t,e){r=e}))},this.delete=function(){var e=arguments.length>0;return new qp((function(n,r){if(e)throw new op.InvalidArgument("Arguments not allowed in db.delete()");function i(){x.close();var e=h.deleteDatabase(t);e.onsuccess=ev((function(){S||xv.dbnames.delete(t).catch(up),n()})),e.onerror=Bv(r),e.onblocked=Q}b?T.then(i):i()}))},this.backendDB=function(){return y},this.isOpen=function(){return null!==y},this.hasBeenClosed=function(){return g&&g instanceof op.DatabaseClosed},this.hasFailed=function(){return null!==g},this.dynamicallyOpened=function(){return k},this.name=t,wd(this,{tables:{get:function(){return pd(m).map((function(t){return m[t]}))}}}),this.on=Ev(this,"populate","blocked","versionchange",{ready:[mp,up]}),this.on.ready.subscribe=Ad(this.on.ready.subscribe,(function(t){return function(e,n){Rv.vip((function(){w?(g||qp.resolve().then(e),n&&t(e)):_?(_.push(e),n&&t(e)):(t(e),n||t((function t(){x.on.ready.unsubscribe(e),x.on.ready.unsubscribe(t)})))}))}})),this.transaction=function(){var t=P.apply(this,arguments);return this._transaction.apply(this,t)},this._transaction=function(t,e,n){var r=Fp.trans;r&&r.db===x&&-1===t.indexOf("!")||(r=null);var i=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{var o=e.map((function(t){var e=t instanceof D?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}));if("r"==t||"readonly"==t)t="readonly";else{if("rw"!=t&&t!=E)throw new op.InvalidArgument("Invalid transaction mode: "+t);t=E}if(r){if("readonly"===r.mode&&t===E){if(!i)throw new op.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&o.forEach((function(t){if(r&&-1===r.storeNames.indexOf(t)){if(!i)throw new op.SubTransaction("Table "+t+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(s){return r?r._promise(null,(function(t,e){e(s)})):wv(s)}return r?r._promise(t,a,"lock"):Fp.trans?mv(Fp.transless,(function(){return x._whenReady(a)})):x._whenReady(a);function a(){return qp.resolve().then((function(){var e,i=Fp.transless||Fp,a=x._createTransaction(t,o,d,r),s={trans:a,transless:i};r?a.idbtrans=r.idbtrans:a.create(),n.constructor===kp&&cv();var u=qp.follow((function(){if(e=n.call(a,a))if(e.constructor===Cp){var t=lv.bind(null,null);e.then(t,t)}else"function"==typeof e.next&&"function"==typeof e.throw&&(e=jv(e))}),s);return(e&&"function"==typeof e.then?qp.resolve(e).then((function(t){return a.active?t:wv(new op.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):u.then((function(){return e}))).then((function(t){return r&&a._resolve(),a._completion.then((function(){return t}))})).catch((function(t){return a._reject(t),wv(t)}))}))}},this.table=function(t){if(!_d(m,t))throw new op.InvalidTable("Table "+t+" does not exist");return m[t]},wd(D.prototype,{_trans:function(t,e,n){var r=this._tx||Fp.trans;return r&&r.db===x?r===Fp.trans?r._promise(t,e,n):uv((function(){return r._promise(t,e,n)}),{trans:r,transless:Fp.transless||Fp}):function t(e,n,r){if(w||Fp.letThrough){var i=x._createTransaction(e,n,d);try{i.create()}catch(o){return wv(o)}return i._promise(e,(function(t,e){return uv((function(){return Fp.trans=i,r(t,e,i)}))})).then((function(t){return i._completion.then((function(){return t}))}))}if(!b){if(!l)return wv(new op.DatabaseClosed);x.open().catch(up)}return T.then((function(){return t(e,n,r)}))}(t,[this.name],e)},_idbstore:function(t,e,n){var r=this.name;return this._trans(t,(function(t,n,i){if(-1===i.storeNames.indexOf(r))throw new op.NotFound("Table"+r+" not part of transaction");return e(t,n,i.idbtrans.objectStore(r),i)}),n)},get:function(t,e){if(t&&t.constructor===Object)return this.where(t).first(e);var n=this;return this._idbstore("readonly",(function(e,r,i){var o=i.get(t);o.onerror=Bv(r),o.onsuccess=ev((function(){e(n.hook.reading.fire(o.result))}),r)})).then(e)},where:function(t){if("string"==typeof t)return new L(this,t);if(vd(t))return new L(this,"["+t.join("+")+"]");var e=pd(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(t){return t.compound&&e.every((function(e){return t.keyPath.indexOf(e)>=0}))&&t.keyPath.every((function(t){return e.indexOf(t)>=0}))}))[0];if(n&&Cv!==Tv)return this.where(n.name).equals(n.keyPath.map((function(e){return t[e]})));n||console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a compound index ["+e.join("+")+"]");var r=this.schema.idxByName,i=e.reduce((function(e,n){return[e[0]||r[n],e[0]||!r[n]?X(e[1],(function(e){return""+Nd(e,n)==""+t[n]})):e[1]]}),[null,null]),o=i[0];return o?this.where(o.name).equals(t[o.keyPath]).filter(i[1]):n?this.filter(i[1]):this.where(e).equals("")},count:function(t){return this.toCollection().count(t)},offset:function(t){return this.toCollection().offset(t)},limit:function(t){return this.toCollection().limit(t)},reverse:function(){return this.toCollection().reverse()},filter:function(t){return this.toCollection().and(t)},each:function(t){return this.toCollection().each(t)},toArray:function(t){return this.toCollection().toArray(t)},orderBy:function(t){return new B(new L(this,vd(t)?"["+t.join("+")+"]":t))},toCollection:function(){return new B(new L(this))},mapToClass:function(t,e){this.schema.mappedClass=t;var n=Object.create(t.prototype);e&&Mv(n,e),this.schema.instanceTemplate=n;var r=function(e){if(!e)return e;var n=Object.create(t.prototype);for(var r in e)if(_d(e,r))try{n[r]=e[r]}catch(i){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),t},defineClass:function(t){return this.mapToClass(Rv.defineClass(t),t)},bulkDelete:function(t){return this.hook.deleting.fire===up?this._idbstore(E,(function(e,n,r,i){e(R(r,i,t,!1,up))})):this.where(":id").anyOf(t).delete().then((function(){}))},bulkPut:function(t,e){var n=this;return this._idbstore(E,(function(r,i,o){if(!o.keyPath&&!n.schema.primKey.auto&&!e)throw new op.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(o.keyPath&&e)throw new op.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new op.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return r();var a,s,u=function(t){0===c.length?r(t):i(new np(n.name+".bulkPut(): "+c.length+" of "+l+" operations failed",c))},c=[],l=t.length,h=n;if(n.hook.creating.fire===up&&n.hook.updating.fire===up){s=N(c);for(var f=0,d=t.length;f<d;++f)(a=e?o.put(t[f],e[f]):o.put(t[f])).onerror=s;a.onerror=N(c,u),a.onsuccess=Fv(u)}else{var p=e||o.keyPath&&t.map((function(t){return Nd(t,o.keyPath)})),v=p&&Pd(p,(function(e,n){return null!=e&&[e,t[n]]}));(p?h.where(":id").anyOf(p.filter((function(t){return null!=t}))).modify((function(){this.value=v[this.primKey],v[this.primKey]=null})).catch(ep,(function(t){c=t.failures})).then((function(){for(var n=[],r=e&&[],i=p.length-1;i>=0;--i){var o=p[i];(null==o||v[o])&&(n.push(t[i]),e&&r.push(o),null!=o&&(v[o]=null))}return n.reverse(),e&&r.reverse(),h.bulkAdd(n,r)})).then((function(t){var e=p[p.length-1];return null!=e?e:t})):h.bulkAdd(t)).then(u).catch(np,(function(t){c=c.concat(t.failures),u()})).catch(i)}}),"locked")},bulkAdd:function(t,e){var n=this,r=this.hook.creating.fire;return this._idbstore(E,(function(i,o,a,s){if(!a.keyPath&&!n.schema.primKey.auto&&!e)throw new op.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(a.keyPath&&e)throw new op.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(e&&e.length!==t.length)throw new op.InvalidArgument("Arguments objects and keys must have the same length");if(0===t.length)return i();function u(t){0===f.length?i(t):o(new np(n.name+".bulkAdd(): "+f.length+" of "+d+" operations failed",f))}var c,l,h,f=[],d=t.length;if(r!==up){var p,v=a.keyPath;l=N(f,null,!0),h=Lv(null),Dd((function(){for(var n=0,i=t.length;n<i;++n){p={onerror:null,onsuccess:null};var o=e&&e[n],u=t[n],f=e?o:v?Nd(u,v):void 0,d=r.call(p,f,u,s);null==f&&null!=d&&(v?Rd(u=Ud(u),v,d):o=d),(c=null!=o?a.add(u,o):a.add(u))._hookCtx=p,n<i-1&&(c.onerror=l,p.onsuccess&&(c.onsuccess=h))}}),(function(t){throw p.onerror&&p.onerror(t),t})),c.onerror=N(f,u,!0),c.onsuccess=Lv(u)}else{l=N(f);for(var m=0,y=t.length;m<y;++m)(c=e?a.add(t[m],e[m]):a.add(t[m])).onerror=l;c.onerror=N(f,u),c.onsuccess=Fv(u)}}))},add:function(t,e){var n=this.hook.creating.fire;return this._idbstore(E,(function(r,i,o,a){var s={onsuccess:null,onerror:null};if(n!==up){var u=null!=e?e:o.keyPath?Nd(t,o.keyPath):void 0,c=n.call(s,u,t,a);null==u&&null!=c&&(o.keyPath?Rd(t,o.keyPath,c):e=c)}try{var l=null!=e?o.add(t,e):o.add(t);l._hookCtx=s,l.onerror=Uv(i),l.onsuccess=Lv((function(e){var n=o.keyPath;n&&Rd(t,n,e),r(e)}))}catch(h){throw s.onerror&&s.onerror(h),h}}))},put:function(t,e){var n=this;if(this.hook.creating.fire!==up||this.hook.updating.fire!==up){var r=this.schema.primKey.keyPath,i=void 0!==e?e:r&&Nd(t,r);return null==i?this.add(t):(t=Ud(t),this._trans(E,(function(){return n.where(":id").equals(i).modify((function(){this.value=t})).then((function(r){return 0===r?n.add(t,e):i}))}),"locked"))}return this._idbstore(E,(function(n,r,i){var o=void 0!==e?i.put(t,e):i.put(t);o.onerror=Bv(r),o.onsuccess=ev((function(e){var r=i.keyPath;r&&Rd(t,r,e.target.result),n(o.result)}))}))},delete:function(t){return this.hook.deleting.subscribers.length?this.where(":id").equals(t).delete():this._idbstore(E,(function(e,n,r){var i=r.delete(t);i.onerror=Bv(n),i.onsuccess=ev((function(){e(i.result)}))}))},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(E,(function(t,e,n){var r=n.clear();r.onerror=Bv(e),r.onsuccess=ev((function(){t(r.result)}))}))},update:function(t,e){if("object"!=typeof e||vd(e))throw new op.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||vd(t))return this.where(":id").equals(t).modify(e);pd(e).forEach((function(n){Rd(t,n,e[n])}));var n=Nd(t,this.schema.primKey.keyPath);return void 0===n?wv(new op.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(e)}}),wd(M.prototype,{_lock:function(){return Id(!Fp.global),++this._reculock,1!==this._reculock||Fp.global||(Fp.lockOwnerFor=this),this},_unlock:function(){if(Id(!Fp.global),0==--this._reculock)for(Fp.global||(Fp.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{mv(t[1],t[0])}catch(e){}}return this},_locked:function(){return this._reculock&&Fp.lockOwnerFor!==this},create:function(t){var e=this;if(!this.mode)return this;if(Id(!this.idbtrans),!t&&!y)switch(g&&g.name){case"DatabaseClosedError":throw new op.DatabaseClosed(g);case"MissingAPIError":throw new op.MissingAPI(g.message,g);default:throw new op.OpenFailed(g)}if(!this.active)throw new op.TransactionInactive;return Id(null===this._completion._state),(t=this.idbtrans=t||y.transaction(zv(this.storeNames),this.mode)).onerror=ev((function(n){Vv(n),e._reject(t.error)})),t.onabort=ev((function(n){Vv(n),e.active&&e._reject(new op.Abort(t.error)),e.active=!1,e.on("abort").fire(n)})),t.oncomplete=ev((function(){e.active=!1,e._resolve()})),this},_promise:function(t,e,n){var r=this;if(t===E&&this.mode!==E)return wv(new op.ReadOnly("Transaction is readonly"));if(!this.active)return wv(new op.TransactionInactive);if(this._locked())return new qp((function(i,o){r._blockedFuncs.push([function(){r._promise(t,e,n).then(i,o)},Fp])}));if(n)return uv((function(){var t=new qp((function(t,n){r._lock();var i=e(t,n,r);i&&i.then&&i.then(t,n)}));return t.finally((function(){return r._unlock()})),t._lib=!0,t}));var i=new qp((function(t,n){var i=e(t,n,r);i&&i.then&&i.then(t,n)}));return i._lib=!0,i},_root:function(){return this.parent?this.parent._root():this},waitFor:function(t){var e=this._root();if(t=qp.resolve(t),e._waitingFor)e._waitingFor=e._waitingFor.then((function(){return t}));else{e._waitingFor=t,e._waitingQueue=[];var n=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(n.get(-1/0).onsuccess=t)}()}var r=e._waitingFor;return new qp((function(n,i){t.then((function(t){return e._waitingQueue.push(ev(n.bind(null,t)))}),(function(t){return e._waitingQueue.push(ev(i.bind(null,t)))})).finally((function(){e._waitingFor===r&&(e._waitingFor=null)}))}))},abort:function(){this.active&&this._reject(new op.Abort),this.active=!1},tables:{get:(o="Transaction.tables",a=function(){return m},function(){return console.warn(o+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+Qd(Yd(),1)),a.apply(this,arguments)})},table:function(t){return new D(t,x.table(t).schema,this)}}),wd(L.prototype,(function(){function t(t,e,n){var r=t instanceof L?new B(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function e(t){return new B(t,(function(){return f.only("")})).limit(0)}function n(t,e,n,r,i,o){for(var a=Math.min(t.length,r.length),s=-1,u=0;u<a;++u){var c=e[u];if(c!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):s>=0?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[u],c)<0&&(s=u)}return a<r.length&&"next"===o?t+n.substr(t.length):a<t.length&&"prev"===o?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}function r(e,r,i,o){var a,s,u,c,l,h,d,p=i.length;if(!i.every((function(t){return"string"==typeof t})))return t(e,Av);function v(t){a=function(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}(t),s=function(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}(t),u="next"===t?W:K;var e=i.map((function(t){return{lower:s(t),upper:a(t)}})).sort((function(t,e){return u(t.lower,e.lower)}));c=e.map((function(t){return t.upper})),l=e.map((function(t){return t.lower})),h=t,d="next"===t?"":o}v("next");var m=new B(e,(function(){return f.bound(c[0],l[p-1]+o)}));m._ondirectionchange=function(t){v(t)};var y=0;return m._addAlgorithm((function(t,e,i){var o=t.key;if("string"!=typeof o)return!1;var a=s(o);if(r(a,l,y))return!0;for(var f=null,v=y;v<p;++v){var m=n(o,a,c[v],l[v],u,h);null===m&&null===f?y=v+1:(null===f||u(f,m)>0)&&(f=m)}return e(null!==f?function(){t.continue(f+d)}:i),!1})),m}return{between:function(n,r,i,o){i=!1!==i,o=!0===o;try{return q(n,r)>0||0===q(n,r)&&(i||o)&&(!i||!o)?e(this):new B(this,(function(){return f.bound(n,r,!i,!o)}))}catch(a){return t(this,Sv)}},equals:function(t){return new B(this,(function(){return f.only(t)}))},above:function(t){return new B(this,(function(){return f.lowerBound(t,!0)}))},aboveOrEqual:function(t){return new B(this,(function(){return f.lowerBound(t)}))},below:function(t){return new B(this,(function(){return f.upperBound(t,!0)}))},belowOrEqual:function(t){return new B(this,(function(){return f.upperBound(t)}))},startsWith:function(e){return"string"!=typeof e?t(this,Av):this.between(e,e+Tv,!0,!0)},startsWithIgnoreCase:function(t){return""===t?this.startsWith(t):r(this,(function(t,e){return 0===t.indexOf(e[0])}),[t],Tv)},equalsIgnoreCase:function(t){return r(this,(function(t,e){return t===e[0]}),[t],"")},anyOfIgnoreCase:function(){var t=zd.apply(Gd,arguments);return 0===t.length?e(this):r(this,(function(t,e){return-1!==e.indexOf(t)}),t,"")},startsWithAnyOfIgnoreCase:function(){var t=zd.apply(Gd,arguments);return 0===t.length?e(this):r(this,(function(t,e){return e.some((function(e){return 0===t.indexOf(e)}))}),t,Tv)},anyOf:function(){var n=zd.apply(Gd,arguments),r=z;try{n.sort(r)}catch(a){return t(this,Sv)}if(0===n.length)return e(this);var i=new B(this,(function(){return f.bound(n[0],n[n.length-1])}));i._ondirectionchange=function(t){n.sort(r="next"===t?z:H)};var o=0;return i._addAlgorithm((function(t,e,i){for(var a=t.key;r(a,n[o])>0;)if(++o===n.length)return e(i),!1;return 0===r(a,n[o])||(e((function(){t.continue(n[o])})),!1)})),i},notEqual:function(t){return this.inAnyRange([[kv,t],[t,Cv]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var e=zd.apply(Gd,arguments);if(0===e.length)return new B(this);try{e.sort(z)}catch(r){return t(this,Sv)}var n=e.reduce((function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[kv,e]]}),null);return n.push([e[e.length-1],Cv]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){if(0===n.length)return e(this);if(!n.every((function(t){return void 0!==t[0]&&void 0!==t[1]&&z(t[0],t[1])<=0})))return t(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",op.InvalidArgument);var i,o=!r||!1!==r.includeLowers,a=r&&!0===r.includeUppers,s=z;function u(t,e){return s(t[0],e[0])}try{(i=n.reduce((function(t,e){for(var n=0,r=t.length;n<r;++n){var i=t[n];if(q(e[0],i[1])<0&&q(e[1],i[0])>0){i[0]=q(o=i[0],a=e[0])<0?o:a,i[1]=G(i[1],e[1]);break}}var o,a;return n===r&&t.push(e),t}),[])).sort(u)}catch(v){return t(this,Sv)}var c=0,l=a?function(t){return z(t,i[c][1])>0}:function(t){return z(t,i[c][1])>=0},h=o?function(t){return H(t,i[c][0])>0}:function(t){return H(t,i[c][0])>=0},d=l,p=new B(this,(function(){return f.bound(i[0][0],i[i.length-1][1],!o,!a)}));return p._ondirectionchange=function(t){"next"===t?(d=l,s=z):(d=h,s=H),i.sort(u)},p._addAlgorithm((function(t,e,n){for(var r=t.key;d(r);)if(++c===i.length)return e(n),!1;return!!function(t){return!l(t)&&!h(t)}(r)||0!==q(r,i[c][1])&&0!==q(r,i[c][0])&&(e((function(){t.continue(s===z?i[c][0]:i[c][1])})),!1)})),p},startsWithAnyOf:function(){var n=zd.apply(Gd,arguments);return n.every((function(t){return"string"==typeof t}))?0===n.length?e(this):this.inAnyRange(n.map((function(t){return[t,t+Tv]}))):t(this,"startsWithAnyOf() only works with strings")}}})),wd(B.prototype,(function(){function t(t,e){t.filter=X(t.filter,e)}function e(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return X(r(),e())}:e,t.justLimit=n&&!r}function n(t,e){if(t.isPrimKey)return e;var n=t.table.schema.idxByName[t.index];if(!n)throw new op.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return e.index(n.name)}function r(t,e){var r=n(t,e);return t.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(t.range||null,t.dir+t.unique):r.openCursor(t.range||null,t.dir+t.unique)}function o(t,e,n,i,o){var a=t.replayFilter?X(t.filter,t.replayFilter()):t.filter;t.or?function(){var s={},u=0;function c(){2==++u&&n()}function l(t,n,r){if(!a||a(n,r,c,i)){var o=n.primaryKey,u=""+o;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(o)),_d(s,u)||(s[u]=!0,e(t,n,r))}}t.or._iterate(l,c,i,o),j(r(t,o),t.algorithm,l,c,i,!t.keysOnly&&t.valueMapper)}():j(r(t,o),X(t.algorithm,a),e,n,i,!t.keysOnly&&t.valueMapper)}return{_read:function(t,e){var n=this._ctx;return n.error?n.table._trans(null,wv.bind(null,n.error)):n.table._idbstore("readonly",t).then(e)},_write:function(t){var e=this._ctx;return e.error?e.table._trans(null,wv.bind(null,e.error)):e.table._idbstore(E,t,"locked")},_addAlgorithm:function(t){var e=this._ctx;e.algorithm=X(e.algorithm,t)},_iterate:function(t,e,n,r){return o(this._ctx,t,e,n,r)},clone:function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&yd(n,t),e._ctx=n,e},raw:function(){return this._ctx.valueMapper=null,this},each:function(t){var e=this._ctx;return this._read((function(n,r,i){o(e,t,n,r,i)}))},count:function(t){var e=this._ctx;if(F(e,!0))return this._read((function(t,r,i){var o=n(e,i),a=e.range?o.count(e.range):o.count();a.onerror=Bv(r),a.onsuccess=function(n){t(Math.min(n.target.result,e.limit))}}),t);var r=0;return this._read((function(t,n,i){o(e,(function(){return++r,!1}),(function(){t(r)}),n,i)}),t)},sortBy:function(t,e){var n=t.split(".").reverse(),r=n[0],i=n.length-1;function o(t,e){return e?o(t[n[e]],e-1):t[r]}var a="next"===this._ctx.dir?1:-1;function s(t,e){var n=o(t,i),r=o(e,i);return n<r?-a:n>r?a:0}return this.toArray((function(t){return t.sort(s)})).then(e)},toArray:function(t){var e=this._ctx;return this._read((function(t,r,a){if(i&&"next"===e.dir&&F(e,!0)&&e.limit>0){var s=e.table.hook.reading.fire,u=n(e,a),c=e.limit<1/0?u.getAll(e.range,e.limit):u.getAll(e.range);c.onerror=Bv(r),c.onsuccess=Fv(s===cp?t:function(e){try{t(e.map(s))}catch(n){r(n)}})}else{var l=[];o(e,(function(t){l.push(t)}),(function(){t(l)}),r,a)}}),t)},offset:function(t){var n=this._ctx;return t<=0?this:(n.offset+=t,F(n)?e(n,(function(){var e=t;return function(t,n){return 0===e||(1===e?(--e,!1):(n((function(){t.advance(e),e=0})),!1))}})):e(n,(function(){var e=t;return function(){return--e<0}})),this)},limit:function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),e(this._ctx,(function(){var e=t;return function(t,n,r){return--e<=0&&n(r),e>=0}}),!0),this},until:function(e,n){return t(this._ctx,(function(t,r,i){return!e(t.value)||(r(i),n)})),this},first:function(t){return this.limit(1).toArray((function(t){return t[0]})).then(t)},last:function(t){return this.reverse().first(t)},filter:function(e){return t(this._ctx,(function(t){return e(t.value)})),function(t,e){t.isMatch=X(t.isMatch,e)}(this._ctx,e),this},and:function(t){return this.filter(t)},or:function(t){return new L(this._ctx.table,t,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.key,n)}))},eachUniqueKey:function(t){return this._ctx.unique="unique",this.eachKey(t)},eachPrimaryKey:function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each((function(e,n){t(n.primaryKey,n)}))},keys:function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each((function(t,e){n.push(e.key)})).then((function(){return n})).then(t)},primaryKeys:function(t){var e=this._ctx;if(i&&"next"===e.dir&&F(e,!0)&&e.limit>0)return this._read((function(t,r,i){var o=n(e,i),a=e.limit<1/0?o.getAllKeys(e.range,e.limit):o.getAllKeys(e.range);a.onerror=Bv(r),a.onsuccess=Fv(t)})).then(t);e.keysOnly=!e.isMatch;var r=[];return this.each((function(t,e){r.push(e.primaryKey)})).then((function(){return r})).then(t)},uniqueKeys:function(t){return this._ctx.unique="unique",this.keys(t)},firstKey:function(t){return this.limit(1).keys((function(t){return t[0]})).then(t)},lastKey:function(t){return this.reverse().firstKey(t)},distinct:function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return t(this._ctx,(function(t){var e=t.primaryKey.toString(),n=_d(r,e);return r[e]=!0,!n})),this},modify:function(t){var e=this,n=this._ctx.table.hook,r=n.updating.fire,i=n.deleting.fire;return this._write((function(n,o,a,s){var u;if("function"==typeof t)u=r===up&&i===up?t:function(e){var n=Ud(e);if(!1===t.call(this,e,this))return!1;if(_d(this,"value")){var o=Vd(n,this.value),a=r.call(this,o,this.primKey,n,s);a&&(e=this.value,pd(a).forEach((function(t){Rd(e,t,a[t])})))}else i.call(this,this.primKey,e,s)};else if(r===up){var c=pd(t),l=c.length;u=function(e){for(var n=!1,r=0;r<l;++r){var i=c[r],o=t[i];Nd(e,i)!==o&&(Rd(e,i,o),n=!0)}return n}}else{var h=t;t=Md(h),u=function(e){var n=!1,i=r.call(this,t,this.primKey,Ud(e),s);return i&&yd(t,i),pd(t).forEach((function(r){var i=t[r];Nd(e,r)!==i&&(Rd(e,r,i),n=!0)})),i&&(t=Md(h)),n}}var f=0,d=0,p=!1,v=[],m=[],y=null;function g(t){return t&&(v.push(t),m.push(y)),o(new ep("Error modifying one or more objects",v,d,m))}function b(){p&&d+v.length===f&&(v.length>0?g():n(d))}e.clone().raw()._iterate((function(t,e){y=e.primaryKey;var n={primKey:e.primaryKey,value:t,onsuccess:null,onerror:null};function r(t){return v.push(t),m.push(n.primKey),b(),!0}if(!1!==u.call(n,t,n)){var i=!_d(n,"value");++f,Dd((function(){var t=i?e.delete():e.update(n.value);t._hookCtx=n,t.onerror=Uv(r),t.onsuccess=Lv((function(){++d,b()}))}),r)}else n.onsuccess&&n.onsuccess(n.value)}),(function(){p=!0,b()}),g,a)}))},delete:function(){var t=this,e=this._ctx,n=e.range,r=e.table.hook.deleting.fire,i=r!==up;if(!i&&F(e)&&(e.isPrimKey&&!Dv||!n))return this._write((function(t,e,r){var i=Bv(e),o=n?r.count(n):r.count();o.onerror=i,o.onsuccess=function(){var a=o.result;Dd((function(){var e=n?r.delete(n):r.clear();e.onerror=i,e.onsuccess=function(){return t(a)}}),(function(t){return e(t)}))}}));var o=i?2e3:1e4;return this._write((function(n,a,s,u){var c=0,l=t.clone({keysOnly:!e.isMatch&&!i}).distinct().limit(o).raw(),h=[];n(function t(){return l.each(i?function(t,e){h.push([e.primaryKey,e.value])}:function(t,e){h.push(e.primaryKey)}).then((function(){return h.sort(i?function(t,e){return z(t[0],e[0])}:z),R(s,u,h,i,r)})).then((function(){var e=h.length;return c+=e,h=[],e<o?c:t()}))}())}))}}})),yd(this,{Collection:B,Table:D,Transaction:M,Version:A,WhereClause:L}),x.on("versionchange",(function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '"+x.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+x.name+"'. Closing db now to resume the delete request."),x.close()})),x.on("blocked",(function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+x.name+"') was blocked"):console.warn("Upgrade '"+x.name+"' blocked by other connection holding version "+t.oldVersion/10)})),c.forEach((function(t){t(x)}))}function Mv(t,e){return pd(e).forEach((function(n){var r=function t(e){if("function"==typeof e)return new e;if(vd(e))return[t(e[0])];if(e&&"object"==typeof e){var n={};return Mv(n,e),n}return e}(e[n]);t[n]=r})),t}function Lv(t){return ev((function(e){var n=e.target,r=n._hookCtx,i=r.value||n.result,o=r&&r.onsuccess;o&&o(i),t&&t(i)}),t)}function Bv(t){return ev((function(e){return Vv(e),t(e.target.error),!1}))}function Fv(t){return ev((function(e){t(e.target.result)}))}function Uv(t){return ev((function(e){var n=e.target,r=n.error,i=n._hookCtx,o=i&&i.onerror;return o&&o(r),Vv(e),t(r),!1}))}function Vv(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}function jv(t){var e=function(e){return t.next(e)},n=i(e),r=i((function(e){return t.throw(e)}));function i(t){return function(e){var i=t(e),o=i.value;return i.done?o:o&&"function"==typeof o.then?o.then(n,r):vd(o)?qp.all(o).then(n,r):n(o)}}return i(e)()}function qv(t,e,n,r,i,o,a){this.name=t,this.keyPath=e,this.unique=n,this.multi=r,this.auto=i,this.compound=o,this.dotted=a;var s="string"==typeof e?e:e&&"["+[].join.call(e,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+s}function Gv(t,e,n,r){this.name=t,this.primKey=e||new qv,this.indexes=n||[new qv],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=Pd(n,(function(t){return[t.name,t]}))}function zv(t){return 1===t.length?t[0]:t}function Hv(t){var e=t&&(t.getDatabaseNames||t.webkitGetDatabaseNames);return e&&e.bind(t)}Wd(Hd,Nv),wd(Rv,sp),wd(Rv,{delete:function(t){var e=new Rv(t),n=e.delete();return n.onblocked=function(t){return e.on("blocked",t),this},n},exists:function(t){return new Rv(t).open().then((function(t){return t.close(),!0})).catch(Rv.NoSuchDatabaseError,(function(){return!1}))},getDatabaseNames:function(t){var e=Hv(Rv.dependencies.indexedDB);return e?new qp((function(t,n){var r=e();r.onsuccess=function(e){t(Sd(e.target.result,0))},r.onerror=Bv(n)})).then(t):xv.dbnames.toCollection().primaryKeys(t)},defineClass:function(){return function(t){t&&yd(this,t)}},applyStructure:Mv,ignoreTransaction:function(t){return Fp.trans?mv(Fp.transless,t):t()},vip:function(t){return uv((function(){return Fp.letThrough=!0,t()}))},async:function(t){return function(){try{var e=jv(t.apply(this,arguments));return e&&"function"==typeof e.then?e:qp.resolve(e)}catch(n){return wv(n)}}},spawn:function(t,e,n){try{var r=jv(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:qp.resolve(r)}catch(i){return wv(i)}},currentTransaction:{get:function(){return Fp.trans||null}},waitFor:function(t,e){var n=qp.resolve("function"==typeof t?Rv.ignoreTransaction(t):t).timeout(e||6e4);return Fp.trans?Fp.trans.waitFor(n):n},Promise:qp,debug:{get:function(){return Hd},set:function(t){Wd(t,"dexie"===t?function(){return!0}:Nv)}},derive:Td,extend:yd,props:wd,override:Ad,Events:Ev,getByKeyPath:Nd,setByKeyPath:Rd,delByKeyPath:function(t,e){"string"==typeof e?Rd(t,e,void 0):"length"in e&&[].map.call(e,(function(e){Rd(t,e,void 0)}))},shallowClone:Md,deepClone:Ud,getObjectDiff:Vd,asap:Od,maxKey:Cv,minKey:kv,addons:[],connections:Iv,MultiModifyError:op.Modify,errnames:rp,IndexSpec:qv,TableSchema:Gv,dependencies:function(){try{return{indexedDB:md.indexedDB||md.mozIndexedDB||md.webkitIndexedDB||md.msIndexedDB,IDBKeyRange:md.IDBKeyRange||md.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"{version}",version:"{version}".split(".").map((function(t){return parseInt(t)})).reduce((function(t,e,n){return t+e/Math.pow(10,2*n)})),default:Rv,Dexie:Rv}),qp.rejectionMapper=function(t,e){if(!t||t instanceof tp||t instanceof TypeError||t instanceof SyntaxError||!t.name||!ap[t.name])return t;var n=new ap[t.name](e||t.message,t);return"stack"in t&&xd(n,"stack",{get:function(){return this.inner.stack}}),n},(xv=new Rv("__dbnames")).version(1).stores({dbnames:"name"}),function(){try{void 0!==typeof localStorage&&void 0!==md.document&&(JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]").forEach((function(t){return xv.dbnames.put({name:t}).catch(up)})),localStorage.removeItem("Dexie.DatabaseNames"))}catch(t){}}();var Wv=Rv,Kv=function(t){function e(){var t;return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,"AutoSaveDatabase"))).version(1).stores({autoSave:"++"}),t.autoSave=t.table("autoSave"),t}return _inherits(e,t),e}(Wv);function Xv(t){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e=regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Wf(5e3);case 2:return e.next=4,Hf();case 4:return n=e.sent,r=Number(new Date),e.next=8,qf((function(){return t.autoSave.put({gameState:n,timestamp:r},1)}));case 8:case"end":return e.stop()}}),e)}));case 1:return n.next=3,Ff("*");case 3:if(!n.sent){n.next=7;break}return n.delegateYield(e(),"t0",5);case 5:n.next=1;break;case 7:case"end":return n.stop()}}),c)}var Yv=function(){var t={};return t.promise=new Promise((function(e,n){t.resolve=e,t.reject=n})),t},Qv=[],Jv=0;function Zv(t){try{em(),t()}finally{nm()}}function $v(t){Qv.push(t),Jv||(em(),rm())}function tm(t){try{return em(),t()}finally{rm()}}function em(){Jv++}function nm(){Jv--}function rm(){var t;for(nm();!Jv&&void 0!==(t=Qv.shift());)Zv(t)}var im=function(t){return function(e){return t.some((function(t){return cm(t)(e)}))}},om=function(t){return function(e){return t(e)}},am=function(t){return function(e){return e.type===String(t)}},sm=function(t){return function(e){return e.type===t}},um=function(){return ef};function cm(t){var e="*"===t?um:Wh(t)?am:Kh(t)?im:Zh(t)?am:Hh(t)?om:$h(t)?sm:null;if(null===e)throw new Error("invalid pattern: "+t);return e(t)}var lm={type:Dh},hm=function(t){return t&&t.type===Dh};function fm(t){void 0===t&&(t=Af());var e=!1,n=[];return{take:function(r){e&&t.isEmpty()?r(lm):t.isEmpty()?(n.push(r),r.cancel=function(){af(n,r)}):r(t.take())},put:function(r){if(!e){if(0===n.length)return t.put(r);n.shift()(r)}},flush:function(n){e&&t.isEmpty()?n(lm):n(t.flush())},close:function(){if(!e){e=!0;var t=n;n=[];for(var r=0,i=t.length;r<i;r++)(0,t[r])(lm)}}}}function dm(){var t,e,n,r,i,o,a=(e=!1,r=n=[],i=function(){r===n&&(r=n.slice())},o=function(){e=!0;var t=n=r;r=[],t.forEach((function(t){t(lm)}))},(t={})[Mh]=!0,t.put=function(t){if(!e)if(hm(t))o();else for(var i=n=r,a=0,s=i.length;a<s;a++){var u=i[a];u[Rh](t)&&(u.cancel(),u(t))}},t.take=function(t,n){void 0===n&&(n=um),e?t(lm):(t[Rh]=n,i(),r.push(t),t.cancel=sf((function(){i(),af(r,t)})))},t.close=o,t),s=a.put;return a.put=function(t){t[Lh]?s(t):$v((function(){s(t)}))},a}var pm=0,vm=1,mm=2,ym=3;function gm(t,e){var n=t[Ph];Hh(n)&&(e.cancel=n),t.then(e,(function(t){e(t,!0)}))}var bm,_m=0,wm=function(){return++_m};function Em(t){t.isRunning()&&t.cancel()}var xm=((bm={})[If]=function(t,e,n){var r=e.channel,i=void 0===r?t.channel:r,o=e.pattern,a=e.maybe,s=function(t){t instanceof Error?n(t,!0):!hm(t)||a?n(t):n(Vh)};try{i.take(s,zh(o)?cm(o):null)}catch(u){return void n(u,!0)}n.cancel=s.cancel},bm[Of]=function(t,e,n){var r=e.channel,i=e.action,o=e.resolve;$v((function(){var e;try{e=(r?r.put:t.dispatch)(i)}catch(a){return void n(a,!0)}o&&Xh(e)?gm(e,n):n(e)}))},bm[Pf]=function(t,e,n,r){var i=r.digestEffect,o=_m,a=Object.keys(e);if(0!==a.length){var s=yf(e,n);a.forEach((function(t){i(e[t],o,s[t],t)}))}else n(Kh(e)?[]:{})},bm.RACE=function(t,e,n,r){var i=r.digestEffect,o=_m,a=Object.keys(e),s=Kh(e)?ff(a.length):{},u={},c=!1;a.forEach((function(t){var e=function(e,r){c||(r||mf(e)?(n.cancel(),n(e,r)):(n.cancel(),c=!0,s[t]=e,n(s)))};e.cancel=nf,u[t]=e})),n.cancel=function(){c||(c=!0,a.forEach((function(t){return u[t].cancel()})))},a.forEach((function(t){c||i(e[t],o,u[t],t)}))},bm[Df]=function(t,e,n,r){var i=e.context,o=e.fn,a=e.args,s=r.task;try{var u=o.apply(i,a);if(Xh(u))return void gm(u,n);if(Yh(u))return void Dm(t,u,s.context,_m,gf(o),!1,n);n(u)}catch(c){n(c,!0)}},bm.CPS=function(t,e,n){var r=e.context,i=e.fn,o=e.args;try{var a=function(t,e){Gh(t)?n(e):n(t,!0)};i.apply(r,o.concat(a)),a.cancel&&(n.cancel=a.cancel)}catch(s){n(s,!0)}},bm[Nf]=function(t,e,n,r){var i=e.fn,o=e.detached,a=r.task,s=function(t){var e=t.context,n=t.fn,r=t.args;try{var i=n.apply(e,r);if(Yh(i))return i;var o=!1;return lf((function(t){return o?{value:t,done:!0}:(o=!0,{value:i,done:!Xh(i)})}))}catch(a){return lf((function(){throw a}))}}({context:e.context,fn:i,args:e.args}),u=function(t,e){return t.isSagaIterator?{name:t.meta.name}:gf(e)}(s,i);tm((function(){var e=Dm(t,s,a.context,_m,u,o,void 0);o?n(e):e.isRunning()?(a.queue.addTask(e),n(e)):e.isAborted()?a.queue.abort(e.error()):n(e)}))},bm.JOIN=function(t,e,n,r){var i=r.task,o=function(t,e){if(t.isRunning()){var n={task:i,cb:e};e.cancel=function(){t.isRunning()&&af(t.joiners,n)},t.joiners.push(n)}else t.isAborted()?e(t.error(),!0):e(t.result())};if(Kh(e)){if(0===e.length)return void n([]);var a=yf(e,n);e.forEach((function(t,e){o(t,a[e])}))}else o(e,n)},bm[Rf]=function(t,e,n,r){e===Bh?Em(r.task):Kh(e)?e.forEach(Em):Em(e),n()},bm[Mf]=function(t,e,n){var r=e.selector,i=e.args;try{n(r.apply(void 0,[t.getState()].concat(i)))}catch(o){n(o,!0)}},bm[Lf]=function(t,e,n){var r=e.pattern,i=fm(e.buffer),o=cm(r),a=function e(n){hm(n)||t.channel.take(e,o),i.put(n)},s=i.close;i.close=function(){a.cancel(),s()},t.channel.take(a,o),n(i)},bm.CANCELLED=function(t,e,n,r){n(r.task.isCancelled())},bm.FLUSH=function(t,e,n){e.flush(n)},bm.GET_CONTEXT=function(t,e,n,r){n(r.task.context[e])},bm.SET_CONTEXT=function(t,e,n,r){of(r.task.context,e),n()},bm);function Tm(t,e){return t+"?"+e}function Cm(t){var e=t.name,n=t.location;return n?e+"  "+Tm(n.fileName,n.lineNumber):e}var km=null,Sm=[],Am=function(t){t.crashedEffect=km,Sm.push(t)},Im=function(){km=null,Sm.length=0},Om=function(t){km=t},Pm=function(){var t,e,n,r,i,o=Sm[0],a=Sm.slice(1),s=o.crashedEffect?function(t){var e=bf(t);return e?e.code+"  "+Tm(e.fileName,e.lineNumber):""}(o.crashedEffect):null;return["The above error occurred in task "+Cm(o.meta)+(s?" \n when executing effect "+s:"")].concat(a.map((function(t){return"    created by "+Cm(t.meta)})),[(t=Sm,n=function(t){return t.cancelledTasks},r=t,e=(i=[]).concat.apply(i,r.map(n)),e.length?["Tasks cancelled due to error:"].concat(e).join("\n"):"")]).join("\n")};function Dm(t,e,n,r,i,o,a){var s=t.finalizeRunEffect((function(e,n,r){Xh(e)?gm(e,r):Yh(e)?Dm(t,e,c.context,n,i,!1,r):e&&e[Nh]?(0,xm[e.type])(t,e.payload,r,l):r(e)}));h.cancel=nf;var u={meta:i,cancel:function(){u.status===pm&&(u.status=vm,h(Uh))},status:pm},c=function(t,e,n,r,i,o,a){var s;void 0===a&&(a=nf);var u,c,l=pm,h=null,f=[],d=Object.create(n),p=function(t,e,n){var r,i=[],o=!1;function a(t){e(),u(),n(t,!0)}function s(e){i.push(e),e.cont=function(s,u){o||(af(i,e),e.cont=nf,u?a(s):(e===t&&(r=s),i.length||(o=!0,n(r))))}}function u(){o||(o=!0,i.forEach((function(t){t.cont=nf,t.cancel()})),i=[])}return s(t),{addTask:s,cancelAll:u,abort:a,getTasks:function(){return i}}}(e,(function(){f.push.apply(f,p.getTasks().map((function(t){return t.meta.name})))}),v);function v(e,n){if(n){if(l=mm,Am({meta:i,cancelledTasks:f}),m.isRoot){var r=Pm();Im(),t.onError(e,{sagaStack:r})}c=e,h&&h.reject(e)}else e===Uh?l=vm:l!==vm&&(l=ym),u=e,h&&h.resolve(e);m.cont(e,n),m.joiners.forEach((function(t){t.cb(e,n)})),m.joiners=null}var m=((s={})[Fh]=!0,s.id=r,s.meta=i,s.isRoot=o,s.context=d,s.joiners=[],s.queue=p,s.cancel=function(){l===pm&&(l=vm,p.cancelAll(),v(Uh,!1))},s.cont=a,s.end=v,s.setContext=function(t){of(d,t)},s.toPromise=function(){return h?h.promise:(h=Yv(),l===mm?h.reject(c):l!==pm&&h.resolve(u),h.promise)},s.isRunning=function(){return l===pm},s.isCancelled=function(){return l===vm||l===pm&&e.status===vm},s.isAborted=function(){return l===mm},s.result=function(){return u},s.error=function(){return c},s);return m}(t,u,n,r,i,o,a),l={task:c,digestEffect:f};return a&&(a.cancel=c.cancel),h(),c;function h(t,n){try{var i;n?(i=e.throw(t),Im()):vf(t)?(u.status=vm,h.cancel(),i=Hh(e.return)?e.return(Uh):{done:!0,value:Uh}):i=pf(t)?Hh(e.return)?e.return():{done:!0}:e.next(t),i.done?(u.status!==vm&&(u.status=ym),u.cont(i.value)):f(i.value,r,h)}catch(o){if(u.status===vm)throw o;u.status=mm,u.cont(o,!0)}}function f(e,n,r,i){void 0===i&&(i="");var o,a=wm();function u(n,i){o||(o=!0,r.cancel=nf,t.sagaMonitor&&(i?t.sagaMonitor.effectRejected(a,n):t.sagaMonitor.effectResolved(a,n)),i&&Om(e),r(n,i))}t.sagaMonitor&&t.sagaMonitor.effectTriggered({effectId:a,parentEffectId:n,label:i,effect:e}),u.cancel=nf,r.cancel=function(){o||(o=!0,u.cancel(),u.cancel=nf,t.sagaMonitor&&t.sagaMonitor.effectCancelled(a))},s(e,a,u)}}function Nm(t,e){for(var n=t.channel,r=void 0===n?dm():n,i=t.dispatch,o=t.getState,a=t.context,s=void 0===a?{}:a,u=t.sagaMonitor,c=t.effectMiddlewares,l=t.onError,h=void 0===l?hf:l,f=arguments.length,d=new Array(f>2?f-2:0),p=2;p<f;p++)d[p-2]=arguments[p];var v,m=e.apply(void 0,d),y=wm();if(u&&(u.rootSagaStarted=u.rootSagaStarted||nf,u.effectTriggered=u.effectTriggered||nf,u.effectResolved=u.effectResolved||nf,u.effectRejected=u.effectRejected||nf,u.effectCancelled=u.effectCancelled||nf,u.actionDispatched=u.actionDispatched||nf,u.rootSagaStarted({effectId:y,saga:e,args:d})),c){var g=oh.compose.apply(void 0,c);v=function(t){return function(e,n,r){return g((function(e){return t(e,n,r)}))(e)}}}else v=rf;var b={channel:r,dispatch:df(i),getState:o,sagaMonitor:u,onError:h,finalizeRunEffect:v};return tm((function(){var t=Dm(b,m,s,y,gf(e),!0,void 0);return u&&u.effectResolved(y,t),t}))}var Rm=n("OQdp"),Mm=n("MgzW"),Lm=n.n(Mm);window.Promise||(window.Promise=Rm.Polyfill),Object.assign||(Object.assign=Lm.a);var Bm="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!Bm.performance||!Bm.performance.now){var Fm=Date.now();Bm.performance||(Bm.performance={}),Bm.performance.now=function(){return Date.now()-Fm}}for(var Um=Date.now(),Vm=["ms","moz","webkit","o"],jm=0;jm<Vm.length&&!Bm.requestAnimationFrame;++jm){var qm=Vm[jm];Bm.requestAnimationFrame=Bm[qm+"RequestAnimationFrame"],Bm.cancelAnimationFrame=Bm[qm+"CancelAnimationFrame"]||Bm[qm+"CancelRequestAnimationFrame"]}Bm.requestAnimationFrame||(Bm.requestAnimationFrame=function(t){if("function"!=typeof t)throw new TypeError(t+"is not a function");var e=Date.now(),n=16+Um-e;return n<0&&(n=0),Um=e,setTimeout((function(){Um=Date.now(),t(performance.now())}),n)}),Bm.cancelAnimationFrame||(Bm.cancelAnimationFrame=function(t){return clearTimeout(t)}),Math.sign||(Math.sign=function(t){return 0===(t=Number(t))||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var Gm,zm,Hm,Wm,Km,Xm,Ym,Qm,Jm,Zm,$m,ty,ey,ny,ry=n("gRQh"),iy=n.n(ry),oy={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(t){var e=!0;if(iy.a.tablet||iy.a.phone){if(e=!1,iy.a.apple.device){var n=navigator.userAgent.match(/OS (\d+)_(\d+)?/);n&&parseInt(n[1],10)>=11&&(e=!0)}if(iy.a.android.device){var r=navigator.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)>=7&&(e=!0)}}return e?32:4}(),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:iy.a.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!iy.a.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},ay=n("uhBA"),sy=n.n(ay),uy=n("VmRL"),cy=n.n(uy),ly=n("CxY0"),hy=n.n(ly);!function(t){t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2"}(Gm||(Gm={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.WEBGL=1]="WEBGL",t[t.CANVAS=2]="CANVAS"}(zm||(zm={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR"}(Hm||(Hm={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Wm||(Wm={})),function(t){t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(Km||(Km={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"}(Xm||(Xm={})),function(t){t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.FLOAT=5126]="FLOAT",t[t.HALF_FLOAT=36193]="HALF_FLOAT"}(Ym||(Ym={})),function(t){t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR"}(Qm||(Qm={})),function(t){t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Jm||(Jm={})),function(t){t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON"}(Zm||(Zm={})),function(t){t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"}($m||($m={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(ty||(ty={})),function(t){t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp"}(ey||(ey={})),function(t){t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE"}(ny||(ny={})),oy.RETINA_PREFIX=/@([0-9\.]+)x/,oy.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var fy,dy=!1,py="5.2.0";function vy(t,e){return(e=e||[])[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function my(t){return t=t.toString(16),"#"+("000000".substr(0,6-t.length)+t)}function yy(t){return"string"==typeof t&&"#"===t[0]&&(t=t.substr(1)),parseInt(t,16)}var gy=function(){for(var t=[],e=[],n=0;n<32;n++)t[n]=n,e[n]=n;t[Hm.NORMAL_NPM]=Hm.NORMAL,t[Hm.ADD_NPM]=Hm.ADD,t[Hm.SCREEN_NPM]=Hm.SCREEN,e[Hm.NORMAL]=Hm.NORMAL_NPM,e[Hm.ADD]=Hm.ADD_NPM,e[Hm.SCREEN]=Hm.SCREEN_NPM;var r=[];return r.push(e),r.push(t),r}();function by(t,e){return gy[e?1:0][t]}function _y(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;var n=t>>16&255,r=t>>8&255;return(255*e<<24)+((n=n*e+.5|0)<<16)+((r=r*e+.5|0)<<8)+((255&t)*e+.5|0)}function wy(t,e,n){var r,i=t.length;if(!(e>=i||0===n)){var o=i-(n=e+n>i?i-e:n);for(r=e;r<o;++r)t[r]=t[r+n];t.length=o}}var Ey=0;function xy(){return++Ey}function Ty(t){return 0===t?0:t<0?-1:1}function Cy(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)}function ky(t){return!(t&t-1||!t)}function Sy(t){var e=(t>65535)<<4,n=((t>>>=e)>255)<<3;return e|=n,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}var Ay,Iy={},Oy=Object.create(null),Py=Object.create(null),Dy=function(t,e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=n||oy.RESOLUTION,this.resize(t,e)},Ny={width:{configurable:!0},height:{configurable:!0}};function Ry(t,e){var n=oy.RETINA_PREFIX.exec(t);return n?parseFloat(n[1]):void 0!==e?e:1}Dy.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},Dy.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},Dy.prototype.destroy=function(){this.context=null,this.canvas=null},Ny.width.get=function(){return this.canvas.width},Ny.width.set=function(t){this.canvas.width=t},Ny.height.get=function(){return this.canvas.height},Ny.height.set=function(t){this.canvas.height=t},Object.defineProperties(Dy.prototype,Ny);var My={};function Ly(t,e,n){if(void 0===n&&(n=3),!My[e]){var r=(new Error).stack;void 0===r?console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t):(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+"\nDeprecated since v"+t),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+"\nDeprecated since v"+t),console.warn(r))),My[e]=!0}}var By,Fy=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},t.prototype.copyTo=function(t){return t.set(this.x,this.y),t},t.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},t.prototype.set=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e},t}(),Uy=function(){function t(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0),this._x=n,this._y=r,this.cb=t,this.scope=e}return t.prototype.clone=function(e,n){return void 0===e&&(e=this.cb),void 0===n&&(n=this.scope),new t(e,n,this._x,this._y)},t.prototype.set=function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope))},t.prototype.copyFrom=function(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},t.prototype.copyTo=function(t){return t.set(this._x,this._y),t},t.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!0,configurable:!0}),t}(),Vy=2*Math.PI,jy=180/Math.PI,qy=Math.PI/180;!function(t){t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC"}(By||(By={}));var Gy=function(){function t(t,e,n,r,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=0),this.array=null,this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o}return t.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},t.prototype.set=function(t,e,n,r,i,o){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=o,this},t.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},t.prototype.apply=function(t,e){e=e||new Fy;var n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e},t.prototype.applyInverse=function(t,e){e=e||new Fy;var n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e},t.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},t.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,o=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=o*e-this.ty*n,this.ty=o*n+this.ty*e,this},t.prototype.append=function(t){var e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this},t.prototype.setTransform=function(t,e,n,r,i,o,a,s,u){return this.a=Math.cos(a+u)*i,this.b=Math.sin(a+u)*i,this.c=-Math.sin(a-s)*o,this.d=Math.cos(a-s)*o,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this},t.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var n=this.a,r=this.c;this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},t.prototype.decompose=function(t){var e=this.a,n=this.b,r=this.c,i=this.d,o=-Math.atan2(-r,i),a=Math.atan2(n,e),s=Math.abs(o+a);return s<1e-5||Math.abs(Vy-s)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx,t.position.y=this.ty,t},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,o=t*r-e*n;return this.a=r/o,this.b=-e/o,this.c=-n/o,this.d=t/o,this.tx=(n*this.ty-r*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.prototype.clone=function(){var e=new t;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},t.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(t,"IDENTITY",{get:function(){return new t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TEMP_MATRIX",{get:function(){return new t},enumerable:!0,configurable:!0}),t}(),zy=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Hy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Wy=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ky=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Xy=[],Yy=[],Qy=Math.sign;!function(){for(var t=0;t<16;t++){var e=[];Xy.push(e);for(var n=0;n<16;n++)for(var r=Qy(zy[t]*zy[n]+Wy[t]*Hy[n]),i=Qy(Hy[t]*zy[n]+Ky[t]*Hy[n]),o=Qy(zy[t]*Wy[n]+Wy[t]*Ky[n]),a=Qy(Hy[t]*Wy[n]+Ky[t]*Ky[n]),s=0;s<16;s++)if(zy[s]===r&&Hy[s]===i&&Wy[s]===o&&Ky[s]===a){e.push(s);break}}for(t=0;t<16;t++){var u=new Gy;u.set(zy[t],Hy[t],Wy[t],Ky[t],0,0),Yy.push(u)}}();var Jy={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(t){return zy[t]},uY:function(t){return Hy[t]},vX:function(t){return Wy[t]},vY:function(t){return Ky[t]},inv:function(t){return 8&t?15&t:7&-t},add:function(t,e){return Xy[t][e]},sub:function(t,e){return Xy[t][Jy.inv(e)]},rotate180:function(t){return 4^t},isVertical:function(t){return 2==(3&t)},byDirection:function(t,e){return 2*Math.abs(t)<=Math.abs(e)?e>=0?Jy.S:Jy.N:2*Math.abs(e)<=Math.abs(t)?t>0?Jy.E:Jy.W:e>0?t>0?Jy.SE:Jy.SW:t>0?Jy.NE:Jy.NW},matrixAppendRotationInv:function(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=Yy[Jy.inv(e)];i.tx=n,i.ty=r,t.append(i)}},Zy=function(){function t(){this.worldTransform=new Gy,this.localTransform=new Gy,this.position=new Uy(this.onChange,this,0,0),this.scale=new Uy(this.onChange,this,1,1),this.pivot=new Uy(this.onChange,this,0,0),this.skew=new Uy(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return t.prototype.onChange=function(){this._localID++},t.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},t.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},t.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}},t.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!0,configurable:!0}),t.IDENTITY=new t,t}(),$y=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=By.RECT}return Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t,"EMPTY",{get:function(){return new t(0,0,0,0)},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},t.prototype.pad=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},t.prototype.fit=function(t){var e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(i-r,0),this},t.prototype.ceil=function(t,e){void 0===t&&(t=1),void 0===e&&(e=.001);var n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y,this},t.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=r,this.height=i-r,this},t}(),tg=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.radius=n,this.type=By.CIRC}return t.prototype.clone=function(){return new t(this.x,this.y,this.radius)},t.prototype.contains=function(t,e){if(this.radius<=0)return!1;var n=this.x-t,r=this.y-e;return(n*=n)+(r*=r)<=this.radius*this.radius},t.prototype.getBounds=function(){return new $y(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},t}(),eg=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=n,this.height=r,this.type=By.ELIP}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var n=(t-this.x)/this.width,r=(e-this.y)/this.height;return(n*=n)+(r*=r)<=1},t.prototype.getBounds=function(){return new $y(this.x-this.width,this.y-this.height,this.width,this.height)},t}(),ng=function(){function t(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];if(Array.isArray(e[0])&&(e=e[0]),e[0]instanceof Fy){for(var r=[],i=0,o=(e=e).length;i<o;i++)r.push(e[i].x,e[i].y);e=r}this.points=e,this.type=By.POLY,this.closeStroke=!0}return t.prototype.clone=function(){var e=new t(this.points.slice());return e.closeStroke=this.closeStroke,e},t.prototype.contains=function(t,e){for(var n=!1,r=this.points.length/2,i=0,o=r-1;i<r;o=i++){var a=this.points[2*i],s=this.points[2*i+1],u=this.points[2*o+1];s>e!=u>e&&t<(e-s)/(u-s)*(this.points[2*o]-a)+a&&(n=!n)}return n},t}(),rg=function(){function t(t,e,n,r,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=20),this.x=t,this.y=e,this.width=n,this.height=r,this.radius=i,this.type=By.RREC}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height,this.radius)},t.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var n=t-(this.x+this.radius),r=e-(this.y+this.radius),i=this.radius*this.radius;if(n*n+r*r<=i)return!0;if((n=t-(this.x+this.width-this.radius))*n+r*r<=i)return!0;if(n*n+(r=e-(this.y+this.height-this.radius))*r<=i)return!0;if((n=t-(this.x+this.radius))*n+r*r<=i)return!0}return!1},t}();oy.SORTABLE_CHILDREN=!1;var ig=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null};ig.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},ig.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},ig.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?$y.EMPTY:((t=t||new $y(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},ig.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},ig.prototype.addQuad=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,o=t[0],a=t[1];e=o<e?o:e,n=a<n?a:n,r=o>r?o:r,i=a>i?a:i,e=(o=t[2])<e?o:e,n=(a=t[3])<n?a:n,r=o>r?o:r,i=a>i?a:i,e=(o=t[4])<e?o:e,n=(a=t[5])<n?a:n,r=o>r?o:r,i=a>i?a:i,n=(a=t[7])<n?a:n,r=(o=t[6])>r?o:r,i=a>i?a:i,this.minX=e=o<e?o:e,this.minY=n,this.maxX=r,this.maxY=i},ig.prototype.addFrame=function(t,e,n,r,i){this.addFrameMatrix(t.worldTransform,e,n,r,i)},ig.prototype.addFrameMatrix=function(t,e,n,r,i){var o=t.a,a=t.b,s=t.c,u=t.d,c=t.tx,l=t.ty,h=this.minX,f=this.minY,d=this.maxX,p=this.maxY,v=o*e+s*n+c,m=a*e+u*n+l;h=v<h?v:h,f=m<f?m:f,d=v>d?v:d,p=m>p?m:p,h=(v=o*r+s*n+c)<h?v:h,f=(m=a*r+u*n+l)<f?m:f,d=v>d?v:d,p=m>p?m:p,h=(v=o*e+s*i+c)<h?v:h,f=(m=a*e+u*i+l)<f?m:f,d=v>d?v:d,p=m>p?m:p,f=(m=a*r+u*i+l)<f?m:f,d=(v=o*r+s*i+c)>d?v:d,p=m>p?m:p,this.minX=h=v<h?v:h,this.minY=f,this.maxX=d,this.maxY=p},ig.prototype.addVertexData=function(t,e,n){for(var r=this.minX,i=this.minY,o=this.maxX,a=this.maxY,s=e;s<n;s+=2){var u=t[s],c=t[s+1];r=u<r?u:r,i=c<i?c:i,o=u>o?u:o,a=c>a?c:a}this.minX=r,this.minY=i,this.maxX=o,this.maxY=a},ig.prototype.addVertices=function(t,e,n,r){this.addVerticesMatrix(t.worldTransform,e,n,r)},ig.prototype.addVerticesMatrix=function(t,e,n,r,i,o){var a=t.a,s=t.b,u=t.c,c=t.d,l=t.tx,h=t.ty;i=i||0,o=o||0;for(var f=this.minX,d=this.minY,p=this.maxX,v=this.maxY,m=n;m<r;m+=2){var y=e[m],g=e[m+1],b=a*y+u*g+l,_=c*g+s*y+h;f=Math.min(f,b-i),p=Math.max(p,b+i),d=Math.min(d,_-o),v=Math.max(v,_+o)}this.minX=f,this.minY=d,this.maxX=p,this.maxY=v},ig.prototype.addBounds=function(t){var e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i},ig.prototype.addBoundsMask=function(t,e){var n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=o){var a=this.minX,s=this.minY,u=this.maxX,c=this.maxY;this.minX=n<a?n:a,this.minY=r<s?r:s,this.maxX=i>u?i:u,this.maxY=o>c?o:c}},ig.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},ig.prototype.addBoundsArea=function(t,e){var n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=o){var a=this.minX,s=this.minY,u=this.maxX,c=this.maxY;this.minX=n<a?n:a,this.minY=r<s?r:s,this.maxX=i>u?i:u,this.maxY=o>c?o:c}},ig.prototype.pad=function(t,e){t=t||0,e=e||(0!==e?t:0),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},ig.prototype.addFramePad=function(t,e,n,r,i,o){e-=o,n+=i,r+=o,this.minX=this.minX<(t-=i)?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r};var og=function(t){function e(){t.call(this),this.tempDisplayObjectParent=null,this.transform=new Zy,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new ig,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={_tempDisplayObjectParent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},worldTransform:{configurable:!0},localTransform:{configurable:!0},position:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0},skew:{configurable:!0},rotation:{configurable:!0},angle:{configurable:!0},zIndex:{configurable:!0},worldVisible:{configurable:!0},mask:{configurable:!0}};return e.mixin=function(t){for(var n=Object.keys(t),r=0;r<n.length;++r){var i=n[r];Object.defineProperty(e.prototype,i,Object.getOwnPropertyDescriptor(t,i))}},n._tempDisplayObjectParent.get=function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new e),this.tempDisplayObjectParent},e.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.getBounds=function(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&(this.calculateBounds(),this._lastBoundsID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new $y),e=this._boundsRect),this._bounds.getRectangle(e)},e.prototype.getLocalBounds=function(t){var e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,t||(this._localBoundsRect||(this._localBoundsRect=new $y),t=this._localBoundsRect);var r=this.getBounds(!1,t);return this.parent=n,this.transform=e,r},e.prototype.toGlobal=function(t,e,n){return void 0===n&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)},e.prototype.toLocal=function(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.render=function(t){},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,e,n,r,i,o,a,s,u){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=o,this.skew.y=a,this.pivot.x=s,this.pivot.y=u,this},e.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},n.x.get=function(){return this.position.x},n.x.set=function(t){this.transform.position.x=t},n.y.get=function(){return this.position.y},n.y.set=function(t){this.transform.position.y=t},n.worldTransform.get=function(){return this.transform.worldTransform},n.localTransform.get=function(){return this.transform.localTransform},n.position.get=function(){return this.transform.position},n.position.set=function(t){this.transform.position.copyFrom(t)},n.scale.get=function(){return this.transform.scale},n.scale.set=function(t){this.transform.scale.copyFrom(t)},n.pivot.get=function(){return this.transform.pivot},n.pivot.set=function(t){this.transform.pivot.copyFrom(t)},n.skew.get=function(){return this.transform.skew},n.skew.set=function(t){this.transform.skew.copyFrom(t)},n.rotation.get=function(){return this.transform.rotation},n.rotation.set=function(t){this.transform.rotation=t},n.angle.get=function(){return this.transform.rotation*jy},n.angle.set=function(t){this.transform.rotation=t*qy},n.zIndex.get=function(){return this._zIndex},n.zIndex.set=function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},n.worldVisible.get=function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},n.mask.get=function(){return this._mask},n.mask.set=function(t){if(this._mask){var e=this._mask.maskObject||this._mask;e.renderable=!0,e.isMask=!1}if(this._mask=t,this._mask){var n=this._mask.maskObject||this._mask;n.renderable=!1,n.isMask=!0}},Object.defineProperties(e.prototype,n),e}(sy.a);function ag(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}og.prototype.displayObjectUpdateTransform=og.prototype.updateTransform;var sg=function(t){function e(){t.call(this),this.children=[],this.sortableChildren=oy.SORTABLE_CHILDREN,this.sortDirty=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={width:{configurable:!0},height:{configurable:!0}};return e.prototype.onChildrenChange=function(){},e.prototype.addChild=function(t){var e=arguments,n=arguments.length;if(n>1)for(var r=0;r<n;r++)this.addChild(e[r]);else t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this);return t},e.prototype.addChildAt=function(t,e){if(e<0||e>this.children.length)throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t},e.prototype.swapChildren=function(t,e){if(t!==e){var n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}},e.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The index "+e+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);wy(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(t){var e=arguments,n=arguments.length;if(n>1)for(var r=0;r<n;r++)this.removeChild(e[r]);else{var i=this.children.indexOf(t);if(-1===i)return null;t.parent=null,t.transform._parentID=-1,wy(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return t},e.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,wy(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e},e.prototype.removeChildren=function(t,e){void 0===t&&(t=0);var n,r="number"==typeof e?e:this.children.length,i=r-t;if(i>0&&i<=r){n=this.children.splice(t,i);for(var o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var a=0;a<n.length;++a)n[a].emit("removed",this),this.emit("childRemoved",n[a],this,a);return n}if(0===i&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,e=0,n=this.children.length;e<n;++e){var r=this.children[e];r._lastSortedIndex=e,t||0===r.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(ag),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,e=this.children.length;t<e;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){var n=e._mask.maskObject||e._mask;n.calculateBounds(),this._bounds.addBoundsMask(e._bounds,n._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._lastBoundsID=this._boundsID},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var e=this.filters,n=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var r=0;r<e.length;r++)e[r].enabled&&this._enabledFilters.push(e[r]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}n&&t.mask.push(this,this._mask),this._render(t);for(var i=0,o=this.children.length;i<o;i++)this.children[i].render(t);t.batch.flush(),n&&t.mask.pop(this,this._mask),e&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(e){t.prototype.destroy.call(this),this.sortDirty=!1;var n="boolean"==typeof e?e:e&&e.children,r=this.removeChildren(0,this.children.length);if(n)for(var i=0;i<r.length;++i)r[i].destroy(e)},n.width.get=function(){return this.scale.x*this.getLocalBounds().width},n.width.set=function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t},n.height.get=function(){return this.scale.y*this.getLocalBounds().height},n.height.set=function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t},Object.defineProperties(e.prototype,n),e}(og);sg.prototype.containerUpdateTransform=sg.prototype.updateTransform,og.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0});var ug=function(t){this._hookDiv=null,(iy.a.tablet||iy.a.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2,this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessibility=!1,window.addEventListener("keydown",this._onKeyDown,!1)};ug.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",e.style.zIndex=2,e.style.backgroundColor="#FF0000",e.title="HOOK DIV",e.addEventListener("focus",(function(){t.isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()})),document.body.appendChild(e),this._hookDiv=e},ug.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},ug.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},ug.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessibility&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},ug.prototype.updateAccessibleObjects=function(t){if(t.visible&&t.accessibleChildren){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}},ug.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),e=t.width/this.renderer.width,n=t.height/this.renderer.height,r=this.div;r.style.left=t.left+"px",r.style.top=t.top+"px",r.style.width=this.renderer.width+"px",r.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var o=this.children[i];if(o.renderId!==this.renderId)o._accessibleActive=!1,wy(this.children,i,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,i--,0===this.children.length&&this.deactivate();else{r=o._accessibleDiv;var a=o.hitArea,s=o.worldTransform;o.hitArea?(r.style.left=(s.tx+a.x*s.a)*e+"px",r.style.top=(s.ty+a.y*s.d)*n+"px",r.style.width=a.width*s.a*e+"px",r.style.height=a.height*s.d*n+"px"):(a=o.getBounds(),this.capHitArea(a),r.style.left=a.x*e+"px",r.style.top=a.y*n+"px",r.style.width=a.width*e+"px",r.style.height=a.height*n+"px",r.title!==o.accessibleTitle&&null!==o.accessibleTitle&&(r.title=o.accessibleTitle),r.getAttribute("aria-label")!==o.accessibleHint&&null!==o.accessibleHint&&r.setAttribute("aria-label",o.accessibleHint)),o.accessibleTitle===r.title&&o.tabIndex===r.tabIndex||(r.title=o.accessibleTitle,r.tabIndex=o.tabIndex,this.debug&&this.updateDebugHTML(r))}}this.renderId++}},ug.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},ug.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},ug.prototype.addChild=function(t){var e=this.pool.pop();e||((e=document.createElement("button")).style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2,e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title="displayObject "+t.tabIndex),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},ug.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},ug.prototype._onFocus=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},ug.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live","off")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},ug.prototype._onKeyDown=function(t){9===t.keyCode&&this.activate()},ug.prototype._onMouseMove=function(t){0===t.movementX&&0===t.movementY||this.deactivate()},ug.prototype.destroy=function(){this.destroyTouchHook(),this.div=null;for(var t=0;t<this.children.length;t++)this.children[t].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null};var cg,lg=function(){function t(t){this.items=[],this._name=t,this._aliasCount=0}return t.prototype.emit=function(t,e,n,r,i,o,a,s){if(arguments.length>8)throw new Error("max arguments reached");var u=this,c=u.name,l=u.items;this._aliasCount++;for(var h=0,f=l.length;h<f;h++)l[h][c](t,e,n,r,i,o,a,s);return l===this.items&&this._aliasCount--,this},t.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},t.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},t.prototype.remove=function(t){var e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},t.prototype.contains=function(t){return-1!==this.items.indexOf(t)},t.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},t.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t}();Object.defineProperties(lg.prototype,{dispatch:{value:lg.prototype.emit},run:{value:lg.prototype.emit}}),oy.TARGET_FPMS=.06,function(t){t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY"}(cg||(cg={}));var hg=function(){function t(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=0),void 0===r&&(r=!1),this.fn=t,this.context=e,this.priority=n,this.once=r,this.next=null,this.previous=null,this._destroyed=!1}return t.prototype.match=function(t,e){return void 0===e&&(e=null),this.fn===t&&this.context===e},t.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},t.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},t.prototype.destroy=function(t){void 0===t&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},t}(),fg=function(){function t(){var t=this;this._head=new hg(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/oy.TARGET_FPMS,this.elapsedMS=1/oy.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return t.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},t.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},t.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},t.prototype.add=function(t,e,n){return void 0===n&&(n=cg.NORMAL),this._addListener(new hg(t,e,n))},t.prototype.addOnce=function(t,e,n){return void 0===n&&(n=cg.NORMAL),this._addListener(new hg(t,e,n,!0))},t.prototype._addListener=function(t){var e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this},t.prototype.remove=function(t,e){for(var n=this._head.next;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this},t.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},t.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},t.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},t.prototype.update=function(t){var e;if(void 0===t&&(t=performance.now()),t>this.lastTime){if((e=this.elapsedMS=t-this.lastTime)>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*oy.TARGET_FPMS;for(var r=this._head,i=r.next;i;)i=i.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(t.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,oy.TARGET_FPMS);this._maxElapsedMS=1/n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(0===t)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"shared",{get:function(){if(!t._shared){var e=t._shared=new t;e.autoStart=!0,e._protected=!0}return t._shared},enumerable:!0,configurable:!0}),Object.defineProperty(t,"system",{get:function(){if(!t._system){var e=t._system=new t;e.autoStart=!0,e._protected=!0}return t._system},enumerable:!0,configurable:!0}),t}(),dg=function(){function t(){}return t.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,cg.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?fg.shared:new fg,t.autoStart&&this.start()},t.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},t}(),pg=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new lg("setRealSize",2),this.onUpdate=new lg("update"),this.onError=new lg("onError",1)},vg={valid:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};pg.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.run(this._width,this._height)},pg.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},pg.prototype.resize=function(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.run(t,e))},vg.valid.get=function(){return!!this._width&&!!this._height},pg.prototype.update=function(){this.destroyed||this.onUpdate.run()},pg.prototype.load=function(){return Promise.resolve()},vg.width.get=function(){return this._width},vg.height.get=function(){return this._height},pg.prototype.upload=function(t,e,n){return!1},pg.prototype.style=function(t,e,n){return!1},pg.prototype.dispose=function(){},pg.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Object.defineProperties(pg.prototype,vg);var mg=function(t){function e(e){t.call(this,e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=e,this.noSubImage=!1}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.crossOrigin=function(t,e,n){void 0===n&&0!==e.indexOf("data:")?t.crossOrigin=function(t,e){return void 0===e&&(e=window.location),0===t.indexOf("data:")?"":(e=e||window.location,Ay||(Ay=document.createElement("a")),Ay.href=t,(t=hy.a.parse(Ay.href)).hostname!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||t.protocol!==e.protocol?"anonymous":"")}(e):!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous")},e.prototype.upload=function(t,e,n,r){var i=t.gl,o=e.realWidth,a=e.realHeight;return r=r||this.source,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===$m.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||n.width!==o||n.height!==a?(n.width=o,n.height=a,i.texImage2D(e.target,0,e.format,e.format,e.type,r)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,e.type,r),!0},e.prototype.update=function(){this.destroyed||(this.resize(this.source.naturalWidth||this.source.videoWidth||this.source.width,this.source.naturalHeight||this.source.videoHeight||this.source.height),t.prototype.update.call(this))},e.prototype.dispose=function(){this.source=null},e}(pg),yg=function(t){function e(e,n){if(n=n||{},!(e instanceof HTMLImageElement)){var r=new Image;t.crossOrigin(r,e,n.crossorigin),r.src=e,e=r}t.call(this,e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(void 0!==n.createBitmap?n.createBitmap:oy.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,this.alphaMode="number"==typeof n.alphaMode?n.alphaMode:null,void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),this.bitmap=null,this._load=null,!1!==n.autoLoad&&this.load()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.load=function(t){var e=this;return void 0!==t&&(this.createBitmap=t),this._load?this._load:(this._load=new Promise((function(t){e.url=e.source.src;var n=e.source,r=function(){e.destroyed||(n.onload=null,n.onerror=null,e.resize(n.width,n.height),e._load=null,t(e.createBitmap?e.process():e))};n.complete&&n.src?r():(n.onload=r,n.onerror=function(t){return e.onError.run(t)})})),this._load)},e.prototype.process=function(){var t=this;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha===$m.UNPACK?"premultiply":"none"}).then((function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))})),this._process):Promise.resolve(this)},e.prototype.upload=function(e,n,r){if("number"==typeof this.alphaMode&&(n.alphaMode=this.alphaMode),!this.createBitmap)return t.prototype.upload.call(this,e,n,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(t.prototype.upload.call(this,e,n,r,this.bitmap),!this.preserveBitmap){var i=!0;for(var o in n._glTextures){var a=n._glTextures[o];if(a!==r&&a.dirtyId!==n.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,t.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e}(mg),gg=[];function bg(t,e){if(!t)return null;var n="";if("string"==typeof t){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);r&&(n=r[1].toLowerCase())}for(var i=gg.length-1;i>=0;--i){var o=gg[i];if(o.test&&o.test(t,n))return new o(t,e)}return new yg(t,e)}var _g=function(t){function e(e,n){var r=n||{},i=r.width,o=r.height;if(!i||!o)throw new Error("BufferResource width or height invalid");t.call(this,i,o),this.data=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.upload=function(t,e,n){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===$m.UNPACK),n.width===e.width&&n.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(n.width=e.width,n.height=e.height,r.texImage2D(e.target,0,n.internalFormat,e.width,e.height,0,e.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e}(pg),wg={scaleMode:Qm.NEAREST,format:Km.RGBA,alphaMode:$m.NPM},Eg=function(t){function e(e,n){void 0===e&&(e=null),void 0===n&&(n=null),t.call(this);var r=(n=n||{}).alphaMode,i=n.mipmap,o=n.anisotropicLevel,a=n.scaleMode,s=n.width,u=n.height,c=n.wrapMode,l=n.format,h=n.type,f=n.target,d=n.resolution;!e||e instanceof pg||((e=bg(e,n.resourceOptions)).internal=!0),this.width=s||0,this.height=u||0,this.resolution=d||oy.RESOLUTION,this.mipmap=void 0!==i?i:oy.MIPMAP_TEXTURES,this.anisotropicLevel=void 0!==o?o:oy.ANISOTROPIC_LEVEL,this.wrapMode=c||oy.WRAP_MODE,this.scaleMode=void 0!==a?a:oy.SCALE_MODE,this.format=l||Km.RGBA,this.type=h||Ym.UNSIGNED_BYTE,this.target=f||Xm.TEXTURE_2D,this.alphaMode=void 0!==r?r:$m.UNPACK,void 0!==n.premultiplyAlpha&&(this.premultiplyAlpha=n.premultiplyAlpha),this.uid=xy(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=s>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.setResource(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={realWidth:{configurable:!0},realHeight:{configurable:!0}};return n.realWidth.get=function(){return Math.ceil(this.width*this.resolution-1e-4)},n.realHeight.get=function(){return Math.ceil(this.height*this.resolution-1e-4)},e.prototype.setStyle=function(t,e){var n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=t,this.height=e,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,e,n){return this.resolution=n||this.resolution,this.width=t/this.resolution,this.height=e/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=ky(this.realWidth)&&ky(this.realHeight)},e.prototype.setResolution=function(t){var e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=this.width*e/t,this.height=this.height*e/t,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Py[this.cacheId],delete Oy[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.from=function(t,n,r){void 0===r&&(r=oy.STRICT_TEXTURE_CACHE);var i="string"==typeof t,o=null;i?o=t:(t._pixiId||(t._pixiId="pixiid_"+xy()),o=t._pixiId);var a=Py[o];if(i&&r&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||((a=new e(t,n)).cacheId=o,e.addToCache(a,o)),a},e.fromBuffer=function(t,n,r,i){t=t||new Float32Array(n*r*4);var o=new _g(t,{width:n,height:r}),a=t instanceof Float32Array?Ym.FLOAT:Ym.UNSIGNED_BYTE;return new e(o,Object.assign(wg,i||{width:n,height:r,type:a}))},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Py[e]&&console.warn("BaseTexture added to the cache with an id ["+e+"] that already had an entry"),Py[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Py[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Py[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)delete Py[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},Object.defineProperties(e.prototype,n),e}(sy.a);Eg._globalBatch=0;var xg=function(t){function e(e,n){var r;n=n||{};var i=e;Array.isArray(e)&&(r=e,i=e.length),t.call(this,n.width,n.height),this.items=[],this.itemDirtyIds=[];for(var o=0;o<i;o++){var a=new Eg;this.items.push(a),this.itemDirtyIds.push(-1)}if(this.length=i,this._load=null,r)for(var s=0;s<i;s++)this.addResourceAt(bg(r[s],n),s)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.dispose=function(){for(var t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,e){if(!this.items[e])throw new Error("Index "+e+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this},e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=Xm.TEXTURE_2D_ARRAY;for(var n=0;n<this.length;n++)this.items[n].on("update",e.update,e)},e.prototype.unbind=function(e){t.prototype.unbind.call(this,e);for(var n=0;n<this.length;n++)this.items[n].off("update",e.update,e)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.items.map((function(t){return t.resource})),n=e.map((function(t){return t.load()}));return this._load=Promise.all(n).then((function(){var n=e[0];return t.resize(n.width,n.height),Promise.resolve(t)})),this._load},e.prototype.upload=function(t,e,n){var r=this.length,i=this.itemDirtyIds,o=this.items,a=t.gl;n.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,e.format,this._width,this._height,r,0,e.format,e.type,null);for(var s=0;s<r;s++){var u=o[s];i[s]<u.dirtyId&&(i[s]=u.dirtyId,u.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,s,u.resource.width,u.resource.height,1,e.format,e.type,u.resource.source))}return!0},e}(pg),Tg=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.test=function(t){var e=window.OffscreenCanvas;return!!(e&&t instanceof e)||t instanceof HTMLCanvasElement},e}(mg),Cg=function(t){function e(n,r){if(t.call(this,n,r=r||{}),this.length!==e.SIDES)throw new Error("Invalid length. Got "+this.length+", expected 6");for(var i=0;i<e.SIDES;i++)this.items[i].target=Xm.TEXTURE_CUBE_MAP_POSITIVE_X+i;!1!==r.autoLoad&&this.load()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.bind=function(e){t.prototype.bind.call(this,e),e.target=Xm.TEXTURE_CUBE_MAP},e.prototype.upload=function(t,n,r){for(var i=this.itemDirtyIds,o=0;o<e.SIDES;o++){var a=this.items[o];i[o]<a.dirtyId&&(i[o]=a.dirtyId,a.valid&&a.resource.upload(t,a,r))}return!0},e}(xg);Cg.SIDES=6;var kg=function(t){function e(e,n){n=n||{},t.call(this,document.createElement("canvas")),this._width=0,this._height=0,this.svg=e,this.scale=n.scale||1,this._overrideWidth=n.width,this._overrideHeight=n.height,this._resolve=null,this._crossorigin=n.crossorigin,this._load=null,!1!==n.autoLoad&&this.load()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise((function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()})),this._load)},e.prototype._loadSvg=function(){var e=this,n=new Image;t.crossOrigin(n,this.svg,this._crossorigin),n.src=this.svg,n.onerror=function(t){n.onerror=null,e.onError.run(t)},n.onload=function(){var t=n.width,r=n.height;if(!t||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=t*e.scale,o=r*e.scale;(e._overrideWidth||e._overrideHeight)&&(i=e._overrideWidth||e._overrideHeight/r*t,o=e._overrideHeight||e._overrideWidth/t*r),i=Math.round(i),o=Math.round(o);var a=e.source;a.width=i,a.height=o,a._pixiId="canvas_"+xy(),a.getContext("2d").drawImage(n,0,0,t,r,0,0,i,o),e._resolve(),e._resolve=null}},e.getSize=function(t){var n=e.SVG_SIZE.exec(t),r={};return n&&(r[n[1]]=Math.round(parseFloat(n[3])),r[n[5]]=Math.round(parseFloat(n[7]))),r},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,e){return"svg"===e||"string"==typeof t&&0===t.indexOf("data:image/svg+xml;base64")||"string"==typeof t&&0===t.indexOf("<svg")},e}(mg);kg.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var Sg=function(t){function e(e,n){if(n=n||{},!(e instanceof HTMLVideoElement)){var r=document.createElement("video");r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),"string"==typeof e&&(e=[e]),t.crossOrigin(r,e[0].src||e[0],n.crossorigin);for(var i=0;i<e.length;++i){var o=document.createElement("source"),a=e[i],s=a.src,u=a.mime,c=(s=s||e[i]).split("?").shift().toLowerCase(),l=c.substr(c.lastIndexOf(".")+1);u=u||"video/"+l,o.src=s,o.type=u,r.appendChild(o)}e=r}t.call(this,e),this.noSubImage=!0,this._autoUpdate=!0,this._isAutoUpdating=!1,this._updateFPS=n.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==n.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==n.autoLoad&&this.load()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={autoUpdate:{configurable:!0},updateFPS:{configurable:!0}};return e.prototype.update=function(e){void 0===e&&(e=0),this.destroyed||(this._msToNextUpdate=Math.floor(this._msToNextUpdate-fg.shared.elapsedMS*this.source.playbackRate),(!this._updateFPS||this._msToNextUpdate<=0)&&(t.prototype.update.call(this,e),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))},e.prototype.load=function(){var t=this;if(this._load)return this._load;var e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart.bind(this)),e.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((function(n){t.valid?n(t):(t._resolve=n,e.load())})),this._load},e.prototype._onError=function(){this.source.removeEventListener("error",this._onError,!0),this.onError.run(event)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2},e.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(fg.shared.add(this.update,this),this._isAutoUpdating=!0)},e.prototype._onPlayStop=function(){this._isAutoUpdating&&(fg.shared.remove(this.update,this),this._isAutoUpdating=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isAutoUpdating&&fg.shared.remove(this.update,this),this.source&&(this.source.removeEventListener("error",this._onError,!0),this.source.pause(),this.source.src="",this.source.load()),t.prototype.dispose.call(this)},n.autoUpdate.get=function(){return this._autoUpdate},n.autoUpdate.set=function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isAutoUpdating?(fg.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(fg.shared.add(this.update,this),this._isAutoUpdating=!0))},n.updateFPS.get=function(){return this._updateFPS},n.updateFPS.set=function(t){t!==this._updateFPS&&(this._updateFPS=t)},e.test=function(t,n){return t instanceof HTMLVideoElement||e.TYPES.indexOf(n)>-1},Object.defineProperties(e.prototype,n),e}(mg);Sg.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],gg.push(yg,function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e}(mg),Tg,Sg,kg,_g,Cg,xg);var Ag=function(t){this.renderer=t};Ag.prototype.destroy=function(){this.renderer=null};var Ig=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.upload=function(t,e,n){var r=t.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===$m.UNPACK),n.width===e.width&&n.height===e.height?r.texSubImage2D(e.target,0,0,0,e.width,e.height,e.format,e.type,this.data):(n.width=e.width,n.height=e.height,r.texImage2D(e.target,0,r.DEPTH_COMPONENT16,e.width,e.height,0,e.format,e.type,this.data)),!0},e}(_g),Og=function(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new lg("disposeFramebuffer",2)},Pg={colorTexture:{configurable:!0}};Pg.colorTexture.get=function(){return this.colorTextures[0]},Og.prototype.addColorTexture=function(t,e){return void 0===t&&(t=0),this.colorTextures[t]=e||new Eg(null,{scaleMode:0,resolution:1,mipmap:!1,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Og.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Eg(new Ig(null,{width:this.width,height:this.height}),{scaleMode:0,resolution:1,width:this.width,height:this.height,mipmap:!1,format:Km.DEPTH_COMPONENT,type:Ym.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Og.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Og.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Og.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var n=0;n<this.colorTextures.length;n++){var r=this.colorTextures[n],i=r.resolution;r.setSize(t/i,e/i)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(t/o,e/o)}}},Og.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Object.defineProperties(Og.prototype,Pg);var Dg=function(t){function e(e){"number"==typeof e&&(e={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.call(this,null,e);var n=e||{},r=n.width,i=n.height;this.mipmap=!1,this.width=Math.ceil(r)||100,this.height=Math.ceil(i)||100,this.valid=!0,this._canvasRenderTarget=null,this.clearColor=[0,0,0,0],this.framebuffer=new Og(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this),this.maskStack=[],this.filterStack=[{}]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.resize=function(t,e){t=Math.ceil(t),e=Math.ceil(e),this.framebuffer.resize(t*this.resolution,e*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),t.prototype.dispose.call(this)},e.prototype.destroy=function(){t.prototype.destroy.call(this,!0),this.framebuffer=null},e}(Eg),Ng=function(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)};Ng.prototype.set=function(t,e,n){var r=e.width,i=e.height;if(n){var o=t.width/2/r,a=t.height/2/i,s=t.x/r+o,u=t.y/i+a;n=Jy.add(n,Jy.NW),this.x0=s+o*Jy.uX(n),this.y0=u+a*Jy.uY(n),n=Jy.add(n,2),this.x1=s+o*Jy.uX(n),this.y1=u+a*Jy.uY(n),n=Jy.add(n,2),this.x2=s+o*Jy.uX(n),this.y2=u+a*Jy.uY(n),n=Jy.add(n,2),this.x3=s+o*Jy.uX(n),this.y3=u+a*Jy.uY(n)}else this.x0=t.x/r,this.y0=t.y/i,this.x1=(t.x+t.width)/r,this.y1=t.y/i,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/i,this.x3=t.x/r,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3};var Rg=new Ng,Mg=function(t){function e(n,r,i,o,a,s){if(t.call(this),this.noFrame=!1,r||(this.noFrame=!0,r=new $y(0,0,1,1)),n instanceof e&&(n=n.baseTexture),this.baseTexture=n,this._frame=r,this.trim=o,this.valid=!1,this.requiresUpdate=!1,this._uvs=Rg,this.uvMatrix=null,this.orig=i||r,this._rotate=Number(a||0),!0===a)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new Fy(s.x,s.y):new Fy(0,0),this._updateID=0,this.textureCacheIds=[],n.valid?this.noFrame?n.valid&&this.onBaseTextureUpdated(n):this.frame=r:n.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&n.on("update",this.onBaseTextureUpdated,this)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={resolution:{configurable:!0},frame:{configurable:!0},rotate:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var n=this.baseTexture.resource;n&&Oy[n.url]&&e.removeFromCache(n.url),this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===Rg&&(this._uvs=new Ng),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,n,r){void 0===n&&(n={}),void 0===r&&(r=oy.STRICT_TEXTURE_CACHE);var i="string"==typeof t,o=null;i?o=t:(t._pixiId||(t._pixiId="pixiid_"+xy()),o=t._pixiId);var a=Oy[o];if(i&&r&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(n.resolution||(n.resolution=Ry(t)),(a=new e(new Eg(t,n))).baseTexture.cacheId=o,Eg.addToCache(a.baseTexture,o),e.addToCache(a,o)),a},e.fromBuffer=function(t,n,r,i){return new e(Eg.fromBuffer(t,n,r,i))},e.fromLoader=function(t,n,r){var i=new yg(t);i.url=n;var o=new e(new Eg(i,{scaleMode:oy.SCALE_MODE,resolution:Ry(n)}));return r||(r=n),Eg.addToCache(o.baseTexture,r),e.addToCache(o,r),r!==n&&(Eg.addToCache(o.baseTexture,n),e.addToCache(o,n)),o},e.addToCache=function(t,e){e&&(-1===t.textureCacheIds.indexOf(e)&&t.textureCacheIds.push(e),Oy[e]&&console.warn("Texture added to the cache with an id ["+e+"] that already had an entry"),Oy[e]=t)},e.removeFromCache=function(t){if("string"==typeof t){var e=Oy[t];if(e){var n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete Oy[t],e}}else if(t&&t.textureCacheIds){for(var r=0;r<t.textureCacheIds.length;++r)Oy[t.textureCacheIds[r]]===t&&delete Oy[t.textureCacheIds[r]];return t.textureCacheIds.length=0,t}return null},n.resolution.get=function(){return this.baseTexture.resolution},n.frame.get=function(){return this._frame},n.frame.set=function(t){this._frame=t,this.noFrame=!1;var e=t.x,n=t.y,r=t.width,i=t.height,o=e+r>this.baseTexture.width,a=n+i>this.baseTexture.height;if(o||a)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: X: "+e+" + "+r+" = "+(e+r)+" > "+this.baseTexture.width+" "+(o&&a?"and":"or")+" Y: "+n+" + "+i+" = "+(n+i)+" > "+this.baseTexture.height);this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()},n.rotate.get=function(){return this._rotate},n.rotate.set=function(t){this._rotate=t,this.valid&&this.updateUvs()},n.width.get=function(){return this.orig.width},n.height.get=function(){return this.orig.height},Object.defineProperties(e.prototype,n),e}(sy.a);function Lg(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}Mg.EMPTY=new Mg(new Eg),Lg(Mg.EMPTY),Lg(Mg.EMPTY.baseTexture),Mg.WHITE=function(){var t=document.createElement("canvas");t.width=16,t.height=16;var e=t.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new Mg(new Eg(new Tg(t)))}(),Lg(Mg.WHITE),Lg(Mg.WHITE.baseTexture);var Bg=function(t){function e(e,n){var r=null;if(!(e instanceof Dg)){var i=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4];console.warn("Please use RenderTexture.create("+i+", "+o+") instead of the ctor directly."),r=arguments[0],n=null,e=new Dg({width:i,height:o,scaleMode:a,resolution:s})}t.call(this,e,n),this.legacyRenderer=r,this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.resize=function(t,e,n){void 0===n&&(n=!0),t=Math.ceil(t),e=Math.ceil(e),this.valid=t>0&&e>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=e,n&&this.baseTexture.resize(t,e),this.updateUvs()},e.prototype.setResolution=function(t){var e=this.baseTexture;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))},e.create=function(t){return"number"==typeof t&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new Dg(t))},e}(Mg),Fg=function(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0};Fg.prototype.createTexture=function(t,e){var n=new Dg(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Bg(n)},Fg.prototype.getOptimalTexture=function(t,e,n){void 0===n&&(n=1);var r=Fg.SCREEN_KEY;t*=n,e*=n,this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight||(r=(65535&(t=Cy(t)))<<16|65535&(e=Cy(e))),this.texturePool[r]||(this.texturePool[r]=[]);var i=this.texturePool[r].pop();return i||(i=this.createTexture(t,e)),i.filterPoolKey=r,i.setResolution(n),i},Fg.prototype.getFilterTexture=function(t,e){var n=this.getOptimalTexture(t.width,t.height,e||t.resolution);return n.filterFrame=t.filterFrame,n},Fg.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},Fg.prototype.returnFilterTexture=function(t){this.returnTexture(t)},Fg.prototype.clear=function(t){if(t=!1!==t)for(var e in this.texturePool){var n=this.texturePool[e];if(n)for(var r=0;r<n.length;r++)n[r].destroy(!0)}this.texturePool={}},Fg.prototype.setScreenSize=function(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){var e=Fg.SCREEN_KEY,n=this.texturePool[e];if(this.enableFullScreen=t.width>0&&t.height>0,n)for(var r=0;r<n.length;r++)n[r].destroy(!0);this.texturePool[e]=[],this._pixelsWidth=t.width,this._pixelsHeight=t.height}},Fg.SCREEN_KEY="screen";var Ug=function(t,e,n,r,i,o,a){void 0===n&&(n=!1),void 0===r&&(r=5126),this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=i,this.start=o,this.instance=a};Ug.prototype.destroy=function(){this.buffer=null},Ug.from=function(t,e,n,r,i){return new Ug(t,e,n,r,i)};var Vg=0,jg=function(t,e,n){void 0===e&&(e=!0),void 0===n&&(n=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=Vg++,this.disposeRunner=new lg("disposeBuffer",2)};function qg(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}jg.prototype.update=function(t){this.data=t||this.data,this._updateID++},jg.prototype.dispose=function(){this.disposeRunner.run(this,!1)},jg.prototype.destroy=function(){this.dispose(),this.data=null},jg.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new jg(t)};var Gg={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},zg={5126:4,5123:2,5121:1},Hg=0,Wg={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Kg=function(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Hg++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new lg("disposeGeometry",2),this.refCount=0};Kg.prototype.addAttribute=function(t,e,n,r,i,o,a,s){if(void 0===r&&(r=!1),void 0===s&&(s=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e.data||(e instanceof Array&&(e=new Float32Array(e)),e=new jg(e));var u=t.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],e,n,r,i);return this}var l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new Ug(l,n,r,i,o,a,s),this.instanced=this.instanced||s,this},Kg.prototype.getAttribute=function(t){return this.attributes[t]},Kg.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},Kg.prototype.addIndex=function(t){return t.data||(t instanceof Array&&(t=new Uint16Array(t)),t=new jg(t)),t.index=!0,this.indexBuffer=t,-1===this.buffers.indexOf(t)&&this.buffers.push(t),this},Kg.prototype.getIndex=function(){return this.indexBuffer},Kg.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var t,e=[],n=[],r=new jg;for(t in this.attributes){var i=this.attributes[t];e.push(this.buffers[i.buffer].data),n.push(i.size*zg[i.type]/4),i.buffer=0}for(r.data=function(t,e){for(var n=0,r=0,i={},o=0;o<t.length;o++)r+=e[o],n+=t[o].length;for(var a=new ArrayBuffer(4*n),s=null,u=0,c=0;c<t.length;c++){var l=e[c],h=t[c],f=qg(h);i[f]||(i[f]=new Gg[f](a)),s=i[f];for(var d=0;d<h.length;d++)s[(d/l|0)*r+u+d%l]=h[d];u+=l}return new Float32Array(a)}(e,n),t=0;t<this.buffers.length;t++)this.buffers[t]!==this.indexBuffer&&this.buffers[t].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Kg.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},Kg.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Kg.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Kg.prototype.clone=function(){for(var t=new Kg,e=0;e<this.buffers.length;e++)t.buffers[e]=new jg(this.buffers[e].data.slice());for(var n in this.attributes){var r=this.attributes[n];t.attributes[n]=new Ug(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.index=!0),t},Kg.merge=function(t){for(var e,n=new Kg,r=[],i=[],o=[],a=0;a<t.length;a++){e=t[a];for(var s=0;s<e.buffers.length;s++)i[s]=i[s]||0,i[s]+=e.buffers[s].data.length,o[s]=0}for(var u=0;u<e.buffers.length;u++)r[u]=new(Wg[qg(e.buffers[u].data)])(i[u]),n.buffers[u]=new jg(r[u]);for(var c=0;c<t.length;c++){e=t[c];for(var l=0;l<e.buffers.length;l++)r[l].set(e.buffers[l].data,o[l]),o[l]+=e.buffers[l].data.length}if(n.attributes=e.attributes,e.indexBuffer){n.indexBuffer=n.buffers[e.buffers.indexOf(e.indexBuffer)],n.indexBuffer.index=!0;for(var h=0,f=0,d=0,p=0,v=0;v<e.buffers.length;v++)if(e.buffers[v]!==e.indexBuffer){p=v;break}for(var m in e.attributes){var y=e.attributes[m];(0|y.buffer)===p&&(f+=y.size*zg[y.type]/4)}for(var g=0;g<t.length;g++){for(var b=t[g].indexBuffer.data,_=0;_<b.length;_++)n.indexBuffer.data[_+d]+=h;h+=e.buffers[p].data.length/f,d+=b.length}}return n};var Xg=function(t){function e(){t.call(this),this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Kg),Yg=function(t){function e(){t.call(this),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new jg(this.vertices),this.uvBuffer=new jg(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.map=function(t,e){var n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,r=e.y,this.vertices[0]=n=e.x,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e}(Kg),Qg=0,Jg=function(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Qg++,this.static=!!e};Jg.prototype.update=function(){this.dirtyId++},Jg.prototype.add=function(t,e,n){this.uniforms[t]=new Jg(e,n)},Jg.from=function(t,e){return new Jg(t,e)};var Zg=function(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new $y,this.destinationFrame=new $y,this.filters=[]};Zg.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null};var $g=function(t){function e(e){t.call(this,e),this.defaultFilterStack=[{}],this.texturePool=new Fg,this.texturePool.setScreenSize(e.view),this.statePool=[],this.quad=new Xg,this.quadUv=new Yg,this.tempRect=new $y,this.activeState={},this.globalUniforms=new Jg({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this._pixelsWidth=e.view.width,this._pixelsHeight=e.view.height}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.push=function(t,e){for(var n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new Zg,o=e[0].resolution,a=e[0].padding,s=e[0].autoFit,u=e[0].legacy,c=1;c<e.length;c++){var l=e[c];o=Math.min(o,l.resolution),a=Math.max(a,l.padding),s=s||l.autoFit,u=u||l.legacy}1===r.length&&(this.defaultFilterStack[0].renderTexture=n.renderTexture.current),r.push(i),i.resolution=o,i.legacy=u,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(a),s&&i.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),i.sourceFrame.ceil(o),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height,i.renderTexture.filterFrame=i.sourceFrame,n.renderTexture.bind(i.renderTexture,i.sourceFrame),n.renderTexture.clear()},e.prototype.pop=function(){var t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;var r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;var i=r.inputSize,o=r.inputPixel,a=r.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],o[0]=i[0]*e.resolution,o[1]=i[1]*e.resolution,o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=e.sourceFrame.width*i[2]-.5*o[2],a[3]=e.sourceFrame.height*i[3]-.5*o[3],e.legacy){var s=r.filterArea;s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=e.sourceFrame.x,s[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();var u=t[t.length-1];if(1===n.length)n[0].apply(this,e.renderTexture,u.renderTexture,!1,e),this.returnFilterTexture(e.renderTexture);else{var c=e.renderTexture,l=this.getOptimalFilterTexture(c.width,c.height,e.resolution);l.filterFrame=c.filterFrame;var h=0;for(h=0;h<n.length-1;++h){n[h].apply(this,c,l,!0,e);var f=c;c=l,l=f}n[h].apply(this,c,u.renderTexture,!1,e),this.returnFilterTexture(c),this.returnFilterTexture(l)}e.clear(),this.statePool.push(e)},e.prototype.applyFilter=function(t,e,n,r){var i=this.renderer;i.renderTexture.bind(n,n?n.filterFrame:null),r&&i.renderTexture.clear(),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.state.set(t.state),i.shader.bind(t),t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(Wm.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(Wm.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,e){var n=this.activeState,r=n.sourceFrame,i=n.destinationFrame,o=e._texture.orig,a=t.set(i.width,0,0,i.height,r.x,r.y),s=e.worldTransform.copyTo(Gy.TEMP_MATRIX);return s.invert(),a.prepend(s),a.scale(1/o.width,1/o.height),a.translate(e.anchor.x,e.anchor.y),a},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,e,n){return void 0===n&&(n=1),this.texturePool.getOptimalTexture(t,e,n)},e.prototype.getFilterTexture=function(t,e){if("number"==typeof t){var n=t;t=e,e=n}var r=this.texturePool.getOptimalTexture((t=t||this.activeState.renderTexture).width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e}(Ag),tb=function(t){this.renderer=t};tb.prototype.flush=function(){},tb.prototype.destroy=function(){this.renderer=null},tb.prototype.start=function(){},tb.prototype.stop=function(){this.flush()},tb.prototype.render=function(t){};var eb=function(t){function e(e){t.call(this,e),this.emptyRenderer=new tb(e),this.currentRenderer=this.emptyRenderer}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,e){for(var n=this.renderer.texture.boundTextures,r=e-1;r>=0;--r)t[r]=n[r]||null,t[r]&&(t[r]._batchLocation=r)},e.prototype.boundArray=function(t,e,n,r){for(var i=t.elements,o=t.ids,a=t.count,s=0,u=0;u<a;u++){var c=i[u],l=c._batchLocation;if(l>=0&&l<r&&e[l]===c)o[u]=l;else for(;s<r;){var h=e[s];if(!h||h._batchEnabled!==n||h._batchLocation!==s){o[u]=s,c._batchLocation=s,e[s]=c;break}s++}}},e}(Ag);oy.PREFER_ENV=iy.a.any?Gm.WEBGL:Gm.WEBGL2,oy.STRICT_TEXTURE_CACHE=!1;var nb=0,rb=function(t){function e(e){t.call(this,e),this.webGLVersion=1,this.extensions={},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),e.view.addEventListener("webglcontextlost",this.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={isLost:{configurable:!0}};return n.isLost.get=function(){return!this.gl||this.gl.isContextLost()},e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=nb++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=nb++,this.renderer.runners.contextChange.run(t)},e.prototype.initFromOptions=function(t){var e=this.createContext(this.renderer.view,t);this.initFromContext(e)},e.prototype.createContext=function(t,e){var n;if(oy.PREFER_ENV>=Gm.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,!(n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),n},e.prototype.getExtensions=function(){var t=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBKIT_WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.run(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){t.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")},Object.defineProperties(e.prototype,n),e}(Ag),ib=function(t){function e(e){t.call(this,e),this.managedFramebuffers=[],this.unknownFramebuffer=new Og(10,10)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={size:{configurable:!0}};return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new $y,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;oy.PREFER_ENV===Gm.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=function(t){return e.drawBuffersWEBGL(t)}:(this.hasMRT=!1,t.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}},e.prototype.bind=function(t,e){var n=this.gl;if(t){var r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var i=0;i<t.colorTextures.length;i++)this.renderer.texture.unbind(t.colorTextures[i].texturePart?t.colorTextures[i].texture:t.colorTextures[i]);t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,e,n,r){var i=this.viewport;i.width===n&&i.height===r&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=n,i.height=r,this.gl.viewport(t,e,n,r))},n.size.get=function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},e.prototype.clear=function(t,e,n,r){var i=this.gl;i.clearColor(t,e,n,r),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},e.prototype.initFramebuffer=function(t){var e={framebuffer:this.gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};return t.glFramebuffers[this.CONTEXT_UID]=e,this.managedFramebuffers.push(t),t.disposeRunner.add(this),e},e.prototype.resizeFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));for(var r=t.colorTextures,i=0;i<r.length;i++)this.renderer.texture.bind(r[i],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var e=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures.length;e.drawBuffers||(r=Math.min(r,1));for(var i=[],o=0;o<r;o++){var a=t.colorTextures[o];a.texturePart?(this.renderer.texture.bind(a.texture,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_CUBE_MAP_NEGATIVE_X+a.side,a.texture._glTextures[this.CONTEXT_UID].texture,0)):(this.renderer.texture.bind(a,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+o,e.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,0)),i.push(e.COLOR_ATTACHMENT0+o)}if(i.length>1&&e.drawBuffers(i),t.depthTexture&&this.writeDepthTexture){var s=t.depthTexture;this.renderer.texture.bind(s,0),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,0)}n.stencil||!t.stencil&&!t.depth||(n.stencil=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),t.depthTexture||e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,n.stencil))},e.prototype.disposeFramebuffer=function(t,e){var n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(n){delete t.glFramebuffers[this.CONTEXT_UID];var i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.stencil&&r.deleteRenderbuffer(n.stencil))}},e.prototype.disposeAll=function(t){var e=this.managedFramebuffers;this.managedFramebuffers=[];for(var n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var e=t.glFramebuffers[this.CONTEXT_UID];if(e&&!e.stencil){t.enableStencil();var n=t.width,r=t.height,i=this.gl,o=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),e.stencil=o,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,o)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new $y},Object.defineProperties(e.prototype,n),e}(Ag),ob=function(t){this.buffer=t,this.updateID=-1,this.byteLength=-1,this.refCount=0},ab={5126:4,5123:2,5121:1},sb=function(t){function e(e){t.call(this,e),this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.boundBuffers={},this.managedGeometries={},this.managedBuffers={}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!t.createVertexArray){var n=this.renderer.context.extensions.vertexArrayObject;oy.PREFER_ENV===Gm.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=function(){return n.createVertexArrayOES()},t.bindVertexArray=function(t){return n.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return n.deleteVertexArrayOES(t)}):(this.hasVao=!1,t.createVertexArray=function(){},t.bindVertexArray=function(){},t.deleteVertexArray=function(){})}if(!t.vertexAttribDivisor){var r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=function(t,e){return r.vertexAttribDivisorANGLE(t,e)},t.drawElementsInstanced=function(t,e,n,i,o){return r.drawElementsInstancedANGLE(t,e,n,i,o)},t.drawArraysInstanced=function(t,e,n,i){return r.drawArraysInstancedANGLE(t,e,n,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex},e.prototype.bind=function(t,e){e=e||this.renderer.shader.shader;var n=this.gl,r=t.glVertexArrayObjects[this.CONTEXT_UID];r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={});var i=r[e.program.id]||this.initGeometryVao(t,e.program);this._activeGeometry=t,this._activeVao!==i&&(this._activeVao=i,this.hasVao?n.bindVertexArray(i):this.activateVao(t,e.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,e=this.gl,n=0;n<t.buffers.length;n++){var r=t.buffers[n],i=r._glBuffers[this.CONTEXT_UID];if(r._updateID!==i.updateID){i.updateID=r._updateID;var o=r.index?e.ELEMENT_ARRAY_BUFFER:e.ARRAY_BUFFER;if(e.bindBuffer(o,i.buffer),this._boundBuffer=i,i.byteLength>=r.data.byteLength)e.bufferSubData(o,0,r.data);else{var a=r.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;i.byteLength=r.data.byteLength,e.bufferData(o,r.data,a)}}}},e.prototype.checkCompatibility=function(t,e){var n=t.attributes,r=e.attributeData;for(var i in r)if(!n[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},e.prototype.getSignature=function(t,e){var n=t.attributes,r=e.attributeData,i=["g",t.id];for(var o in n)r[o]&&i.push(o);return i.join("-")},e.prototype.initGeometryVao=function(t,e){this.checkCompatibility(t,e);var n=this.gl,r=this.CONTEXT_UID,i=this.getSignature(t,e),o=t.glVertexArrayObjects[this.CONTEXT_UID],a=o[i];if(a)return o[e.id]=a,a;var s=t.buffers,u=t.attributes,c={},l={};for(var h in s)c[h]=0,l[h]=0;for(var f in u)!u[f].size&&e.attributeData[f]?u[f].size=e.attributeData[f].size:u[f].size||console.warn("PIXI Geometry attribute '"+f+"' size cannot be determined (likely the bound shader does not have the attribute)"),c[u[f].buffer]+=u[f].size*ab[u[f].type];for(var d in u){var p=u[d],v=p.size;void 0===p.stride&&(p.stride=c[p.buffer]===v*ab[p.type]?0:c[p.buffer]),void 0===p.start&&(p.start=l[p.buffer],l[p.buffer]+=v*ab[p.type])}a=n.createVertexArray(),n.bindVertexArray(a);for(var m=0;m<s.length;m++){var y=s[m];y._glBuffers[r]||(y._glBuffers[r]=new ob(n.createBuffer()),this.managedBuffers[y.id]=y,y.disposeRunner.add(this)),y._glBuffers[r].refCount++}return this.activateVao(t,e),this._activeVao=a,o[e.id]=a,o[i]=a,a},e.prototype.disposeBuffer=function(t,e){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,e){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,i=t.buffers;if(t.disposeRunner.remove(this),n){for(var o=0;o<i.length;o++){var a=i[o]._glBuffers[this.CONTEXT_UID];a.refCount--,0!==a.refCount||e||this.disposeBuffer(i[o],e)}if(!e)for(var s in n)if("g"===s[0]){var u=n[s];this._activeVao===u&&this.unbind(),r.deleteVertexArray(u)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var e=Object.keys(this.managedGeometries),n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t);e=Object.keys(this.managedBuffers);for(var r=0;r<e.length;r++)this.disposeBuffer(this.managedBuffers[e[r]],t)},e.prototype.activateVao=function(t,e){var n=this.gl,r=this.CONTEXT_UID,i=t.buffers,o=t.attributes;t.indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[r].buffer);var a=null;for(var s in o){var u=o[s],c=i[u.buffer]._glBuffers[r];if(e.attributeData[s]){a!==c&&(n.bindBuffer(n.ARRAY_BUFFER,c.buffer),a=c);var l=e.attributeData[s].location;if(n.enableVertexAttribArray(l),n.vertexAttribPointer(l,u.size,u.type||n.FLOAT,u.normalized,u.stride,u.start),u.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(l,1)}}}},e.prototype.draw=function(t,e,n,r){var i=this.gl,o=this._activeGeometry;if(o.indexBuffer){var a=o.indexBuffer.data.BYTES_PER_ELEMENT,s=2===a?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?o.instanced?i.drawElementsInstanced(t,e||o.indexBuffer.data.length,s,(n||0)*a,r||1):i.drawElements(t,e||o.indexBuffer.data.length,s,(n||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?i.drawArraysInstanced(t,n,e||o.getSize(),r||1):i.drawArrays(t,n,e||o.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e}(Ag),ub=function(t){this.type=ny.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null};function cb(t,e,n,r){var i=lb(t,t.VERTEX_SHADER,e),o=lb(t,t.FRAGMENT_SHADER,n),a=t.createProgram();if(t.attachShader(a,i),t.attachShader(a,o),r)for(var s in r)t.bindAttribLocation(a,r[s],s);return t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(a,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(a)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(a)),t.deleteProgram(a),a=null),t.deleteShader(i),t.deleteShader(o),a}function lb(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.warn(n),console.error(t.getShaderInfoLog(r)),null)}function hb(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return fb(2*e);case"bvec3":return fb(3*e);case"bvec4":return fb(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function fb(t){for(var e=new Array(t),n=0;n<e.length;n++)e[n]=!1;return e}ub.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=ny.NONE,this.autoDetect=!0),this._target=null},ub.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)};var db,pb={},vb=pb;function mb(){if(vb===pb||vb&&vb.isContextLost()){var t,e=document.createElement("canvas");oy.PREFER_ENV>=Gm.WEBGL2&&(t=e.getContext("webgl2",{})),t||((t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?t.getExtension("WEBGL_draw_buffers"):t=null),vb=t}return vb}function yb(t,e,n){if("precision"!==t.substring(0,9)){var r=e;return e===ey.HIGH&&n!==ey.HIGH&&(r=ey.MEDIUM),"precision "+r+" float;\n"+t}return n!==ey.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}var gb={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function bb(t){return gb[t]}var _b=null,wb={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function Eb(t,e){if(!_b){var n=Object.keys(wb);_b={};for(var r=0;r<n.length;++r){var i=n[r];_b[t[i]]=wb[i]}}return _b[e]}var xb,Tb={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Cb={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},kb=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Sb(t){for(var e="",n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+="if(test == "+n+".0){}");return e}var Ab=0,Ib={},Ob=function t(e,n,r){void 0===r&&(r="pixi-shader"),this.id=Ab++,this.vertexSrc=e||t.defaultVertexSrc,this.fragmentSrc=n||t.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(r=r.replace(/\s+/g,"-"),Ib[r]?(Ib[r]++,r+="-"+Ib[r]):Ib[r]=1,this.vertexSrc="#define SHADER_NAME "+r+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+"\n"+this.fragmentSrc,this.vertexSrc=yb(this.vertexSrc,oy.PRECISION_VERTEX,ey.HIGH),this.fragmentSrc=yb(this.fragmentSrc,oy.PRECISION_FRAGMENT,function(){if(!db){db=ey.MEDIUM;var t=mb();if(t&&t.getShaderPrecisionFormat){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);db=e.precision?ey.HIGH:ey.MEDIUM}}return db}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null},Pb={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};Ob.prototype.extractData=function(t,e){var n=mb();if(n){var r=cb(n,t,e);this.attributeData=this.getAttributeData(r,n),this.uniformData=this.getUniformData(r,n),n.deleteProgram(r)}else this.uniformData={},this.attributeData={}},Ob.prototype.getAttributeData=function(t,e){for(var n={},r=[],i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<i;o++){var a=e.getActiveAttrib(t,o),s=Eb(e,a.type),u={type:s,name:a.name,size:bb(s),location:0};n[a.name]=u,r.push(u)}r.sort((function(t,e){return t.name>e.name?1:-1}));for(var c=0;c<r.length;c++)r[c].location=c;return n},Ob.prototype.getUniformData=function(t,e){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;i++){var o=e.getActiveUniform(t,i),a=o.name.replace(/\[.*?\]/,""),s=o.name.match(/\[.*?\]/,""),u=Eb(e,o.type);n[a]={type:u,size:o.size,isArray:s,value:hb(u,o.size)}}return n},Pb.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},Pb.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},Ob.from=function(t,e,n){var r=t+e,i=Iy[r];return i||(Iy[r]=i=new Ob(t,e,n)),i},Object.defineProperties(Ob,Pb);var Db=function(t,e){for(var n in this.program=t,this.uniformGroup=e?e instanceof Jg?e:new Jg(e):new Jg({}),t.uniformData)this.uniformGroup.uniforms[n]instanceof Array&&(this.uniformGroup.uniforms[n]=new Float32Array(this.uniformGroup.uniforms[n]))},Nb={uniforms:{configurable:!0}};Db.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var n in e.uniforms){var r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1},Db.prototype.destroy=function(){this.uniformGroup=null},Nb.uniforms.get=function(){return this.uniformGroup.uniforms},Db.from=function(t,e,n){var r=Ob.from(t,e);return new Db(r,n)},Object.defineProperties(Db.prototype,Nb);var Rb=function(){this.data=0,this.blendMode=Hm.NORMAL,this.polygonOffset=0,this.blend=!0},Mb={blend:{configurable:!0},offsets:{configurable:!0},culling:{configurable:!0},depthTest:{configurable:!0},clockwiseFrontFace:{configurable:!0},blendMode:{configurable:!0},polygonOffset:{configurable:!0}};Mb.blend.get=function(){return!!(1&this.data)},Mb.blend.set=function(t){!!(1&this.data)!==t&&(this.data^=1)},Mb.offsets.get=function(){return!!(2&this.data)},Mb.offsets.set=function(t){!!(2&this.data)!==t&&(this.data^=2)},Mb.culling.get=function(){return!!(4&this.data)},Mb.culling.set=function(t){!!(4&this.data)!==t&&(this.data^=4)},Mb.depthTest.get=function(){return!!(8&this.data)},Mb.depthTest.set=function(t){!!(8&this.data)!==t&&(this.data^=8)},Mb.clockwiseFrontFace.get=function(){return!!(16&this.data)},Mb.clockwiseFrontFace.set=function(t){!!(16&this.data)!==t&&(this.data^=16)},Mb.blendMode.get=function(){return this._blendMode},Mb.blendMode.set=function(t){this.blend=t!==Hm.NONE,this._blendMode=t},Mb.polygonOffset.get=function(){return this._polygonOffset},Mb.polygonOffset.set=function(t){this.offsets=!!t,this._polygonOffset=t},Rb.for2d=function(){var t=new Rb;return t.depthTest=!1,t.blend=!0,t},Object.defineProperties(Rb.prototype,Mb);var Lb=function(t){function e(n,r,i){var o=Ob.from(n||e.defaultVertexSrc,r||e.defaultFragmentSrc);t.call(this,o,i),this.padding=0,this.resolution=oy.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0,this.legacy=!!this.program.attributeData.aTextureCoord,this.state=new Rb}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={blendMode:{configurable:!0}},r={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};return e.prototype.apply=function(t,e,n,r,i){t.applyFilter(this,e,n,r,i)},n.blendMode.get=function(){return this.state.blendMode},n.blendMode.set=function(t){this.state.blendMode=t},r.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},r.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},Object.defineProperties(e.prototype,n),Object.defineProperties(e,r),e}(Db);Lb.SOURCE_KEY_MAP={};var Bb="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",Fb="varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",Ub=new Gy,Vb=function(t,e){this._texture=t,this.mapCoord=new Gy,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._updateID=-1,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1},jb={texture:{configurable:!0}};jb.texture.get=function(){return this._texture},jb.texture.set=function(t){this._texture=t,this._updateID=-1},Vb.prototype.multiplyUvs=function(t,e){void 0===e&&(e=t);for(var n=this.mapCoord,r=0;r<t.length;r+=2){var i=t[r],o=t[r+1];e[r]=i*n.a+o*n.c+n.tx,e[r+1]=i*n.b+o*n.d+n.ty}return e},Vb.prototype.update=function(t){var e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._updateID===e._updateID)return!1;this._updateID=e._updateID;var n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);var r=e.orig,i=e.trim;i&&(Ub.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Ub));var o=e.baseTexture,a=this.uClampFrame,s=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(e._frame.x+s+u)/o.width,a[1]=(e._frame.y+s+u)/o.height,a[2]=(e._frame.x+e._frame.width-s+u)/o.width,a[3]=(e._frame.y+e._frame.height-s+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&0===e.rotate,!0},Object.defineProperties(Vb.prototype,jb);var qb=function(t){function e(e){var n=new Gy;t.call(this,Bb,Fb),e.renderable=!1,this.maskSprite=e,this.maskMatrix=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.apply=function(t,e,n,r){var i=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.transform||(o.transform=new Vb(o,0)),o.transform.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(o.transform.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=o.transform.uClampFrame,t.applyFilter(this,e,n,r))},e}(Lb),Gb=function(t){function e(e){t.call(this,e),this.scissorRenderTarget=null,this.enableScissor=!1,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,e){if(!e.isMaskData){var n=this.maskDataPool.pop()||new ub;n.pooled=!0,n.maskObject=e,e=n}switch(e.autoDetect&&this.detect(e),e.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),e._target=t,e.type){case ny.SCISSOR:this.maskStack.push(e),this.renderer.scissor.push(e);break;case ny.STENCIL:this.maskStack.push(e),this.renderer.stencil.push(e);break;case ny.SPRITE:e.copyCountersOrReset(null),this.pushSpriteMask(e),this.maskStack.push(e)}},e.prototype.pop=function(t){var e=this.maskStack.pop();if(e&&e._target===t){switch(e.type){case ny.SCISSOR:this.renderer.scissor.pop();break;case ny.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case ny.SPRITE:this.popSpriteMask()}e.reset(),e.pooled&&this.maskDataPool.push(e)}},e.prototype.detect=function(t){var e=t.maskObject;if(e.isSprite)t.type=ny.SPRITE;else if(t.type=ny.STENCIL,this.enableScissor&&e.isFastRect&&e.isFastRect()){var n=e.worldTransform,r=Math.atan2(n.b,n.a),i=Math.atan2(n.d,n.c);r=Math.round(r*(180/Math.PI)*100),i=((i=Math.round(i*(180/Math.PI)*100)-r)%18e3+18e3)%18e3,0==(r=(r%9e3+9e3)%9e3)&&9e3===i&&(t.type=ny.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var e=t.maskObject,n=t._target,r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new qb(e)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=e;var i=n.filterArea;n.filterArea=e.getBounds(!0),this.renderer.filter.push(n,r),n.filterArea=i,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e}(Ag),zb=function(t){function e(e){t.call(this,e),this.maskStack=[],this.glConst=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var e=this.renderer.gl,n=this.getStackLength();this.maskStack=t;var r=this.getStackLength();r!==n&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){t.prototype.destroy.call(this,this),this.maskStack=null},e}(Ag),Hb=function(t){function e(e){t.call(this,e),this.glConst=WebGLRenderingContext.SCISSOR_TEST}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var e=t.maskObject;e.renderable=!0;var n=t._scissorRect,r=e.getBounds(!0),i=this.renderer.gl;e.renderable=!1,n?r.fit(n):i.enable(i.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=r,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,e=this.renderer.renderTexture.current,n=this.renderer.projection,r=n.transform,i=n.sourceFrame,o=n.destinationFrame,a=e?e.resolution:this.renderer.resolution,s=(t.x-i.x)*a+o.x,u=(t.y-i.y)*a+o.y,c=t.height*a;r&&(s+=r.tx*a,u+=r.ty*a),e||(u=this.renderer.height-c-u),this.renderer.gl.scissor(s,u,t.width*a,c)},e}(zb),Wb=function(t){function e(e){t.call(this,e),this.glConst=WebGLRenderingContext.STENCIL_TEST}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var e=t.maskObject,n=this.renderer.gl,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.enable(n.STENCIL_TEST)),t._stencilCounter++,n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.EQUAL,r,this._getBitwiseMask()),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var e=this.renderer.gl;0===this.getStackLength()?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e}(zb),Kb=function(t){function e(e){t.call(this,e),this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Gy,this.transform=null}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.update=function(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);var i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,e,n,r){var i=this.projectionMatrix;r?(i.a=1/t.width*2*n,i.d=-1/t.height*2*n,i.tx=-1-e.x*i.a,i.ty=1-e.y*i.d):(i.a=1/t.width*2*n,i.d=1/t.height*2*n,i.tx=-1-e.x*i.a,i.ty=-1-e.y*i.d)},e.prototype.setTransform=function(){},e}(Ag),Xb=new $y,Yb=function(t){function e(e){t.call(this,e),this.clearColor=e._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new $y,this.destinationFrame=new $y}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.bind=function(t,e,n){void 0===t&&(t=null),this.current=t;var r,i=this.renderer;if(t){var o=t.baseTexture;r=o.resolution,n||(Xb.width=o.realWidth,Xb.height=o.realHeight,n=Xb),e||(e=n),this.renderer.framebuffer.bind(o.framebuffer,n),this.renderer.projection.update(n,e,r,!1),this.renderer.mask.setMaskStack(o.maskStack)}else r=this.renderer.resolution,n||(Xb.width=i.width,Xb.height=i.height,n=Xb),e||(e=n),i.framebuffer.bind(null,n),this.renderer.projection.update(n,e,r,!0),this.renderer.mask.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(e),this.destinationFrame.x=n.x/r,this.destinationFrame.y=n.y/r,this.destinationFrame.width=n.width/r,this.destinationFrame.height=n.height/r,e===n&&this.sourceFrame.copyFrom(this.destinationFrame)},e.prototype.clear=function(t){this.renderer.framebuffer.clear((t=this.current?t||this.current.baseTexture.clearColor:t||this.clearColor)[0],t[1],t[2],t[3])},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e}(Ag),Qb=function(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}};Qb.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null};var Jb=0,Zb=function(t){function e(e){t.call(this,e),this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this.id=Jb++}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof xb)return xb;try{var t=new Function("param1","param2","param3","return param1[param2] === param3;");xb=!0===t({a:"b"},"a","b")}catch(e){xb=!1}return xb}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,e){t.uniforms.globals=this.renderer.globalUniforms;var n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||this.syncUniformGroup(t.uniformGroup),r},e.prototype.setUniforms=function(t){var e=this.shader.program;e.syncUniforms(e.glPrograms[this.renderer.CONTEXT_UID].uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t){var e=this.getglProgram();t.static&&t.dirtyId===e.uniformGroups[t.id]||(e.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,e))},e.prototype.syncUniforms=function(t,e){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer)},e.prototype.createSyncGroups=function(t){var e=this.getSignature(t,this.shader.program.uniformData);return this.cache[e]||(this.cache[e]=function(t,e){var n=0,r="var v = null;\n    var cv = null\n    var gl = renderer.gl";for(var i in t.uniforms){var o=e[i];o?"float"===o.type&&1===o.size?r+="\n            if(uv."+i+" !== ud."+i+".value)\n            {\n                ud."+i+".value = uv."+i+"\n                gl.uniform1f(ud."+i+".location, uv."+i+")\n            }\n":"sampler2D"!==o.type&&"samplerCube"!==o.type&&"sampler2DArray"!==o.type||1!==o.size||o.isArray?r+="mat3"===o.type&&1===o.size?void 0!==t.uniforms[i].a?"\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+".toArray(true));\n                \n":"\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+");\n                \n":"vec2"===o.type&&1===o.size?void 0!==t.uniforms[i].x?"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+i+".location, v.x, v.y);\n                }\n":"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+i+".location, v[0], v[1]);\n                }\n                \n":"vec4"===o.type&&1===o.size?void 0!==t.uniforms[i].width?"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+i+".location, v.x, v.y, v.width, v.height)\n                }\n":"\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+i+".location, v[0], v[1], v[2], v[3])\n                }\n                \n":"\n            cv = ud."+i+".value;\n            v = uv."+i+";\n            "+(1===o.size?Tb:Cb)[o.type].replace("location","ud."+i+".location")+";\n":(r+="\n            renderer.texture.bind(uv."+i+", "+n+");\n\n            if(ud."+i+".value !== "+n+")\n            {\n                ud."+i+".value = "+n+";\n                gl.uniform1i(ud."+i+".location, "+n+");\n; // eslint-disable-line max-len\n            }\n",n++):t.uniforms[i].group&&(r+="\n                    renderer.shader.syncUniformGroup(uv."+i+");\n                ")}return new Function("ud","uv","renderer",r)}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,e){var n=t.uniforms,r=[];for(var i in n)r.push(i),e[i]&&r.push(e[i].type);return r.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var e=this.gl,n=t.program,r={};for(var i in n.attributeData)r[i]=n.attributeData[i].location;var o=cb(e,n.vertexSrc,n.fragmentSrc,r),a={};for(var s in n.uniformData){var u=n.uniformData[s];a[s]={location:e.getUniformLocation(o,s),value:hb(u.type,u.size)}}var c=new Qb(o,a);return n.glPrograms[this.renderer.CONTEXT_UID]=c,c},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e}(Ag),$b=0,t_=1,e_=2,n_=3,r_=4,i_=function(t){function e(e){t.call(this,e),this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Hm.NONE,this._blendEq=!1,this.map=[],this.map[$b]=this.setBlend,this.map[t_]=this.setOffset,this.map[e_]=this.setCullFace,this.map[n_]=this.setDepthTest,this.map[r_]=this.setFrontFace,this.checks=[],this.defaultState=new Rb,this.defaultState.blend=!0,this.defaultState.depth=!0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(t){this.gl=t,this.blendModes=function(t,e){return void 0===e&&(e=[]),e[Hm.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.ADD]=[t.ONE,t.ONE],e[Hm.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.NONE]=[0,0],e[Hm.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[Hm.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[Hm.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[Hm.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[Hm.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Hm.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[Hm.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[Hm.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[Hm.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[Hm.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[Hm.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(this.stateId!==(t=t||this.defaultState).data){for(var e=this.stateId^t.data,n=0;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(var r=0;r<this.checks.length;r++)this.checks[r](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(var n=0;n<this.checks.length;n++)this.checks[n](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,e){this.gl.polygonOffset(t,e)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(0),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,e){var n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)},e.checkBlendMode=function(t,e){t.setBlendMode(e.blendMode)},e.checkPolygonOffset=function(t,e){t.setPolygonOffset(e.polygonOffset,0)},e}(Ag),o_=function(t){function e(e){t.call(this,e),this.count=0,this.checkCount=0,this.maxIdle=oy.GC_MAX_IDLE,this.checkCountMax=oy.GC_MAX_CHECK_COUNT,this.mode=oy.GC_MODE}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==ty.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,e=t.managedTextures,n=!1,r=0;r<e.length;r++){var i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){for(var o=0,a=0;a<e.length;a++)null!==e[a]&&(e[o++]=e[a]);e.length=o}},e.prototype.unload=function(t){t._texture&&t._texture._glRenderTargets&&this.renderer.textureSystem.destroyTexture(t._texture);for(var e=t.children.length-1;e>=0;e--)this.unload(t.children[e])},e}(Ag),a_=function(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},s_=function(t){function e(e){t.call(this,e),this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Eg}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(var n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};var r=new a_(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new a_(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var o=0;o<this.boundTextures.length;o++)this.bind(null,o)},e.prototype.bind=function(t,e){void 0===e&&(e=0);var n=this.gl;if(t){if((t=t.baseTexture||t).valid){t.touched=this.renderer.textureGC.count;var r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)),this.boundTextures[e]=t}}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var e=this.gl,n=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<n.length;r++)n[r]===this.unknownTexture&&this.bind(null,r)}for(var i=0;i<n.length;i++)n[i]===t&&(this.currentLocation!==i&&(e.activeTexture(e.TEXTURE0+i),this.currentLocation=i),e.bindTexture(e.TEXTURE_2D,this.emptyTextures[t.target].texture),n[i]=null)},e.prototype.initTexture=function(t){var e=new a_(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e},e.prototype.initTextureType=function(t,e){if(e.internalFormat=t.format,e.type=t.type,2===this.webGLVersion){var n=this.renderer.gl;t.type===n.FLOAT&&t.format===n.RGBA&&(e.internalFormat=n.RGBA32F),t.type===Ym.HALF_FLOAT&&(e.type=n.HALF_FLOAT),e.type===n.HALF_FLOAT&&t.format===n.RGBA&&(e.internalFormat=n.RGBA16F)}},e.prototype.updateTexture=function(t){var e=t._glTextures[this.CONTEXT_UID];if(e){var n=this.renderer;if(this.initTextureType(t,e),t.resource&&t.resource.upload(n,t,e));else{var r=t.realWidth,i=t.realHeight,o=n.gl;(e.width!==r||e.height!==i||e.dirtyId<0)&&(e.width=r,e.height=i,o.texImage2D(t.target,0,e.internalFormat,r,i,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,e){var n=this.gl;if((t=t.baseTexture||t)._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){var r=this.managedTextures.indexOf(t);-1!==r&&wy(this.managedTextures,r,1)}},e.prototype.updateTextureStyle=function(t){var e=t._glTextures[this.CONTEXT_UID];e&&(e.mipmap=t.mipmap!==Zm.POW2&&2===this.webGLVersion||t.isPowerOfTwo?t.mipmap>=1:0,e.wrapMode=2===this.webGLVersion||t.isPowerOfTwo?t.wrapMode:Jm.CLAMP,t.resource&&t.resource.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,e){var n=this.gl;if(e.mipmap&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var r=this.renderer.context.extensions.anisotropicFiltering;if(r&&t.anisotropicLevel>0&&t.scaleMode===Qm.LINEAR){var i=Math.min(t.anisotropicLevel,n.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode?n.LINEAR:n.NEAREST)},e}(Ag),u_=new Gy,c_=function(t){function e(n){var r;void 0===n&&(n={}),t.call(this,"WebGL",n),n=this.options,this.type=zm.WEBGL,this.gl=null,this.CONTEXT_UID=0,this.runners={destroy:new lg("destroy"),contextChange:new lg("contextChange",1),reset:new lg("reset"),update:new lg("update"),postrender:new lg("postrender"),prerender:new lg("prerender"),resize:new lg("resize",2)},this.globalUniforms=new Jg({projectionMatrix:new Gy},!0),this.addSystem(Gb,"mask").addSystem(rb,"context").addSystem(i_,"state").addSystem(Zb,"shader").addSystem(s_,"texture").addSystem(sb,"geometry").addSystem(ib,"framebuffer").addSystem(Hb,"scissor").addSystem(Wb,"stencil").addSystem(Kb,"projection").addSystem(o_,"textureGC").addSystem($g,"filter").addSystem(Yb,"renderTexture").addSystem(eb,"batch"),this.initPlugins(e.__plugins),n.context?this.context.initFromContext(n.context):this.context.initFromOptions({alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,powerPreference:this.options.powerPreference}),this.renderingToScreen=!0,r=2===this.context.webGLVersion?"WebGL 2":"WebGL 1",dy||(navigator.userAgent.toLowerCase().indexOf("chrome")>-1?window.console.log.apply(console,["\n %c %c %c PixiJS "+py+" - \u2730 "+r+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("PixiJS "+py+" - "+r+" - http://www.pixijs.com/"),dy=!0),this.resize(this.options.width,this.options.height)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.create=function(t){if(void 0===fy&&(fy=function(){var t={stencil:!0,failIfMajorPerformanceCaveat:oy.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),r=!(!n||!n.getContextAttributes().stencil);if(n){var i=n.getExtension("WEBGL_lose_context");i&&i.loseContext()}return n=null,r}catch(o){return!1}}()),fy)return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,e){e||(e=t.name);var n=new t(this);if(this[e])throw new Error('Whoops! The name "'+e+'" is already in use');for(var r in this[e]=n,this.runners)this.runners[r].add(n);return this},e.prototype.render=function(t,e,n,r,i){if(this.renderingToScreen=!e,this.runners.prerender.run(),this.emit("prerender"),this.projection.transform=r,!this.context.isLost){if(e||(this._lastObjectRendered=t),!i){var o=t.parent;t.parent=this._tempDisplayObjectParent,t.updateTransform(),t.parent=o}this.renderTexture.bind(e),this.batch.currentRenderer.start(),(void 0!==n?n:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),e&&e.baseTexture.update(),this.runners.postrender.run(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(e,n){t.prototype.resize.call(this,e,n),this.runners.resize.run(e,n)},e.prototype.reset=function(){return this.runners.reset.run(),this},e.prototype.clear=function(){this.framebuffer.bind(),this.framebuffer.clear()},e.prototype.destroy=function(e){for(var n in this.runners.destroy.run(),this.runners)this.runners[n].destroy();t.prototype.destroy.call(this,e),this.gl=null},e.registerPlugin=function(t,n){(e.__plugins=e.__plugins||{})[t]=n},e}(function(t){function e(e,n){t.call(this),(n=Object.assign({},oy.RENDER_OPTIONS,n)).roundPixels&&(oy.ROUND_PIXELS=n.roundPixels,Ly("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),this.options=n,this.type=zm.UNKNOWN,this.screen=new $y(0,0,n.width,n.height),this.view=n.view||document.createElement("canvas"),this.resolution=n.resolution||oy.RESOLUTION,this.transparent=n.transparent,this.autoDensity=n.autoDensity||n.autoResize||!1,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=n.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new sg,this._lastObjectRendered=this._tempDisplayObjectParent,this.plugins={}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={width:{configurable:!0},height:{configurable:!0},backgroundColor:{configurable:!0}};return e.prototype.initPlugins=function(t){for(var e in t)this.plugins[e]=new t[e](this)},n.width.get=function(){return this.view.width},n.height.get=function(){return this.view.height},e.prototype.resize=function(t,e){this.screen.width=t,this.screen.height=e,this.view.width=t*this.resolution,this.view.height=e*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=e+"px")},e.prototype.generateTexture=function(t,e,n,r){0===(r=r||t.getLocalBounds()).width&&(r.width=1),0===r.height&&(r.height=1);var i=Bg.create(0|r.width,0|r.height,e,n);return u_.tx=-r.x,u_.ty=-r.y,this.render(t,i,!1,u_,!!t.parent),i},e.prototype.destroy=function(t){for(var e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=zm.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoDensity=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},n.backgroundColor.get=function(){return this._backgroundColor},n.backgroundColor.set=function(t){this._backgroundColor=t,this._backgroundColorString=my(t),vy(t,this._backgroundColorRgba)},Object.defineProperties(e.prototype,n),e}(sy.a)),l_="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",h_=function(){this.texArray=null,this.blend=0,this.type=Wm.TRIANGLES,this.start=0,this.size=0,this.data=null},f_=function(){this.elements=[],this.ids=[],this.count=0};f_.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0};var d_=function(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)},p_={int8View:{configurable:!0},uint8View:{configurable:!0},int16View:{configurable:!0},uint16View:{configurable:!0},int32View:{configurable:!0}};p_.int8View.get=function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},p_.uint8View.get=function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},p_.int16View.get=function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},p_.uint16View.get=function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},p_.int32View.get=function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},d_.prototype.view=function(t){return this[t+"View"]},d_.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},d_.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},Object.defineProperties(d_.prototype,p_);var v_=function(t){function e(e){t.call(this,e),this.shaderGenerator=null,this.geometryClass=null,this.vertexSize=null,this.state=Rb.for2d(),this.size=4*oy.SPRITE_BATCH_SIZE,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contextChange=function(){var t=this.renderer.gl;oy.PREFER_ENV===Gm.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),oy.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var n=e.createShader(e.FRAGMENT_SHADER);;){var r=kb.replace(/%forloop%/gi,Sb(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,n=e._textureArrayPool,r=this.size/4,i=Math.floor(r/this.MAX_TEXTURES)+1;t.length<r;)t.push(new h_);for(;n.length<i;)n.push(new f_);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this._bufferedTextures,n=this.MAX_TEXTURES,r=e._textureArrayPool,i=this.renderer.batch,o=this._tempBoundTextures,a=this.renderer.textureGC.count,s=++Eg._globalBatch,u=0,c=r[0],l=0;i.copyBoundTextures(o,n);for(var h=0;h<this._bufferSize;++h){var f=t[h];t[h]=null,f._batchEnabled!==s&&(c.count>=n&&(i.boundArray(c,o,s,n),this.buildDrawCalls(c,l,h),l=h,c=r[++u],++s),f._batchEnabled=s,f.touched=a,c.elements[c.count++]=f)}c.count>0&&(i.boundArray(c,o,s,n),this.buildDrawCalls(c,l,this._bufferSize),++u,++s);for(var d=0;d<o.length;d++)o[d]=null;Eg._globalBatch=s},e.prototype.buildDrawCalls=function(t,n,r){var i=this._bufferedElements,o=this._attributeBuffer,a=this._indexBuffer,s=this.vertexSize,u=e._drawCallPool,c=this._dcIndex,l=this._aIndex,h=this._iIndex,f=u[c];f.start=this._iIndex,f.texArray=t;for(var d=n;d<r;++d){var p=i[d],v=gy[p._texture.baseTexture.alphaMode?1:0][p.blendMode];i[d]=null,n<d&&f.blend!==v&&(f.size=h-f.start,n=d,(f=u[++c]).texArray=t,f.start=h),this.packInterleavedGeometry(p,o,a,l,h),l+=p.vertexData.length/2*s,h+=p.indices.length,f.blend=v}n<r&&(f.size=h-f.start,++c),this._dcIndex=c,this._aIndex=l,this._iIndex=h},e.prototype.bindAndClearTexArray=function(t){for(var e=this.renderer.texture,n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this._packedGeometries,e=this._attributeBuffer,n=this._indexBuffer;oy.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,n=this.renderer,r=n.gl,i=n.state,o=e._drawCallPool,a=null,s=0;s<t;s++){var u=o[s],c=u.texArray,l=u.type,h=u.size,f=u.start,d=u.blend;a!==c&&(a=c,this.bindAndClearTexArray(c)),i.setBlendMode(d),r.drawElements(l,h,r.UNSIGNED_SHORT,2*f)}},e.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),oy.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),t.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var e=Cy(Math.ceil(t/8)),n=Sy(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new d_(r*this.vertexSize*4)),i},e.prototype.getIndexBuffer=function(t){var e=Cy(Math.ceil(t/12)),n=Sy(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i},e.prototype.packInterleavedGeometry=function(t,e,n,r,i){for(var o=e.uint32View,a=e.float32View,s=r/this.vertexSize,u=t.uvs,c=t.indices,l=t.vertexData,h=t._texture.baseTexture._batchLocation,f=Math.min(t.worldAlpha,1),d=f<1&&t._texture.baseTexture.alphaMode?_y(t._tintRGB,f):t._tintRGB+(255*f<<24),p=0;p<l.length;p+=2)a[r++]=l[p],a[r++]=l[p+1],a[r++]=u[p],a[r++]=u[p+1],o[r++]=d,a[r++]=h;for(var v=0;v<c.length;v++)n[i++]=s+c[v]},e}(tb);v_._drawCallPool=[],v_._textureArrayPool=[];var m_=function(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')};m_.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),n=0;n<t;n++)e[n]=n;this.defaultGroupCache[t]=Jg.from({uSamplers:e},!0);var r=this.fragTemplate;r=(r=r.replace(/%count%/gi,""+t)).replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ob(this.vertexSrc,r)}var i={tint:new Float32Array([1,1,1,1]),translationMatrix:new Gy,default:this.defaultGroupCache[t]};return new Db(this.programCache[t],i)},m_.prototype.generateSampleSrc=function(t){var e="";e+="\n",e+="\n";for(var n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+="if(vTextureId < "+n+".5)"),e+="\n{",e+="\n\tcolor = texture2D(uSamplers["+n+"], vTextureCoord);",e+="\n}";return(e+="\n")+"\n"};var y_=function(t){function e(e){void 0===e&&(e=!1),t.call(this),this._buffer=new jg(null,e,!1),this._indexBuffer=new jg(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Ym.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Ym.FLOAT).addAttribute("aColor",this._buffer,4,!0,Ym.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Ym.FLOAT).addIndex(this._indexBuffer)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Kg),g_="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",b_="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",__=function(){},w_={defaultVertexSrc:{configurable:!0},defaultFragmentTemplate:{configurable:!0}};__.create=function(t){var e=Object.assign({vertex:g_,fragment:b_,geometryClass:y_,vertexSize:6},t),n=e.vertex,r=e.fragment,i=e.vertexSize,o=e.geometryClass;return function(t){function e(e){t.call(this,e),this.shaderGenerator=new m_(n,r),this.geometryClass=o,this.vertexSize=i}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(v_)},w_.defaultVertexSrc.get=function(){return g_},w_.defaultFragmentTemplate.get=function(){return b_},Object.defineProperties(__,w_);var E_=__.create(),x_=new $y,T_=function(t){this.renderer=t,t.extract=this};T_.prototype.image=function(t,e,n){var r=new Image;return r.src=this.base64(t,e,n),r},T_.prototype.base64=function(t,e,n){return this.canvas(t).toDataURL(e,n)},T_.prototype.canvas=function(t){var e,n,r,i=this.renderer,o=!1,a=!1;t&&(t instanceof Bg?r=t:(r=this.renderer.generateTexture(t),a=!0)),r?(e=r.baseTexture.resolution,n=r.frame,o=!1,i.renderTexture.bind(r)):(e=this.renderer.resolution,o=!0,(n=x_).width=this.renderer.width,n.height=this.renderer.height,i.renderTexture.bind(null));var s=Math.floor(n.width*e+1e-4),u=Math.floor(n.height*e+1e-4),c=new Dy(s,u,1),l=new Uint8Array(4*s*u),h=i.gl;h.readPixels(n.x*e,n.y*e,s,u,h.RGBA,h.UNSIGNED_BYTE,l);var f=c.context.getImageData(0,0,s,u);return T_.arrayPostDivide(l,f.data),c.context.putImageData(f,0,0),o&&(c.context.scale(1,-1),c.context.drawImage(c.canvas,0,-u)),a&&r.destroy(!0),c.canvas},T_.prototype.pixels=function(t){var e,n,r,i=this.renderer,o=!1;t&&(t instanceof Bg?r=t:(r=this.renderer.generateTexture(t),o=!0)),r?(e=r.baseTexture.resolution,n=r.frame,i.renderTexture.bind(r)):(e=i.resolution,(n=x_).width=i.width,n.height=i.height,i.renderTexture.bind(null));var a=n.width*e,s=n.height*e,u=new Uint8Array(4*a*s),c=i.gl;return c.readPixels(n.x*e,n.y*e,a,s,c.RGBA,c.UNSIGNED_BYTE,u),o&&r.destroy(!0),T_.arrayPostDivide(u,u),u},T_.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},T_.arrayPostDivide=function(t,e){for(var n=0;n<t.length;n+=4){var r=e[n+3]=t[n+3];0!==r?(e[n]=Math.round(Math.min(255*t[n]/r,255)),e[n+1]=Math.round(Math.min(255*t[n+1]/r,255)),e[n+2]=Math.round(Math.min(255*t[n+2]/r,255))):(e[n]=t[n],e[n+1]=t[n+1],e[n+2]=t[n+2])}};var C_=function(){this.global=new Fy,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0},k_={pointerId:{configurable:!0}};k_.pointerId.get=function(){return this.identifier},C_.prototype.getLocalPosition=function(t,e,n){return t.worldTransform.applyInverse(n||this.global,e)},C_.prototype.copyEvent=function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=Number.isInteger(t.buttons)?t.buttons:t.which,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0},C_.prototype.reset=function(){this.isPrimary=!1},Object.defineProperties(C_.prototype,k_);var S_=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null};S_.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},S_.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null};var A_=function t(e){this._pointerId=e,this._flags=t.FLAGS.NONE},I_={pointerId:{configurable:!0},flags:{configurable:!0},none:{configurable:!0},over:{configurable:!0},rightDown:{configurable:!0},leftDown:{configurable:!0}};A_.prototype._doSet=function(t,e){this._flags=e?this._flags|t:this._flags&~t},I_.pointerId.get=function(){return this._pointerId},I_.flags.get=function(){return this._flags},I_.flags.set=function(t){this._flags=t},I_.none.get=function(){return this._flags===this.constructor.FLAGS.NONE},I_.over.get=function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},I_.over.set=function(t){this._doSet(this.constructor.FLAGS.OVER,t)},I_.rightDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},I_.rightDown.set=function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)},I_.leftDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},I_.leftDown.set=function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)},Object.defineProperties(A_.prototype,I_),A_.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});var O_=function(){this._tempPoint=new Fy};O_.prototype.recursiveFindHit=function(t,e,n,r,i){if(!e||!e.visible)return!1;var o=t.data.global,a=!1,s=i=e.interactive||i,u=!0;if(e.hitArea?(r&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(r=!1,u=!1)),s=!1):e._mask&&r&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(r=!1)),u&&e.interactiveChildren&&e.children)for(var c=e.children,l=c.length-1;l>=0;l--){var h=c[l],f=this.recursiveFindHit(t,h,n,r,s);if(f){if(!h.parent)continue;s=!1,f&&(t.target&&(r=!1),a=!0)}}return i&&(r&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),n&&n(t,e,!!a))),a},O_.prototype.findHit=function(t,e,n,r){this.recursiveFindHit(t,e,n,r,!1)},og.mixin({interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(t){t?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0});var P_=1,D_={target:null,data:{global:null}},N_=function(t){function e(e,n){t.call(this),n=n||{},this.renderer=e,this.autoPreventDefault=void 0===n.autoPreventDefault||n.autoPreventDefault,this.interactionFrequency=n.interactionFrequency||10,this.mouse=new C_,this.mouse.identifier=P_,this.mouse.global.set(-999999),this.activeInteractionData={},this.activeInteractionData[P_]=this.mouse,this.interactionDataPool=[],this.eventData=new S_,this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.mouseOverRenderer=!1,this.supportsTouchEvents="ontouchstart"in window,this.supportsPointerEvents=!!window.PointerEvent,this.onPointerUp=this.onPointerUp.bind(this),this.processPointerUp=this.processPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.processPointerCancel=this.processPointerCancel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.processPointerDown=this.processPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.processPointerMove=this.processPointerMove.bind(this),this.onPointerOut=this.onPointerOut.bind(this),this.processPointerOverOut=this.processPointerOverOut.bind(this),this.onPointerOver=this.onPointerOver.bind(this),this.cursorStyles={default:"inherit",pointer:"pointer"},this.currentCursorMode=null,this.cursor=null,this.resolution=1,this.delayedEvents=[],this.search=new O_,this.setTargetElement(this.renderer.view,this.renderer.resolution)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hitTest=function(t,e){return D_.target=null,D_.data.global=t,e||(e=this.renderer._lastObjectRendered),this.processInteractive(D_,e,null,!0),D_.target},e.prototype.setTargetElement=function(t,e){void 0===e&&(e=1),this.removeEvents(),this.interactionDOMElement=t,this.resolution=e,this.addEvents()},e.prototype.addEvents=function(){this.interactionDOMElement&&(fg.system.add(this.update,this,cg.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},e.prototype.removeEvents=function(){this.interactionDOMElement&&(fg.system.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},e.prototype.update=function(t){if(this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var n=this.activeInteractionData[e];if(n.originalEvent&&"touch"!==n.pointerType){var r=this.configureInteractionEventForDOMEvent(this.eventData,n.originalEvent,n);this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(this.currentCursorMode!==(t=t||"default")){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(typeof e){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,e,n){n.stopPropagationHint&&t!==n.stopsPropagatingAt||(n.currentTarget=t,n.type=e,t.emit(e,n),t[e]&&t[e](n))},e.prototype.delayDispatchEvent=function(t,e,n){this.delayedEvents.push({displayObject:t,eventString:e,eventData:n})},e.prototype.mapPositionToPoint=function(t,e,n){var r;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=1/this.resolution;t.x=this.interactionDOMElement.width/r.width*(e-r.left)*i,t.y=this.interactionDOMElement.height/r.height*(n-r.top)*i},e.prototype.processInteractive=function(t,e,n,r){var i=this.search.findHit(t,e,n,r),o=this.delayedEvents;if(!o.length)return i;t.stopPropagationHint=!1;var a=o.length;this.delayedEvents=[];for(var s=0;s<a;s++){var u=o[s],c=u.displayObject,l=u.eventString,h=u.eventData;h.stopsPropagatingAt===c&&(h.stopPropagationHint=!0),this.dispatchEvent(c,l,h)}return i},e.prototype.onPointerDown=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",a),"touch"===i.pointerType?this.emit("touchstart",a):"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit(2===i.button?"rightdown":"mousedown",this.eventData)}}},e.prototype.processPointerDown=function(t,e,n){var r=t.data,i=t.data.identifier;if(n)if(e.trackedPointers[i]||(e.trackedPointers[i]=new A_(i)),this.dispatchEvent(e,"pointerdown",t),"touch"===r.pointerType)this.dispatchEvent(e,"touchstart",t);else if("mouse"===r.pointerType||"pen"===r.pointerType){var o=2===r.button;o?e.trackedPointers[i].rightDown=!0:e.trackedPointers[i].leftDown=!0,this.dispatchEvent(e,o?"rightdown":"mousedown",t)}},e.prototype.onPointerComplete=function(t,e,n){for(var r=this.normalizeToPointerData(t),i=r.length,o=t.target!==this.interactionDOMElement?"outside":"",a=0;a<i;a++){var s=r[a],u=this.getInteractionDataForPointerId(s),c=this.configureInteractionEventForDOMEvent(this.eventData,s,u);c.data.originalEvent=t,this.processInteractive(c,this.renderer._lastObjectRendered,n,e||!o),this.emit(e?"pointercancel":"pointerup"+o,c),"mouse"===s.pointerType||"pen"===s.pointerType?this.emit(2===s.button?"rightup"+o:"mouseup"+o,c):"touch"===s.pointerType&&(this.emit(e?"touchcancel":"touchend"+o,c),this.releaseInteractionDataForPointerId(s.pointerId,u))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,e){var n=t.data,r=t.data.identifier;void 0!==e.trackedPointers[r]&&(delete e.trackedPointers[r],this.dispatchEvent(e,"pointercancel",t),"touch"===n.pointerType&&this.dispatchEvent(e,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,e,n){var r=t.data,i=t.data.identifier,o=e.trackedPointers[i],a="touch"===r.pointerType,s="mouse"===r.pointerType||"pen"===r.pointerType,u=!1;if(s){var c=2===r.button,l=A_.FLAGS,h=void 0!==o&&o.flags&(c?l.RIGHT_DOWN:l.LEFT_DOWN);n?(this.dispatchEvent(e,c?"rightup":"mouseup",t),h&&(this.dispatchEvent(e,c?"rightclick":"click",t),u=!0)):h&&this.dispatchEvent(e,c?"rightupoutside":"mouseupoutside",t),o&&(c?o.rightDown=!1:o.leftDown=!1)}n?(this.dispatchEvent(e,"pointerup",t),a&&this.dispatchEvent(e,"touchend",t),o&&(s&&!u||this.dispatchEvent(e,"pointertap",t),a&&(this.dispatchEvent(e,"tap",t),o.over=!1))):o&&(this.dispatchEvent(e,"pointerupoutside",t),a&&this.dispatchEvent(e,"touchendoutside",t)),o&&o.none&&delete e.trackedPointers[i]},e.prototype.onPointerMove=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"!==e[0].pointerType&&"pen"!==e[0].pointerType||(this.didMove=!0,this.cursor=null);for(var n=e.length,r=0;r<n;r++){var i=e[r],o=this.getInteractionDataForPointerId(i),a=this.configureInteractionEventForDOMEvent(this.eventData,i,o);a.data.originalEvent=t,this.processInteractive(a,this.renderer._lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",a),"touch"===i.pointerType&&this.emit("touchmove",a),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",a)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,e,n){var r=t.data,i="touch"===r.pointerType,o="mouse"===r.pointerType||"pen"===r.pointerType;o&&this.processPointerOverOut(t,e,n),this.moveWhenInside&&!n||(this.dispatchEvent(e,"pointermove",t),i&&this.dispatchEvent(e,"touchmove",t),o&&this.dispatchEvent(e,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,this.processInteractive(r,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",r),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",r):this.releaseInteractionDataForPointerId(n.identifier)}},e.prototype.processPointerOverOut=function(t,e,n){var r=t.data,i=t.data.identifier,o="mouse"===r.pointerType||"pen"===r.pointerType,a=e.trackedPointers[i];n&&!a&&(a=e.trackedPointers[i]=new A_(i)),void 0!==a&&(n&&this.mouseOverRenderer?(a.over||(a.over=!0,this.delayDispatchEvent(e,"pointerover",t),o&&this.delayDispatchEvent(e,"mouseover",t)),o&&null===this.cursor&&(this.cursor=e.cursor)):a.over&&(a.over=!1,this.dispatchEvent(e,"pointerout",this.eventData),o&&this.dispatchEvent(e,"mouseout",t),a.none&&delete e.trackedPointers[i]))},e.prototype.onPointerOver=function(t){var e=this.normalizeToPointerData(t)[0],n=this.getInteractionDataForPointerId(e),r=this.configureInteractionEventForDOMEvent(this.eventData,e,n);r.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",r),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",r)},e.prototype.getInteractionDataForPointerId=function(t){var e,n=t.pointerId;return n===P_||"mouse"===t.pointerType?e=this.mouse:this.activeInteractionData[n]?e=this.activeInteractionData[n]:((e=this.interactionDataPool.pop()||new C_).identifier=n,this.activeInteractionData[n]=e),e.copyEvent(t),e},e.prototype.releaseInteractionDataForPointerId=function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e.reset(),this.interactionDataPool.push(e))},e.prototype.configureInteractionEventForDOMEvent=function(t,e,n){return t.data=n,this.mapPositionToPoint(n.global,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=n.global.x,e.globalY=n.global.y),n.originalEvent=e,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,r=t.changedTouches.length;n<r;n++){var i=t.changedTouches[n];void 0===i.button&&(i.button=t.touches.length?1:0),void 0===i.buttons&&(i.buttons=t.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,e.push(i)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=P_),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0,e.push(t));return e},e.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e}(sy.a),R_={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function(t,e){if(void 0===e&&(e=20),!this.adaptive)return e;var n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}},M_=function(){this.reset()};M_.prototype.clone=function(){var t=new M_;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},M_.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=Mg.WHITE,this.matrix=null,this.visible=!1},M_.prototype.destroy=function(){this.texture=null,this.matrix=null};var L_={build:function(t){t.points=t.shape.points.slice()},triangulate:function(t,e){var n=t.points,r=t.holes,i=e.points,o=e.indices;if(n.length>=6){for(var a=[],s=0;s<r.length;s++){var u=r[s];a.push(n.length/2),n=n.concat(u.points)}var c=cy()(n,a,2);if(!c)return;for(var l=i.length/2,h=0;h<c.length;h+=3)o.push(c[h]+l),o.push(c[h+1]+l),o.push(c[h+2]+l);for(var f=0;f<n.length;f++)i.push(n[f])}}},B_={build:function(t){var e,n,r=t.shape,i=t.points,o=r.x,a=r.y;if(i.length=0,t.type===By.CIRC?(e=r.radius,n=r.radius):(e=r.width,n=r.height),0!==e&&0!==n){var s=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(r.width+r.height));s/=2.3;for(var u=2*Math.PI/s,c=0;c<s;c++)i.push(o+Math.sin(-u*c)*e,a+Math.cos(-u*c)*n);i.push(i[0],i[1])}},triangulate:function(t,e){var n=t.points,r=e.points,i=e.indices,o=r.length/2,a=o;r.push(t.shape.x,t.shape.y);for(var s=0;s<n.length;s+=2)r.push(n[s],n[s+1]),i.push(o++,a,o)}},F_={build:function(t){var e=t.shape,n=t.points,r=e.x,i=e.y,o=e.width,a=e.height,s=e.radius;n.length=0,V_(r,i+s,r,i,r+s,i,n),V_(r+o-s,i,r+o,i,r+o,i+s,n),V_(r+o,i+a-s,r+o,i+a,r+o-s,i+a,n),V_(r+s,i+a,r,i+a,r,i+a-s,n)},triangulate:function(t,e){for(var n=t.points,r=e.points,i=e.indices,o=r.length/2,a=cy()(n,null,2),s=0,u=a.length;s<u;s+=3)i.push(a[s]+o),i.push(a[s+1]+o),i.push(a[s+2]+o);for(var c=0,l=n.length;c<l;c++)r.push(n[c],n[++c])}};function U_(t,e,n){return t+(e-t)*n}function V_(t,e,n,r,i,o,a){void 0===a&&(a=[]);for(var s=a,u=0,c=0,l=0,h=0,f=0,d=0,p=0,v=0;p<=20;++p)u=U_(t,n,v=p/20),c=U_(e,r,v),l=U_(n,i,v),h=U_(r,o,v),f=U_(u,l,v),d=U_(c,h,v),s.push(f,d);return s}function j_(t,e){t.lineStyle.native?function(t,e){var n=0,r=t.shape,i=t.points||r.points,o=r.type!==By.POLY||r.closeStroke;if(0!==i.length){var a=e.points,s=e.indices,u=i.length/2,c=a.length/2,l=c;for(a.push(i[0],i[1]),n=1;n<u;n++)a.push(i[2*n],i[2*n+1]),s.push(l,l+1),l++;o&&s.push(l,c)}}(t,e):function(t,e){var n=t.shape,r=t.points||n.points.slice(),i=e.closePointEps;if(0!==r.length){var o=t.lineStyle,a=new Fy(r[0],r[1]),s=new Fy(r[r.length-2],r[r.length-1]),u=n.type!==By.POLY||n.closeStroke,c=Math.abs(a.x-s.x)<i&&Math.abs(a.y-s.y)<i;if(u){r=r.slice(),c&&(r.pop(),r.pop(),s.set(r[r.length-2],r[r.length-1]));var l=s.x+.5*(a.x-s.x),h=s.y+.5*(a.y-s.y);r.unshift(l,h),r.push(l,h)}var f=e.points,d=r.length/2,p=r.length,v=f.length/2,m=o.width/2,y=r[0],g=r[1],b=r[2],_=r[3],w=0,E=0,x=-(g-_),T=y-b,C=0,k=0,S=0,A=0,I=Math.sqrt(x*x+T*T);x/=I,T/=I;var O=o.alignment,P=2*(1-O),D=2*O;f.push(y-(x*=m)*P,g-(T*=m)*P),f.push(y+x*D,g+T*D);for(var N=1;N<d-1;++N){w=r[2*(N+1)],E=r[2*(N+1)+1],x=-((g=r[2*(N-1)+1])-(_=r[2*N+1])),T=(y=r[2*(N-1)])-(b=r[2*N]),x/=I=Math.sqrt(x*x+T*T),T/=I,x*=m,T*=m,C=-(_-E),k=b-w,C/=I=Math.sqrt(C*C+k*k),k/=I;var R=-T+g-(-T+_),M=-x+b-(-x+y),L=(-x+y)*(-T+_)-(-x+b)*(-T+g),B=-(k*=m)+E-(-k+_),F=-(C*=m)+b-(-C+w),U=(-C+w)*(-k+_)-(-C+b)*(-k+E),V=R*F-B*M;if(Math.abs(V)<.1)V+=10.1,f.push(b-x*P,_-T*P),f.push(b+x*D,_+T*D);else{var j=(M*U-F*L)/V,q=(B*L-R*U)/V;(j-b)*(j-b)+(q-_)*(q-_)>196*m*m?(S=x-C,A=T-k,S/=I=Math.sqrt(S*S+A*A),A/=I,f.push(b-(S*=m)*P,_-(A*=m)*P),f.push(b+S*D,_+A*D),f.push(b-S*D*P,_-A*P),p++):(f.push(b+(j-b)*P,_+(q-_)*P),f.push(b-(j-b)*D,_-(q-_)*D))}}x=-((g=r[2*(d-2)+1])-(_=r[2*(d-1)+1])),T=(y=r[2*(d-2)])-(b=r[2*(d-1)]),x/=I=Math.sqrt(x*x+T*T),T/=I,f.push(b-(x*=m)*P,_-(T*=m)*P),f.push(b+x*D,_+T*D);for(var G=e.indices,z=0;z<p-2;++z)G.push(v,v+1,v+2),v++}}(t,e)}var q_=function(t){function e(e,n,r,i,o,a){o=o||i/2;for(var s=-1*Math.PI/2+a,u=2*r,c=Vy/u,l=[],h=0;h<u;h++){var f=h%2?o:i,d=h*c+s;l.push(e+f*Math.cos(d),n+f*Math.sin(d))}t.call(this,l)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(ng),G_=function(){};G_.curveTo=function(t,e,n,r,i,o){var a=o[o.length-1]-e,s=o[o.length-2]-t,u=r-e,c=n-t,l=Math.abs(a*c-s*u);if(l<1e-8||0===i)return o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e),null;var h=a*a+s*s,f=u*u+c*c,d=a*u+s*c,p=i*Math.sqrt(h)/l,v=i*Math.sqrt(f)/l,m=p*d/h,y=v*d/f,g=p*c+v*s,b=p*u+v*a,_=c*(p+y),w=u*(p+y);return{cx:g+t,cy:b+e,radius:i,startAngle:Math.atan2(a*(v+m)-b,s*(v+m)-g),endAngle:Math.atan2(w-b,_-g),anticlockwise:s*u>c*a}},G_.arc=function(t,e,n,r,i,o,a,s,u){for(var c=a-o,l=R_._segmentsCount(Math.abs(c)*i,40*Math.ceil(Math.abs(c)/Vy)),h=c/(2*l),f=2*h,d=Math.cos(h),p=Math.sin(h),v=l-1,m=v%1/v,y=0;y<=v;++y){var g=h+o+f*(y+m*y),b=Math.cos(g),_=-Math.sin(g);u.push((d*b+p*_)*i+n,(d*-_+p*b)*i+r)}};var z_=function(){};z_.curveLength=function(t,e,n,r,i,o,a,s){for(var u=0,c=0,l=0,h=0,f=0,d=0,p=0,v=0,m=0,y=0,g=0,b=t,_=e,w=1;w<=10;++w)y=b-(v=(p=(d=(f=1-(c=w/10))*f)*f)*t+3*d*c*n+3*f*(l=c*c)*i+(h=l*c)*a),g=_-(m=p*e+3*d*c*r+3*f*l*o+h*s),b=v,_=m,u+=Math.sqrt(y*y+g*g);return u},z_.curveTo=function(t,e,n,r,i,o,a){var s=a[a.length-2],u=a[a.length-1];a.length-=2;var c=R_._segmentsCount(z_.curveLength(s,u,t,e,n,r,i,o)),l=0,h=0,f=0,d=0,p=0;a.push(s,u);for(var v=1,m=0;v<=c;++v)a.push((f=(h=(l=1-(m=v/c))*l)*l)*s+3*h*m*t+3*l*(d=m*m)*n+(p=d*m)*i,f*u+3*h*m*e+3*l*d*r+p*o)};var H_=function(){};H_.curveLength=function(t,e,n,r,i,o){var a=t-2*n+i,s=e-2*r+o,u=2*n-2*t,c=2*r-2*e,l=4*(a*a+s*s),h=4*(a*u+s*c),f=u*u+c*c,d=2*Math.sqrt(l+h+f),p=Math.sqrt(l),v=2*l*p,m=2*Math.sqrt(f),y=h/p;return(v*d+p*h*(d-m)+(4*f*l-h*h)*Math.log((2*p+y+d)/(y+m)))/(4*v)},H_.curveTo=function(t,e,n,r,i){for(var o=i[i.length-2],a=i[i.length-1],s=R_._segmentsCount(H_.curveLength(o,a,t,e,n,r)),u=0,c=0,l=1;l<=s;++l){var h=l/s;i.push((u=o+(t-o)*h)+(t+(n-t)*h-u)*h,(c=a+(e-a)*h)+(e+(r-e)*h-c)*h)}};var W_=function(){this.reset()};W_.prototype.begin=function(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n},W_.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},W_.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0};var K_={};K_[By.POLY]=L_,K_[By.CIRC]=B_,K_[By.ELIP]=B_,K_[By.RECT]={build:function(t){var e=t.shape,n=e.x,r=e.y,i=e.width,o=e.height,a=t.points;a.length=0,a.push(n,r,n+i,r,n+i,r+o,n,r+o)},triangulate:function(t,e){var n=t.points,r=e.points,i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},K_[By.RREC]=F_;var X_=[],Y_=[],Q_=function(t,e,n,r){void 0===e&&(e=null),void 0===n&&(n=null),void 0===r&&(r=null),this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type,this.points=[],this.holes=[]};Q_.prototype.clone=function(){return new Q_(this.shape,this.fillStyle,this.lineStyle,this.matrix)},Q_.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null};var J_=new Fy,Z_=new ig,$_=function(t){function e(){t.call(this),this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeIndex=0,this._bounds=new ig,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.uvsFloat32=null,this.closePointEps=1e-4}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={bounds:{configurable:!0}};return n.bounds.get=function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].textures.length=0,Y_.push(this.drawCalls[t]);this.drawCalls.length=0;for(var e=0;e<this.batches.length;e++){var n=this.batches[e];n.start=0,n.attribStart=0,n.style=null,X_.push(n)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,e,n,r){var i=new Q_(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this},e.prototype.drawHole=function(t,e){if(!this.graphicsData.length)return null;var n=new Q_(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e);for(var n=0;n<this.graphicsData.length;++n)this.graphicsData[n].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var e=this.graphicsData,n=0;n<e.length;++n){var r=e[n];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(t,J_):J_.copyFrom(t),r.shape.contains(J_.x,J_.y))){var i=!1;if(r.holes)for(var o=0;o<r.holes.length;o++)if(r.holes[o].shape.contains(J_.x,J_.y)){i=!0;break}if(!i)return!0}}return!1},e.prototype.updateBatches=function(){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var t=this.uvs,e=this.graphicsData,n=null,r=null;this.batches.length>0&&(r=(n=this.batches[this.batches.length-1]).style);for(var i=this.shapeIndex;i<e.length;i++){this.shapeIndex++;var o=e[i],a=o.fillStyle,s=o.lineStyle;K_[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix);for(var u=0;u<2;u++){var c=0===u?a:s;if(c.visible){var l=this.indices.length,h=this.points.length/2;c.texture.baseTexture.wrapMode=Jm.REPEAT,n&&!this._compareStyles(r,c)&&(n.end(l,h),n.size>0&&(n=null)),n||((n=X_.pop()||new W_).begin(c,l,h),this.batches.push(n),r=c);var f=this.points.length/2;0===u?this.processFill(o):this.processLine(o),this.addUvs(this.points,t,c.texture,f,this.points.length/2-f,c.matrix)}}}n?(n.end(this.indices.length,this.points.length/2),this.indicesUint16=new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()):this.batchable=!0}}else this.batchable=!0},e.prototype._compareStyles=function(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,e=this.graphicsData.length;t<e;t++){var n=this.graphicsData[t],r=n.fillStyle,i=n.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,e=0,n=t.length;e<n;e++)for(var r=t[e],i=0;i<r.size;i++){var o=r.start+i;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}},e.prototype.isBatchable=function(){for(var t=this.batches,n=0;n<t.length;n++)if(t[n].style.native)return!1;return this.points.length<2*e.BATCHABLE_SIZE},e.prototype.buildDrawCalls=function(){for(var t=++Eg._globalBatch,e=0;e<this.drawCalls.length;e++)this.drawCalls[e].textures.length=0,Y_.push(this.drawCalls[e]);this.drawCalls.length=0;var n=this.colors,r=this.textureIds,i=Y_.pop();i||((i=new h_).textures=new f_),i.textures.count=0,i.start=0,i.size=0,i.type=Wm.TRIANGLES;var o=0,a=null,s=0,u=!1,c=Wm.TRIANGLES,l=0;this.drawCalls.push(i);for(var h=0;h<this.batches.length;h++){var f=this.batches[h],d=f.style,p=d.texture.baseTexture;u!==!!d.native&&(c=(u=!!d.native)?Wm.LINES:Wm.TRIANGLES,a=null,o=8,t++),a!==p&&(a=p,p._batchEnabled!==t&&(8===o&&(t++,o=0,i.size>0&&((i=Y_.pop())||((i=new h_).textures=new f_),this.drawCalls.push(i)),i.start=l,i.size=0,i.textures.count=0,i.type=c),p.touched=1,p._batchEnabled=t,p._batchLocation=o,p.wrapMode=10497,i.textures.elements[i.textures.count++]=p,o++)),i.size+=f.size,l+=f.size,s=p._batchLocation,this.addColors(n,d.color,d.alpha,f.attribSize),this.addTextureIds(r,s,f.attribSize)}Eg._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,e=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*t.length*4),o=new Float32Array(i),a=new Uint32Array(i),s=0,u=0;u<t.length/2;u++)o[s++]=t[2*u],o[s++]=t[2*u+1],o[s++]=e[2*u],o[s++]=e[2*u+1],a[s++]=n[u],o[s++]=r[u];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){t.holes.length?(this.processHoles(t.holes),L_.triangulate(t,this)):K_[t.type].triangulate(t,this)},e.prototype.processLine=function(t){j_(t,this);for(var e=0;e<t.holes.length;e++)j_(t.holes[e],this)},e.prototype.processHoles=function(t){for(var e=0;e<t.length;e++){var n=t[e];K_[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,e=Z_,n=Gy.IDENTITY;this._bounds.clear(),e.clear();for(var r=0;r<this.graphicsData.length;r++){var i=this.graphicsData[r],o=i.shape,a=i.type,s=i.lineStyle,u=i.matrix||Gy.IDENTITY,c=0;if(s&&s.visible){var l=s.alignment;c=s.width,c*=a===By.POLY?.5+Math.abs(.5-l):Math.max(0,l)}n!==u&&(e.isEmpty()||(t.addBoundsMatrix(e,n),e.clear()),n=u),a===By.RECT||a===By.RREC?e.addFramePad(o.x,o.y,o.x+o.width,o.y+o.height,c,c):a===By.CIRC?e.addFramePad(o.x,o.y,o.x,o.y,o.radius+c,o.radius+c):a===By.ELIP?e.addFramePad(o.x,o.y,o.x,o.y,o.width+c,o.height+c):t.addVerticesMatrix(n,o.points,0,o.points.length,c,c)}e.isEmpty()||t.addBoundsMatrix(e,n),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,e){for(var n=0;n<t.length/2;n++){var r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}},e.prototype.addColors=function(t,e,n,r){for(var i=_y((e>>16)+(65280&e)+((255&e)<<16),n);r-- >0;)t.push(i)},e.prototype.addTextureIds=function(t,e,n){for(;n-- >0;)t.push(e)},e.prototype.addUvs=function(t,e,n,r,i,o){for(var a=0,s=e.length,u=n.frame;a<i;){var c=t[2*(r+a)],l=t[2*(r+a)+1];if(o){var h=o.a*c+o.c*l+o.tx;l=o.b*c+o.d*l+o.ty,c=h}a++,e.push(c/u.width,l/u.height)}var f=n.baseTexture;(u.width<f.width||u.height<f.height)&&this.adjustUvs(e,n,s,i)},e.prototype.adjustUvs=function(t,e,n,r){for(var i=e.baseTexture,o=n+2*r,a=e.frame,s=a.width/i.width,u=a.height/i.height,c=a.x/a.width,l=a.y/a.height,h=Math.floor(t[n]+1e-6),f=Math.floor(t[n+1]+1e-6),d=n+2;d<o;d+=2)h=Math.min(h,Math.floor(t[d]+1e-6)),f=Math.min(f,Math.floor(t[d+1]+1e-6));c-=h,l-=f;for(var p=n;p<o;p+=2)t[p]=(t[p]+c)*s,t[p+1]=(t[p+1]+l)*u},Object.defineProperties(e.prototype,n),e}(y_);$_.BATCHABLE_SIZE=100;var tw=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t},e.prototype.reset=function(){t.prototype.reset.call(this),this.color=0,this.width=0,this.alignment=.5,this.native=!1},e}(M_),ew=new Float32Array(3),nw={},rw=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.geometry=e||new $_,this.geometry.refCount++,this.shader=null,this.state=Rb.for2d(),this._fillStyle=new M_,this._lineStyle=new tw,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.vertexData=null,this._transformID=-1,this.batchDirty=-1,this.pluginName="batch",this.tint=16777215,this.blendMode=Hm.NORMAL}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={blendMode:{configurable:!0},tint:{configurable:!0},fill:{configurable:!0},line:{configurable:!0}};return e.prototype.clone=function(){return this.finishPoly(),new e(this.geometry)},n.blendMode.set=function(t){this.state.blendMode=t},n.blendMode.get=function(){return this.state.blendMode},n.tint.get=function(){return this._tint},n.tint.set=function(t){this._tint=t},n.fill.get=function(){return this._fillStyle},n.line.get=function(){return this._lineStyle},e.prototype.lineStyle=function(t){if("number"==typeof t){var e=arguments;t={width:e[0]||0,color:e[1]||0,alpha:void 0!==e[2]?e[2]:1,alignment:void 0!==e[3]?e[3]:.5,native:!!e[4]}}return this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){if("number"==typeof t){Ly("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3],o=arguments[4],a=arguments[5],s=arguments[6];t={width:e,texture:n,color:r,alpha:i,matrix:o,alignment:a,native:s},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({width:0,texture:Mg.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1},t),this.currentPath&&this.startPoly();var u=t.width>0&&t.alpha>0;return u?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:u},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ng,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ng,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this},e.prototype.lineTo=function(t,e){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points;return n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e),this},e.prototype._initCurve=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)},e.prototype.quadraticCurveTo=function(t,e,n,r){this._initCurve();var i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),H_.curveTo(t,e,n,r,i),this},e.prototype.bezierCurveTo=function(t,e,n,r,i,o){return this._initCurve(),z_.curveTo(t,e,n,r,i,o,this.currentPath.points),this},e.prototype.arcTo=function(t,e,n,r,i){this._initCurve(t,e);var o=G_.curveTo(t,e,n,r,i,this.currentPath.points);return o&&this.arc(o.cx,o.cy,o.radius,o.startAngle,o.endAngle,o.anticlockwise),this},e.prototype.arc=function(t,e,n,r,i,o){if(void 0===o&&(o=!1),r===i)return this;if(!o&&i<=r?i+=Vy:o&&r<=i&&(r+=Vy),0==i-r)return this;var a=t+Math.cos(r)*n,s=e+Math.sin(r)*n,u=this.geometry.closePointEps,c=this.currentPath?this.currentPath.points:null;if(c){var l=Math.abs(c[c.length-2]-a),h=Math.abs(c[c.length-1]-s);l<u&&h<u||c.push(a,s)}else this.moveTo(a,s),c=this.currentPath.points;return G_.arc(a,s,t,e,n,r,i,o,c),this},e.prototype.beginFill=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),this.beginTextureFill({texture:Mg.WHITE,color:t,alpha:e})},e.prototype.beginTextureFill=function(t){if(t instanceof Mg){Ly("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var e=arguments[0],n=arguments[1],r=arguments[2],i=arguments[3];t={texture:e,color:n,alpha:r,matrix:i},Object.keys(t).forEach((function(e){return void 0===t[e]&&delete t[e]}))}t=Object.assign({texture:Mg.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var o=t.alpha>0;return o?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:o},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,e,n,r){return this.drawShape(new $y(t,e,n,r))},e.prototype.drawRoundedRect=function(t,e,n,r,i){return this.drawShape(new rg(t,e,n,r,i))},e.prototype.drawCircle=function(t,e,n){return this.drawShape(new tg(t,e,n))},e.prototype.drawEllipse=function(t,e,n,r){return this.drawShape(new eg(t,e,n,r))},e.prototype.drawPolygon=function(t){var e=arguments,n=t,r=!0;if(n.points&&(r=n.closeStroke,n=n.points),!Array.isArray(n)){n=new Array(arguments.length);for(var i=0;i<n.length;++i)n[i]=e[i]}var o=new ng(n);return o.closeStroke=r,this.drawShape(o),this},e.prototype.drawShape=function(t){return this._holeMode?this.geometry.drawHole(t,this._matrix):this.geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.drawStar=function(t,e,n,r,i,o){return void 0===o&&(o=0),this.drawPolygon(new q_(t,e,n,r,i,o))},e.prototype.clear=function(){return this.geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){return 1===this.geometry.graphicsData.length&&this.geometry.graphicsData[0].shape.type===By.RECT&&!this.geometry.graphicsData[0].lineWidth},e.prototype._render=function(t){this.finishPoly();var e=this.geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this.geometry,e=this.blendMode;this.batches=[],this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.vertexData=new Float32Array(t.points);for(var n=0,r=t.batches.length;n<r;n++){var i=t.batches[n],o=i.style.color,a=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),s=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),u={vertexData:a,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:s,_batchRGB:vy(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[n]=u}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var e=0,n=this.batches.length;e<n;e++){var r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,t.plugins[this.pluginName].render(r)}}},e.prototype._renderDirect=function(t){var e=this._resolveDirectShader(t),n=this.geometry,r=this.tint,i=this.worldAlpha,o=e.uniforms,a=n.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(r>>16&255)/255*i,o.tint[1]=(r>>8&255)/255*i,o.tint[2]=(255&r)/255*i,o.tint[3]=i,t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(var s=0,u=a.length;s<u;s++)this._renderDrawCallDirect(t,n.drawCalls[s])},e.prototype._renderDrawCallDirect=function(t,e){for(var n=e.textures,r=e.type,i=e.size,o=e.start,a=n.count,s=0;s<a;s++)t.texture.bind(n.elements[s],s);t.geometry.draw(r,i,o)},e.prototype._resolveDirectShader=function(t){var e=this.shader,n=this.pluginName;if(!e){if(!nw[n]){for(var r=new Int32Array(16),i=0;i<16;i++)r[i]=i;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Gy,default:Jg.from({uSamplers:r},!0)};nw[n]=new Db(t.plugins[n]._shader.program,o)}e=nw[n]}return e},e.prototype._calculateBounds=function(){this.finishPoly();var t=this.geometry;if(t.graphicsData.length){var e=t.bounds;this._bounds.addFrame(this.transform,e.minX,e.minY,e.maxX,e.maxY)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this.geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=vy(this.tint,ew),e=0;e<this.batches.length;e++){var n=this.batches[e],r=n._batchRGB,i=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);n._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}},e.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID;for(var t=this.transform.worldTransform,e=t.a,n=t.b,r=t.c,i=t.d,o=t.tx,a=t.ty,s=this.geometry.points,u=this.vertexData,c=0,l=0;l<s.length;l+=2){var h=s[l],f=s[l+1];u[c++]=e*h+r*f+o,u[c++]=i*f+n*h+a}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this.geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,t.prototype.destroy.call(this,e)},Object.defineProperties(e.prototype,n),e}(sg);rw._TEMP_POINT=new Fy;var iw=new Fy,ow=new Uint16Array([0,1,2,0,2,3]),aw=function(t){function e(e){t.call(this),this._anchor=new Uy(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=Hm.NORMAL,this.shader=null,this._cachedTint=16777215,this.uvs=null,this.texture=e||Mg.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=ow,this.size=4,this.start=0,this.pluginName="batch",this.isSprite=!0,this._roundPixels=oy.ROUND_PIXELS}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={roundPixels:{configurable:!0},width:{configurable:!0},height:{configurable:!0},anchor:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ty(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ty(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==t._updateID){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,o=e.d,a=e.tx,s=e.ty,u=this.vertexData,c=t.trim,l=t.orig,h=this._anchor,f=0,d=0,p=0,v=0;if(c?(f=(d=c.x-h._x*l.width)+c.width,p=(v=c.y-h._y*l.height)+c.height):(f=(d=-h._x*l.width)+l.width,p=(v=-h._y*l.height)+l.height),u[0]=n*d+i*v+a,u[1]=o*v+r*d+s,u[2]=n*f+i*v+a,u[3]=o*v+r*f+s,u[4]=n*f+i*p+a,u[5]=o*p+r*f+s,u[6]=n*d+i*p+a,u[7]=o*p+r*d+s,this._roundPixels)for(var m=0;m<8;m++)u[m]=Math.round(u[m])}},e.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this.vertexTrimmedData,e=this._texture.orig,n=this._anchor,r=this.transform.worldTransform,i=r.a,o=r.b,a=r.c,s=r.d,u=r.tx,c=r.ty,l=-n._x*e.width,h=l+e.width,f=-n._y*e.height,d=f+e.height;t[0]=i*l+a*f+u,t[1]=s*f+o*l+c,t[2]=i*h+a*f+u,t[3]=s*f+o*h+c,t[4]=i*h+a*d+u,t[5]=s*d+o*h+c,t[6]=i*l+a*d+u,t[7]=s*d+o*l+c},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new $y),e=this._localBoundsRect),this._bounds.getRectangle(e)):t.prototype.getLocalBounds.call(this,e)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,iw);var e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x,i=0;return iw.x>=r&&iw.x<r+e&&iw.y>=(i=-n*this.anchor.y)&&iw.y<i+n},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof e?e:e&&e.texture)&&this._texture.destroy(!!("boolean"==typeof e?e:e&&e.baseTexture)),this._texture=null,this.shader=null},e.from=function(t,n){return new e(t instanceof Mg?t:Mg.from(t,n))},n.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},n.roundPixels.get=function(){return this._roundPixels},n.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width},n.width.set=function(t){var e=Ty(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},n.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height},n.height.set=function(t){var e=Ty(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},n.anchor.get=function(){return this._anchor},n.anchor.set=function(t){this._anchor.copyFrom(t)},n.tint.get=function(){return this._tint},n.tint.set=function(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)},n.texture.get=function(){return this._texture},n.texture.set=function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Mg.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},Object.defineProperties(e.prototype,n),e}(sg),sw={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:0,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},uw=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],cw=function(t){this.styleID=0,this.reset(),dw(this,t,t)},lw={align:{configurable:!0},breakWords:{configurable:!0},dropShadow:{configurable:!0},dropShadowAlpha:{configurable:!0},dropShadowAngle:{configurable:!0},dropShadowBlur:{configurable:!0},dropShadowColor:{configurable:!0},dropShadowDistance:{configurable:!0},fill:{configurable:!0},fillGradientType:{configurable:!0},fillGradientStops:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontStyle:{configurable:!0},fontVariant:{configurable:!0},fontWeight:{configurable:!0},letterSpacing:{configurable:!0},lineHeight:{configurable:!0},leading:{configurable:!0},lineJoin:{configurable:!0},miterLimit:{configurable:!0},padding:{configurable:!0},stroke:{configurable:!0},strokeThickness:{configurable:!0},textBaseline:{configurable:!0},trim:{configurable:!0},whiteSpace:{configurable:!0},wordWrap:{configurable:!0},wordWrapWidth:{configurable:!0}};function hw(t){return"number"==typeof t?my(t):("string"==typeof t&&0===t.indexOf("0x")&&(t=t.replace("0x","#")),t)}function fw(t){if(Array.isArray(t)){for(var e=0;e<t.length;++e)t[e]=hw(t[e]);return t}return hw(t)}function dw(t,e,n){for(var r in n)t[r]=Array.isArray(e[r])?e[r].slice():e[r]}cw.prototype.clone=function(){var t={};return dw(t,this,sw),new cw(t)},cw.prototype.reset=function(){dw(this,sw,sw)},lw.align.get=function(){return this._align},lw.align.set=function(t){this._align!==t&&(this._align=t,this.styleID++)},lw.breakWords.get=function(){return this._breakWords},lw.breakWords.set=function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},lw.dropShadow.get=function(){return this._dropShadow},lw.dropShadow.set=function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},lw.dropShadowAlpha.get=function(){return this._dropShadowAlpha},lw.dropShadowAlpha.set=function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},lw.dropShadowAngle.get=function(){return this._dropShadowAngle},lw.dropShadowAngle.set=function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},lw.dropShadowBlur.get=function(){return this._dropShadowBlur},lw.dropShadowBlur.set=function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},lw.dropShadowColor.get=function(){return this._dropShadowColor},lw.dropShadowColor.set=function(t){var e=fw(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},lw.dropShadowDistance.get=function(){return this._dropShadowDistance},lw.dropShadowDistance.set=function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},lw.fill.get=function(){return this._fill},lw.fill.set=function(t){var e=fw(t);this._fill!==e&&(this._fill=e,this.styleID++)},lw.fillGradientType.get=function(){return this._fillGradientType},lw.fillGradientType.set=function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},lw.fillGradientStops.get=function(){return this._fillGradientStops},lw.fillGradientStops.set=function(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},lw.fontFamily.get=function(){return this._fontFamily},lw.fontFamily.set=function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},lw.fontSize.get=function(){return this._fontSize},lw.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},lw.fontStyle.get=function(){return this._fontStyle},lw.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},lw.fontVariant.get=function(){return this._fontVariant},lw.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},lw.fontWeight.get=function(){return this._fontWeight},lw.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},lw.letterSpacing.get=function(){return this._letterSpacing},lw.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},lw.lineHeight.get=function(){return this._lineHeight},lw.lineHeight.set=function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},lw.leading.get=function(){return this._leading},lw.leading.set=function(t){this._leading!==t&&(this._leading=t,this.styleID++)},lw.lineJoin.get=function(){return this._lineJoin},lw.lineJoin.set=function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},lw.miterLimit.get=function(){return this._miterLimit},lw.miterLimit.set=function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},lw.padding.get=function(){return this._padding},lw.padding.set=function(t){this._padding!==t&&(this._padding=t,this.styleID++)},lw.stroke.get=function(){return this._stroke},lw.stroke.set=function(t){var e=fw(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},lw.strokeThickness.get=function(){return this._strokeThickness},lw.strokeThickness.set=function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},lw.textBaseline.get=function(){return this._textBaseline},lw.textBaseline.set=function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},lw.trim.get=function(){return this._trim},lw.trim.set=function(t){this._trim!==t&&(this._trim=t,this.styleID++)},lw.whiteSpace.get=function(){return this._whiteSpace},lw.whiteSpace.set=function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},lw.wordWrap.get=function(){return this._wordWrap},lw.wordWrap.set=function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},lw.wordWrapWidth.get=function(){return this._wordWrapWidth},lw.wordWrapWidth.set=function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},cw.prototype.toFontString=function(){var t="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var n=e.length-1;n>=0;n--){var r=e[n].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&uw.indexOf(r)<0&&(r='"'+r+'"'),e[n]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},Object.defineProperties(cw.prototype,lw);var pw=function(t,e,n,r,i,o,a,s,u){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=s,this.fontProperties=u};pw.measureText=function(t,e,n,r){void 0===r&&(r=pw._canvas),n=null==n?e.wordWrap:n;var i=e.toFontString(),o=pw.measureFont(i);0===o.fontSize&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);var a=r.getContext("2d");a.font=i;for(var s=(n?pw.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),u=new Array(s.length),c=0,l=0;l<s.length;l++){var h=a.measureText(s[l]).width+(s[l].length-1)*e.letterSpacing;u[l]=h,c=Math.max(c,h)}var f=c+e.strokeThickness;e.dropShadow&&(f+=e.dropShadowDistance);var d=e.lineHeight||o.fontSize+e.strokeThickness,p=Math.max(d,o.fontSize+e.strokeThickness)+(s.length-1)*(d+e.leading);return e.dropShadow&&(p+=e.dropShadowDistance),new pw(t,e,f,p,s,u,d+e.leading,c,o)},pw.wordWrap=function(t,e,n){void 0===n&&(n=pw._canvas);for(var r=n.getContext("2d"),i=0,o="",a="",s={},u=e.letterSpacing,c=e.whiteSpace,l=pw.collapseSpaces(c),h=pw.collapseNewlines(c),f=!l,d=e.wordWrapWidth+u,p=pw.tokenize(t),v=0;v<p.length;v++){var m=p[v];if(pw.isNewline(m)){if(!h){a+=pw.addLine(o),f=!l,o="",i=0;continue}m=" "}if(l){var y=pw.isBreakingSpace(m),g=pw.isBreakingSpace(o[o.length-1]);if(y&&g)continue}var b=pw.getFromCache(m,u,s,r);if(b>d)if(""!==o&&(a+=pw.addLine(o),o="",i=0),pw.canBreakWords(m,e.breakWords))for(var _=m.split(""),w=0;w<_.length;w++){for(var E=_[w],x=1;_[w+x];){var T=_[w+x];if(pw.canBreakChars(E[E.length-1],T,m,w,e.breakWords))break;E+=T,x++}w+=E.length-1;var C=pw.getFromCache(E,u,s,r);C+i>d&&(a+=pw.addLine(o),f=!1,o="",i=0),o+=E,i+=C}else o.length>0&&(a+=pw.addLine(o),o="",i=0),a+=pw.addLine(m,!(v===p.length-1)),f=!1,o="",i=0;else b+i>d&&(f=!1,a+=pw.addLine(o),o="",i=0),(o.length>0||!pw.isBreakingSpace(m)||f)&&(o+=m,i+=b)}return a+pw.addLine(o,!1)},pw.addLine=function(t,e){return void 0===e&&(e=!0),t=pw.trimRight(t),e?t+"\n":t},pw.getFromCache=function(t,e,n,r){var i=n[t];if(void 0===i){var o=t.length*e;i=r.measureText(t).width+o,n[t]=i}return i},pw.collapseSpaces=function(t){return"normal"===t||"pre-line"===t},pw.collapseNewlines=function(t){return"normal"===t},pw.trimRight=function(t){if("string"!=typeof t)return"";for(var e=t.length-1;e>=0&&pw.isBreakingSpace(t[e]);e--)t=t.slice(0,-1);return t},pw.isNewline=function(t){return"string"==typeof t&&pw._newlines.indexOf(t.charCodeAt(0))>=0},pw.isBreakingSpace=function(t){return"string"==typeof t&&pw._breakingSpaces.indexOf(t.charCodeAt(0))>=0},pw.tokenize=function(t){var e=[],n="";if("string"!=typeof t)return e;for(var r=0;r<t.length;r++){var i=t[r];pw.isBreakingSpace(i)||pw.isNewline(i)?(""!==n&&(e.push(n),n=""),e.push(i)):n+=i}return""!==n&&e.push(n),e},pw.canBreakWords=function(t,e){return e},pw.canBreakChars=function(t,e,n,r,i){return!0},pw.measureFont=function(t){if(pw._fonts[t])return pw._fonts[t];var e={},n=pw._canvas,r=pw._context;r.font=t;var i=pw.METRICS_STRING+pw.BASELINE_SYMBOL,o=Math.ceil(r.measureText(i).width),a=Math.ceil(r.measureText(pw.BASELINE_SYMBOL).width),s=2*a;a=a*pw.BASELINE_MULTIPLIER|0,n.width=o,n.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,a);var u=r.getImageData(0,0,o,s).data,c=u.length,l=4*o,h=0,f=0,d=!1;for(h=0;h<a;++h){for(var p=0;p<l;p+=4)if(255!==u[f+p]){d=!0;break}if(d)break;f+=l}for(e.ascent=a-h,f=c-l,d=!1,h=s;h>a;--h){for(var v=0;v<l;v+=4)if(255!==u[f+v]){d=!0;break}if(d)break;f-=l}return e.descent=h-a,e.fontSize=e.ascent+e.descent,pw._fonts[t]=e,e},pw.clearMetrics=function(t){void 0===t&&(t=""),t?delete pw._fonts[t]:pw._fonts={}};var vw=function(){try{var t=new OffscreenCanvas(0,0);return t.getContext("2d")?t:document.createElement("canvas")}catch(e){return document.createElement("canvas")}}();vw.width=vw.height=10,pw._canvas=vw,pw._context=vw.getContext("2d"),pw._fonts={},pw.METRICS_STRING="|\xc9q\xc5",pw.BASELINE_SYMBOL="M",pw.BASELINE_MULTIPLIER=1.4,pw._newlines=[10,13],pw._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var mw={texture:!0,children:!1,baseTexture:!0},yw=function(t){function e(e,n,r){(r=r||document.createElement("canvas")).width=3,r.height=3;var i=Mg.from(r);i.orig=new $y,i.trim=new $y,t.call(this,i),this.canvas=r,this.context=this.canvas.getContext("2d"),this._resolution=oy.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=n,this.localStyleID=-1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return e.prototype.updateText=function(t){var e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){this._font=this._style.toFontString();var n,r,i=this.context,o=pw.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),a=o.height,s=o.lines,u=o.lineHeight,c=o.lineWidths,l=o.maxLineWidth,h=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,o.width)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,a)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;for(var f=e.dropShadow?2:1,d=0;d<f;++d){var p=e.dropShadow&&0===d,v=p?2*a:0,m=v*this.resolution;if(p){i.fillStyle="black",i.strokeStyle="black";var y=e.dropShadowColor,g=vy("number"==typeof y?y:yy(y));i.shadowColor="rgba("+255*g[0]+","+255*g[1]+","+255*g[2]+","+e.dropShadowAlpha+")",i.shadowBlur=e.dropShadowBlur,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*e.dropShadowDistance,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*e.dropShadowDistance+m}else i.fillStyle=this._generateFillStyle(e,s),i.strokeStyle=e.stroke,i.shadowColor=0,i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;for(var b=0;b<s.length;b++)n=e.strokeThickness/2,r=e.strokeThickness/2+b*u+h.ascent,"right"===e.align?n+=l-c[b]:"center"===e.align&&(n+=(l-c[b])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(s[b],n+e.padding,r+e.padding-v,!0),e.fill&&this.drawLetterSpacing(s[b],n+e.padding,r+e.padding-v)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,e,n,r){void 0===r&&(r=!1);var i=this._style.letterSpacing;if(0!==i)for(var o=e,a=Array.from?Array.from(t):t.split(""),s=this.context.measureText(t).width,u=0,c=0;c<a.length;++c){var l=a[c];r?this.context.strokeText(l,o,n):this.context.fillText(l,o,n),o+=s-(u=this.context.measureText(t.substring(c+1)).width)+i,s=u}else r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n)},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var e=function(t){var e,n,r,i=t.width,o=t.height,a=t.getContext("2d"),s=a.getImageData(0,0,i,o).data,u=s.length,c={top:null,left:null,right:null,bottom:null},l=null;for(e=0;e<u;e+=4)0!==s[e+3]&&(n=e/4%i,r=~~(e/4/i),null===c.top&&(c.top=r),null===c.left?c.left=n:n<c.left&&(c.left=n),null===c.right?c.right=n+1:c.right<n&&(c.right=n+1),null===c.bottom?c.bottom=r:c.bottom<r&&(c.bottom=r));return null!==c.top&&(l=a.getImageData(c.left,c.top,i=c.right-c.left,o=c.bottom-c.top+1)),{height:o,width:i,data:l}}(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}var n=this._texture,r=this._style,i=r.trim?0:r.padding,o=n.baseTexture;n.trim.width=n._frame.width=Math.ceil(t.width/this._resolution),n.trim.height=n._frame.height=Math.ceil(t.height/this._resolution),n.trim.x=-i,n.trim.y=-i,n.orig.width=n._frame.width-2*i,n.orig.height=n._frame.height-2*i,this._onTextureUpdate(),o.setRealSize(t.width,t.height,this._resolution),this.dirty=!1},e.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,e)},e.prototype.getLocalBounds=function(e){return this.updateText(!0),t.prototype.getLocalBounds.call(this,e)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._onStyleChange=function(){this.dirty=!0},e.prototype._generateFillStyle=function(t,e){if(!Array.isArray(t.fill))return t.fill;if(1===t.fill.length)return t.fill[0];var n,r,i,o=Math.ceil(this.canvas.width/this._resolution),a=Math.ceil(this.canvas.height/this._resolution),s=t.fill.slice(),u=t.fillGradientStops.slice();if(!u.length)for(var c=s.length+1,l=1;l<c;++l)u.push(l/c);if(s.unshift(t.fill[0]),u.unshift(0),s.push(t.fill[t.fill.length-1]),u.push(1),0===t.fillGradientType){n=this.context.createLinearGradient(o/2,0,o/2,a),r=(s.length+1)*e.length,i=0;for(var h=0;h<e.length;h++){i+=1;for(var f=0;f<s.length;f++)n.addColorStop("number"==typeof u[f]?u[f]/e.length+h/e.length:i/r,s[f]),i++}}else{n=this.context.createLinearGradient(0,a/2,o,a/2),r=s.length+1,i=1;for(var d=0;d<s.length;d++)n.addColorStop("number"==typeof u[d]?u[d]:i/r,s[d]),i++}return n},e.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},mw,e),t.prototype.destroy.call(this,e),this.context=null,this.canvas=null,this._style=null},n.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},n.width.set=function(t){this.updateText(!0);var e=Ty(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t},n.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},n.height.set=function(t){this.updateText(!0);var e=Ty(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t},n.style.get=function(){return this._style},n.style.set=function(t){this._style=(t=t||{})instanceof cw?t:new cw(t),this.localStyleID=-1,this.dirty=!0},n.text.get=function(){return this._text},n.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},n.resolution.get=function(){return this._resolution},n.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},Object.defineProperties(e.prototype,n),e}(aw);oy.UPLOADS_PER_FRAME=4;var gw=function(t){this.maxItemsPerFrame=t,this.itemsLeft=0};gw.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},gw.prototype.allowedToUpload=function(){return this.itemsLeft-- >0};var bw=function(t){var e=this;this.limiter=new gw(oy.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(Cw),this.registerFindHook(kw),this.registerFindHook(_w),this.registerFindHook(ww),this.registerFindHook(Ew),this.registerUploadHook(xw),this.registerUploadHook(Tw)};function _w(t,e){var n=!1;if(t&&t._textures&&t._textures.length)for(var r=0;r<t._textures.length;r++)if(t._textures[r]instanceof Mg){var i=t._textures[r].baseTexture;-1===e.indexOf(i)&&(e.push(i),n=!0)}return n}function ww(t,e){if(t.baseTexture instanceof Eg){var n=t.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function Ew(t,e){if(t._texture&&t._texture instanceof Mg){var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function xw(t,e){return e instanceof yw&&(e.updateText(!0),!0)}function Tw(t,e){if(e instanceof cw){var n=e.toFontString();return pw.measureFont(n),!0}return!1}function Cw(t,e){if(t instanceof yw){-1===e.indexOf(t.style)&&e.push(t.style),-1===e.indexOf(t)&&e.push(t);var n=t._texture.baseTexture;return-1===e.indexOf(n)&&e.push(n),!0}return!1}function kw(t,e){return t instanceof cw&&(-1===e.indexOf(t)&&e.push(t),!0)}bw.prototype.upload=function(t,e){"function"==typeof t&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,fg.system.addOnce(this.tick,this,cg.UTILITY))):e&&e()},bw.prototype.tick=function(){setTimeout(this.delayedTick,0)},bw.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed)for(var n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)fg.system.addOnce(this.tick,this,cg.UTILITY);else{this.ticking=!1;var i=this.completes.slice(0);this.completes.length=0;for(var o=0,a=i.length;o<a;o++)i[o]()}},bw.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},bw.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},bw.prototype.add=function(t){for(var e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof sg)for(var r=t.children.length-1;r>=0;r--)this.add(t.children[r]);return this},bw.prototype.destroy=function(){this.ticking&&fg.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var Sw=function(t){function e(e){t.call(this,e),this.uploadHookHelper=this.renderer,this.registerFindHook(Ow),this.registerUploadHook(Aw),this.registerUploadHook(Iw)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(bw);function Aw(t,e){return e instanceof Eg&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Iw(t,e){if(!(e instanceof rw))return!1;var n=e.geometry;e.finishPoly(),n.updateBatches();for(var r=n.batches,i=0;i<r.length;i++){var o=r[i].style.texture;o&&Aw(t,o.baseTexture)}return n.batchable||t.geometry.bind(n,e._resolveDirectShader()),!0}function Ow(t,e){return t instanceof rw&&(e.push(t),!0)}var Pw=function(t){this.maxMilliseconds=t,this.frameStart=0};Pw.prototype.beginFrame=function(){this.frameStart=Date.now()},Pw.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds};var Dw=function t(e){var n=this;e=Object.assign({forceCanvas:!1},e),this.renderer=function(t){return c_.create(t)}(e),this.stage=new sg,t._plugins.forEach((function(t){t.init.call(n,e)}))},Nw={view:{configurable:!0},screen:{configurable:!0}};Dw.registerPlugin=function(t){Dw._plugins.push(t)},Dw.prototype.render=function(){this.renderer.render(this.stage)},Nw.view.get=function(){return this.renderer.view},Nw.screen.get=function(){return this.renderer.screen},Dw.prototype.destroy=function(t,e){var n=this,r=Dw._plugins.slice(0);r.reverse(),r.forEach((function(t){t.destroy.call(n)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null,this._options=null},Object.defineProperties(Dw.prototype,Nw),Dw._plugins=[];var Rw=function(){};Rw.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(t){window.removeEventListener("resize",this.resize),this._resizeTo=t,t&&(window.addEventListener("resize",this.resize),this.resize())},get:function(){return this._resizeTo}}),this.resize=function(){e._resizeTo&&(e._resizeTo===window?e.renderer.resize(window.innerWidth,window.innerHeight):e.renderer.resize(e._resizeTo.clientWidth,e._resizeTo.clientHeight))},this._resizeTo=null,this.resizeTo=t.resizeTo||null},Rw.destroy=function(){this.resizeTo=null,this.resize=null},Dw.registerPlugin(Rw);var Mw=n("u62O"),Lw=n.n(Mw),Bw=n("1eSL"),Fw=n.n(Bw);function Uw(){}function Vw(t,e,n,r){var i=0,o=t.length;!function a(s){s||i===o?n&&n(s):r?setTimeout((function(){e(t[i++],a)}),1):e(t[i++],a)}()}function jw(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}var qw={};function Gw(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function zw(t,e,n){return e&&Gw(t.prototype,e),n&&Gw(t,n),t}var Hw=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),Ww=null;function Kw(){}var Xw=function(){function t(e,n,r){if("string"!=typeof e||"string"!=typeof n)throw new Error("Both name and url are required for constructing a resource.");r=r||{},this._flags=0,this._setFlag(t.STATUS_FLAGS.DATA_URL,0===n.indexOf("data:")),this.name=e,this.url=n,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===r.crossOrigin?"anonymous":r.crossOrigin,this.timeout=r.timeout||0,this.loadType=r.loadType||this._determineLoadType(),this.xhrType=r.xhrType,this.metadata=r.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=t.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Kw,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Fw.a,this.onProgress=new Fw.a,this.onComplete=new Fw.a,this.onAfterMiddleware=new Fw.a}t.setExtensionLoadType=function(e,n){Yw(t._loadTypeMap,e,n)},t.setExtensionXhrType=function(e,n){Yw(t._xhrTypeMap,e,n)};var e=t.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=t.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var n=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout((function(){return e(n)}),1);else switch(e&&this.onComplete.once(e),this._setFlag(t.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case t.LOAD_TYPE.IMAGE:this.type=t.TYPE.IMAGE,this._loadElement("image");break;case t.LOAD_TYPE.AUDIO:this.type=t.TYPE.AUDIO,this._loadSourceElement("audio");break;case t.LOAD_TYPE.VIDEO:this.type=t.TYPE.VIDEO,this._loadSourceElement("video");break;case t.LOAD_TYPE.XHR:default:Hw&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(t){return 0!=(this._flags&t)},e._setFlag=function(t,e){this._flags=e?this._flags|t:this._flags&~t},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(t.STATUS_FLAGS.COMPLETE,!0),this._setFlag(t.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(t){this.data=this.metadata.loadElement?this.metadata.loadElement:"image"===t&&void 0!==window.Image?new Image:document.createElement(t),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(t){if(this.data=this.metadata.loadElement?this.metadata.loadElement:"audio"===t&&void 0!==window.Audio?new Audio:document.createElement(t),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var e=this.metadata.mimeType,n=0;n<this.url.length;++n)this.data.appendChild(this._createSource(t,this.url[n],Array.isArray(e)?e[n]:e));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+t)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,e.responseType=this.xhrType===t.XHR_RESPONSE_TYPE.JSON||this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT?t.XHR_RESPONSE_TYPE.TEXT:this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XDomainRequest;t.timeout=this.timeout||5e3,t.onerror=this._boundXhrOnError,t.ontimeout=this._boundXhrOnTimeout,t.onprogress=this._boundOnProgress,t.onload=this._boundXhrOnLoad,t.open("GET",this.url,!0),setTimeout((function(){return t.send()}),1)},e._createSource=function(t,e,n){n||(n=t+"/"+this._getExtension(e));var r=document.createElement("source");return r.src=e,r.type=n,r},e._onError=function(t){this.abort("Failed to load element using: "+t.target.nodeName)},e._onProgress=function(t){t&&t.lengthComputable&&this.onProgress.dispatch(this,t.loaded/t.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var t=this.xhr;this.abort(Qw(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')},e._xhrOnTimeout=function(){this.abort(Qw(this.xhr)+" Request timed out.")},e._xhrOnAbort=function(){this.abort(Qw(this.xhr)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e=this.xhr,n="",r=void 0===e.status?200:e.status;if(""!==e.responseType&&"text"!==e.responseType&&void 0!==e.responseType||(n=e.responseText),0===r&&(n.length>0||e.responseType===t.XHR_RESPONSE_TYPE.BUFFER)?r=200:1223===r&&(r=204),2==(r/100|0)){if(this.xhrType===t.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=t.TYPE.TEXT;else if(this.xhrType===t.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=t.TYPE.JSON}catch(a){return void this.abort("Error trying to parse loaded json: "+a)}else if(this.xhrType===t.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(n,"text/xml")}else{var o=document.createElement("div");o.innerHTML=n,this.data=o}this.type=t.TYPE.XML}catch(a){return void this.abort("Error trying to parse loaded xml: "+a)}else this.data=e.response||n;this.complete()}else this.abort("["+e.status+"] "+e.statusText+": "+e.responseURL)},e._determineCrossOrigin=function(t,e){return 0===t.indexOf("data:")?"":window.origin!==window.location.origin?"anonymous":(e=e||window.location,Ww||(Ww=document.createElement("a")),Ww.href=t,(t=Lw()(Ww.href,{strictMode:!0})).host!==e.hostname||(t.port||""!==e.port)&&t.port!==e.port||(t.protocol?t.protocol+":":"")!==e.protocol?"anonymous":"")},e._determineXhrType=function(){return t._xhrTypeMap[this.extension]||t.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return t._loadTypeMap[this.extension]||t.LOAD_TYPE.XHR},e._getExtension=function(){var t=this.url,e="";if(this.isDataUrl){var n=t.indexOf("/");e=t.substring(n+1,t.indexOf(";",n))}else{var r=t.indexOf("?"),i=t.indexOf("#"),o=Math.min(r>-1?r:t.length,i>-1?i:t.length);e=(t=t.substring(0,o)).substring(t.lastIndexOf(".")+1)}return e.toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case t.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case t.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case t.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case t.XHR_RESPONSE_TYPE.JSON:return"application/json";case t.XHR_RESPONSE_TYPE.DEFAULT:case t.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},zw(t,[{key:"isDataUrl",get:function(){return this._hasFlag(t.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(t.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(t.STATUS_FLAGS.LOADING)}}]),t}();function Yw(t,e,n){e&&0===e.indexOf(".")&&(e=e.substring(1)),e&&(t[e]=n)}function Qw(t){return t.toString().replace("object ","")}Xw.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Xw.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Xw.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Xw.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Xw._loadTypeMap={gif:Xw.LOAD_TYPE.IMAGE,png:Xw.LOAD_TYPE.IMAGE,bmp:Xw.LOAD_TYPE.IMAGE,jpg:Xw.LOAD_TYPE.IMAGE,jpeg:Xw.LOAD_TYPE.IMAGE,tif:Xw.LOAD_TYPE.IMAGE,tiff:Xw.LOAD_TYPE.IMAGE,webp:Xw.LOAD_TYPE.IMAGE,tga:Xw.LOAD_TYPE.IMAGE,svg:Xw.LOAD_TYPE.IMAGE,"svg+xml":Xw.LOAD_TYPE.IMAGE,mp3:Xw.LOAD_TYPE.AUDIO,ogg:Xw.LOAD_TYPE.AUDIO,wav:Xw.LOAD_TYPE.AUDIO,mp4:Xw.LOAD_TYPE.VIDEO,webm:Xw.LOAD_TYPE.VIDEO},Xw._xhrTypeMap={xhtml:Xw.XHR_RESPONSE_TYPE.DOCUMENT,html:Xw.XHR_RESPONSE_TYPE.DOCUMENT,htm:Xw.XHR_RESPONSE_TYPE.DOCUMENT,xml:Xw.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Xw.XHR_RESPONSE_TYPE.DOCUMENT,svg:Xw.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Xw.XHR_RESPONSE_TYPE.DOCUMENT,gif:Xw.XHR_RESPONSE_TYPE.BLOB,png:Xw.XHR_RESPONSE_TYPE.BLOB,bmp:Xw.XHR_RESPONSE_TYPE.BLOB,jpg:Xw.XHR_RESPONSE_TYPE.BLOB,jpeg:Xw.XHR_RESPONSE_TYPE.BLOB,tif:Xw.XHR_RESPONSE_TYPE.BLOB,tiff:Xw.XHR_RESPONSE_TYPE.BLOB,webp:Xw.XHR_RESPONSE_TYPE.BLOB,tga:Xw.XHR_RESPONSE_TYPE.BLOB,json:Xw.XHR_RESPONSE_TYPE.JSON,text:Xw.XHR_RESPONSE_TYPE.TEXT,txt:Xw.XHR_RESPONSE_TYPE.TEXT,ttf:Xw.XHR_RESPONSE_TYPE.BUFFER,otf:Xw.XHR_RESPONSE_TYPE.BUFFER},Xw.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var Jw=window.URL||window.webkitURL,Zw={caching:function(t,e){var n=this;qw[t.url]?(t.data=qw[t.url],t.complete()):t.onComplete.once((function(){return qw[n.url]=n.data})),e()},parsing:function(t,e){if(t.data){if(t.xhr&&t.xhrType===Xw.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof t.data){if(0===t.data.type.indexOf("image")){var n=Jw.createObjectURL(t.data);return t.blob=t.data,t.data=new Image,t.data.src=n,t.type=Xw.TYPE.IMAGE,void(t.data.onload=function(){Jw.revokeObjectURL(n),t.data.onload=null,e()})}}else{var r=t.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return t.data=new Image,t.data.src="data:"+r+";base64,"+function(t){for(var e="",n=0;n<t.length;){for(var r=[0,0,0],i=[0,0,0,0],o=0;o<r.length;++o)r[o]=n<t.length?255&t.charCodeAt(n++):0;switch(i[0]=r[0]>>2,i[1]=(3&r[0])<<4|r[1]>>4,i[2]=(15&r[1])<<2|r[2]>>6,i[3]=63&r[2],n-(t.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(var a=0;a<i.length;++a)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i[a])}return e}(t.xhr.responseText),t.type=Xw.TYPE.IMAGE,void(t.data.onload=function(){t.data.onload=null,e()})}e()}else e()}},$w=/(#[\w-]+)?$/,tE=function(){function t(e,n){var r=this;void 0===e&&(e=""),void 0===n&&(n=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(t,e){return r._loadResource(t,e)},this._queue=function(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var n=0,r={_tasks:[],concurrency:e,saturated:Uw,unsaturated:Uw,buffer:e/4,empty:Uw,drain:Uw,error:Uw,started:!1,paused:!1,push:function(t,e){i(t,!1,e)},kill:function(){n=0,r.drain=Uw,r.started=!1,r._tasks=[]},unshift:function(t,e){i(t,!0,e)},process:function(){for(;!r.paused&&n<r.concurrency&&r._tasks.length;){var e=r._tasks.shift();0===r._tasks.length&&r.empty(),(n+=1)===r.concurrency&&r.saturated(),t(e.data,jw(o(e)))}},length:function(){return r._tasks.length},running:function(){return n},idle:function(){return r._tasks.length+n===0},pause:function(){!0!==r.paused&&(r.paused=!0)},resume:function(){if(!1!==r.paused){r.paused=!1;for(var t=1;t<=r.concurrency;t++)r.process()}}};function i(t,e,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(r.started=!0,null==t&&r.idle())setTimeout((function(){return r.drain()}),1);else{var i={data:t,callback:"function"==typeof n?n:Uw};e?r._tasks.unshift(i):r._tasks.push(i),setTimeout((function(){return r.process()}),1)}}function o(t){return function(){n-=1,t.callback.apply(t,arguments),null!=arguments[0]&&r.error(arguments[0],t.data),n<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}(this._boundLoadResource,n),this._queue.pause(),this.resources={},this.onProgress=new Fw.a,this.onError=new Fw.a,this.onLoad=new Fw.a,this.onStart=new Fw.a,this.onComplete=new Fw.a;for(var i=0;i<t._defaultBeforeMiddleware.length;++i)this.pre(t._defaultBeforeMiddleware[i]);for(var o=0;o<t._defaultAfterMiddleware.length;++o)this.use(t._defaultAfterMiddleware[o])}var e=t.prototype;return e.add=function(t,e,n,r){if(Array.isArray(t)){for(var i=0;i<t.length;++i)this.add(t[i]);return this}if("object"==typeof t&&(r=e||t.callback||t.onComplete,n=t,e=t.url,t=t.name||t.key||t.url),"string"!=typeof e&&(r=n,n=e,e=t),"string"!=typeof e)throw new Error("No url passed to add resource to loader.");if("function"==typeof n&&(r=n,n=null),this.loading&&(!n||!n.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[t])throw new Error('Resource named "'+t+'" already exists.');if(e=this._prepareUrl(e),this.resources[t]=new Xw(t,e,n),"function"==typeof r&&this.resources[t].onAfterMiddleware.once(r),this.loading){for(var o=n.parentResource,a=[],s=0;s<o.children.length;++s)o.children[s].isComplete||a.push(o.children[s]);var u=o.progressChunk*(a.length+1)/(a.length+2);o.children.push(this.resources[t]),o.progressChunk=u;for(var c=0;c<a.length;++c)a[c].progressChunk=u;this.resources[t].progressChunk=u}return this._queue.push(this.resources[t]),this},e.pre=function(t){return this._beforeMiddleware.push(t),this},e.use=function(t){return this._afterMiddleware.push(t),this},e.reset=function(){for(var t in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var e=this.resources[t];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(t){if("function"==typeof t&&this.onComplete.once(t),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var e=100/this._queue._tasks.length,n=0;n<this._queue._tasks.length;++n)this._queue._tasks[n].data.progressChunk=e;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(t){var e,n=Lw()(t,{strictMode:!0});if(e=n.protocol||!n.path||0===t.indexOf("//")?t:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==t.charAt(0)?this.baseUrl+"/"+t:this.baseUrl+t,this.defaultQueryString){var r=$w.exec(e)[0];-1!==(e=e.substr(0,e.length-r.length)).indexOf("?")?e+="&"+this.defaultQueryString:e+="?"+this.defaultQueryString,e+=r}return e},e._loadResource=function(t,e){var n=this;t._dequeue=e,Vw(this._beforeMiddleware,(function(e,r){e.call(n,t,(function(){r(t.isComplete?{}:null)}))}),(function(){t.isComplete?n._onLoad(t):(t._onLoadBinding=t.onComplete.once(n._onLoad,n),t.load())}),!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(t){var e=this;t._onLoadBinding=null,this._resourcesParsing.push(t),t._dequeue(),Vw(this._afterMiddleware,(function(n,r){n.call(e,t,r)}),(function(){t.onAfterMiddleware.dispatch(t),e.progress=Math.min(100,e.progress+t.progressChunk),e.onProgress.dispatch(e,t),t.error?e.onError.dispatch(t.error,e,t):e.onLoad.dispatch(e,t),e._resourcesParsing.splice(e._resourcesParsing.indexOf(t),1),e._queue.idle()&&0===e._resourcesParsing.length&&e._onComplete()}),!0)},zw(t,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(t){this._queue.concurrency=t}}]),t}();tE._defaultBeforeMiddleware=[],tE._defaultAfterMiddleware=[],tE.pre=function(t){return tE._defaultBeforeMiddleware.push(t),tE},tE.use=function(t){return tE._defaultAfterMiddleware.push(t),tE};var eE=function(){};eE.use=function(t,e){t.data&&t.type===Xw.TYPE.IMAGE&&(t.texture=Mg.fromLoader(t.data,t.url,t.name)),e()};var nE=function(t){function e(n,r){var i=this;t.call(this,n,r),sy.a.call(this);for(var o=0;o<e._plugins.length;++o){var a=e._plugins[o],s=a.pre,u=a.use;s&&this.pre(s),u&&this.use(u)}this.onStart.add((function(t){return i.emit("start",t)})),this.onProgress.add((function(t,e){return i.emit("progress",t,e)})),this.onError.add((function(t,e,n){return i.emit("error",t,e,n)})),this.onLoad.add((function(t,e){return i.emit("load",t,e)})),this.onComplete.add((function(t,e){return i.emit("complete",t,e)})),this._protected=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={shared:{configurable:!0}};return e.prototype.destroy=function(){this._protected||(this.removeAllListeners(),this.reset())},n.shared.get=function(){var t=e._shared;return t||((t=new e)._protected=!0,e._shared=t),t},Object.defineProperties(e,n),e}(tE);Object.assign(nE.prototype,sy.a.prototype),nE._plugins=[],nE.registerPlugin=function(t){return nE._plugins.push(t),t.add&&t.add(),nE},nE.registerPlugin({use:Zw.parsing}),nE.registerPlugin(eE);var rE=function(){};rE.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?nE.shared:new nE},rE.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)};var iE=Xw,oE=function(t,e,n){this.geometry=new Kg,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<t.length;++r){var i=t[r];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||Ym.FLOAT,offset:i.offset},e[r]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()};oE.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new jg(function(t,e){void 0===e&&(e=null);var n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+n);for(var r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var n=0;n<this.dynamicProperties.length;++n){var r=this.dynamicProperties[n];r.offset=e,e+=r.size,this.dynamicStride+=r.size}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new jg(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(var a=0;a<this.staticProperties.length;++a){var s=this.staticProperties[a];s.offset=o,o+=s.size,this.staticStride+=s.size}var u=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(u),this.staticDataUint32=new Uint32Array(u),this.staticBuffer=new jg(this.staticData,!0,!1);for(var c=0;c<this.dynamicProperties.length;++c){var l=this.dynamicProperties[c];t.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===Ym.UNSIGNED_BYTE,l.type,4*this.dynamicStride,4*l.offset)}for(var h=0;h<this.staticProperties.length;++h){var f=this.staticProperties[h];t.addAttribute(f.attributeName,this.staticBuffer,0,f.type===Ym.UNSIGNED_BYTE,f.type,4*this.staticStride,4*f.offset)}},oE.prototype.uploadDynamic=function(t,e,n){for(var r=0;r<this.dynamicProperties.length;r++){var i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.type===Ym.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++},oE.prototype.uploadStatic=function(t,e,n){for(var r=0;r<this.staticProperties.length;r++){var i=this.staticProperties[r];i.uploadFunction(t,e,n,i.type===Ym.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++},oE.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()};var aE="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n",sE="varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",uE=function(t){function e(e){t.call(this,e),this.shader=null,this.properties=null,this.tempMatrix=new Gy,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Ym.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Db.from(aE,sE,{})}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(t){var e=t.children,n=t._maxSize,r=t._batchSize,i=this.renderer,o=e.length;if(0!==o){o>n&&!t.autoResize&&(o=n);var a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));var s=e[0]._texture.baseTexture;this.renderer.state.setBlendMode(by(t.blendMode,s.alphaMode));var u,c,l,h,f=i.gl,d=t.worldTransform.copyTo(this.tempMatrix);d.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=(u=t.tintRgb,c=t.worldAlpha,h=s.alphaMode,l=(l=this.shader.uniforms.uColor)||new Float32Array(4),h||void 0===h?(l[0]=u[0]*c,l[1]=u[1]*c,l[2]=u[2]*c):(l[0]=u[0],l[1]=u[1],l[2]=u[2]),l[3]=c,l),this.shader.uniforms.uSampler=s,this.renderer.shader.bind(this.shader);for(var p=!1,v=0,m=0;v<o;v+=r,m+=1){var y=o-v;y>r&&(y=r),m>=a.length&&a.push(this._generateOneMoreBuffer(t));var g=a[m];g.uploadDynamic(e,v,y),(p=p||g._updateID<(t._bufferUpdateIDs[m]||0))&&(g._updateID=t._updateID,g.uploadStatic(e,v,y)),i.geometry.bind(g.geometry),f.drawElements(f.TRIANGLES,6*y,f.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var e=[],n=t._maxSize,r=t._batchSize,i=t._properties,o=0;o<n;o+=r)e.push(new oE(this.properties,i,r));return e},e.prototype._generateOneMoreBuffer=function(t){return new oE(this.properties,t._properties,t._batchSize)},e.prototype.uploadVertices=function(t,e,n,r,i,o){for(var a=0,s=0,u=0,c=0,l=0;l<n;++l){var h=t[e+l],f=h._texture,d=h.scale.x,p=h.scale.y,v=f.trim,m=f.orig;v?(a=(s=v.x-h.anchor.x*m.width)+v.width,u=(c=v.y-h.anchor.y*m.height)+v.height):(a=m.width*(1-h.anchor.x),s=m.width*-h.anchor.x,u=m.height*(1-h.anchor.y),c=m.height*-h.anchor.y),r[o]=s*d,r[o+1]=c*p,r[o+i]=a*d,r[o+i+1]=c*p,r[o+2*i]=a*d,r[o+2*i+1]=u*p,r[o+3*i]=s*d,r[o+3*i+1]=u*p,o+=4*i}},e.prototype.uploadPosition=function(t,e,n,r,i,o){for(var a=0;a<n;a++){var s=t[e+a].position;r[o]=s.x,r[o+1]=s.y,r[o+i]=s.x,r[o+i+1]=s.y,r[o+2*i]=s.x,r[o+2*i+1]=s.y,r[o+3*i]=s.x,r[o+3*i+1]=s.y,o+=4*i}},e.prototype.uploadRotation=function(t,e,n,r,i,o){for(var a=0;a<n;a++){var s=t[e+a].rotation;r[o]=s,r[o+i]=s,r[o+2*i]=s,r[o+3*i]=s,o+=4*i}},e.prototype.uploadUvs=function(t,e,n,r,i,o){for(var a=0;a<n;++a){var s=t[e+a]._texture._uvs;s?(r[o]=s.x0,r[o+1]=s.y0,r[o+i]=s.x1,r[o+i+1]=s.y1,r[o+2*i]=s.x2,r[o+2*i+1]=s.y2,r[o+3*i]=s.x3,r[o+3*i+1]=s.y3,o+=4*i):(r[o]=0,r[o+1]=0,r[o+i]=0,r[o+i+1]=0,r[o+2*i]=0,r[o+2*i+1]=0,r[o+3*i]=0,r[o+3*i+1]=0,o+=4*i)}},e.prototype.uploadTint=function(t,e,n,r,i,o){for(var a=0;a<n;++a){var s=t[e+a],u=s.alpha,c=u<1&&s._texture.baseTexture.alphaMode>0?_y(s._tintRGB,u):s._tintRGB+(255*u<<24);r[o]=c,r[o+i]=c,r[o+2*i]=c,r[o+3*i]=c,o+=4*i}},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e}(tb),cE=function(t,e,n){void 0===n&&(n=null),this.baseTexture=t,this.textures={},this.animations={},this.data=e,this.resolution=this._updateResolution(n||(this.baseTexture.resource?this.baseTexture.resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null},lE={BATCH_SIZE:{configurable:!0}};lE.BATCH_SIZE.get=function(){return 1e3},cE.prototype._updateResolution=function(t){var e=this.data.meta.scale,n=Ry(t,null);return null===n&&(n=void 0!==e?parseFloat(e):1),1!==n&&this.baseTexture.setResolution(n),n},cE.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=cE.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},cE.prototype._processFrames=function(t){for(var e=t,n=cE.BATCH_SIZE;e-t<n&&e<this._frameKeys.length;){var r=this._frameKeys[e],i=this._frames[r],o=i.frame;if(o){var a,s=null,u=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,c=new $y(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);a=i.rotated?new $y(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):new $y(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(s=new $y(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new Mg(this.baseTexture,a,c,s,i.rotated?2:0,i.anchor),Mg.addToCache(this.textures[r],r)}e++}},cE.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var n=0;n<t[e].length;n++)this.animations[e].push(this.textures[t[e][n]])}},cE.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},cE.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*cE.BATCH_SIZE),this._batchIndex++,setTimeout((function(){t._batchIndex*cE.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())}),0)},cE.prototype.destroy=function(t){for(var e in void 0===t&&(t=!1),this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&this.baseTexture.destroy(),this.baseTexture=null},Object.defineProperties(cE,lE);var hE=function(){};hE.use=function(t,e){var n=t.name+"_image";if(t.data&&t.type===iE.TYPE.JSON&&t.data.frames&&!this.resources[n]){var r={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},i=hE.getResourcePath(t,this.baseUrl);this.add(n,i,r,(function(n){if(n.error)e(n.error);else{var r=new cE(n.texture.baseTexture,t.data,t.url);r.parse((function(){t.spritesheet=r,t.textures=r.textures,e()}))}}))}else e()},hE.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:hy.a.resolve(t.url.replace(e,""),t.data.meta.image)},new Fy;var fE="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",dE="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord - floor(vTextureCoord - uClampOffset);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",pE="varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",vE=new Gy,mE=function(t){function e(e){t.call(this,e);var n={globals:this.renderer.globalUniforms};this.shader=Db.from(fE,dE,n),this.simpleShader=Db.from(fE,pE,n),this.quad=new Yg}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(t){var e=this.renderer,n=this.quad,r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&((r=n.uvs)[0]=r[6]=-t.anchor.x,r[1]=r[3]=-t.anchor.y,r[2]=r[4]=1-t.anchor.x,r[5]=r[7]=1-t.anchor.y),n.invalidate();var i=t._texture,o=i.baseTexture,a=t.tileTransform.localTransform,s=t.uvMatrix,u=o.isPowerOfTwo&&i.frame.width===o.width&&i.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==Jm.CLAMP:o.wrapMode===Jm.CLAMP&&(o.wrapMode=Jm.REPEAT));var c,l,h,f,d=u?this.simpleShader:this.shader,p=i.width,v=i.height,m=t._width,y=t._height;vE.set(a.a*p/m,a.b*p/y,a.c*v/m,a.d*v/y,a.tx/m,a.ty/y),vE.invert(),u?vE.prepend(s.mapCoord):(d.uniforms.uMapCoord=s.mapCoord.toArray(!0),d.uniforms.uClampFrame=s.uClampFrame,d.uniforms.uClampOffset=s.uClampOffset),d.uniforms.uTransform=vE.toArray(!0),d.uniforms.uColor=(c=t.tint,l=t.worldAlpha,f=o.alphaMode,(h=(h=d.uniforms.uColor)||new Float32Array(4))[0]=(c>>16&255)/255,h[1]=(c>>8&255)/255,h[2]=(255&c)/255,(f||void 0===f)&&(h[0]*=l,h[1]*=l,h[2]*=l),h[3]=l,h),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=i,e.shader.bind(d),e.geometry.bind(n),e.state.setBlendMode(by(t.blendMode,o.alphaMode)),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e}(tb),yE=function(t){function e(e,n){var r=this;void 0===n&&(n={}),t.call(this),this._textWidth=0,this._textHeight=0,this._glyphs=[],this._font={tint:void 0!==n.tint?n.tint:16777215,align:n.align||"left",name:null,size:0},this.font=n.font,this._text=e,this._maxWidth=0,this._maxLineHeight=0,this._letterSpacing=0,this._anchor=new Uy((function(){r.dirty=!0}),this,0,0),this.dirty=!1,this.roundPixels=oy.ROUND_PIXELS,this.updateText()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={tint:{configurable:!0},align:{configurable:!0},anchor:{configurable:!0},font:{configurable:!0},text:{configurable:!0},maxWidth:{configurable:!0},maxLineHeight:{configurable:!0},textWidth:{configurable:!0},letterSpacing:{configurable:!0},textHeight:{configurable:!0}};return e.prototype.updateText=function(){for(var t=e.fonts[this._font.name],n=this._font.size/t.size,r=new Fy,i=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",s=a.length,u=this._maxWidth*t.size/this._font.size,c=null,l=0,h=0,f=0,d=-1,p=0,v=0,m=0,y=0;y<s;y++){var g=a.charCodeAt(y),b=a.charAt(y);if(/(?:\s)/.test(b)&&(d=y,p=l),"\r"!==b&&"\n"!==b){var _=t.chars[g];_&&(c&&_.kerning[c]&&(r.x+=_.kerning[c]),i.push({texture:_.texture,line:f,charCode:g,position:new Fy(r.x+_.xOffset+this._letterSpacing/2,r.y+_.yOffset)}),r.x+=_.xAdvance+this._letterSpacing,l=r.x,m=Math.max(m,_.yOffset+_.texture.height),c=g,-1!==d&&u>0&&r.x>u&&(wy(i,1+d-++v,1+y-d),y=d,d=-1,o.push(p),h=Math.max(h,p),f++,r.x=0,r.y+=t.lineHeight,c=null))}else o.push(l),h=Math.max(h,l),++f,++v,r.x=0,r.y+=t.lineHeight,c=null}var w=a.charAt(a.length-1);"\r"!==w&&"\n"!==w&&(/(?:\s)/.test(w)&&(l=p),o.push(l),h=Math.max(h,l));for(var E=[],x=0;x<=f;x++){var T=0;"right"===this._font.align?T=h-o[x]:"center"===this._font.align&&(T=(h-o[x])/2),E.push(T)}for(var C=i.length,k=this.tint,S=0;S<C;S++){var A=this._glyphs[S];A?A.texture=i[S].texture:((A=new aw(i[S].texture)).roundPixels=this.roundPixels,this._glyphs.push(A)),A.position.x=(i[S].position.x+E[i[S].line])*n,A.position.y=i[S].position.y*n,A.scale.x=A.scale.y=n,A.tint=k,A.parent||this.addChild(A)}for(var I=C;I<this._glyphs.length;++I)this.removeChild(this._glyphs[I]);if(this._textWidth=h*n,this._textHeight=(r.y+t.lineHeight)*n,0!==this.anchor.x||0!==this.anchor.y)for(var O=0;O<C;O++)this._glyphs[O].x-=this._textWidth*this.anchor.x,this._glyphs[O].y-=this._textHeight*this.anchor.y;this._maxLineHeight=m*n},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},n.tint.get=function(){return this._font.tint},n.tint.set=function(t){this._font.tint="number"==typeof t&&t>=0?t:16777215,this.dirty=!0},n.align.get=function(){return this._font.align},n.align.set=function(t){this._font.align=t||"left",this.dirty=!0},n.anchor.get=function(){return this._anchor},n.anchor.set=function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},n.font.get=function(){return this._font},n.font.set=function(t){t&&("string"==typeof t?(t=t.split(" "),this._font.name=1===t.length?t[0]:t.slice(1).join(" "),this._font.size=t.length>=2?parseInt(t[0],10):e.fonts[this._font.name].size):(this._font.name=t.name,this._font.size="number"==typeof t.size?t.size:parseInt(t.size,10)),this.dirty=!0)},n.text.get=function(){return this._text},n.text.set=function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},n.maxWidth.get=function(){return this._maxWidth},n.maxWidth.set=function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},n.maxLineHeight.get=function(){return this.validate(),this._maxLineHeight},n.textWidth.get=function(){return this.validate(),this._textWidth},n.letterSpacing.get=function(){return this._letterSpacing},n.letterSpacing.set=function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},n.textHeight.get=function(){return this.validate(),this._textHeight},e.registerFont=function(t,n){var r={},i=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0],a=t.getElementsByTagName("page"),s=Ry(a[0].getAttribute("file"),oy.RESOLUTION),u={};r.font=i.getAttribute("face"),r.size=parseInt(i.getAttribute("size"),10),r.lineHeight=parseInt(o.getAttribute("lineHeight"),10)/s,r.chars={},n instanceof Mg&&(n=[n]);for(var c=0;c<a.length;c++){var l=a[c].getAttribute("id"),h=a[c].getAttribute("file");u[l]=n instanceof Array?n[c]:n[h]}for(var f=t.getElementsByTagName("char"),d=0;d<f.length;d++){var p=f[d],v=parseInt(p.getAttribute("id"),10),m=p.getAttribute("page")||0,y=new $y(parseInt(p.getAttribute("x"),10)/s+u[m].frame.x/s,parseInt(p.getAttribute("y"),10)/s+u[m].frame.y/s,parseInt(p.getAttribute("width"),10)/s,parseInt(p.getAttribute("height"),10)/s);r.chars[v]={xOffset:parseInt(p.getAttribute("xoffset"),10)/s,yOffset:parseInt(p.getAttribute("yoffset"),10)/s,xAdvance:parseInt(p.getAttribute("xadvance"),10)/s,kerning:{},texture:new Mg(u[m].baseTexture,y),page:m}}for(var g=t.getElementsByTagName("kerning"),b=0;b<g.length;b++){var _=g[b],w=parseInt(_.getAttribute("first"),10)/s,E=parseInt(_.getAttribute("second"),10)/s,x=parseInt(_.getAttribute("amount"),10)/s;r.chars[E]&&(r.chars[E].kerning[w]=x)}return e.fonts[r.font]=r,r},Object.defineProperties(e.prototype,n),e}(sg);yE.fonts={};var gE=function(){};gE.parse=function(t,e){t.bitmapFont=yE.registerFont(t.data,e)},gE.add=function(){iE.setExtensionXhrType("fnt",iE.XHR_RESPONSE_TYPE.DOCUMENT)},gE.dirname=function(t){var e=t.replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},gE.use=function(t,e){if(t.data&&t.type===iE.TYPE.XML)if(0!==t.data.getElementsByTagName("page").length&&0!==t.data.getElementsByTagName("info").length&&null!==t.data.getElementsByTagName("info")[0].getAttribute("face")){var n=t.isDataUrl?"":gE.dirname(t.url);t.isDataUrl&&("."===n&&(n=""),this.baseUrl&&n&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(n+="/")),(n=n.replace(this.baseUrl,""))&&"/"!==n.charAt(n.length-1)&&(n+="/");for(var r=t.data.getElementsByTagName("page"),i={},o=function(n){i[n.metadata.pageFile]=n.texture,Object.keys(i).length===r.length&&(gE.parse(t,i),e())},a=0;a<r.length;++a){var s=r[a].getAttribute("file"),u=n+s,c=!1;for(var l in this.resources){var h=this.resources[l];if(h.url===u){h.metadata.pageFile=s,h.texture?o(h):h.onAfterMiddleware.add(o),c=!0;break}}if(!c){var f={crossOrigin:t.crossOrigin,loadType:iE.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:s},t.metadata.imageMetadata),parentResource:t};this.add(u,f,o)}}}else e();else e()},["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");var bE="varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",_E=function(t){function e(){var e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};t.call(this,l_,bE,e),this.alpha=1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={matrix:{configurable:!0},alpha:{configurable:!0}};return e.prototype._loadMatrix=function(t,e){void 0===e&&(e=!1);var n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t},e.prototype._colorMatrix=function(t){var e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},e.prototype.brightness=function(t,e){this._loadMatrix([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e)},e.prototype.greyscale=function(t,e){this._loadMatrix([t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0],e)},e.prototype.blackAndWhite=function(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)},e.prototype.hue=function(t,e){t=(t||0)/180*Math.PI;var n=Math.cos(t),r=Math.sin(t),i=1/3,o=(0,Math.sqrt)(i);this._loadMatrix([n+(1-n)*i,i*(1-n)-o*r,i*(1-n)+o*r,0,0,i*(1-n)+o*r,n+i*(1-n),i*(1-n)-o*r,0,0,i*(1-n)-o*r,i*(1-n)+o*r,n+i*(1-n),0,0,0,0,0,1,0],e)},e.prototype.contrast=function(t,e){var n=(t||0)+1,r=-.5*(n-1);this._loadMatrix([n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0],e)},e.prototype.saturate=function(t,e){void 0===t&&(t=0);var n=2*t/3+1,r=-.5*(n-1);this._loadMatrix([n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0],e)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)},e.prototype.sepia=function(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)},e.prototype.technicolor=function(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)},e.prototype.polaroid=function(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)},e.prototype.toBGR=function(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)},e.prototype.kodachrome=function(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)},e.prototype.browni=function(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)},e.prototype.vintage=function(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)},e.prototype.colorTone=function(t,e,n,r,i){var o=((n=n||16770432)>>16&255)/255,a=(n>>8&255)/255,s=(255&n)/255,u=((r=r||3375104)>>16&255)/255,c=(r>>8&255)/255,l=(255&r)/255;this._loadMatrix([.3,.59,.11,0,0,o,a,s,t=t||.2,0,u,c,l,e=e||.15,0,o-u,a-c,s-l,0,0],i)},e.prototype.night=function(t,e){this._loadMatrix([-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e)},e.prototype.predator=function(t,e){this._loadMatrix([11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0],e)},e.prototype.lsd=function(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)},e.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},n.matrix.get=function(){return this.uniforms.m},n.matrix.set=function(t){this.uniforms.m=t},n.alpha.get=function(){return this.uniforms.uAlpha},n.alpha.set=function(t){this.uniforms.uAlpha=t},Object.defineProperties(e.prototype,n),e}(Lb);_E.prototype.grayscale=_E.prototype.greyscale;var wE=new Gy;og.prototype._cacheAsBitmap=!1,og.prototype._cacheData=!1;var EE=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null};Object.defineProperties(og.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var e;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new EE),(e=this._cacheData).originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((e=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea))}}}),og.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},og.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.alpha;this.alpha=1,t.batch.flush();var n=this.getLocalBounds().clone();this.filters&&n.pad(this.filters[0].padding),n.ceil(oy.RESOLUTION);var r=t.renderTexture.current,i=t.renderTexture.sourceFrame,o=t.projection.transform,a=Bg.create(n.width,n.height),s="cacheAsBitmap_"+xy();this._cacheData.textureCacheId=s,Eg.addToCache(a.baseTexture,s),Mg.addToCache(a,s);var u=wE;u.tx=-n.x,u.ty=-n.y,this.transform.worldTransform.identity(),this.render=this._cacheData.originalRender,t.render(this,a,!0,u,!0),t.projection.transform=o,t.renderTexture.bind(r,i),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var c=new aw(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-n.x/n.width,c.anchor.y=-n.y/n.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)}},og.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},og.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var e=this.getLocalBounds(),n=this.alpha;this.alpha=1;var r=t.context;e.ceil(oy.RESOLUTION);var i=Bg.create(e.width,e.height),o="cacheAsBitmap_"+xy();this._cacheData.textureCacheId=o,Eg.addToCache(i.baseTexture,o),Mg.addToCache(i,o);var a=wE;this.transform.localTransform.copyTo(a),a.invert(),a.tx-=e.x,a.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,i,!0,a,!1),t.context=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var s=new aw(i);s.transform.worldTransform=this.transform.worldTransform,s.anchor.x=-e.x/e.width,s.anchor.y=-e.y/e.height,s.alpha=n,s._bounds=this._bounds,this._cacheData.sprite=s,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=s.containsPoint.bind(s)}},og.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},og.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},og.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Eg.removeFromCache(this._cacheData.textureCacheId),Mg.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},og.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},og.prototype.name=null,sg.prototype.getChildByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},og.prototype.getGlobalPosition=function(t,e){return void 0===t&&(t=new Fy),void 0===e&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var xE=function(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0};xE.prototype.update=function(t){if(t||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}};var TE=new Fy,CE=new ng;(function(t){function e(e,n,r,i){void 0===i&&(i=Wm.TRIANGLES),t.call(this),this.geometry=e,e.refCount++,this.shader=n,this.state=r||Rb.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=0,this._transformID=-1,this.tint=16777215,this.blendMode=Hm.NORMAL,this._roundPixels=oy.ROUND_PIXELS,this.batchUvs=null}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={uvBuffer:{configurable:!0},verticesBuffer:{configurable:!0},material:{configurable:!0},blendMode:{configurable:!0},roundPixels:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return n.uvBuffer.get=function(){return this.geometry.buffers[1]},n.verticesBuffer.get=function(){return this.geometry.buffers[0]},n.material.set=function(t){this.shader=t},n.material.get=function(){return this.shader},n.blendMode.set=function(t){this.state.blendMode=t},n.blendMode.get=function(){return this.state.blendMode},n.roundPixels.set=function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},n.roundPixels.get=function(){return this._roundPixels},n.tint.get=function(){return this.shader.tint},n.tint.set=function(t){this.shader.tint=t},n.texture.get=function(){return this.shader.texture},n.texture.set=function(t){this.shader.texture=t},e.prototype._render=function(t){this.shader.batchable&&this.drawMode===Wm.TRIANGLES&&this.geometry.buffers[0].data.length<2*e.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.program.uniformData.translationMatrix&&(e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var e=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,e=t.buffers[0].data;if(t.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));for(var n=this.transform.worldTransform,r=n.a,i=n.b,o=n.c,a=n.d,s=n.tx,u=n.ty,c=this.vertexData,l=0;l<c.length/2;l++){var h=e[2*l],f=e[2*l+1];c[2*l]=r*h+o*f+s,c[2*l+1]=i*h+a*f+u}if(this._roundPixels)for(var d=0;d<c.length;d++)c[d]=Math.round(c[d]);this.vertexDirty=t.vertexDirtyId}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new xE(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,TE);for(var e=this.geometry.getBuffer("aVertexPosition").data,n=CE.points,r=this.geometry.getIndex().data,i=r.length,o=4===this.drawMode?3:1,a=0;a+2<i;a+=o){var s=2*r[a],u=2*r[a+1],c=2*r[a+2];if(n[0]=e[s],n[1]=e[s+1],n[2]=e[u],n[3]=e[u+1],n[4]=e[c],n[5]=e[c+1],CE.contains(TE.x,TE.y))return!0}return!1},e.prototype.destroy=function(e){t.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Object.defineProperties(e.prototype,n),e}(sg)).BATCHABLE_SIZE=100;var kE=function(t){function e(e,n){t.call(this,e[0]instanceof Mg?e[0]:e[0].texture),this._textures=null,this._durations=null,this.textures=e,this._autoUpdate=!1!==n,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this.playing=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={totalFrames:{configurable:!0},textures:{configurable:!0},currentFrame:{configurable:!0}};return e.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&fg.shared.remove(this.update,this))},e.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&fg.shared.add(this.update,this,cg.HIGH))},e.prototype.gotoAndStop=function(t){this.stop();var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){var e=this.animationSpeed*t,n=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=e/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())},e.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var n=[],r=0;r<t.length;++r)n.push(Mg.from(t[r]));return new e(n)},e.fromImages=function(t){for(var n=[],r=0;r<t.length;++r)n.push(Mg.from(t[r]));return new e(n)},n.totalFrames.get=function(){return this._textures.length},n.textures.get=function(){return this._textures},n.textures.set=function(t){if(t[0]instanceof Mg)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this.gotoAndStop(0),this.updateTexture()},n.currentFrame.get=function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},Object.defineProperties(e.prototype,n),e}(aw);c_.registerPlugin("accessibility",ug),c_.registerPlugin("extract",T_),c_.registerPlugin("interaction",N_),c_.registerPlugin("particle",uE),c_.registerPlugin("prepare",Sw),c_.registerPlugin("batch",E_),c_.registerPlugin("tilingSprite",mE),nE.registerPlugin(gE),nE.registerPlugin(hE),Dw.registerPlugin(dg),Dw.registerPlugin(rE);var SE,AE,IE=function(t){return t.worldState.renderer.view},OE=function(t){return t.currentGame.stageName};function PE(t){var e,n,r,i,o,a;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Hf(IE);case 2:return e=s.sent,n=e.width,r=e.height,s.next=7,Hf(OE);case 7:i=s.sent,t.removeChildren(),t.zIndex=1,o=function(t,e){var n=new rw;return n.beginFill(8421504),n.drawRect(0,0,t,e),n.endFill(),n}(n,r),a=function(t,e,n){var r=new cw;r.fontSize=50,r.fontWeight="bold",r.fill=16777215;var i=new yw(t.toUpperCase(),r);return i.position.set(e/2,n/2),i.anchor.set(.5),i}(i,n,r),t.addChild(o),t.addChild(a);case 11:case"end":return s.stop()}}),l)}function DE(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ff(fh.UpdateCenter);case 2:if(!e.sent){e.next=9;break}return e.next=5,Wf(100);case 5:return e.next=7,qf(PE,t);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),h)}function NE(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ff(fh.Loading);case 2:if(!e.sent){e.next=9;break}return t.visible=!0,e.next=6,Ff(fh.Loaded);case 6:t.visible=!1;case 7:e.next=0;break;case 9:case"end":return e.stop()}}),f)}function RE(t){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(e=new sg).visible=!1,t.addChild(e),n.next=5,Vf([qf(PE,e),qf(DE,e),qf(NE,e)]);case 5:case"end":return n.stop()}}),d)}function ME(t){return t.worldState.objects}var LE=function(){if(SE)return SE;var t=new nE;return t.add(Th.Brick1,"./assets/brick1.png").add(Th.Brick2,"./assets/brick2.png").add(Th.Steel,"./assets/steel.png").add(Th.Tree,"./assets/tree.png").add(Th.Bullet,"./assets/bullet.png").add(Th.Water,"./assets/water.png").add(Th.Ice,"./assets/ice.png").add(Th.BasicTankGrey,"./assets/basic-tank-grey.png").add(Th.BasicTankGreen,"./assets/basic-tank-green.png").add(Th.BasicTankGold,"./assets/basic-tank-gold.png").add(Th.BasicTankRed,"./assets/basic-tank-red.png").add(Th.PowerTankGrey,"./assets/power-tank-grey.png").add(Th.PowerTankGreen,"./assets/power-tank-green.png").add(Th.PowerTankGold,"./assets/power-tank-gold.png").add(Th.PowerTankRed,"./assets/power-tank-red.png").add(Th.FastTankGrey,"./assets/fast-tank-grey.png").add(Th.FastTankGreen,"./assets/fast-tank-green.png").add(Th.FastTankGold,"./assets/fast-tank-gold.png").add(Th.FastTankRed,"./assets/fast-tank-red.png").add(Th.ArmorTankGrey,"./assets/armor-tank-grey.png").add(Th.ArmorTankGreen,"./assets/armor-tank-green.png").add(Th.ArmorTankGold,"./assets/armor-tank-gold.png").add(Th.ArmorTankRed,"./assets/armor-tank-red.png").add(Th.Explosion,"./assets/explosions.png").add(Th.Eagle,"./assets/eagle.png").add(Th.Blockade,"./assets/blockade.png").add(Th.GrenadeBonus,"./assets/grenade-bonus.png").add(Th.HelmetBonus,"./assets/helmet-bonus.png").add(Th.ShovelBonus,"./assets/shovel-bonus.png").add(Th.StarBonus,"./assets/star-bonus.png").add(Th.TankBonus,"./assets/tank-bonus.png").add(Th.TimerBonus,"./assets/timer-bonus.png"),SE=new Promise((function(e,n){t.load((function(t,n){AE=n,e(n)}))}))};function BE(t){var e=new sg;return e.zIndex=t.zIndex,e.pivot.set(t.pivot.x,t.pivot.y),e.position.set(t.position.x,t.position.y),e.rotation=t.rotation,t.children.forEach((function(t){return function(t,e){switch(e.type){case Ch.Sprite:var n=AE[e.textureId];if(!n)throw new Error("Missing resource ".concat(e.textureId));if(e.frame){var r=e.frame,i=r.x,o=r.y,a=r.width,s=r.height,u=new $y(i,o,a,s),c=new aw(new Mg(n.texture.baseTexture,u));t.addChild(c)}else{var l=new aw(n.texture);t.addChild(l)}break;case Ch.AnimatedSprite:var h=new kE((d=e.textureId,e.frames.map((function(t){var e=t.x,n=t.y,r=t.width,i=t.height;return new Mg(AE[d].texture.baseTexture,new $y(e,n,r,i))}))));h.animationSpeed=e.speed,e.playing&&h.play(),t.addChild(h);break;case Ch.Container:var f=BE(e);t.addChild(f)}var d}(e,t)})),e}var FE=function(t){return function(e){return ME(e)[t]}},UE=function(t){return t.worldState.renderer},VE=function(t){return t.worldState.explosions},jE=function(t){return function(e){return VE(e)[t]}};function qE(t){return{type:fh.CreateExplosion,explosion:t}}var GE=function(t,e,n,r,i){return new Mg(t,new $y(e,n,r,i))},zE=function(t){return{type:fh.RemoveExplosion,id:t}};function HE(t,e){var n,r,i,o,a;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,qf((function(){return function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,LE();case 2:return e=AE[Th.Explosion].texture.baseTexture,t.abrupt("return",[GE(e,0,0,58,54),GE(e,0,54,72,67),GE(e,72,0,152,142),GE(e,0,142,155,155)]);case 4:case"end":return t.stop()}}),t)})))}()}));case 2:return n=s.sent,s.next=5,Hf(jE(t));case 5:if(r=s.sent){s.next=8;break}return s.abrupt("return");case 8:return(i=new sg).position.set(r.x,r.y),o=function(t,e){var n=new aw(e[t-1]);return n.anchor.set(.5,.5),n}(r.stage,n),i.zIndex=10+r.stage,i.addChild(o),e.addChild(i),s.next=16,Wf(200);case 16:if(!((a=r.stage+1)<4)){s.next=22;break}return s.next=20,Uf(qE(Object.assign({},r,{stage:a})));case 20:s.next=24;break;case 22:return s.next=24,Uf(zE(r.id));case 24:i.destroy();case 25:case"end":return s.stop()}}),p)}function WE(t){var e,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Ff(fh.CreateExplosion);case 2:return e=r.sent,n=e.explosion.id,r.next=6,Gf(HE,n,t);case 6:r.next=0;break;case 8:case"end":return r.stop()}}),v)}function KE(t){var e,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Hf(VE);case 2:return e=r.sent,n=Object.keys(e).map((function(e){return Gf(HE,e,t)})),r.next=6,Vf([].concat(_toConsumableArray(n),[qf(WE,t)]));case 6:case"end":return r.stop()}}),m)}function XE(t){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ff(fh.AnimateMovingTanks);case 2:e=n.sent,e.updates.forEach((function(e){var n=e.shouldAnimate,r=t.get(e.id);if(r){var i=r.children[0];if(!(i instanceof kE))throw new Error("children[0] in tanks is not a animated sprite");n?i.playing||i.play():i.playing&&i.stop()}}));case 5:n.next=0;break;case 7:case"end":return n.stop()}}),y)}function YE(t,e){t.position.set(e.body.position.x,e.body.position.y),t.rotation=e.body.angle}function QE(t){var e,n,r;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Ff(fh.DestroyGameObject);case 2:if(e=i.sent,n=e.gameObject.id,r=t.get(n)){i.next=7;break}throw new Error("Missing game object in battle. ID: ".concat(n));case 7:r.destroy(),t.delete(n);case 8:i.next=0;break;case 10:case"end":return i.stop()}}),g)}function JE(t){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ff(fh.UpdateCameraPosition);case 2:if(!n.sent){n.next=9;break}return n.next=5,Hf(UE);case 5:e=n.sent,t.position.set(-e.camera.x+e.center.x,-e.camera.y+e.center.y);case 7:n.next=0;break;case 9:case"end":return n.stop()}}),b)}function ZE(t){var e,n,r;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Ff(fh.DestroyBonus);case 2:if(e=i.sent,n=e.id,r=t.get(n)){i.next=7;break}throw new Error("Missing bonus in battle. ID: ".concat(n));case 7:r.destroy(),t.delete(n);case 8:i.next=0;break;case 10:case"end":return i.stop()}}),_)}function $E(t,e){var n,r,i,o,a;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Ff([fh.CreateTree,fh.CreateBlockade,fh.CreateBrick,fh.CreateWater,fh.CreateEagle,fh.CreateTank,fh.CreateSteel,fh.CreateBullet,fh.CreateBonus]);case 2:return n=s.sent,r=n.id,s.next=6,Hf(FE(r));case 6:if(i=s.sent,o=i.container,!e.get(r)){s.next=10;break}return s.abrupt("return");case 10:a=BE(o),t.addChild(a),e.set(r,a);case 12:s.next=0;break;case 14:case"end":return s.stop()}}),w)}function tx(t,e){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ff(fh.NewGame);case 2:if(!n.sent){n.next=6;break}t.removeChildren(),e.clear();case 4:n.next=0;break;case 6:case"end":return n.stop()}}),E)}function ex(t){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ff(fh.UpdateBodies);case 2:e=n.sent,e.updates.forEach((function(e){var n=t.get(e.id);n&&YE(n,e)}));case 5:n.next=0;break;case 7:case"end":return n.stop()}}),x)}function nx(t){var e,n,r,i;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return e=new Map,(n=new sg).interactiveChildren=!1,n.visible=!0,n.sortableChildren=!0,t.addChild(n),o.next=4,Hf(ME);case 4:return r=o.sent,o.next=7,Hf(UE);case 7:return i=o.sent,n.position.set(-i.camera.x+i.center.x,-i.camera.y+i.center.y),Object.values(r).forEach((function(t){var r=t.id,i=BE(t.container);n.addChild(i),e.set(r,i)})),o.next=12,Vf([qf($E,n,e),qf(QE,e),qf(ZE,e),qf(JE,n),qf(tx,n,e),qf(ex,e),qf(KE,n),qf(XE,e)]);case 12:case"end":return o.stop()}}),T)}function rx(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.removeChildren(),e.next=3,Vf([qf(RE,t),qf(nx,t)]);case 3:case"end":return e.stop()}}),C)}var ix=n("wYbb");function ox(t,e,n){return Math.abs(t.container.position.x-e)>.1||Math.abs(t.container.position.y-n)>.1}var ax={left:{x:-20,y:0,angle:Math.PI},down:{x:0,y:20,angle:Math.PI/2},up:{x:0,y:-20,angle:-Math.PI/2},right:{x:20,y:0,angle:2*Math.PI}};function sx(t,e){var n=ax[e],r=n.x,i=n.y,o=n.angle;t.position=[t.position[0]+r/2,t.position[1]+i/2],t.velocity=[2*r,2*i],t.angle=o}var ux=function(t){return t.currentGame.player},cx=n("JaUx"),lx=function(t){return function(e){var n=e.currentGame.player.id===t?e.currentGame.player.direction:e.currentGame.enemies[t].direction,r=e.worldState.objects[t],i=function(t){return t.battlefieldMap.map.objects.find((function(t){return t.type===Th.Bullet}))}(e),o=function(t,e,n){return{left:{x:e.container.position.x-e.box.width/2-n.width,y:e.container.position.y-n.height/2,angle:Math.PI},down:{x:e.container.position.x-n.width/2,y:e.container.position.y+16,angle:Math.PI/2},up:{x:e.container.position.x-n.width/2,y:e.container.position.y-e.box.height-4,angle:-Math.PI/2},right:{x:e.container.position.x+e.box.width/2+2,y:e.container.position.y-n.height/2,angle:2*Math.PI}}[t]}(n,r,i);return{x:o.x,y:o.y,angle:o.angle,width:i.width,height:i.height,direction:n}}},hx=function(t){return[].concat(_toConsumableArray(t.worldState.enemies),_toConsumableArray(t.worldState.players),_toConsumableArray(t.worldState.bullets)).map((function(t){return t.id}))};function fx(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.getAABB();return{minX:r.lowerBound[0]-n,minY:r.lowerBound[1]-n,maxX:r.upperBound[0]+n,maxY:r.upperBound[1]+n,id:t}}var dx=function(t,e,n){var r=new Map;return function(i){i.reduce((function(t,r){var i=e.get(r);if(!i)return t;var o=fx(r,i,10),a=n.search(o);return t.push.apply(t,[{id:r}].concat(_toConsumableArray(a))),t}),[]).forEach((function(t){r.set(t.id,!0)})),r.forEach((function(n,i){var o=e.get(i);o&&(!0===n?(t.addBody(o),r.set(i,!1)):o.world&&(t.removeBody(o),r.delete(i)))}))}};function px(t,e){var n=_slicedToArray(e.position,2);return{id:t,body:{position:{x:n[0],y:n[1]},angle:e.interpolatedAngle||e.angle,velocity:e.velocity}}}var vx=[fh.CreateBlockade,fh.CreateBrick,fh.CreateWater,fh.CreateEagle,fh.CreateTank,fh.CreateSteel,fh.CreateBullet,fh.CreateBonus];function mx(t,e,n){var r;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=fx(e._id,e),t.insert(r),n.set(e._id,r);case 2:case"end":return i.stop()}}),k)}function yx(t){return t.worldState.contactMaterials}var gx=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),e}(ix.Body);function bx(t,e,n,r){var i=new gx(Object.assign({},e,{angle:r.rotation,velocity:[n.velocity[0],n.velocity[1]]}));return i._id=t,i.allowSleep=!0,i.sleepSpeedLimit=1,i.sleepTimeLimit=1,n&&n.damping&&(i.damping=n.damping),i}function _x(t){return function(e,n){void 0===n&&(n=kf());var r,i,o=!1,a=fm(n),s=function(){o||(o=!0,Hh(r)&&r(),a.close())};return r=sf((i=function(t){var e;hm(e=t)?s():a.put(e)},t.on("beginContact",i),r=function(){t.off("beginContact",i)})),o&&r(),{take:a.take,flush:a.flush,close:s}}()}function wx(t,e){return{type:fh.BulletHit,bullet:t,target:e}}function Ex(t){return t.type===bh.Bullet}function xx(t){var e,n,r,i;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,qf(_x,t);case 2:e=o.sent;case 3:return o.next=5,Ff(e);case 5:return n=o.sent,o.next=8,Hf(FE(n.bodyA._id));case 8:return r=o.sent,o.next=11,Hf(FE(n.bodyB._id));case 11:if(i=o.sent,o.t0=r&&i&&[r,i].some(Ex),!o.t0){o.next=22;break}if(o.t1=Ex(r),!o.t1){o.next=18;break}return o.next=18,Uf(wx(r,i));case 18:if(o.t2=Ex(i),!o.t2){o.next=22;break}return o.next=22,Uf(wx(i,r));case 22:o.next=3;break;case 24:case"end":return o.stop()}}),S)}function Tx(t,e,n,r){var i=new ix.Box(r);i.sensor=r.sensor,t.get(n).addShape(i),r.material&&(i.material=function(t,e){var n=new ix.Material(t);return e.set(t,n),n}(r.material,e))}function Cx(){return new Promise((function(t){return window.requestAnimationFrame(t)}))}var kx=function(t){var e=t.currentGame.player;if(e)return t.worldState.objects[e.id]};function Sx(t){var e,n,r,i,o,a,s,u=arguments;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return e=u.length>1&&void 0!==u[1]&&u[1],c.next=3,Hf(kx);case 3:if(n=c.sent){c.next=6;break}return c.abrupt("return");case 6:if(r=t.get(n.id)){c.next=9;break}return c.abrupt("return");case 9:return i=_slicedToArray(r.position,2),o=i[0],a=i[1],c.next=14,Hf(FE(n.id));case 14:if(s=c.sent,c.t0=e||ox(s,o,a),!c.t0){c.next=19;break}return c.next=19,Uf(function(t,e){return{type:fh.UpdateCameraPosition,x:t,y:e}}(o,a));case 19:case"end":return c.stop()}}),A)}var Ax=function(t,e,n,r){var i=r.get(t);n.remove(fx(t,i),(function(t,e){return t.id===e.id})),r.delete(t),e.removeBody(i)};function Ix(t,e,n){var r,i;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Ff(fh.DestroyGameObject);case 2:r=o.sent,i=r.gameObject.id,n.get(i)&&Ax(i,t,e,n);case 5:o.next=0;break;case 7:case"end":return o.stop()}}),I)}function Ox(t,e){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Hf(kx);case 2:return(n=r.sent)&&sx(e.get(n.id),t),r.next=6,Wf(100);case 6:r.next=0;break;case 8:case"end":return r.stop()}}),O)}function Px(t){var e,n,r,i;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Ff(fh.Move);case 2:if(r=o.sent,i=r.direction,o.t0=n!==i,!o.t0){o.next=16;break}if(n=i,o.t1=e,!o.t1){o.next=11;break}return o.next=11,zf(e);case 11:if(o.t2=i,!o.t2){o.next=16;break}return o.next=15,Gf(Ox,i,t);case 15:e=o.sent;case 16:o.next=0;break;case 18:case"end":return o.stop()}}),P)}var Dx=function(t){return function(e){return e.type!==t}},Nx=Dx(bh.Water),Rx=Dx(bh.Steel),Mx=Dx(bh.Blockade),Lx=Dx(bh.Eagle),Bx=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.every((function(e){return e(t)}))}};function Fx(t){return t.type===bh.Bonus}var Ux=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.some((function(e){return(n=e.id,function(t){return kx(t).id===n})(t);var n}))}},Vx=function(t){return{type:fh.DestroyBonus,id:t.id,bonus:t}},jx=function(t){return t.currentGame.bonus},qx=function(t){return t.worldState.enemies.map((function(e){return t.worldState.objects[e.id]}))};function Gx(t){return{type:fh.DestroyGameObject,gameObject:t}}function zx(t){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Uf(Gx(t));case 2:return e="explosion-".concat(t.id),n.next=5,Hf(jE(e));case 5:if(n.t0=n.sent,n.t0){n.next=9;break}return n.next=9,Uf(qE({id:e,x:t.container.position.x,y:t.container.position.y,stage:1}));case 9:case"end":return n.stop()}}),D)}function Hx(){var t,e,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Hf(qx);case 2:t=r.sent,e=0;case 4:if(!(e<t.length)){r.next=11;break}return n=t[e],r.next=8,qf(zx,n);case 8:e++,r.next=4;break;case 11:case"end":return r.stop()}}),N)}function Wx(t){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Hf(jx);case 2:return e=t.sent,t.next=5,Uf(Vx(e));case 5:if(t.t0=e.type===Sh.Grenade,!t.t0){t.next=9;break}return t.next=9,qf(Hx);case 9:case"end":return t.stop()}}),R)}var Kx=Dx(bh.Bonus);function Xx(t){var e,n,r,i;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,qf(_x,t);case 2:e=o.sent;case 3:return o.next=5,Ff(e);case 5:return n=o.sent,o.next=8,Hf(FE(n.bodyA._id));case 8:return r=o.sent,o.next=11,Hf(FE(n.bodyB._id));case 11:if(i=o.sent,o.t0=r&&i,!o.t0){o.next=17;break}return o.next=16,Hf(Ux(r,i));case 16:o.t0=o.sent;case 17:if(o.t1=o.t0,!o.t1){o.next=29;break}if(o.t2=[r,i].every(Kx),o.t2){o.next=29;break}if(o.t3=Fx(r),!o.t3){o.next=25;break}return o.next=25,qf(Wx,i.id);case 25:if(o.t4=Fx(i),!o.t4){o.next=29;break}return o.next=29,qf(Wx,r.id);case 29:o.next=3;break;case 31:case"end":return o.stop()}}),M)}function Yx(t,e,n){var r,i;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Ff(fh.DestroyBonus);case 2:r=o.sent,i=r.id,n.get(i)&&Ax(i,t,e,n);case 5:o.next=0;break;case 7:case"end":return o.stop()}}),L)}function Qx(t,e,n){n.forEach((function(n){var r=n.materialA,i=n.materialB,o=n.options,a=e.get(r.id),s=e.get(i.id);if(a&&s){var u=new ix.ContactMaterial(a,s,o);t.addContactMaterial(u)}}))}function Jx(){var t,e,n,r,i,o,a;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return(t=new ix.World({gravity:[0,0]})).sleepMode=ix.World.BODY_SLEEPING,e=new Map,n=new Map,r=new Map,i=new cx,s.next=8,Hf(ME);case 8:return o=s.sent,s.next=11,Hf(yx);case 11:return a=s.sent,Object.values(o).forEach((function(n){var i=n.id,o=n.bodyOptions,s=n.container,u=n.box,c=n.body;if(!1!==n.inPhysicsWorld){var l=bx(i,o,c,s);e.set(i,l),Tx(e,r,i,u),Qx(t,r,a)}})),function(t,e,n){var r=Array.from(t).map((function(t){var e=_slicedToArray(t,2);return fx(e[0],e[1])}));r.forEach((function(t){return n.set(t.id,t)})),e.load(r)}(e,i,n),s.next=16,Vf([qf(Sx,e,!0),qf(rT,t,e,i),qf(Zx,t,e,r,i,n),qf(eT,t,e,r),qf(xx,t),qf(Px,e),qf(nT,e),qf(Ix,t,i,e),qf(Yx,t,i,e),qf(Xx,t)]);case 16:case"end":return s.stop()}}),B)}function Zx(t,e,n,r,i){var o,a,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,Ff(vx);case 2:return o=p.sent,a=o.id,s=o.type,p.next=7,Hf(FE(a));case 7:if(u=p.sent,c=u.bodyOptions,l=u.body,h=u.container,f=u.box,!e.get(a)&&!1!==u.inPhysicsWorld){p.next=14;break}return p.abrupt("return");case 14:return d=bx(a,c,l,h),e.set(a,d),Tx(e,n,a,f),p.t0=Qx,p.t1=t,p.t2=n,p.next=22,Hf(yx);case 22:if(p.t3=p.sent,(0,p.t0)(p.t1,p.t2,p.t3),p.t4=s===fh.CreateTank,!p.t4){p.next=28;break}return p.next=28,qf(Sx,e,!0);case 28:return p.next=30,qf(mx,r,d,i);case 30:p.next=0;break;case 32:case"end":return p.stop()}}),F)}function $x(){var t,e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Hf(ux);case 2:return t=n.sent,n.next=5,Hf(lx(t.id));case 5:return e=n.sent,n.next=8,Uf((r=t.id,i=e,o=void 0,o="bullet-".concat(yh()),{type:fh.CreateBullet,id:o,tankId:r,info:i}));case 8:case"end":return n.stop()}var r,i,o}),U)}function tT(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,function(t,e,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];return Gf.apply(void 0,[Yf,t,e,n].concat(i))}(500,fh.Shot,$x);case 2:case"end":return t.stop()}}),V)}function eT(t,e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Vf([qf(tT)]);case 2:case"end":return t.stop()}}),j)}function nT(t){var e,n,r;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Ff(fh.EnemyAction);case 2:if(e=i.sent,n=e.id,r=e.action,i.t0=r!==ph.Shot,!i.t0){i.next=10;break}return i.next=9,Hf(FE(n));case 9:i.t0=i.sent;case 10:if(i.t1=i.t0,!i.t1){i.next=13;break}sx(t.get(n),vh[r]);case 13:i.next=0;break;case 15:case"end":return i.stop()}}),q)}function rT(t,e,n){var r,i,o,a,s;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:i=window.performance.now(),o=dx(t,e,n),a=regeneratorRuntime.mark((function n(){var a,u,c,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Hf();case 2:if((a=n.sent).currentGame.status!==mh.Start){n.next=20;break}return n.next=6,qf(Cx);case 6:return i=n.sent,u=hx(a),o(u),c=i/1e3,t.step(1/30,c-(r=r||c),3),l=u.filter((function(t){var n=e.get(t);if(!n)return!1;var r=_slicedToArray(n.position,2),i=r[0],o=r[1],s=n.interpolatedAngle,u=FE(t)(a);return!!u&&(ox(u,i,o)||Math.abs(u.container.rotation-s)>1)})).map((function(t){return px(t,e.get(t))})),n.next=14,qf(Sx,e);case 14:if(n.t0=l.length,!n.t0){n.next=18;break}return n.next=18,Uf((s=l,{type:fh.UpdateBodies,updates:s}));case 18:n.next=22;break;case 20:return n.next=22,Ff(fh.GameStart);case 22:case"end":return n.stop()}}),n)}));case 3:return u.delegateYield(a(),"t0",4);case 4:u.next=3;break;case 6:case"end":return u.stop()}}),G)}function iT(t,e,n){return{type:fh.CreateTank,id:t,block:e,tankType:n}}var oT=function(t){return t.worldState.players.concat(t.worldState.enemies).map((function(t){return t.id})).map((function(e){return t.worldState.objects[e]})).filter(Boolean)},aT=function(t){return function(e){return Boolean(e.currentGame.destroyedEnemies.find((function(e){return e.id===t})))}},sT=function(t){var e=t.currentGame.destroyedEnemies.length;return[4,11,18].some((function(t){return t===e}))},uT=function(){return sd([Sh.Grenade])},cT=function(t){return{type:fh.CreateBonus,id:t.id,bonus:t}};function lT(){var t,e,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Hf(ME);case 2:if(t=r.sent,0!==Object.keys(t).length){r.next=5;break}return r.abrupt("return");case 5:return e=uT(),n=function(t){return sd(Object.values(t).filter(Bx(Nx,Mx,Rx,Lx))).container.position}(t),r.next=8,Uf(cT({id:"bonus-".concat(yh()),type:e,position:n}));case 8:case"end":return r.stop()}}),z)}var hT=function(t){return function(e){return e.currentGame.healthPoints[t.id]<=0}},fT=function(t){return function(e){return(n=t.bullet.id,function(t){return t.currentGame.bulletIdToTankId[n]})(e)===t.target.id;var n}};function dT(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ff(fh.BulletHit);case 2:return t=e.sent,e.next=5,Hf(fT(t));case 5:if(e.t0=e.sent,e.t0){e.next=15;break}return e.next=9,Uf(Gx(t.bullet));case 9:return e.next=11,Hf(hT(t.target));case 11:if(e.t1=e.sent,!e.t1){e.next=15;break}return e.next=15,qf(zx,t.target);case 15:e.next=0;break;case 17:case"end":return e.stop()}}),H)}var pT=function(t){var e,n={},r=n.context,i=void 0===r?{}:r,o=n.channel,a=void 0===o?dm():o,s=n.sagaMonitor,u=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)e.indexOf(n=o[r])>=0||(i[n]=t[n]);return i}(n,["context","channel","sagaMonitor"]);function c(t){return e=Nm.bind(null,qh({},u,{context:i,channel:a,dispatch:t.dispatch,getState:t.getState,sagaMonitor:s})),function(t){return function(e){s&&s.actionDispatched&&s.actionDispatched(e);var n=t(e);return a.put(e),n}}}return c.run=function(){return e.apply(void 0,arguments)},c.setContext=function(t){of(i,t)},c}(),vT=Object(ah.composeWithDevTools)({actionsBlacklist:[fh.UpdateBodies,fh.UpdateCameraPosition,fh.Move]}),mT=Object(oh.createStore)(Ih,vT(Object(oh.applyMiddleware)(hh,pT)));function yT(t){return t.currentGame.status!==mh.None}pT.run(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qf(hd(Jx));case 2:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qf(hd(dT));case 2:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(fh.Loaded);case 2:return e=t.sent,n=e.level,r=new Set(n.map),t.next=7,Vf(_toConsumableArray(r).map(Jf).filter((function(t){return void 0!==t})));case 7:return t.next=9,Uf(Qf());case 9:t.next=0;break;case 11:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff([fh.CreatePlayerSpawn,fh.PlayerDestroyed]);case 2:if(!t.sent){t.next=11;break}return t.next=5,Hf($f);case 5:return t.t0=function(t){return qf(nd,t)},e=t.sent.map(t.t0),t.next=9,Vf(e);case 9:t.next=0;break;case 11:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=n.length>0&&void 0!==n[0]?n[0]:4;case 1:return t.next=3,Ff([fh.CreateEnemySpawn,fh.DestroyGameObject]);case 3:return t.next=5,qf(ad,e);case 5:t.next=1;break;case 7:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qf(hd(dd));case 2:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Kv,t.next=3,qf((function(){return e.autoSave.get(1)}));case 3:if(n=t.sent,t.t0=n,!t.t0){t.next=8;break}return t.next=8,Uf((r=n.gameState,{type:fh.LoadSave,gameState:r}));case 8:return t.next=10,qf(hd(Xv,e));case 10:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(fh.SetupPIXI);case 2:if(n=t.sent,r=n.container,t.t0=e,!t.t0){t.next=8;break}return t.next=8,zf(e);case 8:return t.next=10,Gf(rx,r);case 10:e=t.sent;case 11:t.next=0;break;case 13:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(fh.CreateEnemy);case 2:return e=t.sent,n=e.id,r=e.spawnBlock,i=e.tankType,t.next=8,Uf(iT(n,r,i));case 8:t.next=0;break;case 10:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(fh.CreatePlayer);case 2:return e=t.sent,n=e.id,r=e.spawnBlock,t.next=7,Uf(iT(n,r,gh.BasicTank));case 7:t.next=0;break;case 9:case"end":return t.stop()}}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(fh.UpdateBodies);case 2:if(!t.sent){t.next=14;break}return t.next=5,Hf(oT);case 5:if(t.t0=function(t,e){var n,r=(n=5,function(t){return Math.abs(t[0])>n||Math.abs(t[1])>n})(e.body.velocity);return t.concat([{id:e.id,shouldAnimate:r}])},t.t1=[],e=t.sent.reduce(t.t0,t.t1),t.t2=e.length,!t.t2){t.next=12;break}return t.next=12,Uf((n=e,{type:fh.AnimateMovingTanks,updates:n}));case 12:t.next=0;break;case 14:case"end":return t.stop()}var n}),t)}))),pT.run(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ff(fh.DestroyGameObject);case 2:return e=t.sent,n=e.gameObject.id,t.next=6,Hf(aT(n));case 6:if(t.t0=t.sent,!t.t0){t.next=11;break}return t.next=10,Hf(sT);case 10:t.t0=t.sent;case 11:if(t.t1=t.t0,!t.t1){t.next=15;break}return t.next=15,qf(lT);case 15:t.next=0;break;case 17:case"end":return t.stop()}}),t)})));var gT=function(){function t(e){_classCallCheck2(this,t),this.ngZone=e,this.View=Js,this.production=Xs.production,this.canResume=yT(mT.getState()),this.open=new mo}return _createClass2(t,[{key:"ngOnInit",value:function(){var t=this;this.storeUnsubscribe=mT.subscribe((function(){t.ngZone.run((function(){t.canResume=yT(mT.getState())}))}))}},{key:"ngOnDestroy",value:function(){this.storeUnsubscribe()}}]),t}(),bT=Lr({encapsulation:0,styles:[['@import url(https://fonts.googleapis.com/css?family=VT323);.menu[_ngcontent-%COMP%]{background:#000;width:100vw;height:100vh}.menu[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block;font-family:VT323,monospace;background:0 0;border:none;color:red;font-size:54px;cursor:pointer;outline:0}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]::before{content:"- "}.menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover::before{content:"> "}@media only screen and (max-width:480px){.menu[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:0;transform:translate(0,-50%);padding-left:10px}}']],data:{}});function _T(t){return qa(0,[(t()(),Sa(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.RESUME_GAME)&&r),r}),null,null)),(t()(),Ua(-1,null,["Resume game"]))],null,null)}function wT(t){return qa(0,[(t()(),Sa(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.MAP_EDITOR)&&r),r}),null,null)),(t()(),Ua(-1,null,["Level editor"]))],null,null)}function ET(t){return qa(0,[(t()(),Sa(0,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.AI_TRANSFER)&&r),r}),null,null)),(t()(),Ua(-1,null,["AI Transfer"]))],null,null)}function xT(t){return qa(0,[(t()(),Sa(0,0,null,null,9,"div",[["class","menu"]],null,null,null,null,null)),(t()(),Sa(1,0,null,null,8,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),Sa(2,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0,i=t.component;return"click"===e&&(r=!1!==i.open.emit(i.View.NEW_GAME)&&r),r}),null,null)),(t()(),Ua(-1,null,["New game"])),(t()(),ka(16777216,null,null,1,null,_T)),Hi(5,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,wT)),Hi(7,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,ET)),Hi(9,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null)],(function(t,e){var n=e.component;t(e,5,0,n.canResume),t(e,7,0,!n.production),t(e,9,0,!n.production)}),null)}var TT=null;function CT(){return TT}var kT,ST=function(t){function e(){var t;_classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._animationPrefix=null,t._transitionEnd=null;try{var n=t.createElement("div",document);if(null!=t.getStyle(n,"animationName"))t._animationPrefix="";else for(var r=["Webkit","Moz","O","ms"],i=0;i<r.length;i++)if(null!=t.getStyle(n,r[i]+"AnimationName")){t._animationPrefix="-"+r[i].toLowerCase()+"-";break}var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(o).forEach((function(e){null!=t.getStyle(n,e)&&(t._transitionEnd=o[e])}))}catch(a){t._animationPrefix=null,t._transitionEnd=null}return t}return _inherits(e,t),_createClass2(e,[{key:"getDistributedNodes",value:function(t){return t.getDistributedNodes()}},{key:"resolveAndSetHref",value:function(t,e,n){t.href=null==n?e:e+"/../"+n}},{key:"supportsDOMEvents",value:function(){return!0}},{key:"supportsNativeShadowDOM",value:function(){return"function"==typeof document.body.createShadowRoot}},{key:"getAnimationPrefix",value:function(){return this._animationPrefix?this._animationPrefix:""}},{key:"getTransitionEnd",value:function(){return this._transitionEnd?this._transitionEnd:""}},{key:"supportsAnimation",value:function(){return null!=this._animationPrefix&&null!=this._transitionEnd}}]),e}(function(){function t(){_classCallCheck2(this,t),this.resourceLoaderType=null}return _createClass2(t,[{key:"attrToPropMap",get:function(){return this._attrToPropMap},set:function(t){this._attrToPropMap=t}}]),t}()),AT={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},IT={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},OT={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},PT=function(){if(fe.Node)return fe.Node.prototype.contains||function(t){return!!(16&this.compareDocumentPosition(t))}}(),DT=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"parse",value:function(t){throw new Error("parse not implemented")}},{key:"hasProperty",value:function(t,e){return e in t}},{key:"setProperty",value:function(t,e,n){t[e]=n}},{key:"getProperty",value:function(t,e){return t[e]}},{key:"invoke",value:function(t,e,n){t[e].apply(t,_toConsumableArray(n))}},{key:"logError",value:function(t){window.console&&(console.error?console.error(t):console.log(t))}},{key:"log",value:function(t){window.console&&window.console.log&&window.console.log(t)}},{key:"logGroup",value:function(t){window.console&&window.console.group&&window.console.group(t)}},{key:"logGroupEnd",value:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()}},{key:"contains",value:function(t,e){return PT.call(t,e)}},{key:"querySelector",value:function(t,e){return t.querySelector(e)}},{key:"querySelectorAll",value:function(t,e){return t.querySelectorAll(e)}},{key:"on",value:function(t,e,n){t.addEventListener(e,n,!1)}},{key:"onAndCancel",value:function(t,e,n){return t.addEventListener(e,n,!1),function(){t.removeEventListener(e,n,!1)}}},{key:"dispatchEvent",value:function(t,e){t.dispatchEvent(e)}},{key:"createMouseEvent",value:function(t){var e=this.getDefaultDocument().createEvent("MouseEvent");return e.initEvent(t,!0,!0),e}},{key:"createEvent",value:function(t){var e=this.getDefaultDocument().createEvent("Event");return e.initEvent(t,!0,!0),e}},{key:"preventDefault",value:function(t){t.preventDefault(),t.returnValue=!1}},{key:"isPrevented",value:function(t){return t.defaultPrevented||null!=t.returnValue&&!t.returnValue}},{key:"getInnerHTML",value:function(t){return t.innerHTML}},{key:"getTemplateContent",value:function(t){return"content"in t&&this.isTemplateElement(t)?t.content:null}},{key:"getOuterHTML",value:function(t){return t.outerHTML}},{key:"nodeName",value:function(t){return t.nodeName}},{key:"nodeValue",value:function(t){return t.nodeValue}},{key:"type",value:function(t){return t.type}},{key:"content",value:function(t){return this.hasProperty(t,"content")?t.content:t}},{key:"firstChild",value:function(t){return t.firstChild}},{key:"nextSibling",value:function(t){return t.nextSibling}},{key:"parentElement",value:function(t){return t.parentNode}},{key:"childNodes",value:function(t){return t.childNodes}},{key:"childNodesAsList",value:function(t){for(var e=t.childNodes,n=new Array(e.length),r=0;r<e.length;r++)n[r]=e[r];return n}},{key:"clearNodes",value:function(t){for(;t.firstChild;)t.removeChild(t.firstChild)}},{key:"appendChild",value:function(t,e){t.appendChild(e)}},{key:"removeChild",value:function(t,e){t.removeChild(e)}},{key:"replaceChild",value:function(t,e,n){t.replaceChild(e,n)}},{key:"remove",value:function(t){return t.parentNode&&t.parentNode.removeChild(t),t}},{key:"insertBefore",value:function(t,e,n){t.insertBefore(n,e)}},{key:"insertAllBefore",value:function(t,e,n){n.forEach((function(n){return t.insertBefore(n,e)}))}},{key:"insertAfter",value:function(t,e,n){t.insertBefore(n,e.nextSibling)}},{key:"setInnerHTML",value:function(t,e){t.innerHTML=e}},{key:"getText",value:function(t){return t.textContent}},{key:"setText",value:function(t,e){t.textContent=e}},{key:"getValue",value:function(t){return t.value}},{key:"setValue",value:function(t,e){t.value=e}},{key:"getChecked",value:function(t){return t.checked}},{key:"setChecked",value:function(t,e){t.checked=e}},{key:"createComment",value:function(t){return this.getDefaultDocument().createComment(t)}},{key:"createTemplate",value:function(t){var e=this.getDefaultDocument().createElement("template");return e.innerHTML=t,e}},{key:"createElement",value:function(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}},{key:"createElementNS",value:function(t,e,n){return(n=n||this.getDefaultDocument()).createElementNS(t,e)}},{key:"createTextNode",value:function(t,e){return(e=e||this.getDefaultDocument()).createTextNode(t)}},{key:"createScriptTag",value:function(t,e,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(t,e),r}},{key:"createStyleElement",value:function(t,e){var n=(e=e||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(t,e)),n}},{key:"createShadowRoot",value:function(t){return t.createShadowRoot()}},{key:"getShadowRoot",value:function(t){return t.shadowRoot}},{key:"getHost",value:function(t){return t.host}},{key:"clone",value:function(t){return t.cloneNode(!0)}},{key:"getElementsByClassName",value:function(t,e){return t.getElementsByClassName(e)}},{key:"getElementsByTagName",value:function(t,e){return t.getElementsByTagName(e)}},{key:"classList",value:function(t){return Array.prototype.slice.call(t.classList,0)}},{key:"addClass",value:function(t,e){t.classList.add(e)}},{key:"removeClass",value:function(t,e){t.classList.remove(e)}},{key:"hasClass",value:function(t,e){return t.classList.contains(e)}},{key:"setStyle",value:function(t,e,n){t.style[e]=n}},{key:"removeStyle",value:function(t,e){t.style[e]=""}},{key:"getStyle",value:function(t,e){return t.style[e]}},{key:"hasStyle",value:function(t,e,n){var r=this.getStyle(t,e)||"";return n?r==n:r.length>0}},{key:"tagName",value:function(t){return t.tagName}},{key:"attributeMap",value:function(t){for(var e=new Map,n=t.attributes,r=0;r<n.length;r++){var i=n.item(r);e.set(i.name,i.value)}return e}},{key:"hasAttribute",value:function(t,e){return t.hasAttribute(e)}},{key:"hasAttributeNS",value:function(t,e,n){return t.hasAttributeNS(e,n)}},{key:"getAttribute",value:function(t,e){return t.getAttribute(e)}},{key:"getAttributeNS",value:function(t,e,n){return t.getAttributeNS(e,n)}},{key:"setAttribute",value:function(t,e,n){t.setAttribute(e,n)}},{key:"setAttributeNS",value:function(t,e,n,r){t.setAttributeNS(e,n,r)}},{key:"removeAttribute",value:function(t,e){t.removeAttribute(e)}},{key:"removeAttributeNS",value:function(t,e,n){t.removeAttributeNS(e,n)}},{key:"templateAwareRoot",value:function(t){return this.isTemplateElement(t)?this.content(t):t}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"getBoundingClientRect",value:function(t){try{return t.getBoundingClientRect()}catch(e){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}},{key:"getTitle",value:function(t){return t.title}},{key:"setTitle",value:function(t,e){t.title=e||""}},{key:"elementMatches",value:function(t,e){return!!this.isElementNode(t)&&(t.matches&&t.matches(e)||t.msMatchesSelector&&t.msMatchesSelector(e)||t.webkitMatchesSelector&&t.webkitMatchesSelector(e))}},{key:"isTemplateElement",value:function(t){return this.isElementNode(t)&&"TEMPLATE"===t.nodeName}},{key:"isTextNode",value:function(t){return t.nodeType===Node.TEXT_NODE}},{key:"isCommentNode",value:function(t){return t.nodeType===Node.COMMENT_NODE}},{key:"isElementNode",value:function(t){return t.nodeType===Node.ELEMENT_NODE}},{key:"hasShadowRoot",value:function(t){return null!=t.shadowRoot&&t instanceof HTMLElement}},{key:"isShadowRoot",value:function(t){return t instanceof DocumentFragment}},{key:"importIntoDoc",value:function(t){return document.importNode(this.templateAwareRoot(t),!0)}},{key:"adoptNode",value:function(t){return document.adoptNode(t)}},{key:"getHref",value:function(t){return t.getAttribute("href")}},{key:"getEventKey",value:function(t){var e=t.key;if(null==e){if(null==(e=t.keyIdentifier))return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&OT.hasOwnProperty(e)&&(e=OT[e]))}return IT[e]||e}},{key:"getGlobalEventTarget",value:function(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}},{key:"getHistory",value:function(){return window.history}},{key:"getLocation",value:function(){return window.location}},{key:"getBaseHref",value:function(t){var e,n=NT||(NT=document.querySelector("base"))?NT.getAttribute("href"):null;return null==n?null:(e=n,kT||(kT=document.createElement("a")),kT.setAttribute("href",e),"/"===kT.pathname.charAt(0)?kT.pathname:"/"+kT.pathname)}},{key:"resetBaseElement",value:function(){NT=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"setData",value:function(t,e,n){this.setAttribute(t,"data-"+e,n)}},{key:"getData",value:function(t,e){return this.getAttribute(t,"data-"+e)}},{key:"getComputedStyle",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return getComputedStyle(t)}))},{key:"supportsWebAnimation",value:function(){return"function"==typeof Element.prototype.animate}},{key:"performanceNow",value:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}},{key:"supportsCookies",value:function(){return!0}},{key:"getCookie",value:function(t){return Fl(document.cookie,t)}},{key:"setCookie",value:function(t,e){document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)}},{key:"attrToPropMap",get:function(){return AT}}],[{key:"makeCurrent",value:function(){var t;t=new e,TT||(TT=t)}}]),e}(ST),NT=null;function RT(){return!!window.history.pushState}var MT=new de("TRANSITION_ID"),LT=[{provide:bo,useFactory:function(t,e,n){return function(){n.get(_o).donePromise.then((function(){var n=CT();Array.prototype.slice.apply(n.querySelectorAll(e,"style[ng-transition]")).filter((function(e){return n.getAttribute(e,"ng-transition")===t})).forEach((function(t){return n.remove(t)}))}))}},deps:[MT,eh,bn],multi:!0}],BT=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"addToWindow",value:function(t){fe.getAngularTestability=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},fe.getAllAngularTestabilities=function(){return t.getAllTestabilities()},fe.getAllAngularRootElements=function(){return t.getAllRootElements()},fe.frameworkStabilizers||(fe.frameworkStabilizers=[]),fe.frameworkStabilizers.push((function(t){var e=fe.getAllAngularTestabilities(),n=e.length,r=!1,i=function(e){r=r||e,0==--n&&t(r)};e.forEach((function(t){t.whenStable(i)}))}))}},{key:"findTestabilityInTree",value:function(t,e,n){if(null==e)return null;var r=t.getTestability(e);return null!=r?r:n?CT().isShadowRoot(e)?this.findTestabilityInTree(t,CT().getHost(e),!0):this.findTestabilityInTree(t,CT().parentElement(e),!0):null}}],[{key:"init",value:function(){var e;e=new t,na=e}}]),t}();function FT(t,e){"undefined"!=typeof COMPILED&&COMPILED||((fe.ng=fe.ng||{})[t]=e)}var UT={ApplicationRef:ha,NgZone:Wo};function VT(t){return ya(t)}var jT=new de("EventManagerPlugins"),qT=function(){function t(e,n){var r=this;_classCallCheck2(this,t),this._zone=n,this._eventNameToPlugin=new Map,e.forEach((function(t){return t.manager=r})),this._plugins=e.slice().reverse()}return _createClass2(t,[{key:"addEventListener",value:function(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)}},{key:"addGlobalEventListener",value:function(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(t){var e=this._eventNameToPlugin.get(t);if(e)return e;for(var n=this._plugins,r=0;r<n.length;r++){var i=n[r];if(i.supports(t))return this._eventNameToPlugin.set(t,i),i}throw new Error("No event manager plugin found for event ".concat(t))}}]),t}(),GT=function(){function t(e){_classCallCheck2(this,t),this._doc=e}return _createClass2(t,[{key:"addGlobalEventListener",value:function(t,e,n){var r=CT().getGlobalEventTarget(this._doc,t);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(e));return this.addEventListener(r,e,n)}}]),t}(),zT=function(){function t(){_classCallCheck2(this,t),this._stylesSet=new Set}return _createClass2(t,[{key:"addStyles",value:function(t){var e=this,n=new Set;t.forEach((function(t){e._stylesSet.has(t)||(e._stylesSet.add(t),n.add(t))})),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(t){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),t}(),HT=function(t){function e(t){var n;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._doc=t,n._hostNodes=new Set,n._styleNodes=new Set,n._hostNodes.add(t.head),n}return _inherits(e,t),_createClass2(e,[{key:"_addStylesToHost",value:function(t,e){var n=this;t.forEach((function(t){var r=n._doc.createElement("style");r.textContent=t,n._styleNodes.add(e.appendChild(r))}))}},{key:"addHost",value:function(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)}},{key:"removeHost",value:function(t){this._hostNodes.delete(t)}},{key:"onStylesAdded",value:function(t){var e=this;this._hostNodes.forEach((function(n){return e._addStylesToHost(t,n)}))}},{key:"ngOnDestroy",value:function(){this._styleNodes.forEach((function(t){return CT().remove(t)}))}}]),e}(zT),WT={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},KT=/%COMP%/g,XT="_nghost-%COMP%",YT="_ngcontent-%COMP%";function QT(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];Array.isArray(i)?QT(t,i,n):(i=i.replace(KT,t),n.push(i))}return n}function JT(t){return function(e){!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}var ZT=function(){function t(e,n,r){_classCallCheck2(this,t),this.eventManager=e,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new $T(e)}return _createClass2(t,[{key:"createRenderer",value:function(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case Ie.Emulated:var n=this.rendererByCompId.get(e.id);return n||(n=new nC(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n;case Ie.Native:case Ie.ShadowDom:return new rC(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){var r=QT(e.id,e.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),t}(),$T=function(){function t(e){_classCallCheck2(this,t),this.eventManager=e,this.data=Object.create(null)}return _createClass2(t,[{key:"destroy",value:function(){}},{key:"createElement",value:function(t,e){return e?document.createElementNS(WT[e]||e,t):document.createElement(t)}},{key:"createComment",value:function(t){return document.createComment(t)}},{key:"createText",value:function(t){return document.createTextNode(t)}},{key:"appendChild",value:function(t,e){t.appendChild(e)}},{key:"insertBefore",value:function(t,e,n){t&&t.insertBefore(e,n)}},{key:"removeChild",value:function(t,e){t&&t.removeChild(e)}},{key:"selectRootElement",value:function(t,e){var n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error('The selector "'.concat(t,'" did not match any elements'));return e||(n.textContent=""),n}},{key:"parentNode",value:function(t){return t.parentNode}},{key:"nextSibling",value:function(t){return t.nextSibling}},{key:"setAttribute",value:function(t,e,n,r){if(r){e=r+":"+e;var i=WT[r];i?t.setAttributeNS(i,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}},{key:"removeAttribute",value:function(t,e,n){if(n){var r=WT[n];r?t.removeAttributeNS(r,e):t.removeAttribute("".concat(n,":").concat(e))}else t.removeAttribute(e)}},{key:"addClass",value:function(t,e){t.classList.add(e)}},{key:"removeClass",value:function(t,e){t.classList.remove(e)}},{key:"setStyle",value:function(t,e,n,r){r&Yn.DashCase?t.style.setProperty(e,n,r&Yn.Important?"important":""):t.style[e]=n}},{key:"removeStyle",value:function(t,e,n){n&Yn.DashCase?t.style.removeProperty(e):t.style[e]=""}},{key:"setProperty",value:function(t,e,n){eC(e,"property"),t[e]=n}},{key:"setValue",value:function(t,e){t.nodeValue=e}},{key:"listen",value:function(t,e,n){return eC(e,"listener"),"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,JT(n)):this.eventManager.addEventListener(t,e,JT(n))}}]),t}(),tC="@".charCodeAt(0);function eC(t,e){if(t.charCodeAt(0)===tC)throw new Error("Found the synthetic ".concat(e," ").concat(t,'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.'))}var nC=function(t){function e(t,n,r,i){var o;_classCallCheck2(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).component=r;var a=QT(i+"-"+r.id,r.styles,[]);return n.addStyles(a),o.contentAttr=YT.replace(KT,i+"-"+r.id),o.hostAttr=XT.replace(KT,i+"-"+r.id),o}return _inherits(e,t),_createClass2(e,[{key:"applyToHost",value:function(t){_get(_getPrototypeOf(e.prototype),"setAttribute",this).call(this,t,this.hostAttr,"")}},{key:"createElement",value:function(t,n){var r=_get(_getPrototypeOf(e.prototype),"createElement",this).call(this,t,n);return _get(_getPrototypeOf(e.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),e}($T),rC=function(t){function e(t,n,r,i){var o;_classCallCheck2(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).sharedStylesHost=n,o.hostEl=r,o.component=i,o.shadowRoot=i.encapsulation===Ie.ShadowDom?r.attachShadow({mode:"open"}):r.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var a=QT(i.id,i.styles,[]),s=0;s<a.length;s++){var u=document.createElement("style");u.textContent=a[s],o.shadowRoot.appendChild(u)}return o}return _inherits(e,t),_createClass2(e,[{key:"nodeOrShadowRoot",value:function(t){return t===this.hostEl?this.shadowRoot:t}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(t,n){return _get(_getPrototypeOf(e.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(t),n)}},{key:"insertBefore",value:function(t,n,r){return _get(_getPrototypeOf(e.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(t),n,r)}},{key:"removeChild",value:function(t,n){return _get(_getPrototypeOf(e.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(t),n)}},{key:"parentNode",value:function(t){return this.nodeOrShadowRoot(_get(_getPrototypeOf(e.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(t)))}}]),e}($T),iC="undefined"!=typeof Zone&&Zone.__symbol__||function(t){return"__zone_symbol__"+t},oC=iC("addEventListener"),aC=iC("removeEventListener"),sC={},uC="__zone_symbol__propagationStopped",cC=function(){var t="undefined"!=typeof Zone&&Zone[iC("BLACK_LISTED_EVENTS")];if(t){var e={};return t.forEach((function(t){e[t]=t})),e}}(),lC=function(t){return!!cC&&cC.hasOwnProperty(t)},hC=function(t){var e=sC[t.type];if(e){var n=this[e];if(n){var r=[t];if(1===n.length){var i=n[0];return i.zone!==Zone.current?i.zone.run(i.handler,this,r):i.handler.apply(this,r)}for(var o=n.slice(),a=0;a<o.length&&!0!==t[uC];a++){var s=o[a];s.zone!==Zone.current?s.zone.run(s.handler,this,r):s.handler.apply(this,r)}}}},fC=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).ngZone=n,r&&function(t){return t===rh}(r)||i.patchEvent(),i}return _inherits(e,t),_createClass2(e,[{key:"patchEvent",value:function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var t=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[uC]=!0),t&&t.apply(this,arguments)}}}},{key:"supports",value:function(t){return!0}},{key:"addEventListener",value:function(t,e,n){var r=this,i=n;if(!t[oC]||Wo.isInAngularZone()&&!lC(e))t.addEventListener(e,i,!1);else{var o=sC[e];o||(o=sC[e]=iC("ANGULAR"+e+"FALSE"));var a=t[o],s=a&&a.length>0;a||(a=t[o]=[]);var u=lC(e)?Zone.root:Zone.current;if(0===a.length)a.push({zone:u,handler:i});else{for(var c=!1,l=0;l<a.length;l++)if(a[l].handler===i){c=!0;break}c||a.push({zone:u,handler:i})}s||t[oC](e,hC,!1)}return function(){return r.removeEventListener(t,e,i)}}},{key:"removeEventListener",value:function(t,e,n){var r=t[aC];if(!r)return t.removeEventListener.apply(t,[e,n,!1]);var i=sC[e],o=i&&t[i];if(!o)return t.removeEventListener.apply(t,[e,n,!1]);for(var a=!1,s=0;s<o.length;s++)if(o[s].handler===n){a=!0,o.splice(s,1);break}a?0===o.length&&r.apply(t,[e,hC,!1]):t.removeEventListener.apply(t,[e,n,!1])}}]),e}(GT),dC={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},pC=new de("HammerGestureConfig"),vC=new de("HammerLoader"),mC=function(){function t(){_classCallCheck2(this,t),this.events=[],this.overrides={}}return _createClass2(t,[{key:"buildHammer",value:function(t){var e=new Hammer(t,this.options);for(var n in e.get("pinch").set({enable:!0}),e.get("rotate").set({enable:!0}),this.overrides)e.get(n).set(this.overrides[n]);return e}}]),t}(),yC=function(t){function e(t,n,r,i){var o;return _classCallCheck2(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t)))._config=n,o.console=r,o.loader=i,o}return _inherits(e,t),_createClass2(e,[{key:"supports",value:function(t){return!(!dC.hasOwnProperty(t.toLowerCase())&&!this.isCustomEvent(t)||!window.Hammer&&!this.loader&&(this.console.warn('The "'.concat(t,'" event cannot be bound because Hammer.JS is not ')+"loaded and no custom loader has been specified."),1))}},{key:"addEventListener",value:function(t,e,n){var r=this,i=this.manager.getZone();if(e=e.toLowerCase(),!window.Hammer&&this.loader){var o=!1,a=function(){o=!0};return this.loader().then((function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(a=function(){});o||(a=r.addEventListener(t,e,n))})).catch((function(){r.console.warn('The "'.concat(e,'" event cannot be bound because the custom ')+"Hammer.JS loader failed."),a=function(){}})),function(){a()}}return i.runOutsideAngular((function(){var o=r._config.buildHammer(t),a=function(t){i.runGuarded((function(){n(t)}))};return o.on(e,a),function(){o.off(e,a),"function"==typeof o.destroy&&o.destroy()}}))}},{key:"isCustomEvent",value:function(t){return this._config.events.indexOf(t)>-1}}]),e}(GT),gC=["alt","control","meta","shift"],bC={alt:function(t){return t.altKey},control:function(t){return t.ctrlKey},meta:function(t){return t.metaKey},shift:function(t){return t.shiftKey}},_C=function(t){function e(t){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,t),_createClass2(e,[{key:"supports",value:function(t){return null!=e.parseEventName(t)}},{key:"addEventListener",value:function(t,n,r){var i=e.parseEventName(n),o=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular((function(){return CT().onAndCancel(t,i.domEventName,o)}))}}],[{key:"parseEventName",value:function(t){var n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;var i=e._normalizeKey(n.pop()),o="";if(gC.forEach((function(t){var e=n.indexOf(t);e>-1&&(n.splice(e,1),o+=t+".")})),o+=i,0!=n.length||0===i.length)return null;var a={};return a.domEventName=r,a.fullKey=o,a}},{key:"getEventFullKey",value:function(t){var e="",n=CT().getEventKey(t);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),gC.forEach((function(r){r!=n&&(0,bC[r])(t)&&(e+=r+".")})),e+=n}},{key:"eventCallback",value:function(t,n,r){return function(i){e.getEventFullKey(i)===t&&r.runGuarded((function(){return n(i)}))}}},{key:"_normalizeKey",value:function(t){switch(t){case"esc":return"escape";default:return t}}}]),e}(GT),wC=function t(){_classCallCheck2(this,t)},EC=function(t){function e(t){var n;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._doc=t,n}return _inherits(e,t),_createClass2(e,[{key:"sanitize",value:function(t,e){if(null==e)return null;switch(t){case cn.NONE:return e;case cn.HTML:return e instanceof TC?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"HTML"),function(t,e){var n=null;try{Ke=Ke||new je(t);var r=e?String(e):"";n=Ke.getInertBodyElement(r);var i=5,o=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=o,o=n.innerHTML,n=Ke.getInertBodyElement(r)}while(r!==o);var a=new rn,s=a.sanitizeChildren(un(n)||n);return Ve()&&a.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=un(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(e)));case cn.STYLE:return e instanceof CC?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"Style"),function(t){if(!(t=String(t).trim()))return"";var e=t.match(fn);return e&&ze(e[1])===e[1]||t.match(hn)&&function(t){for(var e=!0,n=!0,r=0;r<t.length;r++){var i=t.charAt(r);"'"===i&&n?e=!e:'"'===i&&e&&(n=!n)}return e&&n}(t)?t:(Ve()&&console.warn("WARNING: sanitizing unsafe style value ".concat(t," (see http://g.co/ng/security#xss).")),"unsafe")}(e));case cn.SCRIPT:if(e instanceof kC)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"Script"),new Error("unsafe value used in a script context");case cn.URL:return e instanceof AC||e instanceof SC?e.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(e,"URL"),ze(String(e)));case cn.RESOURCE_URL:if(e instanceof AC)return e.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(e,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext ".concat(t," (see http://g.co/ng/security#xss)"))}}},{key:"checkNotSafeValue",value:function(t,e){if(t instanceof xC)throw new Error("Required a safe ".concat(e,", got a ").concat(t.getTypeName()," ")+"(see http://g.co/ng/security#xss)")}},{key:"bypassSecurityTrustHtml",value:function(t){return new TC(t)}},{key:"bypassSecurityTrustStyle",value:function(t){return new CC(t)}},{key:"bypassSecurityTrustScript",value:function(t){return new kC(t)}},{key:"bypassSecurityTrustUrl",value:function(t){return new SC(t)}},{key:"bypassSecurityTrustResourceUrl",value:function(t){return new AC(t)}}]),e}(wC),xC=function(){function t(e){_classCallCheck2(this,t),this.changingThisBreaksApplicationSecurity=e}return _createClass2(t,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: ".concat(this.changingThisBreaksApplicationSecurity)+" (see http://g.co/ng/security#xss)"}}]),t}(),TC=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"getTypeName",value:function(){return"HTML"}}]),e}(xC),CC=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"getTypeName",value:function(){return"Style"}}]),e}(xC),kC=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"getTypeName",value:function(){return"Script"}}]),e}(xC),SC=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"getTypeName",value:function(){return"URL"}}]),e}(xC),AC=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"getTypeName",value:function(){return"ResourceURL"}}]),e}(xC),IC=aa(_a,"browser",[{provide:Co,useValue:nh},{provide:To,useValue:function(){DT.makeCurrent(),BT.init()},multi:!0},{provide:Nl,useClass:function(t){function e(t){var n;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._doc=t,n._init(),n}return _inherits(e,t),_createClass2(e,[{key:"_init",value:function(){this.location=CT().getLocation(),this._history=CT().getHistory()}},{key:"getBaseHrefFromDOM",value:function(){return CT().getBaseHref(this._doc)}},{key:"onPopState",value:function(t){CT().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}},{key:"onHashChange",value:function(t){CT().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}},{key:"pushState",value:function(t,e,n){RT()?this._history.pushState(t,e,n):this.location.hash=n}},{key:"replaceState",value:function(t,e,n){RT()?this._history.replaceState(t,e,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"getState",value:function(){return this._history.state}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(t){this.location.pathname=t}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}}]),e}(Nl),deps:[eh]},{provide:eh,useFactory:function(){return document},deps:[]}]);function OC(){return new Be}var PC=function(){function t(e){if(_classCallCheck2(this,t),e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass2(t,null,[{key:"withServerTransition",value:function(e){return{ngModule:t,providers:[{provide:wo,useValue:e.appId},{provide:MT,useExisting:wo},LT]}}}]),t}();function DC(t,e){return new ct((function(n){var r=t.length;if(0!==r)for(var i=new Array(r),o=0,a=0,s=function(s){var u=Ot(t[s]),c=!1;n.add(u.subscribe({next:function(t){c||(c=!0,a++),i[s]=t},error:function(t){return n.error(t)},complete:function(){++o!==r&&c||(a===r&&n.next(e?e.reduce((function(t,e,n){return t[e]=i[n],t}),{}):i),n.complete())}}))},u=0;u<r;u++)s(u);else n.complete()}))}"undefined"!=typeof window&&window;var NC=new de("NgValueAccessor"),RC=new de("CompositionEventMode"),MC=function(){function t(e,n,r){var i;_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this._compositionMode=r,this.onChange=function(t){},this.onTouched=function(){},this._composing=!1,null==this._compositionMode&&(this._compositionMode=(i=CT()?CT().getUserAgent():"",!/android (\d+)/.test(i.toLowerCase())))}return _createClass2(t,[{key:"writeValue",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}},{key:"registerOnChange",value:function(t){this.onChange=t}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}},{key:"_handleInput",value:function(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}},{key:"_compositionStart",value:function(){this._composing=!0}},{key:"_compositionEnd",value:function(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}]),t}(),LC=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"reset",value:function(t){this.control&&this.control.reset(t)}},{key:"hasError",value:function(t,e){return!!this.control&&this.control.hasError(t,e)}},{key:"getError",value:function(t,e){return this.control?this.control.getError(t,e):null}},{key:"value",get:function(){return this.control?this.control.value:null}},{key:"valid",get:function(){return this.control?this.control.valid:null}},{key:"invalid",get:function(){return this.control?this.control.invalid:null}},{key:"pending",get:function(){return this.control?this.control.pending:null}},{key:"disabled",get:function(){return this.control?this.control.disabled:null}},{key:"enabled",get:function(){return this.control?this.control.enabled:null}},{key:"errors",get:function(){return this.control?this.control.errors:null}},{key:"pristine",get:function(){return this.control?this.control.pristine:null}},{key:"dirty",get:function(){return this.control?this.control.dirty:null}},{key:"touched",get:function(){return this.control?this.control.touched:null}},{key:"status",get:function(){return this.control?this.control.status:null}},{key:"untouched",get:function(){return this.control?this.control.untouched:null}},{key:"statusChanges",get:function(){return this.control?this.control.statusChanges:null}},{key:"valueChanges",get:function(){return this.control?this.control.valueChanges:null}},{key:"path",get:function(){return null}}]),t}(),BC=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"formDirective",get:function(){return null}},{key:"path",get:function(){return null}}]),e}(LC);function FC(){throw new Error("unimplemented")}var UC=function(t){function e(){var t;return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments)))._parent=null,t.name=null,t.valueAccessor=null,t._rawValidators=[],t._rawAsyncValidators=[],t}return _inherits(e,t),_createClass2(e,[{key:"validator",get:function(){return FC()}},{key:"asyncValidator",get:function(){return FC()}}]),e}(LC),VC=function(t){function e(t){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,t),e}(function(){function t(e){_classCallCheck2(this,t),this._cd=e}return _createClass2(t,[{key:"ngClassUntouched",get:function(){return!!this._cd.control&&this._cd.control.untouched}},{key:"ngClassTouched",get:function(){return!!this._cd.control&&this._cd.control.touched}},{key:"ngClassPristine",get:function(){return!!this._cd.control&&this._cd.control.pristine}},{key:"ngClassDirty",get:function(){return!!this._cd.control&&this._cd.control.dirty}},{key:"ngClassValid",get:function(){return!!this._cd.control&&this._cd.control.valid}},{key:"ngClassInvalid",get:function(){return!!this._cd.control&&this._cd.control.invalid}},{key:"ngClassPending",get:function(){return!!this._cd.control&&this._cd.control.pending}}]),t}());function jC(t){return null==t||0===t.length}var qC=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,GC=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,null,[{key:"min",value:function(t){return function(e){if(jC(e.value)||jC(t))return null;var n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null}}},{key:"max",value:function(t){return function(e){if(jC(e.value)||jC(t))return null;var n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null}}},{key:"required",value:function(t){return jC(t.value)?{required:!0}:null}},{key:"requiredTrue",value:function(t){return!0===t.value?null:{required:!0}}},{key:"email",value:function(t){return jC(t.value)?null:qC.test(t.value)?null:{email:!0}}},{key:"minLength",value:function(t){return function(e){if(jC(e.value))return null;var n=e.value?e.value.length:0;return n<t?{minlength:{requiredLength:t,actualLength:n}}:null}}},{key:"maxLength",value:function(t){return function(e){var n=e.value?e.value.length:0;return n>t?{maxlength:{requiredLength:t,actualLength:n}}:null}}},{key:"pattern",value:function(e){return e?("string"==typeof e?(r="","^"!==e.charAt(0)&&(r+="^"),r+=e,"$"!==e.charAt(e.length-1)&&(r+="$"),n=new RegExp(r)):(r=e.toString(),n=e),function(t){if(jC(t.value))return null;var e=t.value;return n.test(e)?null:{pattern:{requiredPattern:r,actualValue:e}}}):t.nullValidator;var n,r}},{key:"nullValidator",value:function(t){return null}},{key:"compose",value:function(t){if(!t)return null;var e=t.filter(zC);return 0==e.length?null:function(t){return WC(function(t,e){return e.map((function(e){return e(t)}))}(t,e))}}},{key:"composeAsync",value:function(t){if(!t)return null;var e=t.filter(zC);return 0==e.length?null:function(t){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(1===e.length){var r=e[0];if(J(r))return DC(r,null);if(Z(r)&&Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);return DC(i.map((function(t){return r[t]})),i)}}if("function"==typeof e[e.length-1]){var o=e.pop();return DC(e=1===e.length&&J(e[0])?e[0]:e,null).pipe(kt((function(t){return o.apply(void 0,_toConsumableArray(t))})))}return DC(e,null)}(function(t,e){return e.map((function(e){return e(t)}))}(t,e).map(HC)).pipe(kt(WC))}}}]),t}();function zC(t){return null!=t}function HC(t){var e=Rn(t)?Ot(t):t;if(!Mn(e))throw new Error("Expected validator to return Promise or Observable.");return e}function WC(t){var e=t.reduce((function(t,e){return null!=e?Object.assign({},t,e):t}),{});return 0===Object.keys(e).length?null:e}function KC(t){return t.validate?function(e){return t.validate(e)}:t}function XC(t){return t.validate?function(e){return t.validate(e)}:t}var YC=function(){function t(e,n){_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this.onChange=function(t){},this.onTouched=function(){}}return _createClass2(t,[{key:"writeValue",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}},{key:"registerOnChange",value:function(t){this.onChange=function(e){t(""==e?null:parseFloat(e))}}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}]),t}(),QC=function(){function t(){_classCallCheck2(this,t),this._accessors=[]}return _createClass2(t,[{key:"add",value:function(t,e){this._accessors.push([t,e])}},{key:"remove",value:function(t){for(var e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)}},{key:"select",value:function(t){var e=this;this._accessors.forEach((function(n){e._isSameGroup(n,t)&&n[1]!==t&&n[1].fireUncheck(t.value)}))}},{key:"_isSameGroup",value:function(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}]),t}(),JC='\n    <div [formGroup]="myGroup">\n      <input formControlName="firstName">\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       firstName: new FormControl()\n    });',ZC='\n    <div [formGroup]="myGroup">\n       <div formGroupName="person">\n          <input formControlName="firstName">\n       </div>\n    </div>\n\n    In your class:\n\n    this.myGroup = new FormGroup({\n       person: new FormGroup({ firstName: new FormControl() })\n    });',$C='\n    <form>\n       <div ngModelGroup="person">\n          <input [(ngModel)]="person.name" name="firstName">\n       </div>\n    </form>',tk='\n    <div [formGroup]="myGroup">\n       <input formControlName="firstName">\n       <input [(ngModel)]="showMoreControls" [ngModelOptions]="{standalone: true}">\n    </div>\n  ';function ek(t,e){return[].concat(_toConsumableArray(e.path),[t])}function nk(t,e){t||ik(e,"Cannot find control with"),e.valueAccessor||ik(e,"No value accessor for form control with"),t.validator=GC.compose([t.validator,e.validator]),t.asyncValidator=GC.composeAsync([t.asyncValidator,e.asyncValidator]),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange((function(n){t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&rk(t,e)}))}(t,e),function(t,e){t.registerOnChange((function(t,n){e.valueAccessor.writeValue(t),n&&e.viewToModelUpdate(t)}))}(t,e),function(t,e){e.valueAccessor.registerOnTouched((function(){t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&rk(t,e),"submit"!==t.updateOn&&t.markAsTouched()}))}(t,e),e.valueAccessor.setDisabledState&&t.registerOnDisabledChange((function(t){e.valueAccessor.setDisabledState(t)})),e._rawValidators.forEach((function(e){e.registerOnValidatorChange&&e.registerOnValidatorChange((function(){return t.updateValueAndValidity()}))})),e._rawAsyncValidators.forEach((function(e){e.registerOnValidatorChange&&e.registerOnValidatorChange((function(){return t.updateValueAndValidity()}))}))}function rk(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function ik(t,e){var n;throw n=t.path.length>1?"path: '".concat(t.path.join(" -> "),"'"):t.path[0]?"name: '".concat(t.path,"'"):"unspecified name attribute",new Error("".concat(e," ").concat(n))}function ok(t){return null!=t?GC.compose(t.map(KC)):null}function ak(t){return null!=t?GC.composeAsync(t.map(XC)):null}var sk=[function(){function t(e,n){_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this.onChange=function(t){},this.onTouched=function(){}}return _createClass2(t,[{key:"writeValue",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"checked",t)}},{key:"registerOnChange",value:function(t){this.onChange=t}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}]),t}(),function(){function t(e,n){_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this.onChange=function(t){},this.onTouched=function(){}}return _createClass2(t,[{key:"writeValue",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(t))}},{key:"registerOnChange",value:function(t){this.onChange=function(e){t(""==e?null:parseFloat(e))}}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}]),t}(),YC,function(){function t(e,n){_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this._optionMap=new Map,this._idCounter=0,this.onChange=function(t){},this.onTouched=function(){},this._compareWith=In}return _createClass2(t,[{key:"writeValue",value:function(t){this.value=t;var e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);var n=function(t,e){return null==t?"".concat(e):(e&&"object"==typeof e&&(e="Object"),"".concat(t,": ").concat(e).slice(0,50))}(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",n)}},{key:"registerOnChange",value:function(t){var e=this;this.onChange=function(n){e.value=e._getOptionValue(n),t(e.value)}}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}},{key:"_registerOption",value:function(){return(this._idCounter++).toString()}},{key:"_getOptionId",value:function(t){for(var e=0,n=Array.from(this._optionMap.keys());e<n.length;e++){var r=n[e];if(this._compareWith(this._optionMap.get(r),t))return r}return null}},{key:"_getOptionValue",value:function(t){var e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}},{key:"compareWith",set:function(t){if("function"!=typeof t)throw new Error("compareWith must be a function, but received ".concat(JSON.stringify(t)));this._compareWith=t}}]),t}(),function(){function t(e,n){_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this._optionMap=new Map,this._idCounter=0,this.onChange=function(t){},this.onTouched=function(){},this._compareWith=In}return _createClass2(t,[{key:"writeValue",value:function(t){var e,n=this;if(this.value=t,Array.isArray(t)){var r=t.map((function(t){return n._getOptionId(t)}));e=function(t,e){t._setSelected(r.indexOf(e.toString())>-1)}}else e=function(t,e){t._setSelected(!1)};this._optionMap.forEach(e)}},{key:"registerOnChange",value:function(t){var e=this;this.onChange=function(n){var r=[];if(n.hasOwnProperty("selectedOptions"))for(var i=n.selectedOptions,o=0;o<i.length;o++){var a=i.item(o),s=e._getOptionValue(a.value);r.push(s)}else for(var u=n.options,c=0;c<u.length;c++){var l=u.item(c);if(l.selected){var h=e._getOptionValue(l.value);r.push(h)}}e.value=r,t(r)}}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}},{key:"_registerOption",value:function(t){var e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}},{key:"_getOptionId",value:function(t){for(var e=0,n=Array.from(this._optionMap.keys());e<n.length;e++){var r=n[e];if(this._compareWith(this._optionMap.get(r)._value,t))return r}return null}},{key:"_getOptionValue",value:function(t){var e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}},{key:"compareWith",set:function(t){if("function"!=typeof t)throw new Error("compareWith must be a function, but received ".concat(JSON.stringify(t)));this._compareWith=t}}]),t}(),function(){function t(e,n,r,i){_classCallCheck2(this,t),this._renderer=e,this._elementRef=n,this._registry=r,this._injector=i,this.onChange=function(){},this.onTouched=function(){}}return _createClass2(t,[{key:"ngOnInit",value:function(){this._control=this._injector.get(UC),this._checkName(),this._registry.add(this._control,this)}},{key:"ngOnDestroy",value:function(){this._registry.remove(this)}},{key:"writeValue",value:function(t){this._state=t===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}},{key:"registerOnChange",value:function(t){var e=this;this._fn=t,this.onChange=function(){t(e.value),e._registry.select(e)}}},{key:"fireUncheck",value:function(t){this.writeValue(t)}},{key:"registerOnTouched",value:function(t){this.onTouched=t}},{key:"setDisabledState",value:function(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}},{key:"_checkName",value:function(){this.name&&this.formControlName&&this.name!==this.formControlName&&this._throwNameError(),!this.name&&this.formControlName&&(this.name=this.formControlName)}},{key:"_throwNameError",value:function(){throw new Error('\n      If you define both a name and a formControlName attribute on your radio button, their values\n      must match. Ex: <input type="radio" formControlName="food" name="food">\n    ')}}]),t}()];function uk(t){var e=lk(t)?t.validators:t;return Array.isArray(e)?ok(e):e||null}function ck(t,e){var n=lk(e)?e.asyncValidators:t;return Array.isArray(n)?ak(n):n||null}function lk(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}var hk=function(){function t(e,n){_classCallCheck2(this,t),this.validator=e,this.asyncValidator=n,this._onCollectionChange=function(){},this.pristine=!0,this.touched=!1,this._onDisabledChange=[]}return _createClass2(t,[{key:"setValidators",value:function(t){this.validator=uk(t)}},{key:"setAsyncValidators",value:function(t){this.asyncValidator=ck(t)}},{key:"clearValidators",value:function(){this.validator=null}},{key:"clearAsyncValidators",value:function(){this.asyncValidator=null}},{key:"markAsTouched",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}},{key:"markAllAsTouched",value:function(){this.markAsTouched({onlySelf:!0}),this._forEachChild((function(t){return t.markAllAsTouched()}))}},{key:"markAsUntouched",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!1,this._pendingTouched=!1,this._forEachChild((function(t){t.markAsUntouched({onlySelf:!0})})),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}},{key:"markAsDirty",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}},{key:"markAsPristine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!0,this._pendingDirty=!1,this._forEachChild((function(t){t.markAsPristine({onlySelf:!0})})),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}},{key:"markAsPending",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.status="PENDING",!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}},{key:"disable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._parentMarkedDirty(t.onlySelf);this.status="DISABLED",this.errors=null,this._forEachChild((function(e){e.disable(Object.assign({},t,{onlySelf:!0}))})),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign({},t,{skipPristineCheck:e})),this._onDisabledChange.forEach((function(t){return t(!0)}))}},{key:"enable",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._parentMarkedDirty(t.onlySelf);this.status="VALID",this._forEachChild((function(e){e.enable(Object.assign({},t,{onlySelf:!0}))})),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign({},t,{skipPristineCheck:e})),this._onDisabledChange.forEach((function(t){return t(!1)}))}},{key:"_updateAncestors",value:function(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}},{key:"setParent",value:function(t){this._parent=t}},{key:"updateValueAndValidity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),"VALID"!==this.status&&"PENDING"!==this.status||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}},{key:"_updateTreeValidity",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{emitEvent:!0};this._forEachChild((function(e){return e._updateTreeValidity(t)})),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}},{key:"_setInitialStatus",value:function(){this.status=this._allControlsDisabled()?"DISABLED":"VALID"}},{key:"_runValidator",value:function(){return this.validator?this.validator(this):null}},{key:"_runAsyncValidator",value:function(t){var e=this;if(this.asyncValidator){this.status="PENDING";var n=HC(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe((function(n){return e.setErrors(n,{emitEvent:t})}))}}},{key:"_cancelExistingSubscription",value:function(){this._asyncValidationSubscription&&this._asyncValidationSubscription.unsubscribe()}},{key:"setErrors",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}},{key:"get",value:function(t){return function(t,e,n){return null==e?null:(e instanceof Array||(e=e.split(".")),e instanceof Array&&0===e.length?null:e.reduce((function(t,e){return t instanceof dk?t.controls.hasOwnProperty(e)?t.controls[e]:null:t instanceof pk&&t.at(e)||null}),t))}(this,t)}},{key:"getError",value:function(t,e){var n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}},{key:"hasError",value:function(t,e){return!!this.getError(t,e)}},{key:"_updateControlsErrors",value:function(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}},{key:"_initObservables",value:function(){this.valueChanges=new mo,this.statusChanges=new mo}},{key:"_calculateStatus",value:function(){return this._allControlsDisabled()?"DISABLED":this.errors?"INVALID":this._anyControlsHaveStatus("PENDING")?"PENDING":this._anyControlsHaveStatus("INVALID")?"INVALID":"VALID"}},{key:"_anyControlsHaveStatus",value:function(t){return this._anyControls((function(e){return e.status===t}))}},{key:"_anyControlsDirty",value:function(){return this._anyControls((function(t){return t.dirty}))}},{key:"_anyControlsTouched",value:function(){return this._anyControls((function(t){return t.touched}))}},{key:"_updatePristine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}},{key:"_updateTouched",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}},{key:"_isBoxedValue",value:function(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}},{key:"_registerOnCollectionChange",value:function(t){this._onCollectionChange=t}},{key:"_setUpdateStrategy",value:function(t){lk(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}},{key:"_parentMarkedDirty",value:function(t){return!t&&this._parent&&this._parent.dirty&&!this._parent._anyControlsDirty()}},{key:"parent",get:function(){return this._parent}},{key:"valid",get:function(){return"VALID"===this.status}},{key:"invalid",get:function(){return"INVALID"===this.status}},{key:"pending",get:function(){return"PENDING"==this.status}},{key:"disabled",get:function(){return"DISABLED"===this.status}},{key:"enabled",get:function(){return"DISABLED"!==this.status}},{key:"dirty",get:function(){return!this.pristine}},{key:"untouched",get:function(){return!this.touched}},{key:"updateOn",get:function(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}},{key:"root",get:function(){for(var t=this;t._parent;)t=t._parent;return t}}]),t}(),fk=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,uk(r),ck(i,r))))._onChange=[],t._applyFormState(n),t._setUpdateStrategy(r),t.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),t._initObservables(),t}return _inherits(e,t),_createClass2(e,[{key:"setValue",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach((function(t){return t(e.value,!1!==n.emitViewToModelChange)})),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setValue(t,e)}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}},{key:"_updateValue",value:function(){}},{key:"_anyControls",value:function(t){return!1}},{key:"_allControlsDisabled",value:function(){return this.disabled}},{key:"registerOnChange",value:function(t){this._onChange.push(t)}},{key:"_clearChangeFns",value:function(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=function(){}}},{key:"registerOnDisabledChange",value:function(t){this._onDisabledChange.push(t)}},{key:"_forEachChild",value:function(t){}},{key:"_syncPendingControls",value:function(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}},{key:"_applyFormState",value:function(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}]),e}(hk),dk=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,uk(n),ck(r,n)))).controls=t,i._initObservables(),i._setUpdateStrategy(n),i._setUpControls(),i.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),i}return _inherits(e,t),_createClass2(e,[{key:"registerControl",value:function(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}},{key:"addControl",value:function(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"removeControl",value:function(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange((function(){})),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}},{key:"setControl",value:function(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange((function(){})),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"contains",value:function(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}},{key:"setValue",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(t),Object.keys(t).forEach((function(r){e._throwIfControlMissing(r),e.controls[r].setValue(t[r],{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach((function(r){e.controls[r]&&e.controls[r].patchValue(t[r],{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild((function(n,r){n.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})})),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}},{key:"getRawValue",value:function(){return this._reduceChildren({},(function(t,e,n){return t[n]=e instanceof fk?e.value:e.getRawValue(),t}))}},{key:"_syncPendingControls",value:function(){var t=this._reduceChildren(!1,(function(t,e){return!!e._syncPendingControls()||t}));return t&&this.updateValueAndValidity({onlySelf:!0}),t}},{key:"_throwIfControlMissing",value:function(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error("Cannot find form control with name: ".concat(t,"."))}},{key:"_forEachChild",value:function(t){var e=this;Object.keys(this.controls).forEach((function(n){return t(e.controls[n],n)}))}},{key:"_setUpControls",value:function(){var t=this;this._forEachChild((function(e){e.setParent(t),e._registerOnCollectionChange(t._onCollectionChange)}))}},{key:"_updateValue",value:function(){this.value=this._reduceValue()}},{key:"_anyControls",value:function(t){var e=this,n=!1;return this._forEachChild((function(r,i){n=n||e.contains(i)&&t(r)})),n}},{key:"_reduceValue",value:function(){var t=this;return this._reduceChildren({},(function(e,n,r){return(n.enabled||t.disabled)&&(e[r]=n.value),e}))}},{key:"_reduceChildren",value:function(t,e){var n=t;return this._forEachChild((function(t,r){n=e(n,t,r)})),n}},{key:"_allControlsDisabled",value:function(){for(var t=0,e=Object.keys(this.controls);t<e.length;t++){var n=e[t];if(this.controls[n].enabled)return!1}return Object.keys(this.controls).length>0||this.disabled}},{key:"_checkAllValuesPresent",value:function(t){this._forEachChild((function(e,n){if(void 0===t[n])throw new Error("Must supply a value for form control with name: '".concat(n,"'."))}))}}]),e}(hk),pk=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,uk(n),ck(r,n)))).controls=t,i._initObservables(),i._setUpdateStrategy(n),i._setUpControls(),i.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),i}return _inherits(e,t),_createClass2(e,[{key:"at",value:function(t){return this.controls[t]}},{key:"push",value:function(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"insert",value:function(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}},{key:"removeAt",value:function(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange((function(){})),this.controls.splice(t,1),this.updateValueAndValidity()}},{key:"setControl",value:function(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange((function(){})),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"setValue",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(t),t.forEach((function(t,r){e._throwIfControlMissing(r),e.at(r).setValue(t,{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.forEach((function(t,r){e.at(r)&&e.at(r).patchValue(t,{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild((function(n,r){n.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})})),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}},{key:"getRawValue",value:function(){return this.controls.map((function(t){return t instanceof fk?t.value:t.getRawValue()}))}},{key:"clear",value:function(){this.controls.length<1||(this._forEachChild((function(t){return t._registerOnCollectionChange((function(){}))})),this.controls.splice(0),this.updateValueAndValidity())}},{key:"_syncPendingControls",value:function(){var t=this.controls.reduce((function(t,e){return!!e._syncPendingControls()||t}),!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}},{key:"_throwIfControlMissing",value:function(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error("Cannot find form control at index ".concat(t))}},{key:"_forEachChild",value:function(t){this.controls.forEach((function(e,n){t(e,n)}))}},{key:"_updateValue",value:function(){var t=this;this.value=this.controls.filter((function(e){return e.enabled||t.disabled})).map((function(t){return t.value}))}},{key:"_anyControls",value:function(t){return this.controls.some((function(e){return e.enabled&&t(e)}))}},{key:"_setUpControls",value:function(){var t=this;this._forEachChild((function(e){return t._registerControl(e)}))}},{key:"_checkAllValuesPresent",value:function(t){this._forEachChild((function(e,n){if(void 0===t[n])throw new Error("Must supply a value for form control at index: ".concat(n,"."))}))}},{key:"_allControlsDisabled",value:function(){var t=!0,e=!1,n=void 0;try{for(var r,i=this.controls[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){if(r.value.enabled)return!1}}catch(o){e=!0,n=o}finally{try{t||null==i.return||i.return()}finally{if(e)throw n}}return this.controls.length>0||this.disabled}},{key:"_registerControl",value:function(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}},{key:"length",get:function(){return this.controls.length}}]),e}(hk),vk=Promise.resolve(null),mk=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).submitted=!1,r._directives=[],r.ngSubmit=new mo,r.form=new dk({},ok(t),ak(n)),r}return _inherits(e,t),_createClass2(e,[{key:"ngAfterViewInit",value:function(){this._setUpdateStrategy()}},{key:"addControl",value:function(t){var e=this;vk.then((function(){var n=e._findContainer(t.path);t.control=n.registerControl(t.name,t.control),nk(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),e._directives.push(t)}))}},{key:"getControl",value:function(t){return this.form.get(t.path)}},{key:"removeControl",value:function(t){var e=this;vk.then((function(){var n=e._findContainer(t.path);n&&n.removeControl(t.name),function(t,e){var n=t.indexOf(e);n>-1&&t.splice(n,1)}(e._directives,t)}))}},{key:"addFormGroup",value:function(t){var e=this;vk.then((function(){var n=e._findContainer(t.path),r=new dk({});(function(t,e){null==t&&ik(e,"Cannot find control with"),t.validator=GC.compose([t.validator,e.validator]),t.asyncValidator=GC.composeAsync([t.asyncValidator,e.asyncValidator])})(r,t),n.registerControl(t.name,r),r.updateValueAndValidity({emitEvent:!1})}))}},{key:"removeFormGroup",value:function(t){var e=this;vk.then((function(){var n=e._findContainer(t.path);n&&n.removeControl(t.name)}))}},{key:"getFormGroup",value:function(t){return this.form.get(t.path)}},{key:"updateModel",value:function(t,e){var n=this;vk.then((function(){n.form.get(t.path).setValue(e)}))}},{key:"setValue",value:function(t){this.control.setValue(t)}},{key:"onSubmit",value:function(t){return this.submitted=!0,e=this._directives,this.form._syncPendingControls(),e.forEach((function(t){var e=t.control;"submit"===e.updateOn&&e._pendingChange&&(t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1)})),this.ngSubmit.emit(t),!1;var e}},{key:"onReset",value:function(){this.resetForm()}},{key:"resetForm",value:function(t){this.form.reset(t),this.submitted=!1}},{key:"_setUpdateStrategy",value:function(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}},{key:"_findContainer",value:function(t){return t.pop(),t.length?this.form.get(t):this.form}},{key:"formDirective",get:function(){return this}},{key:"control",get:function(){return this.form}},{key:"path",get:function(){return[]}},{key:"controls",get:function(){return this.form.controls}}]),e}(BC),yk=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,null,[{key:"modelParentException",value:function(){throw new Error('\n      ngModel cannot be used to register form controls with a parent formGroup directive.  Try using\n      formGroup\'s partner directive "formControlName" instead.  Example:\n\n      '.concat(JC,"\n\n      Or, if you'd like to avoid registering this form control, indicate that it's standalone in ngModelOptions:\n\n      Example:\n\n      ").concat(tk))}},{key:"formGroupNameException",value:function(){throw new Error("\n      ngModel cannot be used to register form controls with a parent formGroupName or formArrayName directive.\n\n      Option 1: Use formControlName instead of ngModel (reactive strategy):\n\n      ".concat(ZC,"\n\n      Option 2:  Update ngModel's parent be ngModelGroup (template-driven strategy):\n\n      ").concat($C))}},{key:"missingNameException",value:function(){throw new Error('If ngModel is used within a form tag, either the name attribute must be set or the form\n      control must be defined as \'standalone\' in ngModelOptions.\n\n      Example 1: <input [(ngModel)]="person.firstName" name="first">\n      Example 2: <input [(ngModel)]="person.firstName" [ngModelOptions]="{standalone: true}">')}},{key:"modelGroupParentException",value:function(){throw new Error("\n      ngModelGroup cannot be used with a parent formGroup directive.\n\n      Option 1: Use formGroupName instead of ngModelGroup (reactive strategy):\n\n      ".concat(ZC,"\n\n      Option 2:  Use a regular form tag instead of the formGroup directive (template-driven strategy):\n\n      ").concat($C))}},{key:"ngFormWarning",value:function(){console.warn("\n    It looks like you're using 'ngForm'.\n\n    Support for using the 'ngForm' element selector has been deprecated in Angular v6 and will be removed\n    in Angular v9.\n\n    Use 'ng-form' instead.\n\n    Before:\n    <ngForm #myForm=\"ngForm\">\n\n    After:\n    <ng-form #myForm=\"ngForm\">\n    ")}}]),t}(),gk=new de("NgFormSelectorWarning"),bk=function(t){function e(){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass2(e,[{key:"ngOnInit",value:function(){this._checkParentType(),this.formDirective.addFormGroup(this)}},{key:"ngOnDestroy",value:function(){this.formDirective&&this.formDirective.removeFormGroup(this)}},{key:"_checkParentType",value:function(){}},{key:"control",get:function(){return this.formDirective.getFormGroup(this)}},{key:"path",get:function(){return ek(this.name,this._parent)}},{key:"formDirective",get:function(){return this._parent?this._parent.formDirective:null}},{key:"validator",get:function(){return ok(this._validators)}},{key:"asyncValidator",get:function(){return ak(this._asyncValidators)}}]),e}(BC),_k=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this)))._parent=t,i._validators=n,i._asyncValidators=r,i}return _inherits(e,t),_createClass2(e,[{key:"_checkParentType",value:function(){this._parent instanceof e||this._parent instanceof mk||yk.modelGroupParentException()}}]),e}(bk),wk=Promise.resolve(null),Ek=function(t){function e(t,n,r,i){var o;return _classCallCheck2(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))).control=new fk,o._registered=!1,o.update=new mo,o._parent=t,o._rawValidators=n||[],o._rawAsyncValidators=r||[],o.valueAccessor=function(t,e){if(!e)return null;Array.isArray(e)||ik(t,"Value accessor was not provided as an array for form control with");var n=void 0,r=void 0,i=void 0;return e.forEach((function(e){var o;e.constructor===MC?n=e:(o=e,sk.some((function(t){return o.constructor===t}))?(r&&ik(t,"More than one built-in value accessor matches form control with"),r=e):(i&&ik(t,"More than one custom value accessor matches form control with"),i=e))})),i||r||n||(ik(t,"No valid value accessor for form control with"),null)}(_assertThisInitialized(o),i),o}return _inherits(e,t),_createClass2(e,[{key:"ngOnChanges",value:function(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(t,e){if(!t.hasOwnProperty("model"))return!1;var n=t.model;return!!n.isFirstChange()||!In(e,n.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}},{key:"ngOnDestroy",value:function(){this.formDirective&&this.formDirective.removeControl(this)}},{key:"viewToModelUpdate",value:function(t){this.viewModel=t,this.update.emit(t)}},{key:"_setUpControl",value:function(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}},{key:"_setUpdateStrategy",value:function(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}},{key:"_isStandalone",value:function(){return!this._parent||!(!this.options||!this.options.standalone)}},{key:"_setUpStandalone",value:function(){nk(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}},{key:"_checkForErrors",value:function(){this._isStandalone()||this._checkParentType(),this._checkName()}},{key:"_checkParentType",value:function(){!(this._parent instanceof _k)&&this._parent instanceof bk?yk.formGroupNameException():this._parent instanceof _k||this._parent instanceof mk||yk.modelParentException()}},{key:"_checkName",value:function(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()||this.name||yk.missingNameException()}},{key:"_updateValue",value:function(t){var e=this;wk.then((function(){e.control.setValue(t,{emitViewToModelChange:!1})}))}},{key:"_updateDisabled",value:function(t){var e=this,n=t.isDisabled.currentValue,r=""===n||n&&"false"!==n;wk.then((function(){r&&!e.control.disabled?e.control.disable():!r&&e.control.disabled&&e.control.enable()}))}},{key:"path",get:function(){return this._parent?ek(this.name,this._parent):[this.name]}},{key:"formDirective",get:function(){return this._parent?this._parent.formDirective:null}},{key:"validator",get:function(){return ok(this._rawValidators)}},{key:"asyncValidator",get:function(){return ak(this._rawAsyncValidators)}}]),e}(UC),xk=function t(){_classCallCheck2(this,t)},Tk=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,null,[{key:"withConfig",value:function(e){return{ngModule:t,providers:[{provide:gk,useValue:e.warnOnDeprecatedNgFormSelector}]}}}]),t}();function Ck(t){return{width:t.clientWidth,height:t.clientHeight}}var kk=function(){function t(e){_classCallCheck2(this,t),this.elementRef=e,this.Block=Th,this.blockTypes=Object.values(Th),this.current=Th.Brick1,this.selected=new mo,this.object=new mo}return _createClass2(t,[{key:"ngAfterViewInit",value:function(){var t=this;this.blockTypes.forEach((function(e){var n=Ck(t.elementRef.nativeElement.querySelector(".".concat(e))),r=n.width,i=n.height;console.log(e,r,i),t.object.emit({type:e,width:r,height:i})}));var e=Ck(this.elementRef.nativeElement.querySelector(".selected")),n=e.width,r=e.height;this.selected.emit({type:this.current,width:n,height:r})}},{key:"select",value:function(t,e){this.current=e;var n=Ck(t.target),r=n.width,i=n.height;this.selected.emit({type:e,width:r,height:i})}}]),t}(),Sk=Lr({encapsulation:0,styles:[[".objects[_ngcontent-%COMP%]{display:block}.objects[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:inline-block;position:relative;margin:5px}.objects[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{border:3px solid brown;margin:2px}.objects[_ngcontent-%COMP%]   .bullet[_ngcontent-%COMP%], .objects[_ngcontent-%COMP%]   .explosion[_ngcontent-%COMP%], .objects[_ngcontent-%COMP%]   .tank[_ngcontent-%COMP%], .objects[_ngcontent-%COMP%]   .tank3[_ngcontent-%COMP%]{visibility:hidden}"]],data:{}});function Ak(t){return qa(0,[(t()(),Sa(0,0,null,null,0,"div",[],[[8,"className",0],[2,"selected",null]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.select(n,t.context.$implicit)&&r),r}),null,null))],null,(function(t,e){var n=e.component;t(e,0,0,ci(1,"block ",e.context.$implicit,""),n.current===e.context.$implicit)}))}function Ik(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[["class","objects"]],null,null,null,null,null)),(t()(),ka(16777216,null,null,1,null,Ak)),Hi(2,278528,null,0,Gl,[yr,vr,lr],{ngForOf:[0,"ngForOf"]},null)],(function(t,e){t(e,2,0,e.component.blockTypes)}),null)}n("6Joi");var Ok=n("wj3C"),Pk=n.n(Ok);(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function r(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function i(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:r(t)}}!function(t,r){if(r){var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(r=r(o=i[t=t[t.length-1]]))!=o&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Promise",(function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(n){e.reject(n)}}function r(){this.a=null}function o(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;r.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c((function(){e.g()}))}this.a.push(t)};var a=n.setTimeout;r.prototype.c=function(t){a(t,0)},r.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(r){this.f(r)}}}this.a=null},r.prototype.f=function(t){this.c((function(){throw t}))},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(n){return void this.g(n)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new r;return e.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(r){n.reject(r)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(n){o(n)}}:e}var i,o,a=new e((function(t,e){i=t,o=e}));return this.La(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.La=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e((function(e,n){n(t)}))},e.race=function(t){return new e((function(e,n){for(var r=i(t),a=r.next();!a.done;a=r.next())o(a.value).La(e,n)}))},e.all=function(t){var n=i(t),r=n.next();return r.done?o([]):new e((function(t,e){function i(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,o(r.value).La(i(a.length-1),e),r=n.next()}while(!r.done)}))},e}));var o=o||{},a=this||self;function s(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}var c=/^[\w+/_-]+[=]{0,2}$/,l=null;function h(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function d(t){return null===t}function p(t){return"array"==f(t)}function v(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function m(t){return"function"==f(t)}function y(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),b=0;function _(t,e,n){return t.call.apply(t.bind,arguments)}function w(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_:w).apply(null,arguments)}function x(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var T=Date.now||function(){return+new Date};function C(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.gd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function k(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(e){return!1}}function S(t){if(Error.captureStackTrace)Error.captureStackTrace(this,S);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function A(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");S.call(this,n+t[r])}function I(t,e){throw new A("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function O(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function P(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function D(){this.b=this.a=null}C(S,Error),S.prototype.name="CustomError",C(A,S),A.prototype.name="AssertionError",O.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var N=new O((function(){return new M}),(function(t){t.reset()}));function R(){var t=jt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function M(){this.next=this.b=this.a=null}function L(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(s){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(y(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(s){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;I("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}D.prototype.add=function(t,e){var n=N.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},M.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},M.prototype.reset=function(){this.next=this.b=this.a=null};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)},U=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=s(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},V=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function j(t,e){return 0<=B(t,e)}function q(t,e){var n;return(n=0<=(e=B(t,e)))&&Array.prototype.splice.call(t,e,1),n}function G(t,e){!function(t,e){for(var n=s(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,(function(n,r){e.call(void 0,n,r,t)&&Array.prototype.splice.call(t,r,1)}))}function z(t){return Array.prototype.concat.apply([],arguments)}function H(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function K(t){for(var e in t)return!1;return!0}function X(t){var e,n={};for(e in t)n[e]=t[e];return n}var Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Y.length;o++)n=Y[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function J(t,e){this.a=t===tt&&e||"",this.b=$}function Z(t){return t instanceof J&&t.constructor===J&&t.b===$?t.a:(I("expected object of type Const, got '"+t+"'"),"type_error:Const")}J.prototype.qa=!0,J.prototype.pa=function(){return this.a},J.prototype.toString=function(){return"Const{"+this.a+"}"};var $={},tt={},et=new J(tt,"");function nt(){this.a="",this.b=st}function rt(t){return t instanceof nt&&t.constructor===nt&&t.b===st?t.a:(I("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function it(t,e){var n=Z(t);if(!at.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return ut(t=n.replace(ot,(function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof J?Z(t):encodeURIComponent(String(t))})))}nt.prototype.qa=!0,nt.prototype.pa=function(){return this.a.toString()},nt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var ot=/%{(\w+)}/g,at=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,st={};function ut(t){var e=new nt;return e.a=t,e}var ct=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},lt=/&/g,ht=/</g,ft=/>/g,dt=/"/g,pt=/'/g,vt=/\x00/g,mt=/[\x00&<>"']/;function yt(t,e){return-1!=t.indexOf(e)}function gt(t,e){return t<e?-1:t>e?1:0}function bt(){this.a="",this.b=Tt}function _t(t){return t instanceof bt&&t.constructor===bt&&t.b===Tt?t.a:(I("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}bt.prototype.qa=!0,bt.prototype.pa=function(){return this.a.toString()},bt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var wt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Et(t){return t instanceof bt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),wt.test(t)||(t="about:invalid#zClosurez"),Ct(t))}var xt,Tt={};function Ct(t){var e=new bt;return e.a=t,e}Ct("about:blank");t:{var kt=a.navigator;if(kt){var St=kt.userAgent;if(St){xt=St;break t}}xt=""}function At(t){return yt(xt,t)}function It(){this.a="",this.b=Pt}function Ot(t){return t instanceof It&&t.constructor===It&&t.b===Pt?t.a:(I("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}It.prototype.qa=!0,It.prototype.pa=function(){return this.a.toString()},It.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Pt={};function Dt(t){var e=new It;return e.a=t,e}Dt("<!DOCTYPE html>");var Nt,Rt,Mt=Dt("");function Lt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function Bt(t){return mt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(lt,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ht,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ft,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(dt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(pt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(vt,"&#0;"))),t}function Ft(t){a.setTimeout((function(){throw t}),0)}function Ut(t,e){Rt||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);Rt=function(){t.then(qt)}}else Rt=function(){var t=qt;!m(a.setImmediate)||a.Window&&a.Window.prototype&&!At("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(Nt||(Nt=function(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!At("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=ut(Z(et));L(t,"HTMLIFrameElement"),t.src=rt(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(Ot(Mt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=E((function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0!==t&&!At("Trident")&&!At("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){a.setTimeout(t,0)}}()),Nt(t)):a.setImmediate(t)}}(),Vt||(Rt(),Vt=!0),jt.add(t,e)}Dt("<br>");var Vt=!1,jt=new D;function qt(){for(var t;t=R();){try{t.a.call(t.b)}catch(e){Ft(e)}P(N,t)}Vt=!1}function Gt(t,e){if(this.a=zt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=h)try{var n=this;t.call(e,(function(t){ne(n,Ht,t)}),(function(t){if(!(t instanceof ce))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(e){}ne(n,Wt,t)}))}catch(r){ne(this,Wt,r)}}var zt=0,Ht=2,Wt=3;function Kt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Kt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Xt=new O((function(){return new Kt}),(function(t){t.reset()}));function Yt(t,e,n){var r=Xt.get();return r.g=t,r.b=e,r.f=n,r}function Qt(t){if(t instanceof Gt)return t;var e=new Gt(h);return ne(e,Ht,t),e}function Jt(t){return new Gt((function(e,n){n(t)}))}function Zt(t,e,n){re(t,e,n,null)||Ut(x(e,t))}function $t(t){return new Gt((function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Gb:!0,value:o}:{Gb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Zt(t[o],x(i,o,!0),x(i,o,!1));else e(r)}))}function te(t,e){t.b||t.a!=Ht&&t.a!=Wt||ie(t),t.f?t.f.next=e:t.b=e,t.f=e}function ee(t,e,n,r){var i=Yt(null,null,null);return i.a=new Gt((function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(a){o(a)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof ce?o(e):t(i)}catch(a){o(a)}}:o})),i.a.c=t,te(t,i),i.a}function ne(t,e,n){t.a==zt&&(t===n&&(e=Wt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,re(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,ie(t),e!=Wt||n instanceof ce||function(t,e){t.g=!0,Ut((function(){t.g&&ue.call(null,e)}))}(t,n)))}function re(t,e,n,r){if(t instanceof Gt)return te(t,Yt(e||h,n||null,r)),!0;if(k(t))return t.then(e,n,r),!0;if(y(t))try{var i=t.then;if(m(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,(function(t){a||(a=!0,n.call(i,t))}),o)}catch(s){o(s)}}(t,i,e,n,r),!0}catch(o){return n.call(r,o),!0}return!1}function ie(t){t.h||(t.h=!0,Ut(t.Zb,t))}function oe(t){var e=null;return t.b&&(t.b=(e=t.b).next,e.next=null),t.b||(t.f=null),e}function ae(t,e,n,r){if(n==Wt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,se(e,n,r);else try{e.c?e.g.call(e.f):se(e,n,r)}catch(i){ue.call(null,i)}P(Xt,e)}function se(t,e,n){e==Ht?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}Gt.prototype.then=function(t,e,n){return ee(this,m(t)?t:null,m(e)?e:null,n)},Gt.prototype.$goog_Thenable=!0,(t=Gt.prototype).ka=function(t,e){return(t=Yt(t,t,e)).c=!0,te(this,t),this},t.s=function(t,e){return ee(this,null,t,e)},t.cancel=function(t){this.a==zt&&Ut((function(){!function t(e,n){if(e.a==zt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==zt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):oe(r),ae(r,o,Wt,n)))}e.c=null}else ne(e,Wt,n)}(this,new ce(t))}),this)},t.Oc=function(t){this.a=zt,ne(this,Ht,t)},t.Pc=function(t){this.a=zt,ne(this,Wt,t)},t.Zb=function(){for(var t;t=oe(this);)ae(this,t,this.a,this.i);this.h=!1};var ue=Ft;function ce(t){S.call(this,t)}function le(){0!=he&&(fe[this[g]||(this[g]=++b)]=this),this.va=this.va,this.la=this.la}C(ce,S),ce.prototype.name="cancel";var he=0,fe={};function de(t){if(!t.va&&(t.va=!0,t.za(),0!=he)){var e=t[g]||(t[g]=++b);if(0!=he&&t.la&&0<t.la.length)throw Error(t+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete fe[e]}}function pe(t){return pe[" "](t),t}le.prototype.va=!1,le.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},pe[" "]=h;var ve,me,ye=At("Opera"),ge=At("Trident")||At("MSIE"),be=At("Edge"),_e=be||ge,we=At("Gecko")&&!(yt(xt.toLowerCase(),"webkit")&&!At("Edge"))&&!(At("Trident")||At("MSIE"))&&!At("Edge"),Ee=yt(xt.toLowerCase(),"webkit")&&!At("Edge");function xe(){var t=a.document;return t?t.documentMode:void 0}t:{var Te="",Ce=(me=xt,we?/rv:([^\);]+)(\)|;)/.exec(me):be?/Edge\/([\d\.]+)/.exec(me):ge?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(me):Ee?/WebKit\/(\S+)/.exec(me):ye?/(?:Version)[ \/]?(\S+)/.exec(me):void 0);if(Ce&&(Te=Ce?Ce[1]:""),ge){var ke=xe();if(null!=ke&&ke>parseFloat(Te)){ve=String(ke);break t}}ve=Te}var Se,Ae={};function Ie(t){return function(t,e){var n=Ae;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,(function(){for(var e=0,n=ct(String(ve)).split("."),r=ct(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=gt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||gt(0==a[2].length,0==s[2].length)||gt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e}))}Se=a.document&&ge?xe():void 0;var Oe=Object.freeze||function(t){return t},Pe=!ge||9<=Number(Se),De=ge&&!Ie("9"),Ne=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",h,e),a.removeEventListener("test",h,e)}catch(n){}return t}();function Re(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Me(t,e){if(Re.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(we){t:{try{pe(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:Le[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Re.prototype.preventDefault=function(){this.Mb=!1},C(Me,Re);var Le=Oe({2:"touch",3:"pen",4:"mouse"});Me.prototype.preventDefault=function(){Me.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}},Me.prototype.f=function(){return this.a};var Be="closure_listenable_"+(1e6*Math.random()|0),Fe=0;function Ue(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Pa=i,this.key=++Fe,this.ta=this.Ka=!1}function Ve(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function je(t){this.src=t,this.a={},this.b=0}function qe(t,e){var n=e.type;n in t.a&&q(t.a[n],e)&&(Ve(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Ge(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==r)return i}return-1}je.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ge(t,e,r,i);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new Ue(e,this.src,o,!!r,i)).Ka=n,t.push(e)),e};var ze="closure_lm_"+(1e6*Math.random()|0),He={};function We(t,e,n,r,i){if(r&&r.once)Xe(t,e,n,r,i);else if(p(e))for(var o=0;o<e.length;o++)We(t,e[o],n,r,i);else n=rn(n),t&&t[Be]?an(t,e,n,y(r)?!!r.capture:!!r,i):Ke(t,e,n,!1,r,i)}function Ke(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=y(i)?!!i.capture:!!i,s=en(t);if(s||(t[ze]=s=new je(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=tn,e=Pe?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ne||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Je(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function Xe(t,e,n,r,i){if(p(e))for(var o=0;o<e.length;o++)Xe(t,e[o],n,r,i);else n=rn(n),t&&t[Be]?sn(t,e,n,y(r)?!!r.capture:!!r,i):Ke(t,e,n,!0,r,i)}function Ye(t,e,n,r,i){if(p(e))for(var o=0;o<e.length;o++)Ye(t,e[o],n,r,i);else r=y(r)?!!r.capture:!!r,n=rn(n),t&&t[Be]?(t=t.u,(e=String(e).toString())in t.a&&-1<(n=Ge(o=t.a[e],n,r,i))&&(Ve(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=en(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Ge(e,n,r,i)),(n=-1<t?e[t]:null)&&Qe(n))}function Qe(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[Be])qe(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Je(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=en(e))?(qe(n,t),0==n.b&&(n.src=null,e[ze]=null)):Ve(t)}}}function Je(t){return t in He?He[t]:He[t]="on"+t}function Ze(t,e,n,r){var i=!0;if((t=en(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=$e(o,r),i=i&&!1!==o)}return i}function $e(t,e){var n=t.listener,r=t.Pa||t.src;return t.Ka&&Qe(t),n.call(r,e)}function tn(t,e){if(t.ta)return!0;if(!Pe){if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Me(r=e,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(s){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Ze(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Ze(r[i],t,!1,e),n=n&&o}return n}return $e(t,new Me(e,this))}function en(t){return(t=t[ze])instanceof je?t:null}var nn="__closure_events_fn_"+(1e9*Math.random()>>>0);function rn(t){return m(t)?t:(t[nn]||(t[nn]=function(e){return t.handleEvent(e)}),t[nn])}function on(){le.call(this),this.u=new je(this),this.Sb=this,this.Xa=null}function an(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function sn(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function un(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&qe(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function cn(t,e,n){if(m(t))n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function ln(t){var e=null;return new Gt((function(n,r){-1==(e=cn((function(){n(void 0)}),t))&&r(Error("Failed to schedule timer."))})).s((function(t){throw a.clearTimeout(e),t}))}function hn(t){if(t.U&&"function"==typeof t.U)return t.U();if(s(t))return t.split("");if(v(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function fn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(v(t)||s(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function dn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof dn)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function pn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];vn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)vn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function vn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}C(on,le),on.prototype[Be]=!0,on.prototype.addEventListener=function(t,e,n,r){We(this,t,e,n,r)},on.prototype.removeEventListener=function(t,e,n,r){Ye(this,t,e,n,r)},on.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var r=t.type||t;if(s(t))t=new Re(t,n);else if(t instanceof Re)t.target=t.target||n;else{var i=t;Q(t=new Re(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=un(a,r,!0,t)&&i}if(i=un(a=t.b=n,r,!0,t)&&i,i=un(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=un(a=t.b=e[o],r,!1,t)&&i;return i},on.prototype.za=function(){if(on.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ve(n[r]);delete e.a[t],e.b--}}this.Xa=null},(t=dn.prototype).U=function(){pn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return pn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return vn(this.b,t)?this.b[t]:e},t.set=function(t,e){vn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var mn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function yn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof yn?(this.h=void 0!==e?e:t.h,gn(this,t.f),this.i=t.i,this.b=t.b,bn(this,t.l),this.c=t.c,_n(this,Un(t.a)),this.g=t.g):t&&(n=String(t).match(mn))?(this.h=!!e,gn(this,n[1]||"",!0),this.i=Cn(n[2]||""),this.b=Cn(n[3]||"",!0),bn(this,n[4]),this.c=Cn(n[5]||"",!0),_n(this,n[6]||"",!0),this.g=Cn(n[7]||"")):(this.h=!!e,this.a=new Nn(null,this.h))}function gn(t,e,n){t.f=n?Cn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function bn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.l=e}else t.l=null}function _n(t,e,n){e instanceof Nn?(t.a=e,function(t,e){e&&!t.f&&(Rn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ln(this,e),Fn(this,n,t))}),t)),t.f=e}(t.a,t.h)):(n||(e=kn(e,Pn)),t.a=new Nn(e,t.h))}function wn(t,e,n){t.a.set(e,n)}function En(t,e){return t.a.get(e)}function xn(t){return t instanceof yn?new yn(t):new yn(t,void 0)}function Tn(t,e){var n=new yn(null,void 0);return gn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function kn(t,e,n){return s(t)?(t=encodeURI(t).replace(e,Sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}yn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(kn(e,An,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(kn(e,An,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(kn(n,"/"==n.charAt(0)?On:In,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",kn(n,Dn)),t.join("")},yn.prototype.resolve=function(t){var e=new yn(this),n=!!t.f;n?gn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)bn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(yt(i,"./")||yt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?_n(e,Un(t.a)):n=!!t.g,n&&(e.g=t.g),e};var An=/[#\/\?@]/g,In=/[#\?:]/g,On=/[#\?]/g,Pn=/[#\?@]/g,Dn=/#/g;function Nn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Rn(t){t.a||(t.a=new dn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Mn(t){var e=fn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Nn(null,void 0);t=hn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];p(o)?Fn(n,i,o):n.add(i,o)}return n}function Ln(t,e){Rn(t),e=Vn(t,e),vn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,vn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&pn(t)))}function Bn(t,e){return Rn(t),e=Vn(t,e),vn(t.a.b,e)}function Fn(t,e,n){Ln(t,e),0<n.length&&(t.c=null,t.a.set(Vn(t,e),H(n)),t.b+=n.length)}function Un(t){var e=new Nn;return e.c=t.c,t.a&&(e.a=new dn(t.a),e.b=t.b),e}function Vn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Nn.prototype).add=function(t,e){Rn(this),this.c=null,t=Vn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){Rn(this),this.a.forEach((function(n,r){F(n,(function(n){t.call(e,n,r,this)}),this)}),this)},t.X=function(){Rn(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){Rn(this);var e=[];if(s(t))Bn(this,t)&&(e=z(e,this.a.get(Vn(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=z(e,t[n])}return e},t.set=function(t,e){return Rn(this),this.c=null,Bn(this,t=Vn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var jn=!ge||9<=Number(Se);function qn(t){var e=document;return s(t)?e.getElementById(t):t}function Gn(t,e){W(e,(function(e,n){e&&"object"==typeof e&&e.qa&&(e=e.pa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:zn.hasOwnProperty(n)?t.setAttribute(zn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e}))}var zn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Hn(t){if(t&&"number"==typeof t.length){if(y(t))return"function"==typeof t.item||"string"==typeof t.item;if(m(t))return"function"==typeof t.item}return!1}function Wn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(p(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&"function"!=typeof(a=n[i])&&(r.push(o),Qn(i,r),r.push(":"),t(e,a,r),o=",");return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Qn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Kn,t,e),e.join("")}function Kn(){}var Xn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Yn=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Qn(t,e){e.push('"',t.replace(Yn,(function(t){var e=Xn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Xn[t]=e),e})),'"')}function Jn(){var t=mr();return ge&&!!Se&&11==Se||/Edge\/\d+/.test(t)}function Zn(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||a.window;var n="about:blank";t&&(n=_t(Et(t)).toString()),e.location.href=n}function tr(t){return!!((t=(t||mr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function er(t){t=t||a.window;try{t.close()}catch(e){}}function nr(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=mr().toLowerCase(),r&&(e.target=r,yt(n,"crios/")&&(e.target="_blank")),dr(mr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof bt?n:Et(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((At("iPhone")&&!At("iPod")&&!At("iPad")||At("iPad")||At("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(L(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof bt||e instanceof bt||(e="object"==typeof e&&e.qa?e.pa():String(e),wt.test(e)||(e="about:invalid#zClosurez"),e=Ct(e)),a.href=_t(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=_t(e).toString(),a&&(_e&&yt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+Bt(t)+'">'),a.document.write(Ot(t)),a.document.close())):(a=r.open(_t(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(s){}return a}var rr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ir=/^[^@]+@[^@]+$/;function or(){var t=null;return new Gt((function(e){"complete"==a.document.readyState?e():(t=function(){e()},Xe(window,"load",t))})).s((function(e){throw Ye(window,"load",t),e}))}function ar(t){return t=t||mr(),!("file:"!==wr()&&"ionic:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function sr(){var t=a.window;try{return!(!t||t==t.top)}catch(e){return!1}}function ur(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function cr(){return Pk.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Pk.a.INTERNAL.hasOwnProperty("node")?"Node":ur()?"Worker":"Browser"}function lr(){var t=cr();return"ReactNative"===t||"Node"===t}var hr="Firefox",fr="Chrome";function dr(t){var e=t.toLowerCase();return yt(e,"opera/")||yt(e,"opr/")||yt(e,"opios/")?"Opera":yt(e,"iemobile")?"IEMobile":yt(e,"msie")||yt(e,"trident/")?"IE":yt(e,"edge/")?"Edge":yt(e,"firefox/")?hr:yt(e,"silk/")?"Silk":yt(e,"blackberry")?"Blackberry":yt(e,"webos")?"Webos":!yt(e,"safari/")||yt(e,"chrome/")||yt(e,"crios/")||yt(e,"android")?!yt(e,"chrome/")&&!yt(e,"crios/")||yt(e,"edge/")?yt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":fr:"Safari"}var pr={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function vr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=cr())?r=dr(i=mr()):"Worker"===r&&(r=dr(i=mr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function mr(){return a.navigator&&a.navigator.userAgent||""}function yr(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function gr(){try{var t=a.localStorage,e=kr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Jn()||!!a.indexedDB}catch(n){return ur()&&!!a.indexedDB}return!1}function br(){return(_r()||"chrome-extension:"===wr()||ar())&&!lr()&&gr()&&!ur()}function _r(){return"http:"===wr()||"https:"===wr()}function wr(){return a.location&&a.location.protocol||null}function Er(t){return!tr(t=t||mr())&&dr(t)!=hr}function xr(t){return void 0===t?null:Wn(t)}function Tr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!=t[e]&&(n[e]=t[e]);return n}function Cr(t){if(null!==t)return JSON.parse(t)}function kr(t){return t||Math.floor(1e9*Math.random()).toString()}function Sr(t){return"Safari"!=dr(t=t||mr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Ar(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ir(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=mr(),e=cr(),this.b=tr(t)||"ReactNative"===e}function Or(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Pr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(n){}return null}function Dr(){return!(!yr("fireauth.oauthhelper",a)&&!yr("fireauth.iframe",a))}Ir.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!_r()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Nr,Rr={};function Mr(t){Rr[t]||(Rr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Lr={};Object.defineProperty(Lr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Lr,"abcd",{configurable:!0,enumerable:!0,value:2}),Nr=2==Lr.abcd}catch(me){Nr=!1}function Br(t,e,n){Nr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Br(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function Vr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Br(e,n,Vr(t[n]));return e}function jr(t){var e={},n=t[Gr],r=t[zr];if(!(t=t[Hr])||t!=qr&&!n)throw Error("Invalid provider user info!");e[Kr]=r||null,e[Wr]=n||null,Br(this,Yr,t),Br(this,Xr,Vr(e))}var qr="EMAIL_SIGNIN",Gr="email",zr="newEmail",Hr="requestType",Wr="email",Kr="fromEmail",Xr="data",Yr="operation";function Qr(t,e){this.code=Zr+t,this.message=e||$r[t]||""}function Jr(t){var e=t&&t.code;return e?new Qr(e.substring(Zr.length),t.message):null}C(Qr,Error),Qr.prototype.A=function(){return{code:this.code,message:this.message}},Qr.prototype.toJSON=function(){return this.A()};var Zr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function ti(t){var e=En(t=xn(t),ei)||null,n=En(t,ni)||null,r=En(t,oi)||null;if(r=r&&si[r]||null,!e||!n||!r)throw new Qr("argument-error",ei+", "+ni+"and "+oi+" are required in a valid action code URL.");Fr(this,{apiKey:e,operation:r,code:n,continueUrl:En(t,ri)||null,languageCode:En(t,ii)||null,tenantId:En(t,ai)||null})}var ei="apiKey",ni="oobCode",ri="continueUrl",ii="languageCode",oi="mode",ai="tenantId",si={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:qr,verifyEmail:"VERIFY_EMAIL"};function ui(t){try{return new ti(t)}catch(e){return null}}function ci(t){var e=t[pi];if(void 0===e)throw new Qr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Qr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[li];if(n&&"object"==typeof n){e=n[yi];var r=n[vi];if(n=n[mi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Qr("argument-error",vi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Qr("argument-error",mi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Qr("argument-error",yi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Qr("missing-android-pkg-name")}}else if(void 0!==n)throw new Qr("argument-error",li+" property must be a non null object when specified.");if(this.f=null,(e=t[di])&&"object"==typeof e){if("string"==typeof(e=e[gi])&&e.length)this.f=e;else if(void 0!==e)throw new Qr("argument-error",gi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Qr("argument-error",di+" property must be a non null object when specified.");if(void 0!==(e=t[fi])&&"boolean"!=typeof e)throw new Qr("argument-error",fi+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Qr("argument-error",hi+" property must be a non empty string when specified.");this.i=t||null}var li="android",hi="dynamicLinkDomain",fi="handleCodeInApp",di="iOS",pi="url",vi="installApp",mi="minimumVersion",yi="packageName",gi="bundleId";function bi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var _i=null,wi=null;function Ei(t){this.f=t.sub,T(),this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function xi(t){return(t=Ti(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ei(t):null}function Ti(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(function(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=wi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!_i){_i={},wi={};for(var t=0;65>t;t++)_i[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),wi[_i[t]]=t,62<=t&&(wi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,(function(t){e+=String.fromCharCode(t)})),e}(t))}catch(r){}return null}Ei.prototype.R=function(){return this.c},Ei.prototype.g=function(){return this.b};var Ci,ki={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Si(t){for(var e in ki)if(ki[e].id===t)return{firebaseEndpoint:(t=ki[e]).cb,secureTokenEndpoint:t.ib};return null}Ci=Si("__EID__")?"__EID__":void 0;var Ai="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ii=["client_id","response_type","scope","redirect_uri","state"],Oi={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:Ii},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:Ii},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:Ii},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Ai},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function Pi(t){for(var e in Oi)if(Oi[e].Fa==t)return Oi[e];return null}function Di(t){var e={};e["facebook.com"]=Bi,e["google.com"]=Ui,e["github.com"]=Fi,e["twitter.com"]=Vi;var n=t&&t[Ri];try{if(n)return e[n]?new e[n](t):new Li(t);if(void 0!==t[Ni])return new Mi(t)}catch(r){}return null}var Ni="idToken",Ri="providerId";function Mi(t){var e=t[Ri];if(!e&&t[Ni]){var n=xi(t[Ni]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Br(this,"providerId",e),Br(this,"isNewUser",n)}function Li(t){Mi.call(this,t),Br(this,"profile",Vr((t=Cr(t.rawUserInfo||"{}"))||{}))}function Bi(t){if(Li.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Fi(t){if(Li.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Br(this,"username",this.profile&&this.profile.login||null)}function Ui(t){if(Li.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Vi(t){if(Li.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Br(this,"username",t.screenName||null)}function ji(t){var e=xn(t),n=En(e,"link"),r=En(xn(n),"link");return e=En(e,"deep_link_id"),En(xn(e),"link")||e||r||n||t}function qi(){}function Gi(t,e){return t.then((function(t){if(t[Ia]){var n=xi(t[Ia]);if(!n||e!=n.f)throw new Qr("user-mismatch");return t}throw new Qr("user-mismatch")})).s((function(t){throw t&&t.code&&t.code==Zr+"user-not-found"?new Qr("user-mismatch"):t}))}function zi(t,e){if(!e)throw new Qr("internal-error","failed to construct a credential");this.a=e,Br(this,"providerId",t),Br(this,"signInMethod",t)}function Hi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Wi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new zi(t.providerId,t.pendingToken)}catch(e){}return null}function Ki(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Br(this,"idToken",e.idToken),e.accessToken&&Br(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Br(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Qr("internal-error","failed to construct a credential");Br(this,"accessToken",e.oauthToken),Br(this,"secret",e.oauthTokenSecret)}Br(this,"providerId",t),Br(this,"signInMethod",n)}function Xi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Mn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Ki(t.providerId,e,t.signInMethod)}catch(n){}}return null}function Qi(t,e){this.Fc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Pi(t)||{}).Ea||null,this.bb=null}function Ji(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Qr("argument-error",'SAML provider IDs must be prefixed with "saml."');Qi.call(this,t,[])}function Zi(t){Qi.call(this,t,Ii),this.a=[]}function $i(){Zi.call(this,"facebook.com")}function to(t){if(!t)throw new Qr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return y(t)&&(e=t.accessToken),(new $i).credential({accessToken:e})}function eo(){Zi.call(this,"github.com")}function no(t){if(!t)throw new Qr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return y(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function ro(){Zi.call(this,"google.com"),this.ya("profile")}function io(t,e){var n=t;return y(t)&&(n=t.idToken,e=t.accessToken),(new ro).credential({idToken:n,accessToken:e})}function oo(){Qi.call(this,"twitter.com",Ai)}function ao(t,e){var n=t;if(y(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Qr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Ki("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,Br(this,"providerId","password"),Br(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function lo(t,e){if(!(e=ho(e)))throw new Qr("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function ho(t){return(t=ui(t=ji(t)))&&t.operation===qr?t:null}function fo(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new Qr("internal-error");this.a=t,Br(this,"providerId","phone"),Br(this,"signInMethod","phone")}function po(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return F(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){t[n]&&(e[n]=t[n])})),new fo(e)}return null}function vo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function mo(t){try{this.a=t||Pk.a.auth()}catch(e){throw new Qr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function yo(t,e){if(!t)throw new Qr("missing-verification-id");if(!e)throw new Qr("missing-verification-code");return new fo({Va:t,Ua:e})}function go(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return io(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new zi(e,a):new Ki(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Zi(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(s){return null}}function bo(t){if(!t.isOAuthProvider)throw new Qr("invalid-oauth-provider")}function _o(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Qr("invalid-auth-event");if(this.g&&this.a)throw new Qr("invalid-auth-event");if(this.g&&!this.f)throw new Qr("invalid-auth-event")}function wo(t){return(t=t||{}).type?new _o(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Jr(t.error),t.postBody,t.tenantId):null}function Eo(){this.b=null,this.a=[]}C(Li,Mi),C(Bi,Li),C(Fi,Li),C(Ui,Li),C(Vi,Li),zi.prototype.na=function(t){return Ka(t,Hi(this))},zi.prototype.b=function(t,e){var n=Hi(this);return n.idToken=e,Xa(t,n)},zi.prototype.f=function(t,e){return Gi(Ya(t,Hi(this)),e)},zi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Ki.prototype.na=function(t){return Ka(t,Xi(this))},Ki.prototype.b=function(t,e){var n=Xi(this);return n.idToken=e,Xa(t,n)},Ki.prototype.f=function(t,e){return Gi(Ya(t,Xi(this)),e)},Ki.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Qi.prototype.Ga=function(t){return this.zb=X(t),this},C(Ji,Qi),C(Zi,Qi),Zi.prototype.ya=function(t){return j(this.a,t)||this.a.push(t),this},Zi.prototype.Hb=function(){return H(this.a)},Zi.prototype.credential=function(t,e){var n;if(!(n=y(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Qr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Ki(this.providerId,n,this.providerId)},C($i,Zi),Br($i,"PROVIDER_ID","facebook.com"),Br($i,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),C(eo,Zi),Br(eo,"PROVIDER_ID","github.com"),Br(eo,"GITHUB_SIGN_IN_METHOD","github.com"),C(ro,Zi),Br(ro,"PROVIDER_ID","google.com"),Br(ro,"GOOGLE_SIGN_IN_METHOD","google.com"),C(oo,Qi),Br(oo,"PROVIDER_ID","twitter.com"),Br(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ts(t,rs,{email:this.a,oobCode:this.c}):Ts(t,_s,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ts(t,is,{idToken:e,email:this.a,oobCode:this.c}):Ts(t,ps,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Gi(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(co,{PROVIDER_ID:"password"}),Fr(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Wa(vo(this))},fo.prototype.b=function(t,e){var n=vo(this);return n.idToken=e,Ts(t,Es,n)},fo.prototype.f=function(t,e){var n=vo(this);return n.operation="REAUTH",Gi(t=Ts(t,xs,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},mo.prototype.Wa=function(t,e){var n=this.a.b;return Qt(e.verify()).then((function(r){if(!s(r))throw new Qr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return Ts(t,fs,e)}(n,{phoneNumber:t,recaptchaToken:r}).then((function(t){return"function"==typeof e.reset&&e.reset(),t}),(function(t){throw"function"==typeof e.reset&&e.reset(),t}));default:throw new Qr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},Fr(mo,{PROVIDER_ID:"phone"}),Fr(mo,{PHONE_SIGN_IN_METHOD:"phone"}),_o.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},_o.prototype.R=function(){return this.h},_o.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var xo,To=null;function Co(t){var e="unauthorized-domain",n=void 0,r=xn(t);t=r.b,"chrome-extension"==(r=r.f)?n=Lt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Lt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Qr.call(this,e,n)}function ko(t,e,n){Qr.call(this,t,n),(t=e||{}).Ab&&Br(this,"email",t.Ab),t.ba&&Br(this,"phoneNumber",t.ba),t.credential&&Br(this,"credential",t.credential),t.Qb&&Br(this,"tenantId",t.Qb)}function So(t){if(t.code){var e=t.code||"";0==e.indexOf(Zr)&&(e=e.substring(Zr.length));var n={credential:go(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Qr(e,t.message||void 0);return new ko(e,n,t.message)}return null}function Ao(){}function Io(){}function Oo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(i){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Po(){}function Do(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=E(this.fc,this),this.a.onerror=E(this.Ib,this),this.a.onprogress=E(this.gc,this),this.a.ontimeout=E(this.kc,this)}function No(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Ro(t,e,n){this.reset(t,e,n,void 0,void 0)}function Mo(t){this.f=t,this.b=this.c=this.a=null}function Lo(t,e){this.name=t,this.value=e}C(Co,Qr),C(ko,Qr),ko.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&Q(t,e),t},ko.prototype.toJSON=function(){return this.A()},Ao.prototype.c=null,C(Io,Ao),Io.prototype.a=function(){var t=Oo(this);return t?new ActiveXObject(t):new XMLHttpRequest},Io.prototype.b=function(){var t={};return Oo(this)&&(t[0]=!0,t[1]=!0),t},xo=new Io,C(Po,Ao),Po.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Do;throw Error("Unsupported browser")},Po.prototype.b=function(){return{}},(t=Do.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,No(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",No(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,No(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Ro.prototype.a=null,Ro.prototype.reset=function(t,e,n,r,i){r||T(),delete this.a},Lo.prototype.toString=function(){return this.name};var Bo=new Lo("SEVERE",1e3),Fo=new Lo("WARNING",900),Uo=new Lo("CONFIG",700),Vo=new Lo("FINE",500);Mo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(I("Root logger has no level set."),null)}(this).value)for(m(e)&&(e=e()),t=new Ro(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var jo={},qo=null;function Go(t){var e;if(qo||(qo=new Mo(""),jo[""]=qo,qo.c=Uo),!(e=jo[t])){e=new Mo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Go(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,jo[t]=e}return e}function zo(t,e){t&&t.log(Vo,e,void 0)}function Ho(t){this.f=t}function Wo(t){on.call(this),this.o=t,this.readyState=Ko,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Go("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}C(Ho,Ao),Ho.prototype.a=function(){return new Wo(this.f)},Ho.prototype.b=function(t){return function(){return t}}({}),C(Wo,on);var Ko=0;function Xo(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function Yo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Qo(t)}function Qo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Jo(t){on.call(this),this.headers=new dn,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=Zo,this.v=this.P=!1}(t=Wo.prototype).open=function(t,e){if(this.readyState!=Ko)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,Qo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Yo(this,!1)),this.readyState=Ko},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Qo(this)),this.a&&(this.readyState=3,Qo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Xo(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Yo(this,!0):Qo(this),3==this.readyState&&Xo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Yo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Yo(this,!0))},t.Oa=function(t){var e=this.h;e&&e.log(Fo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Yo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Fo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Fo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},C(Jo,on);var Zo="";Jo.prototype.b=Go("goog.net.XhrIo");var $o=/^https?$/i,ta=["POST","PUT"];function ea(t){return"content-type"==t.toLowerCase()}function na(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ra(t),oa(t)}function ra(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function ia(t){if(t.c&&void 0!==o)if(t.w[1]&&4==sa(t)&&2==ua(t))zo(t.b,ca(t,"Local request error detected and ignored"));else if(t.i&&4==sa(t))cn(t.Lb,0,t);else if(t.dispatchEvent("readystatechange"),4==sa(t)){zo(t.b,ca(t,"Request complete")),t.c=!1;try{var e,n=ua(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.l).match(mn)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!$o.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<sa(t)?t.a.statusText:""}catch(l){zo(t.b,"Can not get status: "+l.message),c=""}t.h=c+" ["+ua(t)+"]",ra(t)}}finally{oa(t)}}}function oa(t,e){if(t.a){aa(t);var n=t.a,r=t.w[0]?h:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(i){(t=t.b)&&t.log(Bo,"Problem encountered resetting onreadystatechange: "+i.message,void 0)}}}function aa(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(a.clearTimeout(t.o),t.o=null)}function sa(t){return t.a?t.a.readyState:0}function ua(t){try{return 2<sa(t)?t.a.status:-1}catch(e){return-1}}function ca(t,e){return e+" ["+t.O+" "+t.l+" "+ua(t)+"]"}function la(t){var e=wa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function ha(t,e,n){t.a=!0,t.c=n,t.f=!e,va(t)}function fa(t){if(t.a){if(!t.u)throw new ma(t);t.u=!1}}function da(t,e,n,r){t.g.push([e,n,r]),t.a&&va(t)}function pa(t){return V(t.g,(function(t){return m(t[1])}))}function va(t){if(t.h&&t.a&&pa(t)){var e=t.h,n=ba[e];n&&(a.clearTimeout(n.a),delete ba[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var u=o.call(i||t.o,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(k(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(c){e=c,t.f=!0,pa(t)||(n=!0)}}t.c=e,r&&(u=E(t.m,t,!0),r=E(t.m,t,!1),e instanceof la?(da(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new ga(e),ba[e.a]=e,t.h=e.a)}function ma(){S.call(this)}function ya(){S.call(this)}function ga(t){this.a=a.setTimeout(E(this.c,this),0),this.b=t}(t=Jo.prototype).Ia=function(){void 0!==o&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",zo(this.b,ca(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(zo(this.b,ca(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),oa(this))},t.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),oa(this,!0)),Jo.qb.za.call(this)},t.Lb=function(){this.va||(this.J||this.i||this.f?ia(this):this.yc())},t.yc=function(){ia(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Zo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Bo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(e){return zo(this.b,"Can not get response: "+e.message),null}},la.prototype.cancel=function(t){if(this.a)this.c instanceof la&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new ya(this),fa(this),ha(this,!1,t))}},la.prototype.m=function(t,e){this.i=!1,ha(this,t,e)},la.prototype.then=function(t,e,n){var r,i,o=new Gt((function(t,e){r=t,i=e}));return da(this,r,(function(t){t instanceof ya?o.cancel():i(t)})),o.then(t,e,n)},la.prototype.$goog_Thenable=!0,C(ma,S),ma.prototype.message="Deferred has already fired",ma.prototype.name="AlreadyCalledError",C(ya,S),ya.prototype.message="Deferred was canceled",ya.prototype.name="CanceledError",ga.prototype.c=function(){throw delete ba[this.a],this.b};var ba={};function _a(t){var e={},n=e.document||document,r=rt(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ia:void 0},s=new la(o),u=null,h=null!=e.timeout?e.timeout:5e3;return 0<h&&(u=window.setTimeout((function(){Ea(i,!0);var t=new Ca(Ta,"Timeout reached for loading script "+r);fa(s),ha(s,!1,t)}),h),o.Ia=u),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ea(i,e.hd||!1,u),fa(s),ha(s,!0,null))},i.onerror=function(){Ea(i,!0,u);var t=new Ca(xa,"Error while loading script "+r);fa(s),ha(s,!1,t)},Q(o=e.attributes||{},{type:"text/javascript",charset:"UTF-8"}),Gn(i,o),function(t,e){L(t,"HTMLScriptElement"),t.src=rt(e),null===l&&(l=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=l)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function wa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ea(t,!0,this.Ia)}}function Ea(t,e,n){null!=n&&a.clearTimeout(n),t.onload=h,t.onerror=h,t.onreadystatechange=h,e&&window.setTimeout((function(){t&&t.parentNode&&t.parentNode.removeChild(t)}),0)}var xa=0,Ta=1;function Ca(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),S.call(this,n),this.code=t}function ka(t){this.f=t}function Sa(t,e,n){if(this.c=t,this.l=(t=e||{}).secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Oa,this.g=X(t.secureTokenHeaders||Pa),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||Da,this.a=X(t.firebaseHeaders||Na),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==cr(),!(n=a.XMLHttpRequest||n&&Pk.a.INTERNAL.node&&Pk.a.INTERNAL.node.XMLHttpRequest)&&!ur())throw new Qr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,this.f=ur()?new Ho(self):lr()?new ka(n):new Po,this.b=null}C(Ca,S),C(ka,Ao),ka.prototype.a=function(){return new this.f},ka.prototype.b=function(){return{}};var Aa,Ia="idToken",Oa=new Ir(3e4,6e4),Pa={"Content-Type":"application/x-www-form-urlencoded"},Da=new Ir(3e4,6e4),Na={"Content-Type":"application/json"};function Ra(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ma(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function La(t,e,n,r,i,o,s){(function(){var t=mr();return!((t=dr(t)!=fr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||ge&&Se&&!(9<Se))})()||ur()?t=E(t.o,t):(Aa||(Aa=new Gt((function(t,e){!function(t,e){((window.gapi||{}).client||{}).request?t():(a[Fa]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){da(t,null,e,void 0)}(_a(it(Ba,{onload:Fa})),(function(){e(Error("CORS_UNSUPPORTED"))})))}(t,e)}))),t=E(t.m,t)),t(e,n,r,i,o,s)}Sa.prototype.R=function(){return this.b},Sa.prototype.o=function(t,e,n,r,i,o){if(ur()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new Qr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var u=new Jo(this.f);if(o){u.g=Math.max(0,o);var c=setTimeout((function(){u.dispatchEvent("timeout")}),o)}an(u,"complete",(function(){c&&clearTimeout(c);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return zo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(n){t=null}e&&e(t)})),sn(u,"ready",(function(){c&&clearTimeout(c),de(this)})),sn(u,"timeout",(function(){c&&clearTimeout(c),de(this),e&&e(null)})),function(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.O=n,t.I=!1,t.c=!0,t.a=t.B?t.B.a():xo.a(),t.w=function(t){return t.c||(t.c=t.b())}(t.B?t.B:xo),t.a.onreadystatechange=E(t.Lb,t);try{zo(t.b,ca(t,"Opening Xhr")),t.J=!0,t.a.open(n,String(e),!0),t.J=!1}catch(u){return zo(t.b,ca(t,"Error opening Xhr: "+u.message)),void na(t,u)}e=r||"";var o=new dn(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(v(t)||s(t))F(t,e,void 0);else for(var n=fn(t),r=hn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,(function(t,e){o.set(e,t)})),i=function(t){t:{for(var e=ea,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:s(t)?t.charAt(e):t[e]}(o.X()),r=a.FormData&&e instanceof a.FormData,!j(ta,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.P&&(t.a.withCredentials=t.P);try{aa(t),0<t.g&&(t.v=function(t){return ge&&Ie(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),zo(t.b,ca(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=E(t.Ia,t)):t.o=cn(t.Ia,t.g,t)),zo(t.b,ca(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(u){zo(t.b,ca(t,"Send error: "+u.message)),na(t,u)}}(u,t,n,r,i)};var Ba=new J(tt,"https://apis.google.com/js/client.js?onload=%{onload}"),Fa="__fcb"+Math.floor(1e6*Math.random()).toString();function Ua(t){if(!s(t=t.email)||!ir.test(t))throw new Qr("invalid-email")}function Va(t){"email"in t&&Ua(t)}function ja(t){if(!t[Ia])throw new Qr("internal-error")}function qa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Qr("internal-error")}else{if(!t.sessionInfo)throw new Qr("missing-verification-id");if(!t.code)throw new Qr("missing-verification-code")}}Sa.prototype.m=function(t,e,n,r,i){var o=this;Aa.then((function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})})).s((function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})}))},Sa.prototype.ob=function(){return Ts(this,vs,{})},Sa.prototype.rb=function(t,e){return Ts(this,ds,{idToken:t,email:e})},Sa.prototype.sb=function(t,e){return Ts(this,ps,{idToken:t,password:e})};var Ga={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function za(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Qr("internal-error")}function Ha(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&Bn(t=new Nn(t.postBody),"nonce")&&(e.nonce=t.get("nonce"))),e}function Wa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=So(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=So(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=So(t)):t.errorMessage&&(e=Cs(t.errorMessage)),e)throw e;if(!t[Ia])throw new Qr("internal-error")}function Ka(t,e){return e.returnIdpCredential=!0,Ts(t,ms,e)}function Xa(t,e){return e.returnIdpCredential=!0,Ts(t,gs,e)}function Ya(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ts(t,ys,e)}function Qa(t){if(!t.oobCode)throw new Qr("invalid-action-code")}(t=Sa.prototype).tb=function(t,e){var n={idToken:t},r=[];return W(Ga,(function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)})),r.length&&(n.deleteAttribute=r),Ts(this,ds,n)},t.kb=function(t,e){return Q(t={requestType:"PASSWORD_RESET",email:t},e),Ts(this,us,t)},t.lb=function(t,e){return Q(t={requestType:"EMAIL_SIGNIN",email:t},e),Ts(this,as,t)},t.jb=function(t,e){return Q(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ts(this,ss,t)},t.Wa=function(t){return Ts(this,ws,t)},t.ab=function(t,e){return Ts(this,hs,{oobCode:t,newPassword:e})},t.Ma=function(t){return Ts(this,Za,{oobCode:t})},t.Ya=function(t){return Ts(this,Ja,{oobCode:t})};var Ja={endpoint:"setAccountInfo",D:Qa,fa:"email",F:!0},Za={endpoint:"resetPassword",D:Qa,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Qr("internal-error")},F:!0},$a={endpoint:"signupNewUser",D:function(t){if(Ua(t),!t.password)throw new Qr("weak-password")},K:ja,T:!0,F:!0},ts={endpoint:"createAuthUri",F:!0},es={endpoint:"deleteAccount",V:["idToken"]},ns={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!p(t.deleteProvider))throw new Qr("internal-error")}},rs={endpoint:"emailLinkSignin",V:["email","oobCode"],D:Ua,K:ja,T:!0,F:!0},is={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:Ua,K:ja,T:!0},os={endpoint:"getAccountInfo"},as={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Qr("internal-error");Ua(t)},fa:"email",F:!0},ss={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Qr("internal-error")},fa:"email",F:!0},us={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Qr("internal-error");Ua(t)},fa:"email",F:!0},cs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ls={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Qr("internal-error")}},hs={endpoint:"resetPassword",D:Qa,fa:"email",F:!0},fs={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ds={endpoint:"setAccountInfo",V:["idToken"],D:Va,T:!0},ps={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Va(t),!t.password)throw new Qr("weak-password")},K:ja,T:!0},vs={endpoint:"signupNewUser",K:ja,T:!0,F:!0},ms={endpoint:"verifyAssertion",D:za,Ra:Ha,K:Wa,T:!0,F:!0},ys={endpoint:"verifyAssertion",D:za,Ra:Ha,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Qr("user-not-found");if(t.errorMessage)throw Cs(t.errorMessage);if(!t[Ia])throw new Qr("internal-error")},T:!0,F:!0},gs={endpoint:"verifyAssertion",D:function(t){if(za(t),!t.idToken)throw new Qr("internal-error")},Ra:Ha,K:Wa,T:!0},bs={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Qr("invalid-custom-token")},K:ja,T:!0,F:!0},_s={endpoint:"verifyPassword",D:function(t){if(Ua(t),!t.password)throw new Qr("wrong-password")},K:ja,T:!0,F:!0},ws={endpoint:"verifyPhoneNumber",D:qa,K:ja,F:!0},Es={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Qr("internal-error");qa(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",So(t);ja(t)}},xs={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:qa,K:ja,F:!0};function Ts(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Jt(new Qr("internal-error"));var r,i=e.Kb||"POST";return Qt(n).then(e.D).then((function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,n,r,i,o){var a=xn(t.h+e);wn(a,"key",t.c),o&&wn(a,"cb",T().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&wn(a,u,r[u]);return new Gt((function(e,o){La(t,a.toString(),(function(t){t?t.error?o(ks(t,i||{})):e(t):o(new Qr("network-request-failed"))}),n,s?void 0:Wn(Tr(r)),t.a,t.i.get())}))}(t,e.endpoint,i,n,e.Yb,e.wb||!1)})).then((function(t){return r=t,e.Ra?e.Ra(n,r):r})).then(e.K).then((function(){if(!e.fa)return r;if(!(e.fa in r))throw new Qr("internal-error");return r[e.fa]}))}function Cs(t){return ks({error:{errors:[{message:t}],code:400,message:t}})}function ks(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Qr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",Q(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Qr(r[i],e);return!e&&t&&(e=xr(t)),new Qr("internal-error",e)}function Ss(t){this.b=t,this.a=null,this.gb=function(t){return(Ps||(Ps=new Gt((function(t,e){function n(){Ar(),yr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Ar(),e(Error("Network Error"))},timeout:Is.get()})}if(yr("gapi.iframes.Iframe"))t();else if(yr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){yr("gapi.load")?n():e(Error("Network Error"))},Qt(_a(r=it(As,{onload:r}))).s((function(){e(Error("Network Error"))}))}})).s((function(t){throw Ps=null,t})))).then((function(){return new Gt((function(e,n){yr("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout((function(){n(Error("Network Error"))}),Os.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var As=new J(tt,"https://apis.google.com/js/api.js?onload=%{onload}"),Is=new Ir(3e4,6e4),Os=new Ir(5e3,15e3),Ps=null;function Ds(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Tn(this.i,"/__/auth/iframe"),wn(this.a,"apiKey",this.g),wn(this.a,"appName",this.h),this.b=null,this.c=[]}function Ns(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Rs(t){try{return Pk.a.app(t).auth().Ca()}catch(e){return[]}}function Ms(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Ls(t){var e=Zn();return function(t){return Ts(t,cs,{}).then((function(t){return t.authorizedDomains||[]}))}(t).then((function(t){t:{var n=xn(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(0==o.indexOf("chrome-extension://")?a=xn(o).b==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:rr.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new Co(Zn())}))}function Bs(t){return t.l?t.l:(t.l=or().then((function(){if(!t.o){var e=t.c,n=t.h,r=Rs(t.b),i=new Ds(t.u,t.f,t.b);i.f=e,i.b=n,i.c=H(r||[]),t.o=i.toString()}t.i=new Ss(t.o),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then((function(){t.a.register("authEvent",e,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(t.i,(function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=wo(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Qt(n)}return n.status="ERROR",Qt(n)}))}(t)})),t.l)}function Fs(t){return t.m||(t.v=t.c?vr(t.c,Rs(t.b)):null,t.m=new Sa(t.f,Si(t.h),t.v)),t.m}function Us(t,e,n,r,i,o,a,s,u,c,l){return(t=new Ns(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=X(u||null),t.f=c,t.nb(l).toString()}function Vs(t){if(this.a=t||Pk.a.INTERNAL.reactNative&&Pk.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Qr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function js(t){this.b=t,this.a={},this.f=E(this.c,this)}Ds.prototype.toString=function(){return this.f?wn(this.a,"v",this.f):Ln(this.a.a,"v"),this.b?wn(this.a,"eid",this.b):Ln(this.a.a,"eid"),this.c.length?wn(this.a,"fw",this.c.join(",")):Ln(this.a.a,"fw"),this.a.toString()},Ns.prototype.nb=function(t){return this.h=t,this},Ns.prototype.toString=function(){var t=Tn(this.o,"/__/auth/handler");if(wn(t,"apiKey",this.m),wn(t,"appName",this.c),wn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=Pk.a.app(this.c).auth().ha()}catch(s){n=null}for(var r in e.bb=n,wn(t,"providerId",this.a.providerId),n=Tr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=X(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.bb&&!n[e.eb]&&(n[e.eb]=e.bb),K(n)||wn(t,"customParameters",xr(n))}if("function"==typeof this.a.Hb&&(e=this.a.Hb()).length&&wn(t,"scopes",e.join(",")),this.l?wn(t,"redirectUrl",this.l):Ln(t.a,"redirectUrl"),this.g?wn(t,"eventId",this.g):Ln(t.a,"eventId"),this.i?wn(t,"v",this.i):Ln(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!En(t,a)&&wn(t,a,this.b[a]);return this.h?wn(t,"tid",this.h):Ln(t.a,"tid"),this.f?wn(t,"eid",this.f):Ln(t.a,"eid"),(a=Rs(this.c)).length&&wn(t,"fw",a.join(",")),t.toString()},(t=Ms.prototype).Fb=function(t,e,n){var r=new Qr("popup-closed-by-user"),i=new Qr("web-storage-unsupported"),o=this,a=!1;return this.ia().then((function(){(function(t){var e={type:"webStorageSupport"};return Bs(t).then((function(){return function(t,e){return t.gb.then((function(){return new Gt((function(n){t.a.send(e.type,e,n,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(t.i,e)})).then((function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()}))})(o).then((function(n){n||(t&&er(t),e(i),a=!0)}))})).s((function(){})).then((function(){if(!a)return function(t){return new Gt((function(e){return function n(){ln(2e3).then((function(){if(t&&!t.closed)return n();e()}))}()}))}(t)})).then((function(){if(!a)return ln(n).then((function(){e(r)}))}))},t.Ob=function(){var t=mr();return!Er(t)&&!Sr(t)},t.Jb=function(){return!1},t.Db=function(t,e,n,r,i,o,a,s){if(!t)return Jt(new Qr("popup-blocked"));if(a&&!Er())return this.ia().s((function(e){er(t),i(e)})),r(),Qt();this.a||(this.a=Ls(Fs(this)));var u=this;return this.a.then((function(){var e=u.ia().s((function(e){throw er(t),i(e),e}));return r(),e})).then((function(){bo(n),a||$n(Us(u.u,u.f,u.b,e,n,null,o,u.c,void 0,u.h,s),t)})).s((function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t}))},t.Eb=function(t,e,n,r){this.a||(this.a=Ls(Fs(this)));var i=this;return this.a.then((function(){bo(e),$n(Us(i.u,i.f,i.b,t,e,Zn(),n,i.c,void 0,i.h,r))})).s((function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t}))},t.ia=function(){var t=this;return Bs(this).then((function(){return t.i.gb})).s((function(){throw t.a=null,new Qr("network-request-failed")}))},t.Rb=function(){return!0},t.Aa=function(t){this.g.push(t)},t.Na=function(t){G(this.g,(function(e){return e==t}))},(t=Vs.prototype).get=function(t){return Qt(this.a.getItem(t)).then((function(t){return t&&Cr(t)}))},t.set=function(t,e){return Qt(this.a.setItem(t,xr(e)))},t.S=function(t){return Qt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var qs,Gs=[];function zs(t,e,n){K(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Hs(t){this.a=t}function Ws(t){this.c=t,this.b=!1,this.a=[]}function Ks(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Jt(Error("connection_unavailable"));var l=r?800:50,h="undefined"!=typeof MessageChannel?new MessageChannel:null;return new Gt((function(n,r){h?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),h.port1.start(),a=setTimeout((function(){r(Error("unsupported_event"))}),l),t.a.push(c={messageChannel:h,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}}),h.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[h.port2])):r(Error("connection_unavailable"))})).then((function(e){return Xs(t,c),e})).s((function(e){throw Xs(t,c),e}))}function Xs(t,e){if(e){var n=e.messageChannel;n&&(n.port1.removeEventListener("message",e.onMessage),n.port1.close()),G(t.a,(function(t){return t==e}))}}function Ys(){if(!Js())throw new Qr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=a.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;ur()&&self?(this.l=function(){var t=ur()?self:null;if(F(Gs,(function(n){n.b==t&&(e=n)})),!e){var e=new js(t);Gs.push(e)}return e}(),zs(this.l,"keyChanged",(function(e,n){return nu(t).then((function(e){return 0<e.length&&F(t.a,(function(t){t(e)})),{keyProcessed:j(e,n.key)}}))})),zs(this.l,"ping",(function(){return Qt(["keyChanged"])}))):function(){var t=a.navigator;return t&&t.serviceWorker?Qt().then((function(){return t.serviceWorker.ready})).then((function(t){return t.active||null})).s((function(){return null})):Qt(null)}().then((function(e){(t.h=e)&&(t.g=new Ws(new Hs(e)),Ks(t.g,"ping",null,!0).then((function(e){e[0].fulfilled&&j(e[0].value,"keyChanged")&&(t.o=!0)})).s((function(){})))}))}function Qs(t){return t.m||(t.m=function t(e){return new Gt((function(n,r){var i=e.u.open("firebaseLocalStorageDb",1);i.onerror=function(t){try{t.preventDefault()}catch(e){}r(Error(t.target.error))},i.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(e){r(e)}},i.onsuccess=function(i){(i=i.target.result).objectStoreNames.contains("firebaseLocalStorage")?n(i):function(t){return new Gt((function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}}))}(e).then((function(){return t(e)})).then((function(t){n(t)})).s((function(t){r(t)}))}}))}(t)),t.m}function Js(){try{return!!a.indexedDB}catch(me){return!1}}function Zs(t){return t.objectStore("firebaseLocalStorage")}function $s(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function tu(t){return new Gt((function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}}))}function eu(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Ks(t.g,"keyChanged",{key:e},t.o).then((function(){})).s((function(){})):Qt()}function nu(t){return Qs(t).then((function(t){var e=Zs($s(t,!1));return e.getAll?tu(e.getAll()):new Gt((function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}}))})).then((function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r}))}function ru(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function iu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Qt().then((function(){if(Js()){var t=kr(),r="__sak"+t;return qs||(qs=new Ys),(n=qs).set(r,t).then((function(){return n.get(r)})).then((function(e){if(e!==t)throw Error("indexedDB not supported!");return n.S(r)})).then((function(){return n})).s((function(){return e.c}))}return e.c})).then((function(t){return e.type=t.type,t.$((function(t){F(e.a,(function(e){e(t)}))})),t}))}function ou(){this.a={},this.type="inMemory"}function au(){if(!function(){var t="Node"==cr();if(!(t=su()||t&&Pk.a.INTERNAL.node&&Pk.a.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==cr())throw new Qr("internal-error","The LocalStorage compatibility library was not found.");throw new Qr("web-storage-unsupported")}this.a=su()||Pk.a.INTERNAL.node.localStorage,this.type="localStorage"}function su(){try{var t=a.localStorage,e=kr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(n){return null}}function uu(){this.type="nullStorage"}function cu(){if(!function(){var t="Node"==cr();if(!(t=lu()||t&&Pk.a.INTERNAL.node&&Pk.a.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(e){return!1}}()){if("Node"==cr())throw new Qr("internal-error","The SessionStorage compatibility library was not found.");throw new Qr("web-storage-unsupported")}this.a=lu()||Pk.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function lu(){try{var t=a.sessionStorage,e=kr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(n){return null}}function hu(){var t={};t.Browser=pu,t.Node=vu,t.ReactNative=mu,t.Worker=yu,this.a=t[cr()]}js.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];F(r,(function(e){i.push(Qt().then((function(){return e(t.origin,t.data.data)})))})),$t(i).then((function(r){var i=[];F(r,(function(t){i.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})})),F(i,(function(t){for(var e in t)void 0===t[e]&&delete t[e]})),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})}))}},Hs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ws.prototype.close=function(){for(;0<this.a.length;)Xs(this,this.a[0]);this.b=!0},(t=Ys.prototype).set=function(t,e){var n,r=!1,i=this;return Qs(this).then((function(e){return tu((e=Zs($s(n=e,!0))).get(t))})).then((function(o){var a=Zs($s(n,!0));return o?(o.value=e,tu(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,tu(a.add(o)))})).then((function(){return i.c[t]=e,eu(i,t)})).ka((function(){r&&i.b--}))},t.get=function(t){return Qs(this).then((function(e){return tu(Zs($s(e,!1)).get(t))})).then((function(t){return t&&t.value}))},t.S=function(t){var e=!1,n=this;return Qs(this).then((function(r){return e=!0,n.b++,tu(Zs($s(r,!0)).delete(t))})).then((function(){return delete n.c[t],eu(n,t)})).ka((function(){e&&n.b--}))},t.$=function(t){0==this.a.length&&function(t){ru(t),function e(){t.f=setTimeout((function(){t.i=nu(t).then((function(e){0<e.length&&F(t.a,(function(t){t(e)}))})).then((function(){e()})).s((function(t){"STOP_EVENT"!=t.message&&e()}))}),800)}()}(this),this.a.push(t)},t.ea=function(t){G(this.a,(function(e){return e==t})),0==this.a.length&&ru(this)},(t=iu.prototype).get=function(t){return this.b.then((function(e){return e.get(t)}))},t.set=function(t,e){return this.b.then((function(n){return n.set(t,e)}))},t.S=function(t){return this.b.then((function(e){return e.S(t)}))},t.$=function(t){this.a.push(t)},t.ea=function(t){G(this.a,(function(e){return e==t}))},(t=ou.prototype).get=function(t){return Qt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Qt()},t.S=function(t){return delete this.a[t],Qt()},t.$=function(){},t.ea=function(){},(t=au.prototype).get=function(t){var e=this;return Qt().then((function(){return Cr(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Qt().then((function(){var r=xr(e);null===r?n.S(t):n.a.setItem(t,r)}))},t.S=function(t){var e=this;return Qt().then((function(){e.a.removeItem(t)}))},t.$=function(t){a.window&&We(a.window,"storage",t)},t.ea=function(t){a.window&&Ye(a.window,"storage",t)},(t=uu.prototype).get=function(){return Qt(null)},t.set=function(){return Qt()},t.S=function(){return Qt()},t.$=function(){},t.ea=function(){},(t=cu.prototype).get=function(t){var e=this;return Qt().then((function(){return Cr(e.a.getItem(t))}))},t.set=function(t,e){var n=this;return Qt().then((function(){var r=xr(e);null===r?n.S(t):n.a.setItem(t,r)}))},t.S=function(t){var e=this;return Qt().then((function(){e.a.removeItem(t)}))},t.$=function(){},t.ea=function(){};var fu,du,pu={C:au,Ta:cu},vu={C:au,Ta:cu},mu={C:Vs,Ta:uu},yu={C:au,Ta:uu},gu={ad:"local",NONE:"none",cd:"session"};function bu(){var t=!(Sr(mr())||!sr()),e=Er(),n=gr();this.m=t,this.h=e,this.l=n,this.a={},fu||(fu=new hu),t=fu;try{this.g=!Jn()&&Dr()||!a.indexedDB?new t.a.C:new iu(ur()?new ou:new t.a.C)}catch(r){this.g=new ou,this.h=!0}try{this.i=new t.a.Ta}catch(r){this.i=new ou}this.u=new ou,this.f=E(this.Pb,this),this.b={}}function _u(){return du||(du=new bu),du}function wu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Eu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function xu(t,e,n){return n=Eu(e,n),"local"==e.C&&(t.b[n]=null),wu(t,e.C).S(n)}function Tu(t){t.c&&(clearInterval(t.c),t.c=null)}function Cu(t){this.a=t,this.b=_u()}(t=bu.prototype).get=function(t,e){return wu(this,t.C).get(Eu(t,e))},t.set=function(t,e,n){var r=Eu(t,n),i=this,o=wu(this,t.C);return o.set(r,e).then((function(){return o.get(r)})).then((function(e){"local"==t.C&&(i.b[r]=e)}))},t.addListener=function(t,e,n){t=Eu(t,e),this.l&&(this.b[t]=a.localStorage.getItem(t)),K(this.a)&&(wu(this,"local").$(this.f),this.h||(Jn()||!Dr())&&a.indexedDB||!this.l||function(t){Tu(t),t.c=setInterval((function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new Me({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Pb(n))}}),1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Eu(t,e),this.a[t]&&(G(this.a[t],(function(t){return t==n})),0==this.a[t].length&&delete this.a[t]),K(this.a)&&(wu(this,"local").ea(this.f),Tu(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?wu(this,"local").ea(this.f):Tu(this),this.m)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.$a(e))},ge&&Se&&10==Se&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else F(t,E(this.$a,this))},t.$a=function(t){this.a[t]&&F(this.a[t],(function(t){t()}))};var ku,Su={name:"authEvent",C:"local"};function Au(){this.a=_u()}function Iu(t,e){this.b=Ou,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=a.Int32Array?new Int32Array(64):Array(64),void 0!==ku||(ku=a.Int32Array?new Int32Array(Bu):Bu),this.reset()}C(Iu,(function(){this.b=-1}));for(var Ou=64,Pu=Ou-1,Du=[],Nu=0;Nu<Pu;Nu++)Du[Nu]=0;var Ru=z(128,Du);function Mu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){var o=(0|n[e-16])+(((i=0|n[e-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+(((r=0|n[e-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],l=0|t.a[5],h=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&l^~c&h)+(0|ku[e])|0)+(0|n[e])|0)|0,o=h,h=l,l=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+l|0,t.a[6]=t.a[6]+h|0,t.a[7]=t.a[7]+o|0}function Lu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(s(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Mu(t),i=0);else{if(!v(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Mu(t),i=0)}}t.c=i,t.g+=n}Iu.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):H(this.h)};var Bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Fu(){Iu.call(this,8,Uu)}C(Fu,Iu);var Uu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Vu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Au,this.g=new Cu(this.h),this.f=null,this.b=[],this.a=this.c=null}function ju(t){return new Qr("invalid-cordova-configuration",t)}function qu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(r){}}function Gu(t){return t.f||(t.f=t.ia().then((function(){return new Gt((function(e){t.Aa((function n(r){return e(r),t.Na(n),!1})),function(t){function e(e){r=!0,i&&i.cancel(),zu(t).then((function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=ji(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Cr(En(o=xn(i),"firebaseError")||null))?Jr(o):null)?new _o(r.c,r.b,null,null,o,null,r.R()):new _o(r.c,r.b,i,r.f,null,null,r.R())),i=o||n}qu(t,i)}))}var n=new _o("unknown",null,null,null,new Qr("no-auth-event")),r=!1,i=ln(500).then((function(){return zu(t).then((function(){r||qu(t,n)}))})),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(yr("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(n){console.error(n)}},To||(To=new Eo),function(t){var e=To;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=yr("universalLinks.subscribe",a))&&t(null,e.b))}(e)}(t)}))}))),t.f}function zu(t){var e=null;return function(t){return t.b.get(Su,t.a).then((function(t){return wo(t)}))}(t.g).then((function(n){return e=n,xu((n=t.g).b,Su,n.a)})).then((function(){return e}))}function Hu(t){this.a=t,this.b=_u()}(t=Vu.prototype).ia=function(){return this.Da?this.Da:this.Da=(ar(void 0)?or().then((function(){return new Gt((function(t,e){var n=a.document,r=setTimeout((function(){e(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),t()}),!1)}))})):Jt(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!=typeof yr("universalLinks.subscribe",a))throw ju("cordova-universal-links-plugin-fix is not installed");if(void 0===yr("BuildInfo.packageName",a))throw ju("cordova-plugin-buildinfo is not installed");if("function"!=typeof yr("cordova.plugins.browsertab.openUrl",a))throw ju("cordova-plugin-browsertab is not installed");if("function"!=typeof yr("cordova.InAppBrowser.open",a))throw ju("cordova-plugin-inappbrowser is not installed")}),(function(){throw new Qr("cordova-not-ready")}))},t.Fb=function(t,e){return e(new Qr("operation-not-supported-in-this-environment")),Qt()},t.Db=function(){return Jt(new Qr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Jt(new Qr("redirect-operation-pending"));var i=this,o=a.document,s=null,u=null,c=null,l=null;return this.c=Qt().then((function(){return bo(e),Gu(i)})).then((function(){return function(t,e,n,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new _o(e,r,null,o,new Qr("no-auth-event"),null,i),u=yr("BuildInfo.packageName",a);if("string"!=typeof u)throw new Qr("invalid-cordova-configuration");var c=yr("BuildInfo.displayName",a),l={};if(mr().toLowerCase().match(/iphone|ipad|ipod/))l.ibi=u;else{if(!mr().toLowerCase().match(/android/))return Jt(new Qr("operation-not-supported-in-this-environment"));l.apn=u}c&&(l.appDisplayName=c),o=function(t){var e=new Fu;Lu(e,t),t=[];var n=8*e.g;Lu(e,Ru,56>e.c?56-e.c:e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Mu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return U(t,(function(t){return 1<(t=t.toString(16)).length?t:"0"+t})).join("")}(t)}(o),l.sessionId=o;var h=Us(t.u,t.i,t.l,e,n,null,r,t.m,l,t.o,i);return t.ia().then((function(){var e=t.h;return t.v.a.set(Su,s.A(),e)})).then((function(){var e=yr("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new Qr("invalid-cordova-configuration");var n=null;e((function(e){if(e){if("function"!=typeof(n=yr("cordova.plugins.browsertab.openUrl",a)))throw new Qr("invalid-cordova-configuration");n(h)}else{if("function"!=typeof(n=yr("cordova.InAppBrowser.open",a)))throw new Qr("invalid-cordova-configuration");e=mr(),t.a=n(h,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,t,e,n,r)})).then((function(){return new Gt((function(t,e){u=function(){var e=yr("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Aa(u),l=function(){Or()&&c()},o.addEventListener("resume",c=function(){s||(s=ln(2e3).then((function(){e(new Qr("redirect-cancelled-by-user"))})))},!1),mr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",l,!1)})).s((function(t){return zu(i).then((function(){throw t}))}))})).ka((function(){c&&o.removeEventListener("resume",c,!1),l&&o.removeEventListener("visibilitychange",l,!1),s&&s.cancel(),u&&i.Na(u),i.c=null}))},t.Aa=function(t){this.b.push(t),Gu(this).s((function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new _o("unknown",null,null,null,new Qr("no-auth-event")),t(e))}))},t.Na=function(t){G(this.b,(function(e){return e==t}))};var Wu={name:"pendingRedirect",C:"session"};function Ku(t){return xu(t.b,Wu,t.a)}function Xu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=E(this.o,this),this.b=new uc,this.w=new dc,this.g=new Hu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=Yu(this.B,this.u,this.m,Ci)}function Yu(t,e,n,r){var i=Pk.a.SDK_VERSION||null;return ar()?new Vu(t,e,n,i,r):new Ms(t,e,n,i,r)}function Qu(t){t.f||(t.f=!0,t.a.Aa(t.l));var e=t.a;return t.a.ia().s((function(n){throw t.a==e&&t.reset(),n}))}function Ju(t){t.a.Ob()&&Qu(t).s((function(e){var n=new _o("unknown",null,null,null,new Qr("operation-not-supported-in-this-environment"));rc(e)&&t.o(n)})),t.a.Jb()||cc(t.b)}function Zu(t,e){j(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(Wu,t.a).then((function(t){return"pending"==t}))}(t.g).then((function(e){e?Ku(t.g).then((function(){Qu(t).s((function(e){var n=new _o("unknown",null,null,null,new Qr("operation-not-supported-in-this-environment"));rc(e)&&t.o(n)}))})):Ju(t)})).s((function(){Ju(t)}))}function $u(t,e){G(t.h,(function(t){return t==e}))}Xu.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=Yu(this.B,this.u,this.m),this.i={}},Xu.prototype.o=function(t){if(!t)throw new Qr("invalid-auth-event");if(6e5<=T()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=T())),e=!0;break}}return cc(this.b),e};var tc=new Ir(2e3,1e4),ec=new Ir(3e4,6e4);function nc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,(function(){t.f||(t.f=!0,t.a.Aa(t.l))}),(function(){t.reset()}),i,o,a)}function rc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function ic(t,e,n,r,i){var o;return function(t){return t.b.set(Wu,"pending",t.a)}(t.g).then((function(){return t.a.Eb(e,n,r,i).s((function(e){if(rc(e))throw new Qr("operation-not-supported-in-this-environment");return o=e,Ku(t.g).then((function(){throw o}))})).then((function(){return t.a.Rb()?new Gt((function(){})):Ku(t.g).then((function(){return t.oa()})).then((function(){})).s((function(){}))}))}))}function oc(t,e,n,r,i){return t.a.Fb(r,(function(t){e.ja(n,null,t,i)}),tc.get())}Xu.prototype.oa=function(){return this.b.oa()};var ac={};function sc(t,e,n){var r=e+":"+n;return ac[r]||(ac[r]=new Xu(t,e,n)),ac[r]}function uc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function cc(t){t.g||(t.g=!0,fc(t,!1,null,null))}function lc(t){t.g&&!t.i&&fc(t,!1,null,null)}function hc(t,e){if(t.b=function(){return Qt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function fc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Jt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):hc(t,n):hc(t,{user:null}),t.f=[],t.c=[]}function dc(){}function pc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function vc(t,e){this.a=e,Br(this,"verificationId",t)}function mc(t,e,n,r){return new mo(t).Wa(e,n).then((function(t){return new vc(t,r)}))}function yc(t){var e=Ti(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Qr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Pr(1e3*e.exp),authTime:Pr(1e3*e.auth_time),issuedAtTime:Pr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function gc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function bc(t){this.f=t,this.b=this.a=null,this.c=0}function _c(t,e){var n=e[Ia],r=e.refreshToken;e=wc(e.expiresIn),t.b=n,t.c=e,t.a=r}function wc(t){return T()+1e3*parseInt(t,10)}function Ec(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Pr(e||null),creationTime:Pr(t||null)})}function xc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Tc(t,e){for(var n in Re.call(this,t),e)this[n]=e[n]}function Cc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=Pk.a.SDK_VERSION?vr(Pk.a.SDK_VERSION):null,this.a=new Sa(this.l,Si(Ci),t),this.b=new bc(this.a),Dc(this,e[Ia]),_c(this.b,e),Br(this,"refreshToken",this.b.a),Mc(this,n||{}),on.call(this),this.J=!1,this.o&&br()&&(this.i=sc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(t){return new gc((function(){return t.G(!0)}),(function(t){return!(!t||"auth/network-request-failed"!=t.code)}),(function(){var e=t.b.c-T()-3e5;return 0<e?e:0}))}(this),this.W=E(this.Ja,this);var r=this;this.ga=null,this.xa=function(t){r.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){Sc(r,t.c)},this.Y=null}function kc(t,e){t.Z&&Ye(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&We(e,"languageCodeChanged",t.xa)}function Sc(t,e){t.P=e,Ma(t.a,Pk.a.SDK_VERSION?vr(Pk.a.SDK_VERSION,t.P):null)}function Ac(t,e){t.Y&&Ye(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&We(e,"frameworkChanged",t.wa)}function Ic(t){try{return Pk.a.app(t.m).auth()}catch(e){throw new Qr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function Oc(t){t.B||t.w.b||(t.w.start(),Ye(t,"tokenChanged",t.W),We(t,"tokenChanged",t.W))}function Pc(t){Ye(t,"tokenChanged",t.W),t.w.stop()}function Dc(t,e){t.ma=e,Br(t,"_lat",e)}function Nc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then((function(){return t}))}function Rc(t){t.i&&!t.J&&(t.J=!0,Zu(t.i,t))}function Mc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new Ec(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Lc(){}function Bc(t){return Qt().then((function(){if(t.B)throw new Qr("app-deleted")}))}function Fc(t){return U(t.providerData,(function(t){return t.providerId}))}function Uc(t,e){e&&(Vc(t,e.providerId),t.providerData.push(e))}function Vc(t,e){G(t.providerData,(function(t){return t.providerId==e}))}function jc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Br(t,e,n)}function qc(t,e){t!=e&&(Fr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),Br(t,"metadata",e.metadata?function(t){return new Ec(t.a,t.b)}(e.metadata):new Ec),F(e.providerData,(function(e){Uc(t,e)})),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.b,e.b),Br(t,"refreshToken",t.b.a))}function Gc(t){return t.G().then((function(e){var n=t.isAnonymous;return function(t,e){return Ts(t.a,os,{idToken:e}).then(E(t.zc,t))}(t,e).then((function(){return n||jc(t,"isAnonymous",!1),e}))}))}function zc(t,e){e[Ia]&&t.ma!=e[Ia]&&(_c(t.b,e),t.dispatchEvent(new Tc("tokenChanged")),Dc(t,e[Ia]),jc(t,"refreshToken",t.b.a))}function Hc(t,e){return Gc(t).then((function(){if(j(Fc(t),e))return Nc(t).then((function(){throw new Qr("provider-already-linked")}))}))}function Wc(t,e,n){return Ur({user:t,credential:go(e),additionalUserInfo:e=Di(e),operationType:n})}function Kc(t,e){return zc(t,e),t.reload().then((function(){return t}))}function Xc(t,e,n,r,i){if(!br())return Jt(new Qr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Jt(t.h);var o=Pi(n.providerId),a=kr(t.uid+":::"),s=null;(!Er()||sr())&&t.o&&n.isOAuthProvider&&(s=Us(t.o,t.l,t.m,e,n,null,a,Pk.a.SDK_VERSION||null,null,null,t.tenantId));var u=nr(s,o&&o.sa,o&&o.ra);return r=r().then((function(){if(Qc(t),!i)return t.G().then((function(){}))})).then((function(){return nc(t.i,u,e,n,a,!!s,t.tenantId)})).then((function(){return new Gt((function(n,r){t.ja(e,null,new Qr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.c=oc(t.i,t,e,u,a)}))})).then((function(t){return u&&er(u),t?Ur(t):null})).s((function(t){throw u&&er(u),t})),Jc(t,r,i)}function Yc(t,e,n,r,i){if(!br())return Jt(new Qr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Jt(t.h);var o=null,a=kr(t.uid+":::");return r=r().then((function(){if(Qc(t),!i)return t.G().then((function(){}))})).then((function(){return t.ca=a,Nc(t)})).then((function(e){return t.da&&(e=(e=t.da).b.set(tl,t.A(),e.a)),e})).then((function(){return ic(t.i,e,n,a,t.tenantId)})).s((function(e){if(o=e,t.da)return el(t.da);throw o})).then((function(){if(o)throw o})),Jc(t,r,i)}function Qc(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Qr("internal-error");throw new Qr("auth-domain-config-required")}}function Jc(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Jt(t.h)):e.s((function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new Tc("userInvalidated")),t.h=e),e}))}(t,e,n);return t.I.push(r),r.ka((function(){q(t.I,r)})),r}function Zc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Ia]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-T())/1e3;var r=new Cc(e,n,t);return t.providerData&&F(t.providerData,(function(t){t&&Uc(r,Ur(t))})),t.redirectEventId&&(r.ca=t.redirectEventId),r}function $c(t){this.a=t,this.b=_u()}uc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},uc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(fc(this,!0,null,t.a),Qt()):e.Ba(n,r)?function(t,e,n){n=n.Ba(e.c,e.b);var r=e.g,i=e.f,o=e.i,a=e.R(),s=!!e.c.match(/Redirect$/);n(r,i,a,o).then((function(e){fc(t,s,e,null)})).s((function(e){fc(t,s,null,e)}))}(this,t,e):Jt(new Qr("invalid-auth-event")):(fc(this,!1,null,null),Qt())}else Jt(new Qr("invalid-auth-event"))},uc.prototype.oa=function(){var t=this;return new Gt((function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new Qr("timeout");t.a&&t.a.cancel(),t.a=ln(ec.get()).then((function(){t.b||(t.g=!0,fc(t,!0,null,e))}))}(t))}))},dc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Qt()):e.Ba(n,r)?function(t,e){var n=t.b,r=t.c;e.Ba(r,n)(t.g,t.f,t.R(),t.i).then((function(t){e.ja(r,t,null,n)})).s((function(t){e.ja(r,null,t,n)}))}(t,e):Jt(new Qr("invalid-auth-event"))}else Jt(new Qr("invalid-auth-event"))},vc.prototype.confirm=function(t){return t=yo(this.verificationId,t),this.a(t)},gc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop(),e.b=ln(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then((function(){return function(){var t=a.document,e=null;return Or()||!t?Qt():new Gt((function(n){e=function(){Or()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)})).s((function(n){throw t.removeEventListener("visibilitychange",e,!1),n}))}()})).then((function(){return e.h()})).then((function(){t(e,!0)})).s((function(n){e.i(n)&&t(e,!1)}))}(this,!0)},gc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},bc.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},bc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Jt(new Qr("user-token-expired")):t||!this.b||T()>this.c-3e4?this.a?function(t,e){return function(t,e){return new Gt((function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?La(t,t.l+"?key="+encodeURIComponent(t.c),(function(t){t?t.error?r(ks(t)):t.access_token&&t.refresh_token?n(t):r(new Qr("internal-error")):r(new Qr("network-request-failed"))}),"POST",Mn(e).toString(),t.g,t.u.get()):r(new Qr("internal-error"))}))}(t.f,e).then((function(e){return t.b=e.access_token,t.c=wc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}})).s((function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e}))}(this,{grant_type:"refresh_token",refresh_token:this.a}):Qt(null):Qt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},Ec.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},C(Tc,Re),C(Cc,on),Cc.prototype.ua=function(t){this.ga=t,Ra(this.a,t)},Cc.prototype.ha=function(){return this.ga},Cc.prototype.Ca=function(){return H(this.P)},Cc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},Br(Cc.prototype,"providerId","firebase"),(t=Cc.prototype).reload=function(){var t=this;return Jc(this,Bc(this).then((function(){return Gc(t).then((function(){return Nc(t)})).then(Lc)})))},t.dc=function(t){return this.G(t).then((function(t){return new yc(t)}))},t.G=function(t){var e=this;return Jc(this,Bc(this).then((function(){return e.b.getToken(t)})).then((function(t){if(!t)throw new Qr("internal-error");return t.accessToken!=e.ma&&(Dc(e,t.accessToken),e.dispatchEvent(new Tc("tokenChanged"))),jc(e,"refreshToken",t.refreshToken),t.accessToken})))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Qr("internal-error");Mc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?U(t,(function(t){return new xc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)})):[]}(t),n=0;n<e.length;n++)Uc(this,e[n]);jc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Mr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return Jc(this,t.f(this.a,this.uid).then((function(t){return zc(e,t),n=Wc(e,t,"reauthenticate"),e.h=null,e.reload()})).then((function(){return n})),!0)},t.rc=function(t){return Mr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(t){var e=this,n=null;return Jc(this,Hc(this,t.providerId).then((function(){return e.G()})).then((function(n){return t.b(e.a,n)})).then((function(t){return n=Wc(e,t,"link"),Kc(e,t)})).then((function(){return n})))},t.sc=function(t,e){var n=this;return Jc(this,Hc(this,"phone").then((function(){return mc(Ic(n),t,e,E(n.fb,n))})))},t.Bc=function(t,e){var n=this;return Jc(this,Qt().then((function(){return mc(Ic(n),t,e,E(n.hb,n))})),!0)},t.rb=function(t){var e=this;return Jc(this,this.G().then((function(n){return e.a.rb(n,t)})).then((function(t){return zc(e,t),e.reload()})))},t.Sc=function(t){var e=this;return Jc(this,this.G().then((function(n){return t.b(e.a,n)})).then((function(t){return zc(e,t),e.reload()})))},t.sb=function(t){var e=this;return Jc(this,this.G().then((function(n){return e.a.sb(n,t)})).then((function(t){return zc(e,t),e.reload()})))},t.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Bc(this);var e=this;return Jc(this,this.G().then((function(n){return e.a.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})})).then((function(t){return zc(e,t),jc(e,"displayName",t.displayName||null),jc(e,"photoURL",t.photoUrl||null),F(e.providerData,(function(t){"password"===t.providerId&&(Br(t,"displayName",e.displayName),Br(t,"photoURL",e.photoURL))})),Nc(e)})).then(Lc))},t.Qc=function(t){var e=this;return Jc(this,Gc(this).then((function(n){return j(Fc(e),t)?function(t,e,n){return Ts(t,ns,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then((function(t){var n={};return F(t.providerUserInfo||[],(function(t){n[t.providerId]=!0})),F(Fc(e),(function(t){n[t]||Vc(e,t)})),n[mo.PROVIDER_ID]||Br(e,"phoneNumber",null),Nc(e)})):Nc(e).then((function(){throw new Qr("no-such-provider")}))})))},t.delete=function(){var t=this;return Jc(this,this.G().then((function(e){return Ts(t.a,es,{idToken:e})})).then((function(){t.dispatchEvent(new Tc("userDeleted"))}))).then((function(){for(var e=0;e<t.I.length;e++)t.I[e].cancel("app-deleted");kc(t,null),Ac(t,null),t.I=[],t.B=!0,Pc(t),Br(t,"refreshToken",null),t.i&&$u(t.i,t)}))},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?E(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?E(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?E(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?E(this.Cb,this):null},t.tc=function(t){var e=this;return Xc(this,"linkViaPopup",t,(function(){return Hc(e,t.providerId).then((function(){return Nc(e)}))}),!1)},t.Cc=function(t){return Xc(this,"reauthViaPopup",t,(function(){return Qt()}),!0)},t.uc=function(t){var e=this;return Yc(this,"linkViaRedirect",t,(function(){return Hc(e,t.providerId)}),!1)},t.Dc=function(t){return Yc(this,"reauthViaRedirect",t,(function(){return Qt()}),!0)},t.Bb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Jc(this,this.G().then((function(n){return Xa(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})})).then((function(t){return o=Wc(i,t,"link"),Kc(i,t)})).then((function(){return o})))},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return Jc(this,Qt().then((function(){return Gi(Ya(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)})).then((function(t){return o=Wc(i,t,"reauthenticate"),zc(i,t),i.h=null,i.reload()})).then((function(){return o})),!0)},t.jb=function(t){var e=this,n=null;return Jc(this,this.G().then((function(e){return n=e,void 0===t||K(t)?{}:bi(new ci(t))})).then((function(t){return e.a.jb(n,t)})).then((function(t){if(e.email!=t)return e.reload()})).then((function(){})))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&Q(t,this.metadata.A()),F(this.providerData,(function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))})),t};var tl={name:"redirectUser",C:"session"};function el(t){return xu(t.b,tl,t.a)}function nl(t){this.a=t,this.b=_u(),this.c=null,this.f=function(t){var e=ol("local"),n=ol("session"),r=ol("none");return function(t,e,n){var r=Eu(e,n),i=wu(t,e.C);return t.get(e,n).then((function(o){var s=null;try{s=Cr(a.localStorage.getItem(r))}catch(u){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)}))}(t.b,e,t.a).then((function(){return t.b.get(n,t.a)})).then((function(i){return i?n:t.b.get(r,t.a).then((function(n){return n?r:t.b.get(e,t.a).then((function(n){return n?e:t.b.get(il,t.a).then((function(t){return t?ol(t):e}))}))}))})).then((function(e){return t.c=e,rl(t,e.C)})).s((function(){t.c||(t.c=e)}))}(this),this.b.addListener(ol("local"),this.a,E(this.g,this))}function rl(t,e){var n,r=[];for(n in gu)gu[n]!==e&&r.push(xu(t.b,ol(gu[n]),t.a));return r.push(xu(t.b,il,t.a)),function(t){return new Gt((function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)Zt(t[s],x(o,s),a);else e(i)}))}(r)}nl.prototype.g=function(){var t=this,e=ol("local");cl(this,(function(){return Qt().then((function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null})).then((function(n){if(n)return rl(t,"local").then((function(){t.c=e}))}))}))};var il={name:"persistence",C:"session"};function ol(t){return{name:"authUser",C:t}}function al(t,e){return cl(t,(function(){return t.b.set(t.c,e.A(),t.a)}))}function sl(t){return cl(t,(function(){return xu(t.b,t.c,t.a)}))}function ul(t,e){return cl(t,(function(){return t.b.get(t.c,t.a).then((function(t){return t&&e&&(t.authDomain=e),Zc(t||{})}))}))}function cl(t,e){return t.f=t.f.then(e,e),t.f}function ll(t){if(this.l=!1,Br(this,"settings",new pc),Br(this,"app",t),!gl(this).options||!gl(this).options.apiKey)throw new Qr("invalid-api-key");t=Pk.a.SDK_VERSION?vr(Pk.a.SDK_VERSION):null,this.b=new Sa(gl(this).options&&gl(this).options.apiKey,Si(Ci),t),this.O=[],this.m=[],this.J=[],this.Ub=Pk.a.INTERNAL.createSubscribe(E(this.oc,this)),this.W=void 0,this.Vb=Pk.a.INTERNAL.createSubscribe(E(this.pc,this)),ml(this,null),this.h=new nl(gl(this).options.apiKey+":"+gl(this).name),this.w=new $c(gl(this).options.apiKey+":"+gl(this).name),this.Y=El(this,function(t){var e=gl(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(tl,t.a).then((function(t){return t&&e&&(t.authDomain=e),Zc(t||{})}))}(t.w,gl(t).options.authDomain).then((function(e){return(t.B=e)&&(e.da=t.w),el(t.w)}));return El(t,e)}(t).then((function(){return ul(t.h,e)})).then((function(e){return e?(e.da=t.w,t.B&&(t.B.ca||null)==(e.ca||null)?e:e.reload().then((function(){return al(t.h,e).then((function(){return e}))})).s((function(n){return"auth/network-request-failed"==n.code?e:sl(t.h)}))):null})).then((function(e){ml(t,e||null)}));return El(t,n)}(this)),this.i=El(this,function(t){return t.Y.then((function(){return pl(t)})).s((function(){})).then((function(){if(!t.l)return t.ma()})).s((function(){})).then((function(){if(!t.l){t.ga=!0;var e=t.h;e.b.addListener(ol("local"),e.a,t.ma)}}))}(this)),this.ga=!1,this.ma=E(this.Nc,this),this.ub=E(this.aa,this),this.wa=E(this.bc,this),this.xa=E(this.mc,this),this.Ja=E(this.nc,this),this.a=null,function(t){var e=gl(t).options.authDomain,n=gl(t).options.apiKey;e&&br()&&(t.Tb=t.Y.then((function(){if(!t.l){if(t.a=sc(e,n,gl(t).name),Zu(t.a,t),bl(t)&&Rc(bl(t)),t.B){Rc(t.B);var r=t.B;r.ua(t.ha()),kc(r,t),Sc(r=t.B,t.I),Ac(r,t),t.B=null}return t.a}})))}(this),this.INTERNAL={},this.INTERNAL.delete=E(this.delete,this),this.INTERNAL.logFramework=E(this.vc,this),this.o=0,on.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function hl(t){Re.call(this,"languageCodeChanged"),this.g=t}function fl(t){Re.call(this,"frameworkChanged"),this.c=t}function dl(t){return t.Tb||Jt(new Qr("auth-domain-config-required"))}function pl(t){if(!br())return Jt(new Qr("operation-not-supported-in-this-environment"));var e=dl(t).then((function(){return t.a.oa()})).then((function(t){return t?Ur(t):null}));return El(t,e)}function vl(t,e){var n={};return n.apiKey=gl(t).options.apiKey,n.authDomain=gl(t).options.authDomain,n.appName=gl(t).name,t.Y.then((function(){return function(t,e,n,r){var i=new Cc(t,e);return n&&(i.da=n),r&&Sc(i,r),i.reload().then((function(){return i}))}(n,e,t.w,t.Ca())})).then((function(e){return bl(t)&&e.uid==bl(t).uid?(qc(bl(t),e),t.aa(e)):(ml(t,e),Rc(e),t.aa(e))})).then((function(){wl(t)}))}function ml(t,e){bl(t)&&(function(t,e){G(t.O,(function(t){return t==e}))}(bl(t),t.ub),Ye(bl(t),"tokenChanged",t.wa),Ye(bl(t),"userDeleted",t.xa),Ye(bl(t),"userInvalidated",t.Ja),Pc(bl(t))),e&&(e.O.push(t.ub),We(e,"tokenChanged",t.wa),We(e,"userDeleted",t.xa),We(e,"userInvalidated",t.Ja),0<t.o&&Oc(e)),Br(t,"currentUser",e),e&&(e.ua(t.ha()),kc(e,t),Sc(e,t.I),Ac(e,t))}function yl(t,e){var n=null,r=null;return El(t,e.then((function(e){return n=go(e),r=Di(e),vl(t,e)})).then((function(){return Ur({user:bl(t),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function gl(t){return t.app}function bl(t){return t.currentUser}function _l(t){return bl(t)&&bl(t)._lat||null}function wl(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](_l(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](_l(t))}}function El(t,e){return t.O.push(e),e.ka((function(){q(t.O,e)})),e}function xl(){}function Tl(){this.a={},this.b=1e12}nl.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new Qr("invalid-persistence-type"),n=new Qr("unsupported-persistence-type");t:{for(r in gu)if(gu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(cr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!gr()&&"none"!==t)throw n}}(t),cl(this,(function(){return t!=n.c.C?n.b.get(n.c,n.a).then((function(r){return e=r,rl(n,t)})).then((function(){if(n.c=ol(t),e)return n.b.set(n.c,e,n.a)})):Qt()}))},C(ll,on),C(hl,Re),C(fl,Re),(t=ll.prototype).mb=function(t){return El(this,t=this.h.mb(t))},t.ua=function(t){this.Z===t||this.l||(this.Z=t,Ra(this.b,this.Z),this.dispatchEvent(new hl(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=a.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ma(this.b,Pk.a.SDK_VERSION?vr(Pk.a.SDK_VERSION,this.I):null),this.dispatchEvent(new fl(this.I))},t.Ca=function(){return H(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:gl(this).options.apiKey,authDomain:gl(this).options.authDomain,appName:gl(this).name,currentUser:bl(this)&&bl(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?E(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Ka(i.b,t).then((function(t){return o=go(t),a=Di(t),t}));return El(this,t=i.Y.then((function(){return s})).then((function(t){return vl(i,t)})).then((function(){return Ur({user:bl(i),credential:o,additionalUserInfo:a,operationType:"signIn"})})))},t.Lc=function(t){if(!br())return Jt(new Qr("operation-not-supported-in-this-environment"));var e=this,n=Pi(t.providerId),r=kr(),i=null;(!Er()||sr())&&gl(this).options.authDomain&&t.isOAuthProvider&&(i=Us(gl(this).options.authDomain,gl(this).options.apiKey,gl(this).name,"signInViaPopup",t,null,r,Pk.a.SDK_VERSION||null,null,null,this.R()));var o=nr(i,n&&n.sa,n&&n.ra);return El(this,n=dl(this).then((function(n){return nc(n,o,"signInViaPopup",t,r,!!i,e.R())})).then((function(){return new Gt((function(t,n){e.ja("signInViaPopup",null,new Qr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=oc(e.a,e,"signInViaPopup",o,r)}))})).then((function(t){return o&&er(o),t?Ur(t):null})).s((function(t){throw o&&er(o),t})))},t.Mc=function(t){if(!br())return Jt(new Qr("operation-not-supported-in-this-environment"));var e=this;return El(this,dl(this).then((function(){return function(t){return cl(t,(function(){return t.b.set(il,t.c.C,t.a)}))}(e.h)})).then((function(){return ic(e.a,"signInViaRedirect",t,void 0,e.R())})))},t.oa=function(){var t=this;return pl(this).then((function(e){return t.a&&lc(t.a.b),e})).s((function(e){throw t.a&&lc(t.a.b),e}))},t.Rc=function(t){if(!t)return Jt(new Qr("null-user"));if(this.P!=t.tenantId)return Jt(new Qr("tenant-id-mismatch"));var e=this,n={};n.apiKey=gl(this).options.apiKey,n.authDomain=gl(this).options.authDomain,n.appName=gl(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Ia]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-T())/1e3,e=new Cc(e,o),n&&(e.da=n),r&&Sc(e,r),qc(e,t),e}(t,n,e.w,e.Ca());return El(this,this.i.then((function(){if(gl(e).options.apiKey!=t.l)return r.reload()})).then((function(){return bl(e)&&t.uid==bl(e).uid?(qc(bl(e),t),e.aa(t)):(ml(e,r),Rc(r),e.aa(r))})).then((function(){wl(e)})))},t.pb=function(){var t=this;return El(this,this.i.then((function(){return t.a&&lc(t.a.b),bl(t)?(ml(t,null),sl(t.h).then((function(){wl(t)}))):Qt()})))},t.Nc=function(){var t=this;return ul(this.h,gl(this).options.authDomain).then((function(e){if(!t.l){var n;if(n=bl(t)&&e){n=bl(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return qc(bl(t),e),bl(t).G();(bl(t)||e)&&(ml(t,e),e&&(Rc(e),e.da=t.w),t.a&&Zu(t.a,t),wl(t))}}))},t.aa=function(t){return al(this.h,t)},t.bc=function(){wl(this),this.aa(bl(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener((function(){t.next(bl(e))}))},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),El(t,t.i.then((function(){!t.l&&j(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(_l(t)))})))}(this,(function(){t.next(bl(e))}))},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){m(t)?t(bl(r)):m(t.next)&&t.next(bl(r))})),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then((function(){r.W=r.getUid(),m(t)?t(bl(r)):m(t.next)&&t.next(bl(r))})),this.Vb(t,e,n)},t.cc=function(t){var e=this;return El(this,this.i.then((function(){return bl(e)?bl(e).G(t).then((function(t){return{accessToken:t}})):null})))},t.Hc=function(t){var e=this;return this.i.then((function(){return yl(e,Ts(e.b,bs,{token:t}))})).then((function(t){var n=t.user;return jc(n,"isAnonymous",!1),e.aa(n),t}))},t.Ic=function(t,e){var n=this;return this.i.then((function(){return yl(n,Ts(n.b,_s,{email:t,password:e}))}))},t.Xb=function(t,e){var n=this;return this.i.then((function(){return yl(n,Ts(n.b,$a,{email:t,password:e}))}))},t.Sa=function(t){var e=this;return this.i.then((function(){return yl(e,t.na(e.b))}))},t.Gc=function(t){return Mr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},t.ob=function(){var t=this;return this.i.then((function(){var e=bl(t);if(e&&e.isAnonymous){var n=Ur({providerId:null,isNewUser:!1});return Ur({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return yl(t,t.b.ob()).then((function(e){var n=e.user;return jc(n,"isAnonymous",!0),t.aa(n),e}))}))},t.getUid=function(){return bl(this)&&bl(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&bl(this)&&Oc(bl(this))},t.Ec=function(t){var e=this;F(this.m,(function(n){n==t&&e.o--})),0>this.o&&(this.o=0),0==this.o&&bl(this)&&Pc(bl(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),El(this,this.i.then((function(){e.l||j(e.m,t)&&t(_l(e))})))},t.removeAuthTokenListener=function(t){G(this.m,(function(e){return e==t}))},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(ol("local"),t.a,this.ma),this.a&&($u(this.a,this),lc(this.a.b)),Promise.resolve()},t.$b=function(t){return El(this,function(t,e){return Ts(t,ts,{identifier:e,continueUri:_r()?Zn():"http://localhost"}).then((function(t){return t.signinMethods||[]}))}(this.b,t))},t.qc=function(t){return!!ho(t)},t.lb=function(t,e){var n=this;return El(this,Qt().then((function(){var t=new ci(e);if(!t.c)throw new Qr("argument-error",fi+" must be true when sending sign in link to email");return bi(t)})).then((function(e){return n.b.lb(t,e)})).then((function(){})))},t.Uc=function(t){return this.Ma(t).then((function(t){return t.data.email}))},t.ab=function(t,e){return El(this,this.b.ab(t,e).then((function(){})))},t.Ma=function(t){return El(this,this.b.Ma(t).then((function(t){return new jr(t)})))},t.Ya=function(t){return El(this,this.b.Ya(t).then((function(){})))},t.kb=function(t,e){var n=this;return El(this,Qt().then((function(){return void 0===e||K(e)?{}:bi(new ci(e))})).then((function(e){return n.b.kb(t,e)})).then((function(){})))},t.Kc=function(t,e){return El(this,mc(this,t,e,E(this.Sa,this)))},t.Jc=function(t,e){var n=this;return El(this,Qt().then((function(){var r=e||Zn(),i=lo(t,r);if(!(r=ho(r)))throw new Qr("argument-error","Invalid email link!");if(r.tenantId!==n.R())throw new Qr("tenant-id-mismatch");return n.Sa(i)})))},xl.prototype.render=function(){},xl.prototype.reset=function(){},xl.prototype.getResponse=function(){},xl.prototype.execute=function(){};var Cl=null;function kl(t,e){return(e=Sl(e))&&t.a[e]||null}function Sl(t){return(t=void 0===t?1e12:t)?t.toString():null}function Al(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=qn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():We(this.f,"click",this.i)}function Il(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Ol(){}Tl.prototype.render=function(t,e){return this.a[this.b.toString()]=new Al(t,e),this.b++},Tl.prototype.reset=function(t){var e=kl(this,t);t=Sl(t),e&&t&&(e.delete(),delete this.a[t])},Tl.prototype.getResponse=function(t){return(t=kl(this,t))?t.getResponse():null},Tl.prototype.execute=function(t){(t=kl(this,t))&&t.execute()},Al.prototype.getResponse=function(){return Il(this),this.b},Al.prototype.execute=function(){Il(this);var t=this;this.a||(this.a=setTimeout((function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(r){}t.a=setTimeout((function(){if(t.a=null,t.b=null,n)try{n()}catch(r){}t.h&&t.execute()}),6e4)}),500))},Al.prototype.delete=function(){Il(this),this.g=!0,clearTimeout(this.a),this.a=null,Ye(this.f,"click",this.i)},Ol.prototype.g=function(){return Cl||(Cl=new Tl),Qt(Cl)},Ol.prototype.c=function(){};var Pl=null;function Dl(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Nl=new J(tt,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Rl=new Ir(3e4,6e4);Dl.prototype.g=function(t){var e=this;return new Gt((function(n,r){var i=setTimeout((function(){r(new Qr("network-request-failed"))}),Rl.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new Qr("internal-error"));delete a[e.a]},Qt(_a(it(Nl,{onload:e.a,hl:t||""}))).s((function(){clearTimeout(i),r(new Qr("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(a.grecaptcha))}))},Dl.prototype.c=function(){this.b--};var Ml=null;function Ll(t,e,n,r,i,o,s){if(Br(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,s?(Pl||(Pl=new Ol),s=Pl):(Ml||(Ml=new Dl),s=Ml),this.m=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Ul])throw new Qr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Vl],!a.document)throw new Qr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!qn(e)||!this.i&&qn(e).hasChildNodes())throw new Qr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Sa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.l=[];var c=this.a[Bl];this.a[Bl]=function(t){if(jl(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=yr(c,a);"function"==typeof e&&e(t)}};var l=this.a[Fl];this.a[Fl]=function(){if(jl(u,null),"function"==typeof l)l();else if("string"==typeof l){var t=yr(l,a);"function"==typeof t&&t()}}}var Bl="callback",Fl="expired-callback",Ul="sitekey",Vl="size";function jl(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(r){}}function ql(t,e){return t.h.push(e),e.ka((function(){q(t.h,e)})),e}function Gl(t){if(t.B)throw new Qr("internal-error","RecaptchaVerifier instance has been destroyed.")}function zl(t,e,n){var r=!1;try{this.b=n||Pk.a.app()}catch(a){throw new Qr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Qr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Ca()}catch(a){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(a){}o=Pk.a.SDK_VERSION?vr(Pk.a.SDK_VERSION,o):null,Ll.call(this,n,t,e,(function(){try{var t=i.b.auth().ha()}catch(e){t=null}return t}),o,Si(Ci),r)}function Hl(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Qr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],0>i||i>=Wl.length)throw new Qr("internal-error","Argument validator received an unsupported number of arguments.");n=Wl[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Qr("argument-error",t+" failed: "+r)}(t=Ll.prototype).Da=function(){var t=this;return this.f?this.f:this.f=ql(this,Qt().then((function(){if(_r()&&!ur())return or();throw new Qr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return t.m.g(t.v())})).then((function(e){return t.g=e,Ts(t.o,ls,{})})).then((function(e){t.a[Ul]=e.recaptchaSiteKey})).s((function(e){throw t.f=null,e})))},t.render=function(){Gl(this);var t=this;return ql(this,this.Da().then((function(){if(null===t.c){var e=t.u;if(!t.i){var n=qn(e);e=function(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!jn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',Bt(a.name),'"'),a.type){o.push(' type="',Bt(a.type),'"');var u={};Q(u,a),delete u.type,a=u}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(s(a)?o.className=a:p(a)?o.className=a.join(" "):Gn(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(s(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!v(o)||y(o)&&0<o.nodeType?r(o):F(Hn(o)?H(o):o,r)}}(i,o,r),o}("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c})))},t.verify=function(){Gl(this);var t=this;return ql(this,this.render().then((function(e){return new Gt((function(n){var r=t.g.getResponse(e);if(r)n(r);else{t.l.push((function e(r){r&&(function(t,e){G(t.l,(function(t){return t==e}))}(t,e),n(r))})),t.i&&t.g.execute(t.c)}}))})))},t.reset=function(){Gl(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Gl(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=qn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},C(zl,Ll);var Wl="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Kl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:s}}function Xl(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:u}}function Yl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:y}}function Ql(t,e){return{name:t||"",M:"a function",optional:!!e,N:m}}function Jl(t,e){return{name:t||"",M:"null",optional:!!e,N:d}}function Zl(t){return{name:t?t+"Credential":"credential",M:t?"a valid "+t+" credential":"a valid credential",optional:!1,N:function(e){return!!e&&!(!e.na||t&&e.providerId!==t)}}}function $l(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&s(t.type)&&m(t.verify))}}}function th(t,e,n,r){return{name:n||"",M:t.M+" or "+e.M,optional:!!r,N:function(n){return t.N(n)||e.N(n)}}}function eh(t,e){for(var n in e){var r=e[n].name;t[r]=ih(r,t[n],e[n].j)}}function nh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:x((function(t){return this[t]}),n),set:x((function(t,e,n,r){Hl(t,[n],[r],!0),this[e]=r}),r,n,e[n].Za),enumerable:!0})}}function rh(t,e,n,r){t[e]=ih(e,n,r)}function ih(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Hl(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}eh(ll.prototype,{Ya:{name:"applyActionCode",j:[Kl("code")]},Ma:{name:"checkActionCode",j:[Kl("code")]},ab:{name:"confirmPasswordReset",j:[Kl("code"),Kl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[Kl("email"),Kl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[Kl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[Kl("emailLink")]},wc:{name:"onAuthStateChanged",j:[th(Yl(),Ql(),"nextOrObserver"),Ql("opt_error",!0),Ql("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[th(Yl(),Ql(),"nextOrObserver"),Ql("opt_error",!0),Ql("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[Kl("email"),th(Yl("opt_actionCodeSettings",!0),Jl(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[Kl("email"),Yl("actionCodeSettings")]},mb:{name:"setPersistence",j:[Kl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[Zl()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[Zl()]},Hc:{name:"signInWithCustomToken",j:[Kl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[Kl("email"),Kl("password")]},Jc:{name:"signInWithEmailLink",j:[Kl("email"),Kl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[Kl("phoneNumber"),$l()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[th({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Cc)}},Jl(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Kl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[Kl("code")]}}),nh(ll.prototype,{lc:{name:"languageCode",Za:th(Kl(),Jl(),"languageCode")},ti:{name:"tenantId",Za:th(Kl(),Jl(),"tenantId")}}),(ll.Persistence=gu).LOCAL="local",ll.Persistence.SESSION="session",ll.Persistence.NONE="none",eh(Cc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[Xl("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[Xl("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[Zl()]},fb:{name:"linkWithCredential",j:[Zl()]},sc:{name:"linkWithPhoneNumber",j:[Kl("phoneNumber"),$l()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Zl()]},hb:{name:"reauthenticateWithCredential",j:[Zl()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[Kl("phoneNumber"),$l()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[th(Yl("opt_actionCodeSettings",!0),Jl(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Kl(null,!0)]},Qc:{name:"unlink",j:[Kl("provider")]},rb:{name:"updateEmail",j:[Kl("email")]},sb:{name:"updatePassword",j:[Kl("password")]},Sc:{name:"updatePhoneNumber",j:[Zl("phone")]},tb:{name:"updateProfile",j:[Yl("profile")]}}),eh(Tl.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),eh(xl.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),eh(Gt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),nh(pc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:Xl("appVerificationDisabledForTesting")}}),eh(vc.prototype,{confirm:{name:"confirm",j:[Kl("verificationCode")]}}),rh(qi,"fromJSON",(function(t){t=s(t)?JSON.parse(t):t;for(var e,n=[Yi,uo,po,Wi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null}),[th(Kl(),Yl(),"json")]),rh(co,"credential",(function(t,e){return new so(t,e)}),[Kl("email"),Kl("password")]),eh(so.prototype,{A:{name:"toJSON",j:[Kl(null,!0)]}}),eh($i.prototype,{ya:{name:"addScope",j:[Kl("scope")]},Ga:{name:"setCustomParameters",j:[Yl("customOAuthParameters")]}}),rh($i,"credential",to,[th(Kl(),Yl(),"token")]),rh(co,"credentialWithLink",lo,[Kl("email"),Kl("emailLink")]),eh(eo.prototype,{ya:{name:"addScope",j:[Kl("scope")]},Ga:{name:"setCustomParameters",j:[Yl("customOAuthParameters")]}}),rh(eo,"credential",no,[th(Kl(),Yl(),"token")]),eh(ro.prototype,{ya:{name:"addScope",j:[Kl("scope")]},Ga:{name:"setCustomParameters",j:[Yl("customOAuthParameters")]}}),rh(ro,"credential",io,[th(Kl(),th(Yl(),Jl()),"idToken"),th(Kl(),Jl(),"accessToken",!0)]),eh(oo.prototype,{Ga:{name:"setCustomParameters",j:[Yl("customOAuthParameters")]}}),rh(oo,"credential",ao,[th(Kl(),Yl(),"token"),Kl("secret",!0)]),eh(Zi.prototype,{ya:{name:"addScope",j:[Kl("scope")]},credential:{name:"credential",j:[th(Kl(),th(Yl(),Jl()),"optionsOrIdToken"),th(Kl(),Jl(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[Yl("customOAuthParameters")]}}),eh(Ki.prototype,{A:{name:"toJSON",j:[Kl(null,!0)]}}),eh(zi.prototype,{A:{name:"toJSON",j:[Kl(null,!0)]}}),rh(mo,"credential",yo,[Kl("verificationId"),Kl("verificationCode")]),eh(mo.prototype,{Wa:{name:"verifyPhoneNumber",j:[Kl("phoneNumber"),$l()]}}),eh(fo.prototype,{A:{name:"toJSON",j:[Kl(null,!0)]}}),eh(Qr.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),eh(ko.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),eh(Co.prototype,{toJSON:{name:"toJSON",j:[Kl(null,!0)]}}),eh(zl.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),rh(ti,"parseLink",ui,[Kl("link")]),function(){if(void 0===Pk.a||!Pk.a.INTERNAL||!Pk.a.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:qr,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:ll,AuthCredential:qi,Error:Qr};rh(t,"EmailAuthProvider",co,[]),rh(t,"FacebookAuthProvider",$i,[]),rh(t,"GithubAuthProvider",eo,[]),rh(t,"GoogleAuthProvider",ro,[]),rh(t,"TwitterAuthProvider",oo,[]),rh(t,"OAuthProvider",Zi,[Kl("providerId")]),rh(t,"SAMLAuthProvider",Ji,[Kl("providerId")]),rh(t,"PhoneAuthProvider",mo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof ll)}}]),rh(t,"RecaptchaVerifier",zl,[th(Kl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Yl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof Pk.a.app.App)}}]),rh(t,"ActionCodeURL",ti,[]),Pk.a.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new ll(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),Pk.a.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:E((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:E(t.cc,t),addAuthTokenListener:E(t.Wb,t),removeAuthTokenListener:E(t.Ec,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),Pk.a.registerVersion("@firebase/auth","0.13.3"),Pk.a.INTERNAL.extendNamespace({User:Cc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Dk=n("S+S0"),Nk="firebasestorage.googleapis.com",Rk="storageBucket",Mk=12e4,Lk=6e5,Bk=-9007199254740991,Fk=function(){function t(t,e){this.code_=Vk(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return Vk(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),Uk={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function Vk(t){return"storage/"+t}function jk(){return new Fk(Uk.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function qk(){return new Fk(Uk.CANCELED,"User canceled the upload/download.")}function Gk(){return new Fk(Uk.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function zk(){return new Fk(Uk.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Hk(t,e,n){return new Fk(Uk.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function Wk(){return new Fk(Uk.APP_DELETED,"The Firebase app was deleted.")}function Kk(t,e){return new Fk(Uk.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Xk(t){throw new Fk(Uk.INTERNAL_ERROR,"Internal error: "+t)}var Yk={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function Qk(t){switch(t){case Yk.RAW:case Yk.BASE64:case Yk.BASE64URL:case Yk.DATA_URL:return;default:throw"Expected one of the event types: ["+Yk.RAW+", "+Yk.BASE64+", "+Yk.BASE64URL+", "+Yk.DATA_URL+"]."}}var Jk=function(t,e){this.data=t,this.contentType=e||null};function Zk(t,e){switch(t){case Yk.RAW:return new Jk($k(e));case Yk.BASE64:case Yk.BASE64URL:return new Jk(tS(t,e));case Yk.DATA_URL:return new Jk((n=new eS(e)).base64?tS(Yk.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(n){throw Kk(Yk.DATA_URL,"Malformed data URL.")}return $k(e)}(n.rest),new eS(e).contentType)}var n;throw jk()}function $k(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){var i=r,o=t.charCodeAt(++n);e.push(240|(r=65536|(1023&i)<<10|1023&o)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function tS(t,e){switch(t){case Yk.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw Kk(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case Yk.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw Kk(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(c){throw Kk(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var eS=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Kk(Yk.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r=e[1]||null;null!=r&&(this.base64=(n=r).length>=";base64".length&&";base64"===n.substring(n.length-";base64".length),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=t.substring(t.indexOf(",")+1)},nS={STATE_CHANGED:"state_changed"},rS={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},iS={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function oS(t){switch(t){case rS.RUNNING:case rS.PAUSING:case rS.CANCELING:return iS.RUNNING;case rS.PAUSED:return iS.PAUSED;case rS.SUCCESS:return iS.SUCCESS;case rS.CANCELED:return iS.CANCELED;case rS.ERROR:default:return iS.ERROR}}function aS(t){return null!=t}function sS(t){return void 0!==t}function uS(t){return"function"==typeof t}function cS(t){return"object"==typeof t}function lS(t){return cS(t)&&null!==t}function hS(t){return"string"==typeof t||t instanceof String}function fS(t){return dS(t)&&Number.isInteger(t)}function dS(t){return"number"==typeof t||t instanceof Number}function pS(t){return vS()&&t instanceof Blob}function vS(){return"undefined"!=typeof Blob}var mS=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}({}),yS=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=mS.NO_ERROR,this.sendPromise_=new Promise((function(e){t.xhr_.addEventListener("abort",(function(){t.errorCode_=mS.ABORT,e(t)})),t.xhr_.addEventListener("error",(function(){t.errorCode_=mS.NETWORK_ERROR,e(t)})),t.xhr_.addEventListener("load",(function(){e(t)}))}))}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw Xk("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),aS(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return aS(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw Xk("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw Xk("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw Xk("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){aS(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){aS(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),gS=function(){function t(){}return t.prototype.createXhrIo=function(){return new yS},t}();function bS(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function _S(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=bS();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(vS())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var wS=function(){function t(t,e){var n=0,r="";pS(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(pS(this.data_)){var r=(o=e,a=n,(i=this.data_).webkitSlice?i.webkitSlice(o,a):i.mozSlice?i.mozSlice(o,a):i.slice?i.slice(o,a):null);return null===r?null:new t(r)}var i,o,a;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(vS()){var r=e.map((function(e){return e instanceof t?e.data_:e}));return new t(_S.apply(null,r))}var i=e.map((function(t){return hS(t)?Zk(Yk.RAW,t).data:t.data_})),o=0;i.forEach((function(t){o+=t.byteLength}));var a=new Uint8Array(o),s=0;return i.forEach((function(t){for(var e=0;e<t.length;e++)a[s++]=t[e]})),new t(a,!0)},t.prototype.uploadData=function(){return this.data_},t}(),ES=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n;try{n=t.makeFromUrl(e)}catch(r){return new t(e,"")}if(""===n.path)return n;throw new Fk(Uk.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e){for(var n=null,r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i"),i=Nk.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(e);if(u){var c=u[s.indices.path];c||(c=""),n=new t(u[s.indices.bucket],c),s.postModify(n);break}}if(null==n)throw function(t){return new Fk(Uk.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();function xS(t){var e,n;try{e=JSON.parse(t)}catch(r){return null}return cS(n=e)&&!Array.isArray(n)?e:null}function TS(t,e){var n=e.split("/").filter((function(t){return t.length>0})).join("/");return 0===t.length?n:t+"/"+n}function CS(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function kS(t){return"https://"+Nk+"/v0"+t}function SS(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}function AS(t,e){return e}var IS=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||AS},OS=null;function PS(t,e,n){var r=xS(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new ES(t.bucket,t.fullPath);return e.makeStorageReference(n)}})}(r,t),r}(t,r,n)}function DS(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function NS(t){if(!cS(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!cS(n))throw"Expected object for 'customMetadata' mapping."}else if(lS(n))throw"Mapping for '"+e+"' cannot be an object."}}var RS="maxResults",MS=1e3,LS="pageToken",BS="prefixes",FS="items";function US(t){if(!cS(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===RS){if(!fS(t[RS])||t[RS]<=0)throw"Expected maxResults to be a positive number.";if(t[RS]>1e3)throw"Expected maxResults to be less than or equal to "+MS+"."}else{if(e!==LS)throw"Unknown option: "+e;if(t[LS]&&!hS(t[LS]))throw"Expected pageToken to be string."}}var VS=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function jS(t){if(!t)throw jk()}function qS(t,e){return function(n,r){var i=PS(t,r,e);return jS(null!==i),i}}function GS(t){return function(e,n){var r;return(r=401===e.getStatus()?new Fk(Uk.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?new Fk(Uk.QUOTA_EXCEEDED,"Quota for bucket '"+t.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===e.getStatus()?new Fk(Uk.UNAUTHORIZED,"User does not have permission to access '"+t.path+"'."):n).setServerResponseProp(n.serverResponseProp()),r}}function zS(t){var e=GS(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=new Fk(Uk.OBJECT_NOT_FOUND,"Object '"+t.path+"' does not exist.")),i.setServerResponseProp(r.serverResponseProp()),i}}function HS(t,e,n){var r=kS(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new VS(r,"GET",qS(t,n),i);return o.errorHandler=zS(e),o}function WS(t,e,n,r,i){var o={};o.prefix=e.isRoot?"":e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=kS(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new VS(a,"GET",function(t){return function(e,n){var r=function(t,e){var n=xS(e);return null===n?null:function(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new Fk(Uk.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Rk+"' property when initializing the app?");if(e[BS])for(var i=0,o=e[BS];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new ES(r,a));n.prefixes.push(s)}if(e[FS])for(var u=0,c=e[FS];u<c.length;u++)s=t.makeStorageReference(new ES(r,c[u].name)),n.items.push(s);return n}(t,n)}(t,n);return jS(null!==r),r}}(t),s);return u.urlParams=o,u.errorHandler=GS(e),u}function KS(t,e,n){var r=kS(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new VS(r,"GET",function(t,e){return function(n,r){var i=PS(t,r,e);return jS(null!==i),function(t,e){var n=xS(e);if(null===n)return null;if(!hS(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map((function(e){var n=t.fullPath;return kS("/b/"+i(t.bucket)+"/o/"+i(n))+SS({alt:"media",token:e})}))[0]}(i,r)}}(t,n),i);return o.errorHandler=zS(e),o}function XS(t,e,n,r){var i=kS(e.fullServerUrl()),o=DS(n,r),a=t.maxOperationRetryTime(),s=new VS(i,"PATCH",qS(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=zS(e),s}function YS(t,e){var n=kS(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new VS(n,"DELETE",(function(t,e){}),r);return i.successCodes=[200,204],i.errorHandler=zS(e),i}function QS(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var JS=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function ZS(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(r){jS(!1)}return jS(!!n&&-1!==(e||["active"]).indexOf(n)),n}var $S=function(t,e,n){if(uS(t)||aS(e)||aS(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},tA=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function eA(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw(a=r)===(s=i)?(u=a,c=1===a?"argument":"arguments"):(u="between "+a+" and "+s,c="arguments"),new Fk(Uk.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+t+"`: Expected "+u+" "+c+", received "+n.length+".");var a,s,u,c;for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(l){throw l instanceof Error?Hk(o,t,l.message):Hk(o,t,l)}}var nA=function(t,e){var n=this;this.validator=function(e){n.optional&&!sS(e)||t(e)},this.optional=!!e};function rA(t,e){function n(t){if(!hS(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new nA(r,e)}function iA(){return new nA((function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||vS()&&t instanceof Blob))throw"Expected Blob or File."}))}function oA(t){return new nA(NS,t)}function aA(t){return new nA(US,t)}function sA(){return new nA((function(t){if(!(dS(t)&&t>=0))throw"Expected a number 0 or greater."}))}function uA(t,e){return new nA((function(e){if(!(null===e||aS(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)}),e)}function cA(t){return new nA((function(t){if(null!==t&&!uS(t))throw"Expected a Function."}),t)}function lA(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then((function(){return t.apply(void 0,e)}))}}var hA=function(){function t(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=rS.RUNNING,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(Uk.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(rS.ERROR))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(Uk.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(rS.ERROR))},this.promise_=new Promise((function(t,e){a.resolve_=t,a.reject_=e,a.start_()})),this.promise_.then(null,(function(){}))}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===rS.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then((function(n){switch(e.state_){case rS.RUNNING:t(n);break;case rS.CANCELING:e.transition_(rS.CANCELED);break;case rS.PAUSING:e.transition_(rS.PAUSED)}}))},t.prototype.createResumable_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=QS(e,r,i),s={name:a.fullPath},u=kS(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},l=DS(a,n),h=t.maxUploadRetryTime(),f=new VS(u,"POST",(function(t){var e;ZS(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(n){jS(!1)}return jS(hS(e)),e}),h);return f.urlParams=s,f.headers=c,f.body=l,f.errorHandler=GS(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_((function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new VS(n,"POST",(function(t){var e=ZS(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(o){jS(!1)}n||jS(!1);var i=Number(n);return jS(!isNaN(i)),new JS(i,r.size(),"final"===e)}),i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=GS(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then((function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new JS(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_((function(i){var o;try{o=function(t,e,n,r,i,o,a,s){var u=new JS(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new Fk(Uk.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,l=c;i>0&&(l=Math.min(l,i));var h=u.current,f={"X-Goog-Upload-Command":l===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(h,h+l);if(null===d)throw Gk();var p=e.maxUploadRetryTime(),v=new VS(n,"POST",(function(t,n){var i,a=ZS(t,["active","final"]),s=u.current+l,c=r.size();return i="final"===a?qS(e,o)(t,n):null,new JS(s,c,"final"===a,i)}),p);return v.headers=f,v.body=d.uploadData(),v.progressCallback=s||null,v.errorHandler=GS(t),v}(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(s){return t.error_=s,void t.transition_(rS.ERROR)}var a=t.authWrapper_.makeRequest(o,i);t.request_=a,a.getPromise().then((function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(rS.SUCCESS)):t.completeTransitions_()}),t.errorHandler_)}))},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_((function(e){var n=HS(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.metadata_=e,t.transition_(rS.SUCCESS)}),t.metadataErrorHandler_)}))},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_((function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=QS(e,r,i),c=DS(u,n),l=wS.getBlob("--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",r,"\r\n--"+s+"--");if(null===l)throw Gk();var h={name:u.fullPath},f=kS(o),d=t.maxUploadRetryTime(),p=new VS(f,"POST",qS(t,n),d);return p.urlParams=h,p.headers=a,p.body=l.uploadData(),p.errorHandler=GS(e),p}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then((function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(rS.SUCCESS)}),t.errorHandler_)}))},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case rS.CANCELING:case rS.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case rS.RUNNING:var e=this.state_===rS.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case rS.PAUSED:this.state_=t,this.notifyObservers_();break;case rS.CANCELED:this.error_=qk(),this.state_=t,this.notifyObservers_();break;case rS.ERROR:case rS.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case rS.PAUSING:this.transition_(rS.PAUSED);break;case rS.CANCELING:this.transition_(rS.CANCELED);break;case rS.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=oS(this.state_);return new tA(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){function i(){if(t!==nS.STATE_CHANGED)throw"Expected one of the event types: ["+nS.STATE_CHANGED+"]."}var o="Expected a function or an Object with one of `next`, `error`, `complete` properties.",a=cA(!0).validator,s=uA(null,!0).validator;function u(t){try{return void a(t)}catch(e){}try{if(s(t),!(sS(t.next)||sS(t.error)||sS(t.complete)))throw"";return}catch(e){throw o}}var c=[rA(i),uA(u,!0),cA(!0),cA(!0)];eA("on",c,arguments);var l=this;function h(t){return function(e,n,i){null!==t&&eA("on",t,arguments);var o=new $S(e,n,r);return l.addObserver_(o),function(){l.removeObserver_(o)}}}function f(t){if(null===t)throw o;u(t)}var d=[uA(f),cA(!0),cA(!0)],p=!(sS(e)||sS(n)||sS(r));return p?h(d):h(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach((function(e){t.notifyObserver_(e)}))},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(oS(this.state_)){case iS.SUCCESS:lA(this.resolve_.bind(null,this.snapshot))();break;case iS.CANCELED:case iS.ERROR:lA(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(oS(this.state_)){case iS.RUNNING:case iS.PAUSED:t.next&&lA(t.next.bind(t,this.snapshot))();break;case iS.SUCCESS:t.complete&&lA(t.complete.bind(t))();break;case iS.CANCELED:case iS.ERROR:t.error&&lA(t.error.bind(t,this.error_))();break;default:t.error&&lA(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){eA("resume",[],arguments);var t=this.state_===rS.PAUSED||this.state_===rS.PAUSING;return t&&this.transition_(rS.RUNNING),t},t.prototype.pause=function(){eA("pause",[],arguments);var t=this.state_===rS.RUNNING;return t&&this.transition_(rS.PAUSING),t},t.prototype.cancel=function(){eA("cancel",[],arguments);var t=this.state_===rS.RUNNING||this.state_===rS.PAUSING;return t&&this.transition_(rS.CANCELING),t},t}(),fA=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof ES?e:ES.makeFromUrl(e)}return t.prototype.toString=function(){return eA("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return function(){if(OS)return OS;var t=[];t.push(new IS("bucket")),t.push(new IS("generation")),t.push(new IS("metageneration")),t.push(new IS("name","fullPath",!0));var e=new IS("name");e.xform=function(t,e){return function(t){return!hS(t)||t.length<2?t:CS(t)}(e)},t.push(e);var n=new IS("size");return n.xform=function(t,e){return aS(e)?Number(e):e},t.push(n),t.push(new IS("timeCreated")),t.push(new IS("updated")),t.push(new IS("md5Hash",null,!0)),t.push(new IS("cacheControl",null,!0)),t.push(new IS("contentDisposition",null,!0)),t.push(new IS("contentEncoding",null,!0)),t.push(new IS("contentLanguage",null,!0)),t.push(new IS("contentType",null,!0)),t.push(new IS("metadata","customMetadata",!0)),OS=t}()},t.prototype.child=function(t){eA("child",[rA()],arguments);var e=TS(this.location.path,t),n=new ES(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new ES(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new ES(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return CS(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),eA("put",[iA(),oA(!0)],arguments),this.throwIfRoot_("put"),new hA(this,this.authWrapper,this.location,this.mappings(),new wS(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=Yk.RAW),eA("putString",[rA(),rA(Qk,!0),oA(!0)],arguments),this.throwIfRoot_("putString");var r=Zk(e,t),i=Object.assign({},n);return!aS(i.contentType)&&aS(r.contentType)&&(i.contentType=r.contentType),new hA(this,this.authWrapper,this.location,this.mappings(),new wS(r.data,!0),i)},t.prototype.delete=function(){var t=this;return eA("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then((function(e){var n=YS(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()}))},t.prototype.listAll=function(){eA("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then((function(){return t}))},t.prototype.listAllHelper=function(t,e){return Object(Qs.__awaiter)(this,void 0,void 0,(function(){var n,r,i;return Object(Qs.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.list({pageToken:e})];case 1:return n=o.sent(),(r=t.prefixes).push.apply(r,n.prefixes),(i=t.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(t,n.nextPageToken)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},t.prototype.list=function(t){eA("list",[aA(!0)],arguments);var e=this;return this.authWrapper.getAuthToken().then((function(n){var r=t||{},i=WS(e.authWrapper,e.location,"/",r.pageToken,r.maxResults);return e.authWrapper.makeRequest(i,n).getPromise()}))},t.prototype.getMetadata=function(){var t=this;return eA("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then((function(e){var n=HS(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()}))},t.prototype.updateMetadata=function(t){var e=this;return eA("updateMetadata",[oA()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then((function(n){var r=XS(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()}))},t.prototype.getDownloadURL=function(){var t=this;return eA("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then((function(e){var n=KS(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then((function(t){if(null===t)throw zk();return t}))}))},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Fk(Uk.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),dA=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}(),pA=function(){function t(){this.map=new Map,this.id=Bk}return t.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then((function(){return e.map.delete(n)}),(function(){return e.map.delete(n)}))},t.prototype.clear=function(){this.map.forEach((function(t){t&&t.cancel(!0)})),this.map.clear()},t}(),vA=function(){function t(e,n,r,i,o,a){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var s=this.app_.options;aS(s)&&(this.bucket_=t.extractBucket_(s))}this.authProvider_=n,this.storageRefMaker_=r,this.requestMaker_=i,this.pool_=a,this.service_=o,this.maxOperationRetryTime_=Mk,this.maxUploadRetryTime_=Lk,this.requestMap_=new pA}return t.extractBucket_=function(t){var e=t[Rk]||null;return null==e?null:ES.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){var t=this.authProvider_.getImmediate({optional:!0});return t?t.getToken().then((function(t){return null!==t?t.accessToken:null}),(function(){return null})):Promise.resolve(null)},t.prototype.bucket=function(){if(this.deleted_)throw Wk();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new dA(Wk());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}(),mA=function(){function t(t,e,n,r,i,o,a,s,u,c,l){var h=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=l,this.promise_=new Promise((function(t,e){h.resolve_=t,h.reject_=e,h.start_()}))}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());sS(s)?i(s):i()}catch(u){o(u)}else null!==a?((r=jk()).setServerResponseProp(a.getResponseText()),o(t.errorCallback_?t.errorCallback_(a,r):r)):o(r=n.canceled?t.appDelete_?Wk():qk():new Fk(Uk.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new yA(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function l(e){i=setTimeout((function(){i=null,t(h,s())}),e)}function h(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];u||(t?c.call.apply(c,Object(Qs.__spreadArrays)([null,t],n)):s()||o?c.call.apply(c,Object(Qs.__spreadArrays)([null,t],n)):(r<64&&(r*=2),1===a?(a=2,e=0):e=1e3*(r+Math.random()),l(e)))}var f=!1;function d(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),l(0)):t||(a=1)))}return l(0),setTimeout((function(){o=!0,d(!0)}),n),d}((function(e,n){if(n)e(!1,new yA(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then((function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===mS.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new yA(a,n))}else{var s=n.getErrorCode()===mS.ABORT;e(!1,new yA(!1,null,s))}}))}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}}),e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),yA=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function gA(t,e,n){var r=SS(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,e),function(t){t["X-Firebase-Storage-Version"]="webjs/"+(void 0!==Pk.a?Pk.a.SDK_VERSION:"AppManager")}(o),new mA(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var bA,_A,wA=function(){function t(t,e,n,r){if(this.bucket_=null,this.authWrapper_=new vA(t,e,(function(t,e){return new fA(t,e)}),gA,this,n),this.app_=t,null!=r)this.bucket_=ES.makeFromBucketSpec(r);else{var i=this.authWrapper_.bucket();null!=i&&(this.bucket_=new ES(i,""))}this.internals_=new EA(this)}return t.prototype.ref=function(t){function e(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."}if(eA("ref",[rA(e,!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var n=new fA(this.authWrapper_,this.bucket_);return null!=t?n.child(t):n},t.prototype.refFromURL=function(t){function e(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{ES.makeFromUrl(t)}catch(e){throw"Expected valid full URL but got an invalid one."}}return eA("refFromURL",[rA(e,!1)],arguments),new fA(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){eA("setMaxUploadRetryTime",[sA()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){eA("setMaxOperationRetryTime",[sA()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),EA=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},t}();_A={TaskState:iS,TaskEvent:nS,StringFormat:Yk,Storage:wA,Reference:fA},(bA=Pk.a).INTERNAL.registerComponent(new Dk.Component("storage",(function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return new wA(n,r,new gS,e)}),"PUBLIC").setServiceProps(_A).setMultipleInstances(!0)),bA.registerVersion("@firebase/storage","0.3.22");var xA=n("Wcq6");function TA(){return function(t,e,n){var r=n.value;return n.value=function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return console.log("Call ".concat(t.constructor.name,".").concat(e," method")),r.apply(this,i)},n}}var CA,kA=(CA=function(){function t(e){_classCallCheck2(this,t),this.firebaseService=e,this.initDB()}return _createClass2(t,[{key:"initDB",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.db=this.firebaseService.firebase.firestore(),this.storage=this.firebaseService.firebase.storage();case 1:case"end":return t.stop()}}),t,this)})))}},{key:"levels",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db.collection("levels").get();case 2:return t.t0=function(t){return t.id},t.abrupt("return",t.sent.docs.map(t.t0));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"level",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("levels").doc(t);case 2:return n=e.sent,e.next=5,n.get();case 5:return e.abrupt("return",e.sent.data());case 6:case"end":return e.stop()}}),e,this)})))}},{key:"updateLevel",value:function(t,e){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("update level",t,e),n.next=3,this.db.collection("levels").doc(t);case 3:return r=n.sent,n.prev=4,n.next=7,r.set(e);case 7:return n.abrupt("return",n.sent);case 10:if(n.prev=10,n.t0=n.catch(4),"permission-denied"!==n.t0.code){n.next=16;break}return n.next=15,this.authorize();case 15:return n.abrupt("return",this.updateLevel(t,e));case 16:case"end":return n.stop()}}),n,this,[[4,10]])})))}},{key:"aiList",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db.collection("ais").get();case 2:return t.t0=function(t){return{name:t.id,info:t.data()}},t.abrupt("return",t.sent.docs.map(t.t0));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"updateAIInfo",value:function(t,e){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("update ai info",t,e),n.next=3,this.db.collection("ais").doc(t);case 3:return r=n.sent,n.prev=4,n.next=7,r.set(e);case 7:return n.abrupt("return",n.sent);case 10:if(n.prev=10,n.t0=n.catch(4),"permission-denied"!==n.t0.code){n.next=16;break}return n.next=15,this.authorize();case 15:return n.abrupt("return",this.updateAIInfo(t,e));case 16:case"end":return n.stop()}}),n,this,[[4,10]])})))}},{key:"loadAIInfo",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("ais").doc(t);case 2:return n=e.sent,e.prev=3,e.next=6,n.get();case 6:return e.abrupt("return",e.sent.data());case 9:if(e.prev=9,e.t0=e.catch(3),"permission-denied"!==e.t0.code){e.next=15;break}return e.next=14,this.authorize();case 14:return e.abrupt("return",this.loadAIInfo(t));case 15:case"end":return e.stop()}}),e,this,[[3,9]])})))}},{key:"updateAI",value:function(t,e){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=JSON.stringify(e),n.abrupt("return",this.storage.ref().child("ais/"+t).putString(r));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"loadAI",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.storage.ref().child("ais/"+t),e.next=3,n.getDownloadURL();case 3:return r=e.sent,e.next=6,fetch(r);case 6:return i=e.sent,e.next=9,i.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"authorize",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new xA.auth.GoogleAuthProvider,t.next=3,this.firebaseService.firebase.auth().signInWithPopup(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}}]),t}(),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[String,Object]),Qs.__metadata("design:returntype",Promise)],CA.prototype,"updateAIInfo",null),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[Object]),Qs.__metadata("design:returntype",Promise)],CA.prototype,"loadAIInfo",null),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[String,Object]),Qs.__metadata("design:returntype",Promise)],CA.prototype,"updateAI",null),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[String]),Qs.__metadata("design:returntype",Promise)],CA.prototype,"loadAI",null),CA),SA=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,n))).scheduler=t,r.work=n,r.pending=!1,r}return _inherits(e,t),_createClass2(e,[{key:"schedule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}},{key:"requestAsyncId",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return setInterval(t.flush.bind(t,this),n)}},{key:"recycleAsyncId",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}},{key:"execute",value:function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}},{key:"_execute",value:function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r}},{key:"_unsubscribe",value:function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}]),e}(function(t){function e(t,n){return _classCallCheck2(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this))}return _inherits(e,t),_createClass2(e,[{key:"schedule",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this}}]),e}(et)),AA=function(){var t=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.now;_classCallCheck2(this,t),this.SchedulerAction=e,this.now=n}return _createClass2(t,[{key:"schedule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new this.SchedulerAction(this,t).schedule(n,e)}}]),t}();return t.now=function(){return Date.now()},t}(),IA=new(function(t){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AA.now;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,(function(){return e.delegate&&e.delegate!==_assertThisInitialized(n)?e.delegate.now():r()})))).actions=[],n.active=!1,n.scheduled=void 0,n}return _inherits(e,t),_createClass2(e,[{key:"schedule",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return e.delegate&&e.delegate!==this?e.delegate.schedule(t,n,r):_get(_getPrototypeOf(e.prototype),"schedule",this).call(this,t,n,r)}},{key:"flush",value:function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}}]),e}(AA))(SA);function OA(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IA;return(J(t=e)||!(t-parseFloat(t)+1>=0)||e<0)&&(e=0),n&&"function"==typeof n.schedule||(n=IA),new ct((function(t){return t.add(n.schedule(PA,e,{subscriber:t,counter:0,period:e})),t}))}function PA(t){var e=t.subscriber,n=t.counter,r=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}function DA(t){return function(e){return e.lift(new NA(t))}}var NA=function(){function t(e){_classCallCheck2(this,t),this.notifier=e}return _createClass2(t,[{key:"call",value:function(t,e){var n=new RA(t),r=Tt(n,this.notifier);return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n}}]),t}(),RA=function(t){function e(t){var n;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).seenValue=!1,n}return _inherits(e,t),_createClass2(e,[{key:"notifyNext",value:function(t,e,n,r,i){this.seenValue=!0,this.complete()}},{key:"notifyComplete",value:function(){}}]),e}(Ct),MA=function(t){return t[t.Left=0]="Left",t[t.Right=2]="Right",t}({});function LA(t,e){return!(e.position.x>=t.position.x+t.width||e.position.x+e.width<=t.position.x||e.position.y>=t.position.y+t.height||e.position.y+e.height<=t.position.y)}var BA=function(){function t(e,n,r){_classCallCheck2(this,t),this.cdr=e,this.httpClient=n,this.firestoreService=r,this.map=[],this.objects=[],this.leftMouseButtonPressed=!1,this.rightMouseButtonPressed=!1,this.minWidth=1,this.minHeight=1,this.movement={x:0,y:0},this.movementXAccumulator=0,this.movementYAccumulator=0,this.enemies=[],this.onDestroySubject$=new vt,this.exit=new mo}return _createClass2(t,[{key:"onResize",value:function(){return!1}},{key:"ngOnInit",value:function(){var t=this;this.loadLevelList(),OA(15e3).pipe(DA(this.onDestroySubject$)).subscribe((function(){t.levelNameSave&&t.saveFirebase()}))}},{key:"loadLevelList",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.firestoreService.levels();case 2:this.levelList=t.sent;case 3:case"end":return t.stop()}}),t,this)})))}},{key:"selected",value:function(t){this.currentBlock=t,this.cdr.detectChanges()}},{key:"onObject",value:function(t){var e=this.objects.findIndex((function(e){return e.type===t.type}));-1===e?this.objects.push(t):this.objects[e]=t}},{key:"mousemove",value:function(t){var e=function(t,e){var n=t.clientX,r=t.clientY,i=e.getBoundingClientRect();return{x:n-i.x,y:r-i.y}}(t,this.mapElement.nativeElement),n=e.x,r=e.y;this.currentBlock=Object.assign({},this.currentBlock,{position:{x:Math.floor(n/this.currentBlock.width)*this.currentBlock.width-this.movement.x,y:Math.floor(r/this.currentBlock.height)*this.currentBlock.height-this.movement.y}}),this.leftMouseButtonPressed&&this.addOrRemoveBlock(),this.rightMouseButtonPressed&&(this.movementXAccumulator+=t.movementX,this.movementYAccumulator+=t.movementY,this.movement.x=Math.floor(this.movementXAccumulator/this.currentBlock.width)*this.currentBlock.width,this.movement.y=Math.floor(this.movementYAccumulator/this.currentBlock.height)*this.currentBlock.height)}},{key:"mousedown",value:function(t){t.button===MA.Left&&(this.leftMouseButtonPressed=!0,this.addOrRemoveBlock()),t.button===MA.Right&&(this.rightMouseButtonPressed=!0)}},{key:"contextmenu",value:function(){return!1}},{key:"mouseup",value:function(){this.leftMouseButtonPressed=!1,this.rightMouseButtonPressed=!1,this.lastAddedBlock=void 0}},{key:"addOrRemoveBlock",value:function(){var t=this;if(this.currentBlock.type!==Th.Delete){var e=!1;if(this.map.reduce((function(n,r,i){var o=LA(r,t.currentBlock);return o&&r===t.lastAddedBlock&&(e=!0),o&&r!==t.lastAddedBlock&&n.push(i),n}),[]).reverse().forEach((function(e){t.map.splice(e,1)})),!e){var n=Object.assign({},this.currentBlock);this.lastAddedBlock=n,this.map.push(n)}}else{var r=this.map.findIndex((function(e){return LA(e,t.currentBlock)}));r>-1&&this.map.splice(r,1)}}},{key:"mouseleave",value:function(){this.leftMouseButtonPressed=!1}},{key:"loadMap",value:function(t){var e=this,n=t.target,r=n.files[0],i=new FileReader;i.onload=function(){var t=JSON.parse(i.result);n.value="",e.map=t.map},i.readAsText(r)}},{key:"loadFirebase",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.firestoreService.level(t);case 2:n=e.sent,this.levelNameSave=t,this.map=_toConsumableArray(n.map),this.movementXAccumulator=n.movement.x,this.movementYAccumulator=n.movement.y,this.movement=n.movement,this.enemies=[].concat(_toConsumableArray(this.enemies),_toConsumableArray(n.enemies));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"save",value:function(){var t,e,n=new File([JSON.stringify({objects:this.objects.reduce(FA,[]),map:this.map},null,2)],"map.json",{type:"text/plain"});t=URL.createObjectURL(n),(e=document.createElement("a")).href=t,e.download="map.json",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},{key:"saveFirebase",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.firestoreService.updateLevel(this.levelNameSave,{objects:this.objects.reduce(FA,[]),map:this.map,movement:this.movement,enemies:this.enemies});case 2:return t.next=4,this.loadLevelList();case 4:case"end":return t.stop()}}),t,this)})))}},{key:"menuButtonClick",value:function(){this.exit.emit()}}]),t}();function FA(t,e){return t.find((function(t){return t.type===e.type}))?t:[].concat(_toConsumableArray(t),[e])}function UA(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[e.length-1];return yt(r)?(e.pop(),It(e,r)):Lt(e)}function VA(t,e){return function(n){return n.lift(new jA(t,e))}}var jA=function(){function t(e,n){_classCallCheck2(this,t),this.predicate=e,this.thisArg=n}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new qA(t,this.predicate,this.thisArg))}}]),t}(),qA=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).predicate=n,i.thisArg=r,i.count=0,i}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}]),e}(it),GA=function t(){_classCallCheck2(this,t)},zA=function t(){_classCallCheck2(this,t)},HA=function(){function t(e){var n=this;_classCallCheck2(this,t),this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?function(){n.headers=new Map,e.split("\n").forEach((function(t){var e=t.indexOf(":");if(e>0){var r=t.slice(0,e),i=r.toLowerCase(),o=t.slice(e+1).trim();n.maybeSetNormalizedName(r,i),n.headers.has(i)?n.headers.get(i).push(o):n.headers.set(i,[o])}}))}:function(){n.headers=new Map,Object.keys(e).forEach((function(t){var r=e[t],i=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(n.headers.set(i,r),n.maybeSetNormalizedName(t,i))}))}:this.headers=new Map}return _createClass2(t,[{key:"has",value:function(t){return this.init(),this.headers.has(t.toLowerCase())}},{key:"get",value:function(t){this.init();var e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}},{key:"keys",value:function(){return this.init(),Array.from(this.normalizedNames.values())}},{key:"getAll",value:function(t){return this.init(),this.headers.get(t.toLowerCase())||null}},{key:"append",value:function(t,e){return this.clone({name:t,value:e,op:"a"})}},{key:"set",value:function(t,e){return this.clone({name:t,value:e,op:"s"})}},{key:"delete",value:function(t,e){return this.clone({name:t,value:e,op:"d"})}},{key:"maybeSetNormalizedName",value:function(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}},{key:"init",value:function(){var e=this;this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach((function(t){return e.applyUpdate(t)})),this.lazyUpdate=null))}},{key:"copyFrom",value:function(t){var e=this;t.init(),Array.from(t.headers.keys()).forEach((function(n){e.headers.set(n,t.headers.get(n)),e.normalizedNames.set(n,t.normalizedNames.get(n))}))}},{key:"clone",value:function(e){var n=new t;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}},{key:"applyUpdate",value:function(t){var e=t.name.toLowerCase();switch(t.op){case"a":case"s":var n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,e);var r=("a"===t.op?this.headers.get(e):void 0)||[];r.push.apply(r,_toConsumableArray(n)),this.headers.set(e,r);break;case"d":var i=t.value;if(i){var o=this.headers.get(e);if(!o)return;0===(o=o.filter((function(t){return-1===i.indexOf(t)}))).length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,o)}else this.headers.delete(e),this.normalizedNames.delete(e)}}},{key:"forEach",value:function(t){var e=this;this.init(),Array.from(this.normalizedNames.keys()).forEach((function(n){return t(e.normalizedNames.get(n),e.headers.get(n))}))}}]),t}(),WA=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"encodeKey",value:function(t){return KA(t)}},{key:"encodeValue",value:function(t){return KA(t)}},{key:"decodeKey",value:function(t){return decodeURIComponent(t)}},{key:"decodeValue",value:function(t){return decodeURIComponent(t)}}]),t}();function KA(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var XA=function(){function t(){var e,n,r,i=this,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck2(this,t),this.updates=null,this.cloneFrom=null,this.encoder=o.encoder||new WA,o.fromString){if(o.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=(e=o.fromString,n=this.encoder,r=new Map,e.length>0&&e.split("&").forEach((function(t){var e=t.indexOf("="),i=_slicedToArray(-1==e?[n.decodeKey(t),""]:[n.decodeKey(t.slice(0,e)),n.decodeValue(t.slice(e+1))],2),o=i[0],a=i[1],s=r.get(o)||[];s.push(a),r.set(o,s)})),r)}else o.fromObject?(this.map=new Map,Object.keys(o.fromObject).forEach((function(t){var e=o.fromObject[t];i.map.set(t,Array.isArray(e)?e:[e])}))):this.map=null}return _createClass2(t,[{key:"has",value:function(t){return this.init(),this.map.has(t)}},{key:"get",value:function(t){this.init();var e=this.map.get(t);return e?e[0]:null}},{key:"getAll",value:function(t){return this.init(),this.map.get(t)||null}},{key:"keys",value:function(){return this.init(),Array.from(this.map.keys())}},{key:"append",value:function(t,e){return this.clone({param:t,value:e,op:"a"})}},{key:"set",value:function(t,e){return this.clone({param:t,value:e,op:"s"})}},{key:"delete",value:function(t,e){return this.clone({param:t,value:e,op:"d"})}},{key:"toString",value:function(){var t=this;return this.init(),this.keys().map((function(e){var n=t.encoder.encodeKey(e);return t.map.get(e).map((function(e){return n+"="+t.encoder.encodeValue(e)})).join("&")})).join("&")}},{key:"clone",value:function(e){var n=new t({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat([e]),n}},{key:"init",value:function(){var t=this;null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach((function(e){return t.map.set(e,t.cloneFrom.map.get(e))})),this.updates.forEach((function(e){switch(e.op){case"a":case"s":var n=("a"===e.op?t.map.get(e.param):void 0)||[];n.push(e.value),t.map.set(e.param,n);break;case"d":if(void 0===e.value){t.map.delete(e.param);break}var r=t.map.get(e.param)||[],i=r.indexOf(e.value);-1!==i&&r.splice(i,1),r.length>0?t.map.set(e.param,r):t.map.delete(e.param)}})),this.cloneFrom=this.updates=null)}}]),t}();function YA(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function QA(t){return"undefined"!=typeof Blob&&t instanceof Blob}function JA(t){return"undefined"!=typeof FormData&&t instanceof FormData}var ZA=function(){function t(e,n,r,i){var o;if(_classCallCheck2(this,t),this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||i?(this.body=void 0!==r?r:null,o=i):o=r,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.params&&(this.params=o.params)),this.headers||(this.headers=new HA),this.params){var a=this.params.toString();if(0===a.length)this.urlWithParams=n;else{var s=n.indexOf("?");this.urlWithParams=n+(-1===s?"?":s<n.length-1?"&":"")+a}}else this.params=new XA,this.urlWithParams=n}return _createClass2(t,[{key:"serializeBody",value:function(){return null===this.body?null:YA(this.body)||QA(this.body)||JA(this.body)||"string"==typeof this.body?this.body:this.body instanceof XA?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}},{key:"detectContentTypeHeader",value:function(){return null===this.body?null:JA(this.body)?null:QA(this.body)?this.body.type||null:YA(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof XA?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,o=void 0!==e.body?e.body:this.body,a=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,s=void 0!==e.reportProgress?e.reportProgress:this.reportProgress,u=e.headers||this.headers,c=e.params||this.params;return void 0!==e.setHeaders&&(u=Object.keys(e.setHeaders).reduce((function(t,n){return t.set(n,e.setHeaders[n])}),u)),e.setParams&&(c=Object.keys(e.setParams).reduce((function(t,n){return t.set(n,e.setParams[n])}),c)),new t(n,r,o,{params:c,headers:u,reportProgress:s,responseType:i,withCredentials:a})}}]),t}(),$A=function(){var t={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return t[t.Sent]="Sent",t[t.UploadProgress]="UploadProgress",t[t.ResponseHeader]="ResponseHeader",t[t.DownloadProgress]="DownloadProgress",t[t.Response]="Response",t[t.User]="User",t}(),tI=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";_classCallCheck2(this,t),this.headers=e.headers||new HA,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300},eI=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,n))).type=$A.ResponseHeader,t}return _inherits(e,t),_createClass2(e,[{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}]),e}(tI),nI=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,n))).type=$A.Response,t.body=void 0!==n.body?n.body:null,t}return _inherits(e,t),_createClass2(e,[{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}]),e}(tI),rI=function(t){function e(t){var n;return _classCallCheck2(this,e),(n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,0,"Unknown Error"))).name="HttpErrorResponse",n.ok=!1,n.message=n.status>=200&&n.status<300?"Http failure during parsing for ".concat(t.url||"(unknown url)"):"Http failure response for ".concat(t.url||"(unknown url)",": ").concat(t.status," ").concat(t.statusText),n.error=t.error||null,n}return _inherits(e,t),e}(tI);function iI(t,e){return{body:e,headers:t.headers,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}var oI=function(){function t(e){_classCallCheck2(this,t),this.handler=e}return _createClass2(t,[{key:"request",value:function(t,e){var n,r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t instanceof ZA)n=t;else{var o=void 0;o=i.headers instanceof HA?i.headers:new HA(i.headers);var a=void 0;i.params&&(a=i.params instanceof XA?i.params:new XA({fromObject:i.params})),n=new ZA(t,e,void 0!==i.body?i.body:null,{headers:o,params:a,reportProgress:i.reportProgress,responseType:i.responseType||"json",withCredentials:i.withCredentials})}var s=UA(n).pipe(Pt((function(t){return r.handler.handle(t)}),void 0,1));if(t instanceof ZA||"events"===i.observe)return s;var u=s.pipe(VA((function(t){return t instanceof nI})));switch(i.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return u.pipe(kt((function(t){if(null!==t.body&&!(t.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return t.body})));case"blob":return u.pipe(kt((function(t){if(null!==t.body&&!(t.body instanceof Blob))throw new Error("Response is not a Blob.");return t.body})));case"text":return u.pipe(kt((function(t){if(null!==t.body&&"string"!=typeof t.body)throw new Error("Response is not a string.");return t.body})));case"json":default:return u.pipe(kt((function(t){return t.body})))}case"response":return u;default:throw new Error("Unreachable: unhandled observe type ".concat(i.observe,"}"))}}},{key:"delete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",t,e)}},{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",t,e)}},{key:"head",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("HEAD",t,e)}},{key:"jsonp",value:function(t,e){return this.request("JSONP",t,{params:(new XA).append(e,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}},{key:"options",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("OPTIONS",t,e)}},{key:"patch",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PATCH",t,iI(n,e))}},{key:"post",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",t,iI(n,e))}},{key:"put",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",t,iI(n,e))}}]),t}(),aI=function(){function t(e,n){_classCallCheck2(this,t),this.next=e,this.interceptor=n}return _createClass2(t,[{key:"handle",value:function(t){return this.interceptor.intercept(t,this.next)}}]),t}(),sI=new de("HTTP_INTERCEPTORS"),uI=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"intercept",value:function(t,e){return e.handle(t)}}]),t}(),cI=/^\)\]\}',?\n/,lI=function t(){_classCallCheck2(this,t)},hI=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,[{key:"build",value:function(){return new XMLHttpRequest}}]),t}(),fI=function(){function t(e){_classCallCheck2(this,t),this.xhrFactory=e}return _createClass2(t,[{key:"handle",value:function(t){var e=this;if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without JsonpClientModule installed.");return new ct((function(n){var r=e.xhrFactory.build();if(r.open(t.method,t.urlWithParams),t.withCredentials&&(r.withCredentials=!0),t.headers.forEach((function(t,e){return r.setRequestHeader(t,e.join(","))})),t.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){var i=t.detectContentTypeHeader();null!==i&&r.setRequestHeader("Content-Type",i)}if(t.responseType){var o=t.responseType.toLowerCase();r.responseType="json"!==o?o:"text"}var a=t.serializeBody(),s=null,u=function(){if(null!==s)return s;var e=1223===r.status?204:r.status,n=r.statusText||"OK",i=new HA(r.getAllResponseHeaders()),o=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(r)||t.url;return s=new eI({headers:i,status:e,statusText:n,url:o})},c=function(){var e=u(),i=e.headers,o=e.status,a=e.statusText,s=e.url,c=null;204!==o&&(c=void 0===r.response?r.responseText:r.response),0===o&&(o=c?200:0);var l=o>=200&&o<300;if("json"===t.responseType&&"string"==typeof c){var h=c;c=c.replace(cI,"");try{c=""!==c?JSON.parse(c):null}catch(f){c=h,l&&(l=!1,c={error:f,text:c})}}l?(n.next(new nI({body:c,headers:i,status:o,statusText:a,url:s||void 0})),n.complete()):n.error(new rI({error:c,headers:i,status:o,statusText:a,url:s||void 0}))},l=function(t){var e=u().url,i=new rI({error:t,status:r.status||0,statusText:r.statusText||"Unknown Error",url:e||void 0});n.error(i)},h=!1,f=function(e){h||(n.next(u()),h=!0);var i={type:$A.DownloadProgress,loaded:e.loaded};e.lengthComputable&&(i.total=e.total),"text"===t.responseType&&r.responseText&&(i.partialText=r.responseText),n.next(i)},d=function(t){var e={type:$A.UploadProgress,loaded:t.loaded};t.lengthComputable&&(e.total=t.total),n.next(e)};return r.addEventListener("load",c),r.addEventListener("error",l),t.reportProgress&&(r.addEventListener("progress",f),null!==a&&r.upload&&r.upload.addEventListener("progress",d)),r.send(a),n.next({type:$A.Sent}),function(){r.removeEventListener("error",l),r.removeEventListener("load",c),t.reportProgress&&(r.removeEventListener("progress",f),null!==a&&r.upload&&r.upload.removeEventListener("progress",d)),r.abort()}}))}}]),t}(),dI=new de("XSRF_COOKIE_NAME"),pI=new de("XSRF_HEADER_NAME"),vI=function t(){_classCallCheck2(this,t)},mI=function(){function t(e,n,r){_classCallCheck2(this,t),this.doc=e,this.platform=n,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}return _createClass2(t,[{key:"getToken",value:function(){if("server"===this.platform)return null;var t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=Fl(t,this.cookieName),this.lastCookieString=t),this.lastToken}}]),t}(),yI=function(){function t(e,n){_classCallCheck2(this,t),this.tokenService=e,this.headerName=n}return _createClass2(t,[{key:"intercept",value:function(t,e){var n=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||n.startsWith("http://")||n.startsWith("https://"))return e.handle(t);var r=this.tokenService.getToken();return null===r||t.headers.has(this.headerName)||(t=t.clone({headers:t.headers.set(this.headerName,r)})),e.handle(t)}}]),t}(),gI=function(){function t(e,n){_classCallCheck2(this,t),this.backend=e,this.injector=n,this.chain=null}return _createClass2(t,[{key:"handle",value:function(t){if(null===this.chain){var e=this.injector.get(sI,[]);this.chain=e.reduceRight((function(t,e){return new aI(t,e)}),this.backend)}return this.chain.handle(t)}}]),t}(),bI=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,null,[{key:"disable",value:function(){return{ngModule:t,providers:[{provide:yI,useClass:uI}]}}},{key:"withOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ngModule:t,providers:[e.cookieName?{provide:dI,useValue:e.cookieName}:[],e.headerName?{provide:pI,useValue:e.headerName}:[]]}}}]),t}(),_I=function t(){_classCallCheck2(this,t)},wI=Lr({encapsulation:0,styles:[[".map[_ngcontent-%COMP%]{background-color:#000;cursor:none;position:absolute;width:100%;height:100%;overflow:hidden;left:0;top:0}.map[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute}.map[_ngcontent-%COMP%]   .cursor[_ngcontent-%COMP%]{z-index:3;border:1px dotted #00f}.objects[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:10px}.save-load-map[_ngcontent-%COMP%]{position:absolute;right:0;top:0;z-index:2;background-color:gray}"]],data:{}});function EI(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[["class","levels"]],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.loadFirebase(t.context.$implicit)&&r),r}),null,null)),(t()(),Ua(2,null,["",""]))],null,(function(t,e){t(e,2,0,e.context.$implicit)}))}function xI(t){return qa(0,[(t()(),Sa(0,0,null,null,9,"div",[],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"span",[],null,null,null,null,null)),(t()(),Ua(2,null,["",""])),(t()(),Sa(3,0,null,null,6,"input",[["type","number"]],[[8,"value",0],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"],[null,"change"]],(function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Di(t,4)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Di(t,4).onTouched()&&r),"compositionstart"===e&&(r=!1!==Di(t,4)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Di(t,4)._compositionEnd(n.target.value)&&r),"change"===e&&(r=!1!==Di(t,5).onChange(n.target.value)&&r),"input"===e&&(r=!1!==Di(t,5).onChange(n.target.value)&&r),"blur"===e&&(r=!1!==Di(t,5).onTouched()&&r),"ngModelChange"===e&&(r=!1!==(i.enemies[t.context.$implicit.key]=n)&&r),r}),null,null)),Hi(4,16384,null,0,MC,[Qn,Wn,[2,RC]],null,null),Hi(5,16384,null,0,YC,[Qn,Wn],null,null),Ki(1024,null,NC,(function(t,e){return[t,e]}),[MC,YC]),Hi(7,671744,null,0,Ek,[[8,null],[8,null],[8,null],[6,NC]],{model:[0,"model"]},{update:"ngModelChange"}),Ki(2048,null,UC,null,[Ek]),Hi(9,16384,null,0,VC,[[4,UC]],null,null)],(function(t,e){t(e,7,0,e.component.enemies[e.context.$implicit.key])}),(function(t,e){t(e,2,0,e.context.$implicit.key),t(e,3,0,ci(1,"",e.context.$implicit.value,""),Di(e,9).ngClassUntouched,Di(e,9).ngClassTouched,Di(e,9).ngClassPristine,Di(e,9).ngClassDirty,Di(e,9).ngClassValid,Di(e,9).ngClassInvalid,Di(e,9).ngClassPending)}))}function TI(t){return qa(0,[(t()(),Sa(0,0,null,null,5,"div",[["class","cursor"]],null,null,null,null,null)),Ki(512,null,Ul,Vl,[lr,hr,Wn,Qn]),Hi(2,278528,null,0,jl,[Ul],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),Ki(512,null,Xl,Yl,[Wn,hr,Qn]),Hi(4,278528,null,0,Ql,[Xl],{ngStyle:[0,"ngStyle"]},null),Fa(5,{"top.px":0,"left.px":1})],(function(t,e){var n=e.component;t(e,2,0,"cursor",n.currentBlock.type);var r=t(e,5,0,n.currentBlock.position.y+n.movement.y,n.currentBlock.position.x+n.movement.x);t(e,4,0,r)}),null)}function CI(t){return qa(0,[(t()(),Sa(0,0,null,null,5,"div",[],null,null,null,null,null)),Ki(512,null,Ul,Vl,[lr,hr,Wn,Qn]),Hi(2,278528,null,0,jl,[Ul],{ngClass:[0,"ngClass"]},null),Ki(512,null,Xl,Yl,[Wn,hr,Qn]),Hi(4,278528,null,0,Ql,[Xl],{ngStyle:[0,"ngStyle"]},null),Fa(5,{"top.px":0,"left.px":1})],(function(t,e){var n=e.component;t(e,2,0,e.context.$implicit.type);var r=t(e,5,0,e.context.$implicit.position.y+n.movement.y,e.context.$implicit.position.x+n.movement.x);t(e,4,0,r)}),null)}function kI(t){return qa(0,[Da(402653184,1,{mapElement:0}),(t()(),Sa(1,0,null,null,1,"app-map-objects",[["class","objects"]],null,[[null,"selected"],[null,"object"]],(function(t,e,n){var r=!0,i=t.component;return"selected"===e&&(r=!1!==i.selected(n)&&r),"object"===e&&(r=!1!==i.onObject(n)&&r),r}),Ik,Sk)),Hi(2,4243456,[["objects",4]],0,kk,[Wn],null,{selected:"selected",object:"object"}),(t()(),Sa(3,0,null,null,24,"div",[["class","save-load-map"]],null,null,null,null,null)),(t()(),Sa(4,0,null,null,0,"input",[["accept","application/json"],["name","file"],["type","file"]],null,[[null,"change"]],(function(t,e,n){var r=!0;return"change"===e&&(r=!1!==t.component.loadMap(n)&&r),r}),null,null)),(t()(),Sa(5,0,null,null,1,"label",[["for","file"]],null,null,null,null,null)),(t()(),Ua(-1,null,["Choose file"])),(t()(),Sa(7,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.save()&&r),r}),null,null)),(t()(),Ua(-1,null,["save"])),(t()(),Sa(9,0,null,null,12,"div",[],null,null,null,null,null)),(t()(),Sa(10,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Ua(-1,null,["Firebase"])),(t()(),Sa(12,0,null,null,5,"input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Di(t,13)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Di(t,13).onTouched()&&r),"compositionstart"===e&&(r=!1!==Di(t,13)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Di(t,13)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.levelNameSave=n)&&r),r}),null,null)),Hi(13,16384,null,0,MC,[Qn,Wn,[2,RC]],null,null),Ki(1024,null,NC,(function(t){return[t]}),[MC]),Hi(15,671744,null,0,Ek,[[8,null],[8,null],[8,null],[6,NC]],{model:[0,"model"]},{update:"ngModelChange"}),Ki(2048,null,UC,null,[Ek]),Hi(17,16384,null,0,VC,[[4,UC]],null,null),(t()(),Sa(18,0,null,null,1,"button",[],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.saveFirebase()&&r),r}),null,null)),(t()(),Ua(-1,null,["save"])),(t()(),ka(16777216,null,null,1,null,EI)),Hi(21,278528,null,0,Gl,[yr,vr,lr],{ngForOf:[0,"ngForOf"]},null),(t()(),Sa(22,0,null,null,0,"hr",[],null,null,null,null,null)),(t()(),Sa(23,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Ua(-1,null,["Enemies:"])),(t()(),ka(16777216,null,null,2,null,xI)),Hi(26,278528,null,0,Gl,[yr,vr,lr],{ngForOf:[0,"ngForOf"]},null),Wi(0,Zl,[hr]),(t()(),Sa(28,0,[[1,0],["mapElement",1]],null,4,"div",[["class","map"]],null,[[null,"mousemove"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var r=!0,i=t.component;return"mousemove"===e&&(r=!1!==i.mousemove(n)&&r),"mousedown"===e&&(r=!1!==i.mousedown(n)&&r),"mouseup"===e&&(r=!1!==i.mouseup()&&r),"mouseleave"===e&&(r=!1!==i.mouseleave()&&r),r}),null,null)),(t()(),ka(16777216,null,null,1,null,TI)),Hi(30,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,CI)),Hi(32,278528,null,0,Gl,[yr,vr,lr],{ngForOf:[0,"ngForOf"]},null),(t()(),Sa(33,0,null,null,0,"button",[["class","menu-icon menu-button"]],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.menuButtonClick()&&r),r}),null,null))],(function(t,e){var n=e.component;t(e,15,0,n.levelNameSave),t(e,21,0,n.levelList),t(e,26,0,Nr(e,26,0,Di(e,27).transform(n.enemies))),t(e,30,0,null==n.currentBlock?null:n.currentBlock.position),t(e,32,0,n.map)}),(function(t,e){t(e,12,0,Di(e,17).ngClassUntouched,Di(e,17).ngClassTouched,Di(e,17).ngClassPristine,Di(e,17).ngClassDirty,Di(e,17).ngClassValid,Di(e,17).ngClassInvalid,Di(e,17).ngClassPending)}))}var SI=function(){function t(e){_classCallCheck2(this,t),this.adsService=e,this.loading=!1,this.canWatchAds=!0,this.viewedRewardVideo=new mo,this.clickMenu=new mo}return _createClass2(t,[{key:"clickWatchAds",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.canWatchAds){t.next=13;break}return t.prev=1,this.loading=!0,t.t0=!0,t.next=6,this.adsService.rewardVideo();case 6:if(t.t1=t.sent,t.t2=t.t0===t.t1,!t.t2){t.next=10;break}this.viewedRewardVideo.emit();case 10:return t.prev=10,this.loading=!1,t.finish(10);case 13:case"end":return t.stop()}}),t,this,[[1,,10,13]])})))}}]),t}(),AI=Lr({encapsulation:0,styles:[["@import url(https://fonts.googleapis.com/css?family=VT323);.game-over[_ngcontent-%COMP%]{position:absolute;z-index:3;width:100vw;height:100vh;background-color:rgba(0,0,0,.7)}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]{position:relative;top:50%;left:50%;transform:translate(-50%,-50%);background-color:brown;width:70vw;height:70vh}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{height:100%}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .game-over-caption[_ngcontent-%COMP%]{height:10vh;font-size:10vh;text-align:center;font-family:VT323,monospace;line-height:10vh}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{display:flex;width:100%;height:calc(100% - 10vh)}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:50%;height:100%;position:relative}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-family:VT323,monospace;font-size:54px}*[_ngcontent-%COMP%]{outline:0}.ads-button[_ngcontent-%COMP%]{position:absolute}.menu-btn[_ngcontent-%COMP%]{border:5px dotted brown;position:relative;height:120px;width:120px;background:#000;border-radius:5px}.menu-icon[_ngcontent-%COMP%]{position:absolute}.ads-icon[_ngcontent-%COMP%]{position:absolute;background-image:url(/games/tanks/ads-heart.951c2828e0c3d4ace247.png);width:128px;height:128px;transform:scale(.5) translate(-50%,-50%)!important;transform-origin:0 0;cursor:pointer}.ads-icon.disabled[_ngcontent-%COMP%]{opacity:.5}.ads-button[_ngcontent-%COMP%], .ads-icon[_ngcontent-%COMP%], .center[_ngcontent-%COMP%], .menu-btn[_ngcontent-%COMP%], .menu-icon[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%)}"]],data:{}});function II(t){return qa(0,[(t()(),Sa(0,0,null,null,14,"div",[["class","game-over"]],null,null,null,null,null)),(t()(),Sa(1,0,null,null,13,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),Sa(2,0,null,null,2,"div",[["class","loading"]],[[8,"hidden",0]],null,null,null,null)),(t()(),Sa(3,0,null,null,1,"div",[["class","wrapper"]],null,null,null,null,null)),(t()(),Ua(-1,null,["Loading..."])),(t()(),Sa(5,0,null,null,9,"div",[["class","menu"]],[[8,"hidden",0]],null,null,null,null)),(t()(),Sa(6,0,null,null,1,"div",[["class","game-over-caption"]],null,null,null,null,null)),(t()(),Ua(-1,null,["Game Over"])),(t()(),Sa(8,0,null,null,6,"div",[["class","flex"]],null,null,null,null,null)),(t()(),Sa(9,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(10,0,null,null,1,"button",[["class","menu-btn"]],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.clickWatchAds()&&r),r}),null,null)),(t()(),Sa(11,0,null,null,0,"span",[["class","ads-icon"]],[[2,"disabled",null]],null,null,null,null)),(t()(),Sa(12,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(13,0,null,null,1,"button",[["class","menu-btn"]],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.clickMenu.emit()&&r),r}),null,null)),(t()(),Sa(14,0,null,null,0,"span",[["class","menu-icon"]],null,null,null,null,null))],null,(function(t,e){var n=e.component;t(e,2,0,!n.loading),t(e,5,0,n.loading),t(e,11,0,!n.canWatchAds)}))}var OI=function(){function t(e,n){_classCallCheck2(this,t),this.elementRef=e,this.ngZone=n,this.devicePixelRatio=window.devicePixelRatio||1,this.applicationOptions={}}return _createClass2(t,[{key:"init",value:function(){var t=this;this.ngZone.runOutsideAngular((function(){t.app=new Dw(t.applicationOptions)})),this.elementRef.nativeElement.appendChild(this.app.view),this.resize()}},{key:"ngOnInit",value:function(){this.init()}},{key:"resize",value:function(){var t=1/this.devicePixelRatio;this.app.renderer.resize(this.elementRef.nativeElement.offsetWidth*this.devicePixelRatio,this.elementRef.nativeElement.offsetHeight*this.devicePixelRatio),this.app.view.style.transform="scale(".concat(t,")"),this.app.view.style.transformOrigin="top left"}},{key:"destroy",value:function(){this.app.destroy()}},{key:"ngOnDestroy",value:function(){this.destroy()}}]),t}(),PI=Lr({encapsulation:2,styles:[],data:{}});function DI(t){return qa(0,[],null,null)}var NI=function(){function t(){_classCallCheck2(this,t),this.shot=new mo,this.move=new mo,this.pressedMoveKeys=new Set,this.pressedShot=!1}return _createClass2(t,[{key:"ngOnInit",value:function(){var t=this;this.intervalSubscription=OA(50).subscribe((function(){var e,n,r=(e=t.pressedMoveKeys,(n=Array.from(e))[n.length-1]);t.move.emit(r),t.pressedShot&&t.shot.emit()}))}},{key:"ngOnDestroy",value:function(){this.intervalSubscription.unsubscribe()}},{key:"pressShot",value:function(t){return t.preventDefault(),t.stopPropagation(),this.pressedShot=!0,!1}},{key:"releaseShot",value:function(t){return t.preventDefault(),t.stopPropagation(),this.pressedShot=!1,!1}},{key:"release",value:function(t){this.pressedMoveKeys.delete(t)}},{key:"press",value:function(t){this.pressedMoveKeys.add(t)}},{key:"touchmove",value:function(t){t.preventDefault(),t.stopPropagation();var e=t.touches.item(0),n=document.elementFromPoint(e.clientX,e.clientY);return this.moveControllers.nativeElement.contains(n)&&n.classList.contains("button")&&(this.pressedMoveKeys.clear(),this.press(n.classList.toString().replace("button","").trim())),!1}},{key:"touchend",value:function(t){return t.preventDefault(),t.stopPropagation(),this.pressedMoveKeys.clear(),!1}},{key:"handleKeyDownEvent",value:function(t){switch(t.key){case"ArrowLeft":this.press("left");break;case"ArrowRight":this.press("right");break;case"ArrowUp":this.press("up");break;case"ArrowDown":this.press("down");break;case" ":this.pressedShot=!0}}},{key:"handleKeyUpEvent",value:function(t){switch(t.key){case"ArrowLeft":this.release("left");break;case"ArrowRight":this.release("right");break;case"ArrowUp":this.release("up");break;case"ArrowDown":this.release("down");break;case" ":this.pressedShot=!1}}}]),t}(),RI=Lr({encapsulation:0,styles:[[".tank-move-controllers[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:10px;left:10px}.tank-move-controllers[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/arrow-controller.1d1c9cc0c5ca19e42365.png);width:64px;height:64px;position:relative;opacity:.7}.tank-move-controllers[_ngcontent-%COMP%]   .up[_ngcontent-%COMP%]{left:64px;top:64px}.tank-move-controllers[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{top:64px;left:128px;transform:rotate(90deg)}.tank-move-controllers[_ngcontent-%COMP%]   .down[_ngcontent-%COMP%]{top:64px;left:64px;transform:rotate(180deg)}.tank-move-controllers[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{top:-64px;transform:rotate(-90deg)}.tank-shot-controller[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:62px;right:55px}.tank-shot-controller[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/shot-controller.c287a59665cc4e5ef601.png);width:85px;height:85px;position:relative;opacity:.7}"]],data:{}});function MI(t){return qa(0,[Da(402653184,1,{moveControllers:0}),(t()(),Sa(1,0,[[1,0],["moveControllers",1]],null,4,"div",[["class","tank-move-controllers"]],null,null,null,null,null)),(t()(),Sa(2,0,null,null,0,"div",[["class","up button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchmove(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.touchend(n)&&r),"mousedown"===e&&(r=!1!==i.press("up")&&r),"mouseup"===e&&(r=!1!==i.release("up")&&r),"mouseleave"===e&&(r=!1!==i.release("up")&&r),r}),null,null)),(t()(),Sa(3,0,null,null,0,"div",[["class","right button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchmove(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.touchend(n)&&r),"mousedown"===e&&(r=!1!==i.press("right")&&r),"mouseup"===e&&(r=!1!==i.release("right")&&r),"mouseleave"===e&&(r=!1!==i.release("right")&&r),r}),null,null)),(t()(),Sa(4,0,null,null,0,"div",[["class","down button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchmove(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.touchend(n)&&r),"mousedown"===e&&(r=!1!==i.press("down")&&r),"mouseup"===e&&(r=!1!==i.release("down")&&r),"mouseleave"===e&&(r=!1!==i.release("down")&&r),r}),null,null)),(t()(),Sa(5,0,null,null,0,"div",[["class","left button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.touchmove(n)&&r),"touchmove"===e&&(r=!1!==i.touchmove(n)&&r),"touchend"===e&&(r=!1!==i.touchend(n)&&r),"mousedown"===e&&(r=!1!==i.press("left")&&r),"mouseup"===e&&(r=!1!==i.release("left")&&r),"mouseleave"===e&&(r=!1!==i.release("left")&&r),r}),null,null)),(t()(),Sa(6,0,null,null,1,"div",[["class","tank-shot-controller"]],null,null,null,null,null)),(t()(),Sa(7,0,null,null,0,"div",[["class","shot button"]],null,[[null,"touchstart"],[null,"touchend"]],(function(t,e,n){var r=!0,i=t.component;return"touchstart"===e&&(r=!1!==i.pressShot(n)&&r),"touchend"===e&&(r=!1!==i.releaseShot(n)&&r),r}),null,null))],null,null)}var LI,BI=function(t){function e(){var t;return _classCallCheck2(this,e),(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,"GameServiceDatabase"))).version(1).stores({levels:"&name"}),t.version(2).stores({levels:"&name",ais:"&name"}),t}return _inherits(e,t),e}(Wv),FI=(LI=function(){function t(e){_classCallCheck2(this,t),this.firestoreService=e,this.db=new BI,this.dbExpireTimeSeconds=21600,this.aiExpireTimeSeconds=21600}return _createClass2(t,[{key:"loadLevel",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.levels.where("name").equals(t).first();case 2:return e.next=4,this.firestoreService.level(t);case 4:return n=e.sent,this.db.levels.put({name:t,mapInfo:n,timestamp:Number(new Date)}),r=Array(10).fill(0).map((function(t,e){return{id:"enemy-".concat(e),type:gh.BasicTank,direction:"up"}})),e.abrupt("return",Object.assign({},n,{enemies:r}));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"isExpired",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.ais.where("name").equals(t).first();case 2:return n=e.sent,r=n?(Number(new Date)-n.timestamp)/1e3:0,i=!n||r>this.aiExpireTimeSeconds,e.abrupt("return",(i?console.log("".concat(t," expired.")):console.log("".concat(t," expire in ").concat(this.aiExpireTimeSeconds-r," seconds.")),i));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"loadAI",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadAIFromServer(t);case 3:return n=e.sent,e.abrupt("return",{name:n.name,ai:n.ai});case 7:if(e.prev=7,e.t0=e.catch(0),"storage/object-not-found"!==e.t0.code&&"storage/quota-exceeded"!==e.t0.code){e.next=11;break}throw e.t0;case 11:return e.abrupt("return",this.loadAI(t));case 12:case"end":return e.stop()}}),e,this,[[0,7]])})))}},{key:"loadAIFromServer",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.firestoreService.loadAI(t);case 2:return n=e.sent,e.next=5,this.db.ais.put({name:n.name,timestamp:n.timestamp});case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"updateAI",value:function(t,e){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.db.ais.where("name").equals(t).first();case 2:if(!(r=n.sent)||!r.timestamp){n.next=10;break}if(n.t0=(Number(new Date)-r.timestamp)/1e3>this.aiExpireTimeSeconds,!n.t0){n.next=8;break}return n.next=8,this.loadFromServerOrUploadToServer(t,r,e);case 8:n.next=12;break;case 10:return n.next=12,this.loadFromServerOrUploadToServer(t,r,e);case 12:case"end":return n.stop()}}),n,this)})))}},{key:"loadFromServerOrUploadToServer",value:function(t,e,n){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.firestoreService.loadAIInfo(t);case 3:if(r.t0=r.sent.timestamp,r.t1=e.timestamp,!(r.t0>r.t1)){r.next=10;break}return r.next=8,this.loadAIFromServer(t);case 8:r.next=12;break;case 10:return r.next=12,this.uploadToServer(t,e,n);case 12:r.next=20;break;case 14:if(r.prev=14,r.t2=r.catch(0),"storage/object-not-found"===r.t2.code){r.next=18;break}throw r.t2;case 18:return r.next=20,this.uploadToServer(t,e,n);case 20:case"end":return r.stop()}}),r,this,[[0,14]])})))}},{key:"uploadToServer",value:function(t,e,n){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=Object.assign({},e,{timestamp:Number(new Date)}),r.next=3,this.firestoreService.updateAI(t,n);case 3:return r.next=5,this.updateAIInfo(t,{timestamp:i.timestamp,trainingInfo:n.ai.trainingInfo});case 5:return r.next=7,this.db.ais.put(i);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"updateAIInfo",value:function(t,e){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.firestoreService.updateAIInfo(t,e));case 1:case"end":return n.stop()}}),n,this)})))}}]),t}(),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[String]),Qs.__metadata("design:returntype",Promise)],LI.prototype,"isExpired",null),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[String]),Qs.__metadata("design:returntype",Promise)],LI.prototype,"loadAI",null),Qs.__decorate([TA(),Qs.__metadata("design:type",Function),Qs.__metadata("design:paramtypes",[String,Object]),Qs.__metadata("design:returntype",Promise)],LI.prototype,"updateAI",null),LI),UI={leading:!0,trailing:!1},VI=function(){function t(e,n,r,i){_classCallCheck2(this,t),this.duration=e,this.scheduler=n,this.leading=r,this.trailing=i}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new jI(t,this.duration,this.scheduler,this.leading,this.trailing))}}]),t}(),jI=function(t){function e(t,n,r,i,o){var a;return _classCallCheck2(this,e),(a=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).duration=n,a.scheduler=r,a.leading=i,a.trailing=o,a._hasTrailingValue=!1,a._trailingValue=null,a}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(qI,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))}},{key:"_complete",value:function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}},{key:"clearThrottle",value:function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)}}]),e}(it);function qI(t){t.subscriber.clearThrottle()}var GI=function(){function t(e,n){_classCallCheck2(this,t),this.notifier=e,this.source=n}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new zI(t,this.notifier,this.source))}}]),t}(),zI=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).notifier=n,i.source=r,i}return _inherits(e,t),_createClass2(e,[{key:"error",value:function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{n=new vt;try{r=(0,this.notifier)(n)}catch(o){return _get(_getPrototypeOf(e.prototype),"error",this).call(this,o)}i=Tt(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}}},{key:"_unsubscribe",value:function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=null),e&&(e.unsubscribe(),this.retriesSubscription=null),this.retries=null}},{key:"notifyNext",value:function(t,e,n,r,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)}}]),e}(Ct),HI=new ct((function(t){return t.complete()}));function WI(t){return t?function(t){return new ct((function(e){return t.schedule((function(){return e.complete()}))}))}(t):HI}function KI(t,e){return new ct(e?function(n){return e.schedule(XI,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function XI(t){var e=t.error;t.subscriber.error(e)}var YI,QI=((YI=function(){function t(e,n,r){_classCallCheck2(this,t),this.kind=e,this.value=n,this.error=r,this.hasValue="N"===e}return _createClass2(t,[{key:"observe",value:function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}},{key:"do",value:function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}}},{key:"accept",value:function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)}},{key:"toObservable",value:function(){switch(this.kind){case"N":return UA(this.value);case"E":return KI(this.error);case"C":return WI()}throw new Error("unexpected notification kind value")}}],[{key:"createNext",value:function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}},{key:"createError",value:function(e){return new t("E",void 0,e)}},{key:"createComplete",value:function(){return t.completeNotification}}]),t}()).completeNotification=new YI("C"),YI.undefinedValueNotification=new YI("N",void 0),YI);function JI(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IA,r=(e=t)instanceof Date&&!isNaN(+e)?+t-n.now():Math.abs(t);return function(t){return t.lift(new ZI(r,n))}}var ZI=function(){function t(e,n){_classCallCheck2(this,t),this.delay=e,this.scheduler=n}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new $I(t,this.delay,this.scheduler))}}]),t}(),$I=function(t){function e(t,n,r){var i;return _classCallCheck2(this,e),(i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return _inherits(e,t),_createClass2(e,[{key:"_schedule",value:function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}},{key:"scheduleNotification",value:function(t){if(!0!==this.errored){var e=this.scheduler,n=new tO(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}}},{key:"_next",value:function(t){this.scheduleNotification(QI.createNext(t))}},{key:"_error",value:function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}},{key:"_complete",value:function(){this.scheduleNotification(QI.createComplete()),this.unsubscribe()}}],[{key:"dispatch",value:function(t){for(var e=t.source,n=e.queue,r=t.scheduler,i=t.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(t,o)}else this.unsubscribe(),e.active=!1}}]),e}(it),tO=function t(e,n){_classCallCheck2(this,t),this.time=e,this.notification=n},eO=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}();function nO(t){return function(e){return 0===t?WI():e.lift(new rO(t))}}var rO=function(){function t(e){if(_classCallCheck2(this,t),this.total=e,this.total<0)throw new eO}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new iO(t,this.total))}}]),t}(),iO=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).total=n,r.count=0,r}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))}}]),e}(it),oO=function(t,e){var n=function(t){return t.battlefieldMap.name}(e),r=t.findIndex((function(t){return t===n}));return-1===r||r+1>t.length-1?t[0]:t[r]};function aO(t,e){return{type:fh.UpdateCenter,width:t,height:e}}var sO=function(){function t(e,n){_classCallCheck2(this,t),this.gameService=e,this.ngZone=n,this.resume=!1,this.gameOver=!1,this.canWatchAds=!0,this.moveEvent=new vt,this.destroySubject=new vt,this.exit=new mo,this.devicePixelRatio=window.devicePixelRatio||1,this.levels=["level-1","level-2","level-6"],this.currentLevelIndex=0}return _createClass2(t,[{key:"ngAfterViewInit",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,LE();case 2:this.initContainer(),mT.dispatch({type:fh.SetupPIXI,container:this.container}),this.setupAXY(),this.resume?mT.dispatch(Qf()):(mT.dispatch({type:fh.NewGame}),this.loadLevel(oO(this.levels,mT.getState()))),this.storeSubscribe=this.ngZone.runOutsideAngular((function(){return mT.subscribe((function(){var t=mT.getState();e.gameOver=function(t){return t.currentGame.status===mh.Over}(t)}))})),this.moveEvent.pipe(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IA,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:UI;return function(r){return r.lift(new VI(t,e,n.leading,n.trailing))}}(50),DA(this.destroySubject)).subscribe((function(t){mT.dispatch(function(t){return{type:fh.Move,direction:t}}(t))}));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"initContainer",value:function(){this.container=new sg,this.container.sortableChildren=!0,this.pixi.app.stage.addChild(this.container)}},{key:"loadLevel",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupAXY(),mT.dispatch(function(t){return{type:fh.Loading,name:t}}(t)),e.next=3,Ot(this.gameService.loadLevel(t)).pipe((r=function(t){return t.pipe(JI(1e3),nO(1/0))},function(t){return t.lift(new GI(r,t))})).toPromise();case 3:n=e.sent,mT.dispatch(function(t,e){return{type:fh.Loaded,name:t,level:e}}(t,n));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"visibilityChangeListener",value:function(){document.hidden&&(this.stop(),this.exit.emit())}},{key:"onResize",value:function(){var t=this;this.devicePixelRatio=window.devicePixelRatio||1,setTimeout((function(){mT.dispatch(aO(t.pixi.app.renderer.width,t.pixi.app.renderer.height))}),0)}},{key:"setupAXY",value:function(){mT.dispatch(aO(this.pixi.app.renderer.width,this.pixi.app.renderer.height))}},{key:"move",value:function(t){this.moveEvent.next(t)}},{key:"shot",value:function(){mT.dispatch({type:fh.Shot})}},{key:"ngOnDestroy",value:function(){this.stop(),this.storeSubscribe(),this.container&&this.container.destroy(),this.destroySubject.next(!0),this.destroySubject.complete()}},{key:"menuButtonClick",value:function(){this.exit.emit()}},{key:"start",value:function(){mT.dispatch(Qf())}},{key:"stop",value:function(){mT.dispatch({type:fh.GameStop})}},{key:"viewedRewardVideo",value:function(){this.canWatchAds=!1,mT.dispatch({type:fh.AddLife})}}]),t}(),uO=Lr({encapsulation:0,styles:[['@import url(https://fonts.googleapis.com/css?family=VT323);.game[_ngcontent-%COMP%]{width:100%;height:100%}.game[_ngcontent-%COMP%]   app-pixi[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}.loading[_ngcontent-%COMP%]{z-index:2;background:#000;width:100vw;height:100vh;position:absolute}.loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:red;font-family:VT323,monospace;font-size:54px}.stats-bar[_ngcontent-%COMP%]{position:absolute;right:10px;top:0;z-index:1}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:32px;font-size:32px;font-family:VT323,monospace;font-weight:700;color:#fff}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]::before{content:"";height:32px;display:block;width:32px;line-height:32px;background-position:center center;float:left}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-left:5px;float:left;line-height:32px}.stats-bar[_ngcontent-%COMP%]   .lives[_ngcontent-%COMP%]::before{background:url(/games/tanks/heart.8693ae5b957ee03faac9.png)}.stats-bar[_ngcontent-%COMP%]   .enemies[_ngcontent-%COMP%]::before{background:#afacb7;-webkit-mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png);mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png)}']],data:{}});function cO(t){return qa(0,[(t()(),Sa(0,0,null,null,1,"app-game-over",[],null,[[null,"viewedRewardVideo"],[null,"clickMenu"]],(function(t,e,n){var r=!0,i=t.component;return"viewedRewardVideo"===e&&(r=!1!==i.viewedRewardVideo()&&r),"clickMenu"===e&&(r=!1!==i.menuButtonClick()&&r),r}),II,AI)),Hi(1,49152,null,0,SI,[Zs],{canWatchAds:[0,"canWatchAds"]},{viewedRewardVideo:"viewedRewardVideo",clickMenu:"clickMenu"})],(function(t,e){t(e,1,0,e.component.canWatchAds)}),null)}function lO(t){return qa(0,[Da(402653184,1,{pixi:0}),(t()(),ka(16777216,null,null,1,null,cO)),Hi(2,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),Sa(3,0,null,null,0,"div",[["class","stats-bar"]],null,null,null,null,null)),(t()(),Sa(4,0,null,null,5,"div",[["class","game"]],null,null,null,null,null)),(t()(),Sa(5,0,null,null,1,"app-pixi",[],null,[["window","resize"]],(function(t,e,n){var r=!0;return"window:resize"===e&&(r=!1!==Di(t,6).resize()&&r),r}),DI,PI)),Hi(6,245760,[[1,4],["pixi",4]],0,OI,[Wn,Wo],{devicePixelRatio:[0,"devicePixelRatio"]},null),(t()(),Sa(7,0,null,null,1,"app-game-controllers",[],null,[[null,"move"],[null,"shot"],["document","keydown"],["document","keyup"]],(function(t,e,n){var r=!0,i=t.component;return"document:keydown"===e&&(r=!1!==Di(t,8).handleKeyDownEvent(n)&&r),"document:keyup"===e&&(r=!1!==Di(t,8).handleKeyUpEvent(n)&&r),"move"===e&&(r=!1!==i.move(n)&&r),"shot"===e&&(r=!1!==i.shot()&&r),r}),MI,RI)),Hi(8,245760,null,0,NI,[],null,{shot:"shot",move:"move"}),(t()(),Sa(9,0,null,null,0,"button",[["class","menu-icon menu-button"]],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.menuButtonClick()&&r),r}),null,null))],(function(t,e){var n=e.component;t(e,2,0,n.gameOver),t(e,6,0,n.devicePixelRatio),t(e,8,0)}),null)}var hO=function(){function t(e){_classCallCheck2(this,t),this.firestore=e,this.exit=new mo,this.transferInProgress=!1}return _createClass2(t,[{key:"ngOnInit",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.firestore.aiList();case 2:this.aiList=t.sent;case 3:case"end":return t.stop()}}),t,this)})))}},{key:"transfer",value:function(){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.transferInProgress){t.next=2;break}return t.abrupt("return");case 2:return this.transferInProgress=!0,e=this.fromAIId,n=this.toAIId,t.next=7,this.firestore.loadAI(e);case 7:return r=t.sent,t.next=10,this.firestore.updateAI(n,r);case 10:this.transferInProgress=!1,this.ngOnInit();case 12:case"end":return t.stop()}}),t,this)})))}},{key:"changeTrained",value:function(t){return Qs.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),n=this.firestore,t.ai.data.trainingInfo.trained=!t.ai.data.trainingInfo.trained,e.next=5,n.updateAI(t.ai.id+"-info",t.ai.data);case 5:return e.next=7,n.updateAIInfo(t.ai.id,t.ai.data);case 7:this.ngOnInit();case 8:case"end":return e.stop()}}),e,this)})))}}]),t}(),fO=Lr({encapsulation:0,styles:[[".main-container[_ngcontent-%COMP%]{padding-top:50px}"]],data:{}});function dO(t){return qa(0,[(t()(),Sa(0,0,null,null,7,"div",[],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==(t.component.fromAIId=t.context.$implicit.name)&&r),r}),null,null)),(t()(),Sa(1,0,null,null,1,"p",[],null,null,null,null,null)),(t()(),Ua(2,null,["",""])),(t()(),Ua(-1,null,[" trained: "])),(t()(),Sa(4,0,null,null,0,"input",[["type","checkbox"]],[[8,"checked",0]],[[null,"change"]],(function(t,e,n){var r=!0;return"change"===e&&(r=!1!==t.component.changeTrained(t.context.$implicit)&&r),r}),null,null)),(t()(),Sa(5,0,null,null,2,"pre",[],null,null,null,null,null)),(t()(),Ua(6,null,["",""])),Wi(0,Jl,[])],null,(function(t,e){t(e,2,0,e.context.$implicit.name),t(e,4,0,e.context.$implicit.info.trainingInfo.trained),t(e,6,0,Nr(e,6,0,Di(e,7).transform(e.context.$implicit.info)))}))}function pO(t){return qa(0,[(t()(),Sa(0,0,null,null,0,"button",[["class","menu-icon menu-button"]],null,[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.exit.emit()&&r),r}),null,null)),(t()(),Sa(1,0,null,null,29,"div",[["class","main-container"]],null,null,null,null,null)),(t()(),Sa(2,0,null,null,25,"div",[],null,null,null,null,null)),(t()(),Ua(-1,null,[" from: "])),(t()(),Sa(4,0,null,null,5,"input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Di(t,5)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Di(t,5).onTouched()&&r),"compositionstart"===e&&(r=!1!==Di(t,5)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Di(t,5)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.fromAIId=n)&&r),r}),null,null)),Hi(5,16384,null,0,MC,[Qn,Wn,[2,RC]],null,null),Ki(1024,null,NC,(function(t){return[t]}),[MC]),Hi(7,671744,null,0,Ek,[[8,null],[8,null],[8,null],[6,NC]],{model:[0,"model"]},{update:"ngModelChange"}),Ki(2048,null,UC,null,[Ek]),Hi(9,16384,null,0,VC,[[4,UC]],null,null),(t()(),Sa(10,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),Ua(-1,null,[" to: "])),(t()(),Sa(12,0,null,null,5,"input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Di(t,13)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Di(t,13).onTouched()&&r),"compositionstart"===e&&(r=!1!==Di(t,13)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Di(t,13)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.toAIId=n)&&r),r}),null,null)),Hi(13,16384,null,0,MC,[Qn,Wn,[2,RC]],null,null),Ki(1024,null,NC,(function(t){return[t]}),[MC]),Hi(15,671744,null,0,Ek,[[8,null],[8,null],[8,null],[6,NC]],{model:[0,"model"]},{update:"ngModelChange"}),Ki(2048,null,UC,null,[Ek]),Hi(17,16384,null,0,VC,[[4,UC]],null,null),(t()(),Sa(18,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),Ua(-1,null,[" chunkLength: "])),(t()(),Sa(20,0,null,null,5,"input",[["type","tel"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"input"],[null,"blur"],[null,"compositionstart"],[null,"compositionend"]],(function(t,e,n){var r=!0,i=t.component;return"input"===e&&(r=!1!==Di(t,21)._handleInput(n.target.value)&&r),"blur"===e&&(r=!1!==Di(t,21).onTouched()&&r),"compositionstart"===e&&(r=!1!==Di(t,21)._compositionStart()&&r),"compositionend"===e&&(r=!1!==Di(t,21)._compositionEnd(n.target.value)&&r),"ngModelChange"===e&&(r=!1!==(i.chunkLength=n)&&r),r}),null,null)),Hi(21,16384,null,0,MC,[Qn,Wn,[2,RC]],null,null),Ki(1024,null,NC,(function(t){return[t]}),[MC]),Hi(23,671744,null,0,Ek,[[8,null],[8,null],[8,null],[6,NC]],{model:[0,"model"]},{update:"ngModelChange"}),Ki(2048,null,UC,null,[Ek]),Hi(25,16384,null,0,VC,[[4,UC]],null,null),(t()(),Sa(26,0,null,null,0,"br",[],null,null,null,null,null)),(t()(),Sa(27,0,null,null,0,"input",[["type","submit"]],[[8,"value",0]],[[null,"click"]],(function(t,e,n){var r=!0;return"click"===e&&(r=!1!==t.component.transfer()&&r),r}),null,null)),(t()(),Sa(28,0,null,null,2,"div",[["class","list"]],null,null,null,null,null)),(t()(),ka(16777216,null,null,1,null,dO)),Hi(30,278528,null,0,Gl,[yr,vr,lr],{ngForOf:[0,"ngForOf"]},null)],(function(t,e){var n=e.component;t(e,7,0,n.fromAIId),t(e,15,0,n.toAIId),t(e,23,0,n.chunkLength),t(e,30,0,n.aiList)}),(function(t,e){var n=e.component;t(e,4,0,Di(e,9).ngClassUntouched,Di(e,9).ngClassTouched,Di(e,9).ngClassPristine,Di(e,9).ngClassDirty,Di(e,9).ngClassValid,Di(e,9).ngClassInvalid,Di(e,9).ngClassPending),t(e,12,0,Di(e,17).ngClassUntouched,Di(e,17).ngClassTouched,Di(e,17).ngClassPristine,Di(e,17).ngClassDirty,Di(e,17).ngClassValid,Di(e,17).ngClassInvalid,Di(e,17).ngClassPending),t(e,20,0,Di(e,25).ngClassUntouched,Di(e,25).ngClassTouched,Di(e,25).ngClassPristine,Di(e,25).ngClassDirty,Di(e,25).ngClassValid,Di(e,25).ngClassInvalid,Di(e,25).ngClassPending),t(e,27,0,n.transferInProgress?"transfer in progress":"transfer")}))}var vO=Lr({encapsulation:0,styles:[["p[_ngcontent-%COMP%]{font-family:Lato}.game[_ngcontent-%COMP%], .map-editor[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}.menu[_ngcontent-%COMP%]{position:absolute;z-index:2}"]],data:{}});function mO(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"app-start-menu",[],null,[[null,"open"]],(function(t,e,n){var r=!0;return"open"===e&&(r=!1!==t.component.open(n)&&r),r}),xT,bT)),Hi(2,245760,null,0,gT,[Wo],null,{open:"open"})],(function(t,e){t(e,2,0)}),null)}function yO(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"app-map-editor",[["class","map-editor"]],null,[[null,"exit"],["window","contextmenu"]],(function(t,e,n){var r=!0,i=t.component;return"window:contextmenu"===e&&(r=!1!==Di(t,2).onResize(n)&&r),"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r}),kI,wI)),Hi(2,114688,null,0,BA,[vn,oI,kA],null,{exit:"exit"})],(function(t,e){t(e,2,0)}),null)}function gO(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"app-game",[["class","game"]],null,[[null,"exit"],["document","visibilitychange"],["window","resize"]],(function(t,e,n){var r=!0,i=t.component;return"document:visibilitychange"===e&&(r=!1!==Di(t,2).visibilityChangeListener(n)&&r),"window:resize"===e&&(r=!1!==Di(t,2).onResize(n)&&r),"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r}),lO,uO)),Hi(2,4374528,null,0,sO,[FI,Wo],null,{exit:"exit"})],null,null)}function bO(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"app-game",[["class","game"]],null,[[null,"exit"],["document","visibilitychange"],["window","resize"]],(function(t,e,n){var r=!0,i=t.component;return"document:visibilitychange"===e&&(r=!1!==Di(t,2).visibilityChangeListener(n)&&r),"window:resize"===e&&(r=!1!==Di(t,2).onResize(n)&&r),"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r}),lO,uO)),Hi(2,4374528,null,0,sO,[FI,Wo],{resume:[0,"resume"]},{exit:"exit"})],(function(t,e){t(e,2,0,!0)}),null)}function _O(t){return qa(0,[(t()(),Sa(0,0,null,null,2,"div",[],null,null,null,null,null)),(t()(),Sa(1,0,null,null,1,"app-ai-transfer",[],null,[[null,"exit"]],(function(t,e,n){var r=!0,i=t.component;return"exit"===e&&(r=!1!==i.open(i.View.START_MENU)&&r),r}),pO,fO)),Hi(2,114688,null,0,hO,[kA],null,{exit:"exit"})],(function(t,e){t(e,2,0)}),null)}function wO(t){return qa(0,[(t()(),Sa(0,0,null,null,10,"div",[["class","view"]],null,null,null,null,null)),(t()(),ka(16777216,null,null,1,null,mO)),Hi(2,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,yO)),Hi(4,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,gO)),Hi(6,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,bO)),Hi(8,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null),(t()(),ka(16777216,null,null,1,null,_O)),Hi(10,16384,null,0,Hl,[yr,vr],{ngIf:[0,"ngIf"]},null)],(function(t,e){var n=e.component;t(e,2,0,n.opened===n.View.START_MENU),t(e,4,0,n.opened===n.View.MAP_EDITOR),t(e,6,0,n.opened===n.View.NEW_GAME),t(e,8,0,n.opened===n.View.RESUME_GAME),t(e,10,0,n.opened===n.View.AI_TRANSFER)}),null)}var EO=new Ei("app-root",Dl,(function(t){return qa(0,[(t()(),Sa(0,0,null,null,1,"app-root",[],null,null,null,wO,vO)),Hi(1,49152,null,0,Dl,[Zs,$s,Wn],null,null)],null,null)}),{},{},[]),xO=function(){function t(){_classCallCheck2(this,t),this._firebase=xA.initializeApp({apiKey:"AIzaSyB49JgIB7uDcnW7QvYPmHCkI_t7_VtSWIU",authDomain:"tanks-game-cb0b2.firebaseapp.com",databaseURL:"https://tanks-game-cb0b2.firebaseio.com",projectId:"tanks-game-cb0b2",storageBucket:"tanks-game-cb0b2.appspot.com",messagingSenderId:"717418892505"})}return _createClass2(t,[{key:"firebase",get:function(){return this._firebase}}]),t}();function TO(t){return new ct((function(e){var n;try{n=t()}catch(r){return void e.error(r)}return(n?Ot(n):WI()).subscribe(e)}))}function CO(t,e,n,r){return W(n)&&(r=n,n=void 0),r?CO(t,e,n).pipe(kt((function(t){return J(t)?r.apply(void 0,_toConsumableArray(t)):r(t)}))):new ct((function(r){!function t(e,n,r,i,o){var a;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(e)){var s=e;e.addEventListener(n,r,o),a=function(){return s.removeEventListener(n,r,o)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(e)){var u=e;e.on(n,r),a=function(){return u.off(n,r)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(e)){var c=e;e.addListener(n,r),a=function(){return c.removeListener(n,r)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var l=0,h=e.length;l<h;l++)t(e[l],n,r,i,o)}i.add(a)}(t,e,(function(t){r.next(arguments.length>1?Array.prototype.slice.call(arguments):t)}),r,n)}))}var kO=new ct(st);function SO(t,e){return"function"==typeof e?function(n){return n.pipe(SO((function(n,r){return Ot(t(n,r)).pipe(kt((function(t,i){return e(n,t,r,i)})))})))}:function(e){return e.lift(new AO(t))}}var AO=function(){function t(e){_classCallCheck2(this,t),this.project=e}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new IO(t,this.project))}}]),t}(),IO=function(t){function e(t,n){var r;return _classCallCheck2(this,e),(r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))).project=n,r.index=0,r}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e,t,n)}},{key:"_innerSub",value:function(t,e,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new gt(this,e,n),o=this.destination;o.add(i),this.innerSubscription=Tt(this,t,void 0,void 0,i),this.innerSubscription!==i&&o.add(this.innerSubscription)}},{key:"_complete",value:function(){var t=this.innerSubscription;t&&!t.closed||_get(_getPrototypeOf(e.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=null}},{key:"notifyComplete",value:function(t){this.destination.remove(t),this.innerSubscription=null,this.isStopped&&_get(_getPrototypeOf(e.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(t,e,n,r,i){this.destination.next(e)}}]),e}(Ct),OO=function(){function t(e,n,r){_classCallCheck2(this,t),this.nextOrObserver=e,this.error=n,this.complete=r}return _createClass2(t,[{key:"call",value:function(t,e){return e.subscribe(new PO(t,this.nextOrObserver,this.error,this.complete))}}]),t}(),PO=function(t){function e(t,n,r,i){var o;return _classCallCheck2(this,e),(o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t)))._tapNext=st,o._tapError=st,o._tapComplete=st,o._tapError=r||st,o._tapComplete=i||st,W(n)?(o._context=_assertThisInitialized(o),o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||st,o._tapError=n.error||st,o._tapComplete=n.complete||st),o}return _inherits(e,t),_createClass2(e,[{key:"_next",value:function(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}},{key:"_error",value:function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}]),e}(it),DO="Service workers are disabled or not supported by this browser",NO=function(){function t(e){if(_classCallCheck2(this,t),this.serviceWorker=e,e){var n=CO(e,"controllerchange").pipe(kt((function(){return e.controller}))),r=function(){return Mt(1)(UA.apply(void 0,arguments))}(TO((function(){return UA(e.controller)})),n);this.worker=r.pipe(VA((function(t){return!!t}))),this.registration=this.worker.pipe(SO((function(){return e.getRegistration()})));var i=CO(e,"message").pipe(kt((function(t){return t.data}))).pipe(VA((function(t){return t&&t.type}))).pipe(zt(new vt));i.connect(),this.events=i}else this.worker=this.events=this.registration=(o=DO,TO((function(){return KI(new Error(o))})));var o}return _createClass2(t,[{key:"postMessage",value:function(t,e){return this.worker.pipe(nO(1),(n=function(n){n.postMessage(Object.assign({action:t},e))},function(t){return t.lift(new OO(n,void 0,void 0))})).toPromise().then((function(){}));var n}},{key:"postMessageWithStatus",value:function(t,e,n){var r=this.waitForStatus(n),i=this.postMessage(t,e);return Promise.all([r,i]).then((function(){}))}},{key:"generateNonce",value:function(){return Math.round(1e7*Math.random())}},{key:"eventsOfType",value:function(t){return this.events.pipe(VA((function(e){return e.type===t})))}},{key:"nextEventOfType",value:function(t){return this.eventsOfType(t).pipe(nO(1))}},{key:"waitForStatus",value:function(t){return this.eventsOfType("STATUS").pipe(VA((function(e){return e.nonce===t})),nO(1),kt((function(t){if(!t.status)throw new Error(t.error)}))).toPromise()}},{key:"isEnabled",get:function(){return!!this.serviceWorker}}]),t}(),RO=function(){function t(e){if(_classCallCheck2(this,t),this.sw=e,this.subscriptionChanges=new vt,!e.isEnabled)return this.messages=kO,this.notificationClicks=kO,void(this.subscription=kO);this.messages=this.sw.eventsOfType("PUSH").pipe(kt((function(t){return t.data}))),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(kt((function(t){return t.data}))),this.pushManager=this.sw.registration.pipe(kt((function(t){return t.pushManager})));var n=this.pushManager.pipe(SO((function(t){return t.getSubscription()})));this.subscription=Bt(n,this.subscriptionChanges)}return _createClass2(t,[{key:"requestSubscription",value:function(t){var e=this;if(!this.sw.isEnabled)return Promise.reject(new Error(DO));for(var n={userVisibleOnly:!0},r=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),i=new Uint8Array(new ArrayBuffer(r.length)),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return n.applicationServerKey=i,this.pushManager.pipe(SO((function(t){return t.subscribe(n)})),nO(1)).toPromise().then((function(t){return e.subscriptionChanges.next(t),t}))}},{key:"unsubscribe",value:function(){var t=this;return this.sw.isEnabled?this.subscription.pipe(nO(1),SO((function(e){if(null===e)throw new Error("Not subscribed to push notifications.");return e.unsubscribe().then((function(e){if(!e)throw new Error("Unsubscribe failed!");t.subscriptionChanges.next(null)}))}))).toPromise():Promise.reject(new Error(DO))}},{key:"decodeBase64",value:function(t){return atob(t)}},{key:"isEnabled",get:function(){return this.sw.isEnabled}}]),t}(),MO=function(){function t(e){if(_classCallCheck2(this,t),this.sw=e,!e.isEnabled)return this.available=kO,void(this.activated=kO);this.available=this.sw.eventsOfType("UPDATE_AVAILABLE"),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED")}return _createClass2(t,[{key:"checkForUpdate",value:function(){if(!this.sw.isEnabled)return Promise.reject(new Error(DO));var t=this.sw.generateNonce();return this.sw.postMessageWithStatus("CHECK_FOR_UPDATES",{statusNonce:t},t)}},{key:"activateUpdate",value:function(){if(!this.sw.isEnabled)return Promise.reject(new Error(DO));var t=this.sw.generateNonce();return this.sw.postMessageWithStatus("ACTIVATE_UPDATE",{statusNonce:t},t)}},{key:"isEnabled",get:function(){return this.sw.isEnabled}}]),t}(),LO=function t(){_classCallCheck2(this,t)},BO=new de("NGSW_REGISTER_SCRIPT");function FO(t,e,n,r){return function(){if(ih(r)&&"serviceWorker"in navigator&&!1!==n.enabled){var i;if(navigator.serviceWorker.addEventListener("controllerchange",(function(){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})})),"function"==typeof n.registrationStrategy)i=n.registrationStrategy();else{var o=_toArray((n.registrationStrategy||"registerWhenStable").split(":")),a=o[0],s=o.slice(1);switch(a){case"registerImmediately":i=UA(null);break;case"registerWithDelay":i=UA(null).pipe(JI(+s[0]||0));break;case"registerWhenStable":i=t.get(ha).isStable.pipe(VA((function(t){return t})));break;default:throw new Error("Unknown ServiceWorker registration strategy: ".concat(n.registrationStrategy))}}i.pipe(nO(1)).subscribe((function(){return navigator.serviceWorker.register(e,{scope:n.scope}).catch((function(t){return console.error("Service worker registration failed with:",t)}))}))}}}function UO(t,e){return new NO(ih(e)&&!1!==t.enabled?navigator.serviceWorker:void 0)}var VO=function(){function t(){_classCallCheck2(this,t)}return _createClass2(t,null,[{key:"register",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{ngModule:t,providers:[{provide:BO,useValue:e},{provide:LO,useValue:n},{provide:NO,useFactory:UO,deps:[LO,Co]},{provide:bo,useFactory:FO,deps:[bn,BO,LO,Co],multi:!0}]}}}]),t}(),jO=function t(){_classCallCheck2(this,t)},qO=new Zn("8.2.3");try{"undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(rP){!1}var GO=function t(){_classCallCheck2(this,t)},zO=new Zn("8.2.3"),HO=new de("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}}),WO=function(){function t(e,n){_classCallCheck2(this,t),this._sanityChecksEnabled=e,this._hammerLoader=n,this._hasDoneGlobalChecks=!1,this._hasCheckedHammer=!1,this._document="object"==typeof document&&document?document:null,this._window="object"==typeof window&&window?window:null,this._areChecksEnabled()&&!this._hasDoneGlobalChecks&&(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}return _createClass2(t,[{key:"_areChecksEnabled",value:function(){return this._sanityChecksEnabled&&Ve()&&!this._isTestEnv()}},{key:"_isTestEnv",value:function(){var t=this._window;return t&&(t.__karma__||t.jasmine)}},{key:"_checkDoctypeIsDefined",value:function(){this._document&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}},{key:"_checkThemeIsPresent",value:function(){if(this._document&&this._document.body&&"function"==typeof getComputedStyle){var t=this._document.createElement("div");t.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(t);var e=getComputedStyle(t);e&&"none"!==e.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(t)}}},{key:"_checkCdkVersionMatch",value:function(){zO.full!==qO.full&&console.warn("The Angular Material version ("+zO.full+") does not match the Angular CDK version ("+qO.full+").\nPlease ensure the versions of these two packages exactly match.")}},{key:"_checkHammerIsAvailable",value:function(){!this._hasCheckedHammer&&this._window&&(!this._areChecksEnabled()||this._window.Hammer||this._hammerLoader||console.warn("Could not find HammerJS. Certain Angular Material components may not work correctly."),this._hasCheckedHammer=!0)}}]),t}();try{"undefined"!=typeof Intl}catch(rP){!1}var KO=function t(){_classCallCheck2(this,t)},XO=function t(){_classCallCheck2(this,t)},YO=function t(){_classCallCheck2(this,t)},QO=function t(){_classCallCheck2(this,t)},JO=function t(){_classCallCheck2(this,t)},ZO=function t(){_classCallCheck2(this,t)},$O=function t(){_classCallCheck2(this,t)},tP=function t(){_classCallCheck2(this,t)},eP=new Ks(Ys,[Dl],(function(t){return function(t){for(var e={},n=[],r=!1,i=0;i<t.length;i++){var o=t[i];o.token===yn&&!0===o.value&&(r=!0),1073741824&o.flags&&n.push(o.token),o.index=i,e[Dr(o.token)]=o}return{factory:null,providersByKey:e,providers:t,modules:n,isRoot:r}}([vi(512,qn,Gn,[[8,[EO]],[3,qn],Ce]),vi(5120,Ao,xa,[[3,Ao]]),vi(4608,Ll,Bl,[Ao,[2,Ml]]),vi(5120,uo,Ta,[Wo]),vi(4608,Bo,Bo,[]),vi(5120,wo,Eo,[]),vi(5120,lr,wa,[]),vi(5120,hr,Ea,[]),vi(4608,wC,EC,[eh]),vi(6144,ln,null,[wC]),vi(4608,pC,mC,[]),vi(5120,jT,(function(t,e,n,r,i,o,a,s){return[new fC(t,e,n),new _C(r),new yC(i,o,a,s)]}),[eh,Wo,Co,eh,eh,pC,So,[2,vC]]),vi(4608,qT,qT,[jT,Wo]),vi(135680,HT,HT,[eh]),vi(4608,ZT,ZT,[qT,HT,wo]),vi(6144,Xn,null,[ZT]),vi(6144,zT,null,[HT]),vi(4608,ta,ta,[Wo]),vi(4608,QC,QC,[]),vi(4608,vI,mI,[eh,Co,dI]),vi(4608,yI,yI,[vI,pI]),vi(5120,sI,(function(t){return[t]}),[yI]),vi(4608,hI,hI,[]),vi(6144,lI,null,[hI]),vi(4608,fI,fI,[lI]),vi(6144,zA,null,[fI]),vi(4608,GA,gI,[zA,bn]),vi(4608,oI,oI,[GA]),vi(4608,xO,xO,[]),vi(4608,kA,kA,[xO]),vi(4608,FI,FI,[kA]),vi(5120,NO,UO,[LO,Co]),vi(4608,RO,RO,[NO]),vi(4608,MO,MO,[NO]),vi(4608,Zs,Zs,[]),vi(4608,$s,$s,[]),vi(1073742336,th,th,[]),vi(1024,Be,OC,[]),vi(256,BO,"ngsw-worker.js",[]),vi(256,LO,{enabled:!0},[]),vi(1024,bo,(function(t,e,n,r,i){return[(o=t,FT("probe",VT),FT("coreTokens",Object.assign({},UT,(o||[]).reduce((function(t,e){return t[e.name]=e.token,t}),{}))),function(){return VT}),FO(e,n,r,i)];var o}),[[2,oa],bn,BO,LO,Co]),vi(512,_o,_o,[[2,bo]]),vi(131584,ha,ha,[Wo,So,bn,Be,qn,_o]),vi(1073742336,Ca,Ca,[ha]),vi(1073742336,PC,PC,[[3,PC]]),vi(1073742336,xk,xk,[]),vi(1073742336,Tk,Tk,[]),vi(1073742336,bI,bI,[]),vi(1073742336,_I,_I,[]),vi(1073742336,jO,jO,[]),vi(1073742336,WO,WO,[[2,HO],[2,vC]]),vi(1073742336,GO,GO,[]),vi(1073742336,KO,KO,[]),vi(1073742336,XO,XO,[]),vi(1073742336,YO,YO,[]),vi(1073742336,QO,QO,[]),vi(1073742336,JO,JO,[]),vi(1073742336,ZO,ZO,[]),vi(1073742336,$O,$O,[]),vi(1073742336,tP,tP,[]),vi(1073742336,VO,VO,[]),vi(1073742336,Ys,Ys,[]),vi(256,yn,!0,[]),vi(256,dI,"XSRF-TOKEN",[]),vi(256,pI,"X-XSRF-TOKEN",[])])}));function nP(){IC().bootstrapModuleFactory(eP).catch((function(t){return console.log(t)}))}n.d(e,"start",(function(){return nP})),Xs.production&&function(){if(Ue)throw new Error("Cannot enable prod mode after platform setup.");Fe=!1}(),document.addEventListener("deviceready",(function(){nP(),window.StatusBar.hide()}),!1),window.cordova||nP()},zVF4:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("mrSG"),i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw a(e)},a=function(t){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},s=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,l=(15&s)<<2|c>>6,h=63&c;u||(h=64,a||(l=64)),r.push(n[o>>2],n[(3&o)<<4|s>>4],n[l],n[h])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();r.push(o<<2|a>>4),64!==s&&(r.push(a<<4&240|s>>2),64!==u&&r.push(s<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){try{return u.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function l(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=l(t[n],e[n]));return t}var h=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d="FirebaseError",p=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=d,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,v.prototype.create),i}return r.__extends(e,t),e}(Error),v=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?m(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new p(i,s),c=0,l=Object.keys(r);c<l.length;c++){var h=l[c];"_"!==h.slice(-1)&&(h in u&&console.warn('Overwriting FirebaseError base field "'+h+'" can cause unexpected behavior.'),u[h]=r[h])}return u},t}();function m(t,e){return t.replace(y,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}var y=/\{\$([^}]+)}/g;function g(t){return JSON.parse(t)}var b=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=g(c(o[0])||""),n=g(c(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(a){}return{header:e,claims:n,data:r,signature:i}},_=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++)n[r]=4294967295&((h=n[r-3]^n[r-8]^n[r-14]^n[r-16])<<1|h>>>31);var i,o,a=this.chain_[0],s=this.chain_[1],u=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(i=c^s&(u^c),o=1518500249):(i=s^u^c,o=1859775393):r<60?(i=s&u|c&(s|u),o=2400959708):(i=s^u^c,o=3395469782);var h=(a<<5|a>>>27)+i+l+o+n[r]&4294967295;l=c,c=u,u=4294967295&(s<<30|s>>>2),s=a,a=h}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}(),w=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=E),void 0===r.error&&(r.error=E),void 0===r.complete&&(r.complete=E);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function E(){}function x(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+r+" argument "}e.CONSTANTS=i,e.Deferred=h,e.ErrorFactory=v,e.FirebaseError=p,e.Sha1=_,e.assert=o,e.assertionError=a,e.async=function(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];Promise.resolve(!0).then((function(){t.apply(void 0,n)})).catch((function(t){e&&e(t)}))}},e.base64=u,e.base64Decode=c,e.base64Encode=function(t){var e=s(t);return u.encodeByteArray(e,!0)},e.contains=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.createSubscribe=function(t,e){var n=new w(t,e);return n.subscribe.bind(n)},e.decode=b,e.deepCopy=function(t){return l(void 0,t)},e.deepExtend=l,e.errorPrefix=x,e.getUA=f,e.isAdmin=function(t){var e=b(t).claims;return"object"==typeof e&&!0===e.admin},e.isBrowser=function(){return"object"==typeof self&&self.self===self},e.isEmpty=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())},e.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}},e.isNodeSdk=function(){return!0===i.NODE_CLIENT||!0===i.NODE_ADMIN},e.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},e.isValidFormat=function(t){var e=b(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e=b(t).claims,n=Math.floor((new Date).getTime()/1e3),r=0,i=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?r=e.nbf:e.hasOwnProperty("iat")&&(r=e.iat),i=e.hasOwnProperty("exp")?e.exp:r+86400),!!n&&!!r&&!!i&&n>=r&&n<=i},e.issuedAtTime=function(t){var e=b(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},e.jsonEval=g,e.map=function(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r},e.querystring=function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach((function(t){if(t){var n=t.split("=");e[n[0]]=n[1]}})),e},e.safeGet=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},e.stringLength=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;o(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},e.stringify=function(t){return JSON.stringify(t)},e.validateArgCount=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},e.validateCallback=function(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(x(t,e,r)+"must be a valid function.")},e.validateContextObject=function(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(x(t,e,r)+"must be a valid context object.")},e.validateNamespace=function(t,e,n,r){if((!r||n)&&"string"!=typeof n)throw new Error(x(t,e,r)+"must be a valid firebase namespace.")}},zqkD:function(t,e){function n(){}t.exports=n,n.eq=function(t,e,n){return n=n||0,Math.abs(t-e)<n}}},[[0,0]]]);
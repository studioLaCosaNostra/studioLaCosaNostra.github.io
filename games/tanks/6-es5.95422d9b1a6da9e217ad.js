function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{rZCR:function(e,t,n){"use strict";n.r(t);var r=n("8Y7J"),i=function e(){_classCallCheck(this,e)},o=n("pMnS"),a=n("mrSG"),s=n("U2x6"),l=function(){function e(t){_classCallCheck(this,e),this.adsService=t,this.loading=!1,this.canWatchAds=!0,this.viewedRewardVideo=new r.m,this.clickMenu=new r.m}return _createClass(e,[{key:"clickWatchAds",value:function(){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.canWatchAds){e.next=13;break}return e.prev=1,this.loading=!0,e.t0=!0,e.next=6,this.adsService.rewardVideo();case 6:if(e.t1=e.sent,e.t2=e.t0===e.t1,!e.t2){e.next=10;break}this.viewedRewardVideo.emit();case 10:return e.prev=10,this.loading=!1,e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[1,,10,13]])})))}}]),e}(),u=r.pb({encapsulation:0,styles:[["@import url(https://fonts.googleapis.com/css?family=VT323);.game-over[_ngcontent-%COMP%]{position:absolute;z-index:3;width:100vw;height:100vh;background-color:rgba(0,0,0,.7)}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]{position:relative;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:brown;width:70vw;height:70vh}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]{height:100%}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .game-over-caption[_ngcontent-%COMP%]{height:10vh;font-size:10vh;text-align:center;font-family:VT323,monospace;line-height:10vh}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%]{display:-webkit-box;display:flex;width:100%;height:calc(100% - 10vh)}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .menu[_ngcontent-%COMP%]   .flex[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:50%;height:100%;position:relative}.game-over[_ngcontent-%COMP%] > .wrapper[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#000;font-family:VT323,monospace;font-size:54px}*[_ngcontent-%COMP%]{outline:0}.ads-button[_ngcontent-%COMP%]{position:absolute}.menu-btn[_ngcontent-%COMP%]{border:5px dotted brown;position:relative;height:120px;width:120px;background:#000;border-radius:5px}.menu-icon[_ngcontent-%COMP%]{position:absolute}.ads-icon[_ngcontent-%COMP%]{position:absolute;background-image:url(/games/tanks/ads-heart.951c2828e0c3d4ace247.png);width:128px;height:128px;-webkit-transform:scale(.5) translate(-50%,-50%)!important;transform:scale(.5) translate(-50%,-50%)!important;-webkit-transform-origin:0 0;transform-origin:0 0;cursor:pointer}.ads-icon.disabled[_ngcontent-%COMP%]{opacity:.5}.ads-button[_ngcontent-%COMP%], .ads-icon[_ngcontent-%COMP%], .center[_ngcontent-%COMP%], .menu-btn[_ngcontent-%COMP%], .menu-icon[_ngcontent-%COMP%]{top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}"]],data:{}});function c(e){return r.Fb(0,[(e()(),r.rb(0,0,null,null,14,"div",[["class","game-over"]],null,null,null,null,null)),(e()(),r.rb(1,0,null,null,13,"div",[["class","wrapper"]],null,null,null,null,null)),(e()(),r.rb(2,0,null,null,2,"div",[["class","loading"]],[[8,"hidden",0]],null,null,null,null)),(e()(),r.rb(3,0,null,null,1,"div",[["class","wrapper"]],null,null,null,null,null)),(e()(),r.Eb(-1,null,["Loading..."])),(e()(),r.rb(5,0,null,null,9,"div",[["class","menu"]],[[8,"hidden",0]],null,null,null,null)),(e()(),r.rb(6,0,null,null,1,"div",[["class","game-over-caption"]],null,null,null,null,null)),(e()(),r.Eb(-1,null,["Game Over"])),(e()(),r.rb(8,0,null,null,6,"div",[["class","flex"]],null,null,null,null,null)),(e()(),r.rb(9,0,null,null,2,"div",[],null,null,null,null,null)),(e()(),r.rb(10,0,null,null,1,"button",[["class","menu-btn"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.clickWatchAds()&&r),r}),null,null)),(e()(),r.rb(11,0,null,null,0,"span",[["class","ads-icon"]],[[2,"disabled",null]],null,null,null,null)),(e()(),r.rb(12,0,null,null,2,"div",[],null,null,null,null,null)),(e()(),r.rb(13,0,null,null,1,"button",[["class","menu-btn"]],null,[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.clickMenu.emit()&&r),r}),null,null)),(e()(),r.rb(14,0,null,null,0,"span",[["class","menu-icon"]],null,null,null,null,null))],null,(function(e,t){var n=t.component;e(t,2,0,!n.loading),e(t,5,0,n.loading),e(t,11,0,!n.canWatchAds)}))}var h=n("SVse"),p=n("IqKQ"),d=function(){function e(t,n){_classCallCheck(this,e),this.elementRef=t,this.ngZone=n,this.devicePixelRatio=window.devicePixelRatio||1,this.applicationOptions={}}return _createClass(e,[{key:"init",value:function(){var e=this;this.ngZone.runOutsideAngular((function(){e.app=new p.b(e.applicationOptions)})),this.elementRef.nativeElement.appendChild(this.app.view),this.resize()}},{key:"ngOnInit",value:function(){this.init()}},{key:"resize",value:function(){var e=1/this.devicePixelRatio;this.app.renderer.resize(this.elementRef.nativeElement.offsetWidth*this.devicePixelRatio,this.elementRef.nativeElement.offsetHeight*this.devicePixelRatio),this.app.view.style.transform="scale(".concat(e,")"),this.app.view.style.transformOrigin="top left"}},{key:"destroy",value:function(){this.app.destroy()}},{key:"ngOnDestroy",value:function(){this.destroy()}}]),e}(),f=r.pb({encapsulation:2,styles:[],data:{}});function v(e){return r.Fb(0,[],null,null)}var m=n("HDdC"),b=n("D0XW"),g=n("DH7j");function _(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}var w=function(){function e(){_classCallCheck(this,e),this.shot=new r.m,this.move=new r.m,this.pressedMoveKeys=new Set,this.pressedShot=!1}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.intervalSubscription=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.a;return e=t,(Object(g.a)(e)||!(e-parseFloat(e)+1>=0)||t<0)&&(t=0),n&&"function"==typeof n.schedule||(n=b.a),new m.a((function(e){return e.add(n.schedule(_,t,{subscriber:e,counter:0,period:t})),e}))}(50).subscribe((function(){var t,n,r=(t=e.pressedMoveKeys,(n=Array.from(t))[n.length-1]);e.move.emit(r),e.pressedShot&&e.shot.emit()}))}},{key:"ngOnDestroy",value:function(){this.intervalSubscription.unsubscribe()}},{key:"pressShot",value:function(e){return e.preventDefault(),e.stopPropagation(),this.pressedShot=!0,!1}},{key:"releaseShot",value:function(e){return e.preventDefault(),e.stopPropagation(),this.pressedShot=!1,!1}},{key:"release",value:function(e){this.pressedMoveKeys.delete(e)}},{key:"press",value:function(e){this.pressedMoveKeys.add(e)}},{key:"touchmove",value:function(e){e.preventDefault(),e.stopPropagation();var t=e.touches.item(0),n=document.elementFromPoint(t.clientX,t.clientY);return this.moveControllers.nativeElement.contains(n)&&n.classList.contains("button")&&(this.pressedMoveKeys.clear(),this.press(n.classList.toString().replace("button","").trim())),!1}},{key:"touchend",value:function(e){return e.preventDefault(),e.stopPropagation(),this.pressedMoveKeys.clear(),!1}},{key:"handleKeyDownEvent",value:function(e){switch(e.key){case"ArrowLeft":this.press("left");break;case"ArrowRight":this.press("right");break;case"ArrowUp":this.press("up");break;case"ArrowDown":this.press("down");break;case" ":this.pressedShot=!0}}},{key:"handleKeyUpEvent",value:function(e){switch(e.key){case"ArrowLeft":this.release("left");break;case"ArrowRight":this.release("right");break;case"ArrowUp":this.release("up");break;case"ArrowDown":this.release("down");break;case" ":this.pressedShot=!1}}}]),e}(),k=r.pb({encapsulation:0,styles:[[".tank-move-controllers[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:10px;left:10px}.tank-move-controllers[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/arrow-controller.1d1c9cc0c5ca19e42365.png);width:64px;height:64px;position:relative;opacity:.7}.tank-move-controllers[_ngcontent-%COMP%]   .up[_ngcontent-%COMP%]{left:64px;top:64px}.tank-move-controllers[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{top:64px;left:128px;-webkit-transform:rotate(90deg);transform:rotate(90deg)}.tank-move-controllers[_ngcontent-%COMP%]   .down[_ngcontent-%COMP%]{top:64px;left:64px;-webkit-transform:rotate(180deg);transform:rotate(180deg)}.tank-move-controllers[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{top:-64px;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.tank-shot-controller[_ngcontent-%COMP%]{z-index:1;position:absolute;bottom:62px;right:55px}.tank-shot-controller[_ngcontent-%COMP%]   .button[_ngcontent-%COMP%]{background-image:url(/games/tanks/shot-controller.c287a59665cc4e5ef601.png);width:85px;height:85px;position:relative;opacity:.7}"]],data:{}});function y(e){return r.Fb(0,[r.Cb(402653184,1,{moveControllers:0}),(e()(),r.rb(1,0,[[1,0],["moveControllers",1]],null,4,"div",[["class","tank-move-controllers"]],null,null,null,null,null)),(e()(),r.rb(2,0,null,null,0,"div",[["class","up button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(e,t,n){var r=!0,i=e.component;return"touchstart"===t&&(r=!1!==i.touchmove(n)&&r),"touchmove"===t&&(r=!1!==i.touchmove(n)&&r),"touchend"===t&&(r=!1!==i.touchend(n)&&r),"mousedown"===t&&(r=!1!==i.press("up")&&r),"mouseup"===t&&(r=!1!==i.release("up")&&r),"mouseleave"===t&&(r=!1!==i.release("up")&&r),r}),null,null)),(e()(),r.rb(3,0,null,null,0,"div",[["class","right button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(e,t,n){var r=!0,i=e.component;return"touchstart"===t&&(r=!1!==i.touchmove(n)&&r),"touchmove"===t&&(r=!1!==i.touchmove(n)&&r),"touchend"===t&&(r=!1!==i.touchend(n)&&r),"mousedown"===t&&(r=!1!==i.press("right")&&r),"mouseup"===t&&(r=!1!==i.release("right")&&r),"mouseleave"===t&&(r=!1!==i.release("right")&&r),r}),null,null)),(e()(),r.rb(4,0,null,null,0,"div",[["class","down button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(e,t,n){var r=!0,i=e.component;return"touchstart"===t&&(r=!1!==i.touchmove(n)&&r),"touchmove"===t&&(r=!1!==i.touchmove(n)&&r),"touchend"===t&&(r=!1!==i.touchend(n)&&r),"mousedown"===t&&(r=!1!==i.press("down")&&r),"mouseup"===t&&(r=!1!==i.release("down")&&r),"mouseleave"===t&&(r=!1!==i.release("down")&&r),r}),null,null)),(e()(),r.rb(5,0,null,null,0,"div",[["class","left button"]],null,[[null,"touchstart"],[null,"touchmove"],[null,"touchend"],[null,"mousedown"],[null,"mouseup"],[null,"mouseleave"]],(function(e,t,n){var r=!0,i=e.component;return"touchstart"===t&&(r=!1!==i.touchmove(n)&&r),"touchmove"===t&&(r=!1!==i.touchmove(n)&&r),"touchend"===t&&(r=!1!==i.touchend(n)&&r),"mousedown"===t&&(r=!1!==i.press("left")&&r),"mouseup"===t&&(r=!1!==i.release("left")&&r),"mouseleave"===t&&(r=!1!==i.release("left")&&r),r}),null,null)),(e()(),r.rb(6,0,null,null,1,"div",[["class","tank-shot-controller"]],null,null,null,null,null)),(e()(),r.rb(7,0,null,null,0,"div",[["class","shot button"]],null,[[null,"touchstart"],[null,"touchend"]],(function(e,t,n){var r=!0,i=e.component;return"touchstart"===t&&(r=!1!==i.pressShot(n)&&r),"touchend"===t&&(r=!1!==i.releaseShot(n)&&r),r}),null,null))],null,null)}var x=n("iInd"),C=n("ePZZ"),O=n("XNiG"),P=n("xgIS"),M=n("Cfvw"),R=n("7o/Q"),S=function(){function e(t){_classCallCheck(this,e),this.total=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new A(e,this.total))}}]),e}(),A=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).total=n,r.count=0,r}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){++this.count>this.total&&this.destination.next(e)}}]),t}(R.a),j=n("pLZG"),I=n("lJxs"),T=n("eIep"),V=n("1G5W"),E=n("l7GE"),z=n("ZUHj"),D={leading:!0,trailing:!1},F=function(){function e(t,n,r,i){_classCallCheck(this,e),this.duration=t,this.scheduler=n,this.leading=r,this.trailing=i}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new L(e,this.duration,this.scheduler,this.leading,this.trailing))}}]),e}(),L=function(e){function t(e,n,r,i,o){var a;return _classCallCheck(this,t),(a=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).duration=n,a.scheduler=r,a.leading=i,a.trailing=o,a._hasTrailingValue=!1,a._trailingValue=null,a}return _inherits(t,e),_createClass(t,[{key:"_next",value:function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(q,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))}},{key:"_complete",value:function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}},{key:"clearThrottle",value:function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)}}]),t}(R.a);function q(e){e.subscriber.clearThrottle()}var W,K=function(){function e(t,n){_classCallCheck(this,e),this.notifier=t,this.source=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new G(e,this.notifier,this.source))}}]),e}(),G=function(e){function t(e,n,r){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))).notifier=n,i.source=r,i}return _inherits(t,e),_createClass(t,[{key:"error",value:function(e){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{n=new O.a;try{r=(0,this.notifier)(n)}catch(o){return _get(_getPrototypeOf(t.prototype),"error",this).call(this,o)}i=Object(z.a)(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(e)}}},{key:"_unsubscribe",value:function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null}},{key:"notifyNext",value:function(e,t,n,r,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)}}]),t}(E.a),B=n("3E0/"),U=n("IzEk"),Z=n("qdB0"),N=n("dM4a"),X=n("haPc"),Y=n("vHjY"),H=function(e){function t(){var e;return _classCallCheck(this,t),(e=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,"GameServiceDatabase"))).version(1).stores({levels:"&name"}),e.version(2).stores({levels:"&name",ais:"&name"}),e}return _inherits(t,e),t}(N.a),J=(W=function(){function e(t){_classCallCheck(this,e),this.firestoreService=t,this.db=new H,this.dbExpireTimeSeconds=21600,this.aiExpireTimeSeconds=21600}return _createClass(e,[{key:"loadLevel",value:function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db.levels.where("name").equals(e).first();case 2:return t.next=4,this.firestoreService.level(e);case 4:return n=t.sent,this.db.levels.put({name:e,mapInfo:n,timestamp:Number(new Date)}),r=Array(10).fill(0).map((function(e,t){return{id:"enemy-".concat(t),type:Y.a.BasicTank,direction:"up"}})),t.abrupt("return",Object.assign({},n,{enemies:r}));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"isExpired",value:function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.db.ais.where("name").equals(e).first();case 2:return n=t.sent,r=n?(Number(new Date)-n.timestamp)/1e3:0,i=!n||r>this.aiExpireTimeSeconds,t.abrupt("return",(i?console.log("".concat(e," expired.")):console.log("".concat(e," expire in ").concat(this.aiExpireTimeSeconds-r," seconds.")),i));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"loadAI",value:function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.loadAIFromServer(e);case 3:return n=t.sent,t.abrupt("return",{name:n.name,ai:n.ai});case 7:if(t.prev=7,t.t0=t.catch(0),"storage/object-not-found"!==t.t0.code&&"storage/quota-exceeded"!==t.t0.code){t.next=11;break}throw t.t0;case 11:return t.abrupt("return",this.loadAI(e));case 12:case"end":return t.stop()}}),t,this,[[0,7]])})))}},{key:"loadAIFromServer",value:function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.firestoreService.loadAI(e);case 2:return n=t.sent,t.next=5,this.db.ais.put({name:n.name,timestamp:n.timestamp});case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"updateAI",value:function(e,t){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.db.ais.where("name").equals(e).first();case 2:if(!(r=n.sent)||!r.timestamp){n.next=10;break}if(n.t0=(Number(new Date)-r.timestamp)/1e3>this.aiExpireTimeSeconds,!n.t0){n.next=8;break}return n.next=8,this.loadFromServerOrUploadToServer(e,r,t);case 8:n.next=12;break;case 10:return n.next=12,this.loadFromServerOrUploadToServer(e,r,t);case 12:case"end":return n.stop()}}),n,this)})))}},{key:"loadFromServerOrUploadToServer",value:function(e,t,n){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,this.firestoreService.loadAIInfo(e);case 3:if(r.t0=r.sent.timestamp,r.t1=t.timestamp,!(r.t0>r.t1)){r.next=10;break}return r.next=8,this.loadAIFromServer(e);case 8:r.next=12;break;case 10:return r.next=12,this.uploadToServer(e,t,n);case 12:r.next=20;break;case 14:if(r.prev=14,r.t2=r.catch(0),"storage/object-not-found"===r.t2.code){r.next=18;break}throw r.t2;case 18:return r.next=20,this.uploadToServer(e,t,n);case 20:case"end":return r.stop()}}),r,this,[[0,14]])})))}},{key:"uploadToServer",value:function(e,t,n){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=Object.assign({},t,{timestamp:Number(new Date)}),r.next=3,this.firestoreService.updateAI(e,n);case 3:return r.next=5,this.updateAIInfo(e,{timestamp:i.timestamp,trainingInfo:n.ai.trainingInfo});case 5:return r.next=7,this.db.ais.put(i);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"updateAIInfo",value:function(e,t){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.firestoreService.updateAIInfo(e,t));case 1:case"end":return n.stop()}}),n,this)})))}}]),e}(),a.__decorate([Object(X.a)(),a.__metadata("design:type",Function),a.__metadata("design:paramtypes",[String]),a.__metadata("design:returntype",Promise)],W.prototype,"isExpired",null),a.__decorate([Object(X.a)(),a.__metadata("design:type",Function),a.__metadata("design:paramtypes",[String]),a.__metadata("design:returntype",Promise)],W.prototype,"loadAI",null),a.__decorate([Object(X.a)(),a.__metadata("design:type",Function),a.__metadata("design:paramtypes",[String,Object]),a.__metadata("design:returntype",Promise)],W.prototype,"updateAI",null),W),Q=n("9Chx"),$=n("wRQt"),ee=function(e,t){var n=function(e){return e.battlefieldMap.name}(t),r=e.findIndex((function(e){return e===n}));return-1===r||r+1>e.length-1?e[0]:e[r]},te=n("+cCG");function ne(e,t){return{type:C.a.UpdateCenter,width:e,height:t}}var re=function(){function e(t,n,r,i,o){_classCallCheck(this,e),this.gameService=t,this.ngZone=n,this.elRef=r,this.route=i,this.router=o,this.resume=!1,this.fullscreen=!1,this.gameOver=!1,this.canWatchAds=!0,this.moveEvent=new O.a,this.destroySubject=new O.a,this.devicePixelRatio=window.devicePixelRatio||1,this.levels=["level-1","level-2","level-6"],this.currentLevelIndex=0}return _createClass(e,[{key:"ngOnInit",value:function(){var e,t=this;this.fullscreen&&function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.requestFullscreen();case 2:return t.next=4,window.screen.orientation.lock("landscape");case 4:case"end":return t.stop()}}),t)})))}(this.elRef.nativeElement).catch((function(e){console.warn(e)})),Object(P.a)(document,"visibilitychange").pipe((e=this.fullscreen?1:0,function(t){return t.lift(new S(e))}),Object(j.a)((function(){return document.hidden})),Object(I.a)((function(){return t.stop()})),Object(T.a)((function(){return t.router.navigate([".."])})),Object(V.a)(this.destroySubject)).subscribe()}},{key:"ngAfterViewInit",value:function(){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initContainer(),e.next=3,Object($.a)();case 3:te.a.dispatch({type:C.a.SetupPIXI,container:this.container}),this.setupAXY(),this.route.data.pipe(Object(V.a)(this.destroySubject)).subscribe((function(e){return a.__awaiter(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.resume){t.next=4;break}te.a.dispatch(Object(Z.c)()),t.next=7;break;case 4:return te.a.dispatch({type:C.a.NewGame}),t.next=7,this.loadLevel(ee(this.levels,te.a.getState()));case 7:case"end":return t.stop()}}),t,this)})))})),this.storeSubscribe=this.ngZone.runOutsideAngular((function(){return te.a.subscribe((function(){var e=te.a.getState();t.gameOver=function(e){return e.currentGame.status===Q.a.Over}(e)}))})),this.moveEvent.pipe(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D;return function(r){return r.lift(new F(e,t,n.leading,n.trailing))}}(50),Object(V.a)(this.destroySubject)).subscribe((function(e){te.a.dispatch(function(e){return{type:C.a.Move,direction:e}}(e))}));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"initContainer",value:function(){this.container=new p.c,this.container.sortableChildren=!0,this.pixi.app.stage.addChild(this.container)}},{key:"loadLevel",value:function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setupAXY(),te.a.dispatch(function(e){return{type:C.a.Loading,name:e}}(e)),t.next=3,Object(M.a)(this.gameService.loadLevel(e)).pipe((r=function(e){return e.pipe(Object(B.a)(1e3),Object(U.a)(1/0))},function(e){return e.lift(new K(r,e))})).toPromise();case 3:n=t.sent,te.a.dispatch(function(e,t){return{type:C.a.Loaded,name:e,level:t}}(e,n));case 5:case"end":return t.stop()}}),t,this)})))}},{key:"onResize",value:function(){var e=this;this.devicePixelRatio=window.devicePixelRatio||1,setTimeout((function(){e.pixi.app.renderer&&te.a.dispatch(ne(e.pixi.app.renderer.width,e.pixi.app.renderer.height))}),0)}},{key:"setupAXY",value:function(){this.pixi.app.renderer&&te.a.dispatch(ne(this.pixi.app.renderer.width,this.pixi.app.renderer.height))}},{key:"move",value:function(e){this.moveEvent.next(e)}},{key:"shot",value:function(){te.a.dispatch({type:C.a.Shot})}},{key:"ngOnDestroy",value:function(){this.stop(),this.storeSubscribe&&this.storeSubscribe(),this.container&&this.container.destroy(),this.destroySubject.next(!0),this.destroySubject.complete(),this.fullscreen&&function(e){return a.__awaiter(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.exitFullscreen();case 2:case"end":return t.stop()}}),t)})))}(document).catch((function(e){console.warn(e)}))}},{key:"start",value:function(){te.a.dispatch(Object(Z.c)())}},{key:"stop",value:function(){te.a.dispatch(Object(Z.d)())}},{key:"viewedRewardVideo",value:function(){this.canWatchAds=!1,te.a.dispatch({type:C.a.AddLife})}}]),e}(),ie=r.pb({encapsulation:0,styles:[['@import url(https://fonts.googleapis.com/css?family=VT323);.game[_ngcontent-%COMP%]{width:100%;height:100%}.game[_ngcontent-%COMP%]   app-pixi[_ngcontent-%COMP%]{width:100%;height:100%;display:block;overflow:hidden}.loading[_ngcontent-%COMP%]{z-index:2;background:#000;width:100vw;height:100vh;position:absolute}.loading[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:red;font-family:VT323,monospace;font-size:54px}.stats-bar[_ngcontent-%COMP%]{position:absolute;right:10px;top:0;z-index:1}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{height:32px;font-size:32px;font-family:VT323,monospace;font-weight:700}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]::before{content:"";height:32px;display:block;width:32px;line-height:32px;background-position:center center;float:left}.stats-bar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding-left:5px;float:left;line-height:32px}.stats-bar[_ngcontent-%COMP%]   .lives[_ngcontent-%COMP%]::before{background:url(/games/tanks/heart.8693ae5b957ee03faac9.png)}.stats-bar[_ngcontent-%COMP%]   .enemies[_ngcontent-%COMP%]::before{background:#afacb7;-webkit-mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png);mask-image:url(/games/tanks/tank-icon.817db94d9be6d4a0b42b.png)}']],data:{}});function oe(e){return r.Fb(0,[(e()(),r.rb(0,0,null,null,1,"app-game-over",[],null,[[null,"viewedRewardVideo"],[null,"clickMenu"]],(function(e,t,n){var r=!0,i=e.component;return"viewedRewardVideo"===t&&(r=!1!==i.viewedRewardVideo()&&r),"clickMenu"===t&&(r=!1!==i.menuButtonClick()&&r),r}),c,u)),r.qb(1,49152,null,0,l,[s.a],{canWatchAds:[0,"canWatchAds"]},{viewedRewardVideo:"viewedRewardVideo",clickMenu:"clickMenu"})],(function(e,t){e(t,1,0,t.component.canWatchAds)}),null)}function ae(e){return r.Fb(0,[r.Cb(402653184,1,{pixi:0}),(e()(),r.gb(16777216,null,null,1,null,oe)),r.qb(2,16384,null,0,h.i,[r.N,r.K],{ngIf:[0,"ngIf"]},null),(e()(),r.rb(3,0,null,null,0,"div",[["class","stats-bar"]],null,null,null,null,null)),(e()(),r.rb(4,0,null,null,6,"div",[["class","game"]],null,null,null,null,null)),(e()(),r.rb(5,0,null,null,1,"app-pixi",[],null,[["window","resize"]],(function(e,t,n){var i=!0;return"window:resize"===t&&(i=!1!==r.Bb(e,6).resize()&&i),i}),v,f)),r.qb(6,245760,[[1,4],["pixi",4]],0,d,[r.k,r.x],{devicePixelRatio:[0,"devicePixelRatio"]},null),(e()(),r.rb(7,0,null,null,1,"app-game-controllers",[],null,[[null,"move"],[null,"shot"],["document","keydown"],["document","keyup"]],(function(e,t,n){var i=!0,o=e.component;return"document:keydown"===t&&(i=!1!==r.Bb(e,8).handleKeyDownEvent(n)&&i),"document:keyup"===t&&(i=!1!==r.Bb(e,8).handleKeyUpEvent(n)&&i),"move"===t&&(i=!1!==o.move(n)&&i),"shot"===t&&(i=!1!==o.shot()&&i),i}),y,k)),r.qb(8,245760,null,0,w,[],null,{shot:"shot",move:"move"}),(e()(),r.rb(9,0,null,null,1,"button",[["class","menu-icon menu-button"],["routerLink",""]],null,[[null,"click"]],(function(e,t,n){var i=!0;return"click"===t&&(i=!1!==r.Bb(e,10).onClick()&&i),i}),null,null)),r.qb(10,16384,null,0,x.l,[x.k,x.a,[8,null],r.C,r.k],{routerLink:[0,"routerLink"]},null)],(function(e,t){var n=t.component;e(t,2,0,n.gameOver),e(t,6,0,n.devicePixelRatio),e(t,8,0),e(t,10,0,"")}),null)}var se=r.nb("app-game",re,(function(e){return r.Fb(0,[(e()(),r.rb(0,0,null,null,1,"app-game",[],null,[["window","resize"]],(function(e,t,n){var i=!0;return"window:resize"===t&&(i=!1!==r.Bb(e,1).onResize(n)&&i),i}),ae,ie)),r.qb(1,4440064,null,0,re,[J,r.x,r.k,x.a,x.k],null,null)],(function(e,t){e(t,1,0)}),null)}),{resume:"resume",fullscreen:"fullscreen"},{},[]),le=n("ghyd"),ue={resume:!0},ce=function e(){_classCallCheck(this,e)},he=function e(){_classCallCheck(this,e)},pe=function e(){_classCallCheck(this,e)};n.d(t,"GameModuleNgFactory",(function(){return de}));var de=r.ob(i,[],(function(e){return r.zb([r.Ab(512,r.j,r.Z,[[8,[o.a,se]],[3,r.j],r.v]),r.Ab(4608,h.k,h.j,[r.s,[2,h.w]]),r.Ab(4608,J,J,[le.a]),r.Ab(1073742336,h.b,h.b,[]),r.Ab(1073742336,x.n,x.n,[[2,x.s],[2,x.k]]),r.Ab(1073742336,ce,ce,[]),r.Ab(1073742336,he,he,[]),r.Ab(1073742336,pe,pe,[]),r.Ab(1073742336,i,i,[]),r.Ab(1024,x.i,(function(){return[[{path:"",component:re},{path:"resume",component:re,data:ue}]]}),[])])}))}}]);
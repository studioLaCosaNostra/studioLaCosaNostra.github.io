<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Unfortunately, Adsense requires you to log in to the real user of your Adsense account. For this purpose, we will use the key generated from the Google Adsense Management API site and clickProgram cod"><meta name="keywords" content="typescript,node.js,adsense"><meta property="og:type" content="article"><meta property="og:title" content="How to retrieve information from Adsense about the current account balance."><meta property="og:url" content="https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/index.html"><meta property="og:site_name" content="Studio La cosa nostra blog"><meta property="og:description" content="Unfortunately, Adsense requires you to log in to the real user of your Adsense account. For this purpose, we will use the key generated from the Google Adsense Management API site and clickProgram cod"><meta property="og:locale" content="en"><meta property="og:image" content="https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/adsense-logo.jpg"><meta property="og:updated_time" content="2019-01-24T23:08:58.976Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="How to retrieve information from Adsense about the current account balance."><meta name="twitter:description" content="Unfortunately, Adsense requires you to log in to the real user of your Adsense account. For this purpose, we will use the key generated from the Google Adsense Management API site and clickProgram cod"><meta name="twitter:image" content="https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/adsense-logo.jpg"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>How to retrieve information from Adsense about the current account balance.</title><link rel="stylesheet" href="/css/style.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="/css/style.css"></noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnify/2.3.2/css/magnify.min.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnify/2.3.2/css/magnify.min.css"></noscript><link rel="stylesheet" href="/css/rtl.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="/css/rtl.css"></noscript><link rel="amphtml" href="https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/amp/index.html"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-7811559275890870",enable_page_level_ads:!0})</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-133020393-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-133020393-1")</script><meta name="google-site-verification" content="M3LE90r-9Zi3bh6WJc9u3Dv4Y4iN5uAbCLOoKKB5STg"><link rel="stylesheet" href="/css/prism.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="/css/prism.css"></noscript><link rel="stylesheet" href="/css/prism-line-numbers.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="/css/prism-line-numbers.css"></noscript><link rel="stylesheet" href="/css/prism.css" media="none" onload="if(media!='all')media='all'"><noscript><link rel="stylesheet" href="/css/prism.css"></noscript>
<link rel="stylesheet" href="/css/prism-line-numbers.css" media="none" onload="if(media!='all')media='all'"><noscript><link rel="stylesheet" href="/css/prism-line-numbers.css"></noscript></head><body class="max-width mx-auto px3 ltr"><div id="header-post"><a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fas fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/projects">Projects</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="/2019/01/25/hexo-how-to-determine-production-mode-in-theme/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class="icon" href="/2019/01/23/how-to-simulate-location-in-android-applications/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id="i-prev" class="info" style="display:none">Previous post</span> <span id="i-next" class="info" style="display:none">Next post</span> <span id="i-top" class="info" style="display:none">Back to top</span> <span id="i-share" class="info" style="display:none">Share post</span></span><br><div id="share" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&text=How to retrieve information from Adsense about the current account balance."><i class="fab fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&is_video=false&description=How to retrieve information from Adsense about the current account balance."><i class="fab fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=How to retrieve information from Adsense about the current account balance.&body=Check out this article: https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/"><i class="fas fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-digg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.tumblr.com/share/link?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&name=How to retrieve information from Adsense about the current account balance.&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li></ul></div><div id="toc"></div></span></div><div class="content index py4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">How to retrieve information from Adsense about the current account balance.</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Studio La cosa nostra blog</span></span><div class="postdate"><time datetime="2019-01-23T11:58:31.000Z" itemprop="datePublished">2019-01-23</time></div><div class="article-tag"><i class="fas fa-tag"></i> <a class="tag-link" href="/tags/adsense/">adsense</a>, <a class="tag-link" href="/tags/node-js/">node.js</a>, <a class="tag-link" href="/tags/typescript/">typescript</a></div></div></header><div class="content" itemprop="articleBody"><p>Unfortunately, Adsense requires you to log in to the real user of your Adsense account. For this purpose, we will use the key generated from the <a href="https://developers.google.com/adsense/management/getting_started" target="_blank" rel="noopener">Google Adsense Management API site</a> and <strong>click</strong><br><img src="/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/register-your-app-button.png" alt="Register your app button"></p><p>Program code in typescript: <code>adsense.ts</code></p><pre class="line-numbers language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{</span> adsense_v1_4 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'googleapis'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'util'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2Client <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'google-auth-library'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> http <span class="token keyword">from</span> <span class="token string">'http'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> url <span class="token keyword">from</span> <span class="token string">'url'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> opn <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'opn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> moment <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> readFileAsync <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * Start by acquiring a pre-authenticated oAuth2 client.
 */</span>
<span class="token keyword">let</span> oAuth2Client<span class="token punctuation">:</span> OAuth2Client<span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAdsense</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oAuth2Client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    oAuth2Client <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAuthenticatedClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// After acquiring an access_token, you may want to check on the audience, expiration,</span>
  <span class="token comment">// or original scopes requested.  You can do that with the `getTokenInfo` method.</span>
  <span class="token keyword">const</span> adsense <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">adsense_v1_4<span class="token punctuation">.</span>Adsense</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    auth<span class="token punctuation">:</span> oAuth2Client
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> otherMonths <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> adsense<span class="token punctuation">.</span>payments<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token keyword">const</span> otherMonthsSum <span class="token operator">=</span> otherMonths <span class="token operator">&amp;&amp;</span> otherMonths<span class="token punctuation">.</span>items <span class="token operator">&amp;&amp;</span> otherMonths<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">=></span> sum <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>paymentAmount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> thisMonth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> adsense<span class="token punctuation">.</span>reports<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    startDate<span class="token punctuation">:</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    endDate<span class="token punctuation">:</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    metric<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'AD_REQUESTS'</span><span class="token punctuation">,</span> <span class="token string">'CLICKS'</span><span class="token punctuation">,</span> <span class="token string">'EARNINGS'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>totals<span class="token punctuation">;</span>
  <span class="token keyword">const</span> thisMonthSum <span class="token operator">=</span> thisMonth <span class="token operator">&amp;&amp;</span> <span class="token function">Number</span><span class="token punctuation">(</span>thisMonth<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>
  <span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">(</span>thisMonthSum <span class="token operator">+</span> otherMonthsSum<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    thisMonthSum<span class="token punctuation">,</span>
    otherMonthsSum<span class="token punctuation">,</span>
    sum
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> initAdsense <span class="token operator">=</span> getAdsense<span class="token punctuation">;</span>

<span class="token comment">/**
 * Create a new OAuth2Client, and go through the OAuth2 content
 * workflow.  Return the full client to the callback.
 */</span>
<span class="token keyword">function</span> <span class="token function">getAuthenticatedClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>OAuth2Client<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// create an oAuth client to authorize the API call.  Secrets are kept in a `keys.json` file,</span>
    <span class="token comment">// which should be downloaded from the Google Developers Console.</span>
    <span class="token keyword">const</span> credentialsBuffer <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFileAsync</span><span class="token punctuation">(</span><span class="token string">'./configs/credentials.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> credentials <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>credentialsBuffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> oAuth2Client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2Client</span><span class="token punctuation">(</span>
      credentials<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client_id<span class="token punctuation">,</span>
      credentials<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client_secret<span class="token punctuation">,</span>
      credentials<span class="token punctuation">.</span>web<span class="token punctuation">.</span>redirect_uris<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Generate the url that will be used for the consent dialog.</span>
    <span class="token keyword">const</span> authorizeUrl <span class="token operator">=</span> oAuth2Client<span class="token punctuation">.</span><span class="token function">generateAuthUrl</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      access_type<span class="token punctuation">:</span> <span class="token string">'offline'</span><span class="token punctuation">,</span>
      prompt<span class="token punctuation">:</span> <span class="token string">'consent'</span><span class="token punctuation">,</span>
      scope<span class="token punctuation">:</span> <span class="token string">'https://www.googleapis.com/auth/adsense.readonly'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Open an http server to accept the oauth callback. In this simple example, the</span>
    <span class="token comment">// only request to our webserver is to /oauth2callback?code=&lt;code></span>
    <span class="token keyword">const</span> server <span class="token operator">=</span> http
      <span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>url <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'/oauth2callback'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// acquire the code from the querystring, and close the web server.</span>
            <span class="token keyword">const</span> urlSearchParams<span class="token punctuation">:</span> url<span class="token punctuation">.</span>URLSearchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">url<span class="token punctuation">.</span>URL</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token string">'http://localhost:3000'</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span>searchParams<span class="token punctuation">;</span>
            <span class="token keyword">const</span> code <span class="token operator">=</span> urlSearchParams<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"text/html"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
            &lt;html>
              &lt;body>
                Authentication successful! Please return to the console.
              &lt;/body>
            &lt;/html>
            `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Now that we have the code, use that to acquire tokens.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> <span class="token punctuation">{</span> tokens <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> oAuth2Client<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
              oAuth2Client<span class="token punctuation">.</span><span class="token function">setCredentials</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Tokens acquired.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span>oAuth2Client<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'missing code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// open the browser to the authorize url to start the workflow</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server created'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">opn</span><span class="token punctuation">(</span>authorizeUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span> wait<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>childProcess <span class="token operator">=></span> childProcess<span class="token punctuation">.</span><span class="token function">unref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">initAdsense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>to run code</p><pre class="line-numbers language-bash"><code class="language-bash">ts-node adsense.ts
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>the program will open the google page for you to authorize the adsense account.<br>After authorization, the program already stores an authentication token, so every next call to the <code>getAdsense</code> function will not open the browser window any more.</p></div></article><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/projects">Projects</a></li></ul></div><div id="toc-footer" style="display:none"></div><div id="share-footer" style="display:none"><ul><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&text=How to retrieve information from Adsense about the current account balance."><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&is_video=false&description=How to retrieve information from Adsense about the current account balance."><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=How to retrieve information from Adsense about the current account balance.&body=Check out this article: https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&title=How to retrieve information from Adsense about the current account balance."><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.tumblr.com/share/link?url=https://studiolacosanostra.github.io/2019/01/23/how-to-retrieve-information-from-adsense-about-the-current-account-balance/&name=How to retrieve information from Adsense about the current account balance.&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li></ul></div><div id="actions-footer"><a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a> <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a> <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a> <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2019 Studio La cosa nostra blog | Words: 1.5k</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/projects">Projects</a></li></ul></nav></div></footer></div><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"></noscript><link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css"></noscript><script src="/lib/jquery/jquery.min.js"></script><script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/magnify/2.3.2/js/jquery.magnify.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/magnify/2.3.2/js/jquery.magnify-mobile.min.js"></script><script>$(document).ready(function () {
    console.log('ready', $('article img'))
    const a = $('article p img').each((_, element) => {
      const src = element.getAttribute('src');
      $(element).magnify({
        src: src
      })
    })
  });</script><script src="/js/main.js"></script></body></html>